Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id EDE26155DFE
	for <lists.virtualization@lfdr.de>; Fri,  7 Feb 2020 19:26:17 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id AC5118697C;
	Fri,  7 Feb 2020 18:26:16 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 6h9NeoK8HSl5; Fri,  7 Feb 2020 18:26:10 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id AA8AA86933;
	Fri,  7 Feb 2020 18:26:01 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 92294C013E;
	Fri,  7 Feb 2020 18:26:01 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 494B0C1D81
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:57 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id 2FF612264C
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:57 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id nM+B+oD+NeXi
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:56 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by silver.osuosl.org (Postfix) with ESMTPS id 9847122624
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:55 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 5AAA4305D35A; Fri,  7 Feb 2020 20:16:41 +0200 (EET)
Received: from host.bbu.bitdefender.biz (unknown [195.210.4.22])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 4DE6F3052071;
 Fri,  7 Feb 2020 20:16:41 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [RFC PATCH v7 60/78] KVM: introspection: add KVMI_VCPU_CONTROL_CR and
 KVMI_EVENT_CR
Date: Fri,  7 Feb 2020 20:16:18 +0200
Message-Id: <20200207181636.1065-61-alazar@bitdefender.com>
In-Reply-To: <20200207181636.1065-1-alazar@bitdefender.com>
References: <20200207181636.1065-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 Sean Christopherson <sean.j.christopherson@intel.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVXNpbmcgdGhlIEtW
TUlfVkNQVV9DT05UUk9MX0NSIGNvbW1hbmQsIHRoZSBpbnRyb3NwZWN0aW9uIHRvb2wgc3Vic2Ny
aWJlcwp0byBLVk1JX0VWRU5UX0NSIGV2ZW50cyB0aGF0IHdpbGwgYmUgc2VudCB3aGVuIENSezAs
Myw0fSBpcyBnb2luZyB0bwpiZSBjaGFuZ2VkLgoKU2lnbmVkLW9mZi1ieTogTWloYWkgRG9uyJt1
IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgpDby1kZXZlbG9wZWQtYnk6IEFkYWxiZXJ0IExhesSD
ciA8YWxhemFyQGJpdGRlZmVuZGVyLmNvbT4KU2lnbmVkLW9mZi1ieTogQWRhbGJlcnQgTGF6xINy
IDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgotLS0KIERvY3VtZW50YXRpb24vdmlydC9rdm0va3Zt
aS5yc3QgICAgICAgICAgICAgICB8ICA3MSArKysrKysrKysrKwogYXJjaC94ODYvaW5jbHVkZS9h
c20va3ZtaV9ob3N0LmggICAgICAgICAgICAgIHwgIDEwICsrCiBhcmNoL3g4Ni9pbmNsdWRlL3Vh
cGkvYXNtL2t2bWkuaCAgICAgICAgICAgICAgfCAgMTggKysrCiBhcmNoL3g4Ni9rdm0va3ZtaS5j
ICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAxMTIgKysrKysrKysrKysrKysrKysrCiBhcmNo
L3g4Ni9rdm0vdm14L3ZteC5jICAgICAgICAgICAgICAgICAgICAgICAgfCAgIDYgKy0KIGFyY2gv
eDg2L2t2bS94ODYuYyAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAxMiArLQogaW5jbHVk
ZS91YXBpL2xpbnV4L2t2bWkuaCAgICAgICAgICAgICAgICAgICAgIHwgICAyICsKIC4uLi90ZXN0
aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jICB8ICA5OCArKysrKysrKysrKysr
KysKIHZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCAgICAgICAgICAgICB8ICAgOSAr
KwogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jICAgICAgICAgICAgIHwgIDE5ICsr
LQogMTAgZmlsZXMgY2hhbmdlZCwgMzUxIGluc2VydGlvbnMoKyksIDYgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCBiL0RvY3VtZW50YXRp
b24vdmlydC9rdm0va3ZtaS5yc3QKaW5kZXggNDcwNDA3ZjMwOWQ5Li4xN2E3Y2M1MGFlZGMgMTAw
NjQ0Ci0tLSBhL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKKysrIGIvRG9jdW1lbnRh
dGlvbi92aXJ0L2t2bS9rdm1pLnJzdApAQCAtNTMxLDYgKzUzMSw3IEBAIEVuYWJsZXMvZGlzYWJs
ZXMgdkNQVSBpbnRyb3NwZWN0aW9uIGV2ZW50cy4gVGhpcyBjb21tYW5kIGNhbiBiZSB1c2VkIHdp
dGgKIHRoZSBmb2xsb3dpbmcgZXZlbnRzOjoKIAogCUtWTUlfRVZFTlRfQlJFQUtQT0lOVAorCUtW
TUlfRVZFTlRfQ1IKIAlLVk1JX0VWRU5UX0hZUEVSQ0FMTAogCiBXaGVuIGFuIGV2ZW50IGlzIGVu
YWJsZWQsIHRoZSBpbnRyb3NwZWN0aW9uIHRvb2wgaXMgbm90aWZpZWQgYW5kIGl0CkBAIC02NTgs
NiArNjU5LDQxIEBAIFJldHVybnMgYSBDUFVJRCBsZWFmIChhcyBzZWVuIGJ5IHRoZSBndWVzdCBP
UykuCiAqIC1LVk1fRUFHQUlOIC0gdGhlIHNlbGVjdGVkIHZDUFUgY2FuJ3QgYmUgaW50cm9zcGVj
dGVkIHlldAogKiAtS1ZNX0VOT0VOVCAtIHRoZSBzZWxlY3RlZCBsZWFmIGlzIG5vdCBwcmVzZW50
IG9yIGlzIGludmFsaWQKIAorMTQuIEtWTUlfVkNQVV9DT05UUk9MX0NSCistLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KKworOkFyY2hpdGVjdHVyZXM6IHg4NgorOlZlcnNpb25zOiA+PSAxCis6UGFy
YW1ldGVyczoKKworOjoKKworCXN0cnVjdCBrdm1pX3ZjcHVfaGRyOworCXN0cnVjdCBrdm1pX3Zj
cHVfY29udHJvbF9jciB7CisJCV9fdTggZW5hYmxlOworCQlfX3U4IHBhZGRpbmcxOworCQlfX3Ux
NiBwYWRkaW5nMjsKKwkJX191MzIgY3I7CisJfTsKKworOlJldHVybnM6CisKKzo6CisKKwlzdHJ1
Y3Qga3ZtaV9lcnJvcl9jb2RlCisKK0VuYWJsZXMvZGlzYWJsZXMgaW50cm9zcGVjdGlvbiBmb3Ig
YSBzcGVjaWZpYyBjb250cm9sIHJlZ2lzdGVyIGFuZCBtdXN0CitiZSB1c2VkIGluIGFkZGl0aW9u
IHRvICpLVk1JX1ZDUFVfQ09OVFJPTF9FVkVOVFMqIHdpdGggdGhlICpLVk1JX0VWRU5UX0NSKgor
SUQgc2V0LgorCis6RXJyb3JzOgorCisqIC1LVk1fRUlOVkFMIC0gdGhlIHNlbGVjdGVkIHZDUFUg
aXMgaW52YWxpZAorKiAtS1ZNX0VJTlZBTCAtIHRoZSBzcGVjaWZpZWQgY29udHJvbCByZWdpc3Rl
ciBpcyBub3QgcGFydCBvZiB0aGUgQ1IwLCBDUjMKKyAgIG9yIENSNCBzZXQKKyogLUtWTV9FSU5W
QUwgLSBwYWRkaW5nIGlzIG5vdCB6ZXJvCisqIC1LVk1fRUFHQUlOIC0gdGhlIHNlbGVjdGVkIHZD
UFUgY2FuJ3QgYmUgaW50cm9zcGVjdGVkIHlldAorCiBFdmVudHMKID09PT09PQogCkBAIC04MzUs
MyArODcxLDM4IEBAIHRyeWluZyB0byBwZXJmb3JtIGEgY2VydGFpbiBvcGVyYXRpb24gKGxpa2Ug
Y3JlYXRpbmcgYSBwcm9jZXNzKS4KIGBga3ZtaV9ldmVudGBgIGFuZCB0aGUgZ3Vlc3QgcGh5c2lj
YWwgYWRkcmVzcyBhcmUgc2VudCB0byB0aGUgaW50cm9zcGVjdGlvbiB0b29sLgogCiBUaGUgKlJF
VFJZKiBhY3Rpb24gaXMgdXNlZCBieSB0aGUgaW50cm9zcGVjdGlvbiB0b29sIGZvciBpdHMgb3du
IGJyZWFrcG9pbnRzLgorCis1LiBLVk1JX0VWRU5UX0NSCistLS0tLS0tLS0tLS0tLS0tCisKKzpB
cmNoaXRlY3R1cmVzOiB4ODYKKzpWZXJzaW9uczogPj0gMQorOkFjdGlvbnM6IENPTlRJTlVFLCBD
UkFTSAorOlBhcmFtZXRlcnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV9ldmVudDsKKwlzdHJ1Y3Qg
a3ZtaV9ldmVudF9jciB7CisJCV9fdTE2IGNyOworCQlfX3UxNiBwYWRkaW5nWzNdOworCQlfX3U2
NCBvbGRfdmFsdWU7CisJCV9fdTY0IG5ld192YWx1ZTsKKwl9OworCis6UmV0dXJuczoKKworOjoK
KworCXN0cnVjdCBrdm1pX3ZjcHVfaGRyOworCXN0cnVjdCBrdm1pX2V2ZW50X3JlcGx5OworCXN0
cnVjdCBrdm1pX2V2ZW50X2NyX3JlcGx5IHsKKwkJX191NjQgbmV3X3ZhbDsKKwl9OworCitUaGlz
IGV2ZW50IGlzIHNlbnQgd2hlbiBhIGNvbnRyb2wgcmVnaXN0ZXIgaXMgZ29pbmcgdG8gYmUgY2hh
bmdlZCBhbmQgdGhlCitpbnRyb3NwZWN0aW9uIGhhcyBiZWVuIGVuYWJsZWQgZm9yIHRoaXMgZXZl
bnQgYW5kIGZvciB0aGlzIHNwZWNpZmljCityZWdpc3RlciAoc2VlICoqS1ZNSV9WQ1BVX0NPTlRS
T0xfRVZFTlRTKiopLgorCitgYGt2bWlfZXZlbnRgYCwgdGhlIGNvbnRyb2wgcmVnaXN0ZXIgbnVt
YmVyLCB0aGUgb2xkIHZhbHVlIGFuZCB0aGUgbmV3IHZhbHVlCithcmUgc2VudCB0byB0aGUgaW50
cm9zcGVjdGlvbiB0b29sLiBUaGUgKkNPTlRJTlVFKiBhY3Rpb24gd2lsbCBzZXQgdGhlIGBgbmV3
X3ZhbGBgLgpkaWZmIC0tZ2l0IGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmggYi9h
cmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaAppbmRleCBjOGI3OTM5MTViODQuLjRhYzIw
OWNiNGViZiAxMDA2NDQKLS0tIGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmgKKysr
IGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmgKQEAgLTIsNiArMiw4IEBACiAjaWZu
ZGVmIF9BU01fWDg2X0tWTUlfSE9TVF9ICiAjZGVmaW5lIF9BU01fWDg2X0tWTUlfSE9TVF9ICiAK
KyNkZWZpbmUgS1ZNSV9OVU1fQ1IgNQorCiBzdHJ1Y3Qga3ZtaV9tb25pdG9yX2ludGVyY2VwdGlv
biB7CiAJYm9vbCBrdm1pX2ludGVyY2VwdGVkOwogCWJvb2wga3ZtX2ludGVyY2VwdGVkOwpAQCAt
MTQsNiArMTYsNyBAQCBzdHJ1Y3Qga3ZtaV9pbnRlcmNlcHRpb24gewogfTsKIAogc3RydWN0IGt2
bV92Y3B1X2FyY2hfaW50cm9zcGVjdGlvbiB7CisJREVDTEFSRV9CSVRNQVAoY3JfbWFzaywgS1ZN
SV9OVU1fQ1IpOwogfTsKIAogc3RydWN0IGt2bV9hcmNoX2ludHJvc3BlY3Rpb24gewpAQCAtMjIs
MTEgKzI1LDE4IEBAIHN0cnVjdCBrdm1fYXJjaF9pbnRyb3NwZWN0aW9uIHsKICNpZmRlZiBDT05G
SUdfS1ZNX0lOVFJPU1BFQ1RJT04KIAogYm9vbCBrdm1pX21vbml0b3JfYnBfaW50ZXJjZXB0KHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTMyIGRiZyk7Citib29sIGt2bWlfY3JfZXZlbnQoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1LCB1bnNpZ25lZCBpbnQgY3IsCisJCSAgIHVuc2lnbmVkIGxvbmcgb2xk
X3ZhbHVlLCB1bnNpZ25lZCBsb25nICpuZXdfdmFsdWUpOworYm9vbCBrdm1pX2NyM19pbnRlcmNl
cHRlZChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwogCiAjZWxzZSAvKiBDT05GSUdfS1ZNX0lOVFJP
U1BFQ1RJT04gKi8KIAogc3RhdGljIGlubGluZSBib29sIGt2bWlfbW9uaXRvcl9icF9pbnRlcmNl
cHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgZGJnKQogCXsgcmV0dXJuIGZhbHNlOyB9Citz
dGF0aWMgaW5saW5lIGJvb2wga3ZtaV9jcl9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHVu
c2lnbmVkIGludCBjciwKKwkJCQkgdW5zaWduZWQgbG9uZyBvbGRfdmFsdWUsCisJCQkJIHVuc2ln
bmVkIGxvbmcgKm5ld192YWx1ZSkgeyByZXR1cm4gdHJ1ZTsgfQorc3RhdGljIGlubGluZSBib29s
IGt2bWlfY3IzX2ludGVyY2VwdGVkKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkgeyByZXR1cm4gZmFs
c2U7IH0KIAogI2VuZGlmIC8qIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCmRpZmYgLS1n
aXQgYS9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaCBiL2FyY2gveDg2L2luY2x1ZGUv
dWFwaS9hc20va3ZtaS5oCmluZGV4IDE2MDU3NzcyNTZhMy4uZDFhMGJlMDQ5OWQ0IDEwMDY0NAot
LS0gYS9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaAorKysgYi9hcmNoL3g4Ni9pbmNs
dWRlL3VhcGkvYXNtL2t2bWkuaApAQCAtNjUsNCArNjUsMjIgQEAgc3RydWN0IGt2bWlfZXZlbnRf
YnJlYWtwb2ludCB7CiAJX191OCBwYWRkaW5nWzddOwogfTsKIAorc3RydWN0IGt2bWlfdmNwdV9j
b250cm9sX2NyIHsKKwlfX3U4IGVuYWJsZTsKKwlfX3U4IHBhZGRpbmcxOworCV9fdTE2IHBhZGRp
bmcyOworCV9fdTMyIGNyOworfTsKKworc3RydWN0IGt2bWlfZXZlbnRfY3IgeworCV9fdTE2IGNy
OworCV9fdTE2IHBhZGRpbmdbM107CisJX191NjQgb2xkX3ZhbHVlOworCV9fdTY0IG5ld192YWx1
ZTsKK307CisKK3N0cnVjdCBrdm1pX2V2ZW50X2NyX3JlcGx5IHsKKwlfX3U2NCBuZXdfdmFsOwor
fTsKKwogI2VuZGlmIC8qIF9VQVBJX0FTTV9YODZfS1ZNSV9IICovCmRpZmYgLS1naXQgYS9hcmNo
L3g4Ni9rdm0va3ZtaS5jIGIvYXJjaC94ODYva3ZtL2t2bWkuYwppbmRleCA1NGFiYWY0MTZmZjMu
Ljk5MTcyOTVlOWE1NiAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL2t2bWkuYworKysgYi9hcmNo
L3g4Ni9rdm0va3ZtaS5jCkBAIC0zNDEsMyArMzQxLDExNSBAQCB2b2lkIGt2bWlfYXJjaF9yZXF1
ZXN0X3Jlc3RvcmVfaW50ZXJjZXB0aW9uKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAlpZiAoYXJj
aF92Y3B1aSkKIAkJYXJjaF92Y3B1aS0+cmVzdG9yZV9pbnRlcmNlcHRpb24gPSB0cnVlOwogfQor
CitpbnQga3ZtaV9hcmNoX2NtZF92Y3B1X2NvbnRyb2xfY3Ioc3RydWN0IGt2bV92Y3B1ICp2Y3B1
LAorCQkJCSAgY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9jb250cm9sX2NyICpyZXEpCit7CisJdTMy
IGNyID0gcmVxLT5jcjsKKworCWlmIChyZXEtPnBhZGRpbmcxIHx8IHJlcS0+cGFkZGluZzIgfHwg
Y3IgPj0gS1ZNSV9OVU1fQ1IpCisJCXJldHVybiAtS1ZNX0VJTlZBTDsKKworCXN3aXRjaCAoY3Ip
IHsKKwljYXNlIDA6CisJCWJyZWFrOworCWNhc2UgMzoKKwkJa3ZtX3g4Nl9vcHMtPmNvbnRyb2xf
Y3IzX2ludGVyY2VwdCh2Y3B1LCBDUl9UWVBFX1csCisJCQkJCQkgICByZXEtPmVuYWJsZSk7CisJ
CWJyZWFrOworCWNhc2UgNDoKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1LVk1fRUlO
VkFMOworCX0KKworCWlmIChyZXEtPmVuYWJsZSkKKwkJc2V0X2JpdChjciwgVkNQVUkodmNwdSkt
PmFyY2guY3JfbWFzayk7CisJZWxzZQorCQljbGVhcl9iaXQoY3IsIFZDUFVJKHZjcHUpLT5hcmNo
LmNyX21hc2spOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB1MzIga3ZtaV9zZW5kX2NyKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTMyIGNyLCB1NjQgb2xkX3ZhbHVlLAorCQkJdTY0IG5ld192
YWx1ZSwgdTY0ICpyZXRfdmFsdWUpCit7CisJc3RydWN0IGt2bWlfZXZlbnRfY3IgZSA9IHsKKwkJ
LmNyID0gY3IsCisJCS5vbGRfdmFsdWUgPSBvbGRfdmFsdWUsCisJCS5uZXdfdmFsdWUgPSBuZXdf
dmFsdWUKKwl9OworCXN0cnVjdCBrdm1pX2V2ZW50X2NyX3JlcGx5IHI7CisJaW50IGVyciwgYWN0
aW9uOworCisJZXJyID0ga3ZtaV9zZW5kX2V2ZW50KHZjcHUsIEtWTUlfRVZFTlRfQ1IsICZlLCBz
aXplb2YoZSksCisJCQkgICAgICAmciwgc2l6ZW9mKHIpLCAmYWN0aW9uKTsKKwlpZiAoZXJyKSB7
CisJCSpyZXRfdmFsdWUgPSBuZXdfdmFsdWU7CisJCXJldHVybiBLVk1JX0VWRU5UX0FDVElPTl9D
T05USU5VRTsKKwl9CisKKwkqcmV0X3ZhbHVlID0gci5uZXdfdmFsOworCXJldHVybiBhY3Rpb247
Cit9CisKK3N0YXRpYyBib29sIF9fa3ZtaV9jcl9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUs
IHVuc2lnbmVkIGludCBjciwKKwkJCSAgICB1bnNpZ25lZCBsb25nIG9sZF92YWx1ZSwgdW5zaWdu
ZWQgbG9uZyAqbmV3X3ZhbHVlKQoreworCXU2NCByZXRfdmFsdWU7CisJdTMyIGFjdGlvbjsKKwli
b29sIHJldCA9IGZhbHNlOworCisJaWYgKCF0ZXN0X2JpdChjciwgVkNQVUkodmNwdSktPmFyY2gu
Y3JfbWFzaykpCisJCXJldHVybiB0cnVlOworCisJYWN0aW9uID0ga3ZtaV9zZW5kX2NyKHZjcHUs
IGNyLCBvbGRfdmFsdWUsICpuZXdfdmFsdWUsICZyZXRfdmFsdWUpOworCXN3aXRjaCAoYWN0aW9u
KSB7CisJY2FzZSBLVk1JX0VWRU5UX0FDVElPTl9DT05USU5VRToKKwkJKm5ld192YWx1ZSA9IHJl
dF92YWx1ZTsKKwkJcmV0ID0gdHJ1ZTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJa3ZtaV9oYW5k
bGVfY29tbW9uX2V2ZW50X2FjdGlvbnModmNwdS0+a3ZtLCBhY3Rpb24sICJDUiIpOworCX0KKwor
CXJldHVybiByZXQ7Cit9CisKK2Jvb2wga3ZtaV9jcl9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUsIHVuc2lnbmVkIGludCBjciwKKwkJICAgdW5zaWduZWQgbG9uZyBvbGRfdmFsdWUsIHVuc2ln
bmVkIGxvbmcgKm5ld192YWx1ZSkKK3sKKwlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWk7
CisJYm9vbCByZXQgPSB0cnVlOworCisJaWYgKG9sZF92YWx1ZSA9PSAqbmV3X3ZhbHVlKQorCQly
ZXR1cm4gdHJ1ZTsKKworCWt2bWkgPSBrdm1pX2dldCh2Y3B1LT5rdm0pOworCWlmICgha3ZtaSkK
KwkJcmV0dXJuIHRydWU7CisKKwlpZiAoaXNfZXZlbnRfZW5hYmxlZCh2Y3B1LCBLVk1JX0VWRU5U
X0NSKSkKKwkJcmV0ID0gX19rdm1pX2NyX2V2ZW50KHZjcHUsIGNyLCBvbGRfdmFsdWUsIG5ld192
YWx1ZSk7CisKKwlrdm1pX3B1dCh2Y3B1LT5rdm0pOworCisJcmV0dXJuIHJldDsKK30KKworYm9v
bCBrdm1pX2NyM19pbnRlcmNlcHRlZChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCit7CisJc3RydWN0
IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pOworCWJvb2wgcmV0OworCisJa3ZtaSA9IGt2bWlfZ2V0
KHZjcHUtPmt2bSk7CisJaWYgKCFrdm1pKQorCQlyZXR1cm4gZmFsc2U7CisKKwlyZXQgPSB0ZXN0
X2JpdCgzLCBWQ1BVSSh2Y3B1KS0+YXJjaC5jcl9tYXNrKTsKKworCWt2bWlfcHV0KHZjcHUtPmt2
bSk7CisKKwlyZXR1cm4gcmV0OworfQorRVhQT1JUX1NZTUJPTChrdm1pX2NyM19pbnRlcmNlcHRl
ZCk7CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jIGIvYXJjaC94ODYva3ZtL3Zt
eC92bXguYwppbmRleCBkMjMxZmYyNWY0NjcuLmQzZDc5MDg5OTViNSAxMDA2NDQKLS0tIGEvYXJj
aC94ODYva3ZtL3ZteC92bXguYworKysgYi9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jCkBAIC00ODUw
LDcgKzQ4NTAsOCBAQCBzdGF0aWMgaW50IGhhbmRsZV9jcihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUp
CiAJCQllcnIgPSBoYW5kbGVfc2V0X2NyMCh2Y3B1LCB2YWwpOwogCQkJcmV0dXJuIGt2bV9jb21w
bGV0ZV9pbnNuX2dwKHZjcHUsIGVycik7CiAJCWNhc2UgMzoKLQkJCVdBUk5fT05fT05DRShlbmFi
bGVfdW5yZXN0cmljdGVkX2d1ZXN0KTsKKwkJCVdBUk5fT05fT05DRShlbmFibGVfdW5yZXN0cmlj
dGVkX2d1ZXN0ICYmCisJCQkJICAgICAha3ZtaV9jcjNfaW50ZXJjZXB0ZWQodmNwdSkpOwogCQkJ
ZXJyID0ga3ZtX3NldF9jcjModmNwdSwgdmFsKTsKIAkJCXJldHVybiBrdm1fY29tcGxldGVfaW5z
bl9ncCh2Y3B1LCBlcnIpOwogCQljYXNlIDQ6CkBAIC00ODgzLDcgKzQ4ODQsOCBAQCBzdGF0aWMg
aW50IGhhbmRsZV9jcihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJY2FzZSAxOiAvKm1vdiBmcm9t
IGNyKi8KIAkJc3dpdGNoIChjcikgewogCQljYXNlIDM6Ci0JCQlXQVJOX09OX09OQ0UoZW5hYmxl
X3VucmVzdHJpY3RlZF9ndWVzdCk7CisJCQlXQVJOX09OX09OQ0UoZW5hYmxlX3VucmVzdHJpY3Rl
ZF9ndWVzdCAmJgorCQkJCSAgICAgIWt2bWlfY3IzX2ludGVyY2VwdGVkKHZjcHUpKTsKIAkJCXZh
bCA9IGt2bV9yZWFkX2NyMyh2Y3B1KTsKIAkJCWt2bV9yZWdpc3Rlcl93cml0ZSh2Y3B1LCByZWcs
IHZhbCk7CiAJCQl0cmFjZV9rdm1fY3JfcmVhZChjciwgdmFsKTsKZGlmZiAtLWdpdCBhL2FyY2gv
eDg2L2t2bS94ODYuYyBiL2FyY2gveDg2L2t2bS94ODYuYwppbmRleCBhM2FmYmJiNzE5OWYuLmUw
Mzc2ZDBiNzQwOCAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL3g4Ni5jCisrKyBiL2FyY2gveDg2
L2t2bS94ODYuYwpAQCAtNzc0LDYgKzc3NCw5IEBAIGludCBrdm1fc2V0X2NyMChzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsIHVuc2lnbmVkIGxvbmcgY3IwKQogCWlmICghKGNyMCAmIFg4Nl9DUjBfUEcp
ICYmIGt2bV9yZWFkX2NyNF9iaXRzKHZjcHUsIFg4Nl9DUjRfUENJREUpKQogCQlyZXR1cm4gMTsK
IAorCWlmICgha3ZtaV9jcl9ldmVudCh2Y3B1LCAwLCBvbGRfY3IwLCAmY3IwKSkKKwkJcmV0dXJu
IDE7CisKIAlrdm1feDg2X29wcy0+c2V0X2NyMCh2Y3B1LCBjcjApOwogCiAJaWYgKChjcjAgXiBv
bGRfY3IwKSAmIFg4Nl9DUjBfUEcpIHsKQEAgLTkzNSw2ICs5MzgsOSBAQCBpbnQga3ZtX3NldF9j
cjQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1bnNpZ25lZCBsb25nIGNyNCkKIAkJCXJldHVybiAx
OwogCX0KIAorCWlmICgha3ZtaV9jcl9ldmVudCh2Y3B1LCA0LCBvbGRfY3I0LCAmY3I0KSkKKwkJ
cmV0dXJuIDE7CisKIAlpZiAoa3ZtX3g4Nl9vcHMtPnNldF9jcjQodmNwdSwgY3I0KSkKIAkJcmV0
dXJuIDE7CiAKQEAgLTk1MSw2ICs5NTcsNyBAQCBFWFBPUlRfU1lNQk9MX0dQTChrdm1fc2V0X2Ny
NCk7CiAKIGludCBrdm1fc2V0X2NyMyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHVuc2lnbmVkIGxv
bmcgY3IzKQogeworCXVuc2lnbmVkIGxvbmcgb2xkX2NyMyA9IGt2bV9yZWFkX2NyMyh2Y3B1KTsK
IAlib29sIHNraXBfdGxiX2ZsdXNoID0gZmFsc2U7CiAjaWZkZWYgQ09ORklHX1g4Nl82NAogCWJv
b2wgcGNpZF9lbmFibGVkID0ga3ZtX3JlYWRfY3I0X2JpdHModmNwdSwgWDg2X0NSNF9QQ0lERSk7
CkBAIC05NjEsNyArOTY4LDcgQEAgaW50IGt2bV9zZXRfY3IzKHN0cnVjdCBrdm1fdmNwdSAqdmNw
dSwgdW5zaWduZWQgbG9uZyBjcjMpCiAJfQogI2VuZGlmCiAKLQlpZiAoY3IzID09IGt2bV9yZWFk
X2NyMyh2Y3B1KSAmJiAhcGRwdHJzX2NoYW5nZWQodmNwdSkpIHsKKwlpZiAoY3IzID09IG9sZF9j
cjMgJiYgIXBkcHRyc19jaGFuZ2VkKHZjcHUpKSB7CiAJCWlmICghc2tpcF90bGJfZmx1c2gpIHsK
IAkJCWt2bV9tbXVfc3luY19yb290cyh2Y3B1KTsKIAkJCWt2bV9tYWtlX3JlcXVlc3QoS1ZNX1JF
UV9UTEJfRkxVU0gsIHZjcHUpOwpAQCAtOTc2LDYgKzk4Myw5IEBAIGludCBrdm1fc2V0X2NyMyhz
dHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHVuc2lnbmVkIGxvbmcgY3IzKQogCQkgIWxvYWRfcGRwdHJz
KHZjcHUsIHZjcHUtPmFyY2gud2Fsa19tbXUsIGNyMykpCiAJCXJldHVybiAxOwogCisJaWYgKCFr
dm1pX2NyX2V2ZW50KHZjcHUsIDMsIG9sZF9jcjMsICZjcjMpKQorCQlyZXR1cm4gMTsKKwogCWt2
bV9tbXVfbmV3X2NyMyh2Y3B1LCBjcjMsIHNraXBfdGxiX2ZsdXNoKTsKIAl2Y3B1LT5hcmNoLmNy
MyA9IGNyMzsKIAlrdm1fcmVnaXN0ZXJfbWFya19hdmFpbGFibGUodmNwdSwgVkNQVV9FWFJFR19D
UjMpOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaCBiL2luY2x1ZGUvdWFw
aS9saW51eC9rdm1pLmgKaW5kZXggZWVjMzNlODViMGM3Li43YmU1OGRjZjE5NGYgMTAwNjQ0Ci0t
LSBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgKKysrIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2
bWkuaApAQCAtMzIsNiArMzIsNyBAQCBlbnVtIHsKIAlLVk1JX1ZDUFVfR0VUX1JFR0lTVEVSUyAg
PSAxMiwKIAlLVk1JX1ZDUFVfU0VUX1JFR0lTVEVSUyAgPSAxMywKIAlLVk1JX1ZDUFVfR0VUX0NQ
VUlEICAgICAgPSAxNCwKKwlLVk1JX1ZDUFVfQ09OVFJPTF9DUiAgICAgPSAxNSwKIAogCUtWTUlf
TlVNX01FU1NBR0VTCiB9OwpAQCAtNDEsNiArNDIsNyBAQCBlbnVtIHsKIAlLVk1JX0VWRU5UX1BB
VVNFX1ZDUFUgPSAxLAogCUtWTUlfRVZFTlRfSFlQRVJDQUxMICA9IDIsCiAJS1ZNSV9FVkVOVF9C
UkVBS1BPSU5UID0gMywKKwlLVk1JX0VWRU5UX0NSICAgICAgICAgPSA0LAogCiAJS1ZNSV9OVU1f
RVZFTlRTCiB9OwpkaWZmIC0tZ2l0IGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82
NC9rdm1pX3Rlc3QuYyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90
ZXN0LmMKaW5kZXggMzMxNjRhYzc1Y2E5Li5hNmU1NjViMDU5NDcgMTAwNjQ0Ci0tLSBhL3Rvb2xz
L3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKKysrIGIvdG9vbHMvdGVz
dGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYwpAQCAtNDksNiArNDksNyBAQCBz
dHJ1Y3QgdmNwdV93b3JrZXJfZGF0YSB7CiBlbnVtIHsKIAlHVUVTVF9URVNUX05PT1AgPSAwLAog
CUdVRVNUX1RFU1RfQlAsCisJR1VFU1RfVEVTVF9DUiwKIAlHVUVTVF9URVNUX0hZUEVSQ0FMTCwK
IH07CiAKQEAgLTY4LDYgKzY5LDExIEBAIHN0YXRpYyB2b2lkIGd1ZXN0X2JwX3Rlc3Qodm9pZCkK
IAlhc20gdm9sYXRpbGUoImludDMiKTsKIH0KIAorc3RhdGljIHZvaWQgZ3Vlc3RfY3JfdGVzdCh2
b2lkKQoreworCXNldF9jcjQoZ2V0X2NyNCgpIHwgWDg2X0NSNF9PU1hTQVZFKTsKK30KKwogc3Rh
dGljIHZvaWQgZ3Vlc3RfaHlwZXJjYWxsX3Rlc3Qodm9pZCkKIHsKIAlhc20gdm9sYXRpbGUoIm1v
diAkMzQsICVyYXgiKTsKQEAgLTg1LDYgKzkxLDkgQEAgc3RhdGljIHZvaWQgZ3Vlc3RfY29kZSh2
b2lkKQogCQljYXNlIEdVRVNUX1RFU1RfQlA6CiAJCQlndWVzdF9icF90ZXN0KCk7CiAJCQlicmVh
azsKKwkJY2FzZSBHVUVTVF9URVNUX0NSOgorCQkJZ3Vlc3RfY3JfdGVzdCgpOworCQkJYnJlYWs7
CiAJCWNhc2UgR1VFU1RfVEVTVF9IWVBFUkNBTEw6CiAJCQlndWVzdF9oeXBlcmNhbGxfdGVzdCgp
OwogCQkJYnJlYWs7CkBAIC0xMDI5LDYgKzEwMzgsOTQgQEAgc3RhdGljIHZvaWQgdGVzdF9ldmVu
dF9icmVha3BvaW50KHN0cnVjdCBrdm1fdm0gKnZtKQogCWRpc2FibGVfdmNwdV9ldmVudCh2bSwg
ZXZlbnRfaWQpOwogfQogCitzdGF0aWMgaW50IGNtZF9jb250cm9sX2NyKHN0cnVjdCBrdm1fdm0g
KnZtLCBfX3UzMiBjciwgYm9vbCBlbmFibGUpCit7CisJc3RydWN0IHsKKwkJc3RydWN0IGt2bWlf
bXNnX2hkciBoZHI7CisJCXN0cnVjdCBrdm1pX3ZjcHVfaGRyIHZjcHVfaGRyOworCQlzdHJ1Y3Qg
a3ZtaV92Y3B1X2NvbnRyb2xfY3IgY21kOworCX0gcmVxID0ge307CisKKwlyZXEuY21kLmNyID0g
Y3I7CisJcmVxLmNtZC5lbmFibGUgPSBlbmFibGUgPyAxIDogMDsKKworCXJldHVybiBkb192Y3B1
MF9jb21tYW5kKHZtLCBLVk1JX1ZDUFVfQ09OVFJPTF9DUiwgJnJlcS5oZHIsIHNpemVvZihyZXEp
LAorCQkJCU5VTEwsIDApOworfQorCitzdGF0aWMgdm9pZCBlbmFibGVfY3JfZXZlbnRzKHN0cnVj
dCBrdm1fdm0gKnZtLCBfX3UzMiBjcikKK3sKKwlpbnQgcjsKKworCWVuYWJsZV92Y3B1X2V2ZW50
KHZtLCBLVk1JX0VWRU5UX0NSKTsKKworCXIgPSBjbWRfY29udHJvbF9jcih2bSwgY3IsIHRydWUp
OworCVRFU1RfQVNTRVJUKHIgPT0gMCwKKwkJIktWTUlfVkNQVV9DT05UUk9MX0NSIGZhaWxlZCwg
ZXJyb3IgJWQoJXMpXG4iLAorCQktciwga3ZtX3N0cmVycm9yKC1yKSk7Cit9CisKK3N0YXRpYyB2
b2lkIGRpc2FibGVfY3JfZXZlbnRzKHN0cnVjdCBrdm1fdm0gKnZtLCBfX3UzMiBjcikKK3sKKwlp
bnQgcjsKKworCXIgPSBjbWRfY29udHJvbF9jcih2bSwgY3IsIGZhbHNlKTsKKwlURVNUX0FTU0VS
VChyID09IDAsCisJCSJLVk1JX1ZDUFVfQ09OVFJPTF9DUiBmYWlsZWQsIGVycm9yICVkKCVzKVxu
IiwKKwkJLXIsIGt2bV9zdHJlcnJvcigtcikpOworCisJZGlzYWJsZV92Y3B1X2V2ZW50KHZtLCBL
Vk1JX0VWRU5UX0NSKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9jbWRfdmNwdV9jb250cm9sX2Ny
KHN0cnVjdCBrdm1fdm0gKnZtKQoreworCXN0cnVjdCB2Y3B1X3dvcmtlcl9kYXRhIGRhdGEgPSB7
CisJCS52bSA9IHZtLAorCQkudmNwdV9pZCA9IFZDUFVfSUQsCisJCS50ZXN0X2lkID0gR1VFU1Rf
VEVTVF9DUiwKKwl9OworCXN0cnVjdCBrdm1pX21zZ19oZHIgaGRyOworCXN0cnVjdCB7CisJCXN0
cnVjdCBrdm1pX2V2ZW50IGNvbW1vbjsKKwkJc3RydWN0IGt2bWlfZXZlbnRfY3IgY3I7CisJfSBl
djsKKwlzdHJ1Y3QgeworCQlzdHJ1Y3QgdmNwdV9yZXBseSBjb21tb247CisJCXN0cnVjdCBrdm1p
X2V2ZW50X2NyX3JlcGx5IGNyOworCX0gcnBsID0ge307CisJX191MTYgZXZlbnRfaWQgPSBLVk1J
X0VWRU5UX0NSOworCV9fdTMyIGNyX25vID0gNDsKKwlzdHJ1Y3Qga3ZtX3NyZWdzIHNyZWdzOwor
CXB0aHJlYWRfdCB2Y3B1X3RocmVhZDsKKworCWVuYWJsZV9jcl9ldmVudHModm0sIGNyX25vKTsK
KworCXZjcHVfdGhyZWFkID0gc3RhcnRfdmNwdV93b3JrZXIoJmRhdGEpOworCisJcmVjZWl2ZV9l
dmVudCgmaGRyLCAmZXYuY29tbW9uLCBzaXplb2YoZXYpLCBldmVudF9pZCk7CisKKwlERUJVRygi
Q1IldSwgb2xkIDB4JWxseCwgbmV3IDB4JWxseFxuIiwKKwkJZXYuY3IuY3IsIGV2LmNyLm9sZF92
YWx1ZSwgZXYuY3IubmV3X3ZhbHVlKTsKKworCVRFU1RfQVNTRVJUKGV2LmNyLmNyID09IGNyX25v
LAorCQkiVW5leHBlY3RlZCBDUiBldmVudCwgcmVjZWl2ZWQgQ1IldSwgZXhwZWN0ZWQgQ1IldSIs
CisJCWV2LmNyLmNyLCBjcl9ubyk7CisKKwlycGwuY3IubmV3X3ZhbCA9IGV2LmNyLm9sZF92YWx1
ZTsKKworCXJlcGx5X3RvX2V2ZW50KCZoZHIsICZldi5jb21tb24sIEtWTUlfRVZFTlRfQUNUSU9O
X0NPTlRJTlVFLAorCQkJJnJwbC5jb21tb24sIHNpemVvZihycGwpKTsKKworCXN0b3BfdmNwdV93
b3JrZXIodmNwdV90aHJlYWQsICZkYXRhKTsKKworCWRpc2FibGVfY3JfZXZlbnRzKHZtLCBjcl9u
byk7CisKKwl2Y3B1X3NyZWdzX2dldCh2bSwgVkNQVV9JRCwgJnNyZWdzKTsKKwlURVNUX0FTU0VS
VChzcmVncy5jcjQgPT0gZXYuY3Iub2xkX3ZhbHVlLAorCQkiRmFpbGVkIHRvIGJsb2NrIENSNCB1
cGRhdGUsIENSNCAweCV4LCBleHBlY3RlZCAweCV4IiwKKwkJc3JlZ3MuY3I0LCBldi5jci5vbGRf
dmFsdWUpOworfQorCiBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92
bSAqdm0pCiB7CiAJc2V0dXBfc29ja2V0KCk7CkBAIC0xMDUwLDYgKzExNDcsNyBAQCBzdGF0aWMg
dm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAqdm0pCiAJdGVzdF9jbWRfdmNw
dV9nZXRfY3B1aWQodm0pOwogCXRlc3RfZXZlbnRfaHlwZXJjYWxsKHZtKTsKIAl0ZXN0X2V2ZW50
X2JyZWFrcG9pbnQodm0pOworCXRlc3RfY21kX3ZjcHVfY29udHJvbF9jcih2bSk7CiAKIAl1bmhv
b2tfaW50cm9zcGVjdGlvbih2bSk7CiB9CmRpZmYgLS1naXQgYS92aXJ0L2t2bS9pbnRyb3NwZWN0
aW9uL2t2bWlfaW50LmggYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgKaW5kZXgg
MDY3OTJjMGJhNmU2Li5jMmY2MTNlNTMwNGUgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2ludHJvc3Bl
Y3Rpb24va3ZtaV9pbnQuaAorKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgK
QEAgLTIzLDYgKzIzLDcgQEAKIAkJKQogI2RlZmluZSBLVk1JX0tOT1dOX1ZDUFVfRVZFTlRTICgg
XAogCQkJICAgIEJJVChLVk1JX0VWRU5UX0JSRUFLUE9JTlQpIFwKKwkJCSAgfCBCSVQoS1ZNSV9F
VkVOVF9DUikgXAogCQkJICB8IEJJVChLVk1JX0VWRU5UX0hZUEVSQ0FMTCkgXAogCQkJICB8IEJJ
VChLVk1JX0VWRU5UX1BBVVNFX1ZDUFUpIFwKIAkJKQpAQCAtMzksNiArNDAsNyBAQAogCQkJfCBC
SVQoS1ZNSV9WTV9XUklURV9QSFlTSUNBTCkgXAogCQkJfCBCSVQoS1ZNSV9WQ1BVX0dFVF9JTkZP
KSBcCiAJCQl8IEJJVChLVk1JX1ZDUFVfUEFVU0UpIFwKKwkJCXwgQklUKEtWTUlfVkNQVV9DT05U
Uk9MX0NSKSBcCiAJCQl8IEJJVChLVk1JX1ZDUFVfQ09OVFJPTF9FVkVOVFMpIFwKIAkJCXwgQklU
KEtWTUlfVkNQVV9HRVRfQ1BVSUQpIFwKIAkJCXwgQklUKEtWTUlfVkNQVV9HRVRfUkVHSVNURVJT
KSBcCkBAIC02NCw2ICs2Niw5IEBAIGJvb2wga3ZtaV9zb2NrX2dldChzdHJ1Y3Qga3ZtX2ludHJv
c3BlY3Rpb24gKmt2bWksIGludCBmZCk7CiB2b2lkIGt2bWlfc29ja19zaHV0ZG93bihzdHJ1Y3Qg
a3ZtX2ludHJvc3BlY3Rpb24gKmt2bWkpOwogdm9pZCBrdm1pX3NvY2tfcHV0KHN0cnVjdCBrdm1f
aW50cm9zcGVjdGlvbiAqa3ZtaSk7CiBib29sIGt2bWlfbXNnX3Byb2Nlc3Moc3RydWN0IGt2bV9p
bnRyb3NwZWN0aW9uICprdm1pKTsKK2ludCBrdm1pX3NlbmRfZXZlbnQoc3RydWN0IGt2bV92Y3B1
ICp2Y3B1LCB1MzIgZXZfaWQsCisJCSAgICB2b2lkICpldiwgc2l6ZV90IGV2X3NpemUsCisJCSAg
ICB2b2lkICpycGwsIHNpemVfdCBycGxfc2l6ZSwgaW50ICphY3Rpb24pOwogaW50IGt2bWlfbXNn
X3NlbmRfdW5ob29rKHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSk7CiB1MzIga3ZtaV9t
c2dfc2VuZF92Y3B1X3BhdXNlKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiB1MzIga3ZtaV9tc2df
c2VuZF9oeXBlcmNhbGwoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsKQEAgLTgwLDYgKzg1LDggQEAg
dm9pZCBrdm1pX3J1bl9qb2JzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiB2b2lkIGt2bWlfcG9z
dF9yZXBseShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwogdm9pZCBrdm1pX2hhbmRsZV9jb21tb25f
ZXZlbnRfYWN0aW9ucyhzdHJ1Y3Qga3ZtICprdm0sCiAJCQkJICAgICAgdTMyIGFjdGlvbiwgY29u
c3QgY2hhciAqc3RyKTsKK3N0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqIF9fbXVzdF9jaGVjayBr
dm1pX2dldChzdHJ1Y3Qga3ZtICprdm0pOwordm9pZCBrdm1pX3B1dChzdHJ1Y3Qga3ZtICprdm0p
OwogaW50IGt2bWlfY21kX3ZtX2NvbnRyb2xfZXZlbnRzKHN0cnVjdCBrdm1faW50cm9zcGVjdGlv
biAqa3ZtaSwKIAkJCQl1bnNpZ25lZCBpbnQgZXZlbnRfaWQsIGJvb2wgZW5hYmxlKTsKIGludCBr
dm1pX2NtZF92Y3B1X2NvbnRyb2xfZXZlbnRzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKQEAgLTEx
Nyw1ICsxMjQsNyBAQCB2b2lkIGt2bWlfYXJjaF9oeXBlcmNhbGxfZXZlbnQoc3RydWN0IGt2bV92
Y3B1ICp2Y3B1KTsKIHZvaWQga3ZtaV9hcmNoX2JyZWFrcG9pbnRfZXZlbnQoc3RydWN0IGt2bV92
Y3B1ICp2Y3B1LCB1NjQgZ3ZhLCB1OCBpbnNuX2xlbik7CiBpbnQga3ZtaV9hcmNoX2NtZF9jb250
cm9sX2ludGVyY2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQkJICAgIHVuc2lnbmVkIGlu
dCBldmVudF9pZCwgYm9vbCBlbmFibGUpOworaW50IGt2bWlfYXJjaF9jbWRfdmNwdV9jb250cm9s
X2NyKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKKwkJCQkgIGNvbnN0IHN0cnVjdCBrdm1pX3ZjcHVf
Y29udHJvbF9jciAqcmVxKTsKIAogI2VuZGlmCmRpZmYgLS1naXQgYS92aXJ0L2t2bS9pbnRyb3Nw
ZWN0aW9uL2t2bWlfbXNnLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMKaW5k
ZXggNjc3NjJiYWEyODFhLi4zZjdiZTkyNTAyY2YgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2ludHJv
c3BlY3Rpb24va3ZtaV9tc2cuYworKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNn
LmMKQEAgLTI1LDYgKzI1LDcgQEAgc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0IG1zZ19JRHNbXSA9
IHsKIAlbS1ZNSV9WTV9HRVRfSU5GT10gICAgICAgICA9ICJLVk1JX1ZNX0dFVF9JTkZPIiwKIAlb
S1ZNSV9WTV9SRUFEX1BIWVNJQ0FMXSAgICA9ICJLVk1JX1ZNX1JFQURfUEhZU0lDQUwiLAogCVtL
Vk1JX1ZNX1dSSVRFX1BIWVNJQ0FMXSAgID0gIktWTUlfVk1fV1JJVEVfUEhZU0lDQUwiLAorCVtL
Vk1JX1ZDUFVfQ09OVFJPTF9DUl0gICAgID0gIktWTUlfVkNQVV9DT05UUk9MX0NSIiwKIAlbS1ZN
SV9WQ1BVX0NPTlRST0xfRVZFTlRTXSA9ICJLVk1JX1ZDUFVfQ09OVFJPTF9FVkVOVFMiLAogCVtL
Vk1JX1ZDUFVfR0VUX0NQVUlEXSAgICAgID0gIktWTUlfVkNQVV9HRVRfQ1BVSUQiLAogCVtLVk1J
X1ZDUFVfR0VUX0lORk9dICAgICAgID0gIktWTUlfVkNQVV9HRVRfSU5GTyIsCkBAIC00ODIsNiAr
NDgzLDE3IEBAIHN0YXRpYyBpbnQgaGFuZGxlX2dldF9jcHVpZChjb25zdCBzdHJ1Y3Qga3ZtaV92
Y3B1X2NtZF9qb2IgKmpvYiwKIAlyZXR1cm4ga3ZtaV9tc2dfdmNwdV9yZXBseShqb2IsIG1zZywg
ZWMsICZycGwsIHNpemVvZihycGwpKTsKIH0KIAorc3RhdGljIGludCBoYW5kbGVfdmNwdV9jb250
cm9sX2NyKGNvbnN0IHN0cnVjdCBrdm1pX3ZjcHVfY21kX2pvYiAqam9iLAorCQkJCSAgY29uc3Qg
c3RydWN0IGt2bWlfbXNnX2hkciAqbXNnLAorCQkJCSAgY29uc3Qgdm9pZCAqcmVxKQoreworCWlu
dCBlYzsKKworCWVjID0ga3ZtaV9hcmNoX2NtZF92Y3B1X2NvbnRyb2xfY3Ioam9iLT52Y3B1LCBy
ZXEpOworCisJcmV0dXJuIGt2bWlfbXNnX3ZjcHVfcmVwbHkoam9iLCBtc2csIGVjLCBOVUxMLCAw
KTsKK30KKwogLyoKICAqIFRoZXNlIGNvbW1hbmRzIGFyZSBleGVjdXRlZCBvbiB0aGUgdkNQVSB0
aHJlYWQuIFRoZSByZWNlaXZpbmcgdGhyZWFkCiAgKiBwYXNzZXMgdGhlIG1lc3NhZ2VzIHVzaW5n
IGEgbmV3bHkgYWxsb2NhdGVkICdzdHJ1Y3Qga3ZtaV92Y3B1X2NtZF9qb2InCkBAIC00OTEsNiAr
NTAzLDcgQEAgc3RhdGljIGludCBoYW5kbGVfZ2V0X2NwdWlkKGNvbnN0IHN0cnVjdCBrdm1pX3Zj
cHVfY21kX2pvYiAqam9iLAogc3RhdGljIGludCgqY29uc3QgbXNnX3ZjcHVbXSkoY29uc3Qgc3Ry
dWN0IGt2bWlfdmNwdV9jbWRfam9iICosCiAJCQkgICAgICBjb25zdCBzdHJ1Y3Qga3ZtaV9tc2df
aGRyICosIGNvbnN0IHZvaWQgKikgPSB7CiAJW0tWTUlfRVZFTlRfUkVQTFldICAgICAgICAgPSBo
YW5kbGVfZXZlbnRfcmVwbHksCisJW0tWTUlfVkNQVV9DT05UUk9MX0NSXSAgICAgPSBoYW5kbGVf
dmNwdV9jb250cm9sX2NyLAogCVtLVk1JX1ZDUFVfQ09OVFJPTF9FVkVOVFNdID0gaGFuZGxlX3Zj
cHVfY29udHJvbF9ldmVudHMsCiAJW0tWTUlfVkNQVV9HRVRfQ1BVSURdICAgICAgPSBoYW5kbGVf
Z2V0X2NwdWlkLAogCVtLVk1JX1ZDUFVfR0VUX0lORk9dICAgICAgID0gaGFuZGxlX2dldF92Y3B1
X2luZm8sCkBAIC04MDgsOSArODIxLDkgQEAgc3RhdGljIGludCBrdm1pX3dhaXRfZm9yX3JlcGx5
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IGt2
bWlfc2VuZF9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiBldl9pZCwKLQkJCSAgIHZv
aWQgKmV2LCBzaXplX3QgZXZfc2l6ZSwKLQkJCSAgIHZvaWQgKnJwbCwgc2l6ZV90IHJwbF9zaXpl
LCBpbnQgKmFjdGlvbikKK2ludCBrdm1pX3NlbmRfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1
LCB1MzIgZXZfaWQsCisJCSAgICB2b2lkICpldiwgc2l6ZV90IGV2X3NpemUsCisJCSAgICB2b2lk
ICpycGwsIHNpemVfdCBycGxfc2l6ZSwgaW50ICphY3Rpb24pCiB7CiAJc3RydWN0IGt2bWlfbXNn
X2hkciBoZHI7CiAJc3RydWN0IGt2bWlfZXZlbnQgY29tbW9uOwpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QK
VmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5s
aW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
