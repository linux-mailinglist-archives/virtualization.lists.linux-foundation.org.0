Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
	by mail.lfdr.de (Postfix) with ESMTPS id 826A6712073
	for <lists.virtualization@lfdr.de>; Fri, 26 May 2023 08:51:12 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id 8FF356F4EB;
	Fri, 26 May 2023 06:51:10 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 8FF356F4EB
Authentication-Results: smtp3.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=InzqZJI4
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id L-Y8oWoMYUUH; Fri, 26 May 2023 06:51:09 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp3.osuosl.org (Postfix) with ESMTPS id CD0FC6F4D5;
	Fri, 26 May 2023 06:51:08 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org CD0FC6F4D5
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 0F345C008C;
	Fri, 26 May 2023 06:51:08 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp4.osuosl.org (smtp4.osuosl.org [140.211.166.137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 052EFC002A
 for <virtualization@lists.linux-foundation.org>;
 Fri, 26 May 2023 06:51:07 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp4.osuosl.org (Postfix) with ESMTP id CBED0428C2
 for <virtualization@lists.linux-foundation.org>;
 Fri, 26 May 2023 06:51:06 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org CBED0428C2
Authentication-Results: smtp4.osuosl.org;
 dkim=pass (1024-bit key) header.d=redhat.com header.i=@redhat.com
 header.a=rsa-sha256 header.s=mimecast20190719 header.b=InzqZJI4
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
 by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id u3jjexAulpee
 for <virtualization@lists.linux-foundation.org>;
 Fri, 26 May 2023 06:51:05 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org 05CB5428C0
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.129.124])
 by smtp4.osuosl.org (Postfix) with ESMTPS id 05CB5428C0
 for <virtualization@lists.linux-foundation.org>;
 Fri, 26 May 2023 06:51:04 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1685083863;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=Xhx2rCHqgkzIwSk2Mgkh1NsxfWoR2K+4YkNE5CAJg7Q=;
 b=InzqZJI4hFs6MAKE9qGBqYoD8f7eba1sTQ1FT08+8fHdtqWkifIzDQkIjfuA5vbqlGqF9c
 CW4m2ZVnCuFwCi73E0X/74YGyvWXOFVV4EWhzGaaSO5Ge1z0v8Qg5t0vVnqcdwWUEL+ih9
 Zzi5HHniBnde8gI5i8tWjh+9AaGdhXA=
Received: from mail-lf1-f71.google.com (mail-lf1-f71.google.com
 [209.85.167.71]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-549-W8-ipiJ9OEasa_gwIKxV8Q-1; Fri, 26 May 2023 02:51:02 -0400
X-MC-Unique: W8-ipiJ9OEasa_gwIKxV8Q-1
Received: by mail-lf1-f71.google.com with SMTP id
 2adb3069b0e04-4f4e15ce850so185666e87.2
 for <virtualization@lists.linux-foundation.org>;
 Thu, 25 May 2023 23:51:02 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20221208; t=1685083861; x=1687675861;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=Xhx2rCHqgkzIwSk2Mgkh1NsxfWoR2K+4YkNE5CAJg7Q=;
 b=SIbXCnd5WhbQwvUgUcSC7qFH6YBPy/gxlvgZrFQoT0tgnoYG/vPkVpSHGof7IWNUpV
 o2AsnjJ8VALnPJas6VmfB9NTnWoOwCL7rVU67TClkgpaSHeou3bYtz5toW6bH8y1lOvw
 eKe0w8kBvuP/GfcfAB9D4uGWyODDBAev5F9Vp7M+8yKX+0zM0HObQ6g0QZKGJfIGy+yk
 LMeFQPV25ayPNSj1rfOnJlbcvQfjcLMEIKJSqfMI7neQeuYY0zF0JmY7+iXwKAE9uapn
 fS1gJjzW6oRIbudBzQeW2L6my9yDQTL1Kf+Bp8BLCR3PeY13x6oYVrck7WkcFue8esnK
 iZGg==
X-Gm-Message-State: AC+VfDxX093Ganxlbrea4ty8f/IJODfZxUlzkGPNlM87Pqglw4luSRzC
 miHoQFOAaMNIcbW/rWBnEDZJwt3HUav5VRb6jhp014VmIhgP6t6EwiZQVLQHZTZ+wsLCZdSdnlC
 QpcXA8zhwzCpYVHhoweopcvFm9QHIxg/Erdx55yc5bKJnPmZlsKGHoaXhyw==
X-Received: by 2002:a2e:9ed9:0:b0:2ad:d949:dd39 with SMTP id
 h25-20020a2e9ed9000000b002add949dd39mr531731ljk.29.1685083861079; 
 Thu, 25 May 2023 23:51:01 -0700 (PDT)
X-Google-Smtp-Source: ACHHUZ5TXz+ssrtDQcKywyFsZ9BVvx5MTuTUI3B+rZ2zU5vBT89yhV/tYOSJIUrGRNttF1bt7MfAoLf0tu8TrV0NZNI=
X-Received: by 2002:a2e:9ed9:0:b0:2ad:d949:dd39 with SMTP id
 h25-20020a2e9ed9000000b002add949dd39mr531724ljk.29.1685083860646; Thu, 25 May
 2023 23:51:00 -0700 (PDT)
MIME-Version: 1.0
References: <20230526054621.18371-1-liangchen.linux@gmail.com>
 <20230526054621.18371-2-liangchen.linux@gmail.com>
In-Reply-To: <20230526054621.18371-2-liangchen.linux@gmail.com>
From: Jason Wang <jasowang@redhat.com>
Date: Fri, 26 May 2023 14:50:49 +0800
Message-ID: <CACGkMEv+5150S4ooWFMnUs-GpwRYgRMTku0ZgkFpH5iFR1qQsw@mail.gmail.com>
Subject: Re: [PATCH net-next 2/5] virtio_net: Add page_pool support to improve
 performance
To: Liang Chen <liangchen.linux@gmail.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: xuanzhuo@linux.alibaba.com, mst@redhat.com, netdev@vger.kernel.org,
 linux-kernel@vger.kernel.org, alexander.duyck@gmail.com,
 virtualization@lists.linux-foundation.org, edumazet@google.com,
 kuba@kernel.org, pabeni@redhat.com, davem@davemloft.net
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gRnJpLCBNYXkgMjYsIDIwMjMgYXQgMTo0NuKAr1BNIExpYW5nIENoZW4gPGxpYW5nY2hlbi5s
aW51eEBnbWFpbC5jb20+IHdyb3RlOgo+Cj4gVGhlIGltcGxlbWVudGF0aW9uIGF0IHRoZSBtb21l
bnQgdXNlcyBvbmUgcGFnZSBwZXIgcGFja2V0IGluIGJvdGggdGhlCj4gbm9ybWFsIGFuZCBYRFAg
cGF0aC4KCkl0J3MgYmV0dGVyIHRvIGV4cGxhaW4gd2h5IHdlIG5lZWQgYSBwYWdlIHBvb2wgYW5k
IGhvdyBpdCBjYW4gaGVscCB0aGUKcGVyZm9ybWFuY2UuCgo+IEluIGFkZGl0aW9uLCBpbnRyb2R1
Y2luZyBhIG1vZHVsZSBwYXJhbWV0ZXIgdG8gZW5hYmxlCj4gb3IgZGlzYWJsZSB0aGUgdXNhZ2Ug
b2YgcGFnZSBwb29sIChkaXNhYmxlZCBieSBkZWZhdWx0KS4KCklmIHBhZ2UgcG9vbCB3aW5zIGZv
ciBtb3N0IG9mIHRoZSBjYXNlcywgYW55IHJlYXNvbiB0byBkaXNhYmxlIGl0IGJ5IGRlZmF1bHQ/
Cgo+Cj4gSW4gc2luZ2xlLWNvcmUgdm0gdGVzdGluZyBlbnZpcm9ubWVudHMsIGl0IGdpdmVzIGEg
bW9kZXN0IHBlcmZvcm1hbmNlIGdhaW4KPiBpbiB0aGUgbm9ybWFsIHBhdGguCj4gICBVcHN0cmVh
bSBjb2RlYmFzZTogNDcuNSBHYml0cy9zZWMKPiAgIFVwc3RyZWFtIGNvZGViYXNlICsgcGFnZV9w
b29sIHN1cHBvcnQ6IDUwLjIgR2JpdHMvc2VjCj4KPiBJbiBtdWx0aS1jb3JlIHZtIHRlc3Rpbmcg
ZW52aXJvbm1lbnRzLCBUaGUgbW9zdCBzaWduaWZpY2FudCBwZXJmb3JtYW5jZQo+IGdhaW4gaXMg
b2JzZXJ2ZWQgaW4gWERQIGNwdW1hcDoKPiAgIFVwc3RyZWFtIGNvZGViYXNlOiAxLjM4IEdiaXRz
L3NlYwo+ICAgVXBzdHJlYW0gY29kZWJhc2UgKyBwYWdlX3Bvb2wgc3VwcG9ydDogOS43NCBHYml0
cy9zZWMKClBsZWFzZSBzaG93IG1vcmUgZGV0YWlscyBvbiB0aGUgdGVzdC4gRS5nIHdoaWNoIGtp
bmRzIG9mIHRlc3RzIGhhdmUKeW91IG1lYXN1cmVkPwoKQnR3LCBpdCB3b3VsZCBiZSBiZXR0ZXIg
dG8gbWVhc3VyZSBQUFMgYXMgd2VsbC4KCj4KPiBXaXRoIHRoaXMgZm91bmRhdGlvbiwgd2UgY2Fu
IGZ1cnRoZXIgaW50ZWdyYXRlIHBhZ2UgcG9vbCBmcmFnbWVudGF0aW9uIGFuZAo+IERNQSBtYXAv
dW5tYXAgc3VwcG9ydC4KPgo+IFNpZ25lZC1vZmYtYnk6IExpYW5nIENoZW4gPGxpYW5nY2hlbi5s
aW51eEBnbWFpbC5jb20+Cj4gLS0tCj4gIGRyaXZlcnMvbmV0L3ZpcnRpb19uZXQuYyB8IDE4OCAr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0KCkkgYmVsaWV2ZSB3ZSBzaG91
bGQgbWFrZSB2aXJ0aW8tbmV0IHRvIHNlbGVjdCBDT05GSUdfUEFHRV9QT09MIG9yIGRvCnRoZSBp
ZmRlZiB0cmlja3MgYXQgbGVhc3QuCgo+ICAxIGZpbGUgY2hhbmdlZCwgMTQ2IGluc2VydGlvbnMo
KyksIDQyIGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvbmV0L3ZpcnRpb19u
ZXQuYyBiL2RyaXZlcnMvbmV0L3ZpcnRpb19uZXQuYwo+IGluZGV4IGM1ZGNhMGQ5MmU2NC4uOTlj
MGNhMGMxNzgxIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvbmV0L3ZpcnRpb19uZXQuYwo+ICsrKyBi
L2RyaXZlcnMvbmV0L3ZpcnRpb19uZXQuYwo+IEBAIC0zMSw2ICszMSw5IEBAIG1vZHVsZV9wYXJh
bShjc3VtLCBib29sLCAwNDQ0KTsKPiAgbW9kdWxlX3BhcmFtKGdzbywgYm9vbCwgMDQ0NCk7Cj4g
IG1vZHVsZV9wYXJhbShuYXBpX3R4LCBib29sLCAwNjQ0KTsKPgo+ICtzdGF0aWMgYm9vbCBwYWdl
X3Bvb2xfZW5hYmxlZDsKPiArbW9kdWxlX3BhcmFtKHBhZ2VfcG9vbF9lbmFibGVkLCBib29sLCAw
NDAwKTsKPiArCj4gIC8qIEZJWE1FOiBNVFUgaW4gY29uZmlnLiAqLwo+ICAjZGVmaW5lIEdPT0Rf
UEFDS0VUX0xFTiAoRVRIX0hMRU4gKyBWTEFOX0hMRU4gKyBFVEhfREFUQV9MRU4pCj4gICNkZWZp
bmUgR09PRF9DT1BZX0xFTiAgMTI4Cj4gQEAgLTE1OSw2ICsxNjIsOSBAQCBzdHJ1Y3QgcmVjZWl2
ZV9xdWV1ZSB7Cj4gICAgICAgICAvKiBDaGFpbiBwYWdlcyBieSB0aGUgcHJpdmF0ZSBwdHIuICov
Cj4gICAgICAgICBzdHJ1Y3QgcGFnZSAqcGFnZXM7Cj4KPiArICAgICAgIC8qIFBhZ2UgcG9vbCAq
Lwo+ICsgICAgICAgc3RydWN0IHBhZ2VfcG9vbCAqcGFnZV9wb29sOwo+ICsKPiAgICAgICAgIC8q
IEF2ZXJhZ2UgcGFja2V0IGxlbmd0aCBmb3IgbWVyZ2VhYmxlIHJlY2VpdmUgYnVmZmVycy4gKi8K
PiAgICAgICAgIHN0cnVjdCBld21hX3BrdF9sZW4gbXJnX2F2Z19wa3RfbGVuOwo+Cj4gQEAgLTQ1
OSw2ICs0NjUsMTQgQEAgc3RhdGljIHN0cnVjdCBza19idWZmICp2aXJ0bmV0X2J1aWxkX3NrYih2
b2lkICpidWYsIHVuc2lnbmVkIGludCBidWZsZW4sCj4gICAgICAgICByZXR1cm4gc2tiOwo+ICB9
Cj4KPiArc3RhdGljIHZvaWQgdmlydG5ldF9wdXRfcGFnZShzdHJ1Y3QgcmVjZWl2ZV9xdWV1ZSAq
cnEsIHN0cnVjdCBwYWdlICpwYWdlKQo+ICt7Cj4gKyAgICAgICBpZiAocnEtPnBhZ2VfcG9vbCkK
PiArICAgICAgICAgICAgICAgcGFnZV9wb29sX3B1dF9mdWxsX3BhZ2UocnEtPnBhZ2VfcG9vbCwg
cGFnZSwgdHJ1ZSk7Cj4gKyAgICAgICBlbHNlCj4gKyAgICAgICAgICAgICAgIHB1dF9wYWdlKHBh
Z2UpOwo+ICt9Cj4gKwo+ICAvKiBDYWxsZWQgZnJvbSBib3R0b20gaGFsZiBjb250ZXh0ICovCj4g
IHN0YXRpYyBzdHJ1Y3Qgc2tfYnVmZiAqcGFnZV90b19za2Ioc3RydWN0IHZpcnRuZXRfaW5mbyAq
dmksCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgcmVjZWl2ZV9x
dWV1ZSAqcnEsCj4gQEAgLTU1NSw3ICs1NjksNyBAQCBzdGF0aWMgc3RydWN0IHNrX2J1ZmYgKnBh
Z2VfdG9fc2tiKHN0cnVjdCB2aXJ0bmV0X2luZm8gKnZpLAo+ICAgICAgICAgaGRyID0gc2tiX3Zu
ZXRfaGRyKHNrYik7Cj4gICAgICAgICBtZW1jcHkoaGRyLCBoZHJfcCwgaGRyX2xlbik7Cj4gICAg
ICAgICBpZiAocGFnZV90b19mcmVlKQo+IC0gICAgICAgICAgICAgICBwdXRfcGFnZShwYWdlX3Rv
X2ZyZWUpOwo+ICsgICAgICAgICAgICAgICB2aXJ0bmV0X3B1dF9wYWdlKHJxLCBwYWdlX3RvX2Zy
ZWUpOwo+Cj4gICAgICAgICByZXR1cm4gc2tiOwo+ICB9Cj4gQEAgLTgwMiw3ICs4MTYsNyBAQCBz
dGF0aWMgaW50IHZpcnRuZXRfeGRwX3htaXQoc3RydWN0IG5ldF9kZXZpY2UgKmRldiwKPiAgICAg
ICAgIHJldHVybiByZXQ7Cj4gIH0KPgo+IC1zdGF0aWMgdm9pZCBwdXRfeGRwX2ZyYWdzKHN0cnVj
dCB4ZHBfYnVmZiAqeGRwKQo+ICtzdGF0aWMgdm9pZCBwdXRfeGRwX2ZyYWdzKHN0cnVjdCB4ZHBf
YnVmZiAqeGRwLCBzdHJ1Y3QgcmVjZWl2ZV9xdWV1ZSAqcnEpCj4gIHsKCnJxIGNvdWxkIGJlIGZl
dGNoZWQgZnJvbSB4ZHBfcnhxX2luZm8/Cgo+ICAgICAgICAgc3RydWN0IHNrYl9zaGFyZWRfaW5m
byAqc2hpbmZvOwo+ICAgICAgICAgc3RydWN0IHBhZ2UgKnhkcF9wYWdlOwo+IEBAIC04MTIsNyAr
ODI2LDcgQEAgc3RhdGljIHZvaWQgcHV0X3hkcF9mcmFncyhzdHJ1Y3QgeGRwX2J1ZmYgKnhkcCkK
PiAgICAgICAgICAgICAgICAgc2hpbmZvID0geGRwX2dldF9zaGFyZWRfaW5mb19mcm9tX2J1ZmYo
eGRwKTsKPiAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNoaW5mby0+bnJfZnJhZ3M7
IGkrKykgewo+ICAgICAgICAgICAgICAgICAgICAgICAgIHhkcF9wYWdlID0gc2tiX2ZyYWdfcGFn
ZSgmc2hpbmZvLT5mcmFnc1tpXSk7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgcHV0X3BhZ2Uo
eGRwX3BhZ2UpOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIHZpcnRuZXRfcHV0X3BhZ2UocnEs
IHhkcF9wYWdlKTsKPiAgICAgICAgICAgICAgICAgfQo+ICAgICAgICAgfQo+ICB9Cj4gQEAgLTkw
Myw3ICs5MTcsMTEgQEAgc3RhdGljIHN0cnVjdCBwYWdlICp4ZHBfbGluZWFyaXplX3BhZ2Uoc3Ry
dWN0IHJlY2VpdmVfcXVldWUgKnJxLAo+ICAgICAgICAgaWYgKHBhZ2Vfb2ZmICsgKmxlbiArIHRh
aWxyb29tID4gUEFHRV9TSVpFKQo+ICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKPgo+IC0g
ICAgICAgcGFnZSA9IGFsbG9jX3BhZ2UoR0ZQX0FUT01JQyk7Cj4gKyAgICAgICBpZiAocnEtPnBh
Z2VfcG9vbCkKPiArICAgICAgICAgICAgICAgcGFnZSA9IHBhZ2VfcG9vbF9kZXZfYWxsb2NfcGFn
ZXMocnEtPnBhZ2VfcG9vbCk7Cj4gKyAgICAgICBlbHNlCj4gKyAgICAgICAgICAgICAgIHBhZ2Ug
PSBhbGxvY19wYWdlKEdGUF9BVE9NSUMpOwo+ICsKPiAgICAgICAgIGlmICghcGFnZSkKPiAgICAg
ICAgICAgICAgICAgcmV0dXJuIE5VTEw7Cj4KPiBAQCAtOTI2LDIxICs5NDQsMjQgQEAgc3RhdGlj
IHN0cnVjdCBwYWdlICp4ZHBfbGluZWFyaXplX3BhZ2Uoc3RydWN0IHJlY2VpdmVfcXVldWUgKnJx
LAo+ICAgICAgICAgICAgICAgICAgKiBpcyBzZW5kaW5nIHBhY2tldCBsYXJnZXIgdGhhbiB0aGUg
TVRVLgo+ICAgICAgICAgICAgICAgICAgKi8KPiAgICAgICAgICAgICAgICAgaWYgKChwYWdlX29m
ZiArIGJ1ZmxlbiArIHRhaWxyb29tKSA+IFBBR0VfU0laRSkgewo+IC0gICAgICAgICAgICAgICAg
ICAgICAgIHB1dF9wYWdlKHApOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIHZpcnRuZXRfcHV0
X3BhZ2UocnEsIHApOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZXJyX2J1ZjsKPiAg
ICAgICAgICAgICAgICAgfQo+Cj4gICAgICAgICAgICAgICAgIG1lbWNweShwYWdlX2FkZHJlc3Mo
cGFnZSkgKyBwYWdlX29mZiwKPiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VfYWRkcmVzcyhw
KSArIG9mZiwgYnVmbGVuKTsKPiAgICAgICAgICAgICAgICAgcGFnZV9vZmYgKz0gYnVmbGVuOwo+
IC0gICAgICAgICAgICAgICBwdXRfcGFnZShwKTsKPiArICAgICAgICAgICAgICAgdmlydG5ldF9w
dXRfcGFnZShycSwgcCk7Cj4gICAgICAgICB9Cj4KPiAgICAgICAgIC8qIEhlYWRyb29tIGRvZXMg
bm90IGNvbnRyaWJ1dGUgdG8gcGFja2V0IGxlbmd0aCAqLwo+ICAgICAgICAgKmxlbiA9IHBhZ2Vf
b2ZmIC0gVklSVElPX1hEUF9IRUFEUk9PTTsKPiAgICAgICAgIHJldHVybiBwYWdlOwo+ICBlcnJf
YnVmOgo+IC0gICAgICAgX19mcmVlX3BhZ2VzKHBhZ2UsIDApOwo+ICsgICAgICAgaWYgKHJxLT5w
YWdlX3Bvb2wpCj4gKyAgICAgICAgICAgICAgIHBhZ2VfcG9vbF9wdXRfZnVsbF9wYWdlKHJxLT5w
YWdlX3Bvb2wsIHBhZ2UsIHRydWUpOwo+ICsgICAgICAgZWxzZQo+ICsgICAgICAgICAgICAgICBf
X2ZyZWVfcGFnZXMocGFnZSwgMCk7Cj4gICAgICAgICByZXR1cm4gTlVMTDsKPiAgfQo+Cj4gQEAg
LTExNDQsNyArMTE2NSw3IEBAIHN0YXRpYyB2b2lkIG1lcmdlYWJsZV9idWZfZnJlZShzdHJ1Y3Qg
cmVjZWl2ZV9xdWV1ZSAqcnEsIGludCBudW1fYnVmLAo+ICAgICAgICAgICAgICAgICB9Cj4gICAg
ICAgICAgICAgICAgIHN0YXRzLT5ieXRlcyArPSBsZW47Cj4gICAgICAgICAgICAgICAgIHBhZ2Ug
PSB2aXJ0X3RvX2hlYWRfcGFnZShidWYpOwo+IC0gICAgICAgICAgICAgICBwdXRfcGFnZShwYWdl
KTsKPiArICAgICAgICAgICAgICAgdmlydG5ldF9wdXRfcGFnZShycSwgcGFnZSk7Cj4gICAgICAg
ICB9Cj4gIH0KPgo+IEBAIC0xMjY0LDcgKzEyODUsNyBAQCBzdGF0aWMgaW50IHZpcnRuZXRfYnVp
bGRfeGRwX2J1ZmZfbXJnKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAg
IGN1cl9mcmFnX3NpemUgPSB0cnVlc2l6ZTsKPiAgICAgICAgICAgICAgICAgeGRwX2ZyYWdzX3Ry
dWVzeiArPSBjdXJfZnJhZ19zaXplOwo+ICAgICAgICAgICAgICAgICBpZiAodW5saWtlbHkobGVu
ID4gdHJ1ZXNpemUgLSByb29tIHx8IGN1cl9mcmFnX3NpemUgPiBQQUdFX1NJWkUpKSB7Cj4gLSAg
ICAgICAgICAgICAgICAgICAgICAgcHV0X3BhZ2UocGFnZSk7Cj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgdmlydG5ldF9wdXRfcGFnZShycSwgcGFnZSk7Cj4gICAgICAgICAgICAgICAgICAgICAg
ICAgcHJfZGVidWcoIiVzOiByeCBlcnJvcjogbGVuICV1IGV4Y2VlZHMgdHJ1ZXNpemUgJWx1XG4i
LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+bmFtZSwgbGVuLCAodW5z
aWduZWQgbG9uZykodHJ1ZXNpemUgLSByb29tKSk7Cj4gICAgICAgICAgICAgICAgICAgICAgICAg
ZGV2LT5zdGF0cy5yeF9sZW5ndGhfZXJyb3JzKys7Cj4gQEAgLTEyODMsNyArMTMwNCw3IEBAIHN0
YXRpYyBpbnQgdmlydG5ldF9idWlsZF94ZHBfYnVmZl9tcmcoc3RydWN0IG5ldF9kZXZpY2UgKmRl
diwKPiAgICAgICAgIHJldHVybiAwOwo+Cj4gIGVycjoKPiAtICAgICAgIHB1dF94ZHBfZnJhZ3Mo
eGRwKTsKPiArICAgICAgIHB1dF94ZHBfZnJhZ3MoeGRwLCBycSk7Cj4gICAgICAgICByZXR1cm4g
LUVJTlZBTDsKPiAgfQo+Cj4gQEAgLTEzNDQsNyArMTM2NSwxMCBAQCBzdGF0aWMgdm9pZCAqbWVy
Z2VhYmxlX3hkcF9nZXRfYnVmKHN0cnVjdCB2aXJ0bmV0X2luZm8gKnZpLAo+ICAgICAgICAgICAg
ICAgICBpZiAoKmxlbiArIHhkcF9yb29tID4gUEFHRV9TSVpFKQo+ICAgICAgICAgICAgICAgICAg
ICAgICAgIHJldHVybiBOVUxMOwo+Cj4gLSAgICAgICAgICAgICAgIHhkcF9wYWdlID0gYWxsb2Nf
cGFnZShHRlBfQVRPTUlDKTsKPiArICAgICAgICAgICAgICAgaWYgKHJxLT5wYWdlX3Bvb2wpCj4g
KyAgICAgICAgICAgICAgICAgICAgICAgeGRwX3BhZ2UgPSBwYWdlX3Bvb2xfZGV2X2FsbG9jX3Bh
Z2VzKHJxLT5wYWdlX3Bvb2wpOwo+ICsgICAgICAgICAgICAgICBlbHNlCj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgeGRwX3BhZ2UgPSBhbGxvY19wYWdlKEdGUF9BVE9NSUMpOwo+ICAgICAgICAg
ICAgICAgICBpZiAoIXhkcF9wYWdlKQo+ICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBO
VUxMOwo+Cj4gQEAgLTEzNTQsNyArMTM3OCw3IEBAIHN0YXRpYyB2b2lkICptZXJnZWFibGVfeGRw
X2dldF9idWYoc3RydWN0IHZpcnRuZXRfaW5mbyAqdmksCj4KPiAgICAgICAgICpmcmFtZV9zeiA9
IFBBR0VfU0laRTsKPgo+IC0gICAgICAgcHV0X3BhZ2UoKnBhZ2UpOwo+ICsgICAgICAgdmlydG5l
dF9wdXRfcGFnZShycSwgKnBhZ2UpOwo+Cj4gICAgICAgICAqcGFnZSA9IHhkcF9wYWdlOwo+Cj4g
QEAgLTE0MDAsNiArMTQyNCw4IEBAIHN0YXRpYyBzdHJ1Y3Qgc2tfYnVmZiAqcmVjZWl2ZV9tZXJn
ZWFibGVfeGRwKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgIGhlYWRf
c2tiID0gYnVpbGRfc2tiX2Zyb21feGRwX2J1ZmYoZGV2LCB2aSwgJnhkcCwgeGRwX2ZyYWdzX3Ry
dWVzeik7Cj4gICAgICAgICAgICAgICAgIGlmICh1bmxpa2VseSghaGVhZF9za2IpKQo+ICAgICAg
ICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+ICsgICAgICAgICAgICAgICBpZiAocnEtPnBhZ2Vf
cG9vbCkKPiArICAgICAgICAgICAgICAgICAgICAgICBza2JfbWFya19mb3JfcmVjeWNsZShoZWFk
X3NrYik7Cj4gICAgICAgICAgICAgICAgIHJldHVybiBoZWFkX3NrYjsKPgo+ICAgICAgICAgY2Fz
ZSBYRFBfVFg6Cj4gQEAgLTE0MTAsMTAgKzE0MzYsMTAgQEAgc3RhdGljIHN0cnVjdCBza19idWZm
ICpyZWNlaXZlX21lcmdlYWJsZV94ZHAoc3RydWN0IG5ldF9kZXZpY2UgKmRldiwKPiAgICAgICAg
ICAgICAgICAgYnJlYWs7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIHB1dF94ZHBfZnJhZ3MoJnhk
cCk7Cj4gKyAgICAgICBwdXRfeGRwX2ZyYWdzKCZ4ZHAsIHJxKTsKPgo+ICBlcnJfeGRwOgo+IC0g
ICAgICAgcHV0X3BhZ2UocGFnZSk7Cj4gKyAgICAgICB2aXJ0bmV0X3B1dF9wYWdlKHJxLCBwYWdl
KTsKPiAgICAgICAgIG1lcmdlYWJsZV9idWZfZnJlZShycSwgbnVtX2J1ZiwgZGV2LCBzdGF0cyk7
Cj4KPiAgICAgICAgIHN0YXRzLT54ZHBfZHJvcHMrKzsKPiBAQCAtMTQ2Nyw2ICsxNDkzLDkgQEAg
c3RhdGljIHN0cnVjdCBza19idWZmICpyZWNlaXZlX21lcmdlYWJsZShzdHJ1Y3QgbmV0X2Rldmlj
ZSAqZGV2LAo+ICAgICAgICAgaGVhZF9za2IgPSBwYWdlX3RvX3NrYih2aSwgcnEsIHBhZ2UsIG9m
ZnNldCwgbGVuLCB0cnVlc2l6ZSwgaGVhZHJvb20pOwo+ICAgICAgICAgY3Vycl9za2IgPSBoZWFk
X3NrYjsKPgo+ICsgICAgICAgaWYgKHJxLT5wYWdlX3Bvb2wpCj4gKyAgICAgICAgICAgICAgIHNr
Yl9tYXJrX2Zvcl9yZWN5Y2xlKGN1cnJfc2tiKTsKPiArCj4gICAgICAgICBpZiAodW5saWtlbHko
IWN1cnJfc2tiKSkKPiAgICAgICAgICAgICAgICAgZ290byBlcnJfc2tiOwo+ICAgICAgICAgd2hp
bGUgKC0tbnVtX2J1Zikgewo+IEBAIC0xNTA5LDYgKzE1MzgsOCBAQCBzdGF0aWMgc3RydWN0IHNr
X2J1ZmYgKnJlY2VpdmVfbWVyZ2VhYmxlKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCj4gICAgICAg
ICAgICAgICAgICAgICAgICAgY3Vycl9za2IgPSBuc2tiOwo+ICAgICAgICAgICAgICAgICAgICAg
ICAgIGhlYWRfc2tiLT50cnVlc2l6ZSArPSBuc2tiLT50cnVlc2l6ZTsKPiAgICAgICAgICAgICAg
ICAgICAgICAgICBudW1fc2tiX2ZyYWdzID0gMDsKPiArICAgICAgICAgICAgICAgICAgICAgICBp
ZiAocnEtPnBhZ2VfcG9vbCkKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNrYl9t
YXJrX2Zvcl9yZWN5Y2xlKGN1cnJfc2tiKTsKPiAgICAgICAgICAgICAgICAgfQo+ICAgICAgICAg
ICAgICAgICBpZiAoY3Vycl9za2IgIT0gaGVhZF9za2IpIHsKPiAgICAgICAgICAgICAgICAgICAg
ICAgICBoZWFkX3NrYi0+ZGF0YV9sZW4gKz0gbGVuOwo+IEBAIC0xNTE3LDcgKzE1NDgsNyBAQCBz
dGF0aWMgc3RydWN0IHNrX2J1ZmYgKnJlY2VpdmVfbWVyZ2VhYmxlKHN0cnVjdCBuZXRfZGV2aWNl
ICpkZXYsCj4gICAgICAgICAgICAgICAgIH0KPiAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gYnVm
IC0gcGFnZV9hZGRyZXNzKHBhZ2UpOwo+ICAgICAgICAgICAgICAgICBpZiAoc2tiX2Nhbl9jb2Fs
ZXNjZShjdXJyX3NrYiwgbnVtX3NrYl9mcmFncywgcGFnZSwgb2Zmc2V0KSkgewo+IC0gICAgICAg
ICAgICAgICAgICAgICAgIHB1dF9wYWdlKHBhZ2UpOwo+ICsgICAgICAgICAgICAgICAgICAgICAg
IHZpcnRuZXRfcHV0X3BhZ2UocnEsIHBhZ2UpOwoKSSB3b25kZXIgd2h5IG5vdCB3ZSBjYW4ndCBk
byB0aGlzIGR1cmluZyBidWZmZXIgYWxsb2NhdGlvbiBsaWtlIG90aGVyIGRyaXZlcnM/Cgo+ICAg
ICAgICAgICAgICAgICAgICAgICAgIHNrYl9jb2FsZXNjZV9yeF9mcmFnKGN1cnJfc2tiLCBudW1f
c2tiX2ZyYWdzIC0gMSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBsZW4sIHRydWVzaXplKTsKPiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKPiBAQCAtMTUz
MCw3ICsxNTYxLDcgQEAgc3RhdGljIHN0cnVjdCBza19idWZmICpyZWNlaXZlX21lcmdlYWJsZShz
dHJ1Y3QgbmV0X2RldmljZSAqZGV2LAo+ICAgICAgICAgcmV0dXJuIGhlYWRfc2tiOwo+Cj4gIGVy
cl9za2I6Cj4gLSAgICAgICBwdXRfcGFnZShwYWdlKTsKPiArICAgICAgIHZpcnRuZXRfcHV0X3Bh
Z2UocnEsIHBhZ2UpOwo+ICAgICAgICAgbWVyZ2VhYmxlX2J1Zl9mcmVlKHJxLCBudW1fYnVmLCBk
ZXYsIHN0YXRzKTsKPgo+ICBlcnJfYnVmOgo+IEBAIC0xNzM3LDMxICsxNzY4LDQwIEBAIHN0YXRp
YyBpbnQgYWRkX3JlY3ZidWZfbWVyZ2VhYmxlKHN0cnVjdCB2aXJ0bmV0X2luZm8gKnZpLAo+ICAg
ICAgICAgICogZGlzYWJsZWQgR1NPIGZvciBYRFAsIGl0IHdvbid0IGJlIGEgYmlnIGlzc3VlLgo+
ICAgICAgICAgICovCj4gICAgICAgICBsZW4gPSBnZXRfbWVyZ2VhYmxlX2J1Zl9sZW4ocnEsICZy
cS0+bXJnX2F2Z19wa3RfbGVuLCByb29tKTsKPiAtICAgICAgIGlmICh1bmxpa2VseSghc2tiX3Bh
Z2VfZnJhZ19yZWZpbGwobGVuICsgcm9vbSwgYWxsb2NfZnJhZywgZ2ZwKSkpCj4gLSAgICAgICAg
ICAgICAgIHJldHVybiAtRU5PTUVNOwo+ICsgICAgICAgaWYgKHJxLT5wYWdlX3Bvb2wpIHsKPiAr
ICAgICAgICAgICAgICAgc3RydWN0IHBhZ2UgKnBhZ2U7Cj4KPiAtICAgICAgIGJ1ZiA9IChjaGFy
ICopcGFnZV9hZGRyZXNzKGFsbG9jX2ZyYWctPnBhZ2UpICsgYWxsb2NfZnJhZy0+b2Zmc2V0Owo+
IC0gICAgICAgYnVmICs9IGhlYWRyb29tOyAvKiBhZHZhbmNlIGFkZHJlc3MgbGVhdmluZyBob2xl
IGF0IGZyb250IG9mIHBrdCAqLwo+IC0gICAgICAgZ2V0X3BhZ2UoYWxsb2NfZnJhZy0+cGFnZSk7
Cj4gLSAgICAgICBhbGxvY19mcmFnLT5vZmZzZXQgKz0gbGVuICsgcm9vbTsKPiAtICAgICAgIGhv
bGUgPSBhbGxvY19mcmFnLT5zaXplIC0gYWxsb2NfZnJhZy0+b2Zmc2V0Owo+IC0gICAgICAgaWYg
KGhvbGUgPCBsZW4gKyByb29tKSB7Cj4gLSAgICAgICAgICAgICAgIC8qIFRvIGF2b2lkIGludGVy
bmFsIGZyYWdtZW50YXRpb24sIGlmIHRoZXJlIGlzIHZlcnkgbGlrZWx5IG5vdAo+IC0gICAgICAg
ICAgICAgICAgKiBlbm91Z2ggc3BhY2UgZm9yIGFub3RoZXIgYnVmZmVyLCBhZGQgdGhlIHJlbWFp
bmluZyBzcGFjZSB0bwo+IC0gICAgICAgICAgICAgICAgKiB0aGUgY3VycmVudCBidWZmZXIuCj4g
LSAgICAgICAgICAgICAgICAqIFhEUCBjb3JlIGFzc3VtZXMgdGhhdCBmcmFtZV9zaXplIG9mIHhk
cF9idWZmIGFuZCB0aGUgbGVuZ3RoCj4gLSAgICAgICAgICAgICAgICAqIG9mIHRoZSBmcmFnIGFy
ZSBQQUdFX1NJWkUsIHNvIHdlIGRpc2FibGUgdGhlIGhvbGUgbWVjaGFuaXNtLgo+IC0gICAgICAg
ICAgICAgICAgKi8KPiAtICAgICAgICAgICAgICAgaWYgKCFoZWFkcm9vbSkKPiAtICAgICAgICAg
ICAgICAgICAgICAgICBsZW4gKz0gaG9sZTsKPiAtICAgICAgICAgICAgICAgYWxsb2NfZnJhZy0+
b2Zmc2V0ICs9IGhvbGU7Cj4gLSAgICAgICB9Cj4gKyAgICAgICAgICAgICAgIHBhZ2UgPSBwYWdl
X3Bvb2xfZGV2X2FsbG9jX3BhZ2VzKHJxLT5wYWdlX3Bvb2wpOwo+ICsgICAgICAgICAgICAgICBp
ZiAodW5saWtlbHkoIXBhZ2UpKQo+ICsgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtRU5P
TUVNOwo+ICsgICAgICAgICAgICAgICBidWYgPSAoY2hhciAqKXBhZ2VfYWRkcmVzcyhwYWdlKTsK
PiArICAgICAgICAgICAgICAgYnVmICs9IGhlYWRyb29tOyAvKiBhZHZhbmNlIGFkZHJlc3MgbGVh
dmluZyBob2xlIGF0IGZyb250IG9mIHBrdCAqLwo+ICsgICAgICAgfSBlbHNlIHsKPiArICAgICAg
ICAgICAgICAgaWYgKHVubGlrZWx5KCFza2JfcGFnZV9mcmFnX3JlZmlsbChsZW4gKyByb29tLCBh
bGxvY19mcmFnLCBnZnApKSkKCldoeSBub3Qgc2ltcGx5IHVzZSBhIGhlbHBlciBsaWtlIHZpcnRu
ZXRfcGFnZV9mcmFnX3JlZmlsbCgpIGFuZCBhZGQKdGhlIHBhZ2VfcG9vbCBhbGxvY2F0aW9uIGxv
Z2ljIHRoZXJlPyBJdCBoZWxwcyB0byByZWR1Y2UgdGhlCmNoYW5nZXNldC4KCj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9NRU07Cj4KPiArICAgICAgICAgICAgICAgYnVmID0g
KGNoYXIgKilwYWdlX2FkZHJlc3MoYWxsb2NfZnJhZy0+cGFnZSkgKyBhbGxvY19mcmFnLT5vZmZz
ZXQ7Cj4gKyAgICAgICAgICAgICAgIGJ1ZiArPSBoZWFkcm9vbTsgLyogYWR2YW5jZSBhZGRyZXNz
IGxlYXZpbmcgaG9sZSBhdCBmcm9udCBvZiBwa3QgKi8KPiArICAgICAgICAgICAgICAgZ2V0X3Bh
Z2UoYWxsb2NfZnJhZy0+cGFnZSk7Cj4gKyAgICAgICAgICAgICAgIGFsbG9jX2ZyYWctPm9mZnNl
dCArPSBsZW4gKyByb29tOwo+ICsgICAgICAgICAgICAgICBob2xlID0gYWxsb2NfZnJhZy0+c2l6
ZSAtIGFsbG9jX2ZyYWctPm9mZnNldDsKPiArICAgICAgICAgICAgICAgaWYgKGhvbGUgPCBsZW4g
KyByb29tKSB7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgLyogVG8gYXZvaWQgaW50ZXJuYWwg
ZnJhZ21lbnRhdGlvbiwgaWYgdGhlcmUgaXMgdmVyeSBsaWtlbHkgbm90Cj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgICogZW5vdWdoIHNwYWNlIGZvciBhbm90aGVyIGJ1ZmZlciwgYWRkIHRoZSBy
ZW1haW5pbmcgc3BhY2UgdG8KPiArICAgICAgICAgICAgICAgICAgICAgICAgKiB0aGUgY3VycmVu
dCBidWZmZXIuCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICogWERQIGNvcmUgYXNzdW1lcyB0
aGF0IGZyYW1lX3NpemUgb2YgeGRwX2J1ZmYgYW5kIHRoZSBsZW5ndGgKPiArICAgICAgICAgICAg
ICAgICAgICAgICAgKiBvZiB0aGUgZnJhZyBhcmUgUEFHRV9TSVpFLCBzbyB3ZSBkaXNhYmxlIHRo
ZSBob2xlIG1lY2hhbmlzbS4KPiArICAgICAgICAgICAgICAgICAgICAgICAgKi8KPiArICAgICAg
ICAgICAgICAgICAgICAgICBpZiAoIWhlYWRyb29tKQo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbGVuICs9IGhvbGU7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgYWxsb2NfZnJh
Zy0+b2Zmc2V0ICs9IGhvbGU7Cj4gKyAgICAgICAgICAgICAgIH0KPiArICAgICAgIH0KPiAgICAg
ICAgIHNnX2luaXRfb25lKHJxLT5zZywgYnVmLCBsZW4pOwo+ICAgICAgICAgY3R4ID0gbWVyZ2Vh
YmxlX2xlbl90b19jdHgobGVuICsgcm9vbSwgaGVhZHJvb20pOwo+ICAgICAgICAgZXJyID0gdmly
dHF1ZXVlX2FkZF9pbmJ1Zl9jdHgocnEtPnZxLCBycS0+c2csIDEsIGJ1ZiwgY3R4LCBnZnApOwo+
ICAgICAgICAgaWYgKGVyciA8IDApCj4gLSAgICAgICAgICAgICAgIHB1dF9wYWdlKHZpcnRfdG9f
aGVhZF9wYWdlKGJ1ZikpOwo+ICsgICAgICAgICAgICAgICB2aXJ0bmV0X3B1dF9wYWdlKHJxLCB2
aXJ0X3RvX2hlYWRfcGFnZShidWYpKTsKPgo+ICAgICAgICAgcmV0dXJuIGVycjsKPiAgfQo+IEBA
IC0xOTk0LDggKzIwMzQsMTUgQEAgc3RhdGljIGludCB2aXJ0bmV0X2VuYWJsZV9xdWV1ZV9wYWly
KHN0cnVjdCB2aXJ0bmV0X2luZm8gKnZpLCBpbnQgcXBfaW5kZXgpCj4gICAgICAgICBpZiAoZXJy
IDwgMCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIGVycjsKPgo+IC0gICAgICAgZXJyID0geGRw
X3J4cV9pbmZvX3JlZ19tZW1fbW9kZWwoJnZpLT5ycVtxcF9pbmRleF0ueGRwX3J4cSwKPiAtICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1FTV9UWVBFX1BBR0VfU0hBUkVE
LCBOVUxMKTsKPiArICAgICAgIGlmICh2aS0+cnFbcXBfaW5kZXhdLnBhZ2VfcG9vbCkKPiArICAg
ICAgICAgICAgICAgZXJyID0geGRwX3J4cV9pbmZvX3JlZ19tZW1fbW9kZWwoJnZpLT5ycVtxcF9p
bmRleF0ueGRwX3J4cSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgTUVNX1RZUEVfUEFHRV9QT09MLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2aS0+cnFbcXBfaW5kZXhdLnBhZ2VfcG9vbCk7Cj4gKyAg
ICAgICBlbHNlCj4gKyAgICAgICAgICAgICAgIGVyciA9IHhkcF9yeHFfaW5mb19yZWdfbWVtX21v
ZGVsKCZ2aS0+cnFbcXBfaW5kZXhdLnhkcF9yeHEsCj4gKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIE1FTV9UWVBFX1BBR0VfU0hBUkVELAo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxMKTsKPiArCj4gICAg
ICAgICBpZiAoZXJyIDwgMCkKPiAgICAgICAgICAgICAgICAgZ290byBlcnJfeGRwX3JlZ19tZW1f
bW9kZWw7Cj4KPiBAQCAtMjk1MSw2ICsyOTk4LDcgQEAgc3RhdGljIHZvaWQgdmlydG5ldF9nZXRf
c3RyaW5ncyhzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LCB1MzIgc3RyaW5nc2V0LCB1OCAqZGF0YSkK
PiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV0aHRvb2xfc3ByaW50ZigmcCwgInR4
X3F1ZXVlXyV1XyVzIiwgaSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB2aXJ0bmV0X3NxX3N0YXRzX2Rlc2Nbal0uZGVzYyk7Cj4gICAgICAgICAgICAg
ICAgIH0KPiArICAgICAgICAgICAgICAgcGFnZV9wb29sX2V0aHRvb2xfc3RhdHNfZ2V0X3N0cmlu
Z3MocCk7Cj4gICAgICAgICAgICAgICAgIGJyZWFrOwo+ICAgICAgICAgfQo+ICB9Cj4gQEAgLTI5
NjIsMTIgKzMwMTAsMzAgQEAgc3RhdGljIGludCB2aXJ0bmV0X2dldF9zc2V0X2NvdW50KHN0cnVj
dCBuZXRfZGV2aWNlICpkZXYsIGludCBzc2V0KQo+ICAgICAgICAgc3dpdGNoIChzc2V0KSB7Cj4g
ICAgICAgICBjYXNlIEVUSF9TU19TVEFUUzoKPiAgICAgICAgICAgICAgICAgcmV0dXJuIHZpLT5j
dXJyX3F1ZXVlX3BhaXJzICogKFZJUlRORVRfUlFfU1RBVFNfTEVOICsKPiAtICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZJUlRORVRfU1FfU1RBVFNfTEVOKTsK
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZJUlRORVRf
U1FfU1RBVFNfTEVOICsKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAocGFnZV9wb29sX2VuYWJsZWQgJiYgdmktPm1lcmdlYWJsZV9yeF9idWZzID8KPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZV9wb29s
X2V0aHRvb2xfc3RhdHNfZ2V0X2NvdW50KCkgOiAwKSk7Cj4gICAgICAgICBkZWZhdWx0Ogo+ICAg
ICAgICAgICAgICAgICByZXR1cm4gLUVPUE5PVFNVUFA7Cj4gICAgICAgICB9Cj4gIH0KPgo+ICtz
dGF0aWMgdm9pZCB2aXJ0bmV0X2dldF9wYWdlX3Bvb2xfc3RhdHMoc3RydWN0IG5ldF9kZXZpY2Ug
KmRldiwgdTY0ICpkYXRhKQo+ICt7Cj4gKyNpZmRlZiBDT05GSUdfUEFHRV9QT09MX1NUQVRTCj4g
KyAgICAgICBzdHJ1Y3QgdmlydG5ldF9pbmZvICp2aSA9IG5ldGRldl9wcml2KGRldik7Cj4gKyAg
ICAgICBzdHJ1Y3QgcGFnZV9wb29sX3N0YXRzIHBwX3N0YXRzID0ge307Cj4gKyAgICAgICBpbnQg
aTsKPiArCj4gKyAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmktPmN1cnJfcXVldWVfcGFpcnM7IGkr
Kykgewo+ICsgICAgICAgICAgICAgICBpZiAoIXZpLT5ycVtpXS5wYWdlX3Bvb2wpCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgY29udGludWU7Cj4gKyAgICAgICAgICAgICAgIHBhZ2VfcG9vbF9n
ZXRfc3RhdHModmktPnJxW2ldLnBhZ2VfcG9vbCwgJnBwX3N0YXRzKTsKPiArICAgICAgIH0KPiAr
ICAgICAgIHBhZ2VfcG9vbF9ldGh0b29sX3N0YXRzX2dldChkYXRhLCAmcHBfc3RhdHMpOwo+ICsj
ZW5kaWYgLyogQ09ORklHX1BBR0VfUE9PTF9TVEFUUyAqLwo+ICt9Cj4gKwo+ICBzdGF0aWMgdm9p
ZCB2aXJ0bmV0X2dldF9ldGh0b29sX3N0YXRzKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCj4gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgZXRodG9vbF9zdGF0cyAq
c3RhdHMsIHU2NCAqZGF0YSkKPiAgewo+IEBAIC0zMDAzLDYgKzMwNjksOCBAQCBzdGF0aWMgdm9p
ZCB2aXJ0bmV0X2dldF9ldGh0b29sX3N0YXRzKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYsCj4gICAg
ICAgICAgICAgICAgIH0gd2hpbGUgKHU2NF9zdGF0c19mZXRjaF9yZXRyeSgmc3EtPnN0YXRzLnN5
bmNwLCBzdGFydCkpOwo+ICAgICAgICAgICAgICAgICBpZHggKz0gVklSVE5FVF9TUV9TVEFUU19M
RU47Cj4gICAgICAgICB9Cj4gKwo+ICsgICAgICAgdmlydG5ldF9nZXRfcGFnZV9wb29sX3N0YXRz
KGRldiwgJmRhdGFbaWR4XSk7Cj4gIH0KPgo+ICBzdGF0aWMgdm9pZCB2aXJ0bmV0X2dldF9jaGFu
bmVscyhzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LAo+IEBAIC0zNjIzLDYgKzM2OTEsOCBAQCBzdGF0
aWMgdm9pZCB2aXJ0bmV0X2ZyZWVfcXVldWVzKHN0cnVjdCB2aXJ0bmV0X2luZm8gKnZpKQo+ICAg
ICAgICAgZm9yIChpID0gMDsgaSA8IHZpLT5tYXhfcXVldWVfcGFpcnM7IGkrKykgewo+ICAgICAg
ICAgICAgICAgICBfX25ldGlmX25hcGlfZGVsKCZ2aS0+cnFbaV0ubmFwaSk7Cj4gICAgICAgICAg
ICAgICAgIF9fbmV0aWZfbmFwaV9kZWwoJnZpLT5zcVtpXS5uYXBpKTsKPiArICAgICAgICAgICAg
ICAgaWYgKHZpLT5ycVtpXS5wYWdlX3Bvb2wpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgcGFn
ZV9wb29sX2Rlc3Ryb3kodmktPnJxW2ldLnBhZ2VfcG9vbCk7Cj4gICAgICAgICB9Cj4KPiAgICAg
ICAgIC8qIFdlIGNhbGxlZCBfX25ldGlmX25hcGlfZGVsKCksCj4gQEAgLTM2NzksMTIgKzM3NDks
MTkgQEAgc3RhdGljIHZvaWQgdmlydG5ldF9ycV9mcmVlX3VudXNlZF9idWYoc3RydWN0IHZpcnRx
dWV1ZSAqdnEsIHZvaWQgKmJ1ZikKPiAgICAgICAgIHN0cnVjdCB2aXJ0bmV0X2luZm8gKnZpID0g
dnEtPnZkZXYtPnByaXY7Cj4gICAgICAgICBpbnQgaSA9IHZxMnJ4cSh2cSk7Cj4KPiAtICAgICAg
IGlmICh2aS0+bWVyZ2VhYmxlX3J4X2J1ZnMpCj4gLSAgICAgICAgICAgICAgIHB1dF9wYWdlKHZp
cnRfdG9faGVhZF9wYWdlKGJ1ZikpOwo+IC0gICAgICAgZWxzZSBpZiAodmktPmJpZ19wYWNrZXRz
KQo+ICsgICAgICAgaWYgKHZpLT5tZXJnZWFibGVfcnhfYnVmcykgewo+ICsgICAgICAgICAgICAg
ICBpZiAodmktPnJxW2ldLnBhZ2VfcG9vbCkgewo+ICsgICAgICAgICAgICAgICAgICAgICAgIHBh
Z2VfcG9vbF9wdXRfZnVsbF9wYWdlKHZpLT5ycVtpXS5wYWdlX3Bvb2wsCj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlydF90b19oZWFkX3BhZ2UoYnVm
KSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVl
KTsKPiArICAgICAgICAgICAgICAgfSBlbHNlIHsKPiArICAgICAgICAgICAgICAgICAgICAgICBw
dXRfcGFnZSh2aXJ0X3RvX2hlYWRfcGFnZShidWYpKTsKPiArICAgICAgICAgICAgICAgfQo+ICsg
ICAgICAgfSBlbHNlIGlmICh2aS0+YmlnX3BhY2tldHMpIHsKPiAgICAgICAgICAgICAgICAgZ2l2
ZV9wYWdlcygmdmktPnJxW2ldLCBidWYpOwoKQW55IHJlYXNvbiBvbmx5IG1lcmdlYWJsZSB3ZXJl
IG1vZGlmaWVkIGJ1dCBub3QgZm9yIHNtYWxsIGFuZCBiaWc/CgpUaGFua3MKCj4gLSAgICAgICBl
bHNlCj4gKyAgICAgICB9IGVsc2Ugewo+ICAgICAgICAgICAgICAgICBwdXRfcGFnZSh2aXJ0X3Rv
X2hlYWRfcGFnZShidWYpKTsKPiArICAgICAgIH0KPiAgfQo+Cj4gIHN0YXRpYyB2b2lkIGZyZWVf
dW51c2VkX2J1ZnMoc3RydWN0IHZpcnRuZXRfaW5mbyAqdmkpCj4gQEAgLTM3MTgsNiArMzc5NSwy
NiBAQCBzdGF0aWMgdm9pZCB2aXJ0bmV0X2RlbF92cXMoc3RydWN0IHZpcnRuZXRfaW5mbyAqdmkp
Cj4gICAgICAgICB2aXJ0bmV0X2ZyZWVfcXVldWVzKHZpKTsKPiAgfQo+Cj4gK3N0YXRpYyB2b2lk
IHZpcnRuZXRfYWxsb2NfcGFnZV9wb29sKHN0cnVjdCByZWNlaXZlX3F1ZXVlICpycSkKPiArewo+
ICsgICAgICAgc3RydWN0IHZpcnRpb19kZXZpY2UgKnZkZXYgPSBycS0+dnEtPnZkZXY7Cj4gKwo+
ICsgICAgICAgc3RydWN0IHBhZ2VfcG9vbF9wYXJhbXMgcHBfcGFyYW1zID0gewo+ICsgICAgICAg
ICAgICAgICAub3JkZXIgPSAwLAo+ICsgICAgICAgICAgICAgICAucG9vbF9zaXplID0gcnEtPnZx
LT5udW1fbWF4LAo+ICsgICAgICAgICAgICAgICAubmlkID0gZGV2X3RvX25vZGUodmRldi0+ZGV2
LnBhcmVudCksCj4gKyAgICAgICAgICAgICAgIC5kZXYgPSB2ZGV2LT5kZXYucGFyZW50LAo+ICsg
ICAgICAgICAgICAgICAub2Zmc2V0ID0gMCwKPiArICAgICAgIH07Cj4gKwo+ICsgICAgICAgcnEt
PnBhZ2VfcG9vbCA9IHBhZ2VfcG9vbF9jcmVhdGUoJnBwX3BhcmFtcyk7Cj4gKyAgICAgICBpZiAo
SVNfRVJSKHJxLT5wYWdlX3Bvb2wpKSB7Cj4gKyAgICAgICAgICAgICAgIGRldl93YXJuKCZ2ZGV2
LT5kZXYsICJwYWdlIHBvb2wgY3JlYXRpb24gZmFpbGVkOiAlbGRcbiIsCj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgIFBUUl9FUlIocnEtPnBhZ2VfcG9vbCkpOwo+ICsgICAgICAgICAgICAgICBy
cS0+cGFnZV9wb29sID0gTlVMTDsKPiArICAgICAgIH0KPiArfQo+ICsKPiAgLyogSG93IGxhcmdl
IHNob3VsZCBhIHNpbmdsZSBidWZmZXIgYmUgc28gYSBxdWV1ZSBmdWxsIG9mIHRoZXNlIGNhbiBm
aXQgYXQKPiAgICogbGVhc3Qgb25lIGZ1bGwgcGFja2V0Pwo+ICAgKiBMb2dpYyBiZWxvdyBhc3N1
bWVzIHRoZSBtZXJnZWFibGUgYnVmZmVyIGhlYWRlciBpcyB1c2VkLgo+IEBAIC0zODAxLDYgKzM4
OTgsMTMgQEAgc3RhdGljIGludCB2aXJ0bmV0X2ZpbmRfdnFzKHN0cnVjdCB2aXJ0bmV0X2luZm8g
KnZpKQo+ICAgICAgICAgICAgICAgICB2aS0+cnFbaV0udnEgPSB2cXNbcnhxMnZxKGkpXTsKPiAg
ICAgICAgICAgICAgICAgdmktPnJxW2ldLm1pbl9idWZfbGVuID0gbWVyZ2VhYmxlX21pbl9idWZf
bGVuKHZpLCB2aS0+cnFbaV0udnEpOwo+ICAgICAgICAgICAgICAgICB2aS0+c3FbaV0udnEgPSB2
cXNbdHhxMnZxKGkpXTsKPiArCj4gKyAgICAgICAgICAgICAgIGlmIChwYWdlX3Bvb2xfZW5hYmxl
ZCAmJiB2aS0+bWVyZ2VhYmxlX3J4X2J1ZnMpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgdmly
dG5ldF9hbGxvY19wYWdlX3Bvb2woJnZpLT5ycVtpXSk7Cj4gKyAgICAgICAgICAgICAgIGVsc2UK
PiArICAgICAgICAgICAgICAgICAgICAgICBkZXZfd2FybigmdmktPnZkZXYtPmRldiwKPiArICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGFnZSBwb29sIG9ubHkgc3VwcG9ydCBtZXJn
ZWFibGUgbW9kZVxuIik7Cj4gKwo+ICAgICAgICAgfQo+Cj4gICAgICAgICAvKiBydW4gaGVyZTog
cmV0ID09IDAuICovCj4gLS0KPiAyLjMxLjEKPgoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxp
emF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3Vu
ZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
