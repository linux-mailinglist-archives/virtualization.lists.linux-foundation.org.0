Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
	by mail.lfdr.de (Postfix) with ESMTPS id 65F79424539
	for <lists.virtualization@lfdr.de>; Wed,  6 Oct 2021 19:50:54 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id 5798A408D6;
	Wed,  6 Oct 2021 17:50:52 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id HQbG4nDyoBMN; Wed,  6 Oct 2021 17:50:51 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [IPv6:2605:bc80:3010:104::8cd3:938])
	by smtp4.osuosl.org (Postfix) with ESMTPS id AB39140637;
	Wed,  6 Oct 2021 17:50:50 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 83A35C000D;
	Wed,  6 Oct 2021 17:50:50 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 815ECC000D
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:45 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id 6205683F5B
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:45 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id lZX7emwjIe9L
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:44 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.8.0
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by smtp1.osuosl.org (Postfix) with ESMTPS id 40D7E83E1E
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:44 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 BE1E43082766; Wed,  6 Oct 2021 20:31:18 +0300 (EEST)
Received: from localhost (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 9BEF13064495;
 Wed,  6 Oct 2021 20:31:18 +0300 (EEST)
X-Is-Junk-Enabled: fGZTSsP0qEJE2AIKtlSuFiRRwg9xyHmJ
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v12 59/77] KVM: introspection: restore the state of CR3
 interception on unhook
Date: Wed,  6 Oct 2021 20:30:55 +0300
Message-Id: <20211006173113.26445-60-alazar@bitdefender.com>
In-Reply-To: <20211006173113.26445-1-alazar@bitdefender.com>
References: <20211006173113.26445-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: Tamas K Lengyel <tamas@tklengyel.com>, Wanpeng Li <wanpengli@tencent.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <nicu.citu@icloud.com>,
 Sean Christopherson <seanjc@google.com>, Joerg Roedel <joro@8bytes.org>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Mathieu Tarral <mathieu.tarral@protonmail.com>,
 Paolo Bonzini <pbonzini@redhat.com>, Jim Mattson <jmattson@google.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTmljdciZb3IgQ8OuyJt1IDxuaWN1LmNpdHVAaWNsb3VkLmNvbT4KClRoaXMgY29tbWl0
IGFsc28gZW5zdXJlcyB0aGF0IHRoZSBpbnRyb3NwZWN0aW9uIHRvb2wgYW5kIHRoZSB1c2Vyc3Bh
Y2UKZG8gbm90IGRpc2FibGUgZWFjaCBvdGhlciB0aGUgQ1IzLXdyaXRlIFZNLWV4aXQuCgpTaWdu
ZWQtb2ZmLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5pY3UuY2l0dUBpY2xvdWQuY29tPgpTaWduZWQt
b2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogYXJj
aC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmggfCAgNCArKwogYXJjaC94ODYva3ZtL2t2bWku
YyAgICAgICAgICAgICAgfCA2OCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLQogYXJj
aC94ODYva3ZtL2t2bWkuaCAgICAgICAgICAgICAgfCAgNCArLQogYXJjaC94ODYva3ZtL2t2bWlf
bXNnLmMgICAgICAgICAgfCAgNCArLQogYXJjaC94ODYva3ZtL3N2bS9zdm0uYyAgICAgICAgICAg
fCAgNSArKysKIGFyY2gveDg2L2t2bS92bXgvdm14LmMgICAgICAgICAgIHwgIDUgKysrCiA2IGZp
bGVzIGNoYW5nZWQsIDgxIGluc2VydGlvbnMoKyksIDkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmggYi9hcmNoL3g4Ni9pbmNsdWRlL2Fz
bS9rdm1pX2hvc3QuaAppbmRleCA3NjEzMDg4ZDBhZTIuLmVkYmVkZjAzMTQ2NyAxMDA2NDQKLS0t
IGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmgKKysrIGIvYXJjaC94ODYvaW5jbHVk
ZS9hc20va3ZtaV9ob3N0LmgKQEAgLTE2LDYgKzE2LDcgQEAgc3RydWN0IGt2bWlfaW50ZXJjZXB0
aW9uIHsKIAlib29sIGNsZWFudXA7CiAJYm9vbCByZXN0b3JlX2ludGVyY2VwdGlvbjsKIAlzdHJ1
Y3Qga3ZtaV9tb25pdG9yX2ludGVyY2VwdGlvbiBicmVha3BvaW50OworCXN0cnVjdCBrdm1pX21v
bml0b3JfaW50ZXJjZXB0aW9uIGNyM3c7CiB9OwogCiBzdHJ1Y3Qga3ZtX3ZjcHVfYXJjaF9pbnRy
b3NwZWN0aW9uIHsKQEAgLTM0LDYgKzM1LDcgQEAgYm9vbCBrdm1pX21vbml0b3JfYnBfaW50ZXJj
ZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTMyIGRiZyk7CiBib29sIGt2bWlfY3JfZXZlbnQo
c3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1bnNpZ25lZCBpbnQgY3IsCiAJCSAgIHVuc2lnbmVkIGxv
bmcgb2xkX3ZhbHVlLCB1bnNpZ25lZCBsb25nICpuZXdfdmFsdWUpOwogYm9vbCBrdm1pX2NyM19p
bnRlcmNlcHRlZChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOworYm9vbCBrdm1pX21vbml0b3JfY3Iz
d19pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29sIGVuYWJsZSk7CiAKICNlbHNl
IC8qIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCkBAIC00NCw2ICs0Niw4IEBAIHN0YXRp
YyBpbmxpbmUgYm9vbCBrdm1pX2NyX2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdW5zaWdu
ZWQgaW50IGNyLAogCQkJCSB1bnNpZ25lZCBsb25nICpuZXdfdmFsdWUpCiAJCQl7IHJldHVybiB0
cnVlOyB9CiBzdGF0aWMgaW5saW5lIGJvb2wga3ZtaV9jcjNfaW50ZXJjZXB0ZWQoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1KSB7IHJldHVybiBmYWxzZTsgfQorc3RhdGljIGlubGluZSBib29sIGt2bWlf
bW9uaXRvcl9jcjN3X2ludGVyY2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCisJCQkJCQlib29s
IGVuYWJsZSkgeyByZXR1cm4gZmFsc2U7IH0KIAogI2VuZGlmIC8qIENPTkZJR19LVk1fSU5UUk9T
UEVDVElPTiAqLwogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaS5jIGIvYXJjaC94ODYv
a3ZtL2t2bWkuYwppbmRleCAzMWExMWM3MTIwYzUuLmFjZDY1NWFiNzcwZCAxMDA2NDQKLS0tIGEv
YXJjaC94ODYva3ZtL2t2bWkuYworKysgYi9hcmNoL3g4Ni9rdm0va3ZtaS5jCkBAIC0yMzAsNiAr
MjMwLDU5IEBAIHN0YXRpYyB2b2lkIGt2bWlfYXJjaF9kaXNhYmxlX2JwX2ludGVyY2VwdChzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJdmNwdS0+YXJjaC5rdm1pLT5icmVha3BvaW50Lmt2bV9pbnRl
cmNlcHRlZCA9IGZhbHNlOwogfQogCitzdGF0aWMgYm9vbCBtb25pdG9yX2NyM3dfZmN0X2t2bWko
c3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29sIGVuYWJsZSkKK3sKKwl2Y3B1LT5hcmNoLmt2bWkt
PmNyM3cua3ZtaV9pbnRlcmNlcHRlZCA9IGVuYWJsZTsKKworCWlmIChlbmFibGUpCisJCXZjcHUt
PmFyY2gua3ZtaS0+Y3Izdy5rdm1faW50ZXJjZXB0ZWQgPQorCQkJc3RhdGljX2NhbGwoa3ZtX3g4
Nl9jcjNfd3JpdGVfaW50ZXJjZXB0ZWQpKHZjcHUpOworCWVsc2UgaWYgKHZjcHUtPmFyY2gua3Zt
aS0+Y3Izdy5rdm1faW50ZXJjZXB0ZWQpCisJCXJldHVybiB0cnVlOworCisJcmV0dXJuIGZhbHNl
OworfQorCitzdGF0aWMgYm9vbCBtb25pdG9yX2NyM3dfZmN0X2t2bShzdHJ1Y3Qga3ZtX3ZjcHUg
KnZjcHUsIGJvb2wgZW5hYmxlKQoreworCWlmICghdmNwdS0+YXJjaC5rdm1pLT5jcjN3Lmt2bWlf
aW50ZXJjZXB0ZWQpCisJCXJldHVybiBmYWxzZTsKKworCXZjcHUtPmFyY2gua3ZtaS0+Y3Izdy5r
dm1faW50ZXJjZXB0ZWQgPSBlbmFibGU7CisKKwlpZiAoIWVuYWJsZSkKKwkJcmV0dXJuIHRydWU7
CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKKy8qCisgKiBSZXR1cm5zIHRydWUgaWYgb25lIHNpZGUg
KGt2bSBvciBrdm1pKSB0cmllcyB0byBkaXNhYmxlIHRoZSBDUjMgd3JpdGUKKyAqIGludGVyY2Vw
dGlvbiB3aGlsZSB0aGUgb3RoZXIgc2lkZSBpcyBzdGlsbCB0cmFja2luZyBpdC4KKyAqLworYm9v
bCBrdm1pX21vbml0b3JfY3Izd19pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29s
IGVuYWJsZSkKK3sKKwlzdHJ1Y3Qga3ZtaV9pbnRlcmNlcHRpb24gKmFyY2hfdmNwdWkgPSBSRUFE
X09OQ0UodmNwdS0+YXJjaC5rdm1pKTsKKworCXJldHVybiAoYXJjaF92Y3B1aSAmJiBhcmNoX3Zj
cHVpLT5jcjN3Lm1vbml0b3JfZmN0KHZjcHUsIGVuYWJsZSkpOworfQorRVhQT1JUX1NZTUJPTChr
dm1pX21vbml0b3JfY3Izd19pbnRlcmNlcHQpOworCitzdGF0aWMgdm9pZCBrdm1pX2NvbnRyb2xf
Y3Izd19pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29sIGVuYWJsZSkKK3sKKwl2
Y3B1LT5hcmNoLmt2bWktPmNyM3cubW9uaXRvcl9mY3QgPSBtb25pdG9yX2NyM3dfZmN0X2t2bWk7
CisJc3RhdGljX2NhbGwoa3ZtX3g4Nl9jb250cm9sX2NyM19pbnRlcmNlcHQpKHZjcHUsIENSX1RZ
UEVfVywgZW5hYmxlKTsKKwl2Y3B1LT5hcmNoLmt2bWktPmNyM3cubW9uaXRvcl9mY3QgPSBtb25p
dG9yX2NyM3dfZmN0X2t2bTsKK30KKworc3RhdGljIHZvaWQga3ZtaV9hcmNoX2Rpc2FibGVfY3Iz
d19pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQoreworCWt2bWlfY29udHJvbF9jcjN3
X2ludGVyY2VwdCh2Y3B1LCBmYWxzZSk7CisKKwl2Y3B1LT5hcmNoLmt2bWktPmNyM3cua3ZtaV9p
bnRlcmNlcHRlZCA9IGZhbHNlOworCXZjcHUtPmFyY2gua3ZtaS0+Y3Izdy5rdm1faW50ZXJjZXB0
ZWQgPSBmYWxzZTsKK30KKwogaW50IGt2bWlfYXJjaF9jbWRfY29udHJvbF9pbnRlcmNlcHQoc3Ry
dWN0IGt2bV92Y3B1ICp2Y3B1LAogCQkJCSAgICB1bnNpZ25lZCBpbnQgZXZlbnRfaWQsIGJvb2wg
ZW5hYmxlKQogewpAQCAtMjY5LDYgKzMyMiw3IEBAIHZvaWQga3ZtaV9hcmNoX2JyZWFrcG9pbnRf
ZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1NjQgZ3ZhLCB1OCBpbnNuX2xlbikKIHN0YXRp
YyB2b2lkIGt2bWlfYXJjaF9yZXN0b3JlX2ludGVyY2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUpCiB7CiAJa3ZtaV9hcmNoX2Rpc2FibGVfYnBfaW50ZXJjZXB0KHZjcHUpOworCWt2bWlfYXJj
aF9kaXNhYmxlX2NyM3dfaW50ZXJjZXB0KHZjcHUpOwogfQogCiBib29sIGt2bWlfYXJjaF9jbGVh
bl91cF9pbnRlcmNlcHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQpAQCAtMjkzLDggKzM0Nywx
MyBAQCBib29sIGt2bWlfYXJjaF92Y3B1X2FsbG9jX2ludGVyY2VwdGlvbihzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUpCiAJCXJldHVybiBmYWxzZTsKIAogCWFyY2hfdmNwdWktPmJyZWFrcG9pbnQubW9u
aXRvcl9mY3QgPSBtb25pdG9yX2JwX2ZjdF9rdm07CisJYXJjaF92Y3B1aS0+Y3Izdy5tb25pdG9y
X2ZjdCA9IG1vbml0b3JfY3Izd19mY3Rfa3ZtOwogCi0JLyogcGFpciB3aXRoIGt2bWlfbW9uaXRv
cl9icF9pbnRlcmNlcHQoKSAqLworCS8qCisJICogcGFpcmVkIHdpdGg6CisJICogIC0ga3ZtaV9t
b25pdG9yX2JwX2ludGVyY2VwdCgpCisJICogIC0ga3ZtaV9tb25pdG9yX2NyM3dfaW50ZXJjZXB0
KCkKKwkgKi8KIAlzbXBfd21iKCk7CiAJV1JJVEVfT05DRSh2Y3B1LT5hcmNoLmt2bWksIGFyY2hf
dmNwdWkpOwogCkBAIC0zMjYsOCArMzg1LDcgQEAgdm9pZCBrdm1pX2FyY2hfcmVxdWVzdF9pbnRl
cmNlcHRpb25fY2xlYW51cChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiBpbnQga3ZtaV9hcmNoX2Nt
ZF92Y3B1X2NvbnRyb2xfY3Ioc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBpbnQgY3IsIGJvb2wgZW5h
YmxlKQogewogCWlmIChjciA9PSAzKQotCQlzdGF0aWNfY2FsbChrdm1feDg2X2NvbnRyb2xfY3Iz
X2ludGVyY2VwdCkodmNwdSwgQ1JfVFlQRV9XLAotCQkJCQkJCSAgIGVuYWJsZSk7CisJCWt2bWlf
Y29udHJvbF9jcjN3X2ludGVyY2VwdCh2Y3B1LCBlbmFibGUpOwogCiAJaWYgKGVuYWJsZSkKIAkJ
c2V0X2JpdChjciwgVkNQVUkodmNwdSktPmFyY2guY3JfbWFzayk7CkBAIC0zNDcsOCArNDA1LDgg
QEAgc3RhdGljIGJvb2wgX19rdm1pX2NyX2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdW5z
aWduZWQgaW50IGNyLAogCWlmICghdGVzdF9iaXQoY3IsIFZDUFVJKHZjcHUpLT5hcmNoLmNyX21h
c2spKQogCQlyZXR1cm4gdHJ1ZTsKIAotCWFjdGlvbiA9IGt2bWlfbXNnX3NlbmRfY3IodmNwdSwg
Y3IsIG9sZF92YWx1ZSwgKm5ld192YWx1ZSwKLQkJCQkgICZyZXBseV92YWx1ZSk7CisJYWN0aW9u
ID0ga3ZtaV9tc2dfc2VuZF92Y3B1X2NyKHZjcHUsIGNyLCBvbGRfdmFsdWUsICpuZXdfdmFsdWUs
CisJCQkJICAgICAgICZyZXBseV92YWx1ZSk7CiAJc3dpdGNoIChhY3Rpb24pIHsKIAljYXNlIEtW
TUlfRVZFTlRfQUNUSU9OX0NPTlRJTlVFOgogCQkqbmV3X3ZhbHVlID0gcmVwbHlfdmFsdWU7CmRp
ZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaS5oIGIvYXJjaC94ODYva3ZtL2t2bWkuaAppbmRl
eCA2ZjRhYWViYjY3ZjkuLjZhNDQ0NDI4YjgzMSAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL2t2
bWkuaAorKysgYi9hcmNoL3g4Ni9rdm0va3ZtaS5oCkBAIC05LDcgKzksNyBAQCB2b2lkIGt2bWlf
YXJjaF9jbWRfdmNwdV9zZXRfcmVnaXN0ZXJzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAkJCQkg
ICAgICBjb25zdCBzdHJ1Y3Qga3ZtX3JlZ3MgKnJlZ3MpOwogaW50IGt2bWlfYXJjaF9jbWRfdmNw
dV9jb250cm9sX2NyKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgaW50IGNyLCBib29sIGVuYWJsZSk7
CiAKLXUzMiBrdm1pX21zZ19zZW5kX2NyKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTMyIGNyLCB1
NjQgb2xkX3ZhbHVlLAotCQkgICAgIHU2NCBuZXdfdmFsdWUsIHU2NCAqcmV0X3ZhbHVlKTsKK3Uz
MiBrdm1pX21zZ19zZW5kX3ZjcHVfY3Ioc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgY3IsIHU2
NCBvbGRfdmFsdWUsCisJCQkgIHU2NCBuZXdfdmFsdWUsIHU2NCAqcmV0X3ZhbHVlKTsKIAogI2Vu
ZGlmCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYyBiL2FyY2gveDg2L2t2bS9r
dm1pX21zZy5jCmluZGV4IDIwMGQ2OGZlYmM4NC4uNGEyZGJjMzhhZWY4IDEwMDY0NAotLS0gYS9h
cmNoL3g4Ni9rdm0va3ZtaV9tc2cuYworKysgYi9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYwpAQCAt
MTY2LDggKzE2Niw4IEBAIGt2bWlfdmNwdV9tc2dfam9iX2ZjdCBrdm1pX2FyY2hfdmNwdV9tc2df
aGFuZGxlcih1MTYgaWQpCiAJcmV0dXJuIGlkIDwgQVJSQVlfU0laRShtc2dfdmNwdSkgPyBtc2df
dmNwdVtpZF0gOiBOVUxMOwogfQogCi11MzIga3ZtaV9tc2dfc2VuZF9jcihzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUsIHUzMiBjciwgdTY0IG9sZF92YWx1ZSwKLQkJICAgICB1NjQgbmV3X3ZhbHVlLCB1
NjQgKnJldF92YWx1ZSkKK3UzMiBrdm1pX21zZ19zZW5kX3ZjcHVfY3Ioc3RydWN0IGt2bV92Y3B1
ICp2Y3B1LCB1MzIgY3IsIHU2NCBvbGRfdmFsdWUsCisJCQkgIHU2NCBuZXdfdmFsdWUsIHU2NCAq
cmV0X3ZhbHVlKQogewogCXN0cnVjdCBrdm1pX3ZjcHVfZXZlbnRfY3IgZTsKIAlzdHJ1Y3Qga3Zt
aV92Y3B1X2V2ZW50X2NyX3JlcGx5IHI7CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0vc3ZtL3N2
bS5jIGIvYXJjaC94ODYva3ZtL3N2bS9zdm0uYwppbmRleCA4NGY0ZjU5YmE3MDMuLjczNTM5OTY5
MDdkMyAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL3N2bS9zdm0uYworKysgYi9hcmNoL3g4Ni9r
dm0vc3ZtL3N2bS5jCkBAIC0xOTM1LDYgKzE5MzUsMTEgQEAgc3RhdGljIHZvaWQgc3ZtX2NvbnRy
b2xfY3IzX2ludGVyY2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGludCB0eXBlLAogewogCXN0
cnVjdCB2Y3B1X3N2bSAqc3ZtID0gdG9fc3ZtKHZjcHUpOwogCisjaWZkZWYgQ09ORklHX0tWTV9J
TlRST1NQRUNUSU9OCisJaWYgKCh0eXBlICYgQ1JfVFlQRV9XKSAmJiBrdm1pX21vbml0b3JfY3Iz
d19pbnRlcmNlcHQodmNwdSwgZW5hYmxlKSkKKwkJdHlwZSAmPSB+Q1JfVFlQRV9XOworI2VuZGlm
IC8qIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLworCiAJaWYgKHR5cGUgJiBDUl9UWVBFX1Ip
CiAJCWVuYWJsZSA/IHN2bV9zZXRfaW50ZXJjZXB0KHN2bSwgSU5URVJDRVBUX0NSM19SRUFEKSA6
CiAJCQkgc3ZtX2Nscl9pbnRlcmNlcHQoc3ZtLCBJTlRFUkNFUFRfQ1IzX1JFQUQpOwpkaWZmIC0t
Z2l0IGEvYXJjaC94ODYva3ZtL3ZteC92bXguYyBiL2FyY2gveDg2L2t2bS92bXgvdm14LmMKaW5k
ZXggMmE4Mzg1OTViYTBiLi5jMjY4MTk0Y2VlODQgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS92
bXgvdm14LmMKKysrIGIvYXJjaC94ODYva3ZtL3ZteC92bXguYwpAQCAtMzAxMSw2ICszMDExLDEx
IEBAIHN0YXRpYyB2b2lkIHZteF9jb250cm9sX2NyM19pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1
ICp2Y3B1LCBpbnQgdHlwZSwKIAlzdHJ1Y3QgdmNwdV92bXggKnZteCA9IHRvX3ZteCh2Y3B1KTsK
IAl1MzIgY3IzX2V4ZWNfY29udHJvbCA9IDA7CiAKKyNpZmRlZiBDT05GSUdfS1ZNX0lOVFJPU1BF
Q1RJT04KKwlpZiAoKHR5cGUgJiBDUl9UWVBFX1cpICYmIGt2bWlfbW9uaXRvcl9jcjN3X2ludGVy
Y2VwdCh2Y3B1LCBlbmFibGUpKQorCQl0eXBlICY9IH5DUl9UWVBFX1c7CisjZW5kaWYgLyogQ09O
RklHX0tWTV9JTlRST1NQRUNUSU9OICovCisKIAlpZiAodHlwZSAmIENSX1RZUEVfUikKIAkJY3Iz
X2V4ZWNfY29udHJvbCB8PSBDUFVfQkFTRURfQ1IzX1NUT1JFX0VYSVRJTkc7CiAJaWYgKHR5cGUg
JiBDUl9UWVBFX1cpCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51
eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1h
bi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
