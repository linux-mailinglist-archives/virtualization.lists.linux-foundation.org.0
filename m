Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp2.osuosl.org (smtp2.osuosl.org [IPv6:2605:bc80:3010::133])
	by mail.lfdr.de (Postfix) with ESMTPS id 66D844244D3
	for <lists.virtualization@lfdr.de>; Wed,  6 Oct 2021 19:41:19 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp2.osuosl.org (Postfix) with ESMTP id 7B7E7409D4;
	Wed,  6 Oct 2021 17:41:05 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
	by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id R2wofb-TWvLD; Wed,  6 Oct 2021 17:41:02 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [IPv6:2605:bc80:3010:104::8cd3:938])
	by smtp2.osuosl.org (Postfix) with ESMTPS id A86B4408B3;
	Wed,  6 Oct 2021 17:41:01 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id D06F3C0028;
	Wed,  6 Oct 2021 17:41:00 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 34359C002D
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:52 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp4.osuosl.org (Postfix) with ESMTP id 65B56408E5
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:48 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
 by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id qX5iRAnTkaqc
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:45 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.8.0
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by smtp4.osuosl.org (Postfix) with ESMTPS id 5CEB9408DE
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:45 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 65205305D31A; Wed,  6 Oct 2021 20:31:09 +0300 (EEST)
Received: from localhost (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 48517305FFA0;
 Wed,  6 Oct 2021 20:31:09 +0300 (EEST)
X-Is-Junk-Enabled: fGZTSsP0qEJE2AIKtlSuFiRRwg9xyHmJ
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v12 38/77] KVM: introspection: add KVMI_VM_CONTROL_EVENTS
Date: Wed,  6 Oct 2021 20:30:34 +0300
Message-Id: <20211006173113.26445-39-alazar@bitdefender.com>
In-Reply-To: <20211006173113.26445-1-alazar@bitdefender.com>
References: <20211006173113.26445-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: Tamas K Lengyel <tamas@tklengyel.com>, Wanpeng Li <wanpengli@tencent.com>,
 Sean Christopherson <seanjc@google.com>, Joerg Roedel <joro@8bytes.org>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Mathieu Tarral <mathieu.tarral@protonmail.com>,
 Paolo Bonzini <pbonzini@redhat.com>, Jim Mattson <jmattson@google.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

QnkgZGVmYXVsdCwgYWxsIGludHJvc3BlY3Rpb24gVk0gZXZlbnRzIGFyZSBkaXNhYmxlZC4gVGhl
IGludHJvc3BlY3Rpb24KdG9vbCBtdXN0IGV4cGxpY2l0bHkgZW5hYmxlIHRoZSBWTSBldmVudHMg
aXQgd2FudHMgdG8gcmVjZWl2ZS4gV2l0aCB0aGlzCmNvbW1hbmQgaXQgY2FuIGVuYWJsZS9kaXNh
YmxlIGFueSBWTSBldmVudCAoZS5nLiBLVk1JX1ZNX0VWRU5UX1VOSE9PSykKaWYgYWxsb3dlZCBi
eSB0aGUgZGV2aWNlIG1hbmFnZXIuCgpTaWduZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFs
YXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJz
dCAgICAgICAgICAgICAgIHwgNDIgKysrKysrKysrKysrKystLQogaW5jbHVkZS9saW51eC9rdm1p
X2hvc3QuaCAgICAgICAgICAgICAgICAgICAgIHwgIDIgKwogaW5jbHVkZS91YXBpL2xpbnV4L2t2
bWkuaCAgICAgICAgICAgICAgICAgICAgIHwgMTYgKysrKystLQogLi4uL3Rlc3Rpbmcvc2VsZnRl
c3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMgIHwgNDggKysrKysrKysrKysrKysrKysrKwogdmly
dC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMgICAgICAgICAgICAgICAgIHwgMzAgKysrKysrKysr
KystCiB2aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmggICAgICAgICAgICAgfCAgMyAr
KwogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jICAgICAgICAgICAgIHwgMjkgKysr
KysrKysrLS0KIDcgZmlsZXMgY2hhbmdlZCwgMTU4IGluc2VydGlvbnMoKyksIDEyIGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QgYi9Eb2N1
bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CmluZGV4IDJlZWNkN2U4YmZkMC4uZWNmODA5ZjQw
NzcxIDEwMDY0NAotLS0gYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CisrKyBiL0Rv
Y3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKQEAgLTMzMiwxMCArMzMyLDQ0IEBAIFRoaXMg
Y29tbWFuZCBpcyBhbHdheXMgYWxsb3dlZC4KIAogUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9ubGlu
ZSB2Q1BVcy4KIAorNS4gS1ZNSV9WTV9DT05UUk9MX0VWRU5UUworLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLQorCis6QXJjaGl0ZWN0dXJlczogYWxsCis6VmVyc2lvbnM6ID49IDEKKzpQYXJhbWV0
ZXJzOgorCis6OgorCisJc3RydWN0IGt2bWlfdm1fY29udHJvbF9ldmVudHMgeworCQlfX3UxNiBl
dmVudF9pZDsKKwkJX191OCBlbmFibGU7CisJCV9fdTggcGFkZGluZzE7CisJCV9fdTMyIHBhZGRp
bmcyOworCX07CisKKzpSZXR1cm5zOgorCis6OgorCisJc3RydWN0IGt2bWlfZXJyb3JfY29kZQor
CitFbmFibGVzL2Rpc2FibGVzIFZNIGludHJvc3BlY3Rpb24gZXZlbnRzLiBUaGlzIGNvbW1hbmQg
Y2FuIGJlIHVzZWQgd2l0aAordGhlIGZvbGxvd2luZyBldmVudHM6OgorCisJS1ZNSV9WTV9FVkVO
VF9VTkhPT0sKKworOkVycm9yczoKKworKiAtS1ZNX0VJTlZBTCAtIHRoZSBwYWRkaW5nIGlzIG5v
dCB6ZXJvCisqIC1LVk1fRUlOVkFMIC0gdGhlIGV2ZW50IElEIGlzIHVua25vd24gKHVzZSAqS1ZN
SV9WTV9DSEVDS19FVkVOVCogZmlyc3QpCisqIC1LVk1fRVBFUk0gLSB0aGUgYWNjZXNzIGlzIGRp
c2FsbG93ZWQgKHVzZSAqS1ZNSV9WTV9DSEVDS19FVkVOVCogZmlyc3QpCisKIEV2ZW50cwogPT09
PT09CiAKIFRoZSBWTSBpbnRyb3NwZWN0aW9uIGV2ZW50cyBhcmUgc2VudCB3aXRoIHRoZSBLVk1J
X1ZNX0VWRU5UIG1lc3NhZ2UgaWQuCitObyBldmVudCBpcyBzZW50IHVubGVzcyBpdCBpcyBleHBs
aWNpdGx5IGVuYWJsZWQuCiBUaGUgbWVzc2FnZSBkYXRhIGJlZ2lucyB3aXRoIGEgY29tbW9uIHN0
cnVjdHVyZSBoYXZpbmcgdGhlIGV2ZW50IGlkOjoKIAogCXN0cnVjdCBrdm1pX2V2ZW50X2hkciB7
CkBAIC0zNTksNiArMzkzLDggQEAgU3BlY2lmaWMgZXZlbnQgZGF0YSBjYW4gZm9sbG93IHRoaXMg
Y29tbW9uIHN0cnVjdHVyZS4KIAogOlJldHVybnM6IG5vbmUKIAotVGhpcyBldmVudCBpcyBzZW50
IHdoZW4gdGhlIGRldmljZSBtYW5hZ2VyIGhhcyB0byBwYXVzZS9zdG9wL21pZ3JhdGUgdGhlCi1n
dWVzdCAoc2VlICoqVW5ob29raW5nKiopLiBUaGUgaW50cm9zcGVjdGlvbiB0b29sIGhhcyBhIGNo
YW5jZSB0byB1bmhvb2sKLWFuZCBjbG9zZSB0aGUgS1ZNSSBjaGFubmVsIChzaWduYWxpbmcgdGhh
dCB0aGUgb3BlcmF0aW9uIGNhbiBwcm9jZWVkKS4KK1RoaXMgZXZlbnQgaXMgc2VudCB3aGVuIHRo
ZSBkZXZpY2UgbWFuYWdlciBoYXMgdG8gcGF1c2Uvc3RvcC9taWdyYXRlCit0aGUgZ3Vlc3QgKHNl
ZSAqKlVuaG9va2luZyoqKSBhbmQgdGhlIGludHJvc3BlY3Rpb24gaGFzIGJlZW4gZW5hYmxlZCBm
b3IKK3RoaXMgZXZlbnQgKHNlZSAqKktWTUlfVk1fQ09OVFJPTF9FVkVOVFMqKikuIFRoZSBpbnRy
b3NwZWN0aW9uIHRvb2wgaGFzCithIGNoYW5jZSB0byB1bmhvb2sgYW5kIGNsb3NlIHRoZSBpbnRy
b3NwZWN0aW9uIHNvY2tldCAoc2lnbmFsaW5nIHRoYXQKK3RoZSBvcGVyYXRpb24gY2FuIHByb2Nl
ZWQpLgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9rdm1pX2hvc3QuaCBiL2luY2x1ZGUvbGlu
dXgva3ZtaV9ob3N0LmgKaW5kZXggNjQ3NmM3ZDZhNGQzLi5hNTkzMDdkYWM2YmYgMTAwNjQ0Ci0t
LSBhL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmgKKysrIGIvaW5jbHVkZS9saW51eC9rdm1pX2hv
c3QuaApAQCAtMTgsNiArMTgsOCBAQCBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gewogCXVuc2ln
bmVkIGxvbmcgKmNtZF9hbGxvd19tYXNrOwogCXVuc2lnbmVkIGxvbmcgKmV2ZW50X2FsbG93X21h
c2s7CiAKKwl1bnNpZ25lZCBsb25nICp2bV9ldmVudF9lbmFibGVfbWFzazsKKwogCWF0b21pY190
IGV2X3NlcTsKIH07CiAKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggYi9p
bmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCmluZGV4IDE4ZmI1MTA3OGQ0OC4uOWExMGVmMmNkODkw
IDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2luY2x1ZGUvdWFw
aS9saW51eC9rdm1pLmgKQEAgLTE5LDEwICsxOSwxMSBAQCBlbnVtIHsKIGVudW0gewogCUtWTUlf
Vk1fRVZFTlQgPSBLVk1JX1ZNX01FU1NBR0VfSUQoMCksCiAKLQlLVk1JX0dFVF9WRVJTSU9OICAg
ICAgPSBLVk1JX1ZNX01FU1NBR0VfSUQoMSksCi0JS1ZNSV9WTV9DSEVDS19DT01NQU5EID0gS1ZN
SV9WTV9NRVNTQUdFX0lEKDIpLAotCUtWTUlfVk1fQ0hFQ0tfRVZFTlQgICA9IEtWTUlfVk1fTUVT
U0FHRV9JRCgzKSwKLQlLVk1JX1ZNX0dFVF9JTkZPICAgICAgPSBLVk1JX1ZNX01FU1NBR0VfSUQo
NCksCisJS1ZNSV9HRVRfVkVSU0lPTiAgICAgICA9IEtWTUlfVk1fTUVTU0FHRV9JRCgxKSwKKwlL
Vk1JX1ZNX0NIRUNLX0NPTU1BTkQgID0gS1ZNSV9WTV9NRVNTQUdFX0lEKDIpLAorCUtWTUlfVk1f
Q0hFQ0tfRVZFTlQgICAgPSBLVk1JX1ZNX01FU1NBR0VfSUQoMyksCisJS1ZNSV9WTV9HRVRfSU5G
TyAgICAgICA9IEtWTUlfVk1fTUVTU0FHRV9JRCg0KSwKKwlLVk1JX1ZNX0NPTlRST0xfRVZFTlRT
ID0gS1ZNSV9WTV9NRVNTQUdFX0lEKDUpLAogCiAJS1ZNSV9ORVhUX1ZNX01FU1NBR0UKIH07CkBA
IC04Miw0ICs4MywxMSBAQCBzdHJ1Y3Qga3ZtaV9ldmVudF9oZHIgewogCV9fdTE2IHBhZGRpbmdb
M107CiB9OwogCitzdHJ1Y3Qga3ZtaV92bV9jb250cm9sX2V2ZW50cyB7CisJX191MTYgZXZlbnRf
aWQ7CisJX191OCBlbmFibGU7CisJX191OCBwYWRkaW5nMTsKKwlfX3UzMiBwYWRkaW5nMjsKK307
CisKICNlbmRpZiAvKiBfVUFQSV9fTElOVVhfS1ZNSV9IICovCmRpZmYgLS1naXQgYS90b29scy90
ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9z
ZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYwppbmRleCA3MjI3MzdlMDFkOWIuLmY1ZmRi
MDliOWJlNiAxMDA2NDQKLS0tIGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9r
dm1pX3Rlc3QuYworKysgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlf
dGVzdC5jCkBAIC0zMzksNiArMzM5LDMxIEBAIHN0YXRpYyB2b2lkIHRyaWdnZXJfZXZlbnRfdW5o
b29rX25vdGlmaWNhdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIAkJZXJybm8sIHN0cmVycm9yKGVy
cm5vKSk7CiB9CiAKK3N0YXRpYyB2b2lkIGNtZF92bV9jb250cm9sX2V2ZW50cyhfX3UxNiBldmVu
dF9pZCwgX191OCBlbmFibGUsCisJCQkJICBpbnQgZXhwZWN0ZWRfZXJyKQoreworCXN0cnVjdCB7
CisJCXN0cnVjdCBrdm1pX21zZ19oZHIgaGRyOworCQlzdHJ1Y3Qga3ZtaV92bV9jb250cm9sX2V2
ZW50cyBjbWQ7CisJfSByZXEgPSB7fTsKKworCXJlcS5jbWQuZXZlbnRfaWQgPSBldmVudF9pZDsK
KwlyZXEuY21kLmVuYWJsZSA9IGVuYWJsZTsKKworCXRlc3Rfdm1fY29tbWFuZChLVk1JX1ZNX0NP
TlRST0xfRVZFTlRTLCAmcmVxLmhkciwgc2l6ZW9mKHJlcSksCisJCQlOVUxMLCAwLCBleHBlY3Rl
ZF9lcnIpOworfQorCitzdGF0aWMgdm9pZCBlbmFibGVfdm1fZXZlbnQoX191MTYgZXZlbnRfaWQp
Cit7CisJY21kX3ZtX2NvbnRyb2xfZXZlbnRzKGV2ZW50X2lkLCAxLCAwKTsKK30KKworc3RhdGlj
IHZvaWQgZGlzYWJsZV92bV9ldmVudChfX3UxNiBldmVudF9pZCkKK3sKKwljbWRfdm1fY29udHJv
bF9ldmVudHMoZXZlbnRfaWQsIDAsIDApOworfQorCiBzdGF0aWMgdm9pZCByZWNlaXZlX2V2ZW50
KHN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZ19oZHIsIHUxNiBtc2dfaWQsCiAJCQkgIHN0cnVjdCBr
dm1pX2V2ZW50X2hkciAqZXZfaGRyLCB1MTYgZXZlbnRfaWQsCiAJCQkgIHNpemVfdCBldl9zaXpl
KQpAQCAtMzc1LDkgKzQwMCwzMSBAQCBzdGF0aWMgdm9pZCByZWNlaXZlX3ZtX2V2ZW50X3VuaG9v
ayh2b2lkKQogCiBzdGF0aWMgdm9pZCB0ZXN0X2V2ZW50X3VuaG9vayhzdHJ1Y3Qga3ZtX3ZtICp2
bSkKIHsKKwl1MTYgaWQgPSBLVk1JX1ZNX0VWRU5UX1VOSE9PSzsKKworCWVuYWJsZV92bV9ldmVu
dChpZCk7CisKIAl0cmlnZ2VyX2V2ZW50X3VuaG9va19ub3RpZmljYXRpb24odm0pOwogCiAJcmVj
ZWl2ZV92bV9ldmVudF91bmhvb2soKTsKKworCWRpc2FibGVfdm1fZXZlbnQoaWQpOworfQorCitz
dGF0aWMgdm9pZCB0ZXN0X2NtZF92bV9jb250cm9sX2V2ZW50cyhzdHJ1Y3Qga3ZtX3ZtICp2bSkK
K3sKKwlfX3UxNiBpZCA9IEtWTUlfVk1fRVZFTlRfVU5IT09LLCBpbnZhbGlkX2lkID0gMHhmZmZm
OworCV9fdTggZW5hYmxlID0gMSwgZW5hYmxlX2ludmFsID0gMjsKKworCWVuYWJsZV92bV9ldmVu
dChpZCk7CisJZGlzYWJsZV92bV9ldmVudChpZCk7CisKKwljbWRfdm1fY29udHJvbF9ldmVudHMo
aWQsIGVuYWJsZV9pbnZhbCwgLUtWTV9FSU5WQUwpOworCWNtZF92bV9jb250cm9sX2V2ZW50cyhp
bnZhbGlkX2lkLCBlbmFibGUsIC1LVk1fRUlOVkFMKTsKKworCWRpc2FsbG93X2V2ZW50KHZtLCBp
ZCk7CisJY21kX3ZtX2NvbnRyb2xfZXZlbnRzKGlkLCBlbmFibGUsIC1LVk1fRVBFUk0pOworCWFs
bG93X2V2ZW50KHZtLCBpZCk7CiB9CiAKIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihz
dHJ1Y3Qga3ZtX3ZtICp2bSkKQEAgLTM5MSw2ICs0MzgsNyBAQCBzdGF0aWMgdm9pZCB0ZXN0X2lu
dHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAqdm0pCiAJdGVzdF9jbWRfdm1fY2hlY2tfZXZlbnQo
dm0pOwogCXRlc3RfY21kX3ZtX2dldF9pbmZvKCk7CiAJdGVzdF9ldmVudF91bmhvb2sodm0pOwor
CXRlc3RfY21kX3ZtX2NvbnRyb2xfZXZlbnRzKHZtKTsKIAogCXVuaG9va19pbnRyb3NwZWN0aW9u
KHZtKTsKIH0KZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jIGIvdmly
dC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKaW5kZXggNGJhMDljYmQzYWZkLi42YTU3ZDQ1YjY2
ZWMgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCisrKyBiL3ZpcnQv
a3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCkBAIC02OCw2ICs2OCwxNiBAQCBib29sIGt2bWlfaXNf
a25vd25fZXZlbnQodTE2IGlkKQogCXJldHVybiBpZCA8IEtWTUlfTlVNX0VWRU5UUyAmJiB0ZXN0
X2JpdChpZCwgS3ZtaV9rbm93bl9ldmVudHMpOwogfQogCitib29sIGt2bWlfaXNfa25vd25fdm1f
ZXZlbnQodTE2IGlkKQoreworCXJldHVybiBpZCA8IEtWTUlfTlVNX0VWRU5UUyAmJiB0ZXN0X2Jp
dChpZCwgS3ZtaV9rbm93bl92bV9ldmVudHMpOworfQorCitzdGF0aWMgYm9vbCBrdm1pX2lzX3Zt
X2V2ZW50X2VuYWJsZWQoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLCB1MTYgaWQpCit7
CisJcmV0dXJuIGlkIDwgS1ZNSV9OVU1fRVZFTlRTICYmIHRlc3RfYml0KGlkLCBrdm1pLT52bV9l
dmVudF9lbmFibGVfbWFzayk7Cit9CisKIHN0YXRpYyB2b2lkIGt2bWlfaW5pdF9hbHdheXNfYWxs
b3dlZF9jb21tYW5kcyh2b2lkKQogewogCWJpdG1hcF96ZXJvKEt2bWlfYWx3YXlzX2FsbG93ZWRf
Y29tbWFuZHMsIEtWTUlfTlVNX0NPTU1BTkRTKTsKQEAgLTExMCw2ICsxMjAsNyBAQCBzdGF0aWMg
dm9pZCBrdm1pX2ZyZWUoc3RydWN0IGt2bSAqa3ZtKQogewogCWJpdG1hcF9mcmVlKGt2bS0+a3Zt
aS0+Y21kX2FsbG93X21hc2spOwogCWJpdG1hcF9mcmVlKGt2bS0+a3ZtaS0+ZXZlbnRfYWxsb3df
bWFzayk7CisJYml0bWFwX2ZyZWUoa3ZtLT5rdm1pLT52bV9ldmVudF9lbmFibGVfbWFzayk7CiAK
IAlrZnJlZShrdm0tPmt2bWkpOwogCWt2bS0+a3ZtaSA9IE5VTEw7CkBAIC0xMjYsOSArMTM3LDEy
IEBAIGt2bWlfYWxsb2Moc3RydWN0IGt2bSAqa3ZtLCBjb25zdCBzdHJ1Y3Qga3ZtX2ludHJvc3Bl
Y3Rpb25faG9vayAqaG9vaykKIAogCWt2bWktPmNtZF9hbGxvd19tYXNrID0gYml0bWFwX3phbGxv
YyhLVk1JX05VTV9DT01NQU5EUywgR0ZQX0tFUk5FTCk7CiAJa3ZtaS0+ZXZlbnRfYWxsb3dfbWFz
ayA9IGJpdG1hcF96YWxsb2MoS1ZNSV9OVU1fRVZFTlRTLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWt2
bWktPmNtZF9hbGxvd19tYXNrIHx8ICFrdm1pLT5ldmVudF9hbGxvd19tYXNrKSB7CisJa3ZtaS0+
dm1fZXZlbnRfZW5hYmxlX21hc2sgPSBiaXRtYXBfemFsbG9jKEtWTUlfTlVNX0VWRU5UUywgR0ZQ
X0tFUk5FTCk7CisJaWYgKCFrdm1pLT5jbWRfYWxsb3dfbWFzayB8fCAha3ZtaS0+ZXZlbnRfYWxs
b3dfbWFzayB8fAorCSAgICAha3ZtaS0+dm1fZXZlbnRfZW5hYmxlX21hc2spIHsKIAkJYml0bWFw
X2ZyZWUoa3ZtaS0+Y21kX2FsbG93X21hc2spOwogCQliaXRtYXBfZnJlZShrdm1pLT5ldmVudF9h
bGxvd19tYXNrKTsKKwkJYml0bWFwX2ZyZWUoa3ZtaS0+dm1fZXZlbnRfZW5hYmxlX21hc2spOwog
CQlrZnJlZShrdm1pKTsKIAkJcmV0dXJuIE5VTEw7CiAJfQpAQCAtNDAwLDYgKzQxNCw5IEBAIHN0
YXRpYyBib29sIGt2bWlfdW5ob29rX2V2ZW50KHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3Zt
aSkKIHsKIAlpbnQgZXJyOwogCisJaWYgKCFrdm1pX2lzX3ZtX2V2ZW50X2VuYWJsZWQoa3ZtaSwg
S1ZNSV9WTV9FVkVOVF9VTkhPT0spKQorCQlyZXR1cm4gZmFsc2U7CisKIAllcnIgPSBrdm1pX21z
Z19zZW5kX3VuaG9vayhrdm1pKTsKIAogCXJldHVybiAhZXJyOwpAQCAtNDI1LDMgKzQ0MiwxNCBA
QCBpbnQga3ZtaV9pb2N0bF9wcmV1bmhvb2soc3RydWN0IGt2bSAqa3ZtKQogCW11dGV4X3VubG9j
aygma3ZtLT5rdm1pX2xvY2spOwogCXJldHVybiBlcnI7CiB9CisKK2ludCBrdm1pX2NtZF92bV9j
b250cm9sX2V2ZW50cyhzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksCisJCQkgICAgICAg
dTE2IGV2ZW50X2lkLCBib29sIGVuYWJsZSkKK3sKKwlpZiAoZW5hYmxlKQorCQlzZXRfYml0KGV2
ZW50X2lkLCBrdm1pLT52bV9ldmVudF9lbmFibGVfbWFzayk7CisJZWxzZQorCQljbGVhcl9iaXQo
ZXZlbnRfaWQsIGt2bWktPnZtX2V2ZW50X2VuYWJsZV9tYXNrKTsKKworCXJldHVybiAwOworfQpk
aWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oIGIvdmlydC9rdm0v
aW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCmluZGV4IDU3YzIyZjIwZTc0Zi4uOTg3NTEzZDZjMWE3
IDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgKKysrIGIvdmly
dC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCkBAIC0yNiw2ICsyNiw5IEBAIHZvaWQga3Zt
aV9tc2dfZnJlZSh2b2lkICphZGRyKTsKIGJvb2wga3ZtaV9pc19jb21tYW5kX2FsbG93ZWQoc3Ry
dWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLCB1MTYgaWQpOwogYm9vbCBrdm1pX2lzX2V2ZW50
X2FsbG93ZWQoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLCB1MTYgaWQpOwogYm9vbCBr
dm1pX2lzX2tub3duX2V2ZW50KHUxNiBpZCk7Citib29sIGt2bWlfaXNfa25vd25fdm1fZXZlbnQo
dTE2IGlkKTsKK2ludCBrdm1pX2NtZF92bV9jb250cm9sX2V2ZW50cyhzdHJ1Y3Qga3ZtX2ludHJv
c3BlY3Rpb24gKmt2bWksCisJCQkgICAgICAgdTE2IGV2ZW50X2lkLCBib29sIGVuYWJsZSk7CiAK
IC8qIGFyY2ggKi8KIHZvaWQga3ZtaV9hcmNoX2luaXRfdmNwdV9ldmVudHNfbWFzayh1bnNpZ25l
ZCBsb25nICpzdXBwb3J0ZWQpOwpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pX21zZy5jIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCmluZGV4IDQ4MzFm
MWI0MTcxNC4uYjJhNWRkM2QyMTlhIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9u
L2t2bWlfbXNnLmMKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCkBAIC0x
NjIsMTQgKzE2MiwzNSBAQCBzdGF0aWMgaW50IGhhbmRsZV92bV9nZXRfaW5mbyhzdHJ1Y3Qga3Zt
X2ludHJvc3BlY3Rpb24gKmt2bWksCiAJcmV0dXJuIGt2bWlfbXNnX3ZtX3JlcGx5KGt2bWksIG1z
ZywgMCwgJnJwbCwgc2l6ZW9mKHJwbCkpOwogfQogCitzdGF0aWMgaW50IGhhbmRsZV92bV9jb250
cm9sX2V2ZW50cyhzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksCisJCQkJICAgIGNvbnN0
IHN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZywKKwkJCQkgICAgY29uc3Qgdm9pZCAqX3JlcSkKK3sK
Kwljb25zdCBzdHJ1Y3Qga3ZtaV92bV9jb250cm9sX2V2ZW50cyAqcmVxID0gX3JlcTsKKwlpbnQg
ZWM7CisKKwlpZiAocmVxLT5wYWRkaW5nMSB8fCByZXEtPnBhZGRpbmcyIHx8IHJlcS0+ZW5hYmxl
ID4gMSkKKwkJZWMgPSAtS1ZNX0VJTlZBTDsKKwllbHNlIGlmICgha3ZtaV9pc19rbm93bl92bV9l
dmVudChyZXEtPmV2ZW50X2lkKSkKKwkJZWMgPSAtS1ZNX0VJTlZBTDsKKwllbHNlIGlmICgha3Zt
aV9pc19ldmVudF9hbGxvd2VkKGt2bWksIHJlcS0+ZXZlbnRfaWQpKQorCQllYyA9IC1LVk1fRVBF
Uk07CisJZWxzZQorCQllYyA9IGt2bWlfY21kX3ZtX2NvbnRyb2xfZXZlbnRzKGt2bWksIHJlcS0+
ZXZlbnRfaWQsCisJCQkJCQlyZXEtPmVuYWJsZSA9PSAxKTsKKworCXJldHVybiBrdm1pX21zZ192
bV9yZXBseShrdm1pLCBtc2csIGVjLCBOVUxMLCAwKTsKK30KKwogLyoKICAqIFRoZXNlIGNvbW1h
bmRzIGFyZSBleGVjdXRlZCBieSB0aGUgcmVjZWl2aW5nIHRocmVhZC4KICAqLwogc3RhdGljIGNv
bnN0IGt2bWlfdm1fbXNnX2ZjdCBtc2dfdm1bXSA9IHsKLQlbS1ZNSV9HRVRfVkVSU0lPTl0gICAg
ICA9IGhhbmRsZV9nZXRfdmVyc2lvbiwKLQlbS1ZNSV9WTV9DSEVDS19DT01NQU5EXSA9IGhhbmRs
ZV92bV9jaGVja19jb21tYW5kLAotCVtLVk1JX1ZNX0NIRUNLX0VWRU5UXSAgID0gaGFuZGxlX3Zt
X2NoZWNrX2V2ZW50LAotCVtLVk1JX1ZNX0dFVF9JTkZPXSAgICAgID0gaGFuZGxlX3ZtX2dldF9p
bmZvLAorCVtLVk1JX0dFVF9WRVJTSU9OXSAgICAgICA9IGhhbmRsZV9nZXRfdmVyc2lvbiwKKwlb
S1ZNSV9WTV9DSEVDS19DT01NQU5EXSAgPSBoYW5kbGVfdm1fY2hlY2tfY29tbWFuZCwKKwlbS1ZN
SV9WTV9DSEVDS19FVkVOVF0gICAgPSBoYW5kbGVfdm1fY2hlY2tfZXZlbnQsCisJW0tWTUlfVk1f
Q09OVFJPTF9FVkVOVFNdID0gaGFuZGxlX3ZtX2NvbnRyb2xfZXZlbnRzLAorCVtLVk1JX1ZNX0dF
VF9JTkZPXSAgICAgICA9IGhhbmRsZV92bV9nZXRfaW5mbywKIH07CiAKIHN0YXRpYyBrdm1pX3Zt
X21zZ19mY3QgZ2V0X3ZtX21zZ19oYW5kbGVyKHUxNiBpZCkKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZp
cnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGlu
dXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
