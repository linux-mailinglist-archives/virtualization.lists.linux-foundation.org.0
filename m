Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
	by mail.lfdr.de (Postfix) with ESMTPS id BFAA94A33A1
	for <lists.virtualization@lfdr.de>; Sun, 30 Jan 2022 05:04:02 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id AFCF84020C;
	Sun, 30 Jan 2022 04:04:00 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 83xSlzGZXn-B; Sun, 30 Jan 2022 04:03:59 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [IPv6:2605:bc80:3010:104::8cd3:938])
	by smtp4.osuosl.org (Postfix) with ESMTPS id B81A64020A;
	Sun, 30 Jan 2022 04:03:58 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 2B21BC0073;
	Sun, 30 Jan 2022 04:03:58 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id B1F1DC000B
 for <virtualization@lists.linux-foundation.org>;
 Sun, 30 Jan 2022 04:03:55 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp3.osuosl.org (Postfix) with ESMTP id 9F8F960746
 for <virtualization@lists.linux-foundation.org>;
 Sun, 30 Jan 2022 04:03:55 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Authentication-Results: smtp3.osuosl.org (amavisd-new);
 dkim=pass (1024-bit key) header.d=redhat.com
Received: from smtp3.osuosl.org ([127.0.0.1])
 by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id nbsNJApNoHH2
 for <virtualization@lists.linux-foundation.org>;
 Sun, 30 Jan 2022 04:03:54 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.129.124])
 by smtp3.osuosl.org (Postfix) with ESMTPS id 1298E606EC
 for <virtualization@lists.linux-foundation.org>;
 Sun, 30 Jan 2022 04:03:53 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1643515432;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=HFIaqK7M9BAi53NL1rhH7gNbtHPeQB0H6j65AiGJWBg=;
 b=bdIQ84MEDjDSH2u5Exp99LKc6BtpYj75/eYTf7TeYBiqR275kevWV5mJNli+zGuZ58ayt/
 /FvBXfdHxPJJ/1f+GkpzmWx0+o3BuluM6tCROSTAjqAzPmZa8oQ/u+qSRra8k8DZIa2r6A
 vFM2VDltFhb5qOHOeFH7XEfYPb3Qk5A=
Received: from mail-pj1-f72.google.com (mail-pj1-f72.google.com
 [209.85.216.72]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 us-mta-111-ULZ81vJaMsaJNfR5yYI2hQ-1; Sat, 29 Jan 2022 23:03:50 -0500
X-MC-Unique: ULZ81vJaMsaJNfR5yYI2hQ-1
Received: by mail-pj1-f72.google.com with SMTP id
 m21-20020a17090b069500b001b532620cd9so5680237pjz.1
 for <virtualization@lists.linux-foundation.org>;
 Sat, 29 Jan 2022 20:03:50 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=x-gm-message-state:message-id:date:mime-version:user-agent:subject
 :content-language:to:cc:references:from:in-reply-to
 :content-transfer-encoding;
 bh=HFIaqK7M9BAi53NL1rhH7gNbtHPeQB0H6j65AiGJWBg=;
 b=ekVY/GLIwvD7q6ypYTrczwX2BwuKNsOJy5/nJfjDq6N0pcf38eyf2P5ix8oGABKswL
 Rvr8/J546rV3xApw7jSiSIc7gKoW8W/AJc6qxMnCY2NCO/4vrXrfvQ/a3f9OnfM0mc20
 K4sCCWRR9QNP1+dtu1tcRl98EA+3D7zgTiFL8vOW9BljgxcPEVGxW5qF+i3QRNJtQx5o
 8idszNIc8SUc3kwhRWNQn7mNDcGqADFzF2NPJA+NOVTHlvplisaJH5vh8Mna3zjaUsRH
 wEGqgFoCL/BrZmeWZQ2jHXApMKX+nmH3VXZdfrMIptnb+VxZK5zLcwMF1oN2yoX+wujq
 jV8g==
X-Gm-Message-State: AOAM533bC/ykWOZGSB8QJPXFgR1HSRqlWLuFkYecRtUlmGgvHxeFTCbS
 FusM89mXUzqCaqU0kghuyJS7kxApr9+7Epe7WLVP8d8ivVyke+v6HwhButOo2uqsTnXsrKw8V99
 cNXAvtaqmAilc8iDZs/PHGryO/0+OHGLQSkD9zfcWfw==
X-Received: by 2002:a17:90b:4a12:: with SMTP id
 kk18mr27929715pjb.227.1643515429587; 
 Sat, 29 Jan 2022 20:03:49 -0800 (PST)
X-Google-Smtp-Source: ABdhPJxKwxwopr8ME/4KezW9LHVHcLAS/GF6p7bPNTRyCivwXXBqWiXSVQdRO4a11lM6RAazoGsdfg==
X-Received: by 2002:a17:90b:4a12:: with SMTP id
 kk18mr27929696pjb.227.1643515429204; 
 Sat, 29 Jan 2022 20:03:49 -0800 (PST)
Received: from [10.72.13.18] ([209.132.188.80])
 by smtp.gmail.com with ESMTPSA id nk11sm6644594pjb.55.2022.01.29.20.03.41
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Sat, 29 Jan 2022 20:03:48 -0800 (PST)
Message-ID: <82b8c3bf-1b11-86c7-4fad-294f5ccf1278@redhat.com>
Date: Sun, 30 Jan 2022 12:03:36 +0800
MIME-Version: 1.0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:91.0)
 Gecko/20100101 Thunderbird/91.5.1
Subject: Re: [PATCH 17/31] vdpa: adapt vhost_ops callbacks to svq
To: =?UTF-8?Q?Eugenio_P=c3=a9rez?= <eperezma@redhat.com>, qemu-devel@nongnu.org
References: <20220121202733.404989-1-eperezma@redhat.com>
 <20220121202733.404989-18-eperezma@redhat.com>
From: Jason Wang <jasowang@redhat.com>
In-Reply-To: <20220121202733.404989-18-eperezma@redhat.com>
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=jasowang@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Content-Language: en-US
Cc: Laurent Vivier <lvivier@redhat.com>, Parav Pandit <parav@mellanox.com>,
 Cindy Lu <lulu@redhat.com>, "Michael S. Tsirkin" <mst@redhat.com>,
 Richard Henderson <richard.henderson@linaro.org>,
 Markus Armbruster <armbru@redhat.com>, Gautam Dawar <gdawar@xilinx.com>,
 virtualization@lists.linux-foundation.org,
 Eduardo Habkost <ehabkost@redhat.com>,
 Harpreet Singh Anand <hanand@xilinx.com>, Xiao W Wang <xiao.w.wang@intel.com>,
 Stefan Hajnoczi <stefanha@redhat.com>, Eli Cohen <eli@mellanox.com>,
 Paolo Bonzini <pbonzini@redhat.com>, Zhu Lingshan <lingshan.zhu@intel.com>,
 Eric Blake <eblake@redhat.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

CuWcqCAyMDIyLzEvMjIg5LiK5Y2INDoyNywgRXVnZW5pbyBQw6lyZXog5YaZ6YGTOgo+IEZpcnN0
IGhhbGYgb2YgdGhlIGJ1ZmZlcnMgZm9yd2FyZGluZyBwYXJ0LCBwcmVwYXJpbmcgdmhvc3QtdmRw
YQo+IGNhbGxiYWNrcyB0byBTVlEgdG8gb2ZmZXIgaXQuIFFFTVUgY2Fubm90IGVuYWJsZSBpdCBh
dCB0aGlzIG1vbWVudCwgc28KPiB0aGlzIGlzIGVmZmVjdGl2ZWx5IGRlYWQgY29kZSBhdCB0aGUg
bW9tZW50LCBidXQgaXQgaGVscHMgdG8gcmVkdWNlCj4gcGF0Y2ggc2l6ZS4KPgo+IFNpZ25lZC1v
ZmYtYnk6IEV1Z2VuaW8gUMOpcmV6IDxlcGVyZXptYUByZWRoYXQuY29tPgo+IC0tLQo+ICAgaHcv
dmlydGlvL3Zob3N0LXNoYWRvdy12aXJ0cXVldWUuaCB8ICAgMiArLQo+ICAgaHcvdmlydGlvL3Zo
b3N0LXNoYWRvdy12aXJ0cXVldWUuYyB8ICAyMSArKysrLQo+ICAgaHcvdmlydGlvL3Zob3N0LXZk
cGEuYyAgICAgICAgICAgICB8IDEzMyArKysrKysrKysrKysrKysrKysrKysrKysrKy0tLQo+ICAg
MyBmaWxlcyBjaGFuZ2VkLCAxNDMgaW5zZXJ0aW9ucygrKSwgMTMgZGVsZXRpb25zKC0pCj4KPiBk
aWZmIC0tZ2l0IGEvaHcvdmlydGlvL3Zob3N0LXNoYWRvdy12aXJ0cXVldWUuaCBiL2h3L3ZpcnRp
by92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmgKPiBpbmRleCAwMzUyMDdhNDY5Li4zOWFlZjVmZmRm
IDEwMDY0NAo+IC0tLSBhL2h3L3ZpcnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmgKPiArKysg
Yi9ody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRxdWV1ZS5oCj4gQEAgLTM1LDcgKzM1LDcgQEAg
c2l6ZV90IHZob3N0X3N2cV9kZXZpY2VfYXJlYV9zaXplKGNvbnN0IFZob3N0U2hhZG93VmlydHF1
ZXVlICpzdnEpOwo+ICAgCj4gICB2b2lkIHZob3N0X3N2cV9zdG9wKFZob3N0U2hhZG93VmlydHF1
ZXVlICpzdnEpOwo+ICAgCj4gLVZob3N0U2hhZG93VmlydHF1ZXVlICp2aG9zdF9zdnFfbmV3KHZv
aWQpOwo+ICtWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqdmhvc3Rfc3ZxX25ldyh1aW50MTZfdCBxc2l6
ZSk7Cj4gICAKPiAgIHZvaWQgdmhvc3Rfc3ZxX2ZyZWUoVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnZx
KTsKPiAgIAo+IGRpZmYgLS1naXQgYS9ody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRxdWV1ZS5j
IGIvaHcvdmlydGlvL3Zob3N0LXNoYWRvdy12aXJ0cXVldWUuYwo+IGluZGV4IGYxMjllYzgzOTUu
LjdjMTY4MDc1ZDcgMTAwNjQ0Cj4gLS0tIGEvaHcvdmlydGlvL3Zob3N0LXNoYWRvdy12aXJ0cXVl
dWUuYwo+ICsrKyBiL2h3L3ZpcnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmMKPiBAQCAtMjc3
LDkgKzI3NywxNyBAQCB2b2lkIHZob3N0X3N2cV9zdG9wKFZob3N0U2hhZG93VmlydHF1ZXVlICpz
dnEpCj4gICAvKioKPiAgICAqIENyZWF0ZXMgdmhvc3Qgc2hhZG93IHZpcnRxdWV1ZSwgYW5kIGlu
c3RydWN0IHZob3N0IGRldmljZSB0byB1c2UgdGhlIHNoYWRvdwo+ICAgICogbWV0aG9kcyBhbmQg
ZmlsZSBkZXNjcmlwdG9ycy4KPiArICoKPiArICogQHFzaXplIFNoYWRvdyBWaXJ0UXVldWUgc2l6
ZQo+ICsgKgo+ICsgKiBSZXR1cm5zIHRoZSBuZXcgdmlydHF1ZXVlIG9yIE5VTEwuCj4gKyAqCj4g
KyAqIEluIGNhc2Ugb2YgZXJyb3IsIHJlYXNvbiBpcyByZXBvcnRlZCB0aHJvdWdoIGVycm9yX3Jl
cG9ydC4KPiAgICAqLwo+IC1WaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqdmhvc3Rfc3ZxX25ldyh2b2lk
KQo+ICtWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqdmhvc3Rfc3ZxX25ldyh1aW50MTZfdCBxc2l6ZSkK
PiAgIHsKPiArICAgIHNpemVfdCBkZXNjX3NpemUgPSBzaXplb2YodnJpbmdfZGVzY190KSAqIHFz
aXplOwo+ICsgICAgc2l6ZV90IGRldmljZV9zaXplLCBkcml2ZXJfc2l6ZTsKPiAgICAgICBnX2F1
dG9mcmVlIFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEgPSBnX25ldzAoVmhvc3RTaGFkb3dWaXJ0
cXVldWUsIDEpOwo+ICAgICAgIGludCByOwo+ICAgCj4gQEAgLTMwMCw2ICszMDgsMTUgQEAgVmhv
c3RTaGFkb3dWaXJ0cXVldWUgKnZob3N0X3N2cV9uZXcodm9pZCkKPiAgICAgICAvKiBQbGFjZWhv
bGRlciBkZXNjcmlwdG9yLCBpdCBzaG91bGQgYmUgZGVsZXRlZCBhdCBzZXRfa2lja19mZCAqLwo+
ICAgICAgIGV2ZW50X25vdGlmaWVyX2luaXRfZmQoJnN2cS0+c3ZxX2tpY2ssIElOVkFMSURfU1ZR
X0tJQ0tfRkQpOwo+ICAgCj4gKyAgICBzdnEtPnZyaW5nLm51bSA9IHFzaXplOwoKCkkgd29uZGVy
IGlmIHRoaXMgaXMgdGhlIGJlc3QuIEUuZyBzb21lIGhhcmR3YXJlIGNhbiBzdXBwb3J0IHVwIHRv
IDMySyAKcXVldWUgc2l6ZS4gU28gdGhpcyB3aWxsIHByb2JhYmx5IGVuZCB1cCB3aXRoOgoKMSkg
U1ZRIHVzZSAzMksgcXVldWUgc2l6ZQoyKSBoYXJkd2FyZSBxdWV1ZSB1c2VzIDI1NgoKPyBPciB3
ZSBTVlEgY2FuIHN0aWNrIHRvIDI1NiBidXQgdGhpcyB3aWxsIHRoaXMgY2F1c2UgdHJvdWJsZSBp
ZiB3ZSB3YW50IAp0byBhZGQgZXZlbnQgaW5kZXggc3VwcG9ydD8KCgo+ICsgICAgZHJpdmVyX3Np
emUgPSB2aG9zdF9zdnFfZHJpdmVyX2FyZWFfc2l6ZShzdnEpOwo+ICsgICAgZGV2aWNlX3NpemUg
PSB2aG9zdF9zdnFfZGV2aWNlX2FyZWFfc2l6ZShzdnEpOwo+ICsgICAgc3ZxLT52cmluZy5kZXNj
ID0gcWVtdV9tZW1hbGlnbihxZW11X3JlYWxfaG9zdF9wYWdlX3NpemUsIGRyaXZlcl9zaXplKTsK
PiArICAgIHN2cS0+dnJpbmcuYXZhaWwgPSAodm9pZCAqKSgoY2hhciAqKXN2cS0+dnJpbmcuZGVz
YyArIGRlc2Nfc2l6ZSk7Cj4gKyAgICBtZW1zZXQoc3ZxLT52cmluZy5kZXNjLCAwLCBkcml2ZXJf
c2l6ZSk7Cj4gKyAgICBzdnEtPnZyaW5nLnVzZWQgPSBxZW11X21lbWFsaWduKHFlbXVfcmVhbF9o
b3N0X3BhZ2Vfc2l6ZSwgZGV2aWNlX3NpemUpOwo+ICsgICAgbWVtc2V0KHN2cS0+dnJpbmcudXNl
ZCwgMCwgZGV2aWNlX3NpemUpOwo+ICsKPiAgICAgICBldmVudF9ub3RpZmllcl9zZXRfaGFuZGxl
cigmc3ZxLT5oZGV2X2NhbGwsIHZob3N0X3N2cV9oYW5kbGVfY2FsbCk7Cj4gICAgICAgcmV0dXJu
IGdfc3RlYWxfcG9pbnRlcigmc3ZxKTsKPiAgIAo+IEBAIC0zMTgsNSArMzM1LDcgQEAgdm9pZCB2
aG9zdF9zdnFfZnJlZShWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqdnEpCj4gICAgICAgZXZlbnRfbm90
aWZpZXJfY2xlYW51cCgmdnEtPmhkZXZfa2ljayk7Cj4gICAgICAgZXZlbnRfbm90aWZpZXJfc2V0
X2hhbmRsZXIoJnZxLT5oZGV2X2NhbGwsIE5VTEwpOwo+ICAgICAgIGV2ZW50X25vdGlmaWVyX2Ns
ZWFudXAoJnZxLT5oZGV2X2NhbGwpOwo+ICsgICAgcWVtdV92ZnJlZSh2cS0+dnJpbmcuZGVzYyk7
Cj4gKyAgICBxZW11X3ZmcmVlKHZxLT52cmluZy51c2VkKTsKPiAgICAgICBnX2ZyZWUodnEpOwo+
ICAgfQo+IGRpZmYgLS1naXQgYS9ody92aXJ0aW8vdmhvc3QtdmRwYS5jIGIvaHcvdmlydGlvL3Zo
b3N0LXZkcGEuYwo+IGluZGV4IDlkODAxY2Y5MDcuLjUzZTE0YmFmYTAgMTAwNjQ0Cj4gLS0tIGEv
aHcvdmlydGlvL3Zob3N0LXZkcGEuYwo+ICsrKyBiL2h3L3ZpcnRpby92aG9zdC12ZHBhLmMKPiBA
QCAtNjQxLDIwICs2NDEsNTIgQEAgc3RhdGljIGludCB2aG9zdF92ZHBhX3NldF92cmluZ19hZGRy
KHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPiAgICAgICByZXR1cm4gdmhvc3RfdmRwYV9jYWxsKGRl
diwgVkhPU1RfU0VUX1ZSSU5HX0FERFIsIGFkZHIpOwo+ICAgfQo+ICAgCj4gLXN0YXRpYyBpbnQg
dmhvc3RfdmRwYV9zZXRfdnJpbmdfbnVtKHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPiAtICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgdmhvc3RfdnJpbmdfc3RhdGUg
KnJpbmcpCj4gK3N0YXRpYyBpbnQgdmhvc3RfdmRwYV9zZXRfZGV2X3ZyaW5nX251bShzdHJ1Y3Qg
dmhvc3RfZGV2ICpkZXYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3Qgdmhvc3RfdnJpbmdfc3RhdGUgKnJpbmcpCj4gICB7Cj4gICAgICAgdHJhY2Vfdmhv
c3RfdmRwYV9zZXRfdnJpbmdfbnVtKGRldiwgcmluZy0+aW5kZXgsIHJpbmctPm51bSk7Cj4gICAg
ICAgcmV0dXJuIHZob3N0X3ZkcGFfY2FsbChkZXYsIFZIT1NUX1NFVF9WUklOR19OVU0sIHJpbmcp
Owo+ICAgfQo+ICAgCj4gLXN0YXRpYyBpbnQgdmhvc3RfdmRwYV9zZXRfdnJpbmdfYmFzZShzdHJ1
Y3Qgdmhvc3RfZGV2ICpkZXYsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHN0cnVjdCB2aG9zdF92cmluZ19zdGF0ZSAqcmluZykKPiArc3RhdGljIGludCB2aG9zdF92
ZHBhX3NldF92cmluZ19udW0oc3RydWN0IHZob3N0X2RldiAqZGV2LAo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgdmhvc3RfdnJpbmdfc3RhdGUgKnJpbmcpCj4g
K3sKPiArICAgIHN0cnVjdCB2aG9zdF92ZHBhICp2ID0gZGV2LT5vcGFxdWU7Cj4gKwo+ICsgICAg
aWYgKHYtPnNoYWRvd192cXNfZW5hYmxlZCkgewo+ICsgICAgICAgIC8qCj4gKyAgICAgICAgICog
VnJpbmcgbnVtIHdhcyBzZXQgYXQgZGV2aWNlIHN0YXJ0LiBTVlEgbnVtIGlzIGhhbmRsZWQgYnkg
VmlydFF1ZXVlCj4gKyAgICAgICAgICogY29kZQo+ICsgICAgICAgICAqLwo+ICsgICAgICAgIHJl
dHVybiAwOwo+ICsgICAgfQo+ICsKPiArICAgIHJldHVybiB2aG9zdF92ZHBhX3NldF9kZXZfdnJp
bmdfbnVtKGRldiwgcmluZyk7Cj4gK30KPiArCj4gK3N0YXRpYyBpbnQgdmhvc3RfdmRwYV9zZXRf
ZGV2X3ZyaW5nX2Jhc2Uoc3RydWN0IHZob3N0X2RldiAqZGV2LAo+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aG9zdF92cmluZ19zdGF0ZSAqcmluZykK
PiAgIHsKPiAgICAgICB0cmFjZV92aG9zdF92ZHBhX3NldF92cmluZ19iYXNlKGRldiwgcmluZy0+
aW5kZXgsIHJpbmctPm51bSk7Cj4gICAgICAgcmV0dXJuIHZob3N0X3ZkcGFfY2FsbChkZXYsIFZI
T1NUX1NFVF9WUklOR19CQVNFLCByaW5nKTsKPiAgIH0KPiAgIAo+ICtzdGF0aWMgaW50IHZob3N0
X3ZkcGFfc2V0X3ZyaW5nX2Jhc2Uoc3RydWN0IHZob3N0X2RldiAqZGV2LAo+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZob3N0X3ZyaW5nX3N0YXRlICpyaW5n
KQo+ICt7Cj4gKyAgICBzdHJ1Y3Qgdmhvc3RfdmRwYSAqdiA9IGRldi0+b3BhcXVlOwo+ICsKPiAr
ICAgIGlmICh2LT5zaGFkb3dfdnFzX2VuYWJsZWQpIHsKPiArICAgICAgICAvKgo+ICsgICAgICAg
ICAqIFZyaW5nIGJhc2Ugd2FzIHNldCBhdCBkZXZpY2Ugc3RhcnQuIFNWUSBiYXNlIGlzIGhhbmRs
ZWQgYnkgVmlydFF1ZXVlCj4gKyAgICAgICAgICogY29kZQo+ICsgICAgICAgICAqLwo+ICsgICAg
ICAgIHJldHVybiAwOwo+ICsgICAgfQo+ICsKPiArICAgIHJldHVybiB2aG9zdF92ZHBhX3NldF9k
ZXZfdnJpbmdfYmFzZShkZXYsIHJpbmcpOwo+ICt9Cj4gKwo+ICAgc3RhdGljIGludCB2aG9zdF92
ZHBhX2dldF92cmluZ19iYXNlKHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aG9zdF92cmluZ19zdGF0ZSAqcmlu
ZykKPiAgIHsKPiBAQCAtNzg0LDggKzgxNiw4IEBAIHN0YXRpYyBpbnQgdmhvc3RfdmRwYV9kZXZf
c3RhcnQoc3RydWN0IHZob3N0X2RldiAqZGV2LCBib29sIHN0YXJ0ZWQpCj4gICAgICAgfQo+ICAg
fQo+ICAgCj4gLXN0YXRpYyBpbnQgdmhvc3RfdmRwYV9nZXRfZmVhdHVyZXMoc3RydWN0IHZob3N0
X2RldiAqZGV2LAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0
X3QgKmZlYXR1cmVzKQo+ICtzdGF0aWMgaW50IHZob3N0X3ZkcGFfZ2V0X2Rldl9mZWF0dXJlcyhz
dHJ1Y3Qgdmhvc3RfZGV2ICpkZXYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVpbnQ2NF90ICpmZWF0dXJlcykKPiAgIHsKPiAgICAgICBpbnQgcmV0Owo+ICAgCj4g
QEAgLTc5NCwxNSArODI2LDY0IEBAIHN0YXRpYyBpbnQgdmhvc3RfdmRwYV9nZXRfZmVhdHVyZXMo
c3RydWN0IHZob3N0X2RldiAqZGV2LAo+ICAgICAgIHJldHVybiByZXQ7Cj4gICB9Cj4gICAKPiAr
c3RhdGljIGludCB2aG9zdF92ZHBhX2dldF9mZWF0dXJlcyhzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYs
IHVpbnQ2NF90ICpmZWF0dXJlcykKPiArewo+ICsgICAgc3RydWN0IHZob3N0X3ZkcGEgKnYgPSBk
ZXYtPm9wYXF1ZTsKPiArICAgIGludCByZXQgPSB2aG9zdF92ZHBhX2dldF9kZXZfZmVhdHVyZXMo
ZGV2LCBmZWF0dXJlcyk7Cj4gKwo+ICsgICAgaWYgKHJldCA9PSAwICYmIHYtPnNoYWRvd192cXNf
ZW5hYmxlZCkgewo+ICsgICAgICAgIC8qIEZpbHRlciBvbmx5IGZlYXR1cmVzIHRoYXQgU1ZRIGNh
biBvZmZlciB0byBndWVzdCAqLwo+ICsgICAgICAgIHZob3N0X3N2cV92YWxpZF9ndWVzdF9mZWF0
dXJlcyhmZWF0dXJlcyk7Cj4gKyAgICB9CgoKU29ycnkgaWYgSSd2ZSBhc2tlZCBiZWZvcmUsIEkg
dGhpbmsgaXQncyBzdWZmaWNpZW50IHRvIGZpbHRlciBvdXQgdGhlIApkZXZpY2UgZmVhdHVyZXMg
dGhhdCB3ZSBkb24ndCBzdXBwb3J0IGR1cmluZyBhbmQgZmFpbCB0aGUgdmhvc3QgCmluaXRpYWxp
emF0aW9uLiBBbnkgcmVhc29uIHdlIG5lZWQgZG8gaXQgYWdhaW4gaGVyZT8KCgo+ICsKPiArICAg
IHJldHVybiByZXQ7Cj4gK30KPiArCj4gICBzdGF0aWMgaW50IHZob3N0X3ZkcGFfc2V0X2ZlYXR1
cmVzKHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDY0X3QgZmVhdHVyZXMpCj4gICB7Cj4gKyAgICBzdHJ1Y3Qgdmhvc3RfdmRw
YSAqdiA9IGRldi0+b3BhcXVlOwo+ICAgICAgIGludCByZXQ7Cj4gICAKPiAgICAgICBpZiAodmhv
c3RfdmRwYV9vbmVfdGltZV9yZXF1ZXN0KGRldikpIHsKPiAgICAgICAgICAgcmV0dXJuIDA7Cj4g
ICAgICAgfQo+ICAgCj4gKyAgICBpZiAodi0+c2hhZG93X3Zxc19lbmFibGVkKSB7Cj4gKyAgICAg
ICAgdWludDY0X3QgZGV2X2ZlYXR1cmVzLCBzdnFfZmVhdHVyZXMsIGFja2VkX2ZlYXR1cmVzOwo+
ICsgICAgICAgIGJvb2wgb2s7Cj4gKwo+ICsgICAgICAgIHJldCA9IHZob3N0X3ZkcGFfZ2V0X2Rl
dl9mZWF0dXJlcyhkZXYsICZkZXZfZmVhdHVyZXMpOwo+ICsgICAgICAgIGlmIChyZXQgIT0gMCkg
ewo+ICsgICAgICAgICAgICBlcnJvcl9yZXBvcnQoIkNhbid0IGdldCB2ZHBhIGRldmljZSBmZWF0
dXJlcywgZ290ICglZCkiLCByZXQpOwo+ICsgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICsgICAg
ICAgIH0KPiArCj4gKyAgICAgICAgc3ZxX2ZlYXR1cmVzID0gZGV2X2ZlYXR1cmVzOwo+ICsgICAg
ICAgIG9rID0gdmhvc3Rfc3ZxX3ZhbGlkX2RldmljZV9mZWF0dXJlcygmc3ZxX2ZlYXR1cmVzKTsK
PiArICAgICAgICBpZiAodW5saWtlbHkoIW9rKSkgewo+ICsgICAgICAgICAgICBlcnJvcl9yZXBv
cnQoIlNWUSBJbnZhbGlkIGRldmljZSBmZWF0dXJlIGZsYWdzLCBvZmZlcjogMHglIgo+ICsgICAg
ICAgICAgICAgICAgICAgICAgICAgUFJJeDY0Iiwgb2s6IDB4JSJQUkl4NjQsIGRldi0+ZmVhdHVy
ZXMsIHN2cV9mZWF0dXJlcyk7Cj4gKyAgICAgICAgICAgIHJldHVybiAtMTsKPiArICAgICAgICB9
Cj4gKwo+ICsgICAgICAgIG9rID0gdmhvc3Rfc3ZxX3ZhbGlkX2d1ZXN0X2ZlYXR1cmVzKCZmZWF0
dXJlcyk7Cj4gKyAgICAgICAgaWYgKHVubGlrZWx5KCFvaykpIHsKPiArICAgICAgICAgICAgZXJy
b3JfcmVwb3J0KAo+ICsgICAgICAgICAgICAgICAgIkludmFsaWQgZ3Vlc3QgYWNrZWQgZmVhdHVy
ZSBmbGFnLCBhY2tlZDogMHglIgo+ICsgICAgICAgICAgICAgICAgUFJJeDY0Iiwgb2s6IDB4JSJQ
Ukl4NjQsIGRldi0+YWNrZWRfZmVhdHVyZXMsIGZlYXR1cmVzKTsKPiArICAgICAgICAgICAgcmV0
dXJuIC0xOwo+ICsgICAgICAgIH0KPiArCj4gKyAgICAgICAgb2sgPSB2aG9zdF9zdnFfYWNrX2d1
ZXN0X2ZlYXR1cmVzKHN2cV9mZWF0dXJlcywgZmVhdHVyZXMsCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICZhY2tlZF9mZWF0dXJlcyk7Cj4gKyAgICAgICAgaWYg
KHVubGlrZWx5KCFvaykpIHsKPiArICAgICAgICAgICAgcmV0dXJuIC0xOwo+ICsgICAgICAgIH0K
PiArCj4gKyAgICAgICAgZmVhdHVyZXMgPSBhY2tlZF9mZWF0dXJlczsKPiArICAgIH0KPiArCj4g
ICAgICAgdHJhY2Vfdmhvc3RfdmRwYV9zZXRfZmVhdHVyZXMoZGV2LCBmZWF0dXJlcyk7Cj4gICAg
ICAgcmV0ID0gdmhvc3RfdmRwYV9jYWxsKGRldiwgVkhPU1RfU0VUX0ZFQVRVUkVTLCAmZmVhdHVy
ZXMpOwo+ICAgICAgIGlmIChyZXQpIHsKPiBAQCAtODIyLDEzICs5MDMsMzEgQEAgc3RhdGljIGlu
dCB2aG9zdF92ZHBhX3NldF9vd25lcihzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYpCj4gICAgICAgcmV0
dXJuIHZob3N0X3ZkcGFfY2FsbChkZXYsIFZIT1NUX1NFVF9PV05FUiwgTlVMTCk7Cj4gICB9Cj4g
ICAKPiAtc3RhdGljIGludCB2aG9zdF92ZHBhX3ZxX2dldF9hZGRyKHN0cnVjdCB2aG9zdF9kZXYg
KmRldiwKPiAtICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgdmhvc3RfdnJpbmdfYWRkciAqYWRk
ciwgc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEpCj4gK3N0YXRpYyB2b2lkIHZob3N0X3ZkcGFf
dnFfZ2V0X2d1ZXN0X2FkZHIoc3RydWN0IHZob3N0X3ZyaW5nX2FkZHIgKmFkZHIsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZob3N0X3ZpcnRxdWV1
ZSAqdnEpCj4gICB7Cj4gLSAgICBhc3NlcnQoZGV2LT52aG9zdF9vcHMtPmJhY2tlbmRfdHlwZSA9
PSBWSE9TVF9CQUNLRU5EX1RZUEVfVkRQQSk7Cj4gICAgICAgYWRkci0+ZGVzY191c2VyX2FkZHIg
PSAodWludDY0X3QpKHVuc2lnbmVkIGxvbmcpdnEtPmRlc2NfcGh5czsKPiAgICAgICBhZGRyLT5h
dmFpbF91c2VyX2FkZHIgPSAodWludDY0X3QpKHVuc2lnbmVkIGxvbmcpdnEtPmF2YWlsX3BoeXM7
Cj4gICAgICAgYWRkci0+dXNlZF91c2VyX2FkZHIgPSAodWludDY0X3QpKHVuc2lnbmVkIGxvbmcp
dnEtPnVzZWRfcGh5czsKPiArfQo+ICsKPiArc3RhdGljIGludCB2aG9zdF92ZHBhX3ZxX2dldF9h
ZGRyKHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0cnVjdCB2aG9zdF92cmluZ19hZGRyICphZGRyLAo+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEpCj4gK3sKPiArICAg
IHN0cnVjdCB2aG9zdF92ZHBhICp2ID0gZGV2LT5vcGFxdWU7Cj4gKwo+ICsgICAgYXNzZXJ0KGRl
di0+dmhvc3Rfb3BzLT5iYWNrZW5kX3R5cGUgPT0gVkhPU1RfQkFDS0VORF9UWVBFX1ZEUEEpOwo+
ICsKPiArICAgIGlmICh2LT5zaGFkb3dfdnFzX2VuYWJsZWQpIHsKPiArICAgICAgICBpbnQgaWR4
ID0gdmhvc3RfdmRwYV9nZXRfdnFfaW5kZXgoZGV2LCBhZGRyLT5pbmRleCk7Cj4gKyAgICAgICAg
Vmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSA9IGdfcHRyX2FycmF5X2luZGV4KHYtPnNoYWRvd192
cXMsIGlkeCk7Cj4gKwo+ICsgICAgICAgIHZob3N0X3N2cV9nZXRfdnJpbmdfYWRkcihzdnEsIGFk
ZHIpOwo+ICsgICAgfSBlbHNlIHsKPiArICAgICAgICB2aG9zdF92ZHBhX3ZxX2dldF9ndWVzdF9h
ZGRyKGFkZHIsIHZxKTsKPiArICAgIH0KPiArCj4gICAgICAgdHJhY2Vfdmhvc3RfdmRwYV92cV9n
ZXRfYWRkcihkZXYsIHZxLCBhZGRyLT5kZXNjX3VzZXJfYWRkciwKPiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGFkZHItPmF2YWlsX3VzZXJfYWRkciwgYWRkci0+dXNlZF91c2Vy
X2FkZHIpOwo+ICAgICAgIHJldHVybiAwOwo+IEBAIC04NDksNiArOTQ4LDEyIEBAIHN0YXRpYyB2
b2lkIHZob3N0X3BzdnFfZnJlZShncG9pbnRlciBzdnEpCj4gICAgICAgdmhvc3Rfc3ZxX2ZyZWUo
c3ZxKTsKPiAgIH0KPiAgIAo+ICtzdGF0aWMgaW50IHZob3N0X3ZkcGFfZ2V0X21heF9xdWV1ZV9z
aXplKHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB1aW50MTZfdCAqcXNpemUpCj4gK3sKPiArICAgIHJldHVybiB2aG9zdF92
ZHBhX2NhbGwoZGV2LCBWSE9TVF9WRFBBX0dFVF9WUklOR19OVU0sIHFzaXplKTsKPiArfQo+ICsK
PiAgIHN0YXRpYyBpbnQgdmhvc3RfdmRwYV9pbml0X3N2cShzdHJ1Y3Qgdmhvc3RfZGV2ICpoZGV2
LCBzdHJ1Y3Qgdmhvc3RfdmRwYSAqdiwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBFcnJvciAqKmVycnApCj4gICB7Cj4gQEAgLTg1Nyw2ICs5NjIsNyBAQCBzdGF0aWMgaW50IHZo
b3N0X3ZkcGFfaW5pdF9zdnEoc3RydWN0IHZob3N0X2RldiAqaGRldiwgc3RydWN0IHZob3N0X3Zk
cGEgKnYsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHZob3N0X3BzdnFfZnJlZSk7Cj4gICAgICAgdWludDY0X3QgZGV2X2ZlYXR1
cmVzOwo+ICAgICAgIHVpbnQ2NF90IHN2cV9mZWF0dXJlczsKPiArICAgIHVpbnQxNl90IHFzaXpl
Owo+ICAgICAgIGludCByOwo+ICAgICAgIGJvb2wgb2s7Cj4gICAKPiBAQCAtODY0LDcgKzk3MCw3
IEBAIHN0YXRpYyBpbnQgdmhvc3RfdmRwYV9pbml0X3N2cShzdHJ1Y3Qgdmhvc3RfZGV2ICpoZGV2
LCBzdHJ1Y3Qgdmhvc3RfdmRwYSAqdiwKPiAgICAgICAgICAgZ290byBvdXQ7Cj4gICAgICAgfQo+
ICAgCj4gLSAgICByID0gdmhvc3RfdmRwYV9nZXRfZmVhdHVyZXMoaGRldiwgJmRldl9mZWF0dXJl
cyk7Cj4gKyAgICByID0gdmhvc3RfdmRwYV9nZXRfZGV2X2ZlYXR1cmVzKGhkZXYsICZkZXZfZmVh
dHVyZXMpOwo+ICAgICAgIGlmIChyICE9IDApIHsKPiAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJw
LCAiQ2FuJ3QgZ2V0IHZkcGEgZGV2aWNlIGZlYXR1cmVzLCBnb3QgKCVkKSIsIHIpOwo+ICAgICAg
ICAgICByZXR1cm4gcjsKPiBAQCAtODc5LDkgKzk4NSwxNCBAQCBzdGF0aWMgaW50IHZob3N0X3Zk
cGFfaW5pdF9zdnEoc3RydWN0IHZob3N0X2RldiAqaGRldiwgc3RydWN0IHZob3N0X3ZkcGEgKnYs
Cj4gICAgICAgICAgIHJldHVybiAtMTsKPiAgICAgICB9Cj4gICAKPiArICAgIHIgPSB2aG9zdF92
ZHBhX2dldF9tYXhfcXVldWVfc2l6ZShoZGV2LCAmcXNpemUpOwo+ICsgICAgaWYgKHVubGlrZWx5
KHIpKSB7Cj4gKyAgICAgICAgcXNpemUgPSAyNTY7Cj4gKyAgICB9CgoKU2hvdWxkIHdlIGZhaWwg
aW5zdGVhZCBvZiBoYXZpbmcgYSAiZGVmYXVsdCIgdmFsdWUgaGVyZT8KClRoYW5rcwoKCj4gKwo+
ICAgICAgIHNoYWRvd192cXMgPSBnX3B0cl9hcnJheV9uZXdfZnVsbChoZGV2LT5udnFzLCB2aG9z
dF9wc3ZxX2ZyZWUpOwo+ICAgICAgIGZvciAodW5zaWduZWQgbiA9IDA7IG4gPCBoZGV2LT5udnFz
OyArK24pIHsKPiAtICAgICAgICBWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqc3ZxID0gdmhvc3Rfc3Zx
X25ldygpOwo+ICsgICAgICAgIFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEgPSB2aG9zdF9zdnFf
bmV3KHFzaXplKTsKPiAgIAo+ICAgICAgICAgICBpZiAodW5saWtlbHkoIXN2cSkpIHsKPiAgICAg
ICAgICAgICAgIGVycm9yX3NldGcoZXJycCwgIkNhbm5vdCBjcmVhdGUgc3ZxICV1Iiwgbik7Cgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXph
dGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5v
cmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmly
dHVhbGl6YXRpb24=
