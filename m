Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 5C89B229C7E
	for <lists.virtualization@lfdr.de>; Wed, 22 Jul 2020 18:01:52 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 1614786B1C;
	Wed, 22 Jul 2020 16:01:51 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id GzScifGEzTzZ; Wed, 22 Jul 2020 16:01:50 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 6DA4286CC5;
	Wed, 22 Jul 2020 16:01:44 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 5FA12C0053;
	Wed, 22 Jul 2020 16:01:44 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 471C5C004C
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:39 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 2B4F588141
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:39 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 5uOMD22+DwvI
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:37 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id 80A4D88138
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:37 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 80B85305D767; Wed, 22 Jul 2020 19:01:32 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.6])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 75D9B305FFA3;
 Wed, 22 Jul 2020 19:01:32 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [RFC PATCH v1 16/34] KVM: introspection: add
 KVMI_VCPU_CONTROL_EPT_VIEW
Date: Wed, 22 Jul 2020 19:01:03 +0300
Message-Id: <20200722160121.9601-17-alazar@bitdefender.com>
In-Reply-To: <20200722160121.9601-1-alazar@bitdefender.com>
References: <20200722160121.9601-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?=C8=98tefan=20=C8=98icleru?= <ssicleru@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogyJh0ZWZhbiDImGljbGVydSA8c3NpY2xlcnVAYml0ZGVmZW5kZXIuY29tPgoKVGhpcyB3
aWxsIGJlIHVzZWQgYnkgdGhlIGludHJvc3BlY3Rpb24gdG9vbCB0byBjb250cm9sIHRoZSBFUFQg
dmlld3MgdG8Kd2hpY2ggdGhlIGd1ZXN0IGlzIGFsbG93ZWQgdG8gc3dpdGNoLgoKU2lnbmVkLW9m
Zi1ieTogyJh0ZWZhbiDImGljbGVydSA8c3NpY2xlcnVAYml0ZGVmZW5kZXIuY29tPgpTaWduZWQt
b2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogRG9j
dW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCAgICAgICAgICAgICAgIHwgIDM3ICsrKysrKwog
YXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmggICAgICAgICAgICAgIHwgICA3ICsrCiBh
cmNoL3g4Ni9rdm0va3ZtaS5jICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIDkgKysKIGlu
Y2x1ZGUvdWFwaS9saW51eC9rdm1pLmggICAgICAgICAgICAgICAgICAgICB8ICAgMSArCiAuLi4v
dGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYyAgfCAxMTggKysrKysrKysr
KysrKysrKysrCiB2aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmggICAgICAgICAgICAg
fCAgIDIgKwogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jICAgICAgICAgICAgIHwg
IDE5ICsrKwogNyBmaWxlcyBjaGFuZ2VkLCAxOTMgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBh
L0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3Zt
L2t2bWkucnN0CmluZGV4IDAyZjAzYzYyYWRlZi4uZjRjNjBhYmE5YjUzIDEwMDY0NAotLS0gYS9E
b2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CisrKyBiL0RvY3VtZW50YXRpb24vdmlydC9r
dm0va3ZtaS5yc3QKQEAgLTExOTAsNiArMTE5MCw0MyBAQCBFUFRQIHN3aXRjaGluZyBtZWNoYW5p
c20gKHNlZSAqKktWTUlfR0VUX1ZFUlNJT04qKikuCiAqIC1LVk1fRUFHQUlOIC0gdGhlIHNlbGVj
dGVkIHZDUFUgY2FuJ3QgYmUgaW50cm9zcGVjdGVkIHlldAogKiAtS1ZNX0VPUE5PVFNVUFAgLSBh
biBFUFQgdmlldyB3YXMgc2VsZWN0ZWQgYnV0IHRoZSBoYXJkd2FyZSBkb2Vzbid0IHN1cHBvcnQg
aXQKIAorMjguIEtWTUlfVkNQVV9DT05UUk9MX0VQVF9WSUVXCistLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KKworOkFyY2hpdGVjdHVyZTogeDg2Cis6VmVyc2lvbnM6ID49IDEKKzpQYXJh
bWV0ZXJzOgorCis6OgorCisJc3RydWN0IGt2bWlfdmNwdV9oZHI7CisJc3RydWN0IGt2bWlfdmNw
dV9jb250cm9sX2VwdF92aWV3IHsKKwkJX191MTYgdmlldzsKKwkJX191OCAgdmlzaWJsZTsKKwkJ
X191OCAgcGFkZGluZzE7CisJCV9fdTMyIHBhZGRpbmcyOworCX07CisKKzpSZXR1cm5zOgorCis6
OgorCisJc3RydWN0IGt2bWlfZXJyb3JfY29kZTsKKworQ29udHJvbHMgdGhlIGNhcGFiaWxpdHkg
b2YgdGhlIGd1ZXN0IHRvIHN1Y2Nlc3NmdWxseSBjaGFuZ2UgRVBUIHZpZXdzCit0aHJvdWdoIFZN
RlVOQyBpbnN0cnVjdGlvbiB3aXRob3V0IHRyaWdnZXJpbmcgYSB2bS1leGl0LiBJZiBgYHZpc2li
bGVgYAoraXMgdHJ1ZSwgdGhlIGd1ZXN0IHdpbGwgYmUgY2FwYWJsZSB0byBjaGFuZ2UgRVBUIHZp
ZXdzIHRocm91Z2ggVk1GVU5DKDAsCitgYHZpZXdgYCkuIElmIGBgdmlzaWJsZWBgIGlzIGZhbHNl
LCBWTUZVTkMoMCwgYGB2aWV3YGApIHRyaWdnZXJzIGEKK3ZtLWV4aXQsIGEgI1VEIGV4Y2VwdGlv
biBpcyBpbmplY3RlZCB0byBndWVzdCBhbmQgdGhlIGd1ZXN0IGFwcGxpY2F0aW9uCitpcyB0ZXJt
aW5hdGVkLgorCis6RXJyb3JzOgorCisqIC1LVk1fRUlOVkFMIC0gdGhlIHNlbGVjdGVkIHZDUFUg
aXMgaW52YWxpZAorKiAtS1ZNX0VBR0FJTiAtIHRoZSBzZWxlY3RlZCB2Q1BVIGNhbid0IGJlIGlu
dHJvc3BlY3RlZCB5ZXQKKyogLUtWTV9FSU5WQUwgLSBwYWRkaW5nIGlzIG5vdCB6ZXJvCisqIC1L
Vk1fRUlOVkFMIC0gdGhlIHNlbGVjdGVkIEVQVCB2aWV3IGlzIG5vdCB2YWxpZAorCiBFdmVudHMK
ID09PT09PQogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaCBi
L2FyY2gveDg2L2luY2x1ZGUvdWFwaS9hc20va3ZtaS5oCmluZGV4IGY3YTA4MGQ1ZTIyNy4uZmMz
NWRhOTAwNzc4IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaAor
KysgYi9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaApAQCAtMTY2LDQgKzE2NiwxMSBA
QCBzdHJ1Y3Qga3ZtaV92Y3B1X3NldF9lcHRfdmlldyB7CiAJX191MzIgcGFkZGluZzI7CiB9Owog
CitzdHJ1Y3Qga3ZtaV92Y3B1X2NvbnRyb2xfZXB0X3ZpZXcgeworCV9fdTE2IHZpZXc7CisJX191
OCAgdmlzaWJsZTsKKwlfX3U4ICBwYWRkaW5nMTsKKwlfX3UzMiBwYWRkaW5nMjsKK307CisKICNl
bmRpZiAvKiBfVUFQSV9BU01fWDg2X0tWTUlfSCAqLwpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3Zt
L2t2bWkuYyBiL2FyY2gveDg2L2t2bS9rdm1pLmMKaW5kZXggOTllYThlZjcwYmUyLi4wNjM1N2I4
YWI1NGEgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS9rdm1pLmMKKysrIGIvYXJjaC94ODYva3Zt
L2t2bWkuYwpAQCAtMTQzMiwzICsxNDMyLDEyIEBAIGludCBrdm1pX2FyY2hfY21kX3NldF9lcHRf
dmlldyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUxNiB2aWV3KQogCiAJcmV0dXJuIGt2bV94ODZf
b3BzLnNldF9lcHRfdmlldyh2Y3B1LCB2aWV3KTsKIH0KKworaW50IGt2bWlfYXJjaF9jbWRfY29u
dHJvbF9lcHRfdmlldyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUxNiB2aWV3LAorCQkJCSAgIGJv
b2wgdmlzaWJsZSkKK3sKKwlpZiAoIWt2bV94ODZfb3BzLmNvbnRyb2xfZXB0X3ZpZXcpCisJCXJl
dHVybiAtS1ZNX0VJTlZBTDsKKworCXJldHVybiBrdm1feDg2X29wcy5jb250cm9sX2VwdF92aWV3
KHZjcHUsIHZpZXcsIHZpc2libGUpOworfQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS91YXBpL2xpbnV4
L2t2bWkuaCBiL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgKaW5kZXggODIwNDY2MWQ5NDRkLi5h
NzJjNTM2YTJjODAgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgKKysrIGIv
aW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaApAQCAtNTEsNiArNTEsNyBAQCBlbnVtIHsKIAlLVk1J
X1ZDUFVfVFJBTlNMQVRFX0dWQSAgICAgID0gMjUsCiAJS1ZNSV9WQ1BVX0dFVF9FUFRfVklFVyAg
ICAgICA9IDI2LAogCUtWTUlfVkNQVV9TRVRfRVBUX1ZJRVcgICAgICAgPSAyNywKKwlLVk1JX1ZD
UFVfQ09OVFJPTF9FUFRfVklFVyAgID0gMjgsCiAKIAlLVk1JX05VTV9NRVNTQUdFUwogfTsKZGlm
ZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMg
Yi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCmluZGV4IGM2
ZjdkMTA1NjNkYi4uZDgwOGNiNjE0NjNkIDEwMDY0NAotLS0gYS90b29scy90ZXN0aW5nL3NlbGZ0
ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCisrKyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3Rz
L2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKQEAgLTU2LDYgKzU2LDcgQEAgc3RydWN0IHZjcHVfd29y
a2VyX2RhdGEgewogCWJvb2wgc3RvcDsKIAlib29sIHNodXRkb3duOwogCWJvb2wgcmVzdGFydF9v
bl9zaHV0ZG93bjsKKwlib29sIHJ1bl9ndWVzdF9vbmNlOwogfTsKIAogc3RhdGljIHN0cnVjdCBr
dm1pX2ZlYXR1cmVzIGZlYXR1cmVzOwpAQCAtNzIsNiArNzMsNyBAQCBlbnVtIHsKIAlHVUVTVF9U
RVNUX0hZUEVSQ0FMTCwKIAlHVUVTVF9URVNUX01TUiwKIAlHVUVTVF9URVNUX1BGLAorCUdVRVNU
X1RFU1RfVk1GVU5DLAogCUdVRVNUX1RFU1RfWFNFVEJWLAogfTsKIApAQCAtMTMwLDYgKzEzMiwx
MyBAQCBzdGF0aWMgdm9pZCBndWVzdF9wZl90ZXN0KHZvaWQpCiAJKigodWludDhfdCAqKXRlc3Rf
Z3ZhKSA9IFJFQURfT05DRSh0ZXN0X3dyaXRlX3BhdHRlcm4pOwogfQogCitzdGF0aWMgdm9pZCBn
dWVzdF92bWZ1bmNfdGVzdCh2b2lkKQoreworCWFzbSB2b2xhdGlsZSgibW92ICQwLCAlcmF4Iik7
CisJYXNtIHZvbGF0aWxlKCJtb3YgJDEsICVyY3giKTsKKwlhc20gdm9sYXRpbGUoIi5ieXRlIDB4
MGYsMHgwMSwweGQ0Iik7Cit9CisKIC8qIGZyb20gZnB1L2ludGVybmFsLmggKi8KIHN0YXRpYyB1
NjQgeGdldGJ2KHUzMiBpbmRleCkKIHsKQEAgLTE5Myw2ICsyMDIsOSBAQCBzdGF0aWMgdm9pZCBn
dWVzdF9jb2RlKHZvaWQpCiAJCWNhc2UgR1VFU1RfVEVTVF9QRjoKIAkJCWd1ZXN0X3BmX3Rlc3Qo
KTsKIAkJCWJyZWFrOworCQljYXNlIEdVRVNUX1RFU1RfVk1GVU5DOgorCQkJZ3Vlc3Rfdm1mdW5j
X3Rlc3QoKTsKKwkJCWJyZWFrOwogCQljYXNlIEdVRVNUX1RFU1RfWFNFVEJWOgogCQkJZ3Vlc3Rf
eHNldGJ2X3Rlc3QoKTsKIAkJCWJyZWFrOwpAQCAtNzc3LDYgKzc4OSw3IEBAIHN0YXRpYyB2b2lk
IHRlc3RfbWVtb3J5X2FjY2VzcyhzdHJ1Y3Qga3ZtX3ZtICp2bSkKIHN0YXRpYyB2b2lkICp2Y3B1
X3dvcmtlcih2b2lkICpkYXRhKQogewogCXN0cnVjdCB2Y3B1X3dvcmtlcl9kYXRhICpjdHggPSBk
YXRhOworCWJvb2wgZmlyc3RfcnVuID0gZmFsc2U7CiAJc3RydWN0IGt2bV9ydW4gKnJ1bjsKIAog
CXJ1biA9IHZjcHVfc3RhdGUoY3R4LT52bSwgY3R4LT52Y3B1X2lkKTsKQEAgLTgwNSw2ICs4MTgs
MTMgQEAgc3RhdGljIHZvaWQgKnZjcHVfd29ya2VyKHZvaWQgKmRhdGEpCiAJCWlmIChIT1NUX1NF
TkRfVEVTVCh1YykpIHsKIAkJCXRlc3RfaWQgPSBSRUFEX09OQ0UoY3R4LT50ZXN0X2lkKTsKIAkJ
CXN5bmNfZ2xvYmFsX3RvX2d1ZXN0KGN0eC0+dm0sIHRlc3RfaWQpOworCQkJaWYgKHJ1bi0+ZXhp
dF9yZWFzb24gPT0gS1ZNX0VYSVRfSU8gJiYKKwkJCSAgICBjdHgtPnJ1bl9ndWVzdF9vbmNlKSB7
CisJCQkJaWYgKCFmaXJzdF9ydW4pCisJCQkJCWZpcnN0X3J1biA9IHRydWU7CisJCQkJZWxzZQor
CQkJCQlicmVhazsKKwkJCX0KIAkJfQogCX0KIApAQCAtMjE0MCw2ICsyMTYwLDEwMyBAQCBzdGF0
aWMgdm9pZCB0ZXN0X2NtZF92Y3B1X3NldF9lcHRfdmlldyhzdHJ1Y3Qga3ZtX3ZtICp2bSkKIAlz
ZXRfZXB0X3ZpZXcodm0sIG9sZF92aWV3KTsKIH0KIAorc3RhdGljIHZvaWQgY2hlY2tfZXhwZWN0
ZWRfdmlldyhzdHJ1Y3Qga3ZtX3ZtICp2bSwKKwkJCQlfX3UxNiBjaGVja192aWV3KQoreworCV9f
dTE2IGZvdW5kX3ZpZXcgPSBnZXRfZXB0X3ZpZXcodm0pOworCisJVEVTVF9BU1NFUlQoY2hlY2tf
dmlldyA9PSBmb3VuZF92aWV3LAorCQkJIlVuZXhwZWN0ZWQgRVBUIHZpZXcsIGZvdW5kIGVwdCB2
aWV3ICgldSksIGV4cGVjdGVkIHZpZXcgKCV1KVxuIiwKKwkJCWZvdW5kX3ZpZXcsIGNoZWNrX3Zp
ZXcpOworfQorCitzdGF0aWMgdm9pZCB0ZXN0X2d1ZXN0X3N3aXRjaF90b19pbnZpc2libGVfdmll
dyhzdHJ1Y3Qga3ZtX3ZtICp2bSkKK3sKKwlzdHJ1Y3QgdmNwdV93b3JrZXJfZGF0YSBkYXRhID0g
eworCQkudm0gPSB2bSwKKwkJLnZjcHVfaWQgPSBWQ1BVX0lELAorCQkuc2h1dGRvd24gPSB0cnVl
LAorCQkudGVzdF9pZCA9IEdVRVNUX1RFU1RfVk1GVU5DLAorCX07CisJcHRocmVhZF90IHZjcHVf
dGhyZWFkOworCXN0cnVjdCBrdm1fcmVncyByZWdzOworCV9fdTE2IHZpZXcgPSAwOworCisJY2hl
Y2tfZXhwZWN0ZWRfdmlldyh2bSwgdmlldyk7CisKKwl2Y3B1X3RocmVhZCA9IHN0YXJ0X3ZjcHVf
d29ya2VyKCZkYXRhKTsKKwl3YWl0X3ZjcHVfd29ya2VyKHZjcHVfdGhyZWFkKTsKKworCS8qCisJ
ICogTW92ZSB0byB0aGUgbmV4dCBpbnN0cnVjdGlvbiwgc28gdGhlIGd1ZXN0IHdvdWxkIG5vdAor
CSAqIHJlLWV4ZWN1dGUgVk1GVU5DIGFnYWluIHdoZW4gdmNwdV9ydW4oKSBpcyBjYWxsZWQuCisJ
ICovCisJdmNwdV9yZWdzX2dldCh2bSwgVkNQVV9JRCwgJnJlZ3MpOworCXJlZ3MucmlwICs9IDM7
CisJdmNwdV9yZWdzX3NldCh2bSwgVkNQVV9JRCwgJnJlZ3MpOworCisJY2hlY2tfZXhwZWN0ZWRf
dmlldyh2bSwgdmlldyk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfY29udHJvbF9lcHRfdmlldyhz
dHJ1Y3Qga3ZtX3ZtICp2bSwgX191MTYgdmlldywgYm9vbCB2aXNpYmxlKQoreworCXN0cnVjdCB7
CisJCXN0cnVjdCBrdm1pX21zZ19oZHIgaGRyOworCQlzdHJ1Y3Qga3ZtaV92Y3B1X2hkciB2Y3B1
X2hkcjsKKwkJc3RydWN0IGt2bWlfdmNwdV9jb250cm9sX2VwdF92aWV3IGNtZDsKKwl9IHJlcSA9
IHt9OworCisJcmVxLmNtZC52aWV3ID0gdmlldzsKKwlyZXEuY21kLnZpc2libGUgPSB2aXNpYmxl
OworCisJdGVzdF92Y3B1MF9jb21tYW5kKHZtLCBLVk1JX1ZDUFVfQ09OVFJPTF9FUFRfVklFVywK
KwkJCSAgICZyZXEuaGRyLCBzaXplb2YocmVxKSwgTlVMTCwgMCk7Cit9CisKK3N0YXRpYyB2b2lk
IGVuYWJsZV9lcHRfdmlld192aXNpYmlsaXR5KHN0cnVjdCBrdm1fdm0gKnZtLCBfX3UxNiB2aWV3
KQoreworCXRlc3RfY29udHJvbF9lcHRfdmlldyh2bSwgdmlldywgdHJ1ZSk7Cit9CisKK3N0YXRp
YyB2b2lkIGRpc2FibGVfZXB0X3ZpZXdfdmlzaWJpbGl0eShzdHJ1Y3Qga3ZtX3ZtICp2bSwgX191
MTYgdmlldykKK3sKKwl0ZXN0X2NvbnRyb2xfZXB0X3ZpZXcodm0sIHZpZXcsIGZhbHNlKTsKK30K
Kworc3RhdGljIHZvaWQgdGVzdF9ndWVzdF9zd2l0Y2hfdG9fdmlzaWJsZV92aWV3KHN0cnVjdCBr
dm1fdm0gKnZtKQoreworCXN0cnVjdCB2Y3B1X3dvcmtlcl9kYXRhIGRhdGEgPSB7CisJCS52bSA9
IHZtLAorCQkudmNwdV9pZCA9IFZDUFVfSUQsCisJCS5ydW5fZ3Vlc3Rfb25jZSA9IHRydWUsCisJ
CS50ZXN0X2lkID0gR1VFU1RfVEVTVF9WTUZVTkMsCisJfTsKKwlwdGhyZWFkX3QgdmNwdV90aHJl
YWQ7CisJX191MTYgb2xkX3ZpZXcgPSAwLCBuZXdfdmlldyA9IDE7CisKKwllbmFibGVfZXB0X3Zp
ZXdfdmlzaWJpbGl0eSh2bSwgbmV3X3ZpZXcpOworCisJdmNwdV90aHJlYWQgPSBzdGFydF92Y3B1
X3dvcmtlcigmZGF0YSk7CisJd2FpdF92Y3B1X3dvcmtlcih2Y3B1X3RocmVhZCk7CisKKwljaGVj
a19leHBlY3RlZF92aWV3KHZtLCBuZXdfdmlldyk7CisKKwlkaXNhYmxlX2VwdF92aWV3X3Zpc2li
aWxpdHkodm0sIG5ld192aWV3KTsKKworCXNldF9lcHRfdmlldyh2bSwgb2xkX3ZpZXcpOworfQor
CitzdGF0aWMgdm9pZCB0ZXN0X2NtZF92Y3B1X3ZtZnVuYyhzdHJ1Y3Qga3ZtX3ZtICp2bSkKK3sK
KwlpZiAoIWZlYXR1cmVzLnZtZnVuYykgeworCQlwcmludF9za2lwKCJFUFQgdmlld3Mgbm90IHN1
cHBvcnRlZCIpOworCQlyZXR1cm47CisJfQorCisJdGVzdF9ndWVzdF9zd2l0Y2hfdG9faW52aXNp
YmxlX3ZpZXcodm0pOworCXRlc3RfZ3Vlc3Rfc3dpdGNoX3RvX3Zpc2libGVfdmlldyh2bSk7Cit9
CisKIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIHsK
IAlzcmFuZG9tKHRpbWUoMCkpOwpAQCAtMjE3OCw2ICsyMjk1LDcgQEAgc3RhdGljIHZvaWQgdGVz
dF9pbnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtKQogCXRlc3RfY21kX3RyYW5zbGF0ZV9n
dmEodm0pOwogCXRlc3RfY21kX3ZjcHVfZ2V0X2VwdF92aWV3KHZtKTsKIAl0ZXN0X2NtZF92Y3B1
X3NldF9lcHRfdmlldyh2bSk7CisJdGVzdF9jbWRfdmNwdV92bWZ1bmModm0pOwogCiAJdW5ob29r
X2ludHJvc3BlY3Rpb24odm0pOwogfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlv
bi9rdm1pX2ludC5oIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCmluZGV4IGYw
OTNhYWQyZjgwNC4uZDc4MTE2NDQyZGRkIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0
aW9uL2t2bWlfaW50LmgKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCkBA
IC0xNDksNSArMTQ5LDcgQEAgYm9vbCBrdm1pX2FyY2hfc3RvcF9zaW5nbGVzdGVwKHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSk7CiBncGFfdCBrdm1pX2FyY2hfY21kX3RyYW5zbGF0ZV9ndmEoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1LCBndmFfdCBndmEpOwogdTE2IGt2bWlfYXJjaF9jbWRfZ2V0X2VwdF92
aWV3KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiBpbnQga3ZtaV9hcmNoX2NtZF9zZXRfZXB0X3Zp
ZXcoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MTYgdmlldyk7CitpbnQga3ZtaV9hcmNoX2NtZF9j
b250cm9sX2VwdF92aWV3KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTE2IHZpZXcsCisJCQkJICAg
Ym9vbCB2aXNpYmxlKTsKIAogI2VuZGlmCmRpZmYgLS1naXQgYS92aXJ0L2t2bS9pbnRyb3NwZWN0
aW9uL2t2bWlfbXNnLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMKaW5kZXgg
NzNhNzE3OWY3MDMxLi42OTY4NTdmNmQwMDggMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2ludHJvc3Bl
Y3Rpb24va3ZtaV9tc2cuYworKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMK
QEAgLTY5Myw2ICs2OTMsMjQgQEAgc3RhdGljIGludCBoYW5kbGVfdmNwdV9zZXRfZXB0X3ZpZXco
Y29uc3Qgc3RydWN0IGt2bWlfdmNwdV9tc2dfam9iICpqb2IsCiAJcmV0dXJuIGt2bWlfbXNnX3Zj
cHVfcmVwbHkoam9iLCBtc2csIGVjLCBOVUxMLCAwKTsKIH0KIAorc3RhdGljIGludCBoYW5kbGVf
dmNwdV9jb250cm9sX2VwdF92aWV3KGNvbnN0IHN0cnVjdCBrdm1pX3ZjcHVfbXNnX2pvYiAqam9i
LAorCQkJCQljb25zdCBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICptc2csCisJCQkJCWNvbnN0IHZvaWQg
Kl9yZXEpCit7CisJY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9jb250cm9sX2VwdF92aWV3ICpyZXEg
PSBfcmVxOworCWludCBlYzsKKworCWlmIChyZXEtPnBhZGRpbmcxIHx8IHJlcS0+cGFkZGluZzIp
CisJCWVjID0gLUtWTV9FSU5WQUw7CisJZWxzZSBpZiAoIWlzX3ZhbGlkX3ZpZXcocmVxLT52aWV3
KSkKKwkJZWMgPSAtS1ZNX0VJTlZBTDsKKwllbHNlCisJCWVjID0ga3ZtaV9hcmNoX2NtZF9jb250
cm9sX2VwdF92aWV3KGpvYi0+dmNwdSwgcmVxLT52aWV3LAorCQkJCQkJICAgIHJlcS0+dmlzaWJs
ZSk7CisKKwlyZXR1cm4ga3ZtaV9tc2dfdmNwdV9yZXBseShqb2IsIG1zZywgZWMsIE5VTEwsIDAp
OworfQorCiAvKgogICogVGhlc2UgZnVuY3Rpb25zIGFyZSBleGVjdXRlZCBmcm9tIHRoZSB2Q1BV
IHRocmVhZC4gVGhlIHJlY2VpdmluZyB0aHJlYWQKICAqIHBhc3NlcyB0aGUgbWVzc2FnZXMgdXNp
bmcgYSBuZXdseSBhbGxvY2F0ZWQgJ3N0cnVjdCBrdm1pX3ZjcHVfbXNnX2pvYicKQEAgLTcwMyw2
ICs3MjEsNyBAQCBzdGF0aWMgaW50KCpjb25zdCBtc2dfdmNwdVtdKShjb25zdCBzdHJ1Y3Qga3Zt
aV92Y3B1X21zZ19qb2IgKiwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKiwg
Y29uc3Qgdm9pZCAqKSA9IHsKIAlbS1ZNSV9FVkVOVF0gICAgICAgICAgICAgICAgICAgPSBoYW5k
bGVfdmNwdV9ldmVudF9yZXBseSwKIAlbS1ZNSV9WQ1BVX0NPTlRST0xfQ1JdICAgICAgICAgPSBo
YW5kbGVfdmNwdV9jb250cm9sX2NyLAorCVtLVk1JX1ZDUFVfQ09OVFJPTF9FUFRfVklFV10gICA9
IGhhbmRsZV92Y3B1X2NvbnRyb2xfZXB0X3ZpZXcsCiAJW0tWTUlfVkNQVV9DT05UUk9MX0VWRU5U
U10gICAgID0gaGFuZGxlX3ZjcHVfY29udHJvbF9ldmVudHMsCiAJW0tWTUlfVkNQVV9DT05UUk9M
X01TUl0gICAgICAgID0gaGFuZGxlX3ZjcHVfY29udHJvbF9tc3IsCiAJW0tWTUlfVkNQVV9DT05U
Uk9MX1NJTkdMRVNURVBdID0gaGFuZGxlX3ZjcHVfY29udHJvbF9zaW5nbGVzdGVwLApfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBt
YWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0
cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6
YXRpb24=
