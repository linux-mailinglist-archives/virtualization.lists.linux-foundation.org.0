Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
	by mail.lfdr.de (Postfix) with ESMTPS id 4519F71419F
	for <lists.virtualization@lfdr.de>; Mon, 29 May 2023 03:18:37 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id 2E0484154D;
	Mon, 29 May 2023 01:18:33 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org 2E0484154D
Authentication-Results: smtp4.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=Feq8zLCw
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 3XO1egSZm15c; Mon, 29 May 2023 01:18:31 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp4.osuosl.org (Postfix) with ESMTPS id 1E60F4156E;
	Mon, 29 May 2023 01:18:31 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org 1E60F4156E
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 51C69C008C;
	Mon, 29 May 2023 01:18:30 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 4D30DC002A
 for <virtualization@lists.linux-foundation.org>;
 Mon, 29 May 2023 01:18:28 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp3.osuosl.org (Postfix) with ESMTP id AE14A6009C
 for <virtualization@lists.linux-foundation.org>;
 Mon, 29 May 2023 01:18:27 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org AE14A6009C
Authentication-Results: smtp3.osuosl.org;
 dkim=pass (1024-bit key) header.d=redhat.com header.i=@redhat.com
 header.a=rsa-sha256 header.s=mimecast20190719 header.b=Feq8zLCw
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
 by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 9dcM-rtFASJx
 for <virtualization@lists.linux-foundation.org>;
 Mon, 29 May 2023 01:18:26 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 0AD3361086
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.129.124])
 by smtp3.osuosl.org (Postfix) with ESMTPS id 0AD3361086
 for <virtualization@lists.linux-foundation.org>;
 Mon, 29 May 2023 01:18:25 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1685323104;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=eblFPlaq16KL+mizindf7C3vSiGs+OM/q6C7RFT240I=;
 b=Feq8zLCwxlT/KEH6eW9nvRzSUdyHb7Qzy3u1hzIMhXSObNxOZ6xL4N9USDBv6BqEHrXGbY
 DSqTnpSjFQoER/gfSjYO3uwMVZj+ZuKDZK5WBs4QHz2h9DxCDPHyHO/bQ6c3UTRyqv3WqG
 VssSjyIn/A2YmJgA/nsFmYMNJz0NbQc=
Received: from mail-lf1-f69.google.com (mail-lf1-f69.google.com
 [209.85.167.69]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-353-v80H1UsDM6-H1lBkFgfudg-1; Sun, 28 May 2023 21:18:23 -0400
X-MC-Unique: v80H1UsDM6-H1lBkFgfudg-1
Received: by mail-lf1-f69.google.com with SMTP id
 2adb3069b0e04-4f3a517b5c6so2443153e87.0
 for <virtualization@lists.linux-foundation.org>;
 Sun, 28 May 2023 18:18:22 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20221208; t=1685323102; x=1687915102;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=eblFPlaq16KL+mizindf7C3vSiGs+OM/q6C7RFT240I=;
 b=JaXRQm2oVDg6ePLtc4oLR4tK95Xys70ynri6uT6NuceVJgkS6Ak2ZKnDmDq7lxpMy2
 SpnMbTSEZJ0wz9i5At5aJCg2WeUQBCSvpsKq2Ip/zBXZNchxBSPKo6REWb9cTHLwBLjh
 q6WsDYillWLGT0L76q3VZIpfMwE4JtZkutAndXxljrzGrpYj8eYj4GX7QQbICKY/0Nms
 0BSjMspBWYhoWAVFTbZKJxd4k2NiIih5KcvPKh9GNkoV3UP8vPzbOSPUBJe067WKi+ZL
 hQUN0ac4zNbaKCkREv7Abfhu4V8rECbimG0zU2PtFN+9UdVRmRLr6NByHK+kTYkTqQXC
 zlAA==
X-Gm-Message-State: AC+VfDxJH9SbGEIIBuHQ+tmSLq+QfTenfWzoV4eSLxA/pPTBuHbyuINK
 BMbTP8ReLJsQCBSZfTqvJxiXszbiCvJSysr/18DA4oTI6Jc5zaKxVegcsS0FS5+MksGxCNqHpiY
 DfP9gzjdRo4yTHTzq8m2vHdi05wZTxUsGr8XZZNofn9srTDuBL1cT7fK8sA==
X-Received: by 2002:ac2:5302:0:b0:4ed:d5ce:7dea with SMTP id
 c2-20020ac25302000000b004edd5ce7deamr2551687lfh.27.1685323101826; 
 Sun, 28 May 2023 18:18:21 -0700 (PDT)
X-Google-Smtp-Source: ACHHUZ41Kc2IRLRa46GHhEhaQcNXPtBe8XsKN3hW19JsWS6YC9J8+FjXW4yw5vMsreHs5ktg/b/aU22jptUoXpQ7r78=
X-Received: by 2002:ac2:5302:0:b0:4ed:d5ce:7dea with SMTP id
 c2-20020ac25302000000b004edd5ce7deamr2551680lfh.27.1685323101432; Sun, 28 May
 2023 18:18:21 -0700 (PDT)
MIME-Version: 1.0
References: <20230526063041.18359-1-jasowang@redhat.com>
 <20230528033037-mutt-send-email-mst@kernel.org>
In-Reply-To: <20230528033037-mutt-send-email-mst@kernel.org>
From: Jason Wang <jasowang@redhat.com>
Date: Mon, 29 May 2023 09:18:10 +0800
Message-ID: <CACGkMEs9Ztavn2JyuUAb47Sk1fYHiXLLkQQPQR5Czhb2yu_R3w@mail.gmail.com>
Subject: Re: [PATCH] virtio_ring: validate used buffer length
To: "Michael S. Tsirkin" <mst@redhat.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: xuanzhuo@linux.alibaba.com, linux-kernel@vger.kernel.org,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gU3VuLCBNYXkgMjgsIDIwMjMgYXQgMzo1N+KAr1BNIE1pY2hhZWwgUy4gVHNpcmtpbiA8bXN0
QHJlZGhhdC5jb20+IHdyb3RlOgo+Cj4gT24gRnJpLCBNYXkgMjYsIDIwMjMgYXQgMDI6MzA6NDFQ
TSArMDgwMCwgSmFzb24gV2FuZyB3cm90ZToKPiA+IFRoaXMgcGF0Y2ggdmFsaWRhdGUKPgo+IHZh
bGlkYXRlcwo+Cj4gPiB0aGUgdXNlZCBidWZmZXIgbGVuZ3RoIHByb3ZpZGVkIGJ5IHRoZSBkZXZp
Y2UKPiA+IGJlZm9yZSB0cnlpbmcgdG8gdXNlIGl0Lgo+Cj4gYmVmb3JlIHJldHVybmluZyBpdCB0
byBjYWxsZXIKPgo+ID4gVGhpcyBpcyBkb25lIGJ5IHJlbWVtYmVyaW5nIHRoZSBpbiBidWZmZXIK
PiA+IGxlbmd0aCBpbiBhIGRlZGljYXRlZCBhcnJheSBkdXJpbmcgdmlydHF1ZXVlX2FkZCgpLCB0
aGVuIHdlIGNhbiBmYWlsCj4gPiB0aGUgdmlydHF1ZXVlX2dldF9idWYoKSB3aGVuIHdlIGZpbmQg
dGhlIGRldmljZSBpcyB0cnlpbmcgdG8gZ2l2ZSB1cyBhCj4gPiB1c2VkIGJ1ZmZlciBsZW5ndGgg
d2hpY2ggaXMgZ3JlYXRlciB0aGFuIHdlIHN0b3JlZCBiZWZvcmUuCj4KPiB0aGFuIHdoYXQgd2Ug
c3RvcmVkCj4KPiA+Cj4gPiBUaGlzIHZhbGlkYXRpb24gaXMgZGlzYWJsZQo+Cj4gZGlzYWJsZWQK
Pgo+ID4gYnkgZGVmYXVsdCB2aWEgbW9kdWxlIHBhcmFtZXRlciB0byB1bmJyZWFrCj4gPiBzb21l
IGV4aXN0aW5nIGRldmljZXMgc2luY2Ugc29tZSBsZWdhY3kgZGV2aWNlcyBhcmUga25vd24gdG8g
cmVwb3J0Cj4gPiBidWdneSB1c2VkIGxlbmd0aC4KPiA+Cj4gPiBTaWduZWQtb2ZmLWJ5OiBKYXNv
biBXYW5nIDxqYXNvd2FuZ0ByZWRoYXQuY29tPgo+Cj4gRmlyc3QgSSdtIG5vdCBtZXJnaW5nIHRo
aXMgd2l0aG91dCBtb3JlIGRhdGEgYWJvdXQKPiB3aGF0IGlzIGtub3duIHRvIGJlIGJyb2tlbiBh
bmQgd2hhdCBpcyBrbm93biB0byB3b3JrIHdlbGwKPiBpbiB0aGUgY29tbWl0IGxvZy4gQW5kIGhv
dyBleGFjdGx5IGRvIHRoaW5ncyB3b3JrIGlmIHVzZWQgbGVuZ3RoCj4gaXMgd3Jvbmc/CgpBc3N1
bWluZyB0aGUgZGV2aWNlIGlzIG1hbGljaW91cywgaXQgd291bGQgYmUgdmVyeSBoYXJkIHRvIGFu
c3dlci4KQXVkaXRpbmcgYW5kIGZ1enppbmcgd29uJ3QgY292ZXIgZXZlcnkgY2FzZS4gSW5zdGVh
ZCBvZiB0cnlpbmcgdG8gc2Vlawp0aGUgYW5zd2VyLCB3ZSBjYW4gc2ltcGx5IG1ha2Ugc3VyZSB0
aGUgdXNlZCBpbiBidWZmZXIgbGVuZ3RoIGlzCnZhbGlkYXRlZCB0aGVuIHdlIGtub3cgd2UncmUg
ZmluZSBvciBub3QuCgo+IFNlY29uZCB3aGF0J3Mgd3Jvbmcgd2l0aCBkbWFfZGVzY19leHRyYSB0
aGF0IHdlIGFscmVhZHkgbWFpbnRhaW4/Cj4gVGhpcmQgbW90aXZhdGlvbiAtIGl0J3MgcGFydCBh
bmQgcGFyY2VsIG9mIHRoZSBoYXJkZW5pbmcgZWZmb3J0IHllcz8KClRoZXkgYXJlIGRpZmZlcmVu
dC4gZG1hX2Rlc2NfZXh0cmEgaXMgZm9yIGEgZGVzY3JpcHRvciByaW5nLCBidXQgdGhpcwppcyBm
b3IgYSB1c2VkIHJpbmcuIFRlY2huaWNhbGx5IHdlIGNhbiBnbyBiYWNrIHRvIGl0ZXJhdGUgb24g
dGhlCmRlc2NyaXB0b3IgcmluZyBmb3IgYSBsZWdhbCB1c2VkIGluIGJ1ZmZlciBsZW5ndGguIEJ1
dCBpdCB3aWxsIGhhdmUKd29yc2UgcGVyZm9ybWFuY2UuCgo+IEknZCBsaWtlIHRvIGtub3cgdGhl
IGZhdGUgb2YgVklSVElPX0hBUkRFTl9OT1RJRklDQVRJT04gYmVmb3JlCj4gd2UgZG8gbW9yZSBo
YXJkZW5pbmcuIElmIGl0J3MgaXJyZXZvY2FibHkgYnJva2VuIGxldCdzIHJpcCBpdCBvdXQ/CgpT
byB0aGUgcGxhbiBpcwoKMSkgZmluaXNoIHVzZWQgcmluZyB2YWxpZGF0aW9uICh0aGlzIGhhZCBi
ZWVuIHByb3Bvc2VkLCBtZXJnZWQgYW5kCnJldmVydGVkIGJlZm9yZSBub3RpZmljYXRpb24gaGFy
ZGVuaW5nKQoyKSBkbyBub3RpZmljYXRpb24gaGFyZGVuaW5nIG9uIHRvcC4KClNvIGxldCdzIGxl
YXZlIGl0IGFzIGlzIGFuZCBJIHdpbGwgZG8gYSByZXdvcmsgYWZ0ZXIgd2UgZmluYWxpemUgdGhl
CnVzZWQgcmluZyB2YWxpZGF0aW9uLgoKVGhhbmtzCgo+Cj4KPiA+IC0tLQo+ID4gQ2hhbmdlcyBz
aW5jZSBWNDoKPiA+IC0gZHJvcCB0aGUgZmxhdCBmb3IgZHJpdmVyIHRvIHN1cHByZXNzIHRoZSBj
aGVjawo+ID4gLSB2YWxpZGF0aW9uIGlzIGRpc2FibGVkIGJ5IGRlZmF1bHQKPiA+IC0gZG9uJ3Qg
ZG8gdmFsaWRhdGlvbiBmb3IgbGVnYWN5IGRldmljZQo+ID4gLSByZWJhc2UgYW5kIHN1cHBvcnQg
dmlydHF1ZXVlIHJlc2l6ZQo+ID4gLS0tCj4gPiAgZHJpdmVycy92aXJ0aW8vdmlydGlvX3Jpbmcu
YyB8IDc1ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwo+ID4gIDEgZmlsZSBj
aGFuZ2VkLCA3NSBpbnNlcnRpb25zKCspCj4gPgo+ID4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmly
dGlvL3ZpcnRpb19yaW5nLmMgYi9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fcmluZy5jCj4gPiBpbmRl
eCAxNDNmMzgwYmFhMWMuLjViMTUxNjA1YWFmOCAxMDA2NDQKPiA+IC0tLSBhL2RyaXZlcnMvdmly
dGlvL3ZpcnRpb19yaW5nLmMKPiA+ICsrKyBiL2RyaXZlcnMvdmlydGlvL3ZpcnRpb19yaW5nLmMK
PiA+IEBAIC0xNSw2ICsxNSw5IEBACj4gPiAgI2luY2x1ZGUgPGxpbnV4L3NwaW5sb2NrLmg+Cj4g
PiAgI2luY2x1ZGUgPHhlbi94ZW4uaD4KPiA+Cj4gPiArc3RhdGljIGJvb2wgZm9yY2VfdXNlZF92
YWxpZGF0aW9uID0gZmFsc2U7Cj4gPiArbW9kdWxlX3BhcmFtKGZvcmNlX3VzZWRfdmFsaWRhdGlv
biwgYm9vbCwgMDQ0NCk7Cj4gPiArCj4gPiAgI2lmZGVmIERFQlVHCj4gPiAgLyogRm9yIGRldmVs
b3BtZW50LCB3ZSB3YW50IHRvIGNyYXNoIHdoZW5ldmVyIHRoZSByaW5nIGlzIHNjcmV3ZWQuICov
Cj4gPiAgI2RlZmluZSBCQURfUklORyhfdnEsIGZtdCwgYXJncy4uLikgICAgICAgICAgICAgICAg
ICAgICAgICAgIFwKPiA+IEBAIC0xMDUsNiArMTA4LDkgQEAgc3RydWN0IHZyaW5nX3ZpcnRxdWV1
ZV9zcGxpdCB7Cj4gPiAgICAgICBzdHJ1Y3QgdnJpbmdfZGVzY19zdGF0ZV9zcGxpdCAqZGVzY19z
dGF0ZTsKPiA+ICAgICAgIHN0cnVjdCB2cmluZ19kZXNjX2V4dHJhICpkZXNjX2V4dHJhOwo+ID4K
PiA+ICsgICAgIC8qIE1heGltdW0gaW4gYnVmZmVyIGxlbmd0aCwgTlVMTCBtZWFucyBubyB1c2Vk
IHZhbGlkYXRpb24gKi8KPiA+ICsgICAgIHUzMiAqYnVmbGVuOwo+ID4gKwo+ID4gICAgICAgLyog
RE1BIGFkZHJlc3MgYW5kIHNpemUgaW5mb3JtYXRpb24gKi8KPiA+ICAgICAgIGRtYV9hZGRyX3Qg
cXVldWVfZG1hX2FkZHI7Cj4gPiAgICAgICBzaXplX3QgcXVldWVfc2l6ZV9pbl9ieXRlczsKPiA+
IEBAIC0xNDUsNiArMTUxLDkgQEAgc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZV9wYWNrZWQgewo+ID4g
ICAgICAgc3RydWN0IHZyaW5nX2Rlc2Nfc3RhdGVfcGFja2VkICpkZXNjX3N0YXRlOwo+ID4gICAg
ICAgc3RydWN0IHZyaW5nX2Rlc2NfZXh0cmEgKmRlc2NfZXh0cmE7Cj4gPgo+ID4gKyAgICAgLyog
TWF4aW11bSBpbiBidWZmZXIgbGVuZ3RoLCBOVUxMIG1lYW5zIG5vIHVzZWQgdmFsaWRhdGlvbiAq
Lwo+ID4gKyAgICAgdTMyICpidWZsZW47Cj4gPiArCj4gPiAgICAgICAvKiBETUEgYWRkcmVzcyBh
bmQgc2l6ZSBpbmZvcm1hdGlvbiAqLwo+ID4gICAgICAgZG1hX2FkZHJfdCByaW5nX2RtYV9hZGRy
Owo+ID4gICAgICAgZG1hX2FkZHJfdCBkcml2ZXJfZXZlbnRfZG1hX2FkZHI7Cj4gPiBAQCAtNTUy
LDYgKzU2MSw3IEBAIHN0YXRpYyBpbmxpbmUgaW50IHZpcnRxdWV1ZV9hZGRfc3BsaXQoc3RydWN0
IHZpcnRxdWV1ZSAqX3ZxLAo+ID4gICAgICAgdW5zaWduZWQgaW50IGksIG4sIGF2YWlsLCBkZXNj
c191c2VkLCBwcmV2LCBlcnJfaWR4Owo+ID4gICAgICAgaW50IGhlYWQ7Cj4gPiAgICAgICBib29s
IGluZGlyZWN0Owo+ID4gKyAgICAgdTMyIGJ1ZmxlbiA9IDA7Cj4gPgo+ID4gICAgICAgU1RBUlRf
VVNFKHZxKTsKPiA+Cj4gPiBAQCAtNjM1LDYgKzY0NSw3IEBAIHN0YXRpYyBpbmxpbmUgaW50IHZp
cnRxdWV1ZV9hZGRfc3BsaXQoc3RydWN0IHZpcnRxdWV1ZSAqX3ZxLAo+ID4gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVlJJTkdfREVTQ19GX05FWFQg
fAo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
VlJJTkdfREVTQ19GX1dSSVRFLAo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgaW5kaXJlY3QpOwo+ID4gKyAgICAgICAgICAgICAgICAgICAgIGJ1
ZmxlbiArPSBzZy0+bGVuZ3RoOwo+ID4gICAgICAgICAgICAgICB9Cj4gPiAgICAgICB9Cj4gPiAg
ICAgICAvKiBMYXN0IG9uZSBkb2Vzbid0IGNvbnRpbnVlLiAqLwo+ID4gQEAgLTY3NSw2ICs2ODYs
MTAgQEAgc3RhdGljIGlubGluZSBpbnQgdmlydHF1ZXVlX2FkZF9zcGxpdChzdHJ1Y3QgdmlydHF1
ZXVlICpfdnEsCj4gPiAgICAgICBlbHNlCj4gPiAgICAgICAgICAgICAgIHZxLT5zcGxpdC5kZXNj
X3N0YXRlW2hlYWRdLmluZGlyX2Rlc2MgPSBjdHg7Cj4gPgo+ID4gKyAgICAgLyogU3RvcmUgaW4g
YnVmZmVyIGxlbmd0aCBpZiBuZWNlc3NhcnkgKi8KPiA+ICsgICAgIGlmICh2cS0+c3BsaXQuYnVm
bGVuKQo+ID4gKyAgICAgICAgICAgICB2cS0+c3BsaXQuYnVmbGVuW2hlYWRdID0gYnVmbGVuOwo+
ID4gKwo+ID4gICAgICAgLyogUHV0IGVudHJ5IGluIGF2YWlsYWJsZSBhcnJheSAoYnV0IGRvbid0
IHVwZGF0ZSBhdmFpbC0+aWR4IHVudGlsIHRoZXkKPiA+ICAgICAgICAqIGRvIHN5bmMpLiAqLwo+
ID4gICAgICAgYXZhaWwgPSB2cS0+c3BsaXQuYXZhaWxfaWR4X3NoYWRvdyAmICh2cS0+c3BsaXQu
dnJpbmcubnVtIC0gMSk7Cj4gPiBAQCAtODYxLDYgKzg3NiwxMSBAQCBzdGF0aWMgdm9pZCAqdmly
dHF1ZXVlX2dldF9idWZfY3R4X3NwbGl0KHN0cnVjdCB2aXJ0cXVldWUgKl92cSwKPiA+ICAgICAg
ICAgICAgICAgQkFEX1JJTkcodnEsICJpZCAldSBpcyBub3QgYSBoZWFkIVxuIiwgaSk7Cj4gPiAg
ICAgICAgICAgICAgIHJldHVybiBOVUxMOwo+ID4gICAgICAgfQo+ID4gKyAgICAgaWYgKHZxLT5z
cGxpdC5idWZsZW4gJiYgdW5saWtlbHkoKmxlbiA+IHZxLT5zcGxpdC5idWZsZW5baV0pKSB7Cj4g
PiArICAgICAgICAgICAgIEJBRF9SSU5HKHZxLCAidXNlZCBsZW4gJWQgaXMgbGFyZ2VyIHRoYW4g
bWF4IGluIGJ1ZmZlciBsZW4gJXVcbiIsCj4gPiArICAgICAgICAgICAgICAgICAgICAgKmxlbiwg
dnEtPnNwbGl0LmJ1ZmxlbltpXSk7Cj4gPiArICAgICAgICAgICAgIHJldHVybiBOVUxMOwo+ID4g
KyAgICAgfQo+ID4KPiA+ICAgICAgIC8qIGRldGFjaF9idWZfc3BsaXQgY2xlYXJzIGRhdGEsIHNv
IGdyYWIgaXQgbm93LiAqLwo+ID4gICAgICAgcmV0ID0gdnEtPnNwbGl0LmRlc2Nfc3RhdGVbaV0u
ZGF0YTsKPiA+IEBAIC0xMDg1LDEwICsxMTA1LDI1IEBAIHN0YXRpYyB2b2lkIHZyaW5nX2ZyZWVf
c3BsaXQoc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZV9zcGxpdCAqdnJpbmdfc3BsaXQsCj4gPiAgICAg
ICAgICAgICAgICAgICAgICAgIHZyaW5nX3NwbGl0LT5xdWV1ZV9kbWFfYWRkciwKPiA+ICAgICAg
ICAgICAgICAgICAgICAgICAgZG1hX2Rldik7Cj4gPgo+ID4gKyAgICAga2ZyZWUodnJpbmdfc3Bs
aXQtPmJ1Zmxlbik7Cj4gPiAgICAgICBrZnJlZSh2cmluZ19zcGxpdC0+ZGVzY19zdGF0ZSk7Cj4g
PiAgICAgICBrZnJlZSh2cmluZ19zcGxpdC0+ZGVzY19leHRyYSk7Cj4gPiAgfQo+ID4KPiA+ICtz
dGF0aWMgYm9vbCB2cmluZ19uZWVkc191c2VkX3ZhbGlkYXRpb24oY29uc3Qgc3RydWN0IHZpcnRp
b19kZXZpY2UgKnZkZXYpCj4gPiArewo+ID4gKyAgICAgLyoKPiA+ICsgICAgICAqIFNldmVyYWwg
bGVnYWN5IGRldmljZXMgYXJlIGtub3duIHRvIHByb2R1Y2UgYnVnZ3kgdXNlZAo+ID4gKyAgICAg
ICogbGVuZ3RoLiBJbiBvcmRlciB0byBsZXQgZHJpdmVyIHdvcmssIHdlIHdvbid0IHZhbGlkYXRl
IHVzZWQKPiA+ICsgICAgICAqIGJ1ZmZlciBsZW5ndGggaW4gdGhpcyBjYXNlLgo+ID4gKyAgICAg
ICovCj4gPiArICAgICBpZiAoIXZpcnRpb19oYXNfZmVhdHVyZSh2ZGV2LCBWSVJUSU9fRl9WRVJT
SU9OXzEpKQo+ID4gKyAgICAgICAgICAgICByZXR1cm4gZmFsc2U7Cj4gPiArICAgICBpZiAoZm9y
Y2VfdXNlZF92YWxpZGF0aW9uKQo+ID4gKyAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKPiA+ICsg
ICAgIHJldHVybiBmYWxzZTsKPiA+ICt9Cj4gPiArCj4gPiAgc3RhdGljIGludCB2cmluZ19hbGxv
Y19xdWV1ZV9zcGxpdChzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVlX3NwbGl0ICp2cmluZ19zcGxpdCwK
PiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZGV2aWNl
ICp2ZGV2LAo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdTMyIG51bSwKPiA+
IEBAIC0xMTM3LDcgKzExNzIsMTkgQEAgc3RhdGljIGludCB2cmluZ19hbGxvY19xdWV1ZV9zcGxp
dChzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVlX3NwbGl0ICp2cmluZ19zcGxpdCwKPiA+ICAgICAgIHZy
aW5nX3NwbGl0LT52cmluZ19hbGlnbiA9IHZyaW5nX2FsaWduOwo+ID4gICAgICAgdnJpbmdfc3Bs
aXQtPm1heV9yZWR1Y2VfbnVtID0gbWF5X3JlZHVjZV9udW07Cj4gPgo+ID4gKyAgICAgaWYgKHZy
aW5nX25lZWRzX3VzZWRfdmFsaWRhdGlvbih2ZGV2KSkgewo+ID4gKyAgICAgICAgICAgICB2cmlu
Z19zcGxpdC0+YnVmbGVuID0KPiA+ICsgICAgICAgICAgICAgICAgICAgICBrbWFsbG9jX2FycmF5
KG51bSwgc2l6ZW9mKCp2cmluZ19zcGxpdC0+YnVmbGVuKSwKPiA+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIEdGUF9LRVJORUwpOwo+ID4gKyAgICAgICAgICAgICBpZiAoIXZy
aW5nX3NwbGl0LT5idWZsZW4pCj4gPiArICAgICAgICAgICAgICAgICAgICAgZ290byBlcnJfYnVm
bGVuOwo+ID4gKyAgICAgfQo+ID4gKwo+ID4gICAgICAgcmV0dXJuIDA7Cj4gPiArCj4gPiArZXJy
X2J1ZmxlbjoKPiA+ICsgICAgIHZyaW5nX2ZyZWVfc3BsaXQodnJpbmdfc3BsaXQsIHZkZXYsIGRt
YV9kZXYpOwo+ID4gKyAgICAgcmV0dXJuIC1FTk9NRU07Cj4gPiAgfQo+ID4KPiA+ICBzdGF0aWMg
c3RydWN0IHZpcnRxdWV1ZSAqdnJpbmdfY3JlYXRlX3ZpcnRxdWV1ZV9zcGxpdCgKPiA+IEBAIC0x
Mjk3LDYgKzEzNDQsNyBAQCBzdGF0aWMgaW50IHZpcnRxdWV1ZV9hZGRfaW5kaXJlY3RfcGFja2Vk
KHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxLAo+ID4gICAgICAgdW5zaWduZWQgaW50IGksIG4s
IGVycl9pZHg7Cj4gPiAgICAgICB1MTYgaGVhZCwgaWQ7Cj4gPiAgICAgICBkbWFfYWRkcl90IGFk
ZHI7Cj4gPiArICAgICB1MzIgYnVmbGVuID0gMDsKPiA+Cj4gPiAgICAgICBoZWFkID0gdnEtPnBh
Y2tlZC5uZXh0X2F2YWlsX2lkeDsKPiA+ICAgICAgIGRlc2MgPSBhbGxvY19pbmRpcmVjdF9wYWNr
ZWQodG90YWxfc2csIGdmcCk7Cj4gPiBAQCAtMTMyNSw2ICsxMzczLDggQEAgc3RhdGljIGludCB2
aXJ0cXVldWVfYWRkX2luZGlyZWN0X3BhY2tlZChzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVlICp2cSwK
PiA+ICAgICAgICAgICAgICAgICAgICAgICBkZXNjW2ldLmFkZHIgPSBjcHVfdG9fbGU2NChhZGRy
KTsKPiA+ICAgICAgICAgICAgICAgICAgICAgICBkZXNjW2ldLmxlbiA9IGNwdV90b19sZTMyKHNn
LT5sZW5ndGgpOwo+ID4gICAgICAgICAgICAgICAgICAgICAgIGkrKzsKPiA+ICsgICAgICAgICAg
ICAgICAgICAgICBpZiAobiA+PSBvdXRfc2dzKQo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgYnVmbGVuICs9IHNnLT5sZW5ndGg7Cj4gPiAgICAgICAgICAgICAgIH0KPiA+ICAgICAg
IH0KPiA+Cj4gPiBAQCAtMTM3OSw2ICsxNDI5LDEwIEBAIHN0YXRpYyBpbnQgdmlydHF1ZXVlX2Fk
ZF9pbmRpcmVjdF9wYWNrZWQoc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAqdnEsCj4gPiAgICAgICB2
cS0+cGFja2VkLmRlc2Nfc3RhdGVbaWRdLmxhc3QgPSBpZDsKPiA+ICAgICAgIHZxLT5wYWNrZWQu
ZGVzY19zdGF0ZVtpZF0ucHJlbWFwcGVkID0gcHJlbWFwcGVkOwo+ID4KPiA+ICsgICAgIC8qIFN0
b3JlIGluIGJ1ZmZlciBsZW5ndGggaWYgbmVjZXNzYXJ5ICovCj4gPiArICAgICBpZiAodnEtPnBh
Y2tlZC5idWZsZW4pCj4gPiArICAgICAgICAgICAgIHZxLT5wYWNrZWQuYnVmbGVuW2lkXSA9IGJ1
ZmxlbjsKPiA+ICsKPiA+ICAgICAgIHZxLT5udW1fYWRkZWQgKz0gMTsKPiA+Cj4gPiAgICAgICBw
cl9kZWJ1ZygiQWRkZWQgYnVmZmVyIGhlYWQgJWkgdG8gJXBcbiIsIGhlYWQsIHZxKTsKPiA+IEBA
IC0xNDE2LDYgKzE0NzAsNyBAQCBzdGF0aWMgaW5saW5lIGludCB2aXJ0cXVldWVfYWRkX3BhY2tl
ZChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEsCj4gPiAgICAgICBfX2xlMTYgaGVhZF9mbGFncywgZmxh
Z3M7Cj4gPiAgICAgICB1MTYgaGVhZCwgaWQsIHByZXYsIGN1cnIsIGF2YWlsX3VzZWRfZmxhZ3M7
Cj4gPiAgICAgICBpbnQgZXJyOwo+ID4gKyAgICAgdTMyIGJ1ZmxlbiA9IDA7Cj4gPgo+ID4gICAg
ICAgU1RBUlRfVVNFKHZxKTsKPiA+Cj4gPiBAQCAtMTQ5OCw2ICsxNTUzLDggQEAgc3RhdGljIGlu
bGluZSBpbnQgdmlydHF1ZXVlX2FkZF9wYWNrZWQoc3RydWN0IHZpcnRxdWV1ZSAqX3ZxLAo+ID4g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxIDw8IFZSSU5HX1BBQ0tFRF9E
RVNDX0ZfQVZBSUwgfAo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAx
IDw8IFZSSU5HX1BBQ0tFRF9ERVNDX0ZfVVNFRDsKPiA+ICAgICAgICAgICAgICAgICAgICAgICB9
Cj4gPiArICAgICAgICAgICAgICAgICAgICAgaWYgKG4gPj0gb3V0X3NncykKPiA+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGJ1ZmxlbiArPSBzZy0+bGVuZ3RoOwo+ID4gICAgICAgICAg
ICAgICB9Cj4gPiAgICAgICB9Cj4gPgo+ID4gQEAgLTE1MTgsNiArMTU3NSwxMCBAQCBzdGF0aWMg
aW5saW5lIGludCB2aXJ0cXVldWVfYWRkX3BhY2tlZChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEsCj4g
PiAgICAgICB2cS0+cGFja2VkLmRlc2Nfc3RhdGVbaWRdLmxhc3QgPSBwcmV2Owo+ID4gICAgICAg
dnEtPnBhY2tlZC5kZXNjX3N0YXRlW2lkXS5wcmVtYXBwZWQgPSBwcmVtYXBwZWQ7Cj4gPgo+ID4g
KyAgICAgLyogU3RvcmUgaW4gYnVmZmVyIGxlbmd0aCBpZiBuZWNlc3NhcnkgKi8KPiA+ICsgICAg
IGlmICh2cS0+cGFja2VkLmJ1ZmxlbikKPiA+ICsgICAgICAgICAgICAgdnEtPnBhY2tlZC5idWZs
ZW5baWRdID0gYnVmbGVuOwo+ID4gKwo+ID4gICAgICAgLyoKPiA+ICAgICAgICAqIEEgZHJpdmVy
IE1VU1QgTk9UIG1ha2UgdGhlIGZpcnN0IGRlc2NyaXB0b3IgaW4gdGhlIGxpc3QKPiA+ICAgICAg
ICAqIGF2YWlsYWJsZSBiZWZvcmUgYWxsIHN1YnNlcXVlbnQgZGVzY3JpcHRvcnMgY29tcHJpc2lu
Zwo+ID4gQEAgLTE3MTgsNiArMTc3OSwxMSBAQCBzdGF0aWMgdm9pZCAqdmlydHF1ZXVlX2dldF9i
dWZfY3R4X3BhY2tlZChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEsCj4gPiAgICAgICAgICAgICAgIEJB
RF9SSU5HKHZxLCAiaWQgJXUgaXMgbm90IGEgaGVhZCFcbiIsIGlkKTsKPiA+ICAgICAgICAgICAg
ICAgcmV0dXJuIE5VTEw7Cj4gPiAgICAgICB9Cj4gPiArICAgICBpZiAodnEtPnBhY2tlZC5idWZs
ZW4gJiYgdW5saWtlbHkoKmxlbiA+IHZxLT5wYWNrZWQuYnVmbGVuW2lkXSkpIHsKPiA+ICsgICAg
ICAgICAgICAgQkFEX1JJTkcodnEsICJ1c2VkIGxlbiAlZCBpcyBsYXJnZXIgdGhhbiBtYXggaW4g
YnVmZmVyIGxlbiAldVxuIiwKPiA+ICsgICAgICAgICAgICAgICAgICAgICAqbGVuLCB2cS0+cGFj
a2VkLmJ1ZmxlbltpZF0pOwo+ID4gKyAgICAgICAgICAgICByZXR1cm4gTlVMTDsKPiA+ICsgICAg
IH0KPiA+Cj4gPiAgICAgICAvKiBkZXRhY2hfYnVmX3BhY2tlZCBjbGVhcnMgZGF0YSwgc28gZ3Jh
YiBpdCBub3cuICovCj4gPiAgICAgICByZXQgPSB2cS0+cGFja2VkLmRlc2Nfc3RhdGVbaWRdLmRh
dGE7Cj4gPiBAQCAtMTkzNyw2ICsyMDAzLDcgQEAgc3RhdGljIHZvaWQgdnJpbmdfZnJlZV9wYWNr
ZWQoc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZV9wYWNrZWQgKnZyaW5nX3BhY2tlZCwKPiA+ICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB2cmluZ19wYWNrZWQtPmRldmljZV9ldmVudF9kbWFf
YWRkciwKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbWFfZGV2KTsKPiA+Cj4g
PiArICAgICBrZnJlZSh2cmluZ19wYWNrZWQtPmJ1Zmxlbik7Cj4gPiAgICAgICBrZnJlZSh2cmlu
Z19wYWNrZWQtPmRlc2Nfc3RhdGUpOwo+ID4gICAgICAga2ZyZWUodnJpbmdfcGFja2VkLT5kZXNj
X2V4dHJhKTsKPiA+ICB9Cj4gPiBAQCAtMTk4OCw2ICsyMDU1LDE0IEBAIHN0YXRpYyBpbnQgdnJp
bmdfYWxsb2NfcXVldWVfcGFja2VkKHN0cnVjdCB2cmluZ192aXJ0cXVldWVfcGFja2VkICp2cmlu
Z19wYWNrZWQsCj4gPgo+ID4gICAgICAgdnJpbmdfcGFja2VkLT52cmluZy5udW0gPSBudW07Cj4g
Pgo+ID4gKyAgICAgaWYgKHZyaW5nX25lZWRzX3VzZWRfdmFsaWRhdGlvbih2ZGV2KSkgewo+ID4g
KyAgICAgICAgICAgICB2cmluZ19wYWNrZWQtPmJ1ZmxlbiA9Cj4gPiArICAgICAgICAgICAgICAg
ICAgICAga21hbGxvY19hcnJheShudW0sIHNpemVvZigqdnJpbmdfcGFja2VkLT5idWZsZW4pLAo+
ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0ZQX0tFUk5FTCk7Cj4gPiAr
ICAgICAgICAgICAgIGlmICghdnJpbmdfcGFja2VkLT5idWZsZW4pCj4gPiArICAgICAgICAgICAg
ICAgICAgICAgZ290byBlcnI7Cj4gPiArICAgICB9Cj4gPiArCj4gPiAgICAgICByZXR1cm4gMDsK
PiA+Cj4gPiAgZXJyOgo+ID4gLS0KPiA+IDIuMjUuMQo+CgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmly
dHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51
eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
