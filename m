Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
	by mail.lfdr.de (Postfix) with ESMTPS id 47157228B99
	for <lists.virtualization@lfdr.de>; Tue, 21 Jul 2020 23:46:05 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by silver.osuosl.org (Postfix) with ESMTP id 0CF9420766;
	Tue, 21 Jul 2020 21:46:03 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id kr7LUPF5O-0P; Tue, 21 Jul 2020 21:45:58 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by silver.osuosl.org (Postfix) with ESMTP id C6A98220FB;
	Tue, 21 Jul 2020 21:45:58 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id AB34DC08A2;
	Tue, 21 Jul 2020 21:45:58 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 41B00C08A9
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:45:56 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id ED326882BB
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:45:55 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id W5-BlVYngwa3
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:45:53 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id E9B708824F
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:45:52 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 4989F305D59A; Wed, 22 Jul 2020 00:09:27 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 29330304FA14;
 Wed, 22 Jul 2020 00:09:27 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v9 52/84] KVM: introspection: add KVMI_VCPU_PAUSE
Date: Wed, 22 Jul 2020 00:08:50 +0300
Message-Id: <20200721210922.7646-53-alazar@bitdefender.com>
In-Reply-To: <20200721210922.7646-1-alazar@bitdefender.com>
References: <20200721210922.7646-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>, virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhpcyBpcyB0aGUgb25seSB2Q1BVIGNvbW1hbmQgaGFuZGxlZCBieSB0aGUgcmVjZWl2aW5nIHRo
cmVhZC4KSXQgaW5jcmVtZW50cyBhIHBhdXNlIHJlcXVlc3RzIGNvdW50ZXIgYW5kIGtpY2tzIHRo
ZSB2Q1BVIG91dCBvZiBndWVzdC4KClRoZSBpbnRyb3NwZWN0aW9uIHRvb2wgY2FuIHBhdXNlIGEg
Vk0gYnkgc2VuZGluZyB0aGlzIGNvbW1hbmQgdG8gYWxsCnZDUFVzLiBJZiBpdCBzZXRzICd3YWl0
PTEnLCBpdCBjYW4gY29uc2lkZXIgdGhhdCB0aGUgVk0gaXMgcGF1c2VkIHdoZW4KaXQgcmVjZWl2
ZXMgdGhlIHJlcGx5IGZvciBsYXN0IEtWTUlfVkNQVV9QQVVTRSBjb21tYW5kLgoKVXN1YWxseSwg
YSB2Q1BVIGNvbW1hbmQgaXMgZGlzcGF0Y2hlZCB0byB0aGUgdkNQVSB0aHJlYWQgYWZ0ZXIgYmVp
bmcgcmVhZApmcm9tIHNvY2tldC4gVGhpcyBuZXcgY29tbWFuZCBvbmx5IHNpZ25hbHMgdGhlIHZD
UFUuIE9uY2Ugb3V0IG9mIGd1ZXN0LAp0aGUgdkNQVSB3aWxsIHNlbmQgdGhlIGV2ZW50IHRoYXQg
Y2F1c2VkIHRoZSBWTS1leGlzdCAoaWYgaXQgaXMgdGhlIGNhc2UpLApoYW5kbGUgdGhlIHF1ZXVl
ZCBjb21tYW5kcyBhbmQgb25seSB0aGVuIGNoZWNrcyBpdHMgcGF1c2UgY291bnRlciBpbgpvcmRl
ciB0byBzZW5kIHRoZSBwYXVzZSBldmVudHMgcmVxdWVzdGVkIGJ5IHRoZSBpbnRyb3NwZWN0aW9u
IHRvb2wuCgpTaWduZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRl
ci5jb20+Ci0tLQogRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCAgICAgICAgICAgICAg
IHwgNjYgKysrKysrKysrKysrKysrKysrLQogaW5jbHVkZS9saW51eC9rdm1pX2hvc3QuaCAgICAg
ICAgICAgICAgICAgICAgIHwgIDIgKwogaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaCAgICAgICAg
ICAgICAgICAgICAgIHwgMTEgKysrLQogLi4uL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQv
a3ZtaV90ZXN0LmMgIHwgNTMgKysrKysrKysrKysrKysrCiB2aXJ0L2t2bS9pbnRyb3NwZWN0aW9u
L2t2bWkuYyAgICAgICAgICAgICAgICAgfCA2MyArKysrKysrKysrKysrKysrLS0KIHZpcnQva3Zt
L2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCAgICAgICAgICAgICB8ICAxICsKIHZpcnQva3ZtL2lu
dHJvc3BlY3Rpb24va3ZtaV9tc2cuYyAgICAgICAgICAgICB8IDQyICsrKysrKysrKysrKwogNyBm
aWxlcyBjaGFuZ2VkLCAyMzIgaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0
L2t2bS9rdm1pLnJzdAppbmRleCA1ZWFkMjlhN2IyYTcuLjUwMmVlMDZkNWU3NyAxMDA2NDQKLS0t
IGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3Zp
cnQva3ZtL2t2bWkucnN0CkBAIC00ODAsMTIgKzQ4MCw1MiBAQCBSZXR1cm5zIHRoZSBUU0MgZnJl
cXVlbmN5IChpbiBIWikgZm9yIHRoZSBzcGVjaWZpZWQgdkNQVSBpZiBhdmFpbGFibGUKICogLUtW
TV9FSU5WQUwgLSB0aGUgc2VsZWN0ZWQgdkNQVSBpcyBpbnZhbGlkCiAqIC1LVk1fRUFHQUlOIC0g
dGhlIHNlbGVjdGVkIHZDUFUgY2FuJ3QgYmUgaW50cm9zcGVjdGVkIHlldAogCis5LiBLVk1JX1ZD
UFVfUEFVU0UKKy0tLS0tLS0tLS0tLS0tLS0tLQorCis6QXJjaGl0ZWN0dXJlOiBhbGwKKzpWZXJz
aW9uczogPj0gMQorOlBhcmFtZXRlcnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2hkcjsK
KwlzdHJ1Y3Qga3ZtaV92Y3B1X3BhdXNlIHsKKwkJX191OCB3YWl0OworCQlfX3U4IHBhZGRpbmcx
OworCQlfX3UxNiBwYWRkaW5nMjsKKwkJX191MzIgcGFkZGluZzM7CisJfTsKKworOlJldHVybnM6
CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV9lcnJvcl9jb2RlOworCitLaWNrcyB0aGUgdkNQVSBvdXQg
b2YgZ3Vlc3QuCisKK0lmIGB3YWl0YCBpcyAxLCB0aGUgY29tbWFuZCB3aWxsIHdhaXQgZm9yIHZD
UFUgdG8gYWNrbm93bGVkZ2UgdGhlIElQSS4KKworVGhlIHZDUFUgd2lsbCBoYW5kbGUgdGhlIHBl
bmRpbmcgY29tbWFuZHMvZXZlbnRzIGFuZCBzZW5kIHRoZQorKktWTUlfRVZFTlRfUEFVU0VfVkNQ
VSogZXZlbnQgKG9uZSBmb3IgZXZlcnkgc3VjY2Vzc2Z1bCAqS1ZNSV9WQ1BVX1BBVVNFKgorY29t
bWFuZCkgYmVmb3JlIHJldHVybmluZyB0byBndWVzdC4KKworOkVycm9yczoKKworKiAtS1ZNX0VJ
TlZBTCAtIHRoZSBwYWRkaW5nIGlzIG5vdCB6ZXJvCisqIC1LVk1fRUlOVkFMIC0gdGhlIHNlbGVj
dGVkIHZDUFUgaXMgaW52YWxpZAorKiAtS1ZNX0VBR0FJTiAtIHRoZSBzZWxlY3RlZCB2Q1BVIGNh
bid0IGJlIGludHJvc3BlY3RlZCB5ZXQKKyogLUtWTV9FQlVTWSAgLSB0aGUgc2VsZWN0ZWQgdkNQ
VSBoYXMgdG9vIG1hbnkgcXVldWVkCisgICAgICAgICAgICAgICAgKktWTUlfRVZFTlRfUEFVU0Vf
VkNQVSogZXZlbnRzCisqIC1LVk1fRVBFUk0gIC0gdGhlICpLVk1JX0VWRU5UX1BBVVNFX1ZDUFUq
IGV2ZW50IGlzIGRpc2FsbG93ZWQKKwogRXZlbnRzCiA9PT09PT0KIAogQWxsIGludHJvc3BlY3Rp
b24gZXZlbnRzIChWTSBvciB2Q1BVIHJlbGF0ZWQpIGFyZSBzZW50CiB1c2luZyB0aGUgKktWTUlf
RVZFTlQqIG1lc3NhZ2UgaWQuIE5vIGV2ZW50IHdpbGwgYmUgc2VudCB1bmxlc3MKLWl0IGlzIGV4
cGxpY2l0bHkgZW5hYmxlZC4KK2l0IGlzIGV4cGxpY2l0bHkgZW5hYmxlZCBvciByZXF1ZXN0ZWQg
KGVnLiAqS1ZNSV9FVkVOVF9QQVVTRV9WQ1BVKikuCiAKIFRoZSAqS1ZNSV9FVkVOVF9VTkhPT0sq
IGV2ZW50IGRvZXNuJ3QgaGF2ZSBhIHJlcGx5IGFuZCBzaGFyZSB0aGUga3ZtaV9ldmVudAogc3Ry
dWN0dXJlLCBmb3IgY29uc2lzdGVuY3kgd2l0aCB0aGUgdkNQVSBldmVudHMuCkBAIC01NDQsMyAr
NTg0LDI3IEBAIHRoZSBndWVzdCAoc2VlICoqVW5ob29raW5nKiopIGFuZCB0aGUgaW50cm9zcGVj
dGlvbiBoYXMgYmVlbiBlbmFibGVkCiBmb3IgdGhpcyBldmVudCAoc2VlICoqS1ZNSV9WTV9DT05U
Uk9MX0VWRU5UUyoqKS4gVGhlIGludHJvc3BlY3Rpb24gdG9vbAogaGFzIGEgY2hhbmNlIHRvIHVu
aG9vayBhbmQgY2xvc2UgdGhlIEtWTUkgY2hhbm5lbCAoc2lnbmFsaW5nIHRoYXQgdGhlCiBvcGVy
YXRpb24gY2FuIHByb2NlZWQpLgorCisyLiBLVk1JX0VWRU5UX1BBVVNFX1ZDUFUKKy0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLQorCis6QXJjaGl0ZWN0dXJlczogYWxsCis6VmVyc2lvbnM6ID49IDEK
KzpBY3Rpb25zOiBDT05USU5VRSwgQ1JBU0gKKzpQYXJhbWV0ZXJzOgorCis6OgorCisJc3RydWN0
IGt2bWlfZXZlbnQ7CisKKzpSZXR1cm5zOgorCis6OgorCisJc3RydWN0IGt2bWlfdmNwdV9oZHI7
CisJc3RydWN0IGt2bWlfZXZlbnRfcmVwbHk7CisKK1RoaXMgZXZlbnQgaXMgc2VudCBpbiByZXNw
b25zZSB0byBhICpLVk1JX1ZDUFVfUEFVU0UqIGNvbW1hbmQuCitCZWNhdXNlIGl0IGhhcyBhIGxv
dyBwcmlvcml0eSwgaXQgd2lsbCBiZSBzZW50IGFmdGVyIGFueSBvdGhlciB2Q1BVCitpbnRyb3Nw
ZWN0aW9uIGV2ZW50IGFuZCB3aGVuIG5vIG90aGVyIHZDUFUgaW50cm9zcGVjdGlvbiBjb21tYW5k
IGlzCitxdWV1ZWQuCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oIGIvaW5j
bHVkZS9saW51eC9rdm1pX2hvc3QuaAppbmRleCA5NTZiOGQ1YzUxZTMuLmZkYjhjZTZmZTZhNSAx
MDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9rdm1pX2hvc3QuaAorKysgYi9pbmNsdWRlL2xpbnV4
L2t2bWlfaG9zdC5oCkBAIC0xOCw2ICsxOCw4IEBAIHN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0
aW9uIHsKIAogCXN0cnVjdCBsaXN0X2hlYWQgam9iX2xpc3Q7CiAJc3BpbmxvY2tfdCBqb2JfbG9j
azsKKworCWF0b21pY190IHBhdXNlX3JlcXVlc3RzOwogfTsKIAogc3RydWN0IGt2bV9pbnRyb3Nw
ZWN0aW9uIHsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggYi9pbmNsdWRl
L3VhcGkvbGludXgva3ZtaS5oCmluZGV4IGEzZGNhNDIwYzg4Ny4uM2RlZDIyMDIwYmVmIDEwMDY0
NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2luY2x1ZGUvdWFwaS9saW51
eC9rdm1pLmgKQEAgLTI2LDEyICsyNiwxNCBAQCBlbnVtIHsKIAlLVk1JX1ZNX1dSSVRFX1BIWVNJ
Q0FMID0gNywKIAogCUtWTUlfVkNQVV9HRVRfSU5GTyAgICAgPSA4LAorCUtWTUlfVkNQVV9QQVVT
RSAgICAgICAgPSA5LAogCiAJS1ZNSV9OVU1fTUVTU0FHRVMKIH07CiAKIGVudW0gewotCUtWTUlf
RVZFTlRfVU5IT09LID0gMCwKKwlLVk1JX0VWRU5UX1VOSE9PSyAgICAgPSAwLAorCUtWTUlfRVZF
TlRfUEFVU0VfVkNQVSA9IDEsCiAKIAlLVk1JX05VTV9FVkVOVFMKIH07CkBAIC0xMDcsNiArMTA5
LDEzIEBAIHN0cnVjdCBrdm1pX3ZjcHVfaGRyIHsKIAlfX3UzMiBwYWRkaW5nMjsKIH07CiAKK3N0
cnVjdCBrdm1pX3ZjcHVfcGF1c2UgeworCV9fdTggd2FpdDsKKwlfX3U4IHBhZGRpbmcxOworCV9f
dTE2IHBhZGRpbmcyOworCV9fdTMyIHBhZGRpbmczOworfTsKKwogc3RydWN0IGt2bWlfZXZlbnQg
ewogCV9fdTE2IHNpemU7CiAJX191MTYgdmNwdTsKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcv
c2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0
cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCmluZGV4IDEwNzY2MWZiZTUyZi4uMGRmODkwYjRiNDQw
IDEwMDY0NAotLS0gYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVz
dC5jCisrKyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMK
QEAgLTY5MSw2ICs2OTEsMTcgQEAgc3RhdGljIGludCBkb192Y3B1X2NvbW1hbmQoc3RydWN0IGt2
bV92bSAqdm0sIGludCBjbWRfaWQsCiAJcmV0dXJuIHI7CiB9CiAKK3N0YXRpYyBpbnQgX19kb192
Y3B1MF9jb21tYW5kKGludCBjbWRfaWQsIHN0cnVjdCBrdm1pX21zZ19oZHIgKnJlcSwKKwkJCSAg
ICAgIHNpemVfdCByZXFfc2l6ZSwgdm9pZCAqcnBsLCBzaXplX3QgcnBsX3NpemUpCit7CisJc3Ry
dWN0IGt2bWlfdmNwdV9oZHIgKnZjcHVfaGRyID0gKHN0cnVjdCBrdm1pX3ZjcHVfaGRyICopKHJl
cSArIDEpOworCisJdmNwdV9oZHItPnZjcHUgPSAwOworCisJc2VuZF9tZXNzYWdlKGNtZF9pZCwg
cmVxLCByZXFfc2l6ZSk7CisJcmV0dXJuIHJlY2VpdmVfY21kX3JlcGx5KHJlcSwgcnBsLCBycGxf
c2l6ZSk7Cit9CisKIHN0YXRpYyBpbnQgZG9fdmNwdTBfY29tbWFuZChzdHJ1Y3Qga3ZtX3ZtICp2
bSwgaW50IGNtZF9pZCwKIAkJCSAgICBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICpyZXEsIHNpemVfdCBy
ZXFfc2l6ZSwKIAkJCSAgICB2b2lkICpycGwsIHNpemVfdCBycGxfc2l6ZSkKQEAgLTczNiw2ICs3
NDcsNDcgQEAgc3RhdGljIHZvaWQgdGVzdF9jbWRfdmNwdV9nZXRfaW5mbyhzdHJ1Y3Qga3ZtX3Zt
ICp2bSkKIAkJLXIsIGt2bV9zdHJlcnJvcigtcikpOwogfQogCitzdGF0aWMgdm9pZCBjbWRfdmNw
dV9wYXVzZShfX3U4IHdhaXQsIF9fdTggcGFkZGluZywgaW50IGV4cGVjdGVkX2VycikKK3sKKwlz
dHJ1Y3QgeworCQlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwkJc3RydWN0IGt2bWlfdmNwdV9o
ZHIgdmNwdV9oZHI7CisJCXN0cnVjdCBrdm1pX3ZjcHVfcGF1c2UgY21kOworCX0gcmVxID0ge307
CisJaW50IHI7CisKKwlyZXEuY21kLndhaXQgPSB3YWl0OworCXJlcS5jbWQucGFkZGluZzEgPSBw
YWRkaW5nOworCXJlcS5jbWQucGFkZGluZzIgPSBwYWRkaW5nOworCXJlcS5jbWQucGFkZGluZzMg
PSBwYWRkaW5nOworCisJciA9IF9fZG9fdmNwdTBfY29tbWFuZChLVk1JX1ZDUFVfUEFVU0UsICZy
ZXEuaGRyLCBzaXplb2YocmVxKSwgTlVMTCwgMCk7CisJVEVTVF9BU1NFUlQociA9PSBleHBlY3Rl
ZF9lcnIsCisJCSJLVk1JX1ZDUFVfUEFVU0UgZmFpbGVkLCBlcnJvciAlZCAoJXMpLCBleHBlY3Rl
ZCBlcnJvciAlZFxuIiwKKwkJLXIsIGt2bV9zdHJlcnJvcigtciksIGV4cGVjdGVkX2Vycik7Cit9
CisKK3N0YXRpYyB2b2lkIHBhdXNlX3ZjcHUodm9pZCkKK3sKKwljbWRfdmNwdV9wYXVzZSgxLCAw
LCAwKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9wYXVzZShzdHJ1Y3Qga3ZtX3ZtICp2bSkKK3sK
KwlfX3U4IG5vX3dhaXQgPSAwLCB3YWl0ID0gMSwgd2FpdF9pbnZhbCA9IDI7CisJX191OCBwYWRk
aW5nID0gMSwgbm9fcGFkZGluZyA9IDA7CisKKwlwYXVzZV92Y3B1KCk7CisKKwljbWRfdmNwdV9w
YXVzZSh3YWl0LCBub19wYWRkaW5nLCAwKTsKKwljbWRfdmNwdV9wYXVzZSh3YWl0X2ludmFsLCBu
b19wYWRkaW5nLCAtS1ZNX0VJTlZBTCk7CisJY21kX3ZjcHVfcGF1c2Uobm9fd2FpdCwgcGFkZGlu
ZywgLUtWTV9FSU5WQUwpOworCisJZGlzYWxsb3dfZXZlbnQodm0sIEtWTUlfRVZFTlRfUEFVU0Vf
VkNQVSk7CisJY21kX3ZjcHVfcGF1c2Uobm9fd2FpdCwgbm9fcGFkZGluZywgLUtWTV9FUEVSTSk7
CisJYWxsb3dfZXZlbnQodm0sIEtWTUlfRVZFTlRfUEFVU0VfVkNQVSk7Cit9CisKIHN0YXRpYyB2
b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIHsKIAlzcmFuZG9tKHRp
bWUoMCkpOwpAQCAtNzUxLDYgKzgwMyw3IEBAIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlv
bihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIAl0ZXN0X2NtZF92bV9jb250cm9sX2V2ZW50cyh2bSk7CiAJ
dGVzdF9tZW1vcnlfYWNjZXNzKHZtKTsKIAl0ZXN0X2NtZF92Y3B1X2dldF9pbmZvKHZtKTsKKwl0
ZXN0X3BhdXNlKHZtKTsKIAogCXVuaG9va19pbnRyb3NwZWN0aW9uKHZtKTsKIH0KZGlmZiAtLWdp
dCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jIGIvdmlydC9rdm0vaW50cm9zcGVjdGlv
bi9rdm1pLmMKaW5kZXggYTlkNDA2ZjI3NmY1Li5hNzA0ZTA1YjMxODQgMTAwNjQ0Ci0tLSBhL3Zp
cnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCisrKyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24v
a3ZtaS5jCkBAIC0xMiw2ICsxMiw4IEBACiAjZGVmaW5lIEtWTUlfTlVNX0NPTU1BTkRTIEtWTUlf
TlVNX01FU1NBR0VTCiAjZGVmaW5lIEtWTUlfTVNHX1NJWkVfQUxMT0MgKHNpemVvZihzdHJ1Y3Qg
a3ZtaV9tc2dfaGRyKSArIEtWTUlfTVNHX1NJWkUpCiAKKyNkZWZpbmUgTUFYX1BBVVNFX1JFUVVF
U1RTIDEwMDEKKwogc3RhdGljIERFQ0xBUkVfQklUTUFQKEt2bWlfYWx3YXlzX2FsbG93ZWRfY29t
bWFuZHMsIEtWTUlfTlVNX0NPTU1BTkRTKTsKIHN0YXRpYyBERUNMQVJFX0JJVE1BUChLdm1pX2tu
b3duX2V2ZW50cywgS1ZNSV9OVU1fRVZFTlRTKTsKIHN0YXRpYyBERUNMQVJFX0JJVE1BUChLdm1p
X2tub3duX3ZtX2V2ZW50cywgS1ZNSV9OVU1fRVZFTlRTKTsKQEAgLTkwLDYgKzkyLDcgQEAgc3Rh
dGljIHZvaWQgc2V0dXBfa25vd25fZXZlbnRzKHZvaWQpCiAJc2V0X2JpdChLVk1JX0VWRU5UX1VO
SE9PSywgS3ZtaV9rbm93bl92bV9ldmVudHMpOwogCiAJYml0bWFwX3plcm8oS3ZtaV9rbm93bl92
Y3B1X2V2ZW50cywgS1ZNSV9OVU1fRVZFTlRTKTsKKwlzZXRfYml0KEtWTUlfRVZFTlRfUEFVU0Vf
VkNQVSwgS3ZtaV9rbm93bl92Y3B1X2V2ZW50cyk7CiAKIAliaXRtYXBfb3IoS3ZtaV9rbm93bl9l
dmVudHMsIEt2bWlfa25vd25fdm1fZXZlbnRzLAogCQkgIEt2bWlfa25vd25fdmNwdV9ldmVudHMs
IEtWTUlfTlVNX0VWRU5UUyk7CkBAIC0xMTMsMTAgKzExNiwxNCBAQCB2b2lkIGt2bWlfdW5pbml0
KHZvaWQpCiAJa3ZtaV9jYWNoZV9kZXN0cm95KCk7CiB9CiAKLXN0YXRpYyB2b2lkIGt2bWlfbWFr
ZV9yZXF1ZXN0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKK3N0YXRpYyB2b2lkIGt2bWlfbWFrZV9y
ZXF1ZXN0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgYm9vbCB3YWl0KQogewogCWt2bV9tYWtlX3Jl
cXVlc3QoS1ZNX1JFUV9JTlRST1NQRUNUSU9OLCB2Y3B1KTsKLQlrdm1fdmNwdV9raWNrKHZjcHUp
OworCisJaWYgKHdhaXQpCisJCWt2bV92Y3B1X2tpY2tfYW5kX3dhaXQodmNwdSk7CisJZWxzZQor
CQlrdm1fdmNwdV9raWNrKHZjcHUpOwogfQogCiBzdGF0aWMgaW50IF9fa3ZtaV9hZGRfam9iKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSwKQEAgLTE1MSw3ICsxNTgsNyBAQCBpbnQga3ZtaV9hZGRfam9i
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAllcnIgPSBfX2t2bWlfYWRkX2pvYih2Y3B1LCBmY3Qs
IGN0eCwgZnJlZV9mY3QpOwogCiAJaWYgKCFlcnIpCi0JCWt2bWlfbWFrZV9yZXF1ZXN0KHZjcHUp
OworCQlrdm1pX21ha2VfcmVxdWVzdCh2Y3B1LCBmYWxzZSk7CiAKIAlyZXR1cm4gZXJyOwogfQpA
QCAtMzQ2LDYgKzM1MywyMiBAQCBzdGF0aWMgaW50IF9fa3ZtaV9ob29rKHN0cnVjdCBrdm0gKmt2
bSwKIAlyZXR1cm4gMDsKIH0KIAorc3RhdGljIHZvaWQga3ZtaV9qb2JfcmVsZWFzZV92Y3B1KHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSwgdm9pZCAqY3R4KQoreworCXN0cnVjdCBrdm1fdmNwdV9pbnRy
b3NwZWN0aW9uICp2Y3B1aSA9IFZDUFVJKHZjcHUpOworCisJYXRvbWljX3NldCgmdmNwdWktPnBh
dXNlX3JlcXVlc3RzLCAwKTsKK30KKworc3RhdGljIHZvaWQga3ZtaV9yZWxlYXNlX3ZjcHVzKHN0
cnVjdCBrdm0gKmt2bSkKK3sKKwlzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHU7CisJaW50IGk7CisKKwlr
dm1fZm9yX2VhY2hfdmNwdShpLCB2Y3B1LCBrdm0pCisJCWt2bWlfYWRkX2pvYih2Y3B1LCBrdm1p
X2pvYl9yZWxlYXNlX3ZjcHUsIE5VTEwsIE5VTEwpOworfQorCiBzdGF0aWMgaW50IGt2bWlfcmVj
dl90aHJlYWQodm9pZCAqYXJnKQogewogCXN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSA9
IGFyZzsKQEAgLTM1OSw2ICszODIsOCBAQCBzdGF0aWMgaW50IGt2bWlfcmVjdl90aHJlYWQodm9p
ZCAqYXJnKQogCSAqLwogCWt2bWlfc29ja19zaHV0ZG93bihrdm1pKTsKIAorCWt2bWlfcmVsZWFz
ZV92Y3B1cyhrdm1pLT5rdm0pOworCiAJa3ZtaV9wdXQoa3ZtaS0+a3ZtKTsKIAlyZXR1cm4gMDsK
IH0KQEAgLTcxOCwxNSArNzQzLDQ1IEBAIHZvaWQga3ZtaV9ydW5fam9icyhzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUpCiAJfQogfQogCitzdGF0aWMgdm9pZCBrdm1pX3ZjcHVfcGF1c2VfZXZlbnQoc3Ry
dWN0IGt2bV92Y3B1ICp2Y3B1KQoreworCXN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0aW9uICp2
Y3B1aSA9IFZDUFVJKHZjcHUpOworCisJYXRvbWljX2RlYygmdmNwdWktPnBhdXNlX3JlcXVlc3Rz
KTsKKwkvKiB0byBiZSBpbXBsZW1lbnRlZCAqLworfQorCiB2b2lkIGt2bWlfaGFuZGxlX3JlcXVl
c3RzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIHsKKwlzdHJ1Y3Qga3ZtX3ZjcHVfaW50cm9zcGVj
dGlvbiAqdmNwdWkgPSBWQ1BVSSh2Y3B1KTsKIAlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2
bWk7CiAKIAlrdm1pID0ga3ZtaV9nZXQodmNwdS0+a3ZtKTsKIAlpZiAoIWt2bWkpCiAJCXJldHVy
bjsKIAotCWt2bWlfcnVuX2pvYnModmNwdSk7CisJZm9yICg7OykgeworCQlrdm1pX3J1bl9qb2Jz
KHZjcHUpOworCisJCWlmIChhdG9taWNfcmVhZCgmdmNwdWktPnBhdXNlX3JlcXVlc3RzKSkKKwkJ
CWt2bWlfdmNwdV9wYXVzZV9ldmVudCh2Y3B1KTsKKwkJZWxzZQorCQkJYnJlYWs7CisJfQogCiAJ
a3ZtaV9wdXQodmNwdS0+a3ZtKTsKIH0KKworaW50IGt2bWlfY21kX3ZjcHVfcGF1c2Uoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1LCBib29sIHdhaXQpCit7CisJc3RydWN0IGt2bV92Y3B1X2ludHJvc3Bl
Y3Rpb24gKnZjcHVpID0gVkNQVUkodmNwdSk7CisKKwlpZiAoYXRvbWljX3JlYWQoJnZjcHVpLT5w
YXVzZV9yZXF1ZXN0cykgPiBNQVhfUEFVU0VfUkVRVUVTVFMpCisJCXJldHVybiAtS1ZNX0VCVVNZ
OworCisJYXRvbWljX2luYygmdmNwdWktPnBhdXNlX3JlcXVlc3RzKTsKKworCWt2bWlfbWFrZV9y
ZXF1ZXN0KHZjcHUsIHdhaXQpOworCisJcmV0dXJuIDA7Cit9CmRpZmYgLS1naXQgYS92aXJ0L2t2
bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmggYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlf
aW50LmgKaW5kZXggNDI4MDNiNmQwZTgxLi5jYjk5Y2IzZGIzOTYgMTAwNjQ0Ci0tLSBhL3ZpcnQv
a3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaAorKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9u
L2t2bWlfaW50LmgKQEAgLTQ2LDYgKzQ2LDcgQEAgaW50IGt2bWlfY21kX3JlYWRfcGh5c2ljYWwo
c3RydWN0IGt2bSAqa3ZtLCB1NjQgZ3BhLCBzaXplX3Qgc2l6ZSwKIAkJCSAgIGNvbnN0IHN0cnVj
dCBrdm1pX21zZ19oZHIgKmN0eCk7CiBpbnQga3ZtaV9jbWRfd3JpdGVfcGh5c2ljYWwoc3RydWN0
IGt2bSAqa3ZtLCB1NjQgZ3BhLCBzaXplX3Qgc2l6ZSwKIAkJCSAgICBjb25zdCB2b2lkICpidWYp
OworaW50IGt2bWlfY21kX3ZjcHVfcGF1c2Uoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29sIHdh
aXQpOwogCiAvKiBhcmNoICovCiBpbnQga3ZtaV9hcmNoX2NtZF92Y3B1X2dldF9pbmZvKHN0cnVj
dCBrdm1fdmNwdSAqdmNwdSwKZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3Zt
aV9tc2cuYyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwppbmRleCBlZTI1YmE0
NGZiMGIuLjFhZGVjODM4Y2RkZCAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pX21zZy5jCisrKyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwpAQCAtMjY0
LDEyICsyNjQsNTQgQEAgc3RhdGljIGludCBoYW5kbGVfdm1fd3JpdGVfcGh5c2ljYWwoc3RydWN0
IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAogCXJldHVybiBrdm1pX21zZ192bV9yZXBseShrdm1p
LCBtc2csIGVjLCBOVUxMLCAwKTsKIH0KIAorLyoKKyAqIFRoaXMgdkNQVSBjb21tYW5kIGlzIGhh
bmRsZWQgYnkgdGhlIHJlY2VpdmluZyB0aHJlYWQgaW5zdGVhZCBvZgorICogdGhlIHZDUFUgdGhy
ZWFkIGluIG9yZGVyIHRvIG1ha2UgaXQgZWFzaWVyIGZvciB0aGUgaW50cm9zcGVjdGlvbiB0b29s
CisgKiB0byBpbXBsZW1lbnQgYSAncGF1c2UgVk0nIGNvbW1hbmQgYnkgc2VuZGluZyBhICdwYXVz
ZSB2Q1BVJyBjb21tYW5kCisgKiBmb3IgZXZlcnkgdkNQVS4gSXQgY2FuIGNvbnNpZGVyIHRoYXQg
dGhlIFZNIGhhcyBzdG9wcGVkCisgKiBvbmNlIGl0IHJlY2VpdmVzIHRoZSByZXBseSBmb3IgdGhl
IGxhc3QgJ3BhdXNlIHZDUFUnIGNvbW1hbmQuCisgKi8KK3N0YXRpYyBpbnQgaGFuZGxlX3ZjcHVf
cGF1c2Uoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJICAgICBjb25zdCBzdHJ1
Y3Qga3ZtaV9tc2dfaGRyICptc2csCisJCQkgICAgIGNvbnN0IHZvaWQgKl9yZXEpCit7CisJY29u
c3Qgc3RydWN0IGt2bWlfdmNwdV9oZHIgKnZjcHVfaGRyID0gX3JlcTsKKwljb25zdCBzdHJ1Y3Qg
a3ZtaV92Y3B1X3BhdXNlICp2Y3B1X3JlcTsKKwlzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUgPSBOVUxM
OworCWludCBlcnI7CisKKwl2Y3B1X3JlcSA9IChjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X3BhdXNl
ICopICh2Y3B1X2hkciArIDEpOworCisJaWYgKGludmFsaWRfdmNwdV9oZHIodmNwdV9oZHIpIHx8
IHZjcHVfcmVxLT53YWl0ID4gMSkgeworCQllcnIgPSAtS1ZNX0VJTlZBTDsKKwkJZ290byByZXBs
eTsKKwl9CisKKwlpZiAodmNwdV9yZXEtPnBhZGRpbmcxIHx8IHZjcHVfcmVxLT5wYWRkaW5nMiB8
fCB2Y3B1X3JlcS0+cGFkZGluZzMpIHsKKwkJZXJyID0gLUtWTV9FSU5WQUw7CisJCWdvdG8gcmVw
bHk7CisJfQorCisJaWYgKCFpc19ldmVudF9hbGxvd2VkKGt2bWksIEtWTUlfRVZFTlRfUEFVU0Vf
VkNQVSkpIHsKKwkJZXJyID0gLUtWTV9FUEVSTTsKKwkJZ290byByZXBseTsKKwl9CisKKwllcnIg
PSBrdm1pX2dldF92Y3B1KGt2bWksIHZjcHVfaGRyLT52Y3B1LCAmdmNwdSk7CisJaWYgKCFlcnIp
CisJCWVyciA9IGt2bWlfY21kX3ZjcHVfcGF1c2UodmNwdSwgdmNwdV9yZXEtPndhaXQgPT0gMSk7
CisKK3JlcGx5OgorCXJldHVybiBrdm1pX21zZ192bV9yZXBseShrdm1pLCBtc2csIGVyciwgTlVM
TCwgMCk7Cit9CisKIC8qCiAgKiBUaGVzZSBjb21tYW5kcyBhcmUgZXhlY3V0ZWQgYnkgdGhlIHJl
Y2VpdmluZyB0aHJlYWQuCiAgKi8KIHN0YXRpYyBpbnQoKmNvbnN0IG1zZ192bVtdKShzdHJ1Y3Qg
a3ZtX2ludHJvc3BlY3Rpb24gKiwKIAkJCSAgICBjb25zdCBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICos
IGNvbnN0IHZvaWQgKikgPSB7CiAJW0tWTUlfR0VUX1ZFUlNJT05dICAgICAgID0gaGFuZGxlX2dl
dF92ZXJzaW9uLAorCVtLVk1JX1ZDUFVfUEFVU0VdICAgICAgICA9IGhhbmRsZV92Y3B1X3BhdXNl
LAogCVtLVk1JX1ZNX0NIRUNLX0NPTU1BTkRdICA9IGhhbmRsZV92bV9jaGVja19jb21tYW5kLAog
CVtLVk1JX1ZNX0NIRUNLX0VWRU5UXSAgICA9IGhhbmRsZV92bV9jaGVja19ldmVudCwKIAlbS1ZN
SV9WTV9DT05UUk9MX0VWRU5UU10gPSBoYW5kbGVfdm1fY29udHJvbF9ldmVudHMsCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1h
aWxpbmcgbGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRw
czovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXph
dGlvbg==
