Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
	by mail.lfdr.de (Postfix) with ESMTPS id 22E4E4C62A4
	for <lists.virtualization@lfdr.de>; Mon, 28 Feb 2022 06:40:09 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp1.osuosl.org (Postfix) with ESMTP id 895DD8149D;
	Mon, 28 Feb 2022 05:40:07 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
	by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id MkSf61Z6JzQY; Mon, 28 Feb 2022 05:40:03 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [IPv6:2605:bc80:3010:104::8cd3:938])
	by smtp1.osuosl.org (Postfix) with ESMTPS id 2E28681A6A;
	Mon, 28 Feb 2022 05:40:03 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id A1F75C007B;
	Mon, 28 Feb 2022 05:40:02 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [IPv6:2605:bc80:3010::133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 85A02C001A
 for <virtualization@lists.linux-foundation.org>;
 Mon, 28 Feb 2022 05:40:01 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id 5C1BF40022
 for <virtualization@lists.linux-foundation.org>;
 Mon, 28 Feb 2022 05:40:01 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Authentication-Results: smtp2.osuosl.org (amavisd-new);
 dkim=pass (1024-bit key) header.d=redhat.com
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 9dgNpkui0Hr4
 for <virtualization@lists.linux-foundation.org>;
 Mon, 28 Feb 2022 05:39:58 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.133.124])
 by smtp2.osuosl.org (Postfix) with ESMTPS id 9792740179
 for <virtualization@lists.linux-foundation.org>;
 Mon, 28 Feb 2022 05:39:58 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1646026797;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=5buzVf+rdJruQ+41XusQzX9qM5rFM/sRJBJF7d5Hh24=;
 b=h+8mOdICan86MoPoGMTywLIS8kAxrLXpXmgTqqGv4fa3ro+3Jyua3PNNEuo9zd/D+0wYQh
 VJIdQSmEbNNGsK0yNOx4zYSROhexAQnEI2PXBat+/TL3y9MmZyTT8vmA1k0H/9nWQuiCOB
 1F9DGAga1Aime++ChTAtAtIq4ep0bBI=
Received: from mail-pj1-f70.google.com (mail-pj1-f70.google.com
 [209.85.216.70]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 us-mta-660-mfkVm5biOO2Z6f-AIgiTqQ-1; Mon, 28 Feb 2022 00:39:53 -0500
X-MC-Unique: mfkVm5biOO2Z6f-AIgiTqQ-1
Received: by mail-pj1-f70.google.com with SMTP id
 oj16-20020a17090b4d9000b001bc9dddd9easo5849857pjb.7
 for <virtualization@lists.linux-foundation.org>;
 Sun, 27 Feb 2022 21:39:53 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=x-gm-message-state:message-id:date:mime-version:user-agent:subject
 :content-language:to:cc:references:from:in-reply-to
 :content-transfer-encoding;
 bh=5buzVf+rdJruQ+41XusQzX9qM5rFM/sRJBJF7d5Hh24=;
 b=7OfRwAlPg+B1dQBsOnlXQpBNqOzUUZBKdJkayhtxu4bK3eQg/ajVor63ckDmT10hQu
 9kN+mDbbHQpVwX0xdLwShbPqmXlgdYwRJQ6kMhaAOQXxT7pD5xsN2yBk5QAxHoHYRTa4
 DDcKw2CldnOL0hwqpIC6pfpLqjcP0MRTK/Zt87iwOz2mH2/eCuLAer7zutnJZb1bLAf0
 PCLQhSkk4aBvSRxcV1pHcqJwYxoe08+uWN3RifxQHC0W7zCp9q91clCJoVMY06FnPkBw
 HGSG7eSXbQp5FGSPJFEmFB0pwu/IvF2Pp6lQ02EFB+LAkSw9S1BhIxiHDQhdQuS8Hu4D
 Df5Q==
X-Gm-Message-State: AOAM533lGo6L9ykFJhTCER5D1KW+wiyHzor6S5RSy7+rhGvdWSCkW2H1
 V4zVeTD0oLJeuxkMtEx7FJvSUtQQAAL1Olle2noOTIsFEe9gR18Zm9kmtB9T5Z7dZKh8Z2knGgi
 tXFF8cpENzpI+TCwGNojLTyHv8Ut6ageSVLobNFV50A==
X-Received: by 2002:a17:90a:ba07:b0:1bc:a0fd:faf with SMTP id
 s7-20020a17090aba0700b001bca0fd0fafmr15118346pjr.194.1646026792109; 
 Sun, 27 Feb 2022 21:39:52 -0800 (PST)
X-Google-Smtp-Source: ABdhPJy6/gWIvxGhSFmEAOvdc/uqiwyMKhkjF8ogdyo6ma8tXoFIyJKQpKMpt5yGRnMuIQqIvojlDg==
X-Received: by 2002:a17:90a:ba07:b0:1bc:a0fd:faf with SMTP id
 s7-20020a17090aba0700b001bca0fd0fafmr15118313pjr.194.1646026791666; 
 Sun, 27 Feb 2022 21:39:51 -0800 (PST)
Received: from [10.72.13.215] ([209.132.188.80])
 by smtp.gmail.com with ESMTPSA id
 t1-20020a056a0021c100b004f13ab99618sm11471450pfj.208.2022.02.27.21.39.43
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Sun, 27 Feb 2022 21:39:51 -0800 (PST)
Message-ID: <56fa64c3-416a-c748-4495-744b2f804aeb@redhat.com>
Date: Mon, 28 Feb 2022 13:39:40 +0800
MIME-Version: 1.0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:91.0)
 Gecko/20100101 Thunderbird/91.6.1
Subject: Re: [PATCH v2 07/14] vhost: Shadow virtqueue buffers forwarding
To: =?UTF-8?Q?Eugenio_P=c3=a9rez?= <eperezma@redhat.com>, qemu-devel@nongnu.org
References: <20220227134111.3254066-1-eperezma@redhat.com>
 <20220227134111.3254066-8-eperezma@redhat.com>
From: Jason Wang <jasowang@redhat.com>
In-Reply-To: <20220227134111.3254066-8-eperezma@redhat.com>
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=jasowang@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Content-Language: en-US
Cc: "Michael S. Tsirkin" <mst@redhat.com>,
 virtualization@lists.linux-foundation.org, Eli Cohen <eli@mellanox.com>,
 Eric Blake <eblake@redhat.com>, Parav Pandit <parav@mellanox.com>,
 Cindy Lu <lulu@redhat.com>, "Fangyi \(Eric\)" <eric.fangyi@huawei.com>,
 Markus Armbruster <armbru@redhat.com>, yebiaoxiang@huawei.com,
 Liuxiangdong <liuxiangdong5@huawei.com>, Laurent Vivier <lvivier@redhat.com>,
 Eduardo Habkost <ehabkost@redhat.com>,
 Richard Henderson <richard.henderson@linaro.org>,
 Gautam Dawar <gdawar@xilinx.com>, Xiao W Wang <xiao.w.wang@intel.com>,
 Stefan Hajnoczi <stefanha@redhat.com>,
 Harpreet Singh Anand <hanand@xilinx.com>, Paolo Bonzini <pbonzini@redhat.com>,
 Lingshan <lingshan.zhu@intel.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

CuWcqCAyMDIyLzIvMjcg5LiL5Y2IOTo0MSwgRXVnZW5pbyBQw6lyZXog5YaZ6YGTOgo+IEluaXRp
YWwgdmVyc2lvbiBvZiBzaGFkb3cgdmlydHF1ZXVlIHRoYXQgYWN0dWFsbHkgZm9yd2FyZCBidWZm
ZXJzLiBUaGVyZQo+IGlzIG5vIGlvbW11IHN1cHBvcnQgYXQgdGhlIG1vbWVudCwgYW5kIHRoYXQg
d2lsbCBiZSBhZGRyZXNzZWQgaW4gZnV0dXJlCj4gcGF0Y2hlcyBvZiB0aGlzIHNlcmllcy4gU2lu
Y2UgYWxsIHZob3N0LXZkcGEgZGV2aWNlcyB1c2UgZm9yY2VkIElPTU1VLAo+IHRoaXMgbWVhbnMg
dGhhdCBTVlEgaXMgbm90IHVzYWJsZSBhdCB0aGlzIHBvaW50IG9mIHRoZSBzZXJpZXMgb24gYW55
Cj4gZGV2aWNlLgo+Cj4gRm9yIHNpbXBsaWNpdHkgaXQgb25seSBzdXBwb3J0cyBtb2Rlcm4gZGV2
aWNlcywgdGhhdCBleHBlY3RzIHZyaW5nCj4gaW4gbGl0dGxlIGVuZGlhbiwgd2l0aCBzcGxpdCBy
aW5nIGFuZCBubyBldmVudCBpZHggb3IgaW5kaXJlY3QKPiBkZXNjcmlwdG9ycy4gU3VwcG9ydCBm
b3IgdGhlbSB3aWxsIG5vdCBiZSBhZGRlZCBpbiB0aGlzIHNlcmllcy4KPgo+IEl0IHJldXNlcyB0
aGUgVmlydFF1ZXVlIGNvZGUgZm9yIHRoZSBkZXZpY2UgcGFydC4gVGhlIGRyaXZlciBwYXJ0IGlz
Cj4gYmFzZWQgb24gTGludXgncyB2aXJ0aW9fcmluZyBkcml2ZXIsIGJ1dCB3aXRoIHN0cmlwcGVk
IGZ1bmN0aW9uYWxpdHkKPiBhbmQgb3B0aW1pemF0aW9ucyBzbyBpdCdzIGVhc2llciB0byByZXZp
ZXcuCj4KPiBIb3dldmVyLCBmb3J3YXJkaW5nIGJ1ZmZlcnMgaGF2ZSBzb21lIHBhcnRpY3VsYXIg
cGllY2VzOiBPbmUgb2YgdGhlIG1vc3QKPiB1bmV4cGVjdGVkIG9uZXMgaXMgdGhhdCBhIGd1ZXN0
J3MgYnVmZmVyIGNhbiBleHBhbmQgdGhyb3VnaCBtb3JlIHRoYW4KPiBvbmUgZGVzY3JpcHRvciBp
biBTVlEuIFdoaWxlIHRoaXMgaXMgaGFuZGxlZCBncmFjZWZ1bGx5IGJ5IHFlbXUncwo+IGVtdWxh
dGVkIHZpcnRpbyBkZXZpY2VzLCBpdCBtYXkgY2F1c2UgdW5leHBlY3RlZCBTVlEgcXVldWUgZnVs
bC4gVGhpcwo+IHBhdGNoIGFsc28gc29sdmVzIGl0IGJ5IGNoZWNraW5nIGZvciB0aGlzIGNvbmRp
dGlvbiBhdCBib3RoIGd1ZXN0J3MKPiBraWNrcyBhbmQgZGV2aWNlJ3MgY2FsbHMuIFRoZSBjb2Rl
IG1heSBiZSBtb3JlIGVsZWdhbnQgaW4gdGhlIGZ1dHVyZSBpZgo+IFNWUSBjb2RlIHJ1bnMgaW4g
aXRzIG93biBpb2NvbnRleHQuCj4KPiBTaWduZWQtb2ZmLWJ5OiBFdWdlbmlvIFDDqXJleiA8ZXBl
cmV6bWFAcmVkaGF0LmNvbT4KPiAtLS0KPiAgIGh3L3ZpcnRpby92aG9zdC1zaGFkb3ctdmlydHF1
ZXVlLmggfCAgMjkgKysrCj4gICBody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRxdWV1ZS5jIHwg
MzYwICsrKysrKysrKysrKysrKysrKysrKysrKysrKystCj4gICBody92aXJ0aW8vdmhvc3QtdmRw
YS5jICAgICAgICAgICAgIHwgMTY1ICsrKysrKysrKysrKy0KPiAgIDMgZmlsZXMgY2hhbmdlZCwg
NTQyIGluc2VydGlvbnMoKyksIDEyIGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2h3L3Zp
cnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmggYi9ody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZp
cnRxdWV1ZS5oCj4gaW5kZXggM2JiZWE3NzA4Mi4uMDRjNjc2ODVmZCAxMDA2NDQKPiAtLS0gYS9o
dy92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRxdWV1ZS5oCj4gKysrIGIvaHcvdmlydGlvL3Zob3N0
LXNoYWRvdy12aXJ0cXVldWUuaAo+IEBAIC0zNiw2ICszNiwzMyBAQCB0eXBlZGVmIHN0cnVjdCBW
aG9zdFNoYWRvd1ZpcnRxdWV1ZSB7Cj4gICAKPiAgICAgICAvKiBHdWVzdCdzIGNhbGwgbm90aWZp
ZXIsIHdoZXJlIHRoZSBTVlEgY2FsbHMgZ3Vlc3QuICovCj4gICAgICAgRXZlbnROb3RpZmllciBz
dnFfY2FsbDsKPiArCj4gKyAgICAvKiBWaXJ0aW8gcXVldWUgc2hhZG93aW5nICovCj4gKyAgICBW
aXJ0UXVldWUgKnZxOwo+ICsKPiArICAgIC8qIFZpcnRpbyBkZXZpY2UgKi8KPiArICAgIFZpcnRJ
T0RldmljZSAqdmRldjsKPiArCj4gKyAgICAvKiBNYXAgZm9yIHVzZSB0aGUgZ3Vlc3QncyBkZXNj
cmlwdG9ycyAqLwo+ICsgICAgVmlydFF1ZXVlRWxlbWVudCAqKnJpbmdfaWRfbWFwczsKPiArCj4g
KyAgICAvKiBOZXh0IFZpcnRRdWV1ZSBlbGVtZW50IHRoYXQgZ3Vlc3QgbWFkZSBhdmFpbGFibGUg
Ki8KPiArICAgIFZpcnRRdWV1ZUVsZW1lbnQgKm5leHRfZ3Vlc3RfYXZhaWxfZWxlbTsKPiArCj4g
KyAgICAvKiBOZXh0IGhlYWQgdG8gZXhwb3NlIHRvIHRoZSBkZXZpY2UgKi8KPiArICAgIHVpbnQx
Nl90IGF2YWlsX2lkeF9zaGFkb3c7Cj4gKwo+ICsgICAgLyogTmV4dCBmcmVlIGRlc2NyaXB0b3Ig
Ki8KPiArICAgIHVpbnQxNl90IGZyZWVfaGVhZDsKPiArCj4gKyAgICAvKiBMYXN0IHNlZW4gdXNl
ZCBpZHggKi8KPiArICAgIHVpbnQxNl90IHNoYWRvd191c2VkX2lkeDsKCgpJIHN1Z2dlc3QgdG8g
aGF2ZSBhIGNvbnNpc3RlbnQgbmFtZSBmb3IgYXZhaWwgYW5kIHVzZWQgaW5zdGVhZCBvZiB1c2lu
ZyAKb25lICJzaGFkb3ciIGFzIHByZWZpeCBhbmQgb3RoZXIgYXMgc3VmZml4CgoKPiArCj4gKyAg
ICAvKiBOZXh0IGhlYWQgdG8gY29uc3VtZSBmcm9tIHRoZSBkZXZpY2UgKi8KPiArICAgIHVpbnQx
Nl90IGxhc3RfdXNlZF9pZHg7Cj4gKwo+ICsgICAgLyogQ2FjaGUgZm9yIHRoZSBleHBvc2VkIG5v
dGlmaWNhdGlvbiBmbGFnICovCj4gKyAgICBib29sIG5vdGlmaWNhdGlvbjsKPiAgIH0gVmhvc3RT
aGFkb3dWaXJ0cXVldWU7Cj4gICAKPiAgIGJvb2wgdmhvc3Rfc3ZxX3ZhbGlkX2ZlYXR1cmVzKHVp
bnQ2NF90ICpmZWF0dXJlcyk7Cj4gQEAgLTQ3LDYgKzc0LDggQEAgdm9pZCB2aG9zdF9zdnFfZ2V0
X3ZyaW5nX2FkZHIoY29uc3QgVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSwKPiAgIHNpemVfdCB2
aG9zdF9zdnFfZHJpdmVyX2FyZWFfc2l6ZShjb25zdCBWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqc3Zx
KTsKPiAgIHNpemVfdCB2aG9zdF9zdnFfZGV2aWNlX2FyZWFfc2l6ZShjb25zdCBWaG9zdFNoYWRv
d1ZpcnRxdWV1ZSAqc3ZxKTsKPiAgIAo+ICt2b2lkIHZob3N0X3N2cV9zdGFydChWaG9zdFNoYWRv
d1ZpcnRxdWV1ZSAqc3ZxLCBWaXJ0SU9EZXZpY2UgKnZkZXYsCj4gKyAgICAgICAgICAgICAgICAg
ICAgIFZpcnRRdWV1ZSAqdnEpOwo+ICAgdm9pZCB2aG9zdF9zdnFfc3RvcChWaG9zdFNoYWRvd1Zp
cnRxdWV1ZSAqc3ZxKTsKPiAgIAo+ICAgVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnZob3N0X3N2cV9u
ZXcodm9pZCk7Cj4gZGlmZiAtLWdpdCBhL2h3L3ZpcnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVl
LmMgYi9ody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRxdWV1ZS5jCj4gaW5kZXggMjE1MGUyYjA3
MS4uYTM4ZDMxMzc1NSAxMDA2NDQKPiAtLS0gYS9ody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRx
dWV1ZS5jCj4gKysrIGIvaHcvdmlydGlvL3Zob3N0LXNoYWRvdy12aXJ0cXVldWUuYwo+IEBAIC0x
Miw2ICsxMiw3IEBACj4gICAKPiAgICNpbmNsdWRlICJxZW11L2Vycm9yLXJlcG9ydC5oIgo+ICAg
I2luY2x1ZGUgInFlbXUvbWFpbi1sb29wLmgiCj4gKyNpbmNsdWRlICJxZW11L2xvZy5oIgo+ICAg
I2luY2x1ZGUgImxpbnV4LWhlYWRlcnMvbGludXgvdmhvc3QuaCIKPiAgIAo+ICAgLyoqCj4gQEAg
LTUzLDIyICs1NCwzMDkgQEAgYm9vbCB2aG9zdF9zdnFfdmFsaWRfZmVhdHVyZXModWludDY0X3Qg
KmZlYXR1cmVzKQo+ICAgICAgIHJldHVybiByOwo+ICAgfQo+ICAgCj4gLS8qKiBGb3J3YXJkIGd1
ZXN0IG5vdGlmaWNhdGlvbnMgKi8KPiAtc3RhdGljIHZvaWQgdmhvc3RfaGFuZGxlX2d1ZXN0X2tp
Y2soRXZlbnROb3RpZmllciAqbikKPiArLyoqCj4gKyAqIE51bWJlciBvZiBkZXNjcmlwdG9ycyB0
aGF0IHRoZSBTVlEgY2FuIG1ha2UgYXZhaWxhYmxlIGZyb20gdGhlIGd1ZXN0Lgo+ICsgKgo+ICsg
KiBAc3ZxICAgVGhlIHN2cQoKCkJ0dywgSSBub3RpY2UgbW9zdCBvZiBmdW5jdGlvbiB0aGVyZSB3
aWxsIGJlIGEgY29sb24gaW4gdGhlIG1pZGRsZSBvZiAKdGhlIHBhcmFtZXRlciBhbmQgaXQncyBk
b2N1bWVudGF0aW9uLsKgIE1heWJlIHdlIHNob3VsZCBmb2xsb3cgdGhhdC4KCgo+ICsgKi8KPiAr
c3RhdGljIHVpbnQxNl90IHZob3N0X3N2cV9hdmFpbGFibGVfc2xvdHMoY29uc3QgVmhvc3RTaGFk
b3dWaXJ0cXVldWUgKnN2cSkKPiArewo+ICsgICAgcmV0dXJuIHN2cS0+dnJpbmcubnVtIC0gKHN2
cS0+YXZhaWxfaWR4X3NoYWRvdyAtIHN2cS0+c2hhZG93X3VzZWRfaWR4KTsKPiArfQo+ICsKPiAr
c3RhdGljIHZvaWQgdmhvc3Rfc3ZxX3NldF9ub3RpZmljYXRpb24oVmhvc3RTaGFkb3dWaXJ0cXVl
dWUgKnN2cSwgYm9vbCBlbmFibGUpCj4gK3sKPiArICAgIHVpbnQxNl90IG5vdGlmaWNhdGlvbl9m
bGFnOwo+ICsKPiArICAgIGlmIChzdnEtPm5vdGlmaWNhdGlvbiA9PSBlbmFibGUpIHsKPiArICAg
ICAgICByZXR1cm47Cj4gKyAgICB9Cj4gKwo+ICsgICAgbm90aWZpY2F0aW9uX2ZsYWcgPSBjcHVf
dG9fbGUxNihWUklOR19BVkFJTF9GX05PX0lOVEVSUlVQVCk7Cj4gKwo+ICsgICAgc3ZxLT5ub3Rp
ZmljYXRpb24gPSBlbmFibGU7Cj4gKyAgICBpZiAoZW5hYmxlKSB7Cj4gKyAgICAgICAgc3ZxLT52
cmluZy5hdmFpbC0+ZmxhZ3MgJj0gfm5vdGlmaWNhdGlvbl9mbGFnOwo+ICsgICAgfSBlbHNlIHsK
PiArICAgICAgICBzdnEtPnZyaW5nLmF2YWlsLT5mbGFncyB8PSBub3RpZmljYXRpb25fZmxhZzsK
PiArICAgICAgICAvKiBNYWtlIHN1cmUgdGhlIGZsYWcgaXMgd3JpdHRlbiBiZWZvcmUgdGhlIHJl
YWQgb2YgdXNlZF9pZHggKi8KPiArICAgICAgICBzbXBfbWIoKTsKCgpTbyB0aGUgY29tbWVudCBh
c3N1bWVzIHRoYXQgYSByZWFkaW5nIG9mIHVzZWRfaWR4IHdpbGwgY29tZS4gVGhpcyBtYWtlcyAK
bWUgd29uZGVyIGlmIHdlIGNhbiBzaW1wbHkgc3BsaXQgdGhpcyBmdW5jdGlvbiBhczoKCnZob3N0
X3N2cV9kaXNhYmxlX25vdGlmaWNhdGlvbigpIGFuZCB2aG9zdF9zdnFfZW5hYmxlX25vdGlmaWNh
dGlvbigpCgphbmQgaW4gdGhlIHZob3N0X3N2cV9lbmFibGVfbm90aWZpY2F0aW9uLCB3ZSBzaW1w
bHkgcmV0dXJuIAp2aG9zdF9zdnFfbW9yZV91c2VkKCkgYWZ0ZXIgc21wX21iKCkuCgooTm90IGEg
bXVzdCBidXQganVzdCBmZWVsIGl0IG1pZ2h0IGJlIG1vcmUgY2xlYXIpCgoKPiArICAgIH0KPiAr
fQo+ICsKPiArc3RhdGljIHZvaWQgdmhvc3RfdnJpbmdfd3JpdGVfZGVzY3MoVmhvc3RTaGFkb3dW
aXJ0cXVldWUgKnN2cSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u
c3Qgc3RydWN0IGlvdmVjICppb3ZlYywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc2l6ZV90IG51bSwgYm9vbCBtb3JlX2Rlc2NzLCBib29sIHdyaXRlKQo+ICt7Cj4gKyAg
ICB1aW50MTZfdCBpID0gc3ZxLT5mcmVlX2hlYWQsIGxhc3QgPSBzdnEtPmZyZWVfaGVhZDsKPiAr
ICAgIHVuc2lnbmVkIG47Cj4gKyAgICB1aW50MTZfdCBmbGFncyA9IHdyaXRlID8gY3B1X3RvX2xl
MTYoVlJJTkdfREVTQ19GX1dSSVRFKSA6IDA7Cj4gKyAgICB2cmluZ19kZXNjX3QgKmRlc2NzID0g
c3ZxLT52cmluZy5kZXNjOwo+ICsKPiArICAgIGlmIChudW0gPT0gMCkgewo+ICsgICAgICAgIHJl
dHVybjsKPiArICAgIH0KPiArCj4gKyAgICBmb3IgKG4gPSAwOyBuIDwgbnVtOyBuKyspIHsKPiAr
ICAgICAgICBpZiAobW9yZV9kZXNjcyB8fCAobiArIDEgPCBudW0pKSB7Cj4gKyAgICAgICAgICAg
IGRlc2NzW2ldLmZsYWdzID0gZmxhZ3MgfCBjcHVfdG9fbGUxNihWUklOR19ERVNDX0ZfTkVYVCk7
Cj4gKyAgICAgICAgfSBlbHNlIHsKPiArICAgICAgICAgICAgZGVzY3NbaV0uZmxhZ3MgPSBmbGFn
czsKPiArICAgICAgICB9Cj4gKyAgICAgICAgZGVzY3NbaV0uYWRkciA9IGNwdV90b19sZTY0KCho
d2FkZHIpaW92ZWNbbl0uaW92X2Jhc2UpOwo+ICsgICAgICAgIGRlc2NzW2ldLmxlbiA9IGNwdV90
b19sZTMyKGlvdmVjW25dLmlvdl9sZW4pOwo+ICsKPiArICAgICAgICBsYXN0ID0gaTsKPiArICAg
ICAgICBpID0gY3B1X3RvX2xlMTYoZGVzY3NbaV0ubmV4dCk7Cj4gKyAgICB9Cj4gKwo+ICsgICAg
c3ZxLT5mcmVlX2hlYWQgPSBsZTE2X3RvX2NwdShkZXNjc1tsYXN0XS5uZXh0KTsKPiArfQo+ICsK
PiArc3RhdGljIGJvb2wgdmhvc3Rfc3ZxX2FkZF9zcGxpdChWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAq
c3ZxLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpcnRRdWV1ZUVsZW1lbnQg
KmVsZW0sCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgKmhlYWQp
Cj4gK3sKPiArICAgIHVuc2lnbmVkIGF2YWlsX2lkeDsKPiArICAgIHZyaW5nX2F2YWlsX3QgKmF2
YWlsID0gc3ZxLT52cmluZy5hdmFpbDsKPiArCj4gKyAgICAqaGVhZCA9IHN2cS0+ZnJlZV9oZWFk
Owo+ICsKPiArICAgIC8qIFdlIG5lZWQgc29tZSBkZXNjcmlwdG9ycyBoZXJlICovCj4gKyAgICBp
ZiAodW5saWtlbHkoIWVsZW0tPm91dF9udW0gJiYgIWVsZW0tPmluX251bSkpIHsKPiArICAgICAg
ICBxZW11X2xvZ19tYXNrKExPR19HVUVTVF9FUlJPUiwKPiArICAgICAgICAgICAgIkd1ZXN0IHBy
b3ZpZGVkIGVsZW1lbnQgd2l0aCBubyBkZXNjcmlwdG9ycyIpOwo+ICsgICAgICAgIHJldHVybiBm
YWxzZTsKPiArICAgIH0KPiArCj4gKyAgICB2aG9zdF92cmluZ193cml0ZV9kZXNjcyhzdnEsIGVs
ZW0tPm91dF9zZywgZWxlbS0+b3V0X251bSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGVsZW0tPmluX251bSA+IDAsIGZhbHNlKTsKPiArICAgIHZob3N0X3ZyaW5nX3dyaXRlX2Rlc2Nz
KHN2cSwgZWxlbS0+aW5fc2csIGVsZW0tPmluX251bSwgZmFsc2UsIHRydWUpOwoKCkkgd29uZGVy
IGluc3RlYWQgb2YgcGFzc2luZyBpbi9vdXQgc2VwYXJhdGVseSBhbmQgdXNpbmcgdGhlIGhpbnQg
bGlrZSAKbW9yZV9kZXNjcywgaXMgaXQgYmV0dGVyIHRvIHNpbXBseSBwYXNzIHRoZSBlbGVtIHRv
IAp2aG9zdF92cmlnbl93cml0ZV9kZXNjcygpIHRoZW4gd2Uga25vdyB3aGljaCBvbmUgaXMgdGhl
IGxhc3QgdGhhdCAKZG9lc24ndCBkZXBlbmQgb24gbW9yZV9kZXNjcy4KCgo+ICsKPiArICAgIC8q
Cj4gKyAgICAgKiBQdXQgdGhlIGVudHJ5IGluIHRoZSBhdmFpbGFibGUgYXJyYXkgKGJ1dCBkb24n
dCB1cGRhdGUgYXZhaWwtPmlkeCB1bnRpbAo+ICsgICAgICogdGhleSBkbyBzeW5jKS4KPiArICAg
ICAqLwo+ICsgICAgYXZhaWxfaWR4ID0gc3ZxLT5hdmFpbF9pZHhfc2hhZG93ICYgKHN2cS0+dnJp
bmcubnVtIC0gMSk7Cj4gKyAgICBhdmFpbC0+cmluZ1thdmFpbF9pZHhdID0gY3B1X3RvX2xlMTYo
KmhlYWQpOwo+ICsgICAgc3ZxLT5hdmFpbF9pZHhfc2hhZG93Kys7Cj4gKwo+ICsgICAgLyogVXBk
YXRlIHRoZSBhdmFpbCBpbmRleCBhZnRlciB3cml0ZSB0aGUgZGVzY3JpcHRvciAqLwo+ICsgICAg
c21wX3dtYigpOwo+ICsgICAgYXZhaWwtPmlkeCA9IGNwdV90b19sZTE2KHN2cS0+YXZhaWxfaWR4
X3NoYWRvdyk7Cj4gKwo+ICsgICAgcmV0dXJuIHRydWU7Cj4gK30KPiArCj4gK3N0YXRpYyBib29s
IHZob3N0X3N2cV9hZGQoVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSwgVmlydFF1ZXVlRWxlbWVu
dCAqZWxlbSkKPiArewo+ICsgICAgdW5zaWduZWQgcWVtdV9oZWFkOwo+ICsgICAgYm9vbCBvayA9
IHZob3N0X3N2cV9hZGRfc3BsaXQoc3ZxLCBlbGVtLCAmcWVtdV9oZWFkKTsKPiArICAgIGlmICh1
bmxpa2VseSghb2spKSB7Cj4gKyAgICAgICAgcmV0dXJuIGZhbHNlOwo+ICsgICAgfQo+ICsKPiAr
ICAgIHN2cS0+cmluZ19pZF9tYXBzW3FlbXVfaGVhZF0gPSBlbGVtOwo+ICsgICAgcmV0dXJuIHRy
dWU7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHZob3N0X3N2cV9raWNrKFZob3N0U2hhZG93Vmly
dHF1ZXVlICpzdnEpCj4gK3sKPiArICAgIC8qCj4gKyAgICAgKiBXZSBuZWVkIHRvIGV4cG9zZSB0
aGUgYXZhaWxhYmxlIGFycmF5IGVudHJpZXMgYmVmb3JlIGNoZWNraW5nIHRoZSB1c2VkCj4gKyAg
ICAgKiBmbGFncwo+ICsgICAgICovCj4gKyAgICBzbXBfbWIoKTsKPiArICAgIGlmIChzdnEtPnZy
aW5nLnVzZWQtPmZsYWdzICYgVlJJTkdfVVNFRF9GX05PX05PVElGWSkgewo+ICsgICAgICAgIHJl
dHVybjsKPiArICAgIH0KPiArCj4gKyAgICBldmVudF9ub3RpZmllcl9zZXQoJnN2cS0+aGRldl9r
aWNrKTsKPiArfQo+ICsKPiArLyoqCj4gKyAqIEZvcndhcmQgYXZhaWxhYmxlIGJ1ZmZlcnMuCj4g
KyAqCj4gKyAqIEBzdnEgU2hhZG93IFZpcnRRdWV1ZQo+ICsgKgo+ICsgKiBOb3RlIHRoYXQgdGhp
cyBmdW5jdGlvbiBkb2VzIG5vdCBndWFyYW50ZWUgdGhhdCBhbGwgZ3Vlc3QncyBhdmFpbGFibGUK
PiArICogYnVmZmVycyBhcmUgYXZhaWxhYmxlIHRvIHRoZSBkZXZpY2UgaW4gU1ZRIGF2YWlsIHJp
bmcuIFRoZSBndWVzdCBtYXkgaGF2ZQo+ICsgKiBleHBvc2VkIGEgR1BBIC8gR0lPVkEgY29udGln
dW91cyBidWZmZXIsIGJ1dCBpdCBtYXkgbm90IGJlIGNvbnRpZ3VvdXMgaW4KPiArICogcWVtdSB2
YWRkci4KPiArICoKPiArICogSWYgdGhhdCBoYXBwZW5zLCBndWVzdCdzIGtpY2sgbm90aWZpY2F0
aW9ucyB3aWxsIGJlIGRpc2FibGVkIHVudGlsIHRoZQo+ICsgKiBkZXZpY2UgdXNlcyBzb21lIGJ1
ZmZlcnMuCj4gKyAqLwo+ICtzdGF0aWMgdm9pZCB2aG9zdF9oYW5kbGVfZ3Vlc3Rfa2ljayhWaG9z
dFNoYWRvd1ZpcnRxdWV1ZSAqc3ZxKQo+ICt7Cj4gKyAgICAvKiBDbGVhciBldmVudCBub3RpZmll
ciAqLwo+ICsgICAgZXZlbnRfbm90aWZpZXJfdGVzdF9hbmRfY2xlYXIoJnN2cS0+c3ZxX2tpY2sp
Owo+ICsKPiArICAgIC8qIEZvcndhcmQgdG8gdGhlIGRldmljZSBhcyBtYW55IGF2YWlsYWJsZSBi
dWZmZXJzIGFzIHBvc3NpYmxlICovCj4gKyAgICBkbyB7Cj4gKyAgICAgICAgdmlydGlvX3F1ZXVl
X3NldF9ub3RpZmljYXRpb24oc3ZxLT52cSwgZmFsc2UpOwo+ICsKPiArICAgICAgICB3aGlsZSAo
dHJ1ZSkgewo+ICsgICAgICAgICAgICBWaXJ0UXVldWVFbGVtZW50ICplbGVtOwo+ICsgICAgICAg
ICAgICBib29sIG9rOwo+ICsKPiArICAgICAgICAgICAgaWYgKHN2cS0+bmV4dF9ndWVzdF9hdmFp
bF9lbGVtKSB7Cj4gKyAgICAgICAgICAgICAgICBlbGVtID0gZ19zdGVhbF9wb2ludGVyKCZzdnEt
Pm5leHRfZ3Vlc3RfYXZhaWxfZWxlbSk7Cj4gKyAgICAgICAgICAgIH0gZWxzZSB7Cj4gKyAgICAg
ICAgICAgICAgICBlbGVtID0gdmlydHF1ZXVlX3BvcChzdnEtPnZxLCBzaXplb2YoKmVsZW0pKTsK
PiArICAgICAgICAgICAgfQo+ICsKPiArICAgICAgICAgICAgaWYgKCFlbGVtKSB7Cj4gKyAgICAg
ICAgICAgICAgICBicmVhazsKPiArICAgICAgICAgICAgfQo+ICsKPiArICAgICAgICAgICAgaWYg
KGVsZW0tPm91dF9udW0gKyBlbGVtLT5pbl9udW0gPgo+ICsgICAgICAgICAgICAgICAgdmhvc3Rf
c3ZxX2F2YWlsYWJsZV9zbG90cyhzdnEpKSB7Cj4gKyAgICAgICAgICAgICAgICAvKgo+ICsgICAg
ICAgICAgICAgICAgICogVGhpcyBjb25kaXRpb24gaXMgcG9zc2libGUgc2luY2UgYSBjb250aWd1
b3VzIGJ1ZmZlciBpbiBHUEEKPiArICAgICAgICAgICAgICAgICAqIGRvZXMgbm90IGltcGx5IGEg
Y29udGlndW91cyBidWZmZXIgaW4gcWVtdSdzIFZBCj4gKyAgICAgICAgICAgICAgICAgKiBzY2F0
dGVyLWdhdGhlciBzZWdtZW50cy4gSWYgdGhhdCBoYXBwZW5zLCB0aGUgYnVmZmVyIGV4cG9zZWQK
PiArICAgICAgICAgICAgICAgICAqIHRvIHRoZSBkZXZpY2UgbmVlZHMgdG8gYmUgYSBjaGFpbiBv
ZiBkZXNjcmlwdG9ycyBhdCB0aGlzCj4gKyAgICAgICAgICAgICAgICAgKiBtb21lbnQuCj4gKyAg
ICAgICAgICAgICAgICAgKgo+ICsgICAgICAgICAgICAgICAgICogU1ZRIGNhbm5vdCBob2xkIG1v
cmUgYXZhaWxhYmxlIGJ1ZmZlcnMgaWYgd2UgYXJlIGhlcmU6Cj4gKyAgICAgICAgICAgICAgICAg
KiBxdWV1ZSB0aGUgY3VycmVudCBndWVzdCBkZXNjcmlwdG9yIGFuZCBpZ25vcmUgZnVydGhlciBr
aWNrcwo+ICsgICAgICAgICAgICAgICAgICogdW50aWwgc29tZSBlbGVtZW50cyBhcmUgdXNlZC4K
PiArICAgICAgICAgICAgICAgICAqLwo+ICsgICAgICAgICAgICAgICAgc3ZxLT5uZXh0X2d1ZXN0
X2F2YWlsX2VsZW0gPSBlbGVtOwo+ICsgICAgICAgICAgICAgICAgcmV0dXJuOwo+ICsgICAgICAg
ICAgICB9Cj4gKwo+ICsgICAgICAgICAgICBvayA9IHZob3N0X3N2cV9hZGQoc3ZxLCBlbGVtKTsK
PiArICAgICAgICAgICAgaWYgKHVubGlrZWx5KCFvaykpIHsKPiArICAgICAgICAgICAgICAgIC8q
IFZRIGlzIGJyb2tlbiwganVzdCByZXR1cm4gYW5kIGlnbm9yZSBhbnkgb3RoZXIga2lja3MgKi8K
PiArICAgICAgICAgICAgICAgIHJldHVybjsKPiArICAgICAgICAgICAgfQo+ICsgICAgICAgICAg
ICB2aG9zdF9zdnFfa2ljayhzdnEpOwo+ICsgICAgICAgIH0KPiArCj4gKyAgICAgICAgdmlydGlv
X3F1ZXVlX3NldF9ub3RpZmljYXRpb24oc3ZxLT52cSwgdHJ1ZSk7Cj4gKyAgICB9IHdoaWxlICgh
dmlydGlvX3F1ZXVlX2VtcHR5KHN2cS0+dnEpKTsKPiArfQo+ICsKPiArLyoqCj4gKyAqIEhhbmRs
ZSBndWVzdCdzIGtpY2suCj4gKyAqCj4gKyAqIEBuIGd1ZXN0IGtpY2sgZXZlbnQgbm90aWZpZXIs
IHRoZSBvbmUgdGhhdCBndWVzdCBzZXQgdG8gbm90aWZ5IHN2cS4KPiArICovCj4gK3N0YXRpYyB2
b2lkIHZob3N0X2hhbmRsZV9ndWVzdF9raWNrX25vdGlmaWVyKEV2ZW50Tm90aWZpZXIgKm4pCj4g
ICB7Cj4gICAgICAgVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSA9IGNvbnRhaW5lcl9vZihuLCBW
aG9zdFNoYWRvd1ZpcnRxdWV1ZSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN2cV9raWNrKTsKPiAgICAgICBldmVudF9ub3RpZmllcl90ZXN0X2FuZF9j
bGVhcihuKTsKPiAtICAgIGV2ZW50X25vdGlmaWVyX3NldCgmc3ZxLT5oZGV2X2tpY2spOwo+ICsg
ICAgdmhvc3RfaGFuZGxlX2d1ZXN0X2tpY2soc3ZxKTsKPiArfQo+ICsKPiArc3RhdGljIGJvb2wg
dmhvc3Rfc3ZxX21vcmVfdXNlZChWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqc3ZxKQo+ICt7Cj4gKyAg
ICBpZiAoc3ZxLT5sYXN0X3VzZWRfaWR4ICE9IHN2cS0+c2hhZG93X3VzZWRfaWR4KSB7Cj4gKyAg
ICAgICAgcmV0dXJuIHRydWU7Cj4gKyAgICB9Cj4gKwo+ICsgICAgc3ZxLT5zaGFkb3dfdXNlZF9p
ZHggPSBjcHVfdG9fbGUxNihzdnEtPnZyaW5nLnVzZWQtPmlkeCk7Cj4gKwo+ICsgICAgcmV0dXJu
IHN2cS0+bGFzdF91c2VkX2lkeCAhPSBzdnEtPnNoYWRvd191c2VkX2lkeDsKPiAgIH0KPiAgIAo+
IC0vKiBGb3J3YXJkIHZob3N0IG5vdGlmaWNhdGlvbnMgKi8KPiArc3RhdGljIFZpcnRRdWV1ZUVs
ZW1lbnQgKnZob3N0X3N2cV9nZXRfYnVmKFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEpCj4gK3sK
PiArICAgIHZyaW5nX2Rlc2NfdCAqZGVzY3MgPSBzdnEtPnZyaW5nLmRlc2M7Cj4gKyAgICBjb25z
dCB2cmluZ191c2VkX3QgKnVzZWQgPSBzdnEtPnZyaW5nLnVzZWQ7Cj4gKyAgICB2cmluZ191c2Vk
X2VsZW1fdCB1c2VkX2VsZW07Cj4gKyAgICB1aW50MTZfdCBsYXN0X3VzZWQ7Cj4gKwo+ICsgICAg
aWYgKCF2aG9zdF9zdnFfbW9yZV91c2VkKHN2cSkpIHsKPiArICAgICAgICByZXR1cm4gTlVMTDsK
PiArICAgIH0KPiArCj4gKyAgICAvKiBPbmx5IGdldCB1c2VkIGFycmF5IGVudHJpZXMgYWZ0ZXIg
dGhleSBoYXZlIGJlZW4gZXhwb3NlZCBieSBkZXYgKi8KPiArICAgIHNtcF9ybWIoKTsKPiArICAg
IGxhc3RfdXNlZCA9IHN2cS0+bGFzdF91c2VkX2lkeCAmIChzdnEtPnZyaW5nLm51bSAtIDEpOwo+
ICsgICAgdXNlZF9lbGVtLmlkID0gbGUzMl90b19jcHUodXNlZC0+cmluZ1tsYXN0X3VzZWRdLmlk
KTsKPiArICAgIHVzZWRfZWxlbS5sZW4gPSBsZTMyX3RvX2NwdSh1c2VkLT5yaW5nW2xhc3RfdXNl
ZF0ubGVuKTsKPiArCj4gKyAgICBzdnEtPmxhc3RfdXNlZF9pZHgrKzsKPiArICAgIGlmICh1bmxp
a2VseSh1c2VkX2VsZW0uaWQgPj0gc3ZxLT52cmluZy5udW0pKSB7Cj4gKyAgICAgICAgcWVtdV9s
b2dfbWFzayhMT0dfR1VFU1RfRVJST1IsICJEZXZpY2UgJXMgc2F5cyBpbmRleCAldSBpcyB1c2Vk
IiwKPiArICAgICAgICAgICAgICAgICAgICAgIHN2cS0+dmRldi0+bmFtZSwgdXNlZF9lbGVtLmlk
KTsKPiArICAgICAgICByZXR1cm4gTlVMTDsKPiArICAgIH0KPiArCj4gKyAgICBpZiAodW5saWtl
bHkoIXN2cS0+cmluZ19pZF9tYXBzW3VzZWRfZWxlbS5pZF0pKSB7Cj4gKyAgICAgICAgcWVtdV9s
b2dfbWFzayhMT0dfR1VFU1RfRVJST1IsCj4gKyAgICAgICAgICAgICJEZXZpY2UgJXMgc2F5cyBp
bmRleCAldSBpcyB1c2VkLCBidXQgaXQgd2FzIG5vdCBhdmFpbGFibGUiLAo+ICsgICAgICAgICAg
ICBzdnEtPnZkZXYtPm5hbWUsIHVzZWRfZWxlbS5pZCk7Cj4gKyAgICAgICAgcmV0dXJuIE5VTEw7
Cj4gKyAgICB9Cj4gKwo+ICsgICAgZGVzY3NbdXNlZF9lbGVtLmlkXS5uZXh0ID0gc3ZxLT5mcmVl
X2hlYWQ7Cj4gKyAgICBzdnEtPmZyZWVfaGVhZCA9IHVzZWRfZWxlbS5pZDsKPiArCj4gKyAgICBz
dnEtPnJpbmdfaWRfbWFwc1t1c2VkX2VsZW0uaWRdLT5sZW4gPSB1c2VkX2VsZW0ubGVuOwoKCkl0
IGxvb2tzIHRvIG1lIHdlJ2QgYmV0dGVyIG5vdCBtb2RpZnkgdGhlIGVsZW0gaGVyZSwgb3RoZXJ3
aXNlIHdlIG1heSAKbGVhayBtYXBwaW5nIGR1cmluZyB2aXJ0cXVldWVfdW5tYXBfc2coKT8KCgo+
ICsgICAgcmV0dXJuIGdfc3RlYWxfcG9pbnRlcigmc3ZxLT5yaW5nX2lkX21hcHNbdXNlZF9lbGVt
LmlkXSk7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHZob3N0X3N2cV9mbHVzaChWaG9zdFNoYWRv
d1ZpcnRxdWV1ZSAqc3ZxLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBjaGVj
a19mb3JfYXZhaWxfcXVldWUpCj4gK3sKPiArICAgIFZpcnRRdWV1ZSAqdnEgPSBzdnEtPnZxOwo+
ICsKPiArICAgIC8qIEZvcndhcmQgYXMgbWFueSB1c2VkIGJ1ZmZlcnMgYXMgcG9zc2libGUuICov
Cj4gKyAgICBkbyB7Cj4gKyAgICAgICAgdW5zaWduZWQgaSA9IDA7Cj4gKwo+ICsgICAgICAgIHZo
b3N0X3N2cV9zZXRfbm90aWZpY2F0aW9uKHN2cSwgZmFsc2UpOwo+ICsgICAgICAgIHdoaWxlICh0
cnVlKSB7Cj4gKyAgICAgICAgICAgIGdfYXV0b2ZyZWUgVmlydFF1ZXVlRWxlbWVudCAqZWxlbSA9
IHZob3N0X3N2cV9nZXRfYnVmKHN2cSk7Cj4gKyAgICAgICAgICAgIGlmICghZWxlbSkgewo+ICsg
ICAgICAgICAgICAgICAgYnJlYWs7Cj4gKyAgICAgICAgICAgIH0KPiArCj4gKyAgICAgICAgICAg
IGlmICh1bmxpa2VseShpID49IHN2cS0+dnJpbmcubnVtKSkgewo+ICsgICAgICAgICAgICAgICAg
cWVtdV9sb2dfbWFzayhMT0dfR1VFU1RfRVJST1IsCj4gKyAgICAgICAgICAgICAgICAgICAgICAg
ICAiTW9yZSB0aGFuICV1IHVzZWQgYnVmZmVycyBvYnRhaW5lZCBpbiBhICV1IHNpemUgU1ZRIiwK
PiArICAgICAgICAgICAgICAgICAgICAgICAgIGksIHN2cS0+dnJpbmcubnVtKTsKPiArICAgICAg
ICAgICAgICAgIHZpcnRxdWV1ZV9maWxsKHZxLCBlbGVtLCBlbGVtLT5sZW4sIGkpOwo+ICsgICAg
ICAgICAgICAgICAgdmlydHF1ZXVlX2ZsdXNoKHZxLCBpKTsKPiArICAgICAgICAgICAgICAgIHJl
dHVybjsKPiArICAgICAgICAgICAgfQo+ICsgICAgICAgICAgICB2aXJ0cXVldWVfZmlsbCh2cSwg
ZWxlbSwgZWxlbS0+bGVuLCBpKyspOwo+ICsgICAgICAgIH0KPiArCj4gKyAgICAgICAgdmlydHF1
ZXVlX2ZsdXNoKHZxLCBpKTsKPiArICAgICAgICBldmVudF9ub3RpZmllcl9zZXQoJnN2cS0+c3Zx
X2NhbGwpOwo+ICsKPiArICAgICAgICBpZiAoY2hlY2tfZm9yX2F2YWlsX3F1ZXVlICYmIHN2cS0+
bmV4dF9ndWVzdF9hdmFpbF9lbGVtKSB7Cj4gKyAgICAgICAgICAgIC8qCj4gKyAgICAgICAgICAg
ICAqIEF2YWlsIHJpbmcgd2FzIGZ1bGwgd2hlbiB2aG9zdF9zdnFfZmx1c2ggd2FzIGNhbGxlZCwg
c28gaXQncyBhCj4gKyAgICAgICAgICAgICAqIGdvb2QgbW9tZW50IHRvIG1ha2UgbW9yZSBkZXNj
cmlwdG9ycyBhdmFpbGFibGUgaWYgcG9zc2libGUuCj4gKyAgICAgICAgICAgICAqLwo+ICsgICAg
ICAgICAgICB2aG9zdF9oYW5kbGVfZ3Vlc3Rfa2ljayhzdnEpOwo+ICsgICAgICAgIH0KPiArCj4g
KyAgICAgICAgdmhvc3Rfc3ZxX3NldF9ub3RpZmljYXRpb24oc3ZxLCB0cnVlKTsKPiArICAgIH0g
d2hpbGUgKHZob3N0X3N2cV9tb3JlX3VzZWQoc3ZxKSk7Cj4gK30KPiArCj4gKy8qKgo+ICsgKiBG
b3J3YXJkIHVzZWQgYnVmZmVycy4KPiArICoKPiArICogQG4gaGRldiBjYWxsIGV2ZW50IG5vdGlm
aWVyLCB0aGUgb25lIHRoYXQgZGV2aWNlIHNldCB0byBub3RpZnkgc3ZxLgo+ICsgKgo+ICsgKiBO
b3RlIHRoYXQgd2UgYXJlIG5vdCBtYWtpbmcgYW55IGJ1ZmZlcnMgYXZhaWxhYmxlIGluIHRoZSBs
b29wLCB0aGVyZSBpcyBubwo+ICsgKiB3YXkgdGhhdCBpdCBydW5zIG1vcmUgdGhhbiB2aXJ0cXVl
dWUgc2l6ZSB0aW1lcy4KPiArICovCj4gICBzdGF0aWMgdm9pZCB2aG9zdF9zdnFfaGFuZGxlX2Nh
bGwoRXZlbnROb3RpZmllciAqbikKPiAgIHsKPiAgICAgICBWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAq
c3ZxID0gY29udGFpbmVyX29mKG4sIFZob3N0U2hhZG93VmlydHF1ZXVlLAo+ICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGRldl9jYWxsKTsKPiAgICAgICBl
dmVudF9ub3RpZmllcl90ZXN0X2FuZF9jbGVhcihuKTsKPiAtICAgIGV2ZW50X25vdGlmaWVyX3Nl
dCgmc3ZxLT5zdnFfY2FsbCk7Cj4gKyAgICB2aG9zdF9zdnFfZmx1c2goc3ZxLCB0cnVlKTsKPiAg
IH0KPiAgIAo+ICAgLyoqCj4gQEAgLTE0OSw3ICs0MzcsNDEgQEAgdm9pZCB2aG9zdF9zdnFfc2V0
X3N2cV9raWNrX2ZkKFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEsIGludCBzdnFfa2lja19mZCkK
PiAgICAgICBpZiAocG9sbF9zdGFydCkgewo+ICAgICAgICAgICBldmVudF9ub3RpZmllcl9pbml0
X2ZkKHN2cV9raWNrLCBzdnFfa2lja19mZCk7Cj4gICAgICAgICAgIGV2ZW50X25vdGlmaWVyX3Nl
dChzdnFfa2ljayk7Cj4gLSAgICAgICAgZXZlbnRfbm90aWZpZXJfc2V0X2hhbmRsZXIoc3ZxX2tp
Y2ssIHZob3N0X2hhbmRsZV9ndWVzdF9raWNrKTsKPiArICAgICAgICBldmVudF9ub3RpZmllcl9z
ZXRfaGFuZGxlcihzdnFfa2ljaywgdmhvc3RfaGFuZGxlX2d1ZXN0X2tpY2tfbm90aWZpZXIpOwo+
ICsgICAgfQo+ICt9Cj4gKwo+ICsvKioKPiArICogU3RhcnQgdGhlIHNoYWRvdyB2aXJ0cXVldWUg
b3BlcmF0aW9uLgo+ICsgKgo+ICsgKiBAc3ZxIFNoYWRvdyBWaXJ0cXVldWUKPiArICogQHZkZXYg
ICAgICAgIFZpcnRJTyBkZXZpY2UKPiArICogQHZxICAgICAgICAgIFZpcnRxdWV1ZSB0byBzaGFk
b3cKPiArICovCj4gK3ZvaWQgdmhvc3Rfc3ZxX3N0YXJ0KFZob3N0U2hhZG93VmlydHF1ZXVlICpz
dnEsIFZpcnRJT0RldmljZSAqdmRldiwKPiArICAgICAgICAgICAgICAgICAgICAgVmlydFF1ZXVl
ICp2cSkKPiArewo+ICsgICAgc2l6ZV90IGRlc2Nfc2l6ZSwgZHJpdmVyX3NpemUsIGRldmljZV9z
aXplOwo+ICsKPiArICAgIHN2cS0+bmV4dF9ndWVzdF9hdmFpbF9lbGVtID0gTlVMTDsKPiArICAg
IHN2cS0+YXZhaWxfaWR4X3NoYWRvdyA9IDA7Cj4gKyAgICBzdnEtPnNoYWRvd191c2VkX2lkeCA9
IDA7Cj4gKyAgICBzdnEtPmxhc3RfdXNlZF9pZHggPSAwOwo+ICsgICAgc3ZxLT52ZGV2ID0gdmRl
djsKPiArICAgIHN2cS0+dnEgPSB2cTsKPiArCj4gKyAgICBzdnEtPnZyaW5nLm51bSA9IHZpcnRp
b19xdWV1ZV9nZXRfbnVtKHZkZXYsIHZpcnRpb19nZXRfcXVldWVfaW5kZXgodnEpKTsKPiArICAg
IGRyaXZlcl9zaXplID0gdmhvc3Rfc3ZxX2RyaXZlcl9hcmVhX3NpemUoc3ZxKTsKPiArICAgIGRl
dmljZV9zaXplID0gdmhvc3Rfc3ZxX2RldmljZV9hcmVhX3NpemUoc3ZxKTsKPiArICAgIHN2cS0+
dnJpbmcuZGVzYyA9IHFlbXVfbWVtYWxpZ24ocWVtdV9yZWFsX2hvc3RfcGFnZV9zaXplLCBkcml2
ZXJfc2l6ZSk7Cj4gKyAgICBkZXNjX3NpemUgPSBzaXplb2YodnJpbmdfZGVzY190KSAqIHN2cS0+
dnJpbmcubnVtOwo+ICsgICAgc3ZxLT52cmluZy5hdmFpbCA9ICh2b2lkICopKChjaGFyICopc3Zx
LT52cmluZy5kZXNjICsgZGVzY19zaXplKTsKPiArICAgIG1lbXNldChzdnEtPnZyaW5nLmRlc2Ms
IDAsIGRyaXZlcl9zaXplKTsKPiArICAgIHN2cS0+dnJpbmcudXNlZCA9IHFlbXVfbWVtYWxpZ24o
cWVtdV9yZWFsX2hvc3RfcGFnZV9zaXplLCBkZXZpY2Vfc2l6ZSk7Cj4gKyAgICBtZW1zZXQoc3Zx
LT52cmluZy51c2VkLCAwLCBkZXZpY2Vfc2l6ZSk7Cj4gKyAgICBzdnEtPnJpbmdfaWRfbWFwcyA9
IGdfbmV3MChWaXJ0UXVldWVFbGVtZW50ICosIHN2cS0+dnJpbmcubnVtKTsKPiArICAgIGZvciAo
dW5zaWduZWQgaSA9IDA7IGkgPCBzdnEtPnZyaW5nLm51bSAtIDE7IGkrKykgewo+ICsgICAgICAg
IHN2cS0+dnJpbmcuZGVzY1tpXS5uZXh0ID0gY3B1X3RvX2xlMTYoaSArIDEpOwo+ICAgICAgIH0K
PiAgIH0KPiAgIAo+IEBAIC0xNjAsNiArNDgyLDMyIEBAIHZvaWQgdmhvc3Rfc3ZxX3NldF9zdnFf
a2lja19mZChWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqc3ZxLCBpbnQgc3ZxX2tpY2tfZmQpCj4gICB2
b2lkIHZob3N0X3N2cV9zdG9wKFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEpCj4gICB7Cj4gICAg
ICAgZXZlbnRfbm90aWZpZXJfc2V0X2hhbmRsZXIoJnN2cS0+c3ZxX2tpY2ssIE5VTEwpOwo+ICsg
ICAgZ19hdXRvZnJlZSBWaXJ0UXVldWVFbGVtZW50ICpuZXh0X2F2YWlsX2VsZW0gPSBOVUxMOwo+
ICsKPiArICAgIGlmICghc3ZxLT52cSkgewo+ICsgICAgICAgIHJldHVybjsKPiArICAgIH0KPiAr
Cj4gKyAgICAvKiBTZW5kIGFsbCBwZW5kaW5nIHVzZWQgZGVzY3JpcHRvcnMgdG8gZ3Vlc3QgKi8K
PiArICAgIHZob3N0X3N2cV9mbHVzaChzdnEsIGZhbHNlKTsKPiArCj4gKyAgICBmb3IgKHVuc2ln
bmVkIGkgPSAwOyBpIDwgc3ZxLT52cmluZy5udW07ICsraSkgewo+ICsgICAgICAgIGdfYXV0b2Zy
ZWUgVmlydFF1ZXVlRWxlbWVudCAqZWxlbSA9IE5VTEw7Cj4gKyAgICAgICAgZWxlbSA9IGdfc3Rl
YWxfcG9pbnRlcigmc3ZxLT5yaW5nX2lkX21hcHNbaV0pOwo+ICsgICAgICAgIGlmIChlbGVtKSB7
Cj4gKyAgICAgICAgICAgIHZpcnRxdWV1ZV9kZXRhY2hfZWxlbWVudChzdnEtPnZxLCBlbGVtLCBl
bGVtLT5sZW4pOwo+ICsgICAgICAgIH0KPiArICAgIH0KPiArCj4gKyAgICBuZXh0X2F2YWlsX2Vs
ZW0gPSBnX3N0ZWFsX3BvaW50ZXIoJnN2cS0+bmV4dF9ndWVzdF9hdmFpbF9lbGVtKTsKPiArICAg
IGlmIChuZXh0X2F2YWlsX2VsZW0pIHsKPiArICAgICAgICB2aXJ0cXVldWVfZGV0YWNoX2VsZW1l
bnQoc3ZxLT52cSwgbmV4dF9hdmFpbF9lbGVtLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBuZXh0X2F2YWlsX2VsZW0tPmxlbik7Cj4gKyAgICB9Cj4gKyAgICBzdnEtPnZxID0g
TlVMTDsKPiArICAgIGdfZnJlZShzdnEtPnJpbmdfaWRfbWFwcyk7Cj4gKyAgICBxZW11X3ZmcmVl
KHN2cS0+dnJpbmcuZGVzYyk7Cj4gKyAgICBxZW11X3ZmcmVlKHN2cS0+dnJpbmcudXNlZCk7Cj4g
ICB9Cj4gICAKPiAgIC8qKgo+IGRpZmYgLS1naXQgYS9ody92aXJ0aW8vdmhvc3QtdmRwYS5jIGIv
aHcvdmlydGlvL3Zob3N0LXZkcGEuYwo+IGluZGV4IGIyYzRlOTJmY2YuLjQzNWI5YzJlOWUgMTAw
NjQ0Cj4gLS0tIGEvaHcvdmlydGlvL3Zob3N0LXZkcGEuYwo+ICsrKyBiL2h3L3ZpcnRpby92aG9z
dC12ZHBhLmMKPiBAQCAtODAzLDEwICs4MDMsMTAgQEAgc3RhdGljIGludCB2aG9zdF92ZHBhX3Nl
dF92cmluZ19kZXZfYWRkcihzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYsCj4gICAgKiBOb3RlIHRoYXQg
dGhpcyBmdW5jdGlvbiBkb2VzIG5vdCByZXdpbmQga2ljayBmaWxlIGRlc2NyaXB0b3IgaWYgY2Fu
bm90IHNldAo+ICAgICogY2FsbCBvbmUuCj4gICAgKi8KPiAtc3RhdGljIGJvb2wgdmhvc3RfdmRw
YV9zdnFfc2V0dXAoc3RydWN0IHZob3N0X2RldiAqZGV2LAo+IC0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqc3ZxLAo+IC0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpZHgsCj4gLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEVycm9yICoqZXJycCkKPiArc3RhdGljIGludCB2aG9zdF92ZHBhX3N2cV9z
ZXRfZmRzKHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPiArICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEsCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpZHgsCj4gKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBFcnJvciAqKmVycnApCj4gICB7Cj4gICAgICAgc3RydWN0IHZob3N0X3ZyaW5n
X2ZpbGUgZmlsZSA9IHsKPiAgICAgICAgICAgLmluZGV4ID0gZGV2LT52cV9pbmRleCArIGlkeCwK
PiBAQCAtODE4LDcgKzgxOCw3IEBAIHN0YXRpYyBib29sIHZob3N0X3ZkcGFfc3ZxX3NldHVwKHN0
cnVjdCB2aG9zdF9kZXYgKmRldiwKPiAgICAgICByID0gdmhvc3RfdmRwYV9zZXRfdnJpbmdfZGV2
X2tpY2soZGV2LCAmZmlsZSk7Cj4gICAgICAgaWYgKHVubGlrZWx5KHIgIT0gMCkpIHsKPiAgICAg
ICAgICAgZXJyb3Jfc2V0Z19lcnJubyhlcnJwLCAtciwgIkNhbid0IHNldCBkZXZpY2Uga2ljayBm
ZCIpOwo+IC0gICAgICAgIHJldHVybiBmYWxzZTsKPiArICAgICAgICByZXR1cm4gcjsKPiAgICAg
ICB9Cj4gICAKPiAgICAgICBldmVudF9ub3RpZmllciA9ICZzdnEtPmhkZXZfY2FsbDsKPiBAQCAt
ODI4LDYgKzgyOCwxMTkgQEAgc3RhdGljIGJvb2wgdmhvc3RfdmRwYV9zdnFfc2V0dXAoc3RydWN0
IHZob3N0X2RldiAqZGV2LAo+ICAgICAgICAgICBlcnJvcl9zZXRnX2Vycm5vKGVycnAsIC1yLCAi
Q2FuJ3Qgc2V0IGRldmljZSBjYWxsIGZkIik7Cj4gICAgICAgfQo+ICAgCj4gKyAgICByZXR1cm4g
cjsKPiArfQo+ICsKPiArLyoqCj4gKyAqIFVubWFwIGEgU1ZRIGFyZWEgaW4gdGhlIGRldmljZQo+
ICsgKi8KPiArc3RhdGljIGJvb2wgdmhvc3RfdmRwYV9zdnFfdW5tYXBfcmluZyhzdHJ1Y3Qgdmhv
c3RfdmRwYSAqdiwgaHdhZGRyIGlvdmEsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgaHdhZGRyIHNpemUpCj4gK3sKPiArICAgIGludCByOwo+ICsKPiArICAgIHNpemUg
PSBST1VORF9VUChzaXplLCBxZW11X3JlYWxfaG9zdF9wYWdlX3NpemUpOwo+ICsgICAgciA9IHZo
b3N0X3ZkcGFfZG1hX3VubWFwKHYsIGlvdmEsIHNpemUpOwo+ICsgICAgcmV0dXJuIHIgPT0gMDsK
PiArfQo+ICsKPiArc3RhdGljIGJvb2wgdmhvc3RfdmRwYV9zdnFfdW5tYXBfcmluZ3Moc3RydWN0
IHZob3N0X2RldiAqZGV2LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBjb25zdCBWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqc3ZxKQo+ICt7Cj4gKyAgICBzdHJ1Y3Qgdmhv
c3RfdmRwYSAqdiA9IGRldi0+b3BhcXVlOwo+ICsgICAgc3RydWN0IHZob3N0X3ZyaW5nX2FkZHIg
c3ZxX2FkZHI7Cj4gKyAgICBzaXplX3QgZGV2aWNlX3NpemUgPSB2aG9zdF9zdnFfZGV2aWNlX2Fy
ZWFfc2l6ZShzdnEpOwo+ICsgICAgc2l6ZV90IGRyaXZlcl9zaXplID0gdmhvc3Rfc3ZxX2RyaXZl
cl9hcmVhX3NpemUoc3ZxKTsKPiArICAgIGJvb2wgb2s7Cj4gKwo+ICsgICAgdmhvc3Rfc3ZxX2dl
dF92cmluZ19hZGRyKHN2cSwgJnN2cV9hZGRyKTsKPiArCj4gKyAgICBvayA9IHZob3N0X3ZkcGFf
c3ZxX3VubWFwX3Jpbmcodiwgc3ZxX2FkZHIuZGVzY191c2VyX2FkZHIsIGRyaXZlcl9zaXplKTsK
PiArICAgIGlmICh1bmxpa2VseSghb2spKSB7Cj4gKyAgICAgICAgcmV0dXJuIGZhbHNlOwo+ICsg
ICAgfQo+ICsKPiArICAgIHJldHVybiB2aG9zdF92ZHBhX3N2cV91bm1hcF9yaW5nKHYsIHN2cV9h
ZGRyLnVzZWRfdXNlcl9hZGRyLCBkZXZpY2Vfc2l6ZSk7Cj4gK30KPiArCj4gKy8qKgo+ICsgKiBN
YXAgc2hhZG93IHZpcnRxdWV1ZSByaW5ncyBpbiBkZXZpY2UKPiArICoKPiArICogQGRldiAgIFRo
ZSB2aG9zdCBkZXZpY2UKPiArICogQHN2cSAgIFRoZSBzaGFkb3cgdmlydHF1ZXVlCj4gKyAqIEBh
ZGRyICBBc3NpZ25lZCBJT1ZBIGFkZHJlc3Nlcwo+ICsgKiBAZXJycCAgRXJyb3IgcG9pbnRlcgo+
ICsgKi8KPiArc3RhdGljIGJvb2wgdmhvc3RfdmRwYV9zdnFfbWFwX3JpbmdzKHN0cnVjdCB2aG9z
dF9kZXYgKmRldiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0
IFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzdHJ1Y3Qgdmhvc3RfdnJpbmdfYWRkciAqYWRkciwKPiArICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKPiArewo+ICsgICAgc3RydWN0
IHZob3N0X3ZkcGEgKnYgPSBkZXYtPm9wYXF1ZTsKPiArICAgIHNpemVfdCBkZXZpY2Vfc2l6ZSA9
IHZob3N0X3N2cV9kZXZpY2VfYXJlYV9zaXplKHN2cSk7Cj4gKyAgICBzaXplX3QgZHJpdmVyX3Np
emUgPSB2aG9zdF9zdnFfZHJpdmVyX2FyZWFfc2l6ZShzdnEpOwo+ICsgICAgaW50IHI7Cj4gKwo+
ICsgICAgRVJSUF9HVUFSRCgpOwo+ICsgICAgdmhvc3Rfc3ZxX2dldF92cmluZ19hZGRyKHN2cSwg
YWRkcik7Cj4gKwo+ICsgICAgciA9IHZob3N0X3ZkcGFfZG1hX21hcCh2LCBhZGRyLT5kZXNjX3Vz
ZXJfYWRkciwgZHJpdmVyX3NpemUsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICh2b2lk
ICopYWRkci0+ZGVzY191c2VyX2FkZHIsIHRydWUpOwo+ICsgICAgaWYgKHVubGlrZWx5KHIgIT0g
MCkpIHsKPiArICAgICAgICBlcnJvcl9zZXRnX2Vycm5vKGVycnAsIC1yLCAiQ2Fubm90IGNyZWF0
ZSB2cSBkcml2ZXIgcmVnaW9uOiAiKTsKPiArICAgICAgICByZXR1cm4gZmFsc2U7Cj4gKyAgICB9
Cj4gKwo+ICsgICAgciA9IHZob3N0X3ZkcGFfZG1hX21hcCh2LCBhZGRyLT51c2VkX3VzZXJfYWRk
ciwgZGV2aWNlX3NpemUsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICh2b2lkICopYWRk
ci0+dXNlZF91c2VyX2FkZHIsIGZhbHNlKTsKPiArICAgIGlmICh1bmxpa2VseShyICE9IDApKSB7
Cj4gKyAgICAgICAgZXJyb3Jfc2V0Z19lcnJubyhlcnJwLCAtciwgIkNhbm5vdCBjcmVhdGUgdnEg
ZGV2aWNlIHJlZ2lvbjogIik7Cj4gKyAgICB9Cj4gKwo+ICsgICAgcmV0dXJuIHIgPT0gMDsKPiAr
fQo+ICsKPiArc3RhdGljIGJvb2wgdmhvc3RfdmRwYV9zdnFfc2V0dXAoc3RydWN0IHZob3N0X2Rl
diAqZGV2LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWaG9zdFNoYWRvd1Zp
cnRxdWV1ZSAqc3ZxLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25l
ZCBpZHgsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkK
PiArewo+ICsgICAgdWludDE2X3QgdnFfaW5kZXggPSBkZXYtPnZxX2luZGV4ICsgaWR4Owo+ICsg
ICAgc3RydWN0IHZob3N0X3ZyaW5nX3N0YXRlIHMgPSB7Cj4gKyAgICAgICAgLmluZGV4ID0gdnFf
aW5kZXgsCj4gKyAgICB9Owo+ICsgICAgaW50IHI7Cj4gKwo+ICsgICAgciA9IHZob3N0X3ZkcGFf
c2V0X2Rldl92cmluZ19iYXNlKGRldiwgJnMpOwo+ICsgICAgaWYgKHVubGlrZWx5KHIpKSB7Cj4g
KyAgICAgICAgZXJyb3Jfc2V0Z19lcnJubyhlcnJwLCAtciwgIkNhbm5vdCBzZXQgdnJpbmcgYmFz
ZSIpOwo+ICsgICAgICAgIHJldHVybiBmYWxzZTsKPiArICAgIH0KPiArCj4gKyAgICByID0gdmhv
c3RfdmRwYV9zdnFfc2V0X2ZkcyhkZXYsIHN2cSwgaWR4LCBlcnJwKTsKPiArICAgIHJldHVybiBy
ID09IDA7Cj4gK30KPiArCj4gK3N0YXRpYyBib29sIHZob3N0X3ZkcGFfc3ZxX3NldF9hZGRyKHN0
cnVjdCB2aG9zdF9kZXYgKmRldiwgdW5zaWduZWQgaWR4LAo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqc3ZxLAo+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBFcnJvciAqKmVycnApCj4gK3sKPiArICAgIHN0cnVj
dCB2aG9zdF92cmluZ19hZGRyIGFkZHIgPSB7Cj4gKyAgICAgICAgLmluZGV4ID0gaWR4LAo+ICsg
ICAgfTsKPiArICAgIGludCByOwo+ICsKPiArICAgIGJvb2wgb2sgPSB2aG9zdF92ZHBhX3N2cV9t
YXBfcmluZ3MoZGV2LCBzdnEsICZhZGRyLCBlcnJwKTsKPiArICAgIGlmICh1bmxpa2VseSghb2sp
KSB7Cj4gKyAgICAgICAgcmV0dXJuIGZhbHNlOwo+ICsgICAgfQo+ICsKPiArICAgIC8qIE92ZXJy
aWRlIHZyaW5nIEdQQSBzZXQgYnkgdmhvc3Qgc3Vic3lzdGVtICovCj4gKyAgICByID0gdmhvc3Rf
dmRwYV9zZXRfdnJpbmdfZGV2X2FkZHIoZGV2LCAmYWRkcik7Cj4gKyAgICBpZiAodW5saWtlbHko
ciAhPSAwKSkgewo+ICsgICAgICAgIGVycm9yX3NldGdfZXJybm8oZXJycCwgLXIsICJDYW5ub3Qg
c2V0IGRldmljZSBhZGRyZXNzIik7Cj4gKyAgICB9Cj4gKwo+ICAgICAgIHJldHVybiByID09IDA7
Cj4gICB9Cj4gICAKPiBAQCAtODQyLDEwICs5NTUsNDYgQEAgc3RhdGljIGJvb2wgdmhvc3RfdmRw
YV9zdnFzX3N0YXJ0KHN0cnVjdCB2aG9zdF9kZXYgKmRldikKPiAgICAgICB9Cj4gICAKPiAgICAg
ICBmb3IgKGkgPSAwOyBpIDwgdi0+c2hhZG93X3Zxcy0+bGVuOyArK2kpIHsKPiArICAgICAgICBW
aXJ0UXVldWUgKnZxID0gdmlydGlvX2dldF9xdWV1ZShkZXYtPnZkZXYsIGRldi0+dnFfaW5kZXgg
KyBpKTsKPiAgICAgICAgICAgVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSA9IGdfcHRyX2FycmF5
X2luZGV4KHYtPnNoYWRvd192cXMsIGkpOwo+ICAgICAgICAgICBib29sIG9rID0gdmhvc3RfdmRw
YV9zdnFfc2V0dXAoZGV2LCBzdnEsIGksICZlcnIpOwo+ICAgICAgICAgICBpZiAodW5saWtlbHko
IW9rKSkgewo+IC0gICAgICAgICAgICBlcnJvcl9yZXBvcnRmX2VycihlcnIsICJDYW5ub3Qgc2V0
dXAgU1ZRICV1OiAiLCBpKTsKPiArICAgICAgICAgICAgZ290byBlcnI7Cj4gKyAgICAgICAgfQo+
ICsgICAgICAgIHZob3N0X3N2cV9zdGFydChzdnEsIGRldi0+dmRldiwgdnEpOwo+ICsgICAgICAg
IG9rID0gdmhvc3RfdmRwYV9zdnFfc2V0X2FkZHIoZGV2LCBpLCBzdnEsICZlcnIpOwo+ICsgICAg
ICAgIGlmICh1bmxpa2VseSghb2spKSB7Cj4gKyAgICAgICAgICAgIHZob3N0X3N2cV9zdG9wKHN2
cSk7Cj4gKyAgICAgICAgICAgIGdvdG8gZXJyOwoKCk5pdDogbGV0J3MgaW50cm9kdWNlIGEgbmV3
IGVycm9yIGxhYmVsIGZvciB0aGlzPwoKCj4gKyAgICAgICAgfQo+ICsgICAgfQo+ICsKPiArICAg
IHJldHVybiB0cnVlOwo+ICsKPiArZXJyOgo+ICsgICAgZXJyb3JfcmVwb3J0Zl9lcnIoZXJyLCAi
Q2Fubm90IHNldHVwIFNWUSAldTogIiwgaSk7Cj4gKyAgICBmb3IgKHVuc2lnbmVkIGogPSAwOyBq
IDwgaTsgKytqKSB7Cj4gKyAgICAgICAgVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSA9IGdfcHRy
X2FycmF5X2luZGV4KHYtPnNoYWRvd192cXMsIGopOwo+ICsgICAgICAgIHZob3N0X3ZkcGFfc3Zx
X3VubWFwX3JpbmdzKGRldiwgc3ZxKTsKCgpJIHdvbmRlciBpZiBpdCdzIGJldHRlciB0byBtb3Zl
IHRoZSB2aG9zdF92ZHBhX3N2cV9tYXBfcmluZ3MoKSBvdXQgb2YgCnZob3N0X3ZkcGFfc3ZxX3Nl
dF9hZGRyKCkuIChUaGlzIGZ1bmN0aW9uIHNlZW1zIHRvIGJlIHRoZSBvbmx5IHVzZXIgZm9yIAp0
aGF0KS4gVGhpcyB3aWxsIG1ha2VzIHRoZSBlcnJvciBoYW5kbGluZyBsb2dpYyBtb3JlIGNsZWFy
LgoKVGhhbmtzCgoKPiArICAgICAgICB2aG9zdF9zdnFfc3RvcChzdnEpOwo+ICsgICAgfQo+ICsK
PiArICAgIHJldHVybiBmYWxzZTsKPiArfQo+ICsKPiArc3RhdGljIGJvb2wgdmhvc3RfdmRwYV9z
dnFzX3N0b3Aoc3RydWN0IHZob3N0X2RldiAqZGV2KQo+ICt7Cj4gKyAgICBzdHJ1Y3Qgdmhvc3Rf
dmRwYSAqdiA9IGRldi0+b3BhcXVlOwo+ICsKPiArICAgIGlmICghdi0+c2hhZG93X3Zxcykgewo+
ICsgICAgICAgIHJldHVybiB0cnVlOwo+ICsgICAgfQo+ICsKPiArICAgIGZvciAodW5zaWduZWQg
aSA9IDA7IGkgPCB2LT5zaGFkb3dfdnFzLT5sZW47ICsraSkgewo+ICsgICAgICAgIFZob3N0U2hh
ZG93VmlydHF1ZXVlICpzdnEgPSBnX3B0cl9hcnJheV9pbmRleCh2LT5zaGFkb3dfdnFzLAo+ICsg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKTsK
PiArICAgICAgICBib29sIG9rID0gdmhvc3RfdmRwYV9zdnFfdW5tYXBfcmluZ3MoZGV2LCBzdnEp
Owo+ICsgICAgICAgIGlmICh1bmxpa2VseSghb2spKSB7Cj4gICAgICAgICAgICAgICByZXR1cm4g
ZmFsc2U7Cj4gICAgICAgICAgIH0KPiAgICAgICB9Cj4gQEAgLTg2Nyw2ICsxMDE2LDEwIEBAIHN0
YXRpYyBpbnQgdmhvc3RfdmRwYV9kZXZfc3RhcnQoc3RydWN0IHZob3N0X2RldiAqZGV2LCBib29s
IHN0YXJ0ZWQpCj4gICAgICAgICAgIH0KPiAgICAgICAgICAgdmhvc3RfdmRwYV9zZXRfdnJpbmdf
cmVhZHkoZGV2KTsKPiAgICAgICB9IGVsc2Ugewo+ICsgICAgICAgIG9rID0gdmhvc3RfdmRwYV9z
dnFzX3N0b3AoZGV2KTsKPiArICAgICAgICBpZiAodW5saWtlbHkoIW9rKSkgewo+ICsgICAgICAg
ICAgICByZXR1cm4gLTE7Cj4gKyAgICAgICAgfQo+ICAgICAgICAgICB2aG9zdF92ZHBhX2hvc3Rf
bm90aWZpZXJzX3VuaW5pdChkZXYsIGRldi0+bnZxcyk7Cj4gICAgICAgfQo+ICAgCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBt
YWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0
cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6
YXRpb24=
