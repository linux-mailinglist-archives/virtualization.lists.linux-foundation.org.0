Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id CB9B22C3C64
	for <lists.virtualization@lfdr.de>; Wed, 25 Nov 2020 10:42:24 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 7E90A87445;
	Wed, 25 Nov 2020 09:42:23 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Q-xjhDtE-f5m; Wed, 25 Nov 2020 09:42:23 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 3F033874BC;
	Wed, 25 Nov 2020 09:42:09 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 107C0C0052;
	Wed, 25 Nov 2020 09:42:09 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 8906EC0052
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:42:04 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 71FFA86D64
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:42:04 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 8BenGIOTuJZI
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:41:58 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id B075F86D7B
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:41:55 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 8E452305D3C2; Wed, 25 Nov 2020 11:35:51 +0200 (EET)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 67B0C3072784;
 Wed, 25 Nov 2020 11:35:51 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v10 54/81] KVM: introspection: add KVMI_VCPU_SET_REGISTERS
Date: Wed, 25 Nov 2020 11:35:33 +0200
Message-Id: <20201125093600.2766-55-alazar@bitdefender.com>
In-Reply-To: <20201125093600.2766-1-alazar@bitdefender.com>
References: <20201125093600.2766-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Mircea=20C=C3=AErjaliu?= <mcirjaliu@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKRHVyaW5nIGFuIGlu
dHJvc3BlY3Rpb24gZXZlbnQsIHRoZSBpbnRyb3NwZWN0aW9uIHRvb2wgbWlnaHQgbmVlZCB0bwpj
aGFuZ2UgdGhlIHZDUFUgc3RhdGUsIGZvciBleGFtcGxlLCB0byBza2lwIHRoZSBjdXJyZW50IGlu
c3RydWN0aW9uLgoKVGhpcyBjb21tYW5kIGlzIGFsbG93ZWQgb25seSBkdXJpbmcgdkNQVSBldmVu
dHMgYW5kIHRoZSByZWdpc3RlcnMgd2lsbApiZSBzZXQgd2hlbiB0aGUgcmVwbHkgaGFzIGJlZW4g
cmVjZWl2ZWQuCgpTaWduZWQtb2ZmLWJ5OiBNaWhhaSBEb27Im3UgPG1kb250dUBiaXRkZWZlbmRl
ci5jb20+CkNvLWRldmVsb3BlZC1ieTogTWlyY2VhIEPDrnJqYWxpdSA8bWNpcmphbGl1QGJpdGRl
ZmVuZGVyLmNvbT4KU2lnbmVkLW9mZi1ieTogTWlyY2VhIEPDrnJqYWxpdSA8bWNpcmphbGl1QGJp
dGRlZmVuZGVyLmNvbT4KQ28tZGV2ZWxvcGVkLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBi
aXRkZWZlbmRlci5jb20+ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJp
dGRlZmVuZGVyLmNvbT4KLS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgICAg
ICAgICAgICAgfCAyOSArKysrKysrCiBhcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaCAg
ICAgICAgICAgICAgfCAgMiArCiBhcmNoL3g4Ni9rdm0va3ZtaS5jICAgICAgICAgICAgICAgICAg
ICAgICAgICAgfCAyMiArKysrKwogYXJjaC94ODYva3ZtL2t2bWkuaCAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHwgIDIgKwogYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMgICAgICAgICAgICAgICAg
ICAgICAgIHwgMTggKysrKwogaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaCAgICAgICAgICAgICAg
ICAgICAgIHwgIDEgKwogLi4uL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0
LmMgIHwgODMgKysrKysrKysrKysrKysrKysrKwogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1p
X2ludC5oICAgICAgICAgICAgIHwgIDEgKwogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21z
Zy5jICAgICAgICAgICAgIHwgIDYgKy0KIDkgZmlsZXMgY2hhbmdlZCwgMTYyIGluc2VydGlvbnMo
KyksIDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9r
dm1pLnJzdCBiL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKaW5kZXggZGJhZWRiZWU5
ZGVlLi4xNzg4MzIzMDQ0NTggMTAwNjQ0Ci0tLSBhL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3Zt
aS5yc3QKKysrIGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdApAQCAtNjAxLDYgKzYw
MSwzNSBAQCByZWdpc3RlcnMsIHRoZSBzcGVjaWFsIHJlZ2lzdGVycyBhbmQgdGhlIHJlcXVlc3Rl
ZCBzZXQgb2YgTVNScy4KICogLUtWTV9FQUdBSU4gLSB0aGUgc2VsZWN0ZWQgdkNQVSBjYW4ndCBi
ZSBpbnRyb3NwZWN0ZWQgeWV0CiAqIC1LVk1fRU5PTUVNIC0gdGhlcmUgaXMgbm90IGVub3VnaCBt
ZW1vcnkgdG8gYWxsb2NhdGUgdGhlIHJlcGx5CiAKKzEyLiBLVk1JX1ZDUFVfU0VUX1JFR0lTVEVS
UworLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKKzpBcmNoaXRlY3R1cmVzOiB4ODYKKzpW
ZXJzaW9uczogPj0gMQorOlBhcmFtZXRlcnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2hk
cjsKKwlzdHJ1Y3Qga3ZtX3JlZ3M7CisKKzpSZXR1cm5zOgorCis6OgorCisJc3RydWN0IGt2bWlf
ZXJyb3JfY29kZQorCitTZXRzIHRoZSBnZW5lcmFsIHB1cnBvc2UgcmVnaXN0ZXJzIGZvciB0aGUg
Z2l2ZW4gdkNQVS4gVGhlIGNoYW5nZXMgYmVjb21lCit2aXNpYmxlIHRvIG90aGVyIHRocmVhZHMg
YWNjZXNzaW5nIHRoZSBLVk0gdkNQVSBzdHJ1Y3R1cmUgYWZ0ZXIgdGhlIGV2ZW50CitjdXJyZW50
bHkgYmVpbmcgaGFuZGxlZCBpcyByZXBsaWVkIHRvLgorCis6RXJyb3JzOgorCisqIC1LVk1fRUlO
VkFMIC0gdGhlIHNlbGVjdGVkIHZDUFUgaXMgaW52YWxpZAorKiAtS1ZNX0VJTlZBTCAtIHRoZSBw
YWRkaW5nIGlzIG5vdCB6ZXJvCisqIC1LVk1fRUFHQUlOIC0gdGhlIHNlbGVjdGVkIHZDUFUgY2Fu
J3QgYmUgaW50cm9zcGVjdGVkIHlldAorKiAtS1ZNX0VPUE5PVFNVUFAgLSB0aGUgY29tbWFuZCBo
YXNuJ3QgYmVlbiByZWNlaXZlZCBkdXJpbmcgYW4gaW50cm9zcGVjdGlvbiBldmVudAorCiBFdmVu
dHMKID09PT09PQogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3Qu
aCBiL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCmluZGV4IDA1YWRlM2ExNmIyNC4u
Y2M5NDUxNTFjYjM2IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3Qu
aAorKysgYi9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaApAQCAtNSw2ICs1LDggQEAK
ICNpbmNsdWRlIDxhc20va3ZtaS5oPgogCiBzdHJ1Y3Qga3ZtX3ZjcHVfYXJjaF9pbnRyb3NwZWN0
aW9uIHsKKwlzdHJ1Y3Qga3ZtX3JlZ3MgZGVsYXllZF9yZWdzOworCWJvb2wgaGF2ZV9kZWxheWVk
X3JlZ3M7CiB9OwogCiBzdHJ1Y3Qga3ZtX2FyY2hfaW50cm9zcGVjdGlvbiB7CmRpZmYgLS1naXQg
YS9hcmNoL3g4Ni9rdm0va3ZtaS5jIGIvYXJjaC94ODYva3ZtL2t2bWkuYwppbmRleCBmYTliMjAy
NzdkYWQuLjM5NjM4YWY3NzU3ZSAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL2t2bWkuYworKysg
Yi9hcmNoL3g4Ni9rdm0va3ZtaS5jCkBAIC0xMTgsMyArMTE4LDI1IEBAIGludCBrdm1pX2FyY2hf
Y21kX3ZjcHVfZ2V0X3JlZ2lzdGVycyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAKIAlyZXR1cm4g
ZXJyID8gLUtWTV9FSU5WQUwgOiAwOwogfQorCit2b2lkIGt2bWlfYXJjaF9jbWRfdmNwdV9zZXRf
cmVnaXN0ZXJzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKKwkJCQkgICAgICBjb25zdCBzdHJ1Y3Qg
a3ZtX3JlZ3MgKnJlZ3MpCit7CisJc3RydWN0IGt2bV92Y3B1X2ludHJvc3BlY3Rpb24gKnZjcHVp
ID0gVkNQVUkodmNwdSk7CisJc3RydWN0IGt2bV9yZWdzICpkZXN0ID0gJnZjcHVpLT5hcmNoLmRl
bGF5ZWRfcmVnczsKKworCW1lbWNweShkZXN0LCByZWdzLCBzaXplb2YoKmRlc3QpKTsKKworCXZj
cHVpLT5hcmNoLmhhdmVfZGVsYXllZF9yZWdzID0gdHJ1ZTsKK30KKwordm9pZCBrdm1pX2FyY2hf
cG9zdF9yZXBseShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCit7CisJc3RydWN0IGt2bV92Y3B1X2lu
dHJvc3BlY3Rpb24gKnZjcHVpID0gVkNQVUkodmNwdSk7CisKKwlpZiAoIXZjcHVpLT5hcmNoLmhh
dmVfZGVsYXllZF9yZWdzKQorCQlyZXR1cm47CisKKwlrdm1fYXJjaF92Y3B1X3NldF9yZWdzKHZj
cHUsICZ2Y3B1aS0+YXJjaC5kZWxheWVkX3JlZ3MsIGZhbHNlKTsKKwl2Y3B1aS0+YXJjaC5oYXZl
X2RlbGF5ZWRfcmVncyA9IGZhbHNlOworfQpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL2t2bWku
aCBiL2FyY2gveDg2L2t2bS9rdm1pLmgKaW5kZXggN2FhYjRhYWFiY2RhLi40ZWViMGM5MDAwODMg
MTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS9rdm1pLmgKKysrIGIvYXJjaC94ODYva3ZtL2t2bWku
aApAQCAtNSw1ICs1LDcgQEAKIGludCBrdm1pX2FyY2hfY21kX3ZjcHVfZ2V0X3JlZ2lzdGVycyhz
dHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQkJY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9nZXRfcmVn
aXN0ZXJzICpyZXEsCiAJCQkJc3RydWN0IGt2bWlfdmNwdV9nZXRfcmVnaXN0ZXJzX3JlcGx5ICpy
cGwpOwordm9pZCBrdm1pX2FyY2hfY21kX3ZjcHVfc2V0X3JlZ2lzdGVycyhzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUsCisJCQkJICAgICAgY29uc3Qgc3RydWN0IGt2bV9yZWdzICpyZWdzKTsKIAogI2Vu
ZGlmCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYyBiL2FyY2gveDg2L2t2bS9r
dm1pX21zZy5jCmluZGV4IGZkODM3YzI0MTM0MC4uNDA0NmE1YzRkMzA2IDEwMDY0NAotLS0gYS9h
cmNoL3g4Ni9rdm0va3ZtaV9tc2cuYworKysgYi9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYwpAQCAt
OTAsOSArOTAsMjcgQEAgc3RhdGljIGludCBoYW5kbGVfdmNwdV9nZXRfcmVnaXN0ZXJzKGNvbnN0
IHN0cnVjdCBrdm1pX3ZjcHVfbXNnX2pvYiAqam9iLAogCXJldHVybiBlcnI7CiB9CiAKK3N0YXRp
YyBpbnQgaGFuZGxlX3ZjcHVfc2V0X3JlZ2lzdGVycyhjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X21z
Z19qb2IgKmpvYiwKKwkJCQkgICAgIGNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZywKKwkJ
CQkgICAgIGNvbnN0IHZvaWQgKnJlcSkKK3sKKwljb25zdCBzdHJ1Y3Qga3ZtX3JlZ3MgKnJlZ3Mg
PSByZXE7CisJaW50IGVjID0gMDsKKworCWlmIChtc2ctPnNpemUgPCBzaXplb2YoKnJlZ3MpKQor
CQllYyA9IC1LVk1fRUlOVkFMOworCWVsc2UgaWYgKCFWQ1BVSShqb2ItPnZjcHUpLT53YWl0aW5n
X2Zvcl9yZXBseSkKKwkJZWMgPSAtS1ZNX0VPUE5PVFNVUFA7CisJZWxzZQorCQlrdm1pX2FyY2hf
Y21kX3ZjcHVfc2V0X3JlZ2lzdGVycyhqb2ItPnZjcHUsIHJlZ3MpOworCisJcmV0dXJuIGt2bWlf
bXNnX3ZjcHVfcmVwbHkoam9iLCBtc2csIGVjLCBOVUxMLCAwKTsKK30KKwogc3RhdGljIGt2bWlf
dmNwdV9tc2dfam9iX2ZjdCBjb25zdCBtc2dfdmNwdVtdID0gewogCVtLVk1JX1ZDUFVfR0VUX0lO
Rk9dICAgICAgPSBoYW5kbGVfdmNwdV9nZXRfaW5mbywKIAlbS1ZNSV9WQ1BVX0dFVF9SRUdJU1RF
UlNdID0gaGFuZGxlX3ZjcHVfZ2V0X3JlZ2lzdGVycywKKwlbS1ZNSV9WQ1BVX1NFVF9SRUdJU1RF
UlNdID0gaGFuZGxlX3ZjcHVfc2V0X3JlZ2lzdGVycywKIH07CiAKIGt2bWlfdmNwdV9tc2dfam9i
X2ZjdCBrdm1pX2FyY2hfdmNwdV9tc2dfaGFuZGxlcih1MTYgaWQpCmRpZmYgLS1naXQgYS9pbmNs
dWRlL3VhcGkvbGludXgva3ZtaS5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAppbmRleCA4
NTQ4ZWFkNDUxYzEuLjRiNzU2ZDM4OGFkMyAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBpL2xpbnV4
L2t2bWkuaAorKysgYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCkBAIC0zOCw2ICszOCw3IEBA
IGVudW0gewogCUtWTUlfVkNQVV9HRVRfSU5GTyAgICAgICA9IEtWTUlfVkNQVV9NRVNTQUdFX0lE
KDEpLAogCUtWTUlfVkNQVV9DT05UUk9MX0VWRU5UUyA9IEtWTUlfVkNQVV9NRVNTQUdFX0lEKDIp
LAogCUtWTUlfVkNQVV9HRVRfUkVHSVNURVJTICA9IEtWTUlfVkNQVV9NRVNTQUdFX0lEKDMpLAor
CUtWTUlfVkNQVV9TRVRfUkVHSVNURVJTICA9IEtWTUlfVkNQVV9NRVNTQUdFX0lEKDQpLAogCiAJ
S1ZNSV9ORVhUX1ZDUFVfTUVTU0FHRQogfTsKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2Vs
ZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9r
dm0veDg2XzY0L2t2bWlfdGVzdC5jCmluZGV4IGY5MWE3MGFkMTAxMy4uMzExYTA1MGMyNmMxIDEw
MDY0NAotLS0gYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5j
CisrKyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKQEAg
LTYzOCw2ICs2MzgsMTYgQEAgc3RhdGljIGludCBkb192Y3B1X2NvbW1hbmQoc3RydWN0IGt2bV92
bSAqdm0sIGludCBjbWRfaWQsCiAJcmV0dXJuIHI7CiB9CiAKK3N0YXRpYyBpbnQgX19kb192Y3B1
MF9jb21tYW5kKGludCBjbWRfaWQsIHN0cnVjdCBrdm1pX21zZ19oZHIgKnJlcSwKKwkJCSAgICAg
IHNpemVfdCByZXFfc2l6ZSwgdm9pZCAqcnBsLCBzaXplX3QgcnBsX3NpemUpCit7CisJc3RydWN0
IGt2bWlfdmNwdV9oZHIgKnZjcHVfaGRyID0gKHN0cnVjdCBrdm1pX3ZjcHVfaGRyICopKHJlcSAr
IDEpOworCisJdmNwdV9oZHItPnZjcHUgPSAwOworCisJcmV0dXJuIGRvX2NvbW1hbmQoY21kX2lk
LCByZXEsIHJlcV9zaXplLCBycGwsIHJwbF9zaXplKTsKK30KKwogc3RhdGljIGludCBkb192Y3B1
MF9jb21tYW5kKHN0cnVjdCBrdm1fdm0gKnZtLCBpbnQgY21kX2lkLAogCQkJICAgIHN0cnVjdCBr
dm1pX21zZ19oZHIgKnJlcSwgc2l6ZV90IHJlcV9zaXplLAogCQkJICAgIHZvaWQgKnJwbCwgc2l6
ZV90IHJwbF9zaXplKQpAQCAtODY2LDYgKzg3Niw3OCBAQCBzdGF0aWMgdm9pZCB0ZXN0X2NtZF92
Y3B1X2dldF9yZWdpc3RlcnMoc3RydWN0IGt2bV92bSAqdm0pCiAJdGVzdF9pbnZhbGlkX3ZjcHVf
Z2V0X3JlZ2lzdGVycyh2bSk7CiB9CiAKK3N0YXRpYyBpbnQgX19jbWRfdmNwdV9zZXRfcmVnaXN0
ZXJzKHN0cnVjdCBrdm1fdm0gKnZtLAorCQkJCSAgICBzdHJ1Y3Qga3ZtX3JlZ3MgKnJlZ3MpCit7
CisJc3RydWN0IHsKKwkJc3RydWN0IGt2bWlfbXNnX2hkciBoZHI7CisJCXN0cnVjdCBrdm1pX3Zj
cHVfaGRyIHZjcHVfaGRyOworCQlzdHJ1Y3Qga3ZtX3JlZ3MgcmVnczsKKwl9IHJlcSA9IHt9Owor
CisJbWVtY3B5KCZyZXEucmVncywgcmVncywgc2l6ZW9mKHJlcS5yZWdzKSk7CisKKwlyZXR1cm4g
X19kb192Y3B1MF9jb21tYW5kKEtWTUlfVkNQVV9TRVRfUkVHSVNURVJTLAorCQkJCSAgJnJlcS5o
ZHIsIHNpemVvZihyZXEpLCBOVUxMLCAwKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9pbnZhbGlk
X2NtZF92Y3B1X3NldF9yZWdpc3RlcnMoc3RydWN0IGt2bV92bSAqdm0pCit7CisJc3RydWN0IHZj
cHVfd29ya2VyX2RhdGEgZGF0YSA9IHsudm0gPSB2bSwgLnZjcHVfaWQgPSBWQ1BVX0lEfTsKKwlw
dGhyZWFkX3QgdmNwdV90aHJlYWQ7CisJc3RydWN0IGt2bV9yZWdzIHJlZ3M7CisJaW50IHI7CisK
Kwl2Y3B1X3RocmVhZCA9IHN0YXJ0X3ZjcHVfd29ya2VyKCZkYXRhKTsKKworCXIgPSBfX2NtZF92
Y3B1X3NldF9yZWdpc3RlcnModm0sICZyZWdzKTsKKworCXdhaXRfdmNwdV93b3JrZXIodmNwdV90
aHJlYWQpOworCisJVEVTVF9BU1NFUlQociA9PSAtS1ZNX0VPUE5PVFNVUFAsCisJCSJLVk1JX1ZD
UFVfU0VUX1JFR0lTVEVSUyBkaWRuJ3QgZmFpbGVkIHdpdGggS1ZNX0VPUE5PVFNVUFAsIGVycm9y
ICVkKCVzKVxuIiwKKwkJLXIsIGt2bV9zdHJlcnJvcigtcikpOworfQorCitzdGF0aWMgdm9pZCBf
X3NldF9yZWdpc3RlcnMoc3RydWN0IGt2bV92bSAqdm0sCisJCQkgICAgc3RydWN0IGt2bV9yZWdz
ICpyZWdzKQoreworCWludCByOworCisJciA9IF9fY21kX3ZjcHVfc2V0X3JlZ2lzdGVycyh2bSwg
cmVncyk7CisJVEVTVF9BU1NFUlQociA9PSAwLAorCQkiS1ZNSV9WQ1BVX1NFVF9SRUdJU1RFUlMg
ZmFpbGVkLCBlcnJvciAlZCglcylcbiIsCisJCS1yLCBrdm1fc3RyZXJyb3IoLXIpKTsKK30KKwor
c3RhdGljIHZvaWQgdGVzdF9jbWRfdmNwdV9zZXRfcmVnaXN0ZXJzKHN0cnVjdCBrdm1fdm0gKnZt
KQoreworCXN0cnVjdCB2Y3B1X3dvcmtlcl9kYXRhIGRhdGEgPSB7LnZtID0gdm0sIC52Y3B1X2lk
ID0gVkNQVV9JRH07CisJX191MTYgZXZlbnRfaWQgPSBLVk1JX1ZDUFVfRVZFTlRfUEFVU0U7CisJ
c3RydWN0IGt2bWlfbXNnX2hkciBoZHI7CisJcHRocmVhZF90IHZjcHVfdGhyZWFkOworCXN0cnVj
dCB2Y3B1X2V2ZW50IGV2OworCXN0cnVjdCB2Y3B1X3JlcGx5IHJwbCA9IHt9OworCXN0cnVjdCBr
dm1fcmVncyByZWdzID0ge307CisKKwljbWRfdmNwdV9nZXRfcmVnaXN0ZXJzKHZtLCAmcmVncyk7
CisKKwl0ZXN0X2ludmFsaWRfY21kX3ZjcHVfc2V0X3JlZ2lzdGVycyh2bSk7CisKKwlwYXVzZV92
Y3B1KCk7CisKKwl2Y3B1X3RocmVhZCA9IHN0YXJ0X3ZjcHVfd29ya2VyKCZkYXRhKTsKKworCXJl
Y2VpdmVfdmNwdV9ldmVudCgmaGRyLCAmZXYsIHNpemVvZihldiksIGV2ZW50X2lkKTsKKworCV9f
c2V0X3JlZ2lzdGVycyh2bSwgJmV2LmNvbW1vbi5hcmNoLnJlZ3MpOworCisJcmVwbHlfdG9fZXZl
bnQoJmhkciwgJmV2LCBLVk1JX0VWRU5UX0FDVElPTl9DT05USU5VRSwKKwkJCSZycGwsIHNpemVv
ZihycGwpKTsKKworCXdhaXRfdmNwdV93b3JrZXIodmNwdV90aHJlYWQpOworfQorCiBzdGF0aWMg
dm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAqdm0pCiB7CiAJc3JhbmRvbSh0
aW1lKDApKTsKQEAgLTg4NCw2ICs5NjYsNyBAQCBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rp
b24oc3RydWN0IGt2bV92bSAqdm0pCiAJdGVzdF9wYXVzZSh2bSk7CiAJdGVzdF9jbWRfdmNwdV9j
b250cm9sX2V2ZW50cyh2bSk7CiAJdGVzdF9jbWRfdmNwdV9nZXRfcmVnaXN0ZXJzKHZtKTsKKwl0
ZXN0X2NtZF92Y3B1X3NldF9yZWdpc3RlcnModm0pOwogCiAJdW5ob29rX2ludHJvc3BlY3Rpb24o
dm0pOwogfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oIGIv
dmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCmluZGV4IDgwNTkwMjljYWRmNC4uMDE4
NzY0Y2ExYjcxIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgK
KysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCkBAIC03MCw1ICs3MCw2IEBA
IHZvaWQga3ZtaV9hcmNoX2luaXRfdmNwdV9ldmVudHNfbWFzayh1bnNpZ25lZCBsb25nICpzdXBw
b3J0ZWQpOwoga3ZtaV92Y3B1X21zZ19qb2JfZmN0IGt2bWlfYXJjaF92Y3B1X21zZ19oYW5kbGVy
KHUxNiBpZCk7CiB2b2lkIGt2bWlfYXJjaF9zZXR1cF92Y3B1X2V2ZW50KHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwKIAkJCQlzdHJ1Y3Qga3ZtaV92Y3B1X2V2ZW50ICpldik7Cit2b2lkIGt2bWlfYXJj
aF9wb3N0X3JlcGx5KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0
IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jIGIvdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pX21zZy5jCmluZGV4IGY3NTQ5YmFmNWM0MS4uYjdkZTM5ZDRhZmE2IDEwMDY0NAot
LS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMKKysrIGIvdmlydC9rdm0vaW50
cm9zcGVjdGlvbi9rdm1pX21zZy5jCkBAIC03MTcsMTAgKzcxNywxMiBAQCBpbnQga3ZtaV9zZW5k
X3ZjcHVfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgZXZfaWQsCiAJCWVyciA9IHZj
cHVpLT5yZXBseS5lcnJvcjsKIAogb3V0OgotCWlmIChlcnIpCisJaWYgKGVycikgewogCQlrdm1p
X3NvY2tfc2h1dGRvd24oa3ZtaSk7Ci0JZWxzZQorCX0gZWxzZSB7CisJCWt2bWlfYXJjaF9wb3N0
X3JlcGx5KHZjcHUpOwogCQkqYWN0aW9uID0gdmNwdWktPnJlcGx5LmFjdGlvbjsKKwl9CiAKIAly
ZXR1cm4gZXJyOwogfQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGlu
dXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxt
YW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
