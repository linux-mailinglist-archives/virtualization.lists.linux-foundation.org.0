Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from mail.linuxfoundation.org (mail.linuxfoundation.org [140.211.169.12])
	by mail.lfdr.de (Postfix) with ESMTPS id 6C7085F1EF
	for <lists.virtualization@lfdr.de>; Thu,  4 Jul 2019 06:00:42 +0200 (CEST)
Received: from mail.linux-foundation.org (localhost [127.0.0.1])
	by mail.linuxfoundation.org (Postfix) with ESMTP id BF6ADC9A;
	Thu,  4 Jul 2019 04:00:37 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@mail.linuxfoundation.org
Received: from smtp1.linuxfoundation.org (smtp1.linux-foundation.org
	[172.17.192.35])
	by mail.linuxfoundation.org (Postfix) with ESMTPS id A2D35C84
	for <virtualization@lists.linux-foundation.org>;
	Thu,  4 Jul 2019 04:00:36 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
	by smtp1.linuxfoundation.org (Postfix) with ESMTPS id 1549287B
	for <virtualization@lists.linux-foundation.org>;
	Thu,  4 Jul 2019 04:00:36 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
	[10.5.11.22])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mx1.redhat.com (Postfix) with ESMTPS id 4CD4E3082B4D;
	Thu,  4 Jul 2019 04:00:23 +0000 (UTC)
Received: from [10.72.12.202] (ovpn-12-202.pek2.redhat.com [10.72.12.202])
	by smtp.corp.redhat.com (Postfix) with ESMTP id 68C371001B3F;
	Thu,  4 Jul 2019 04:00:13 +0000 (UTC)
Subject: Re: [PATCH v2 2/3] vsock/virtio: stop workers during the .remove()
To: Stefano Garzarella <sgarzare@redhat.com>, netdev@vger.kernel.org
References: <20190628123659.139576-1-sgarzare@redhat.com>
	<20190628123659.139576-3-sgarzare@redhat.com>
From: Jason Wang <jasowang@redhat.com>
Message-ID: <04b93975-1cce-1e7e-61ad-246601d4216c@redhat.com>
Date: Thu, 4 Jul 2019 12:00:11 +0800
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
	Thunderbird/60.7.2
MIME-Version: 1.0
In-Reply-To: <20190628123659.139576-3-sgarzare@redhat.com>
Content-Language: en-US
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
	(mx1.redhat.com [10.5.110.45]);
	Thu, 04 Jul 2019 04:00:28 +0000 (UTC)
X-Spam-Status: No, score=-6.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_HI
	autolearn=ham version=3.3.1
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	smtp1.linux-foundation.org
Cc: kvm@vger.kernel.org, "Michael S. Tsirkin" <mst@redhat.com>,
	linux-kernel@vger.kernel.org, virtualization@lists.linux-foundation.org,
	Stefan Hajnoczi <stefanha@redhat.com>,
	"David S. Miller" <davem@davemloft.net>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.12
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Sender: virtualization-bounces@lists.linux-foundation.org
Errors-To: virtualization-bounces@lists.linux-foundation.org

Ck9uIDIwMTkvNi8yOCDkuIvljYg4OjM2LCBTdGVmYW5vIEdhcnphcmVsbGEgd3JvdGU6Cj4gQmVm
b3JlIHRvIGNhbGwgdmRldi0+Y29uZmlnLT5yZXNldCh2ZGV2KSB3ZSBuZWVkIHRvIGJlIHN1cmUg
dGhhdAo+IG5vIG9uZSBpcyBhY2Nlc3NpbmcgdGhlIGRldmljZSwgZm9yIHRoaXMgcmVhc29uLCB3
ZSBhZGQgbmV3IHZhcmlhYmxlcwo+IGluIHRoZSBzdHJ1Y3QgdmlydGlvX3Zzb2NrIHRvIHN0b3Ag
dGhlIHdvcmtlcnMgZHVyaW5nIHRoZSAucmVtb3ZlKCkuCj4KPiBUaGlzIHBhdGNoIGFsc28gYWRk
IGZldyBjb21tZW50cyBiZWZvcmUgdmRldi0+Y29uZmlnLT5yZXNldCh2ZGV2KQo+IGFuZCB2ZGV2
LT5jb25maWctPmRlbF92cXModmRldikuCj4KPiBTdWdnZXN0ZWQtYnk6IFN0ZWZhbiBIYWpub2N6
aSA8c3RlZmFuaGFAcmVkaGF0LmNvbT4KPiBTdWdnZXN0ZWQtYnk6IE1pY2hhZWwgUy4gVHNpcmtp
biA8bXN0QHJlZGhhdC5jb20+Cj4gU2lnbmVkLW9mZi1ieTogU3RlZmFubyBHYXJ6YXJlbGxhIDxz
Z2FyemFyZUByZWRoYXQuY29tPgo+IC0tLQo+ICAgbmV0L3Ztd192c29jay92aXJ0aW9fdHJhbnNw
b3J0LmMgfCA1MSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrLQo+ICAgMSBmaWxlIGNo
YW5nZWQsIDUwIGluc2VydGlvbnMoKyksIDEgZGVsZXRpb24oLSkKCgpUaGlzIHNob3VsZCB3b3Jr
LiBCdXQgd2UgbWF5IGNvbnNpZGVyIHRvIGNvbnZlcnQgdGhlX3ZpcnRpb192b3NjayB0byAKc29j
a2V0IG9iamVjdCBhbmQgdXNlIHNvY2tldCByZWZjbnQgYW5kIGRlc3RydWN0b3IgaW4gdGhlIGZ1
dHVyZSBpbnN0ZWFkIApvZiBpbnZlbnRpbmcgc29tZXRoaW5nIG5ldyBieSBvdXJzZWx2ZXMuCgpU
aGFua3MKCgo+Cj4gZGlmZiAtLWdpdCBhL25ldC92bXdfdnNvY2svdmlydGlvX3RyYW5zcG9ydC5j
IGIvbmV0L3Ztd192c29jay92aXJ0aW9fdHJhbnNwb3J0LmMKPiBpbmRleCA3YWQ1MTBlYzEyZTAu
LjFiNDRlYzZmM2Y2YyAxMDA2NDQKPiAtLS0gYS9uZXQvdm13X3Zzb2NrL3ZpcnRpb190cmFuc3Bv
cnQuYwo+ICsrKyBiL25ldC92bXdfdnNvY2svdmlydGlvX3RyYW5zcG9ydC5jCj4gQEAgLTM4LDYg
KzM4LDcgQEAgc3RydWN0IHZpcnRpb192c29jayB7Cj4gICAJICogbXVzdCBiZSBhY2Nlc3NlZCB3
aXRoIHR4X2xvY2sgaGVsZC4KPiAgIAkgKi8KPiAgIAlzdHJ1Y3QgbXV0ZXggdHhfbG9jazsKPiAr
CWJvb2wgdHhfcnVuOwo+ICAgCj4gICAJc3RydWN0IHdvcmtfc3RydWN0IHNlbmRfcGt0X3dvcms7
Cj4gICAJc3BpbmxvY2tfdCBzZW5kX3BrdF9saXN0X2xvY2s7Cj4gQEAgLTUzLDYgKzU0LDcgQEAg
c3RydWN0IHZpcnRpb192c29jayB7Cj4gICAJICogbXVzdCBiZSBhY2Nlc3NlZCB3aXRoIHJ4X2xv
Y2sgaGVsZC4KPiAgIAkgKi8KPiAgIAlzdHJ1Y3QgbXV0ZXggcnhfbG9jazsKPiArCWJvb2wgcnhf
cnVuOwo+ICAgCWludCByeF9idWZfbnI7Cj4gICAJaW50IHJ4X2J1Zl9tYXhfbnI7Cj4gICAKPiBA
QCAtNjAsNiArNjIsNyBAQCBzdHJ1Y3QgdmlydGlvX3Zzb2NrIHsKPiAgIAkgKiB2cXNbVlNPQ0tf
VlFfRVZFTlRdIG11c3QgYmUgYWNjZXNzZWQgd2l0aCBldmVudF9sb2NrIGhlbGQuCj4gICAJICov
Cj4gICAJc3RydWN0IG11dGV4IGV2ZW50X2xvY2s7Cj4gKwlib29sIGV2ZW50X3J1bjsKPiAgIAlz
dHJ1Y3QgdmlydGlvX3Zzb2NrX2V2ZW50IGV2ZW50X2xpc3RbOF07Cj4gICAKPiAgIAl1MzIgZ3Vl
c3RfY2lkOwo+IEBAIC05NCw2ICs5NywxMCBAQCBzdGF0aWMgdm9pZCB2aXJ0aW9fdHJhbnNwb3J0
X2xvb3BiYWNrX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICAgCXNwaW5fdW5sb2Nr
X2JoKCZ2c29jay0+bG9vcGJhY2tfbGlzdF9sb2NrKTsKPiAgIAo+ICAgCW11dGV4X2xvY2soJnZz
b2NrLT5yeF9sb2NrKTsKPiArCj4gKwlpZiAoIXZzb2NrLT5yeF9ydW4pCj4gKwkJZ290byBvdXQ7
Cj4gKwo+ICAgCXdoaWxlICghbGlzdF9lbXB0eSgmcGt0cykpIHsKPiAgIAkJc3RydWN0IHZpcnRp
b192c29ja19wa3QgKnBrdDsKPiAgIAo+IEBAIC0xMDIsNiArMTA5LDcgQEAgc3RhdGljIHZvaWQg
dmlydGlvX3RyYW5zcG9ydF9sb29wYmFja193b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykK
PiAgIAo+ICAgCQl2aXJ0aW9fdHJhbnNwb3J0X3JlY3ZfcGt0KHBrdCk7Cj4gICAJfQo+ICtvdXQ6
Cj4gICAJbXV0ZXhfdW5sb2NrKCZ2c29jay0+cnhfbG9jayk7Cj4gICB9Cj4gICAKPiBAQCAtMTMw
LDYgKzEzOCw5IEBAIHZpcnRpb190cmFuc3BvcnRfc2VuZF9wa3Rfd29yayhzdHJ1Y3Qgd29ya19z
dHJ1Y3QgKndvcmspCj4gICAKPiAgIAltdXRleF9sb2NrKCZ2c29jay0+dHhfbG9jayk7Cj4gICAK
PiArCWlmICghdnNvY2stPnR4X3J1bikKPiArCQlnb3RvIG91dDsKPiArCj4gICAJdnEgPSB2c29j
ay0+dnFzW1ZTT0NLX1ZRX1RYXTsKPiAgIAo+ICAgCWZvciAoOzspIHsKPiBAQCAtMTg4LDYgKzE5
OSw3IEBAIHZpcnRpb190cmFuc3BvcnRfc2VuZF9wa3Rfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3Qg
KndvcmspCj4gICAJaWYgKGFkZGVkKQo+ICAgCQl2aXJ0cXVldWVfa2ljayh2cSk7Cj4gICAKPiAr
b3V0Ogo+ICAgCW11dGV4X3VubG9jaygmdnNvY2stPnR4X2xvY2spOwo+ICAgCj4gICAJaWYgKHJl
c3RhcnRfcngpCj4gQEAgLTMyMyw2ICszMzUsMTAgQEAgc3RhdGljIHZvaWQgdmlydGlvX3RyYW5z
cG9ydF90eF93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKPiAgIAo+ICAgCXZxID0gdnNv
Y2stPnZxc1tWU09DS19WUV9UWF07Cj4gICAJbXV0ZXhfbG9jaygmdnNvY2stPnR4X2xvY2spOwo+
ICsKPiArCWlmICghdnNvY2stPnR4X3J1bikKPiArCQlnb3RvIG91dDsKPiArCj4gICAJZG8gewo+
ICAgCQlzdHJ1Y3QgdmlydGlvX3Zzb2NrX3BrdCAqcGt0Owo+ICAgCQl1bnNpZ25lZCBpbnQgbGVu
Owo+IEBAIC0zMzMsNiArMzQ5LDggQEAgc3RhdGljIHZvaWQgdmlydGlvX3RyYW5zcG9ydF90eF93
b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKPiAgIAkJCWFkZGVkID0gdHJ1ZTsKPiAgIAkJ
fQo+ICAgCX0gd2hpbGUgKCF2aXJ0cXVldWVfZW5hYmxlX2NiKHZxKSk7Cj4gKwo+ICtvdXQ6Cj4g
ICAJbXV0ZXhfdW5sb2NrKCZ2c29jay0+dHhfbG9jayk7Cj4gICAKPiAgIAlpZiAoYWRkZWQpCj4g
QEAgLTM2MSw2ICszNzksOSBAQCBzdGF0aWMgdm9pZCB2aXJ0aW9fdHJhbnNwb3J0X3J4X3dvcmso
c3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICAgCj4gICAJbXV0ZXhfbG9jaygmdnNvY2stPnJ4
X2xvY2spOwo+ICAgCj4gKwlpZiAoIXZzb2NrLT5yeF9ydW4pCj4gKwkJZ290byBvdXQ7Cj4gKwo+
ICAgCWRvIHsKPiAgIAkJdmlydHF1ZXVlX2Rpc2FibGVfY2IodnEpOwo+ICAgCQlmb3IgKDs7KSB7
Cj4gQEAgLTQ3MCw2ICs0OTEsOSBAQCBzdGF0aWMgdm9pZCB2aXJ0aW9fdHJhbnNwb3J0X2V2ZW50
X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICAgCj4gICAJbXV0ZXhfbG9jaygmdnNv
Y2stPmV2ZW50X2xvY2spOwo+ICAgCj4gKwlpZiAoIXZzb2NrLT5ldmVudF9ydW4pCj4gKwkJZ290
byBvdXQ7Cj4gKwo+ICAgCWRvIHsKPiAgIAkJc3RydWN0IHZpcnRpb192c29ja19ldmVudCAqZXZl
bnQ7Cj4gICAJCXVuc2lnbmVkIGludCBsZW47Cj4gQEAgLTQ4NCw3ICs1MDgsNyBAQCBzdGF0aWMg
dm9pZCB2aXJ0aW9fdHJhbnNwb3J0X2V2ZW50X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQo+ICAgCX0gd2hpbGUgKCF2aXJ0cXVldWVfZW5hYmxlX2NiKHZxKSk7Cj4gICAKPiAgIAl2aXJ0
cXVldWVfa2ljayh2c29jay0+dnFzW1ZTT0NLX1ZRX0VWRU5UXSk7Cj4gLQo+ICtvdXQ6Cj4gICAJ
bXV0ZXhfdW5sb2NrKCZ2c29jay0+ZXZlbnRfbG9jayk7Cj4gICB9Cj4gICAKPiBAQCAtNjE5LDEy
ICs2NDMsMTggQEAgc3RhdGljIGludCB2aXJ0aW9fdnNvY2tfcHJvYmUoc3RydWN0IHZpcnRpb19k
ZXZpY2UgKnZkZXYpCj4gICAJSU5JVF9XT1JLKCZ2c29jay0+c2VuZF9wa3Rfd29yaywgdmlydGlv
X3RyYW5zcG9ydF9zZW5kX3BrdF93b3JrKTsKPiAgIAlJTklUX1dPUksoJnZzb2NrLT5sb29wYmFj
a193b3JrLCB2aXJ0aW9fdHJhbnNwb3J0X2xvb3BiYWNrX3dvcmspOwo+ICAgCj4gKwltdXRleF9s
b2NrKCZ2c29jay0+dHhfbG9jayk7Cj4gKwl2c29jay0+dHhfcnVuID0gdHJ1ZTsKPiArCW11dGV4
X3VubG9jaygmdnNvY2stPnR4X2xvY2spOwo+ICsKPiAgIAltdXRleF9sb2NrKCZ2c29jay0+cnhf
bG9jayk7Cj4gICAJdmlydGlvX3Zzb2NrX3J4X2ZpbGwodnNvY2spOwo+ICsJdnNvY2stPnJ4X3J1
biA9IHRydWU7Cj4gICAJbXV0ZXhfdW5sb2NrKCZ2c29jay0+cnhfbG9jayk7Cj4gICAKPiAgIAlt
dXRleF9sb2NrKCZ2c29jay0+ZXZlbnRfbG9jayk7Cj4gICAJdmlydGlvX3Zzb2NrX2V2ZW50X2Zp
bGwodnNvY2spOwo+ICsJdnNvY2stPmV2ZW50X3J1biA9IHRydWU7Cj4gICAJbXV0ZXhfdW5sb2Nr
KCZ2c29jay0+ZXZlbnRfbG9jayk7Cj4gICAKPiAgIAl2ZGV2LT5wcml2ID0gdnNvY2s7Cj4gQEAg
LTY1OSw2ICs2ODksMjQgQEAgc3RhdGljIHZvaWQgdmlydGlvX3Zzb2NrX3JlbW92ZShzdHJ1Y3Qg
dmlydGlvX2RldmljZSAqdmRldikKPiAgIAkvKiBSZXNldCBhbGwgY29ubmVjdGVkIHNvY2tldHMg
d2hlbiB0aGUgZGV2aWNlIGRpc2FwcGVhciAqLwo+ICAgCXZzb2NrX2Zvcl9lYWNoX2Nvbm5lY3Rl
ZF9zb2NrZXQodmlydGlvX3Zzb2NrX3Jlc2V0X3NvY2spOwo+ICAgCj4gKwkvKiBTdG9wIGFsbCB3
b3JrIGhhbmRsZXJzIHRvIG1ha2Ugc3VyZSBubyBvbmUgaXMgYWNjZXNzaW5nIHRoZSBkZXZpY2Us
Cj4gKwkgKiBzbyB3ZSBjYW4gc2FmZWx5IGNhbGwgdmRldi0+Y29uZmlnLT5yZXNldCgpLgo+ICsJ
ICovCj4gKwltdXRleF9sb2NrKCZ2c29jay0+cnhfbG9jayk7Cj4gKwl2c29jay0+cnhfcnVuID0g
ZmFsc2U7Cj4gKwltdXRleF91bmxvY2soJnZzb2NrLT5yeF9sb2NrKTsKPiArCj4gKwltdXRleF9s
b2NrKCZ2c29jay0+dHhfbG9jayk7Cj4gKwl2c29jay0+dHhfcnVuID0gZmFsc2U7Cj4gKwltdXRl
eF91bmxvY2soJnZzb2NrLT50eF9sb2NrKTsKPiArCj4gKwltdXRleF9sb2NrKCZ2c29jay0+ZXZl
bnRfbG9jayk7Cj4gKwl2c29jay0+ZXZlbnRfcnVuID0gZmFsc2U7Cj4gKwltdXRleF91bmxvY2so
JnZzb2NrLT5ldmVudF9sb2NrKTsKPiArCj4gKwkvKiBGbHVzaCBhbGwgZGV2aWNlIHdyaXRlcyBh
bmQgaW50ZXJydXB0cywgZGV2aWNlIHdpbGwgbm90IHVzZSBhbnkKPiArCSAqIG1vcmUgYnVmZmVy
cy4KPiArCSAqLwo+ICAgCXZkZXYtPmNvbmZpZy0+cmVzZXQodmRldik7Cj4gICAKPiAgIAltdXRl
eF9sb2NrKCZ2c29jay0+cnhfbG9jayk7Cj4gQEAgLTY4OSw2ICs3MzcsNyBAQCBzdGF0aWMgdm9p
ZCB2aXJ0aW9fdnNvY2tfcmVtb3ZlKHN0cnVjdCB2aXJ0aW9fZGV2aWNlICp2ZGV2KQo+ICAgCX0K
PiAgIAlzcGluX3VubG9ja19iaCgmdnNvY2stPmxvb3BiYWNrX2xpc3RfbG9jayk7Cj4gICAKPiAr
CS8qIERlbGV0ZSB2aXJ0cXVldWVzIGFuZCBmbHVzaCBvdXRzdGFuZGluZyBjYWxsYmFja3MgaWYg
YW55ICovCj4gICAJdmRldi0+Y29uZmlnLT5kZWxfdnFzKHZkZXYpOwo+ICAgCj4gICAJbXV0ZXhf
dW5sb2NrKCZ0aGVfdmlydGlvX3Zzb2NrX211dGV4KTsKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1
YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhm
b3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
