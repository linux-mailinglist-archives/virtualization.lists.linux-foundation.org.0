Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 2D00B228B3D
	for <lists.virtualization@lfdr.de>; Tue, 21 Jul 2020 23:26:30 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id E135586BE5;
	Tue, 21 Jul 2020 21:26:28 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id QtYvC18y7nsa; Tue, 21 Jul 2020 21:26:25 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id D268086C40;
	Tue, 21 Jul 2020 21:26:25 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 9B7A2C016F;
	Tue, 21 Jul 2020 21:26:25 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 23240C016F
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:23 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id 0CBCE226DB
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:23 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id ilD+CDsWGutm
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:07 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by silver.osuosl.org (Postfix) with ESMTPS id 0E7A2227AA
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:56 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 ABEDD305D501; Wed, 22 Jul 2020 00:09:30 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 8396F304FA13;
 Wed, 22 Jul 2020 00:09:30 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v9 73/84] KVM: introspection: add KVMI_EVENT_DESCRIPTOR
Date: Wed, 22 Jul 2020 00:09:11 +0300
Message-Id: <20200721210922.7646-74-alazar@bitdefender.com>
In-Reply-To: <20200721210922.7646-1-alazar@bitdefender.com>
References: <20200721210922.7646-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <ncitu@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTmljdciZb3IgQ8OuyJt1IDxuY2l0dUBiaXRkZWZlbmRlci5jb20+CgpUaGlzIGV2ZW50
IGlzIHNlbnQgd2hlbiBJRFRSLCBHRFRSLCBMRFRSIG9yIFRSIGFyZSBhY2Nlc3NlZC4KClRoZXNl
IGNvdWxkIGJlIHVzZWQgdG8gaW1wbGVtZW50IGEgdGlueSBhZ2VudCB3aGljaCBydW5zIGluIHRo
ZSBjb250ZXh0Cm9mIGFuIGludHJvc3BlY3RlZCBndWVzdCBhbmQgdXNlcyB2aXJ0dWFsaXplZCBl
eGNlcHRpb25zICgjVkUpIGFuZAphbHRlcm5hdGUgRVBUIHZpZXdzIChWTUZVTkMgIzApIHRvIGZp
bHRlciBjb252ZXJ0ZWQgVk1FWElUUy4gVGhlIGV2ZW50cwpvZiBpbnRlcmVzdGVkIHdpbGwgYmUg
c3VwcHJlc3NlZCAoYWZ0ZXIgc29tZSBhcHByb3ByaWF0ZSBndWVzdC1zaWRlCmhhbmRsaW5nKSB3
aGlsZSB0aGUgcmVzdCB3aWxsIGJlIHNlbnQgdG8gdGhlIGludHJvc3BlY3RvciB2aWEgYSBWTUNB
TEwuCgpTaWduZWQtb2ZmLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5jaXR1QGJpdGRlZmVuZGVyLmNv
bT4KQ28tZGV2ZWxvcGVkLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5j
b20+ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJpdGRlZmVuZGVyLmNv
bT4KLS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgICAgICAgICAgICAgfCA0
MSArKysrKysrKysrCiBhcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaCAgICAgICAgICAg
ICAgfCAgMyArCiBhcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaCAgICAgICAgICAgICAg
fCAxMSArKysKIGFyY2gveDg2L2t2bS9rdm1pLmMgICAgICAgICAgICAgICAgICAgICAgICAgICB8
IDc1ICsrKysrKysrKysrKysrKysrKysKIGFyY2gveDg2L2t2bS9zdm0vc3ZtLmMgICAgICAgICAg
ICAgICAgICAgICAgICB8IDMzICsrKysrKysrCiBhcmNoL3g4Ni9rdm0vdm14L3ZteC5jICAgICAg
ICAgICAgICAgICAgICAgICAgfCAyMyArKysrKysKIGluY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgg
ICAgICAgICAgICAgICAgICAgICB8ICAxICsKIC4uLi90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2
XzY0L2t2bWlfdGVzdC5jICB8IDc1ICsrKysrKysrKysrKysrKysrKysKIHZpcnQva3ZtL2ludHJv
c3BlY3Rpb24va3ZtaS5jICAgICAgICAgICAgICAgICB8ICAxICsKIDkgZmlsZXMgY2hhbmdlZCwg
MjYzIGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2
bWkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAppbmRleCA2ZGUyNjBjMDlm
M2IuLjAyOTRjMTQxZWIwYSAxMDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1p
LnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CkBAIC01NTEsNiArNTUx
LDcgQEAgdGhlIGZvbGxvd2luZyBldmVudHM6OgogCiAJS1ZNSV9FVkVOVF9CUkVBS1BPSU5UCiAJ
S1ZNSV9FVkVOVF9DUgorCUtWTUlfRVZFTlRfREVTQ1JJUFRPUgogCUtWTUlfRVZFTlRfSFlQRVJD
QUxMCiAJS1ZNSV9FVkVOVF9YU0VUQlYKIApAQCAtNTc0LDYgKzU3NSw4IEBAIHRoZSAqS1ZNSV9W
TV9DT05UUk9MX0VWRU5UUyogY29tbWFuZC4KICogLUtWTV9FSU5WQUwgLSB0aGUgZXZlbnQgSUQg
aXMgdW5rbm93biAodXNlICpLVk1JX1ZNX0NIRUNLX0VWRU5UKiBmaXJzdCkKICogLUtWTV9FUEVS
TSAtIHRoZSBhY2Nlc3MgaXMgZGlzYWxsb3dlZCAodXNlICpLVk1JX1ZNX0NIRUNLX0VWRU5UKiBm
aXJzdCkKICogLUtWTV9FQUdBSU4gLSB0aGUgc2VsZWN0ZWQgdkNQVSBjYW4ndCBiZSBpbnRyb3Nw
ZWN0ZWQgeWV0CisqIC1LVk1fRU9QTk9UU1VQUCAtIHRoZSBldmVudCBjYW4ndCBiZSBpbnRlcmNl
cHRlZCBpbiB0aGUgY3VycmVudCBzZXR1cAorICAgICAgICAgICAgICAgICAgICAoZS5nLiBLVk1J
X0VWRU5UX0RFU0NSSVBUT1Igd2l0aCBBTUQpCiAqIC1LVk1fRUJVU1kgLSB0aGUgZXZlbnQgY2Fu
J3QgYmUgaW50ZXJjZXB0ZWQgcmlnaHQgbm93CiAgICAgICAgICAgICAgICAoZS5nLiBLVk1JX0VW
RU5UX0JSRUFLUE9JTlQgaWYgdGhlICNCUCBldmVudCBpcyBhbHJlYWR5IGludGVyY2VwdGVkCiAg
ICAgICAgICAgICAgICAgYnkgdXNlcnNwYWNlKQpAQCAtMTIxMSwzICsxMjE0LDQxIEBAIHRvIGJl
IGNoYW5nZWQgYW5kIHRoZSBpbnRyb3NwZWN0aW9uIGhhcyBiZWVuIGVuYWJsZWQgZm9yIHRoaXMg
ZXZlbnQKIAogYGBrdm1pX2V2ZW50YGAsIHRoZSBleHRlbmRlZCBjb250cm9sIHJlZ2lzdGVyIG51
bWJlciwgdGhlIG9sZCB2YWx1ZSBhbmQKIHRoZSBuZXcgdmFsdWUgYXJlIHNlbnQgdG8gdGhlIGlu
dHJvc3BlY3Rpb24gdG9vbC4KKworOC4gS1ZNSV9FVkVOVF9ERVNDUklQVE9SCistLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0KKworOkFyY2hpdGVjdHVyZTogeDg2Cis6VmVyc2lvbnM6ID49IDEKKzpB
Y3Rpb25zOiBDT05USU5VRSwgUkVUUlksIENSQVNICis6UGFyYW1ldGVyczoKKworOjoKKworCXN0
cnVjdCBrdm1pX2V2ZW50OworCXN0cnVjdCBrdm1pX2V2ZW50X2Rlc2NyaXB0b3IgeworCQlfX3U4
IGRlc2NyaXB0b3I7CisJCV9fdTggd3JpdGU7CisJCV9fdTggcGFkZGluZ1s2XTsKKwl9OworCis6
UmV0dXJuczoKKworOjoKKworCXN0cnVjdCBrdm1pX3ZjcHVfaGRyOworCXN0cnVjdCBrdm1pX2V2
ZW50X3JlcGx5OworCitUaGlzIGV2ZW50IGlzIHNlbnQgd2hlbiBhIGRlc2NyaXB0b3IgdGFibGUg
cmVnaXN0ZXIgaXMgYWNjZXNzZWQgYW5kIHRoZQoraW50cm9zcGVjdGlvbiBoYXMgYmVlbiBlbmFi
bGVkIGZvciB0aGlzIGV2ZW50IChzZWUgKipLVk1JX1ZDUFVfQ09OVFJPTF9FVkVOVFMqKikuCisK
K2Bga3ZtaV9ldmVudGBgIGFuZCBgYGt2bWlfZXZlbnRfZGVzY3JpcHRvcmBgIGFyZSBzZW50IHRv
IHRoZSBpbnRyb3NwZWN0aW9uIHRvb2wuCisKK2BgZGVzY3JpcHRvcmBgIGNhbiBiZSBvbmUgb2Y6
OgorCisJS1ZNSV9ERVNDX0lEVFIKKwlLVk1JX0RFU0NfR0RUUgorCUtWTUlfREVTQ19MRFRSCisJ
S1ZNSV9ERVNDX1RSCisKK2Bgd3JpdGVgYCBpcyAxIGlmIHRoZSBkZXNjcmlwdG9yIHdhcyB3cml0
dGVuLCAwIG90aGVyd2lzZS4KZGlmZiAtLWdpdCBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlf
aG9zdC5oIGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmgKaW5kZXggYWVkOGE0Yjg4
YTY4Li4wOWViZWQ4MGE4Y2MgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlf
aG9zdC5oCisrKyBiL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCkBAIC0zNSw2ICsz
NSw3IEBAIGJvb2wga3ZtaV9jcjNfaW50ZXJjZXB0ZWQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsK
IGJvb2wga3ZtaV9tb25pdG9yX2NyM3dfaW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwg
Ym9vbCBlbmFibGUpOwogdm9pZCBrdm1pX3hzZXRidl9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUsIHU4IHhjciwKIAkJICAgICAgIHU2NCBvbGRfdmFsdWUsIHU2NCBuZXdfdmFsdWUpOworYm9v
bCBrdm1pX2Rlc2NyaXB0b3JfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1OCBkZXNjcmlw
dG9yLCBib29sIHdyaXRlKTsKIAogI2Vsc2UgLyogQ09ORklHX0tWTV9JTlRST1NQRUNUSU9OICov
CiAKQEAgLTQ5LDYgKzUwLDggQEAgc3RhdGljIGlubGluZSBib29sIGt2bWlfbW9uaXRvcl9jcjN3
X2ludGVyY2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQkJCQlib29sIGVuYWJsZSkgeyBy
ZXR1cm4gZmFsc2U7IH0KIHN0YXRpYyBpbmxpbmUgdm9pZCBrdm1pX3hzZXRidl9ldmVudChzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUsIHU4IHhjciwKIAkJCQkJdTY0IG9sZF92YWx1ZSwgdTY0IG5ld192
YWx1ZSkgeyB9CitzdGF0aWMgaW5saW5lIGJvb2wga3ZtaV9kZXNjcmlwdG9yX2V2ZW50KHN0cnVj
dCBrdm1fdmNwdSAqdmNwdSwgdTggZGVzY3JpcHRvciwKKwkJCQkJIGJvb2wgd3JpdGUpIHsgcmV0
dXJuIHRydWU7IH0KIAogI2VuZGlmIC8qIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCmRp
ZmYgLS1naXQgYS9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaCBiL2FyY2gveDg2L2lu
Y2x1ZGUvdWFwaS9hc20va3ZtaS5oCmluZGV4IDMzZWRiYjViMzJmNC4uYjZmZjM5YmEwYWIzIDEw
MDY0NAotLS0gYS9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaAorKysgYi9hcmNoL3g4
Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaApAQCAtMTE2LDQgKzExNiwxNSBAQCBzdHJ1Y3Qga3Zt
aV92Y3B1X2dldF9tdHJyX3R5cGVfcmVwbHkgewogCV9fdTggcGFkZGluZ1s3XTsKIH07CiAKKyNk
ZWZpbmUgS1ZNSV9ERVNDX0lEVFIgIDEKKyNkZWZpbmUgS1ZNSV9ERVNDX0dEVFIgIDIKKyNkZWZp
bmUgS1ZNSV9ERVNDX0xEVFIgIDMKKyNkZWZpbmUgS1ZNSV9ERVNDX1RSICAgIDQKKworc3RydWN0
IGt2bWlfZXZlbnRfZGVzY3JpcHRvciB7CisJX191OCBkZXNjcmlwdG9yOworCV9fdTggd3JpdGU7
CisJX191OCBwYWRkaW5nWzZdOworfTsKKwogI2VuZGlmIC8qIF9VQVBJX0FTTV9YODZfS1ZNSV9I
ICovCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaS5jIGIvYXJjaC94ODYva3ZtL2t2bWku
YwppbmRleCA4MGFkNjdlODc1YzQuLjNhZTQzYTRjODc2NCAxMDA2NDQKLS0tIGEvYXJjaC94ODYv
a3ZtL2t2bWkuYworKysgYi9hcmNoL3g4Ni9rdm0va3ZtaS5jCkBAIC0zNjEsNiArMzYxLDIxIEBA
IHN0YXRpYyB2b2lkIGt2bWlfYXJjaF9kaXNhYmxlX2NyM3dfaW50ZXJjZXB0KHN0cnVjdCBrdm1f
dmNwdSAqdmNwdSkKIAl2Y3B1LT5hcmNoLmt2bWktPmNyM3cua3ZtX2ludGVyY2VwdGVkID0gZmFs
c2U7CiB9CiAKK3N0YXRpYyBpbnQga3ZtaV9jb250cm9sX2Rlc2NfaW50ZXJjZXB0KHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSwgYm9vbCBlbmFibGUpCit7CisJaWYgKCFrdm1feDg2X29wcy5kZXNjX2N0
cmxfc3VwcG9ydGVkKCkpCisJCXJldHVybiAtS1ZNX0VPUE5PVFNVUFA7CisKKwlrdm1feDg2X29w
cy5jb250cm9sX2Rlc2NfaW50ZXJjZXB0KHZjcHUsIGVuYWJsZSk7CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIHZvaWQga3ZtaV9hcmNoX2Rpc2FibGVfZGVzY19pbnRlcmNlcHQoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1KQoreworCWt2bWlfY29udHJvbF9kZXNjX2ludGVyY2VwdCh2Y3B1LCBmYWxz
ZSk7Cit9CisKIGludCBrdm1pX2FyY2hfY21kX2NvbnRyb2xfaW50ZXJjZXB0KHN0cnVjdCBrdm1f
dmNwdSAqdmNwdSwKIAkJCQkgICAgdW5zaWduZWQgaW50IGV2ZW50X2lkLCBib29sIGVuYWJsZSkK
IHsKQEAgLTM3MCw2ICszODUsOSBAQCBpbnQga3ZtaV9hcmNoX2NtZF9jb250cm9sX2ludGVyY2Vw
dChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJY2FzZSBLVk1JX0VWRU5UX0JSRUFLUE9JTlQ6CiAJ
CWVyciA9IGt2bWlfY29udHJvbF9icF9pbnRlcmNlcHQodmNwdSwgZW5hYmxlKTsKIAkJYnJlYWs7
CisJY2FzZSBLVk1JX0VWRU5UX0RFU0NSSVBUT1I6CisJCWVyciA9IGt2bWlfY29udHJvbF9kZXNj
X2ludGVyY2VwdCh2Y3B1LCBlbmFibGUpOworCQlicmVhazsKIAlkZWZhdWx0OgogCQlicmVhazsK
IAl9CkBAIC00MDEsNiArNDE5LDcgQEAgc3RhdGljIHZvaWQga3ZtaV9hcmNoX3Jlc3RvcmVfaW50
ZXJjZXB0aW9uKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIHsKIAlrdm1pX2FyY2hfZGlzYWJsZV9i
cF9pbnRlcmNlcHQodmNwdSk7CiAJa3ZtaV9hcmNoX2Rpc2FibGVfY3Izd19pbnRlcmNlcHQodmNw
dSk7CisJa3ZtaV9hcmNoX2Rpc2FibGVfZGVzY19pbnRlcmNlcHQodmNwdSk7CiB9CiAKIGJvb2wg
a3ZtaV9hcmNoX2NsZWFuX3VwX2ludGVyY2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCkBA
IC03OTEsMyArODEwLDU5IEBAIGludCBrdm1pX2FyY2hfY21kX3ZjcHVfZ2V0X210cnJfdHlwZShz
dHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHU2NCBncGEsIHU4ICp0eXBlKQogCiAJcmV0dXJuIDA7CiB9
CisKK3N0YXRpYyB1MzIga3ZtaV9tc2dfc2VuZF9kZXNjcmlwdG9yKHN0cnVjdCBrdm1fdmNwdSAq
dmNwdSwgdTggZGVzY3JpcHRvciwKKwkJCQkgICAgYm9vbCB3cml0ZSkKK3sKKwlzdHJ1Y3Qga3Zt
aV9ldmVudF9kZXNjcmlwdG9yIGU7CisJaW50IGVyciwgYWN0aW9uOworCisJbWVtc2V0KCZlLCAw
LCBzaXplb2YoZSkpOworCWUuZGVzY3JpcHRvciA9IGRlc2NyaXB0b3I7CisJZS53cml0ZSA9IHdy
aXRlID8gMSA6IDA7CisKKwllcnIgPSBrdm1pX3NlbmRfZXZlbnQodmNwdSwgS1ZNSV9FVkVOVF9E
RVNDUklQVE9SLCAmZSwgc2l6ZW9mKGUpLAorCQkJICAgICAgTlVMTCwgMCwgJmFjdGlvbik7CisJ
aWYgKGVycikKKwkJcmV0dXJuIEtWTUlfRVZFTlRfQUNUSU9OX0NPTlRJTlVFOworCisJcmV0dXJu
IGFjdGlvbjsKK30KKworc3RhdGljIGJvb2wgX19rdm1pX2Rlc2NyaXB0b3JfZXZlbnQoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1LCB1OCBkZXNjcmlwdG9yLAorCQkJCSAgICBib29sIHdyaXRlKQorewor
CWJvb2wgcmV0ID0gZmFsc2U7CisJdTMyIGFjdGlvbjsKKworCWFjdGlvbiA9IGt2bWlfbXNnX3Nl
bmRfZGVzY3JpcHRvcih2Y3B1LCBkZXNjcmlwdG9yLCB3cml0ZSk7CisJc3dpdGNoIChhY3Rpb24p
IHsKKwljYXNlIEtWTUlfRVZFTlRfQUNUSU9OX0NPTlRJTlVFOgorCQlyZXQgPSB0cnVlOworCQli
cmVhazsKKwljYXNlIEtWTUlfRVZFTlRfQUNUSU9OX1JFVFJZOgorCQlicmVhazsKKwlkZWZhdWx0
OgorCQlrdm1pX2hhbmRsZV9jb21tb25fZXZlbnRfYWN0aW9ucyh2Y3B1LT5rdm0sIGFjdGlvbik7
CisJfQorCisJcmV0dXJuIHJldDsKK30KKworYm9vbCBrdm1pX2Rlc2NyaXB0b3JfZXZlbnQoc3Ry
dWN0IGt2bV92Y3B1ICp2Y3B1LCB1OCBkZXNjcmlwdG9yLCBib29sIHdyaXRlKQoreworCXN0cnVj
dCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaTsKKwlib29sIHJldCA9IHRydWU7CisKKwlrdm1pID0g
a3ZtaV9nZXQodmNwdS0+a3ZtKTsKKwlpZiAoIWt2bWkpCisJCXJldHVybiB0cnVlOworCisJaWYg
KGlzX2V2ZW50X2VuYWJsZWQodmNwdSwgS1ZNSV9FVkVOVF9ERVNDUklQVE9SKSkKKwkJcmV0ID0g
X19rdm1pX2Rlc2NyaXB0b3JfZXZlbnQodmNwdSwgZGVzY3JpcHRvciwgd3JpdGUpOworCisJa3Zt
aV9wdXQodmNwdS0+a3ZtKTsKKworCXJldHVybiByZXQ7Cit9CitFWFBPUlRfU1lNQk9MKGt2bWlf
ZGVzY3JpcHRvcl9ldmVudCk7CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0vc3ZtL3N2bS5jIGIv
YXJjaC94ODYva3ZtL3N2bS9zdm0uYwppbmRleCBiYzg4NmNlZGY0NWMuLmEwYjkxMDA3ZTQ4NCAx
MDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL3N2bS9zdm0uYworKysgYi9hcmNoL3g4Ni9rdm0vc3Zt
L3N2bS5jCkBAIC0yMzI2LDYgKzIzMjYsMzkgQEAgc3RhdGljIGludCBkZXNjcmlwdG9yX2FjY2Vz
c19pbnRlcmNlcHRpb24oc3RydWN0IHZjcHVfc3ZtICpzdm0pCiB7CiAJc3RydWN0IGt2bV92Y3B1
ICp2Y3B1ID0gJnN2bS0+dmNwdTsKIAorI2lmZGVmIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTgor
CXN0cnVjdCB2bWNiX2NvbnRyb2xfYXJlYSAqYyA9ICZzdm0tPnZtY2ItPmNvbnRyb2w7CisJYm9v
bCBjb250OworCisJc3dpdGNoIChjLT5leGl0X2NvZGUpIHsKKwljYXNlIFNWTV9FWElUX0lEVFJf
UkVBRDoKKwljYXNlIFNWTV9FWElUX0lEVFJfV1JJVEU6CisJCWNvbnQgPSBrdm1pX2Rlc2NyaXB0
b3JfZXZlbnQodmNwdSwgS1ZNSV9ERVNDX0lEVFIsCisJCQkJICAgICAgYy0+ZXhpdF9jb2RlID09
IFNWTV9FWElUX0lEVFJfV1JJVEUpOworCQlicmVhazsKKwljYXNlIFNWTV9FWElUX0dEVFJfUkVB
RDoKKwljYXNlIFNWTV9FWElUX0dEVFJfV1JJVEU6CisJCWNvbnQgPSBrdm1pX2Rlc2NyaXB0b3Jf
ZXZlbnQodmNwdSwgS1ZNSV9ERVNDX0dEVFIsCisJCQkJICAgICAgYy0+ZXhpdF9jb2RlID09IFNW
TV9FWElUX0dEVFJfV1JJVEUpOworCQlicmVhazsKKwljYXNlIFNWTV9FWElUX0xEVFJfUkVBRDoK
KwljYXNlIFNWTV9FWElUX0xEVFJfV1JJVEU6CisJCWNvbnQgPSBrdm1pX2Rlc2NyaXB0b3JfZXZl
bnQodmNwdSwgS1ZNSV9ERVNDX0xEVFIsCisJCQkJICAgICAgYy0+ZXhpdF9jb2RlID09IFNWTV9F
WElUX0xEVFJfV1JJVEUpOworCQlicmVhazsKKwljYXNlIFNWTV9FWElUX1RSX1JFQUQ6CisJY2Fz
ZSBTVk1fRVhJVF9UUl9XUklURToKKwkJY29udCA9IGt2bWlfZGVzY3JpcHRvcl9ldmVudCh2Y3B1
LCBLVk1JX0RFU0NfVFIsCisJCQkJICAgICAgYy0+ZXhpdF9jb2RlID09IFNWTV9FWElUX1RSX1dS
SVRFKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJY29udCA9IHRydWU7CisJCWJyZWFrOworCX0K
KwlpZiAoIWNvbnQpCisJCXJldHVybiAxOworI2VuZGlmIC8qIENPTkZJR19LVk1fSU5UUk9TUEVD
VElPTiAqLworCiAJcmV0dXJuIGt2bV9lbXVsYXRlX2luc3RydWN0aW9uKHZjcHUsIDApOwogfQog
CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jIGIvYXJjaC94ODYva3ZtL3ZteC92
bXguYwppbmRleCA2OWFhMTE1N2EwZjAuLjc0YmRjZDQ5NjZjYSAxMDA2NDQKLS0tIGEvYXJjaC94
ODYva3ZtL3ZteC92bXguYworKysgYi9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jCkBAIC01MDE5LDcg
KzUwMTksMzAgQEAgc3RhdGljIGludCBoYW5kbGVfc2V0X2NyNChzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUsIHVuc2lnbmVkIGxvbmcgdmFsKQogCiBzdGF0aWMgaW50IGhhbmRsZV9kZXNjKHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSkKIHsKKyNpZmRlZiBDT05GSUdfS1ZNX0lOVFJPU1BFQ1RJT04KKwlzdHJ1
Y3QgdmNwdV92bXggKnZteCA9IHRvX3ZteCh2Y3B1KTsKKwl1MzIgZXhpdF9yZWFzb24gPSB2bXgt
PmV4aXRfcmVhc29uOworCXUzMiB2bXhfaW5zdHJ1Y3Rpb25faW5mbyA9IHZtY3NfcmVhZDMyKFZN
WF9JTlNUUlVDVElPTl9JTkZPKTsKKwl1OCBzdG9yZSA9ICh2bXhfaW5zdHJ1Y3Rpb25faW5mbyA+
PiAyOSkgJiAweDE7CisJdTggZGVzY3JpcHRvciA9IDA7CisKKwlpZiAoZXhpdF9yZWFzb24gPT0g
RVhJVF9SRUFTT05fR0RUUl9JRFRSKSB7CisJCWlmICgodm14X2luc3RydWN0aW9uX2luZm8gPj4g
MjgpICYgMHgxKQorCQkJZGVzY3JpcHRvciA9IEtWTUlfREVTQ19JRFRSOworCQllbHNlCisJCQlk
ZXNjcmlwdG9yID0gS1ZNSV9ERVNDX0dEVFI7CisJfSBlbHNlIHsKKwkJaWYgKCh2bXhfaW5zdHJ1
Y3Rpb25faW5mbyA+PiAyOCkgJiAweDEpCisJCQlkZXNjcmlwdG9yID0gS1ZNSV9ERVNDX1RSOwor
CQllbHNlCisJCQlkZXNjcmlwdG9yID0gS1ZNSV9ERVNDX0xEVFI7CisJfQorCisJaWYgKCFrdm1p
X2Rlc2NyaXB0b3JfZXZlbnQodmNwdSwgZGVzY3JpcHRvciwgc3RvcmUpKQorCQlyZXR1cm4gMTsK
KyNlbHNlCiAJV0FSTl9PTighKHZjcHUtPmFyY2guY3I0ICYgWDg2X0NSNF9VTUlQKSk7CisjZW5k
aWYgLyogQ09ORklHX0tWTV9JTlRST1NQRUNUSU9OICovCiAJcmV0dXJuIGt2bV9lbXVsYXRlX2lu
c3RydWN0aW9uKHZjcHUsIDApOwogfQogCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgv
a3ZtaS5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAppbmRleCAyMDdiY2FlZWMwNWEuLmYy
ZTgwMmQyYjcxMiAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAorKysgYi9p
bmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCkBAIC01NSw2ICs1NSw3IEBAIGVudW0gewogCUtWTUlf
RVZFTlRfQ1IgICAgICAgICA9IDQsCiAJS1ZNSV9FVkVOVF9UUkFQICAgICAgID0gNSwKIAlLVk1J
X0VWRU5UX1hTRVRCViAgICAgPSA2LAorCUtWTUlfRVZFTlRfREVTQ1JJUFRPUiA9IDcsCiAKIAlL
Vk1JX05VTV9FVkVOVFMKIH07CmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9r
dm0veDg2XzY0L2t2bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82
NC9rdm1pX3Rlc3QuYwppbmRleCA3MTc0ZTQ2NGQ3NTkuLjAwODdiOTE1NzRmMCAxMDA2NDQKLS0t
IGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYworKysgYi90
b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCkBAIC01NSw2ICs1
NSw3IEBAIGVudW0gewogCUdVRVNUX1RFU1RfTk9PUCA9IDAsCiAJR1VFU1RfVEVTVF9CUCwKIAlH
VUVTVF9URVNUX0NSLAorCUdVRVNUX1RFU1RfREVTQ1JJUFRPUiwKIAlHVUVTVF9URVNUX0hZUEVS
Q0FMTCwKIAlHVUVTVF9URVNUX1hTRVRCViwKIH07CkBAIC04NCw2ICs4NSwxNCBAQCBzdGF0aWMg
dm9pZCBndWVzdF9jcl90ZXN0KHZvaWQpCiAJc2V0X2NyNChnZXRfY3I0KCkgfCBYODZfQ1I0X09T
WFNBVkUpOwogfQogCitzdGF0aWMgdm9pZCBndWVzdF9kZXNjcmlwdG9yX3Rlc3Qodm9pZCkKK3sK
Kwl2b2lkICpwdHI7CisKKwlhc20gdm9sYXRpbGUoInNnZHQgJTAiIDo6ICJtIihwdHIpKTsKKwlh
c20gdm9sYXRpbGUoImxnZHQgJTAiIDo6ICJtIihwdHIpKTsKK30KKwogc3RhdGljIHZvaWQgZ3Vl
c3RfaHlwZXJjYWxsX3Rlc3Qodm9pZCkKIHsKIAlhc20gdm9sYXRpbGUoIm1vdiAkMzQsICVyYXgi
KTsKQEAgLTE0Myw2ICsxNTIsOSBAQCBzdGF0aWMgdm9pZCBndWVzdF9jb2RlKHZvaWQpCiAJCWNh
c2UgR1VFU1RfVEVTVF9DUjoKIAkJCWd1ZXN0X2NyX3Rlc3QoKTsKIAkJCWJyZWFrOworCQljYXNl
IEdVRVNUX1RFU1RfREVTQ1JJUFRPUjoKKwkJCWd1ZXN0X2Rlc2NyaXB0b3JfdGVzdCgpOworCQkJ
YnJlYWs7CiAJCWNhc2UgR1VFU1RfVEVTVF9IWVBFUkNBTEw6CiAJCQlndWVzdF9oeXBlcmNhbGxf
dGVzdCgpOwogCQkJYnJlYWs7CkBAIC0xNjE3LDYgKzE2MjksNjggQEAgc3RhdGljIHZvaWQgdGVz
dF9jbWRfdmNwdV9nZXRfbXRycl90eXBlKHN0cnVjdCBrdm1fdm0gKnZtKQogCXByX2luZm8oIm10
cnJfdHlwZTogZ3BhIDB4JWx4IHR5cGUgMHgleFxuIiwgdGVzdF9ncGEsIHJwbC50eXBlKTsKIH0K
IAorc3RhdGljIHZvaWQgdGVzdF9kZXNjX3JlYWRfYWNjZXNzKF9fdTE2IGV2ZW50X2lkKQorewor
CXN0cnVjdCBrdm1pX21zZ19oZHIgaGRyOworCXN0cnVjdCB7CisJCXN0cnVjdCBrdm1pX2V2ZW50
IGNvbW1vbjsKKwkJc3RydWN0IGt2bWlfZXZlbnRfZGVzY3JpcHRvciBkZXNjOworCX0gZXY7CisJ
c3RydWN0IHZjcHVfcmVwbHkgcnBsID0ge307CisKKwlyZWNlaXZlX2V2ZW50KCZoZHIsICZldi5j
b21tb24sIHNpemVvZihldiksIGV2ZW50X2lkKTsKKworCXByX2luZm8oIkRlc2NyaXB0b3IgZXZl
bnQgKHJlYWQpLCBkZXNjcmlwdG9yICV1LCB3cml0ZSAldVxuIiwKKwkJZXYuZGVzYy5kZXNjcmlw
dG9yLCBldi5kZXNjLndyaXRlKTsKKworCVRFU1RfQVNTRVJUKGV2LmRlc2Mud3JpdGUgPT0gMCwK
KwkJIlJlY2VpdmVkIGEgd3JpdGUgZGVzY3JpcHRvciBhY2Nlc3NcbiIpOworCisJcmVwbHlfdG9f
ZXZlbnQoJmhkciwgJmV2LmNvbW1vbiwgS1ZNSV9FVkVOVF9BQ1RJT05fQ09OVElOVUUsCisJCQkm
cnBsLCBzaXplb2YocnBsKSk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfZGVzY193cml0ZV9hY2Nl
c3MoX191MTYgZXZlbnRfaWQpCit7CisJc3RydWN0IGt2bWlfbXNnX2hkciBoZHI7CisJc3RydWN0
IHsKKwkJc3RydWN0IGt2bWlfZXZlbnQgY29tbW9uOworCQlzdHJ1Y3Qga3ZtaV9ldmVudF9kZXNj
cmlwdG9yIGRlc2M7CisJfSBldjsKKwlzdHJ1Y3QgdmNwdV9yZXBseSBycGwgPSB7fTsKKworCXJl
Y2VpdmVfZXZlbnQoJmhkciwgJmV2LmNvbW1vbiwgc2l6ZW9mKGV2KSwgZXZlbnRfaWQpOworCisJ
cHJfaW5mbygiRGVzY3JpcHRvciBldmVudCAod3JpdGUpLCBkZXNjcmlwdG9yICV1LCB3cml0ZSAl
dVxuIiwKKwkJZXYuZGVzYy5kZXNjcmlwdG9yLCBldi5kZXNjLndyaXRlKTsKKworCVRFU1RfQVNT
RVJUKGV2LmRlc2Mud3JpdGUgPT0gMSwKKwkJIlJlY2VpdmVkIGEgcmVhZCBkZXNjcmlwdG9yIGFj
Y2Vzc1xuIik7CisKKwlyZXBseV90b19ldmVudCgmaGRyLCAmZXYuY29tbW9uLCBLVk1JX0VWRU5U
X0FDVElPTl9DT05USU5VRSwKKwkJCSZycGwsIHNpemVvZihycGwpKTsKK30KKworc3RhdGljIHZv
aWQgdGVzdF9ldmVudF9kZXNjcmlwdG9yKHN0cnVjdCBrdm1fdm0gKnZtKQoreworCXN0cnVjdCB2
Y3B1X3dvcmtlcl9kYXRhIGRhdGEgPSB7CisJCS52bSA9IHZtLAorCQkudmNwdV9pZCA9IFZDUFVf
SUQsCisJCS50ZXN0X2lkID0gR1VFU1RfVEVTVF9ERVNDUklQVE9SLAorCX07CisJX191MTYgZXZl
bnRfaWQgPSBLVk1JX0VWRU5UX0RFU0NSSVBUT1I7CisJcHRocmVhZF90IHZjcHVfdGhyZWFkOwor
CisJZW5hYmxlX3ZjcHVfZXZlbnQodm0sIGV2ZW50X2lkKTsKKwl2Y3B1X3RocmVhZCA9IHN0YXJ0
X3ZjcHVfd29ya2VyKCZkYXRhKTsKKworCXRlc3RfZGVzY19yZWFkX2FjY2VzcyhldmVudF9pZCk7
CisJdGVzdF9kZXNjX3dyaXRlX2FjY2VzcyhldmVudF9pZCk7CisKKwlzdG9wX3ZjcHVfd29ya2Vy
KHZjcHVfdGhyZWFkLCAmZGF0YSk7CisJZGlzYWJsZV92Y3B1X2V2ZW50KHZtLCBldmVudF9pZCk7
Cit9CisKIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkK
IHsKIAlzcmFuZG9tKHRpbWUoMCkpOwpAQCAtMTY0Nyw2ICsxNzIxLDcgQEAgc3RhdGljIHZvaWQg
dGVzdF9pbnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtKQogCXRlc3RfY21kX3ZjcHVfZ2V0
X3hjcih2bSk7CiAJdGVzdF9jbWRfdmNwdV94c2F2ZSh2bSk7CiAJdGVzdF9jbWRfdmNwdV9nZXRf
bXRycl90eXBlKHZtKTsKKwl0ZXN0X2V2ZW50X2Rlc2NyaXB0b3Iodm0pOwogCiAJdW5ob29rX2lu
dHJvc3BlY3Rpb24odm0pOwogfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwppbmRleCA3NjFkM2ZjY2RkY2Uu
LmExYmM5NTcwYWMxYyAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMK
KysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKQEAgLTk5LDYgKzk5LDcgQEAgc3Rh
dGljIHZvaWQgc2V0dXBfa25vd25fZXZlbnRzKHZvaWQpCiAJYml0bWFwX3plcm8oS3ZtaV9rbm93
bl92Y3B1X2V2ZW50cywgS1ZNSV9OVU1fRVZFTlRTKTsKIAlzZXRfYml0KEtWTUlfRVZFTlRfQlJF
QUtQT0lOVCwgS3ZtaV9rbm93bl92Y3B1X2V2ZW50cyk7CiAJc2V0X2JpdChLVk1JX0VWRU5UX0NS
LCBLdm1pX2tub3duX3ZjcHVfZXZlbnRzKTsKKwlzZXRfYml0KEtWTUlfRVZFTlRfREVTQ1JJUFRP
UiwgS3ZtaV9rbm93bl92Y3B1X2V2ZW50cyk7CiAJc2V0X2JpdChLVk1JX0VWRU5UX0hZUEVSQ0FM
TCwgS3ZtaV9rbm93bl92Y3B1X2V2ZW50cyk7CiAJc2V0X2JpdChLVk1JX0VWRU5UX1BBVVNFX1ZD
UFUsIEt2bWlfa25vd25fdmNwdV9ldmVudHMpOwogCXNldF9iaXQoS1ZNSV9FVkVOVF9UUkFQLCBL
dm1pX2tub3duX3ZjcHVfZXZlbnRzKTsKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9u
QGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9u
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
