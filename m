Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id 80396228B3E
	for <lists.virtualization@lfdr.de>; Tue, 21 Jul 2020 23:26:30 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by whitealder.osuosl.org (Postfix) with ESMTP id 2DC8E88266;
	Tue, 21 Jul 2020 21:26:29 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id SVkrQI0dql6e; Tue, 21 Jul 2020 21:26:23 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by whitealder.osuosl.org (Postfix) with ESMTP id 68B7C88278;
	Tue, 21 Jul 2020 21:26:04 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 4C8CFC016F;
	Tue, 21 Jul 2020 21:26:04 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 43611C08A2
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:59 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by fraxinus.osuosl.org (Postfix) with ESMTP id 33DDB86B7E
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:59 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id XRzr5V4d3uwn
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:58 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by fraxinus.osuosl.org (Postfix) with ESMTPS id 1B59186BA3
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:57 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 D3231305D65A; Wed, 22 Jul 2020 00:09:24 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id BB380304FA13;
 Wed, 22 Jul 2020 00:09:24 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v9 39/84] KVM: introspection: add permission access ioctls
Date: Wed, 22 Jul 2020 00:08:37 +0300
Message-Id: <20200721210922.7646-40-alazar@bitdefender.com>
In-Reply-To: <20200721210922.7646-1-alazar@bitdefender.com>
References: <20200721210922.7646-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>, virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

S1ZNX0lOVFJPU1BFQ1RJT05fQ09NTUFORCBhbmQgS1ZNX0lOVFJPU1BFQ1RJT05fRVZFTlRTIGlv
Y3RscyBhcmUgdXNlZApieSB0aGUgZGV2aWNlIG1hbmFnZXIgdG8gYWxsb3cvZGlzYWxsb3cgYWNj
ZXNzIHRvIHNwZWNpZmljIChvciBhbGwpCmludHJvc3BlY3Rpb24gY29tbWFuZHMgYW5kIGV2ZW50
cy4gVGhlIGludHJvc3BlY3Rpb24gdG9vbCB3aWxsIGdldCB0aGUKS1ZNX0VQRVJNIGVycm9yIGNv
ZGUgb24gYW55IGF0dGVtcHQgdG8gdXNlIGEgZGlzYWxsb3dlZCBjb21tYW5kLgoKQnkgZGVmYXVs
dCwgYWxsIGV2ZW50cyBhbmQgYWxtb3N0IGFsbCBjb21tYW5kcyBhcmUgZGlzYWxsb3dlZC4KU29t
ZSBjb21tYW5kcywgdGhvc2UgcXVlcnlpbmcgdGhlIGludHJvc3BlY3Rpb24gY2FwYWJpbGl0aWVz
LAphcmUgYWx3YXlzIGFsbG93ZWQuCgpTaWduZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFs
YXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9hcGkucnN0
ICAgICAgICAgICAgICAgIHwgIDY2ICsrKysrKysrKysKIGluY2x1ZGUvbGludXgva3ZtaV9ob3N0
LmggICAgICAgICAgICAgICAgICAgICB8ICAgNyArKwogaW5jbHVkZS91YXBpL2xpbnV4L2t2bS5o
ICAgICAgICAgICAgICAgICAgICAgIHwgICA4ICsrCiBpbmNsdWRlL3VhcGkvbGludXgva3ZtaS5o
ICAgICAgICAgICAgICAgICAgICAgfCAgIDggKysKIC4uLi90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0v
eDg2XzY0L2t2bWlfdGVzdC5jICB8ICA0OCArKysrKysrCiB2aXJ0L2t2bS9pbnRyb3NwZWN0aW9u
L2t2bWkuYyAgICAgICAgICAgICAgICAgfCAxMTkgKysrKysrKysrKysrKysrKysrCiB2aXJ0L2t2
bS9rdm1fbWFpbi5jICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgMTQgKysrCiA3IGZpbGVz
IGNoYW5nZWQsIDI3MCBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvRG9jdW1lbnRhdGlvbi92
aXJ0L2t2bS9hcGkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9hcGkucnN0CmluZGV4IGUz
NGYyMDQzMGViMS4uMTc0ZjEzZjIzODlkIDEwMDY0NAotLS0gYS9Eb2N1bWVudGF0aW9uL3ZpcnQv
a3ZtL2FwaS5yc3QKKysrIGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9hcGkucnN0CkBAIC00NzUz
LDYgKzQ3NTMsNzIgQEAgRXJyb3JzOgogVGhpcyBpb2N0bCBpcyB1c2VkIHRvIGZyZWUgYWxsIGlu
dHJvc3BlY3Rpb24gc3RydWN0dXJlcwogcmVsYXRlZCB0byB0aGlzIFZNLgogCis0LjEyOCBLVk1f
SU5UUk9TUEVDVElPTl9DT01NQU5ECistLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisK
KzpDYXBhYmlsaXR5OiBLVk1fQ0FQX0lOVFJPU1BFQ1RJT04KKzpBcmNoaXRlY3R1cmVzOiB4ODYK
KzpUeXBlOiB2bSBpb2N0bAorOlBhcmFtZXRlcnM6IHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9m
ZWF0dXJlIChpbikKKzpSZXR1cm5zOiAwIG9uIHN1Y2Nlc3MsIGEgbmVnYXRpdmUgdmFsdWUgb24g
ZXJyb3IKKworRXJyb3JzOgorCisgID09PT09PSAgICAgPT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KKyAgRUZBVUxUICAgICB0aGUgVk0g
aXMgbm90IGludHJvc3BlY3RlZCB5ZXQgKHVzZSBLVk1fSU5UUk9TUEVDVElPTl9IT09LKQorICBF
SU5WQUwgICAgIHRoZSBjb21tYW5kIGlzIHVua25vd24KKyAgRVBFUk0gICAgICB0aGUgY29tbWFu
ZCBjYW4ndCBiZSBkaXNhbGxvd2VkIChlLmcuIEtWTUlfR0VUX1ZFUlNJT04pCisgID09PT09PSAg
ICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT0KKworVGhpcyBpb2N0bCBpcyB1c2VkIHRvIGFsbG93IG9yIGRpc2FsbG93IGludHJvc3Bl
Y3Rpb24gY29tbWFuZHMKK2ZvciB0aGUgY3VycmVudCBWTS4gQnkgZGVmYXVsdCwgYWxtb3N0IGFs
bCBjb21tYW5kcyBhcmUgZGlzYWxsb3dlZAorZXhjZXB0IGZvciB0aG9zZSB1c2VkIHRvIHF1ZXJ5
IHRoZSBBUEkuCisKKzo6CisKKyAgc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uX2ZlYXR1cmUgewor
CV9fdTMyIGFsbG93OworCV9fczMyIGlkOworICB9OworCitJZiBhbGxvdyBpcyAxLCB0aGUgY29t
bWFuZCBzcGVjaWZpZWQgYnkgaWQgaXMgYWxsb3dlZC4gSWYgYWxsb3cgaXMgMCwKK3RoZSBjb21t
YW5kIGlzIGRpc2FsbG93ZWQuCisKK1VubGVzcyBzZXQgdG8gLTEgKG1lYW5pbmcgYWxsIGNvbW1h
bmRzKSwgaWQgbXVzdCBiZSBhIGNvbW1hbmQgSUQKKyhlLmcuIEtWTUlfR0VUX1ZFUlNJT04pCisK
KzQuMTI5IEtWTV9JTlRST1NQRUNUSU9OX0VWRU5UCistLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLQorCis6Q2FwYWJpbGl0eTogS1ZNX0NBUF9JTlRST1NQRUNUSU9OCis6QXJjaGl0ZWN0dXJl
czogeDg2Cis6VHlwZTogdm0gaW9jdGwKKzpQYXJhbWV0ZXJzOiBzdHJ1Y3Qga3ZtX2ludHJvc3Bl
Y3Rpb25fZmVhdHVyZSAoaW4pCis6UmV0dXJuczogMCBvbiBzdWNjZXNzLCBhIG5lZ2F0aXZlIHZh
bHVlIG9uIGVycm9yCisKK0Vycm9yczoKKworICA9PT09PT0gICAgID09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CisgIEVGQVVMVCAgICAg
dGhlIFZNIGlzIG5vdCBpbnRyb3NwZWN0ZWQgeWV0ICh1c2UgS1ZNX0lOVFJPU1BFQ1RJT05fSE9P
SykKKyAgRUlOVkFMICAgICB0aGUgZXZlbnQgaXMgdW5rbm93bgorICA9PT09PT0gICAgID09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CisK
K1RoaXMgaW9jdGwgaXMgdXNlZCB0byBhbGxvdyBvciBkaXNhbGxvdyBpbnRyb3NwZWN0aW9uIGV2
ZW50cworZm9yIHRoZSBjdXJyZW50IFZNLiBCeSBkZWZhdWx0LCBhbGwgZXZlbnRzIGFyZSBkaXNh
bGxvd2VkLgorCis6OgorCisgIHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9mZWF0dXJlIHsKKwlf
X3UzMiBhbGxvdzsKKwlfX3MzMiBpZDsKKyAgfTsKKworSWYgYWxsb3cgaXMgMSwgdGhlIGV2ZW50
IHNwZWNpZmllZCBieSBpZCBpcyBhbGxvd2VkLiBJZiBhbGxvdyBpcyAwLAordGhlIGV2ZW50IGlz
IGRpc2FsbG93ZWQuCisKK1VubGVzcyBzZXQgdG8gLTEgKG1lYW5pbmcgYWxsIGV2ZW50cyksIGlk
IG11c3QgYmUgYSBldmVudCBJRAorKGUuZy4gS1ZNSV9FVkVOVF9VTkhPT0ssIEtWTUlfRVZFTlRf
Q1IsIGV0Yy4pCisKIDUuIFRoZSBrdm1fcnVuIHN0cnVjdHVyZQogPT09PT09PT09PT09PT09PT09
PT09PT09CiAKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmggYi9pbmNsdWRl
L2xpbnV4L2t2bWlfaG9zdC5oCmluZGV4IDU1ZmY1NzFkYjQwZC4uN2VmZDA3MWUzOThkIDEwMDY0
NAotLS0gYS9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCisrKyBiL2luY2x1ZGUvbGludXgva3Zt
aV9ob3N0LmgKQEAgLTE0LDYgKzE0LDkgQEAgc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uIHsKIAog
CXN0cnVjdCBzb2NrZXQgKnNvY2s7CiAJc3RydWN0IHRhc2tfc3RydWN0ICpyZWN2OworCisJdW5z
aWduZWQgbG9uZyAqY21kX2FsbG93X21hc2s7CisJdW5zaWduZWQgbG9uZyAqZXZlbnRfYWxsb3df
bWFzazsKIH07CiAKIGludCBrdm1pX3ZlcnNpb24odm9pZCk7CkBAIC0yNSw2ICsyOCwxMCBAQCB2
b2lkIGt2bWlfZGVzdHJveV92bShzdHJ1Y3Qga3ZtICprdm0pOwogaW50IGt2bWlfaW9jdGxfaG9v
ayhzdHJ1Y3Qga3ZtICprdm0sCiAJCSAgICBjb25zdCBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25f
aG9vayAqaG9vayk7CiBpbnQga3ZtaV9pb2N0bF91bmhvb2soc3RydWN0IGt2bSAqa3ZtKTsKK2lu
dCBrdm1pX2lvY3RsX2NvbW1hbmQoc3RydWN0IGt2bSAqa3ZtLAorCQkgICAgICAgY29uc3Qgc3Ry
dWN0IGt2bV9pbnRyb3NwZWN0aW9uX2ZlYXR1cmUgKmZlYXQpOworaW50IGt2bWlfaW9jdGxfZXZl
bnQoc3RydWN0IGt2bSAqa3ZtLAorCQkgICAgIGNvbnN0IHN0cnVjdCBrdm1faW50cm9zcGVjdGlv
bl9mZWF0dXJlICpmZWF0KTsKIAogI2Vsc2UKIApkaWZmIC0tZ2l0IGEvaW5jbHVkZS91YXBpL2xp
bnV4L2t2bS5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bS5oCmluZGV4IGRkODRlYmRmY2Q2ZC4u
MTdkZjAzY2ViNDgzIDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtLmgKKysrIGIv
aW5jbHVkZS91YXBpL2xpbnV4L2t2bS5oCkBAIC0xNjIyLDYgKzE2MjIsMTQgQEAgc3RydWN0IGt2
bV9pbnRyb3NwZWN0aW9uX2hvb2sgewogI2RlZmluZSBLVk1fSU5UUk9TUEVDVElPTl9IT09LICAg
IF9JT1coS1ZNSU8sIDB4YzMsIHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9ob29rKQogI2RlZmlu
ZSBLVk1fSU5UUk9TUEVDVElPTl9VTkhPT0sgIF9JTyhLVk1JTywgMHhjNCkKIAorc3RydWN0IGt2
bV9pbnRyb3NwZWN0aW9uX2ZlYXR1cmUgeworCV9fdTMyIGFsbG93OworCV9fczMyIGlkOworfTsK
KworI2RlZmluZSBLVk1fSU5UUk9TUEVDVElPTl9DT01NQU5EIF9JT1coS1ZNSU8sIDB4YzUsIHN0
cnVjdCBrdm1faW50cm9zcGVjdGlvbl9mZWF0dXJlKQorI2RlZmluZSBLVk1fSU5UUk9TUEVDVElP
Tl9FVkVOVCAgIF9JT1coS1ZNSU8sIDB4YzYsIHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9mZWF0
dXJlKQorCiAjZGVmaW5lIEtWTV9ERVZfQVNTSUdOX0VOQUJMRV9JT01NVQkoMSA8PCAwKQogI2Rl
ZmluZSBLVk1fREVWX0FTU0lHTl9QQ0lfMl8zCQkoMSA8PCAxKQogI2RlZmluZSBLVk1fREVWX0FT
U0lHTl9NQVNLX0lOVFgJKDEgPDwgMikKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9r
dm1pLmggYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCmluZGV4IDM0ZGRhOTEwMTZkYi4uZDdi
MThmZmVmNGZhIDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2lu
Y2x1ZGUvdWFwaS9saW51eC9rdm1pLmgKQEAgLTEwLDQgKzEwLDEyIEBAIGVudW0gewogCUtWTUlf
VkVSU0lPTiA9IDB4MDAwMDAwMDEKIH07CiAKK2VudW0geworCUtWTUlfTlVNX01FU1NBR0VTCit9
OworCitlbnVtIHsKKwlLVk1JX05VTV9FVkVOVFMKK307CisKICNlbmRpZiAvKiBfVUFQSV9fTElO
VVhfS1ZNSV9IICovCmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2
XzY0L2t2bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1p
X3Rlc3QuYwppbmRleCAwOGNhNDcwMWM0NDAuLjA5Yjg5ODkzMTdkNyAxMDA2NDQKLS0tIGEvdG9v
bHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYworKysgYi90b29scy90
ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCkBAIC00OCwxNCArNDgsNjIg
QEAgc3RhdGljIHZvaWQgZG9faG9va19pb2N0bChzdHJ1Y3Qga3ZtX3ZtICp2bSwgX19zMzIgZmQs
IF9fdTMyIHBhZGRpbmcsCiAJCWVycm5vLCBzdHJlcnJvcihlcnJubyksIGV4cGVjdGVkX2Vyciwg
ZmQsIHBhZGRpbmcpOwogfQogCitzdGF0aWMgdm9pZCBzZXRfcGVybShzdHJ1Y3Qga3ZtX3ZtICp2
bSwgX19zMzIgaWQsIF9fdTMyIGFsbG93LAorCQkgICAgIGludCBleHBlY3RlZF9lcnIsIGludCBp
b2N0bF9pZCwKKwkJICAgICBjb25zdCBjaGFyICppb2N0bF9zdHIpCit7CisJc3RydWN0IGt2bV9p
bnRyb3NwZWN0aW9uX2ZlYXR1cmUgZmVhdCA9IHsKKwkJLmFsbG93ID0gYWxsb3csCisJCS5pZCA9
IGlkCisJfTsKKwlpbnQgcjsKKworCXIgPSBpb2N0bCh2bS0+ZmQsIGlvY3RsX2lkLCAmZmVhdCk7
CisJVEVTVF9BU1NFUlQociA9PSAwIHx8IGVycm5vID09IGV4cGVjdGVkX2VyciwKKwkJIiVzIGZh
aWxlZCwgaWQgJWQsIGVycm5vICVkICglcyksIGV4cGVjdGVkICVkXG4iLAorCQlpb2N0bF9zdHIs
IGlkLCBlcnJubywgc3RyZXJyb3IoZXJybm8pLCBleHBlY3RlZF9lcnIpOworfQorCitzdGF0aWMg
dm9pZCBzZXRfZXZlbnRfcGVybShzdHJ1Y3Qga3ZtX3ZtICp2bSwgX19zMzIgaWQsIF9fdTMyIGFs
bG93LAorCQkJICAgaW50IGV4cGVjdGVkX2VycikKK3sKKwlzZXRfcGVybSh2bSwgaWQsIGFsbG93
LCBleHBlY3RlZF9lcnIsIEtWTV9JTlRST1NQRUNUSU9OX0VWRU5ULAorCQkgIktWTV9JTlRST1NQ
RUNUSU9OX0VWRU5UIik7Cit9CisKK3N0YXRpYyB2b2lkIGFsbG93X2V2ZW50KHN0cnVjdCBrdm1f
dm0gKnZtLCBfX3MzMiBldmVudF9pZCkKK3sKKwlzZXRfZXZlbnRfcGVybSh2bSwgZXZlbnRfaWQs
IDEsIDApOworfQorCitzdGF0aWMgdm9pZCBzZXRfY29tbWFuZF9wZXJtKHN0cnVjdCBrdm1fdm0g
KnZtLCBfX3MzMiBpZCwgX191MzIgYWxsb3csCisJCQkgICAgIGludCBleHBlY3RlZF9lcnIpCit7
CisJc2V0X3Blcm0odm0sIGlkLCBhbGxvdywgZXhwZWN0ZWRfZXJyLCBLVk1fSU5UUk9TUEVDVElP
Tl9DT01NQU5ELAorCQkgIktWTV9JTlRST1NQRUNUSU9OX0NPTU1BTkQiKTsKK30KKwogc3RhdGlj
IHZvaWQgaG9va19pbnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtKQogeworCV9fdTMyIGFs
bG93ID0gMSwgZGlzYWxsb3cgPSAwLCBhbGxvd19pbnZhbCA9IDI7CiAJX191MzIgcGFkZGluZyA9
IDEsIG5vX3BhZGRpbmcgPSAwOworCV9fczMyIGFsbF9JRHMgPSAtMTsKKworCXNldF9jb21tYW5k
X3Blcm0odm0sIGFsbF9JRHMsIGFsbG93LCBFRkFVTFQpOworCXNldF9ldmVudF9wZXJtKHZtLCBh
bGxfSURzLCBhbGxvdywgRUZBVUxUKTsKIAogCWRvX2hvb2tfaW9jdGwodm0sIEt2bV9zb2NrZXQs
IHBhZGRpbmcsIEVJTlZBTCk7CiAJZG9faG9va19pb2N0bCh2bSwgLTEsIG5vX3BhZGRpbmcsIEVJ
TlZBTCk7CiAJZG9faG9va19pb2N0bCh2bSwgS3ZtX3NvY2tldCwgbm9fcGFkZGluZywgMCk7CiAJ
ZG9faG9va19pb2N0bCh2bSwgS3ZtX3NvY2tldCwgbm9fcGFkZGluZywgRUVYSVNUKTsKKworCXNl
dF9jb21tYW5kX3Blcm0odm0sIGFsbF9JRHMsIGFsbG93X2ludmFsLCBFSU5WQUwpOworCXNldF9j
b21tYW5kX3Blcm0odm0sIGFsbF9JRHMsIGRpc2FsbG93LCAwKTsKKwlzZXRfY29tbWFuZF9wZXJt
KHZtLCBhbGxfSURzLCBhbGxvdywgMCk7CisKKwlzZXRfZXZlbnRfcGVybSh2bSwgYWxsX0lEcywg
YWxsb3dfaW52YWwsIEVJTlZBTCk7CisJc2V0X2V2ZW50X3Blcm0odm0sIGFsbF9JRHMsIGRpc2Fs
bG93LCAwKTsKKwlhbGxvd19ldmVudCh2bSwgYWxsX0lEcyk7CiB9CiAKIHN0YXRpYyB2b2lkIHVu
aG9va19pbnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtKQpkaWZmIC0tZ2l0IGEvdmlydC9r
dm0vaW50cm9zcGVjdGlvbi9rdm1pLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwpp
bmRleCA1ZDliYzRlZDUwNjAuLmIxZWEzOWYzNTQ4MSAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50
cm9zcGVjdGlvbi9rdm1pLmMKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKQEAg
LTgsNiArOCw4IEBACiAjaW5jbHVkZSA8bGludXgva3RocmVhZC5oPgogI2luY2x1ZGUgImt2bWlf
aW50LmgiCiAKKyNkZWZpbmUgS1ZNSV9OVU1fQ09NTUFORFMgS1ZNSV9OVU1fTUVTU0FHRVMKKwog
aW50IGt2bWlfaW5pdCh2b2lkKQogewogCXJldHVybiAwOwpAQCAtMjQsNiArMjYsOSBAQCB2b2lk
IGt2bWlfdW5pbml0KHZvaWQpCiAKIHN0YXRpYyB2b2lkIGZyZWVfa3ZtaShzdHJ1Y3Qga3ZtICpr
dm0pCiB7CisJYml0bWFwX2ZyZWUoa3ZtLT5rdm1pLT5jbWRfYWxsb3dfbWFzayk7CisJYml0bWFw
X2ZyZWUoa3ZtLT5rdm1pLT5ldmVudF9hbGxvd19tYXNrKTsKKwogCWtmcmVlKGt2bS0+a3ZtaSk7
CiAJa3ZtLT5rdm1pID0gTlVMTDsKIH0KQEAgLTM3LDYgKzQyLDE1IEBAIGFsbG9jX2t2bWkoc3Ry
dWN0IGt2bSAqa3ZtLCBjb25zdCBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25faG9vayAqaG9vaykK
IAlpZiAoIWt2bWkpCiAJCXJldHVybiBOVUxMOwogCisJa3ZtaS0+Y21kX2FsbG93X21hc2sgPSBi
aXRtYXBfemFsbG9jKEtWTUlfTlVNX0NPTU1BTkRTLCBHRlBfS0VSTkVMKTsKKwlrdm1pLT5ldmVu
dF9hbGxvd19tYXNrID0gYml0bWFwX3phbGxvYyhLVk1JX05VTV9FVkVOVFMsIEdGUF9LRVJORUwp
OworCWlmICgha3ZtaS0+Y21kX2FsbG93X21hc2sgfHwgIWt2bWktPmV2ZW50X2FsbG93X21hc2sp
IHsKKwkJYml0bWFwX2ZyZWUoa3ZtaS0+Y21kX2FsbG93X21hc2spOworCQliaXRtYXBfZnJlZShr
dm1pLT5ldmVudF9hbGxvd19tYXNrKTsKKwkJa2ZyZWUoa3ZtaSk7CisJCXJldHVybiBOVUxMOwor
CX0KKwogCUJVSUxEX0JVR19PTihzaXplb2YoaG9vay0+dXVpZCkgIT0gc2l6ZW9mKGt2bWktPnV1
aWQpKTsKIAltZW1jcHkoJmt2bWktPnV1aWQsICZob29rLT51dWlkLCBzaXplb2Yoa3ZtaS0+dXVp
ZCkpOwogCkBAIC0xODUsMyArMTk5LDEwOCBAQCB2b2lkIGt2bWlfZGVzdHJveV92bShzdHJ1Y3Qg
a3ZtICprdm0pCiB7CiAJa3ZtaV91bmhvb2soa3ZtKTsKIH0KKworc3RhdGljIGludAora3ZtaV9p
b2N0bF9nZXRfZmVhdHVyZShjb25zdCBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25fZmVhdHVyZSAq
ZmVhdCwKKwkJICAgICAgIGJvb2wgKmFsbG93LCBzMzIgKmlkLCB1bnNpZ25lZCBpbnQgbmJpdHMp
Cit7CisJczMyIGFsbF9iaXRzID0gLTE7CisKKwlpZiAoZmVhdC0+aWQgPCAwICYmIGZlYXQtPmlk
ICE9IGFsbF9iaXRzKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmIChmZWF0LT5pZCA+IDAgJiYg
ZmVhdC0+aWQgPj0gbmJpdHMpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKGZlYXQtPmFsbG93
ID4gMSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwkqYWxsb3cgPSBmZWF0LT5hbGxvdyA9PSAxOwor
CSppZCA9IGZlYXQtPmlkOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGt2bWlfY29u
dHJvbF9hbGxvd2VkX2V2ZW50cyhzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksCisJCQkJ
CXMzMiBpZCwgYm9vbCBhbGxvdykKK3sKKwlzMzIgYWxsX2V2ZW50cyA9IC0xOworCisJaWYgKGFs
bG93KSB7CisJCWlmIChpZCA9PSBhbGxfZXZlbnRzKQorCQkJYml0bWFwX2ZpbGwoa3ZtaS0+ZXZl
bnRfYWxsb3dfbWFzaywgS1ZNSV9OVU1fRVZFTlRTKTsKKwkJZWxzZQorCQkJc2V0X2JpdChpZCwg
a3ZtaS0+ZXZlbnRfYWxsb3dfbWFzayk7CisJfSBlbHNlIHsKKwkJaWYgKGlkID09IGFsbF9ldmVu
dHMpCisJCQliaXRtYXBfemVybyhrdm1pLT5ldmVudF9hbGxvd19tYXNrLCBLVk1JX05VTV9FVkVO
VFMpOworCQllbHNlCisJCQljbGVhcl9iaXQoaWQsIGt2bWktPmV2ZW50X2FsbG93X21hc2spOwor
CX0KK30KKworaW50IGt2bWlfaW9jdGxfZXZlbnQoc3RydWN0IGt2bSAqa3ZtLAorCQkgICAgIGNv
bnN0IHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9mZWF0dXJlICpmZWF0KQoreworCXN0cnVjdCBr
dm1faW50cm9zcGVjdGlvbiAqa3ZtaTsKKwlib29sIGFsbG93OworCWludCBlcnI7CisJczMyIGlk
OworCisJZXJyID0ga3ZtaV9pb2N0bF9nZXRfZmVhdHVyZShmZWF0LCAmYWxsb3csICZpZCwgS1ZN
SV9OVU1fRVZFTlRTKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJbXV0ZXhfbG9jaygm
a3ZtLT5rdm1pX2xvY2spOworCisJa3ZtaSA9IEtWTUkoa3ZtKTsKKwlpZiAoa3ZtaSkKKwkJa3Zt
aV9jb250cm9sX2FsbG93ZWRfZXZlbnRzKGt2bWksIGlkLCBhbGxvdyk7CisJZWxzZQorCQllcnIg
PSAtRUZBVUxUOworCisJbXV0ZXhfdW5sb2NrKCZrdm0tPmt2bWlfbG9jayk7CisJcmV0dXJuIGVy
cjsKK30KKworc3RhdGljIHZvaWQga3ZtaV9jb250cm9sX2FsbG93ZWRfY29tbWFuZHMoc3RydWN0
IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJCQkgIHMzMiBpZCwgYm9vbCBhbGxvdykKK3sK
KwlzMzIgYWxsX2NvbW1hbmRzID0gLTE7CisKKwlpZiAoYWxsb3cpIHsKKwkJaWYgKGlkID09IGFs
bF9jb21tYW5kcykKKwkJCWJpdG1hcF9maWxsKGt2bWktPmNtZF9hbGxvd19tYXNrLCBLVk1JX05V
TV9DT01NQU5EUyk7CisJCWVsc2UKKwkJCXNldF9iaXQoaWQsIGt2bWktPmNtZF9hbGxvd19tYXNr
KTsKKwl9IGVsc2UgeworCQlpZiAoaWQgPT0gYWxsX2NvbW1hbmRzKQorCQkJYml0bWFwX3plcm8o
a3ZtaS0+Y21kX2FsbG93X21hc2ssIEtWTUlfTlVNX0NPTU1BTkRTKTsKKwkJZWxzZQorCQkJY2xl
YXJfYml0KGlkLCBrdm1pLT5jbWRfYWxsb3dfbWFzayk7CisJfQorfQorCitpbnQga3ZtaV9pb2N0
bF9jb21tYW5kKHN0cnVjdCBrdm0gKmt2bSwKKwkJICAgICAgIGNvbnN0IHN0cnVjdCBrdm1faW50
cm9zcGVjdGlvbl9mZWF0dXJlICpmZWF0KQoreworCXN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAq
a3ZtaTsKKwlib29sIGFsbG93OworCWludCBlcnI7CisJczMyIGlkOworCisJZXJyID0ga3ZtaV9p
b2N0bF9nZXRfZmVhdHVyZShmZWF0LCAmYWxsb3csICZpZCwgS1ZNSV9OVU1fQ09NTUFORFMpOwor
CWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwltdXRleF9sb2NrKCZrdm0tPmt2bWlfbG9jayk7
CisKKwlrdm1pID0gS1ZNSShrdm0pOworCWlmIChrdm1pKQorCQlrdm1pX2NvbnRyb2xfYWxsb3dl
ZF9jb21tYW5kcyhrdm1pLCBpZCwgYWxsb3cpOworCWVsc2UKKwkJZXJyID0gLUVGQVVMVDsKKwor
CW11dGV4X3VubG9jaygma3ZtLT5rdm1pX2xvY2spOworCXJldHVybiBlcnI7Cit9CmRpZmYgLS1n
aXQgYS92aXJ0L2t2bS9rdm1fbWFpbi5jIGIvdmlydC9rdm0va3ZtX21haW4uYwppbmRleCAwZDJk
YTc3Y2NiMTIuLjlhZWI1N2U5MzE2NSAxMDA2NDQKLS0tIGEvdmlydC9rdm0va3ZtX21haW4uYwor
KysgYi92aXJ0L2t2bS9rdm1fbWFpbi5jCkBAIC0zODQ3LDYgKzM4NDcsMjAgQEAgc3RhdGljIGxv
bmcga3ZtX3ZtX2lvY3RsKHN0cnVjdCBmaWxlICpmaWxwLAogCQllbHNlCiAJCQlyID0gLUVQRVJN
OwogCQlicmVhazsKKwljYXNlIEtWTV9JTlRST1NQRUNUSU9OX0NPTU1BTkQ6CisJY2FzZSBLVk1f
SU5UUk9TUEVDVElPTl9FVkVOVDoKKwkJciA9IC1FUEVSTTsKKwkJaWYgKGVuYWJsZV9pbnRyb3Nw
ZWN0aW9uKSB7CisJCQlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25fZmVhdHVyZSBmZWF0OworCisJ
CQlpZiAoY29weV9mcm9tX3VzZXIoJmZlYXQsIGFyZ3AsIHNpemVvZihmZWF0KSkpCisJCQkJciA9
IC1FRkFVTFQ7CisJCQllbHNlIGlmIChpb2N0bCA9PSBLVk1fSU5UUk9TUEVDVElPTl9FVkVOVCkK
KwkJCQlyID0ga3ZtaV9pb2N0bF9ldmVudChrdm0sICZmZWF0KTsKKwkJCWVsc2UKKwkJCQlyID0g
a3ZtaV9pb2N0bF9jb21tYW5kKGt2bSwgJmZlYXQpOworCQl9CisJCWJyZWFrOwogI2VuZGlmIC8q
IENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCWRlZmF1bHQ6CiAJCXIgPSBrdm1fYXJjaF92
bV9pb2N0bChmaWxwLCBpb2N0bCwgYXJnKTsKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0
aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0
aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
