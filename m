Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id E257E228B37
	for <lists.virtualization@lfdr.de>; Tue, 21 Jul 2020 23:26:24 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 9B62386C34;
	Tue, 21 Jul 2020 21:26:23 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 3ebzzUUctsXZ; Tue, 21 Jul 2020 21:26:21 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 960DA86C6D;
	Tue, 21 Jul 2020 21:26:14 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 78E7EC08A2;
	Tue, 21 Jul 2020 21:26:14 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id E93E1C016F
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:10 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id C9C3E88280
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:10 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id TyFpIyG0OmtR
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:05 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id 40237882C3
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:59 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 B076A305D594; Wed, 22 Jul 2020 00:09:26 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 7279E304FA15;
 Wed, 22 Jul 2020 00:09:26 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v9 49/84] KVM: introspection: handle vCPU introspection
 requests
Date: Wed, 22 Jul 2020 00:08:47 +0300
Message-Id: <20200721210922.7646-50-alazar@bitdefender.com>
In-Reply-To: <20200721210922.7646-1-alazar@bitdefender.com>
References: <20200721210922.7646-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Mircea=20C=C3=AErjaliu?= <mcirjaliu@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhlIHJlY2Vpdmlu
ZyB0aHJlYWQgZGlzcGF0Y2hlcyB0aGUgdkNQVSBpbnRyb3NwZWN0aW9uIGNvbW1hbmRzIGJ5CmFk
ZGluZyB0aGVtIHRvIHRoZSB2Q1BVJ3Mgam9icyBsaXN0IGFuZCBraWNraW5nIHRoZSB2Q1BVLiBC
ZWZvcmUKZW50ZXJpbmcgaW4gZ3Vlc3QsIHRoZSB2Q1BVIHRocmVhZCBjaGVja3MgdGhlIGludHJv
c3BlY3Rpb24gcmVxdWVzdAooS1ZNX1JFUV9JTlRST1NQRUNUSU9OKSBhbmQgcnVucyBpdHMgcXVl
dWVkIGpvYnMuCgpTaWduZWQtb2ZmLWJ5OiBNaWhhaSBEb27Im3UgPG1kb250dUBiaXRkZWZlbmRl
ci5jb20+CkNvLWRldmVsb3BlZC1ieTogTWlyY2VhIEPDrnJqYWxpdSA8bWNpcmphbGl1QGJpdGRl
ZmVuZGVyLmNvbT4KU2lnbmVkLW9mZi1ieTogTWlyY2VhIEPDrnJqYWxpdSA8bWNpcmphbGl1QGJp
dGRlZmVuZGVyLmNvbT4KQ28tZGV2ZWxvcGVkLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBi
aXRkZWZlbmRlci5jb20+ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJp
dGRlZmVuZGVyLmNvbT4KLS0tCiBhcmNoL3g4Ni9rdm0veDg2LmMgICAgICAgICAgICB8ICAzICsr
CiBpbmNsdWRlL2xpbnV4L2t2bV9ob3N0LmggICAgICB8ICAxICsKIGluY2x1ZGUvbGludXgva3Zt
aV9ob3N0LmggICAgIHwgIDQgKysrCiB2aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYyB8IDU4
ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiB2aXJ0L2t2bS9rdm1fbWFpbi5j
ICAgICAgICAgICB8ICAyICsrCiA1IGZpbGVzIGNoYW5nZWQsIDY4IGluc2VydGlvbnMoKykKCmRp
ZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0veDg2LmMgYi9hcmNoL3g4Ni9rdm0veDg2LmMKaW5kZXgg
ZmYwZDNjODJkZTY0Li43ZjU2ZTIxNDlmMTggMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS94ODYu
YworKysgYi9hcmNoL3g4Ni9rdm0veDg2LmMKQEAgLTg3MDYsNiArODcwNiw5IEBAIHN0YXRpYyBp
bnQgdmNwdV9ydW4oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogCXZjcHUtPmFyY2gubDF0Zl9mbHVz
aF9sMWQgPSB0cnVlOwogCiAJZm9yICg7OykgeworCQlpZiAoa3ZtX2NoZWNrX3JlcXVlc3QoS1ZN
X1JFUV9JTlRST1NQRUNUSU9OLCB2Y3B1KSkKKwkJCWt2bWlfaGFuZGxlX3JlcXVlc3RzKHZjcHUp
OworCiAJCWlmIChrdm1fdmNwdV9ydW5uaW5nKHZjcHUpKSB7CiAJCQlyID0gdmNwdV9lbnRlcl9n
dWVzdCh2Y3B1KTsKIAkJfSBlbHNlIHsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgva3ZtX2hv
c3QuaCBiL2luY2x1ZGUvbGludXgva3ZtX2hvc3QuaAppbmRleCA4NTA5ZDgyNzI0NjYuLjI5NmI1
OWVjYzU0MCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9rdm1faG9zdC5oCisrKyBiL2luY2x1
ZGUvbGludXgva3ZtX2hvc3QuaApAQCAtMTQ2LDYgKzE0Niw3IEBAIHN0YXRpYyBpbmxpbmUgYm9v
bCBpc19lcnJvcl9wYWdlKHN0cnVjdCBwYWdlICpwYWdlKQogI2RlZmluZSBLVk1fUkVRX01NVV9S
RUxPQUQgICAgICAgICgxIHwgS1ZNX1JFUVVFU1RfV0FJVCB8IEtWTV9SRVFVRVNUX05PX1dBS0VV
UCkKICNkZWZpbmUgS1ZNX1JFUV9QRU5ESU5HX1RJTUVSICAgICAyCiAjZGVmaW5lIEtWTV9SRVFf
VU5IQUxUICAgICAgICAgICAgMworI2RlZmluZSBLVk1fUkVRX0lOVFJPU1BFQ1RJT04gICAgIDQK
ICNkZWZpbmUgS1ZNX1JFUVVFU1RfQVJDSF9CQVNFICAgICA4CiAKICNkZWZpbmUgS1ZNX0FSQ0hf
UkVRX0ZMQUdTKG5yLCBmbGFncykgKHsgXApkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9rdm1p
X2hvc3QuaCBiL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmgKaW5kZXggZDMyNDJhOTlmODkxLi45
NTZiOGQ1YzUxZTMgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmgKKysrIGIv
aW5jbHVkZS9saW51eC9rdm1pX2hvc3QuaApAQCAtNTMsNiArNTMsOCBAQCBpbnQga3ZtaV9pb2N0
bF9ldmVudChzdHJ1Y3Qga3ZtICprdm0sCiAJCSAgICAgY29uc3Qgc3RydWN0IGt2bV9pbnRyb3Nw
ZWN0aW9uX2ZlYXR1cmUgKmZlYXQpOwogaW50IGt2bWlfaW9jdGxfcHJldW5ob29rKHN0cnVjdCBr
dm0gKmt2bSk7CiAKK3ZvaWQga3ZtaV9oYW5kbGVfcmVxdWVzdHMoc3RydWN0IGt2bV92Y3B1ICp2
Y3B1KTsKKwogI2Vsc2UKIAogc3RhdGljIGlubGluZSBpbnQga3ZtaV9pbml0KHZvaWQpIHsgcmV0
dXJuIDA7IH0KQEAgLTYxLDYgKzYzLDggQEAgc3RhdGljIGlubGluZSB2b2lkIGt2bWlfY3JlYXRl
X3ZtKHN0cnVjdCBrdm0gKmt2bSkgeyB9CiBzdGF0aWMgaW5saW5lIHZvaWQga3ZtaV9kZXN0cm95
X3ZtKHN0cnVjdCBrdm0gKmt2bSkgeyB9CiBzdGF0aWMgaW5saW5lIHZvaWQga3ZtaV92Y3B1X3Vu
aW5pdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpIHsgfQogCitzdGF0aWMgaW5saW5lIHZvaWQga3Zt
aV9oYW5kbGVfcmVxdWVzdHMoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KSB7IH0KKwogI2VuZGlmIC8q
IENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCiAjZW5kaWYKZGlmZiAtLWdpdCBhL3ZpcnQv
a3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMK
aW5kZXggYjY1OTViY2E5OWY3Li5hOWQ0MDZmMjc2ZjUgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2lu
dHJvc3BlY3Rpb24va3ZtaS5jCisrKyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCkBA
IC0xMTMsNiArMTEzLDEyIEBAIHZvaWQga3ZtaV91bmluaXQodm9pZCkKIAlrdm1pX2NhY2hlX2Rl
c3Ryb3koKTsKIH0KIAorc3RhdGljIHZvaWQga3ZtaV9tYWtlX3JlcXVlc3Qoc3RydWN0IGt2bV92
Y3B1ICp2Y3B1KQoreworCWt2bV9tYWtlX3JlcXVlc3QoS1ZNX1JFUV9JTlRST1NQRUNUSU9OLCB2
Y3B1KTsKKwlrdm1fdmNwdV9raWNrKHZjcHUpOworfQorCiBzdGF0aWMgaW50IF9fa3ZtaV9hZGRf
am9iKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAkJCSAgdm9pZCAoKmZjdCkoc3RydWN0IGt2bV92
Y3B1ICp2Y3B1LCB2b2lkICpjdHgpLAogCQkJICB2b2lkICpjdHgsIHZvaWQgKCpmcmVlX2ZjdCko
dm9pZCAqY3R4KSkKQEAgLTE0NCw2ICsxNTAsOSBAQCBpbnQga3ZtaV9hZGRfam9iKHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSwKIAogCWVyciA9IF9fa3ZtaV9hZGRfam9iKHZjcHUsIGZjdCwgY3R4LCBm
cmVlX2ZjdCk7CiAKKwlpZiAoIWVycikKKwkJa3ZtaV9tYWtlX3JlcXVlc3QodmNwdSk7CisKIAly
ZXR1cm4gZXJyOwogfQogCkBAIC0zMTIsNiArMzIxLDE0IEBAIGludCBrdm1pX2lvY3RsX3VuaG9v
ayhzdHJ1Y3Qga3ZtICprdm0pCiAJcmV0dXJuIDA7CiB9CiAKK3N0cnVjdCBrdm1faW50cm9zcGVj
dGlvbiAqIF9fbXVzdF9jaGVjayBrdm1pX2dldChzdHJ1Y3Qga3ZtICprdm0pCit7CisJaWYgKHJl
ZmNvdW50X2luY19ub3RfemVybygma3ZtLT5rdm1pX3JlZikpCisJCXJldHVybiBrdm0tPmt2bWk7
CisKKwlyZXR1cm4gTlVMTDsKK30KKwogdm9pZCBrdm1pX3B1dChzdHJ1Y3Qga3ZtICprdm0pCiB7
CiAJaWYgKHJlZmNvdW50X2RlY19hbmRfdGVzdCgma3ZtLT5rdm1pX3JlZikpCkBAIC0zNzMsNiAr
MzkwLDEwIEBAIGludCBrdm1pX2hvb2soc3RydWN0IGt2bSAqa3ZtLCBjb25zdCBzdHJ1Y3Qga3Zt
X2ludHJvc3BlY3Rpb25faG9vayAqaG9vaykKIAlpbml0X2NvbXBsZXRpb24oJmt2bS0+a3ZtaV9j
b21wbGV0ZSk7CiAKIAlyZWZjb3VudF9zZXQoJmt2bS0+a3ZtaV9yZWYsIDEpOworCS8qCisJICog
UGFpcmVkIHdpdGggcmVmY291bnRfaW5jX25vdF96ZXJvKCkgZnJvbSBrdm1pX2dldCgpLgorCSAq
LworCXNtcF93bWIoKTsKIAogCWt2bWktPnJlY3YgPSBrdGhyZWFkX3J1bihrdm1pX3JlY3ZfdGhy
ZWFkLCBrdm1pLCAia3ZtaS1yZWN2Iik7CiAJaWYgKElTX0VSUihrdm1pLT5yZWN2KSkgewpAQCAt
NjcyLDMgKzY5Myw0MCBAQCBpbnQga3ZtaV9jbWRfd3JpdGVfcGh5c2ljYWwoc3RydWN0IGt2bSAq
a3ZtLCB1NjQgZ3BhLCBzaXplX3Qgc2l6ZSwKIAogCXJldHVybiAwOwogfQorCitzdGF0aWMgc3Ry
dWN0IGt2bWlfam9iICprdm1pX3B1bGxfam9iKHN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0aW9u
ICp2Y3B1aSkKK3sKKwlzdHJ1Y3Qga3ZtaV9qb2IgKmpvYiA9IE5VTEw7CisKKwlzcGluX2xvY2so
JnZjcHVpLT5qb2JfbG9jayk7CisJam9iID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZ2Y3B1
aS0+am9iX2xpc3QsIHR5cGVvZigqam9iKSwgbGluayk7CisJaWYgKGpvYikKKwkJbGlzdF9kZWwo
JmpvYi0+bGluayk7CisJc3Bpbl91bmxvY2soJnZjcHVpLT5qb2JfbG9jayk7CisKKwlyZXR1cm4g
am9iOworfQorCit2b2lkIGt2bWlfcnVuX2pvYnMoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQorewor
CXN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0aW9uICp2Y3B1aSA9IFZDUFVJKHZjcHUpOworCXN0
cnVjdCBrdm1pX2pvYiAqam9iOworCisJd2hpbGUgKChqb2IgPSBrdm1pX3B1bGxfam9iKHZjcHVp
KSkpIHsKKwkJam9iLT5mY3QodmNwdSwgam9iLT5jdHgpOworCQlrdm1pX2ZyZWVfam9iKGpvYik7
CisJfQorfQorCit2b2lkIGt2bWlfaGFuZGxlX3JlcXVlc3RzKHN0cnVjdCBrdm1fdmNwdSAqdmNw
dSkKK3sKKwlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWk7CisKKwlrdm1pID0ga3ZtaV9n
ZXQodmNwdS0+a3ZtKTsKKwlpZiAoIWt2bWkpCisJCXJldHVybjsKKworCWt2bWlfcnVuX2pvYnMo
dmNwdSk7CisKKwlrdm1pX3B1dCh2Y3B1LT5rdm0pOworfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0v
a3ZtX21haW4uYyBiL3ZpcnQva3ZtL2t2bV9tYWluLmMKaW5kZXggMWYxOTlkYTAzYWE0Li45MmQ2
NjJlNzI2OWYgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2t2bV9tYWluLmMKKysrIGIvdmlydC9rdm0v
a3ZtX21haW4uYwpAQCAtMjcxMCw2ICsyNzEwLDggQEAgc3RhdGljIGludCBrdm1fdmNwdV9jaGVj
a19ibG9jayhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJCWdvdG8gb3V0OwogCWlmIChzaWduYWxf
cGVuZGluZyhjdXJyZW50KSkKIAkJZ290byBvdXQ7CisJaWYgKGt2bV90ZXN0X3JlcXVlc3QoS1ZN
X1JFUV9JTlRST1NQRUNUSU9OLCB2Y3B1KSkKKwkJZ290byBvdXQ7CiAKIAlyZXQgPSAwOwogb3V0
OgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFs
aXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlv
bi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8v
dmlydHVhbGl6YXRpb24=
