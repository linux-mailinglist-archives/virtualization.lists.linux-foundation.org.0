Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp1.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id 2C6514C63DC
	for <lists.virtualization@lfdr.de>; Mon, 28 Feb 2022 08:37:22 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp1.osuosl.org (Postfix) with ESMTP id D1C7D81AEF;
	Mon, 28 Feb 2022 07:37:20 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
	by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id jf_tiZNe5Auw; Mon, 28 Feb 2022 07:37:19 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp1.osuosl.org (Postfix) with ESMTPS id 2EE4981BF4;
	Mon, 28 Feb 2022 07:37:19 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id B8353C007B;
	Mon, 28 Feb 2022 07:37:18 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [IPv6:2605:bc80:3010::133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 525F1C0077
 for <virtualization@lists.linux-foundation.org>;
 Mon, 28 Feb 2022 07:37:17 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id 219324027F
 for <virtualization@lists.linux-foundation.org>;
 Mon, 28 Feb 2022 07:37:15 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Authentication-Results: smtp2.osuosl.org (amavisd-new);
 dkim=pass (1024-bit key) header.d=redhat.com
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Q18QFplC4bvV
 for <virtualization@lists.linux-foundation.org>;
 Mon, 28 Feb 2022 07:37:13 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.129.124])
 by smtp2.osuosl.org (Postfix) with ESMTPS id 7758B40327
 for <virtualization@lists.linux-foundation.org>;
 Mon, 28 Feb 2022 07:37:13 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1646033832;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=/wPlcS5YmMniWkS1onT344ymXCZHXBP6WG1+ZfWE4vU=;
 b=ZsvsF51yAzz9TmqtPJ3BjsZ6nQBUXpMl9QV6yObTCsThhgbJxmy1nEc7M6xP9/uhYjYq17
 cvkkE7rOOSnSMjo8rt2VMG3K6MIQMc04hQsaGEhC3kPadROiIL3DrlEza/s4ojHT/PyzPT
 PtzIa2B+uZCY+4W4LDtp7osU9K6wYZM=
Received: from mail-pj1-f70.google.com (mail-pj1-f70.google.com
 [209.85.216.70]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 us-mta-551-ZyDVo0l2NRGPVe0ikV5NmA-1; Mon, 28 Feb 2022 02:37:09 -0500
X-MC-Unique: ZyDVo0l2NRGPVe0ikV5NmA-1
Received: by mail-pj1-f70.google.com with SMTP id
 c14-20020a17090a8d0e00b001bc72e5c3ecso6052517pjo.3
 for <virtualization@lists.linux-foundation.org>;
 Sun, 27 Feb 2022 23:37:09 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=x-gm-message-state:message-id:date:mime-version:user-agent:subject
 :content-language:to:cc:references:from:in-reply-to
 :content-transfer-encoding;
 bh=/wPlcS5YmMniWkS1onT344ymXCZHXBP6WG1+ZfWE4vU=;
 b=owtHTf27/aMsN1D4K7KQM76yB0ObsjE4JSEhteWesPLMdCpeI1gwcEeUBGtzRkrSli
 +t27OfchQt84Jaeiz+qnfyt4EVUIWsDcnD9n+L//GEdZ9MLrH5Z/Rub/H3isTFtOJv8e
 UN30yJLh8XVV4+9LwfxczNO/EeSwLrgrThBcW4+yLcXX0AR/KaaF8BVFtKISSlcH29X6
 wxbJ2ne5TIEHfW1qsxweLGprUm+/Aap1cAKL1u2cJNtyU6Nu36XpQ/3P6Eb1p6eVNL9I
 WEH2oFti9sUnTK0erjjDw+wBf/RTgMBu6/fVsaR3UpTK/XrWuE6OvEz5X3sKVpzsZmkR
 +Puw==
X-Gm-Message-State: AOAM532Aj6DKl+vCsNps8D692i3QXBUpE6FH9wjjWhF4IzXGNFbBHzIZ
 n5lqO9rpeXLqS8Xa0eqtyknbLQQN2170k86Zje9nnM6lcFWe3CwuVPasHhiuu/j1o5aTYuKmFIV
 rIP/wYuP3E2MTgSbK3fLJJBH7PnFrO4/nx8M2IWXGOg==
X-Received: by 2002:a17:902:7c91:b0:14f:973e:188d with SMTP id
 y17-20020a1709027c9100b0014f973e188dmr1601879pll.61.1646033828067; 
 Sun, 27 Feb 2022 23:37:08 -0800 (PST)
X-Google-Smtp-Source: ABdhPJwer2LD5LjiHVKL4Phzk+LeAh1/3r8mEzZlODL63ofDPIE6NjCQgogm9vRdVQKFNTYEl9ByLg==
X-Received: by 2002:a17:902:7c91:b0:14f:973e:188d with SMTP id
 y17-20020a1709027c9100b0014f973e188dmr1601848pll.61.1646033827689; 
 Sun, 27 Feb 2022 23:37:07 -0800 (PST)
Received: from [10.72.13.215] ([209.132.188.80])
 by smtp.gmail.com with ESMTPSA id
 f15-20020a056a001acf00b004f0ed8dc8d7sm11842013pfv.108.2022.02.27.23.37.00
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Sun, 27 Feb 2022 23:37:07 -0800 (PST)
Message-ID: <af6d14b3-6bdf-8717-90b5-bc685896cc8a@redhat.com>
Date: Mon, 28 Feb 2022 15:36:58 +0800
MIME-Version: 1.0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:91.0)
 Gecko/20100101 Thunderbird/91.6.1
Subject: Re: [PATCH v2 10/14] vdpa: Add custom IOTLB translations to SVQ
To: =?UTF-8?Q?Eugenio_P=c3=a9rez?= <eperezma@redhat.com>, qemu-devel@nongnu.org
References: <20220227134111.3254066-1-eperezma@redhat.com>
 <20220227134111.3254066-11-eperezma@redhat.com>
From: Jason Wang <jasowang@redhat.com>
In-Reply-To: <20220227134111.3254066-11-eperezma@redhat.com>
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=jasowang@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Content-Language: en-US
Cc: "Michael S. Tsirkin" <mst@redhat.com>,
 virtualization@lists.linux-foundation.org, Eli Cohen <eli@mellanox.com>,
 Eric Blake <eblake@redhat.com>, Parav Pandit <parav@mellanox.com>,
 Cindy Lu <lulu@redhat.com>, "Fangyi \(Eric\)" <eric.fangyi@huawei.com>,
 Markus Armbruster <armbru@redhat.com>, yebiaoxiang@huawei.com,
 Liuxiangdong <liuxiangdong5@huawei.com>, Laurent Vivier <lvivier@redhat.com>,
 Eduardo Habkost <ehabkost@redhat.com>,
 Richard Henderson <richard.henderson@linaro.org>,
 Gautam Dawar <gdawar@xilinx.com>, Xiao W Wang <xiao.w.wang@intel.com>,
 Stefan Hajnoczi <stefanha@redhat.com>,
 Harpreet Singh Anand <hanand@xilinx.com>, Paolo Bonzini <pbonzini@redhat.com>,
 Lingshan <lingshan.zhu@intel.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

CuWcqCAyMDIyLzIvMjcg5LiL5Y2IOTo0MSwgRXVnZW5pbyBQw6lyZXog5YaZ6YGTOgo+IFVzZSB0
cmFuc2xhdGlvbnMgYWRkZWQgaW4gVmhvc3RJT1ZBVHJlZSBpbiBTVlEuCj4KPiBPbmx5IGludHJv
ZHVjZSB1c2FnZSBoZXJlLCBub3QgYWxsb2NhdGlvbiBhbmQgZGVhbGxvY2F0aW9uLiBBcyB3aXRo
Cj4gcHJldmlvdXMgcGF0Y2hlcywgd2UgdXNlIHRoZSBkZWFkIGNvZGUgcGF0aHMgb2Ygc2hhZG93
X3Zxc19lbmFibGVkIHRvCj4gYXZvaWQgY29tbWl0aW5nIHRvbyBtYW55IGNoYW5nZXMgYXQgb25j
ZS4gVGhlc2UgYXJlIGltcG9zc2libGUgdG8gdGFrZQo+IGF0IHRoZSBtb21lbnQuCj4KPiBTaWdu
ZWQtb2ZmLWJ5OiBFdWdlbmlvIFDDqXJleiA8ZXBlcmV6bWFAcmVkaGF0LmNvbT4KPiAtLS0KPiAg
IGh3L3ZpcnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmggfCAgIDYgKy0KPiAgIGluY2x1ZGUv
aHcvdmlydGlvL3Zob3N0LXZkcGEuaCAgICAgfCAgIDMgKwo+ICAgaHcvdmlydGlvL3Zob3N0LXNo
YWRvdy12aXJ0cXVldWUuYyB8ICA3NiArKysrKysrKysrKysrKysrLQo+ICAgaHcvdmlydGlvL3Zo
b3N0LXZkcGEuYyAgICAgICAgICAgICB8IDEyOCArKysrKysrKysrKysrKysrKysrKysrKystLS0t
LQo+ICAgNCBmaWxlcyBjaGFuZ2VkLCAxODcgaW5zZXJ0aW9ucygrKSwgMjYgZGVsZXRpb25zKC0p
Cj4KPiBkaWZmIC0tZ2l0IGEvaHcvdmlydGlvL3Zob3N0LXNoYWRvdy12aXJ0cXVldWUuaCBiL2h3
L3ZpcnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmgKPiBpbmRleCAwNGM2NzY4NWZkLi5iMmY3
MjJkMTAxIDEwMDY0NAo+IC0tLSBhL2h3L3ZpcnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmgK
PiArKysgYi9ody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRxdWV1ZS5oCj4gQEAgLTEzLDYgKzEz
LDcgQEAKPiAgICNpbmNsdWRlICJxZW11L2V2ZW50X25vdGlmaWVyLmgiCj4gICAjaW5jbHVkZSAi
aHcvdmlydGlvL3ZpcnRpby5oIgo+ICAgI2luY2x1ZGUgInN0YW5kYXJkLWhlYWRlcnMvbGludXgv
dmhvc3RfdHlwZXMuaCIKPiArI2luY2x1ZGUgImh3L3ZpcnRpby92aG9zdC1pb3ZhLXRyZWUuaCIK
PiAgIAo+ICAgLyogU2hhZG93IHZpcnRxdWV1ZSB0byByZWxheSBub3RpZmljYXRpb25zICovCj4g
ICB0eXBlZGVmIHN0cnVjdCBWaG9zdFNoYWRvd1ZpcnRxdWV1ZSB7Cj4gQEAgLTQzLDYgKzQ0LDkg
QEAgdHlwZWRlZiBzdHJ1Y3QgVmhvc3RTaGFkb3dWaXJ0cXVldWUgewo+ICAgICAgIC8qIFZpcnRp
byBkZXZpY2UgKi8KPiAgICAgICBWaXJ0SU9EZXZpY2UgKnZkZXY7Cj4gICAKPiArICAgIC8qIElP
VkEgbWFwcGluZyAqLwo+ICsgICAgVmhvc3RJT1ZBVHJlZSAqaW92YV90cmVlOwo+ICsKPiAgICAg
ICAvKiBNYXAgZm9yIHVzZSB0aGUgZ3Vlc3QncyBkZXNjcmlwdG9ycyAqLwo+ICAgICAgIFZpcnRR
dWV1ZUVsZW1lbnQgKipyaW5nX2lkX21hcHM7Cj4gICAKPiBAQCAtNzgsNyArODIsNyBAQCB2b2lk
IHZob3N0X3N2cV9zdGFydChWaG9zdFNoYWRvd1ZpcnRxdWV1ZSAqc3ZxLCBWaXJ0SU9EZXZpY2Ug
KnZkZXYsCj4gICAgICAgICAgICAgICAgICAgICAgICBWaXJ0UXVldWUgKnZxKTsKPiAgIHZvaWQg
dmhvc3Rfc3ZxX3N0b3AoVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSk7Cj4gICAKPiAtVmhvc3RT
aGFkb3dWaXJ0cXVldWUgKnZob3N0X3N2cV9uZXcodm9pZCk7Cj4gK1Zob3N0U2hhZG93VmlydHF1
ZXVlICp2aG9zdF9zdnFfbmV3KFZob3N0SU9WQVRyZWUgKmlvdmFfdHJlZSk7Cj4gICAKPiAgIHZv
aWQgdmhvc3Rfc3ZxX2ZyZWUoZ3BvaW50ZXIgdnEpOwo+ICAgR19ERUZJTkVfQVVUT1BUUl9DTEVB
TlVQX0ZVTkMoVmhvc3RTaGFkb3dWaXJ0cXVldWUsIHZob3N0X3N2cV9mcmVlKTsKPiBkaWZmIC0t
Z2l0IGEvaW5jbHVkZS9ody92aXJ0aW8vdmhvc3QtdmRwYS5oIGIvaW5jbHVkZS9ody92aXJ0aW8v
dmhvc3QtdmRwYS5oCj4gaW5kZXggMDA5YTlmM2I2Yi4uZWU4ZTkzOWFkMCAxMDA2NDQKPiAtLS0g
YS9pbmNsdWRlL2h3L3ZpcnRpby92aG9zdC12ZHBhLmgKPiArKysgYi9pbmNsdWRlL2h3L3ZpcnRp
by92aG9zdC12ZHBhLmgKPiBAQCAtMTQsNiArMTQsNyBAQAo+ICAgCj4gICAjaW5jbHVkZSA8Z21v
ZHVsZS5oPgo+ICAgCj4gKyNpbmNsdWRlICJody92aXJ0aW8vdmhvc3QtaW92YS10cmVlLmgiCj4g
ICAjaW5jbHVkZSAiaHcvdmlydGlvL3ZpcnRpby5oIgo+ICAgI2luY2x1ZGUgInN0YW5kYXJkLWhl
YWRlcnMvbGludXgvdmhvc3RfdHlwZXMuaCIKPiAgIAo+IEBAIC0zMCw2ICszMSw4IEBAIHR5cGVk
ZWYgc3RydWN0IHZob3N0X3ZkcGEgewo+ICAgICAgIE1lbW9yeUxpc3RlbmVyIGxpc3RlbmVyOwo+
ICAgICAgIHN0cnVjdCB2aG9zdF92ZHBhX2lvdmFfcmFuZ2UgaW92YV9yYW5nZTsKPiAgICAgICBi
b29sIHNoYWRvd192cXNfZW5hYmxlZDsKPiArICAgIC8qIElPVkEgbWFwcGluZyB1c2VkIGJ5IHRo
ZSBTaGFkb3cgVmlydHF1ZXVlICovCj4gKyAgICBWaG9zdElPVkFUcmVlICppb3ZhX3RyZWU7Cj4g
ICAgICAgR1B0ckFycmF5ICpzaGFkb3dfdnFzOwo+ICAgICAgIHN0cnVjdCB2aG9zdF9kZXYgKmRl
djsKPiAgICAgICBWaG9zdFZEUEFIb3N0Tm90aWZpZXIgbm90aWZpZXJbVklSVElPX1FVRVVFX01B
WF07Cj4gZGlmZiAtLWdpdCBhL2h3L3ZpcnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmMgYi9o
dy92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRxdWV1ZS5jCj4gaW5kZXggYTM4ZDMxMzc1NS4uN2Uw
NzM3NzNkMSAxMDA2NDQKPiAtLS0gYS9ody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRxdWV1ZS5j
Cj4gKysrIGIvaHcvdmlydGlvL3Zob3N0LXNoYWRvdy12aXJ0cXVldWUuYwo+IEBAIC0xMSw2ICsx
MSw3IEBACj4gICAjaW5jbHVkZSAiaHcvdmlydGlvL3Zob3N0LXNoYWRvdy12aXJ0cXVldWUuaCIK
PiAgIAo+ICAgI2luY2x1ZGUgInFlbXUvZXJyb3ItcmVwb3J0LmgiCj4gKyNpbmNsdWRlICJxZW11
L2xvZy5oIgo+ICAgI2luY2x1ZGUgInFlbXUvbWFpbi1sb29wLmgiCj4gICAjaW5jbHVkZSAicWVt
dS9sb2cuaCIKPiAgICNpbmNsdWRlICJsaW51eC1oZWFkZXJzL2xpbnV4L3Zob3N0LmgiCj4gQEAg
LTg0LDcgKzg1LDU4IEBAIHN0YXRpYyB2b2lkIHZob3N0X3N2cV9zZXRfbm90aWZpY2F0aW9uKFZo
b3N0U2hhZG93VmlydHF1ZXVlICpzdnEsIGJvb2wgZW5hYmxlKQo+ICAgICAgIH0KPiAgIH0KPiAg
IAo+ICsvKioKPiArICogVHJhbnNsYXRlIGFkZHJlc3NlcyBiZXR3ZWVuIHRoZSBxZW11J3Mgdmly
dHVhbCBhZGRyZXNzIGFuZCB0aGUgU1ZRIElPVkEKPiArICoKPiArICogQHN2cSAgICBTaGFkb3cg
VmlydFF1ZXVlCj4gKyAqIEB2YWRkciAgVHJhbnNsYXRlZCBJT1ZBIGFkZHJlc3Nlcwo+ICsgKiBA
aW92ZWMgIFNvdXJjZSBxZW11J3MgVkEgYWRkcmVzc2VzCj4gKyAqIEBudW0gICAgTGVuZ3RoIG9m
IGlvdmVjIGFuZCBtaW5pbXVtIGxlbmd0aCBvZiB2YWRkcgo+ICsgKi8KPiArc3RhdGljIGJvb2wg
dmhvc3Rfc3ZxX3RyYW5zbGF0ZV9hZGRyKGNvbnN0IFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEs
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICoqYWRkcnMsIGNv
bnN0IHN0cnVjdCBpb3ZlYyAqaW92ZWMsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzaXplX3QgbnVtKQo+ICt7Cj4gKyAgICBpZiAobnVtID09IDApIHsKPiArICAgICAg
ICByZXR1cm4gdHJ1ZTsKPiArICAgIH0KPiArCj4gKyAgICBmb3IgKHNpemVfdCBpID0gMDsgaSA8
IG51bTsgKytpKSB7Cj4gKyAgICAgICAgRE1BTWFwIG5lZWRsZSA9IHsKPiArICAgICAgICAgICAg
LnRyYW5zbGF0ZWRfYWRkciA9IChod2FkZHIpaW92ZWNbaV0uaW92X2Jhc2UsCj4gKyAgICAgICAg
ICAgIC5zaXplID0gaW92ZWNbaV0uaW92X2xlbiwKPiArICAgICAgICB9Owo+ICsgICAgICAgIHNp
emVfdCBvZmY7Cj4gKwo+ICsgICAgICAgIGNvbnN0IERNQU1hcCAqbWFwID0gdmhvc3RfaW92YV90
cmVlX2ZpbmRfaW92YShzdnEtPmlvdmFfdHJlZSwgJm5lZWRsZSk7Cj4gKyAgICAgICAgLyoKPiAr
ICAgICAgICAgKiBNYXAgY2Fubm90IGJlIE5VTEwgc2luY2UgaW92YSBtYXAgY29udGFpbnMgYWxs
IGd1ZXN0IHNwYWNlIGFuZAo+ICsgICAgICAgICAqIHFlbXUgYWxyZWFkeSBoYXMgYSBwaHlzaWNh
bCBhZGRyZXNzIG1hcHBlZAo+ICsgICAgICAgICAqLwo+ICsgICAgICAgIGlmICh1bmxpa2VseSgh
bWFwKSkgewo+ICsgICAgICAgICAgICBxZW11X2xvZ19tYXNrKExPR19HVUVTVF9FUlJPUiwKPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAiSW52YWxpZCBhZGRyZXNzIDB4JSJIV0FERFJfUFJJ
eCIgZ2l2ZW4gYnkgZ3Vlc3QiLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgIG5lZWRsZS50
cmFuc2xhdGVkX2FkZHIpOwo+ICsgICAgICAgICAgICByZXR1cm4gZmFsc2U7Cj4gKyAgICAgICAg
fQo+ICsKPiArICAgICAgICBvZmYgPSBuZWVkbGUudHJhbnNsYXRlZF9hZGRyIC0gbWFwLT50cmFu
c2xhdGVkX2FkZHI7Cj4gKyAgICAgICAgYWRkcnNbaV0gPSAodm9pZCAqKShtYXAtPmlvdmEgKyBv
ZmYpOwo+ICsKPiArICAgICAgICBpZiAodW5saWtlbHkoaW50MTI4X2d0KGludDEyOF9hZGQobmVl
ZGxlLnRyYW5zbGF0ZWRfYWRkciwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgaW92ZWNbaV0uaW92X2xlbiksCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBtYXAtPnRyYW5zbGF0ZWRfYWRkciArIG1hcC0+c2l6ZSkpKSB7Cj4gKyAgICAgICAgICAg
IHFlbXVfbG9nX21hc2soTE9HX0dVRVNUX0VSUk9SLAo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICJHdWVzdCBidWZmZXIgZXhwYW5kcyBvdmVyIGlvdmEgcmFuZ2UiKTsKPiArICAgICAgICAg
ICAgcmV0dXJuIGZhbHNlOwo+ICsgICAgICAgIH0KPiArICAgIH0KPiArCj4gKyAgICByZXR1cm4g
dHJ1ZTsKPiArfQo+ICsKPiAgIHN0YXRpYyB2b2lkIHZob3N0X3ZyaW5nX3dyaXRlX2Rlc2NzKFZo
b3N0U2hhZG93VmlydHF1ZXVlICpzdnEsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHZvaWQgKiBjb25zdCAqdmFkZHJfc2csCgoKTml0OiBpdCBsb29rcyB0byBtZSB3ZSBh
cmUgbm90IHBhc3NpbmcgdmFkZHIgYnV0IGlvdmEgaGVyZSwgc28gaXQgbWlnaHQgCmJlIGJldHRl
ciB0byB1c2UgInNnIj8KCgo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y29uc3Qgc3RydWN0IGlvdmVjICppb3ZlYywKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHNpemVfdCBudW0sIGJvb2wgbW9yZV9kZXNjcywgYm9vbCB3cml0ZSkKPiAgIHsK
PiBAQCAtMTAzLDcgKzE1NSw3IEBAIHN0YXRpYyB2b2lkIHZob3N0X3ZyaW5nX3dyaXRlX2Rlc2Nz
KFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEsCj4gICAgICAgICAgIH0gZWxzZSB7Cj4gICAgICAg
ICAgICAgICBkZXNjc1tpXS5mbGFncyA9IGZsYWdzOwo+ICAgICAgICAgICB9Cj4gLSAgICAgICAg
ZGVzY3NbaV0uYWRkciA9IGNwdV90b19sZTY0KChod2FkZHIpaW92ZWNbbl0uaW92X2Jhc2UpOwo+
ICsgICAgICAgIGRlc2NzW2ldLmFkZHIgPSBjcHVfdG9fbGU2NCgoaHdhZGRyKXZhZGRyX3NnW25d
KTsKPiAgICAgICAgICAgZGVzY3NbaV0ubGVuID0gY3B1X3RvX2xlMzIoaW92ZWNbbl0uaW92X2xl
bik7Cj4gICAKPiAgICAgICAgICAgbGFzdCA9IGk7Cj4gQEAgLTExOSw2ICsxNzEsOCBAQCBzdGF0
aWMgYm9vbCB2aG9zdF9zdnFfYWRkX3NwbGl0KFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEsCj4g
ICB7Cj4gICAgICAgdW5zaWduZWQgYXZhaWxfaWR4Owo+ICAgICAgIHZyaW5nX2F2YWlsX3QgKmF2
YWlsID0gc3ZxLT52cmluZy5hdmFpbDsKPiArICAgIGJvb2wgb2s7Cj4gKyAgICBnX2F1dG9mcmVl
IHZvaWQgKipzZ3MgPSBnX25ldyh2b2lkICosIE1BWChlbGVtLT5vdXRfbnVtLCBlbGVtLT5pbl9u
dW0pKTsKPiAgIAo+ICAgICAgICpoZWFkID0gc3ZxLT5mcmVlX2hlYWQ7Cj4gICAKPiBAQCAtMTI5
LDkgKzE4MywyMCBAQCBzdGF0aWMgYm9vbCB2aG9zdF9zdnFfYWRkX3NwbGl0KFZob3N0U2hhZG93
VmlydHF1ZXVlICpzdnEsCj4gICAgICAgICAgIHJldHVybiBmYWxzZTsKPiAgICAgICB9Cj4gICAK
PiAtICAgIHZob3N0X3ZyaW5nX3dyaXRlX2Rlc2NzKHN2cSwgZWxlbS0+b3V0X3NnLCBlbGVtLT5v
dXRfbnVtLAo+ICsgICAgb2sgPSB2aG9zdF9zdnFfdHJhbnNsYXRlX2FkZHIoc3ZxLCBzZ3MsIGVs
ZW0tPm91dF9zZywgZWxlbS0+b3V0X251bSk7Cj4gKyAgICBpZiAodW5saWtlbHkoIW9rKSkgewo+
ICsgICAgICAgIHJldHVybiBmYWxzZTsKPiArICAgIH0KPiArICAgIHZob3N0X3ZyaW5nX3dyaXRl
X2Rlc2NzKHN2cSwgc2dzLCBlbGVtLT5vdXRfc2csIGVsZW0tPm91dF9udW0sCj4gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZWxlbS0+aW5fbnVtID4gMCwgZmFsc2UpOwo+IC0gICAgdmhv
c3RfdnJpbmdfd3JpdGVfZGVzY3Moc3ZxLCBlbGVtLT5pbl9zZywgZWxlbS0+aW5fbnVtLCBmYWxz
ZSwgdHJ1ZSk7Cj4gKwo+ICsKPiArICAgIG9rID0gdmhvc3Rfc3ZxX3RyYW5zbGF0ZV9hZGRyKHN2
cSwgc2dzLCBlbGVtLT5pbl9zZywgZWxlbS0+aW5fbnVtKTsKPiArICAgIGlmICh1bmxpa2VseSgh
b2spKSB7Cj4gKyAgICAgICAgcmV0dXJuIGZhbHNlOwo+ICsgICAgfQo+ICsKPiArICAgIHZob3N0
X3ZyaW5nX3dyaXRlX2Rlc2NzKHN2cSwgc2dzLCBlbGVtLT5pbl9zZywgZWxlbS0+aW5fbnVtLCBm
YWxzZSwgdHJ1ZSk7Cj4gICAKPiAgICAgICAvKgo+ICAgICAgICAqIFB1dCB0aGUgZW50cnkgaW4g
dGhlIGF2YWlsYWJsZSBhcnJheSAoYnV0IGRvbid0IHVwZGF0ZSBhdmFpbC0+aWR4IHVudGlsCj4g
QEAgLTUxNCwxMSArNTc5LDEzIEBAIHZvaWQgdmhvc3Rfc3ZxX3N0b3AoVmhvc3RTaGFkb3dWaXJ0
cXVldWUgKnN2cSkKPiAgICAqIENyZWF0ZXMgdmhvc3Qgc2hhZG93IHZpcnRxdWV1ZSwgYW5kIGlu
c3RydWN0cyB0aGUgdmhvc3QgZGV2aWNlIHRvIHVzZSB0aGUKPiAgICAqIHNoYWRvdyBtZXRob2Rz
IGFuZCBmaWxlIGRlc2NyaXB0b3JzLgo+ICAgICoKPiArICogQGlvdmFfdHJlZSBUcmVlIHRvIHBl
cmZvcm0gZGVzY3JpcHRvcnMgdHJhbnNsYXRpb25zCj4gKyAqCj4gICAgKiBSZXR1cm5zIHRoZSBu
ZXcgdmlydHF1ZXVlIG9yIE5VTEwuCj4gICAgKgo+ICAgICogSW4gY2FzZSBvZiBlcnJvciwgcmVh
c29uIGlzIHJlcG9ydGVkIHRocm91Z2ggZXJyb3JfcmVwb3J0Lgo+ICAgICovCj4gLVZob3N0U2hh
ZG93VmlydHF1ZXVlICp2aG9zdF9zdnFfbmV3KHZvaWQpCj4gK1Zob3N0U2hhZG93VmlydHF1ZXVl
ICp2aG9zdF9zdnFfbmV3KFZob3N0SU9WQVRyZWUgKmlvdmFfdHJlZSkKPiAgIHsKPiAgICAgICBn
X2F1dG9mcmVlIFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEgPSBnX25ldzAoVmhvc3RTaGFkb3dW
aXJ0cXVldWUsIDEpOwo+ICAgICAgIGludCByOwo+IEBAIC01MzksNiArNjA2LDcgQEAgVmhvc3RT
aGFkb3dWaXJ0cXVldWUgKnZob3N0X3N2cV9uZXcodm9pZCkKPiAgIAo+ICAgICAgIGV2ZW50X25v
dGlmaWVyX2luaXRfZmQoJnN2cS0+c3ZxX2tpY2ssIFZIT1NUX0ZJTEVfVU5CSU5EKTsKPiAgICAg
ICBldmVudF9ub3RpZmllcl9zZXRfaGFuZGxlcigmc3ZxLT5oZGV2X2NhbGwsIHZob3N0X3N2cV9o
YW5kbGVfY2FsbCk7Cj4gKyAgICBzdnEtPmlvdmFfdHJlZSA9IGlvdmFfdHJlZTsKPiAgICAgICBy
ZXR1cm4gZ19zdGVhbF9wb2ludGVyKCZzdnEpOwo+ICAgCj4gICBlcnJfaW5pdF9oZGV2X2NhbGw6
Cj4gZGlmZiAtLWdpdCBhL2h3L3ZpcnRpby92aG9zdC12ZHBhLmMgYi9ody92aXJ0aW8vdmhvc3Qt
dmRwYS5jCj4gaW5kZXggNDM1YjljMmU5ZS4uNTZmOWYxMjVjZCAxMDA2NDQKPiAtLS0gYS9ody92
aXJ0aW8vdmhvc3QtdmRwYS5jCj4gKysrIGIvaHcvdmlydGlvL3Zob3N0LXZkcGEuYwo+IEBAIC0y
MDksNiArMjA5LDIxIEBAIHN0YXRpYyB2b2lkIHZob3N0X3ZkcGFfbGlzdGVuZXJfcmVnaW9uX2Fk
ZChNZW1vcnlMaXN0ZW5lciAqbGlzdGVuZXIsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHZhZGRyLCBzZWN0aW9uLT5yZWFkb25seSk7Cj4gICAKPiAgICAgICBs
bHNpemUgPSBpbnQxMjhfc3ViKGxsZW5kLCBpbnQxMjhfbWFrZTY0KGlvdmEpKTsKPiArICAgIGlm
ICh2LT5zaGFkb3dfdnFzX2VuYWJsZWQpIHsKPiArICAgICAgICBETUFNYXAgbWVtX3JlZ2lvbiA9
IHsKPiArICAgICAgICAgICAgLnRyYW5zbGF0ZWRfYWRkciA9IChod2FkZHIpdmFkZHIsCj4gKyAg
ICAgICAgICAgIC5zaXplID0gaW50MTI4X2dldDY0KGxsc2l6ZSkgLSAxLAo+ICsgICAgICAgICAg
ICAucGVybSA9IElPTU1VX0FDQ0VTU19GTEFHKHRydWUsIHNlY3Rpb24tPnJlYWRvbmx5KSwKPiAr
ICAgICAgICB9Owo+ICsKPiArICAgICAgICBpbnQgciA9IHZob3N0X2lvdmFfdHJlZV9tYXBfYWxs
b2Modi0+aW92YV90cmVlLCAmbWVtX3JlZ2lvbik7Cj4gKyAgICAgICAgaWYgKHVubGlrZWx5KHIg
IT0gSU9WQV9PSykpIHsKPiArICAgICAgICAgICAgZXJyb3JfcmVwb3J0KCJDYW4ndCBhbGxvY2F0
ZSBhIG1hcHBpbmcgKCVkKSIsIHIpOwo+ICsgICAgICAgICAgICBnb3RvIGZhaWw7Cj4gKyAgICAg
ICAgfQo+ICsKPiArICAgICAgICBpb3ZhID0gbWVtX3JlZ2lvbi5pb3ZhOwo+ICsgICAgfQo+ICAg
Cj4gICAgICAgdmhvc3RfdmRwYV9pb3RsYl9iYXRjaF9iZWdpbl9vbmNlKHYpOwo+ICAgICAgIHJl
dCA9IHZob3N0X3ZkcGFfZG1hX21hcCh2LCBpb3ZhLCBpbnQxMjhfZ2V0NjQobGxzaXplKSwKPiBA
QCAtMjYxLDYgKzI3NiwyMCBAQCBzdGF0aWMgdm9pZCB2aG9zdF92ZHBhX2xpc3RlbmVyX3JlZ2lv
bl9kZWwoTWVtb3J5TGlzdGVuZXIgKmxpc3RlbmVyLAo+ICAgCj4gICAgICAgbGxzaXplID0gaW50
MTI4X3N1YihsbGVuZCwgaW50MTI4X21ha2U2NChpb3ZhKSk7Cj4gICAKPiArICAgIGlmICh2LT5z
aGFkb3dfdnFzX2VuYWJsZWQpIHsKPiArICAgICAgICBjb25zdCBETUFNYXAgKnJlc3VsdDsKPiAr
ICAgICAgICBjb25zdCB2b2lkICp2YWRkciA9IG1lbW9yeV9yZWdpb25fZ2V0X3JhbV9wdHIoc2Vj
dGlvbi0+bXIpICsKPiArICAgICAgICAgICAgc2VjdGlvbi0+b2Zmc2V0X3dpdGhpbl9yZWdpb24g
Kwo+ICsgICAgICAgICAgICAoaW92YSAtIHNlY3Rpb24tPm9mZnNldF93aXRoaW5fYWRkcmVzc19z
cGFjZSk7Cj4gKyAgICAgICAgRE1BTWFwIG1lbV9yZWdpb24gPSB7Cj4gKyAgICAgICAgICAgIC50
cmFuc2xhdGVkX2FkZHIgPSAoaHdhZGRyKXZhZGRyLAo+ICsgICAgICAgICAgICAuc2l6ZSA9IGlu
dDEyOF9nZXQ2NChsbHNpemUpIC0gMSwKPiArICAgICAgICB9Owo+ICsKPiArICAgICAgICByZXN1
bHQgPSB2aG9zdF9pb3ZhX3RyZWVfZmluZF9pb3ZhKHYtPmlvdmFfdHJlZSwgJm1lbV9yZWdpb24p
Owo+ICsgICAgICAgIGlvdmEgPSByZXN1bHQtPmlvdmE7Cj4gKyAgICAgICAgdmhvc3RfaW92YV90
cmVlX3JlbW92ZSh2LT5pb3ZhX3RyZWUsICZtZW1fcmVnaW9uKTsKPiArICAgIH0KPiAgICAgICB2
aG9zdF92ZHBhX2lvdGxiX2JhdGNoX2JlZ2luX29uY2Uodik7Cj4gICAgICAgcmV0ID0gdmhvc3Rf
dmRwYV9kbWFfdW5tYXAodiwgaW92YSwgaW50MTI4X2dldDY0KGxsc2l6ZSkpOwo+ICAgICAgIGlm
IChyZXQpIHsKPiBAQCAtMzgzLDcgKzQxMiw3IEBAIHN0YXRpYyBpbnQgdmhvc3RfdmRwYV9pbml0
X3N2cShzdHJ1Y3Qgdmhvc3RfZGV2ICpoZGV2LCBzdHJ1Y3Qgdmhvc3RfdmRwYSAqdiwKPiAgIAo+
ICAgICAgIHNoYWRvd192cXMgPSBnX3B0cl9hcnJheV9uZXdfZnVsbChoZGV2LT5udnFzLCB2aG9z
dF9zdnFfZnJlZSk7Cj4gICAgICAgZm9yICh1bnNpZ25lZCBuID0gMDsgbiA8IGhkZXYtPm52cXM7
ICsrbikgewo+IC0gICAgICAgIGdfYXV0b3B0cihWaG9zdFNoYWRvd1ZpcnRxdWV1ZSkgc3ZxID0g
dmhvc3Rfc3ZxX25ldygpOwo+ICsgICAgICAgIGdfYXV0b3B0cihWaG9zdFNoYWRvd1ZpcnRxdWV1
ZSkgc3ZxID0gdmhvc3Rfc3ZxX25ldyh2LT5pb3ZhX3RyZWUpOwo+ICAgCj4gICAgICAgICAgIGlm
ICh1bmxpa2VseSghc3ZxKSkgewo+ICAgICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiQ2Fu
bm90IGNyZWF0ZSBzdnEgJXUiLCBuKTsKPiBAQCAtODM0LDM3ICs4NjMsNzggQEAgc3RhdGljIGlu
dCB2aG9zdF92ZHBhX3N2cV9zZXRfZmRzKHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPiAgIC8qKgo+
ICAgICogVW5tYXAgYSBTVlEgYXJlYSBpbiB0aGUgZGV2aWNlCj4gICAgKi8KPiAtc3RhdGljIGJv
b2wgdmhvc3RfdmRwYV9zdnFfdW5tYXBfcmluZyhzdHJ1Y3Qgdmhvc3RfdmRwYSAqdiwgaHdhZGRy
IGlvdmEsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHdhZGRyIHNp
emUpCj4gK3N0YXRpYyBib29sIHZob3N0X3ZkcGFfc3ZxX3VubWFwX3Jpbmcoc3RydWN0IHZob3N0
X3ZkcGEgKnYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qg
RE1BTWFwICpuZWVkbGUpCj4gICB7Cj4gKyAgICBjb25zdCBETUFNYXAgKnJlc3VsdCA9IHZob3N0
X2lvdmFfdHJlZV9maW5kX2lvdmEodi0+aW92YV90cmVlLCBuZWVkbGUpOwo+ICsgICAgaHdhZGRy
IHNpemU7Cj4gICAgICAgaW50IHI7Cj4gICAKPiAtICAgIHNpemUgPSBST1VORF9VUChzaXplLCBx
ZW11X3JlYWxfaG9zdF9wYWdlX3NpemUpOwo+IC0gICAgciA9IHZob3N0X3ZkcGFfZG1hX3VubWFw
KHYsIGlvdmEsIHNpemUpOwo+ICsgICAgaWYgKHVubGlrZWx5KCFyZXN1bHQpKSB7Cj4gKyAgICAg
ICAgZXJyb3JfcmVwb3J0KCJVbmFibGUgdG8gZmluZCBTVlEgYWRkcmVzcyB0byB1bm1hcCIpOwo+
ICsgICAgICAgIHJldHVybiBmYWxzZTsKPiArICAgIH0KPiArCj4gKyAgICBzaXplID0gUk9VTkRf
VVAocmVzdWx0LT5zaXplLCBxZW11X3JlYWxfaG9zdF9wYWdlX3NpemUpOwo+ICsgICAgciA9IHZo
b3N0X3ZkcGFfZG1hX3VubWFwKHYsIHJlc3VsdC0+aW92YSwgc2l6ZSk7Cj4gICAgICAgcmV0dXJu
IHIgPT0gMDsKPiAgIH0KPiAgIAo+ICAgc3RhdGljIGJvb2wgdmhvc3RfdmRwYV9zdnFfdW5tYXBf
cmluZ3Moc3RydWN0IHZob3N0X2RldiAqZGV2LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY29uc3QgVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSkKPiAgIHsKPiAr
ICAgIERNQU1hcCBuZWVkbGU7Cj4gICAgICAgc3RydWN0IHZob3N0X3ZkcGEgKnYgPSBkZXYtPm9w
YXF1ZTsKPiAgICAgICBzdHJ1Y3Qgdmhvc3RfdnJpbmdfYWRkciBzdnFfYWRkcjsKPiAtICAgIHNp
emVfdCBkZXZpY2Vfc2l6ZSA9IHZob3N0X3N2cV9kZXZpY2VfYXJlYV9zaXplKHN2cSk7Cj4gLSAg
ICBzaXplX3QgZHJpdmVyX3NpemUgPSB2aG9zdF9zdnFfZHJpdmVyX2FyZWFfc2l6ZShzdnEpOwo+
ICAgICAgIGJvb2wgb2s7Cj4gICAKPiAgICAgICB2aG9zdF9zdnFfZ2V0X3ZyaW5nX2FkZHIoc3Zx
LCAmc3ZxX2FkZHIpOwo+ICAgCj4gLSAgICBvayA9IHZob3N0X3ZkcGFfc3ZxX3VubWFwX3Jpbmco
diwgc3ZxX2FkZHIuZGVzY191c2VyX2FkZHIsIGRyaXZlcl9zaXplKTsKPiArICAgIG5lZWRsZSA9
IChETUFNYXApIHsKPiArICAgICAgICAudHJhbnNsYXRlZF9hZGRyID0gc3ZxX2FkZHIuZGVzY191
c2VyX2FkZHIsCj4gKyAgICB9OwoKCkxldCdzIHNpbXBseSBpbml0aWFsaXplIHRoZSBtZW1iZXIg
dG8gemVybyBkdXJpbmcgc3RhcnQgb2YgdGhpcyBmdW5jdGlvbiAKdGhlbiB3ZSBjYW4gdXNlIG5l
ZWRsZS0+dHJhbnNhbHRlZF9hZGRyID0gWFhYIGhlcmUuCgoKPiArICAgIG9rID0gdmhvc3RfdmRw
YV9zdnFfdW5tYXBfcmluZyh2LCAmbmVlZGxlKTsKPiAgICAgICBpZiAodW5saWtlbHkoIW9rKSkg
ewo+ICAgICAgICAgICByZXR1cm4gZmFsc2U7Cj4gICAgICAgfQo+ICAgCj4gLSAgICByZXR1cm4g
dmhvc3RfdmRwYV9zdnFfdW5tYXBfcmluZyh2LCBzdnFfYWRkci51c2VkX3VzZXJfYWRkciwgZGV2
aWNlX3NpemUpOwo+ICsgICAgbmVlZGxlID0gKERNQU1hcCkgewo+ICsgICAgICAgIC50cmFuc2xh
dGVkX2FkZHIgPSBzdnFfYWRkci51c2VkX3VzZXJfYWRkciwKPiArICAgIH07Cj4gKyAgICByZXR1
cm4gdmhvc3RfdmRwYV9zdnFfdW5tYXBfcmluZyh2LCAmbmVlZGxlKTsKPiArfQo+ICsKPiArLyoq
Cj4gKyAqIE1hcCB0aGUgU1ZRIGFyZWEgaW4gdGhlIGRldmljZQo+ICsgKgo+ICsgKiBAdiAgICAg
ICAgICBWaG9zdC12ZHBhIGRldmljZQo+ICsgKiBAbmVlZGxlICAgICBUaGUgYXJlYSB0byBzZWFy
Y2ggaW92YQo+ICsgKiBAZXJyb3JwICAgICBFcnJvciBwb2ludGVyCj4gKyAqLwo+ICtzdGF0aWMg
Ym9vbCB2aG9zdF92ZHBhX3N2cV9tYXBfcmluZyhzdHJ1Y3Qgdmhvc3RfdmRwYSAqdiwgRE1BTWFw
ICpuZWVkbGUsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoq
ZXJycCkKPiArewo+ICsgICAgaW50IHI7Cj4gKwo+ICsgICAgciA9IHZob3N0X2lvdmFfdHJlZV9t
YXBfYWxsb2Modi0+aW92YV90cmVlLCBuZWVkbGUpOwo+ICsgICAgaWYgKHVubGlrZWx5KHIgIT0g
SU9WQV9PSykpIHsKPiArICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJDYW5ub3QgYWxsb2NhdGUg
aW92YSAoJWQpIiwgcik7Cj4gKyAgICAgICAgcmV0dXJuIGZhbHNlOwo+ICsgICAgfQo+ICsKPiAr
ICAgIHIgPSB2aG9zdF92ZHBhX2RtYV9tYXAodiwgbmVlZGxlLT5pb3ZhLCBuZWVkbGUtPnNpemUs
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICh2b2lkICopbmVlZGxlLT50cmFuc2xhdGVk
X2FkZHIsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICEobmVlZGxlLT5wZXJtICYgSU9N
TVVfQUNDRVNTX0ZMQUcoMCwgMSkpKTsKCgpMZXQncyBzaW1wbHkgdXNlIG5lZWRsZS0+cGVybSA9
PSBJT01NVV9STyBoZXJlPwoKCj4gKyAgICBpZiAodW5saWtlbHkociAhPSAwKSkgewo+ICsgICAg
ICAgIGVycm9yX3NldGdfZXJybm8oZXJycCwgLXIsICJDYW5ub3QgbWFwIHJlZ2lvbiB0byBkZXZp
Y2UiKTsKPiArICAgICAgICB2aG9zdF9pb3ZhX3RyZWVfcmVtb3ZlKHYtPmlvdmFfdHJlZSwgbmVl
ZGxlKTsKPiArICAgIH0KPiArCj4gKyAgICByZXR1cm4gciA9PSAwOwo+ICAgfQo+ICAgCj4gICAv
KioKPiAtICogTWFwIHNoYWRvdyB2aXJ0cXVldWUgcmluZ3MgaW4gZGV2aWNlCj4gKyAqIE1hcCB0
aGUgc2hhZG93IHZpcnRxdWV1ZSByaW5ncyBpbiB0aGUgZGV2aWNlCj4gICAgKgo+ICAgICogQGRl
diAgIFRoZSB2aG9zdCBkZXZpY2UKPiAgICAqIEBzdnEgICBUaGUgc2hhZG93IHZpcnRxdWV1ZQo+
IEBAIC04NzYsMjggKzk0Niw0NCBAQCBzdGF0aWMgYm9vbCB2aG9zdF92ZHBhX3N2cV9tYXBfcmlu
Z3Moc3RydWN0IHZob3N0X2RldiAqZGV2LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0cnVjdCB2aG9zdF92cmluZ19hZGRyICphZGRyLAo+ICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yICoqZXJycCkKPiAgIHsKPiArICAgIERNQU1h
cCBkZXZpY2VfcmVnaW9uLCBkcml2ZXJfcmVnaW9uOwo+ICsgICAgc3RydWN0IHZob3N0X3ZyaW5n
X2FkZHIgc3ZxX2FkZHI7Cj4gICAgICAgc3RydWN0IHZob3N0X3ZkcGEgKnYgPSBkZXYtPm9wYXF1
ZTsKPiAgICAgICBzaXplX3QgZGV2aWNlX3NpemUgPSB2aG9zdF9zdnFfZGV2aWNlX2FyZWFfc2l6
ZShzdnEpOwo+ICAgICAgIHNpemVfdCBkcml2ZXJfc2l6ZSA9IHZob3N0X3N2cV9kcml2ZXJfYXJl
YV9zaXplKHN2cSk7Cj4gLSAgICBpbnQgcjsKPiArICAgIHNpemVfdCBhdmFpbF9vZmZzZXQ7Cj4g
KyAgICBib29sIG9rOwo+ICAgCj4gICAgICAgRVJSUF9HVUFSRCgpOwo+IC0gICAgdmhvc3Rfc3Zx
X2dldF92cmluZ19hZGRyKHN2cSwgYWRkcik7Cj4gKyAgICB2aG9zdF9zdnFfZ2V0X3ZyaW5nX2Fk
ZHIoc3ZxLCAmc3ZxX2FkZHIpOwo+ICAgCj4gLSAgICByID0gdmhvc3RfdmRwYV9kbWFfbWFwKHYs
IGFkZHItPmRlc2NfdXNlcl9hZGRyLCBkcml2ZXJfc2l6ZSwKPiAtICAgICAgICAgICAgICAgICAg
ICAgICAgICAgKHZvaWQgKilhZGRyLT5kZXNjX3VzZXJfYWRkciwgdHJ1ZSk7Cj4gLSAgICBpZiAo
dW5saWtlbHkociAhPSAwKSkgewo+IC0gICAgICAgIGVycm9yX3NldGdfZXJybm8oZXJycCwgLXIs
ICJDYW5ub3QgY3JlYXRlIHZxIGRyaXZlciByZWdpb246ICIpOwo+ICsgICAgZHJpdmVyX3JlZ2lv
biA9IChETUFNYXApIHsKPiArICAgICAgICAudHJhbnNsYXRlZF9hZGRyID0gc3ZxX2FkZHIuZGVz
Y191c2VyX2FkZHIsCj4gKyAgICAgICAgLnNpemUgPSBkcml2ZXJfc2l6ZSAtIDEsCgoKQW55IHJl
YXNvbiBmb3IgdGhlICItMSIgaGVyZT8gSSBzZWUgc2V2ZXJhbCBwbGFjZXMgZG8gdGhpbmdzIGxp
a2UgdGhhdCwgCml0J3MgcHJvYmFibHkgaGludCBvZiB3cm9uZyBBUEkgc29tZWh3ZXJlLgoKVGhh
bmtzCgoKPiArICAgICAgICAucGVybSA9IElPTU1VX1JPLAo+ICsgICAgfTsKPiArICAgIG9rID0g
dmhvc3RfdmRwYV9zdnFfbWFwX3JpbmcodiwgJmRyaXZlcl9yZWdpb24sIGVycnApOwo+ICsgICAg
aWYgKHVubGlrZWx5KCFvaykpIHsKPiArICAgICAgICBlcnJvcl9wcmVwZW5kKGVycnAsICJDYW5u
b3QgY3JlYXRlIHZxIGRyaXZlciByZWdpb246ICIpOwo+ICAgICAgICAgICByZXR1cm4gZmFsc2U7
Cj4gICAgICAgfQo+ICsgICAgYWRkci0+ZGVzY191c2VyX2FkZHIgPSBkcml2ZXJfcmVnaW9uLmlv
dmE7Cj4gKyAgICBhdmFpbF9vZmZzZXQgPSBzdnFfYWRkci5hdmFpbF91c2VyX2FkZHIgLSBzdnFf
YWRkci5kZXNjX3VzZXJfYWRkcjsKPiArICAgIGFkZHItPmF2YWlsX3VzZXJfYWRkciA9IGRyaXZl
cl9yZWdpb24uaW92YSArIGF2YWlsX29mZnNldDsKPiAgIAo+IC0gICAgciA9IHZob3N0X3ZkcGFf
ZG1hX21hcCh2LCBhZGRyLT51c2VkX3VzZXJfYWRkciwgZGV2aWNlX3NpemUsCj4gLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICh2b2lkICopYWRkci0+dXNlZF91c2VyX2FkZHIsIGZhbHNlKTsK
PiAtICAgIGlmICh1bmxpa2VseShyICE9IDApKSB7Cj4gLSAgICAgICAgZXJyb3Jfc2V0Z19lcnJu
byhlcnJwLCAtciwgIkNhbm5vdCBjcmVhdGUgdnEgZGV2aWNlIHJlZ2lvbjogIik7Cj4gKyAgICBk
ZXZpY2VfcmVnaW9uID0gKERNQU1hcCkgewo+ICsgICAgICAgIC50cmFuc2xhdGVkX2FkZHIgPSBz
dnFfYWRkci51c2VkX3VzZXJfYWRkciwKPiArICAgICAgICAuc2l6ZSA9IGRldmljZV9zaXplIC0g
MSwKPiArICAgICAgICAucGVybSA9IElPTU1VX1JXLAo+ICsgICAgfTsKPiArICAgIG9rID0gdmhv
c3RfdmRwYV9zdnFfbWFwX3JpbmcodiwgJmRldmljZV9yZWdpb24sIGVycnApOwo+ICsgICAgaWYg
KHVubGlrZWx5KCFvaykpIHsKPiArICAgICAgICBlcnJvcl9wcmVwZW5kKGVycnAsICJDYW5ub3Qg
Y3JlYXRlIHZxIGRldmljZSByZWdpb246ICIpOwo+ICsgICAgICAgIHZob3N0X3ZkcGFfc3ZxX3Vu
bWFwX3JpbmcodiwgJmRyaXZlcl9yZWdpb24pOwo+ICAgICAgIH0KPiArICAgIGFkZHItPnVzZWRf
dXNlcl9hZGRyID0gZGV2aWNlX3JlZ2lvbi5pb3ZhOwo+ICAgCj4gLSAgICByZXR1cm4gciA9PSAw
Owo+ICsgICAgcmV0dXJuIG9rOwo+ICAgfQo+ICAgCj4gICBzdGF0aWMgYm9vbCB2aG9zdF92ZHBh
X3N2cV9zZXR1cChzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYsCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmly
dHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51
eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
