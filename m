Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id 47D5D1ECB23
	for <lists.virtualization@lfdr.de>; Wed,  3 Jun 2020 10:12:13 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id C2D14883B2;
	Wed,  3 Jun 2020 08:12:11 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id g5Rcof1BlwSe; Wed,  3 Jun 2020 08:12:10 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 9FA4788353;
	Wed,  3 Jun 2020 08:12:10 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 6CAC0C0895;
	Wed,  3 Jun 2020 08:12:10 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 24ABFC016E
 for <virtualization@lists.linux-foundation.org>;
 Wed,  3 Jun 2020 08:12:09 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id E3A5C2046B
 for <virtualization@lists.linux-foundation.org>;
 Wed,  3 Jun 2020 08:12:08 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id qeA6rrFaQGK7
 for <virtualization@lists.linux-foundation.org>;
 Wed,  3 Jun 2020 08:12:05 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from us-smtp-delivery-1.mimecast.com (us-smtp-2.mimecast.com
 [205.139.110.61])
 by silver.osuosl.org (Postfix) with ESMTPS id 6A1412076E
 for <virtualization@lists.linux-foundation.org>;
 Wed,  3 Jun 2020 08:12:05 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1591171924;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=X5AGs91ycnlrMlMg2jQjs6F4ueBE6DpTuUWVLp4DEo4=;
 b=Xq0TpyfU51i9znenrca+peZWIf/aUgMnkvLP/ZS32vEXex/fJd9OZl2wZvSBvfmj7j9rLT
 0yZ4xxAvrLzbiRpQKAehfHl5ITd2qftjnHlTZmiw6WyRheGeZ/RNDuAqvIsQ0tpPnfS2WZ
 ytcLFZpZhf4Ch4d+fn7XDCmBosT/xsE=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-144-n4JIVISvNo-J5F96L-1m8A-1; Wed, 03 Jun 2020 04:12:02 -0400
X-MC-Unique: n4JIVISvNo-J5F96L-1m8A-1
Received: from smtp.corp.redhat.com (int-mx01.intmail.prod.int.phx2.redhat.com
 [10.5.11.11])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 2DC6E80058E;
 Wed,  3 Jun 2020 08:12:01 +0000 (UTC)
Received: from [10.72.12.214] (ovpn-12-214.pek2.redhat.com [10.72.12.214])
 by smtp.corp.redhat.com (Postfix) with ESMTP id D2345512E7;
 Wed,  3 Jun 2020 08:11:55 +0000 (UTC)
Subject: Re: [PATCH RFC 08/13] vhost/net: convert to new API: heads->bufs
To: "Michael S. Tsirkin" <mst@redhat.com>, linux-kernel@vger.kernel.org
References: <20200602130543.578420-1-mst@redhat.com>
 <20200602130543.578420-9-mst@redhat.com>
From: Jason Wang <jasowang@redhat.com>
Message-ID: <8e5c4e5d-9729-2458-893d-a767b758e7ef@redhat.com>
Date: Wed, 3 Jun 2020 16:11:54 +0800
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.8.0
MIME-Version: 1.0
In-Reply-To: <20200602130543.578420-9-mst@redhat.com>
Content-Language: en-US
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.11
Cc: =?UTF-8?Q?Eugenio_P=c3=a9rez?= <eperezma@redhat.com>,
 netdev@vger.kernel.org, kvm@vger.kernel.org,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

Ck9uIDIwMjAvNi8yIOS4i+WNiDk6MDYsIE1pY2hhZWwgUy4gVHNpcmtpbiB3cm90ZToKPiBDb252
ZXJ0IHZob3N0IG5ldCB0byB1c2UgdGhlIG5ldyBmb3JtYXQtYWdub3N0aWMgQVBJLgo+IEluIHBh
cnRpY3VsYXIsIGRvbid0IHBva2UgYXQgdnEgaW50ZXJuYWxzIHN1Y2ggYXMgdGhlCj4gaGVhZHMg
YXJyYXkuCj4KPiBTaWduZWQtb2ZmLWJ5OiBNaWNoYWVsIFMuIFRzaXJraW4gPG1zdEByZWRoYXQu
Y29tPgo+IC0tLQo+ICAgZHJpdmVycy92aG9zdC9uZXQuYyB8IDE1MyArKysrKysrKysrKysrKysr
KysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLQo+ICAgMSBmaWxlIGNoYW5nZWQsIDgxIGluc2Vy
dGlvbnMoKyksIDcyIGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmhvc3Qv
bmV0LmMgYi9kcml2ZXJzL3Zob3N0L25ldC5jCj4gaW5kZXggNzQ5YTljZjUxYTU5Li40N2FmM2Qx
Y2UzZGQgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy92aG9zdC9uZXQuYwo+ICsrKyBiL2RyaXZlcnMv
dmhvc3QvbmV0LmMKPiBAQCAtNTksMTMgKzU5LDEzIEBAIE1PRFVMRV9QQVJNX0RFU0MoZXhwZXJp
bWVudGFsX3pjb3B5dHgsICJFbmFibGUgWmVybyBDb3B5IFRYOyIKPiAgICAqIHN0YXR1cyBpbnRl
cm5hbGx5OyB1c2VkIGZvciB6ZXJvY29weSB0eCBvbmx5Lgo+ICAgICovCj4gICAvKiBMb3dlciBk
ZXZpY2UgRE1BIGZhaWxlZCAqLwo+IC0jZGVmaW5lIFZIT1NUX0RNQV9GQUlMRURfTEVOCSgoX19m
b3JjZSBfX3ZpcnRpbzMyKTMpCj4gKyNkZWZpbmUgVkhPU1RfRE1BX0ZBSUxFRF9MRU4JKDMpCj4g
ICAvKiBMb3dlciBkZXZpY2UgRE1BIGRvbmUgKi8KPiAtI2RlZmluZSBWSE9TVF9ETUFfRE9ORV9M
RU4JKChfX2ZvcmNlIF9fdmlydGlvMzIpMikKPiArI2RlZmluZSBWSE9TVF9ETUFfRE9ORV9MRU4J
KDIpCj4gICAvKiBMb3dlciBkZXZpY2UgRE1BIGluIHByb2dyZXNzICovCj4gLSNkZWZpbmUgVkhP
U1RfRE1BX0lOX1BST0dSRVNTCSgoX19mb3JjZSBfX3ZpcnRpbzMyKTEpCj4gKyNkZWZpbmUgVkhP
U1RfRE1BX0lOX1BST0dSRVNTCSgxKQo+ICAgLyogQnVmZmVyIHVudXNlZCAqLwo+IC0jZGVmaW5l
IFZIT1NUX0RNQV9DTEVBUl9MRU4JKChfX2ZvcmNlIF9fdmlydGlvMzIpMCkKPiArI2RlZmluZSBW
SE9TVF9ETUFfQ0xFQVJfTEVOCSgwKQoKCkFub3RoZXIgcGF0Y2ggZm9yIHRoaXM/CgoKPiAgIAo+
ICAgI2RlZmluZSBWSE9TVF9ETUFfSVNfRE9ORShsZW4pICgoX19mb3JjZSB1MzIpKGxlbikgPj0g
KF9fZm9yY2UgdTMyKVZIT1NUX0RNQV9ET05FX0xFTikKPiAgIAo+IEBAIC0xMTIsOSArMTEyLDEy
IEBAIHN0cnVjdCB2aG9zdF9uZXRfdmlydHF1ZXVlIHsKPiAgIAkvKiBsYXN0IHVzZWQgaWR4IGZv
ciBvdXRzdGFuZGluZyBETUEgemVyb2NvcHkgYnVmZmVycyAqLwo+ICAgCWludCB1cGVuZF9pZHg7
Cj4gICAJLyogRm9yIFRYLCBmaXJzdCB1c2VkIGlkeCBmb3IgRE1BIGRvbmUgemVyb2NvcHkgYnVm
ZmVycwo+IC0JICogRm9yIFJYLCBudW1iZXIgb2YgYmF0Y2hlZCBoZWFkcwo+ICsJICogRm9yIFJY
LCBudW1iZXIgb2YgYmF0Y2hlZCBidWZzCj4gICAJICovCj4gICAJaW50IGRvbmVfaWR4Owo+ICsJ
LyogT3V0c3RhbmRpbmcgdXNlciBidWZzLiBVSU9fTUFYSU9WIGluIGxlbmd0aC4gKi8KPiArCS8q
IFRPRE86IHdlIGNhbiBtYWtlIHRoaXMgc21hbGxlciBmb3Igc3VyZS4gKi8KPiArCXN0cnVjdCB2
aG9zdF9idWYgKmJ1ZnM7Cj4gICAJLyogTnVtYmVyIG9mIFhEUCBmcmFtZXMgYmF0Y2hlZCAqLwo+
ICAgCWludCBiYXRjaGVkX3hkcDsKPiAgIAkvKiBhbiBhcnJheSBvZiB1c2Vyc3BhY2UgYnVmZmVy
cyBpbmZvICovCj4gQEAgLTI3MSw2ICsyNzQsOCBAQCBzdGF0aWMgdm9pZCB2aG9zdF9uZXRfY2xl
YXJfdWJ1Zl9pbmZvKHN0cnVjdCB2aG9zdF9uZXQgKm4pCj4gICAJaW50IGk7Cj4gICAKPiAgIAlm
b3IgKGkgPSAwOyBpIDwgVkhPU1RfTkVUX1ZRX01BWDsgKytpKSB7Cj4gKwkJa2ZyZWUobi0+dnFz
W2ldLmJ1ZnMpOwo+ICsJCW4tPnZxc1tpXS5idWZzID0gTlVMTDsKPiAgIAkJa2ZyZWUobi0+dnFz
W2ldLnVidWZfaW5mbyk7Cj4gICAJCW4tPnZxc1tpXS51YnVmX2luZm8gPSBOVUxMOwo+ICAgCX0K
PiBAQCAtMjgyLDYgKzI4NywxMiBAQCBzdGF0aWMgaW50IHZob3N0X25ldF9zZXRfdWJ1Zl9pbmZv
KHN0cnVjdCB2aG9zdF9uZXQgKm4pCj4gICAJaW50IGk7Cj4gICAKPiAgIAlmb3IgKGkgPSAwOyBp
IDwgVkhPU1RfTkVUX1ZRX01BWDsgKytpKSB7Cj4gKwkJbi0+dnFzW2ldLmJ1ZnMgPSBrbWFsbG9j
X2FycmF5KFVJT19NQVhJT1YsCj4gKwkJCQkJICAgICAgIHNpemVvZigqbi0+dnFzW2ldLmJ1ZnMp
LAo+ICsJCQkJCSAgICAgICBHRlBfS0VSTkVMKTsKPiArCQlpZiAoIW4tPnZxc1tpXS5idWZzKQo+
ICsJCQlnb3RvIGVycjsKPiArCj4gICAJCXpjb3B5ID0gdmhvc3RfbmV0X3pjb3B5X21hc2sgJiAo
MHgxIDw8IGkpOwo+ICAgCQlpZiAoIXpjb3B5KQo+ICAgCQkJY29udGludWU7Cj4gQEAgLTM2NCwx
OCArMzc1LDE4IEBAIHN0YXRpYyB2b2lkIHZob3N0X3plcm9jb3B5X3NpZ25hbF91c2VkKHN0cnVj
dCB2aG9zdF9uZXQgKm5ldCwKPiAgIAlpbnQgaiA9IDA7Cj4gICAKPiAgIAlmb3IgKGkgPSBudnEt
PmRvbmVfaWR4OyBpICE9IG52cS0+dXBlbmRfaWR4OyBpID0gKGkgKyAxKSAlIFVJT19NQVhJT1Yp
IHsKPiAtCQlpZiAodnEtPmhlYWRzW2ldLmxlbiA9PSBWSE9TVF9ETUFfRkFJTEVEX0xFTikKPiAr
CQlpZiAobnZxLT5idWZzW2ldLmluX2xlbiA9PSBWSE9TVF9ETUFfRkFJTEVEX0xFTikKPiAgIAkJ
CXZob3N0X25ldF90eF9lcnIobmV0KTsKPiAtCQlpZiAoVkhPU1RfRE1BX0lTX0RPTkUodnEtPmhl
YWRzW2ldLmxlbikpIHsKPiAtCQkJdnEtPmhlYWRzW2ldLmxlbiA9IFZIT1NUX0RNQV9DTEVBUl9M
RU47Cj4gKwkJaWYgKFZIT1NUX0RNQV9JU19ET05FKG52cS0+YnVmc1tpXS5pbl9sZW4pKSB7Cj4g
KwkJCW52cS0+YnVmc1tpXS5pbl9sZW4gPSBWSE9TVF9ETUFfQ0xFQVJfTEVOOwo+ICAgCQkJKytq
Owo+ICAgCQl9IGVsc2UKPiAgIAkJCWJyZWFrOwo+ICAgCX0KPiAgIAl3aGlsZSAoaikgewo+ICAg
CQlhZGQgPSBtaW4oVUlPX01BWElPViAtIG52cS0+ZG9uZV9pZHgsIGopOwo+IC0JCXZob3N0X2Fk
ZF91c2VkX2FuZF9zaWduYWxfbih2cS0+ZGV2LCB2cSwKPiAtCQkJCQkgICAgJnZxLT5oZWFkc1tu
dnEtPmRvbmVfaWR4XSwgYWRkKTsKPiArCQl2aG9zdF9wdXRfdXNlZF9uX2J1ZnModnEsICZudnEt
PmJ1ZnNbbnZxLT5kb25lX2lkeF0sIGFkZCk7Cj4gKwkJdmhvc3Rfc2lnbmFsKHZxLT5kZXYsIHZx
KTsKPiAgIAkJbnZxLT5kb25lX2lkeCA9IChudnEtPmRvbmVfaWR4ICsgYWRkKSAlIFVJT19NQVhJ
T1Y7Cj4gICAJCWogLT0gYWRkOwo+ICAgCX0KPiBAQCAtMzkwLDcgKzQwMSw3IEBAIHN0YXRpYyB2
b2lkIHZob3N0X3plcm9jb3B5X2NhbGxiYWNrKHN0cnVjdCB1YnVmX2luZm8gKnVidWYsIGJvb2wg
c3VjY2VzcykKPiAgIAlyY3VfcmVhZF9sb2NrX2JoKCk7Cj4gICAKPiAgIAkvKiBzZXQgbGVuIHRv
IG1hcmsgdGhpcyBkZXNjIGJ1ZmZlcnMgZG9uZSBETUEgKi8KPiAtCW52cS0+dnEuaGVhZHNbdWJ1
Zi0+ZGVzY10uaW5fbGVuID0gc3VjY2VzcyA/Cj4gKwludnEtPmJ1ZnNbdWJ1Zi0+ZGVzY10uaW5f
bGVuID0gc3VjY2VzcyA/Cj4gICAJCVZIT1NUX0RNQV9ET05FX0xFTiA6IFZIT1NUX0RNQV9GQUlM
RURfTEVOOwo+ICAgCWNudCA9IHZob3N0X25ldF91YnVmX3B1dCh1YnVmcyk7Cj4gICAKPiBAQCAt
NDUyLDcgKzQ2Myw4IEBAIHN0YXRpYyB2b2lkIHZob3N0X25ldF9zaWduYWxfdXNlZChzdHJ1Y3Qg
dmhvc3RfbmV0X3ZpcnRxdWV1ZSAqbnZxKQo+ICAgCWlmICghbnZxLT5kb25lX2lkeCkKPiAgIAkJ
cmV0dXJuOwo+ICAgCj4gLQl2aG9zdF9hZGRfdXNlZF9hbmRfc2lnbmFsX24oZGV2LCB2cSwgdnEt
PmhlYWRzLCBudnEtPmRvbmVfaWR4KTsKPiArCXZob3N0X3B1dF91c2VkX25fYnVmcyh2cSwgbnZx
LT5idWZzLCBudnEtPmRvbmVfaWR4KTsKPiArCXZob3N0X3NpZ25hbChkZXYsIHZxKTsKPiAgIAlu
dnEtPmRvbmVfaWR4ID0gMDsKPiAgIH0KPiAgIAo+IEBAIC01NTgsNiArNTcwLDcgQEAgc3RhdGlj
IHZvaWQgdmhvc3RfbmV0X2J1c3lfcG9sbChzdHJ1Y3Qgdmhvc3RfbmV0ICpuZXQsCj4gICAKPiAg
IHN0YXRpYyBpbnQgdmhvc3RfbmV0X3R4X2dldF92cV9kZXNjKHN0cnVjdCB2aG9zdF9uZXQgKm5l
dCwKPiAgIAkJCQkgICAgc3RydWN0IHZob3N0X25ldF92aXJ0cXVldWUgKnRudnEsCj4gKwkJCQkg
ICAgc3RydWN0IHZob3N0X2J1ZiAqYnVmLAo+ICAgCQkJCSAgICB1bnNpZ25lZCBpbnQgKm91dF9u
dW0sIHVuc2lnbmVkIGludCAqaW5fbnVtLAo+ICAgCQkJCSAgICBzdHJ1Y3QgbXNnaGRyICptc2do
ZHIsIGJvb2wgKmJ1c3lsb29wX2ludHIpCj4gICB7Cj4gQEAgLTU2NSwxMCArNTc4LDEwIEBAIHN0
YXRpYyBpbnQgdmhvc3RfbmV0X3R4X2dldF92cV9kZXNjKHN0cnVjdCB2aG9zdF9uZXQgKm5ldCwK
PiAgIAlzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICpydnEgPSAmcm52cS0+dnE7Cj4gICAJc3RydWN0
IHZob3N0X3ZpcnRxdWV1ZSAqdHZxID0gJnRudnEtPnZxOwo+ICAgCj4gLQlpbnQgciA9IHZob3N0
X2dldF92cV9kZXNjKHR2cSwgdHZxLT5pb3YsIEFSUkFZX1NJWkUodHZxLT5pb3YpLAo+IC0JCQkJ
ICBvdXRfbnVtLCBpbl9udW0sIE5VTEwsIE5VTEwpOwo+ICsJaW50IHIgPSB2aG9zdF9nZXRfYXZh
aWxfYnVmKHR2cSwgYnVmLCB0dnEtPmlvdiwgQVJSQVlfU0laRSh0dnEtPmlvdiksCj4gKwkJCQkg
ICAgb3V0X251bSwgaW5fbnVtLCBOVUxMLCBOVUxMKTsKPiAgIAo+IC0JaWYgKHIgPT0gdHZxLT5u
dW0gJiYgdHZxLT5idXN5bG9vcF90aW1lb3V0KSB7Cj4gKwlpZiAoIXIgJiYgdHZxLT5idXN5bG9v
cF90aW1lb3V0KSB7Cj4gICAJCS8qIEZsdXNoIGJhdGNoZWQgcGFja2V0cyBmaXJzdCAqLwo+ICAg
CQlpZiAoIXZob3N0X3NvY2tfemNvcHkodmhvc3RfdnFfZ2V0X2JhY2tlbmQodHZxKSkpCj4gICAJ
CQl2aG9zdF90eF9iYXRjaChuZXQsIHRudnEsCj4gQEAgLTU3Nyw4ICs1OTAsOCBAQCBzdGF0aWMg
aW50IHZob3N0X25ldF90eF9nZXRfdnFfZGVzYyhzdHJ1Y3Qgdmhvc3RfbmV0ICpuZXQsCj4gICAK
PiAgIAkJdmhvc3RfbmV0X2J1c3lfcG9sbChuZXQsIHJ2cSwgdHZxLCBidXN5bG9vcF9pbnRyLCBm
YWxzZSk7Cj4gICAKPiAtCQlyID0gdmhvc3RfZ2V0X3ZxX2Rlc2ModHZxLCB0dnEtPmlvdiwgQVJS
QVlfU0laRSh0dnEtPmlvdiksCj4gLQkJCQkgICAgICBvdXRfbnVtLCBpbl9udW0sIE5VTEwsIE5V
TEwpOwo+ICsJCXIgPSB2aG9zdF9nZXRfYXZhaWxfYnVmKHR2cSwgYnVmLCB0dnEtPmlvdiwgQVJS
QVlfU0laRSh0dnEtPmlvdiksCj4gKwkJCQkJb3V0X251bSwgaW5fbnVtLCBOVUxMLCBOVUxMKTsK
PiAgIAl9Cj4gICAKPiAgIAlyZXR1cm4gcjsKPiBAQCAtNjA3LDYgKzYyMCw3IEBAIHN0YXRpYyBz
aXplX3QgaW5pdF9pb3ZfaXRlcihzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSwgc3RydWN0IGlv
dl9pdGVyICppdGVyLAo+ICAgCj4gICBzdGF0aWMgaW50IGdldF90eF9idWZzKHN0cnVjdCB2aG9z
dF9uZXQgKm5ldCwKPiAgIAkJICAgICAgIHN0cnVjdCB2aG9zdF9uZXRfdmlydHF1ZXVlICpudnEs
Cj4gKwkJICAgICAgIHN0cnVjdCB2aG9zdF9idWYgKmJ1ZiwKPiAgIAkJICAgICAgIHN0cnVjdCBt
c2doZHIgKm1zZywKPiAgIAkJICAgICAgIHVuc2lnbmVkIGludCAqb3V0LCB1bnNpZ25lZCBpbnQg
KmluLAo+ICAgCQkgICAgICAgc2l6ZV90ICpsZW4sIGJvb2wgKmJ1c3lsb29wX2ludHIpCj4gQEAg
LTYxNCw5ICs2MjgsOSBAQCBzdGF0aWMgaW50IGdldF90eF9idWZzKHN0cnVjdCB2aG9zdF9uZXQg
Km5ldCwKPiAgIAlzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSA9ICZudnEtPnZxOwo+ICAgCWlu
dCByZXQ7Cj4gICAKPiAtCXJldCA9IHZob3N0X25ldF90eF9nZXRfdnFfZGVzYyhuZXQsIG52cSwg
b3V0LCBpbiwgbXNnLCBidXN5bG9vcF9pbnRyKTsKPiArCXJldCA9IHZob3N0X25ldF90eF9nZXRf
dnFfZGVzYyhuZXQsIG52cSwgYnVmLCBvdXQsIGluLCBtc2csIGJ1c3lsb29wX2ludHIpOwo+ICAg
Cj4gLQlpZiAocmV0IDwgMCB8fCByZXQgPT0gdnEtPm51bSkKPiArCWlmIChyZXQgPD0gMCkKPiAg
IAkJcmV0dXJuIHJldDsKPiAgIAo+ICAgCWlmICgqaW4pIHsKPiBAQCAtNzYxLDcgKzc3NSw3IEBA
IHN0YXRpYyB2b2lkIGhhbmRsZV90eF9jb3B5KHN0cnVjdCB2aG9zdF9uZXQgKm5ldCwgc3RydWN0
IHNvY2tldCAqc29jaykKPiAgIAlzdHJ1Y3Qgdmhvc3RfbmV0X3ZpcnRxdWV1ZSAqbnZxID0gJm5l
dC0+dnFzW1ZIT1NUX05FVF9WUV9UWF07Cj4gICAJc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEg
PSAmbnZxLT52cTsKPiAgIAl1bnNpZ25lZCBvdXQsIGluOwo+IC0JaW50IGhlYWQ7Cj4gKwlpbnQg
cmV0Owo+ICAgCXN0cnVjdCBtc2doZHIgbXNnID0gewo+ICAgCQkubXNnX25hbWUgPSBOVUxMLAo+
ICAgCQkubXNnX25hbWVsZW4gPSAwLAo+IEBAIC03NzMsNiArNzg3LDcgQEAgc3RhdGljIHZvaWQg
aGFuZGxlX3R4X2NvcHkoc3RydWN0IHZob3N0X25ldCAqbmV0LCBzdHJ1Y3Qgc29ja2V0ICpzb2Nr
KQo+ICAgCWludCBlcnI7Cj4gICAJaW50IHNlbnRfcGt0cyA9IDA7Cj4gICAJYm9vbCBzb2NrX2Nh
bl9iYXRjaCA9IChzb2NrLT5zay0+c2tfc25kYnVmID09IElOVF9NQVgpOwo+ICsJc3RydWN0IHZo
b3N0X2J1ZiBidWY7Cj4gICAKPiAgIAlkbyB7Cj4gICAJCWJvb2wgYnVzeWxvb3BfaW50ciA9IGZh
bHNlOwo+IEBAIC03ODAsMTMgKzc5NSwxMyBAQCBzdGF0aWMgdm9pZCBoYW5kbGVfdHhfY29weShz
dHJ1Y3Qgdmhvc3RfbmV0ICpuZXQsIHN0cnVjdCBzb2NrZXQgKnNvY2spCj4gICAJCWlmIChudnEt
PmRvbmVfaWR4ID09IFZIT1NUX05FVF9CQVRDSCkKPiAgIAkJCXZob3N0X3R4X2JhdGNoKG5ldCwg
bnZxLCBzb2NrLCAmbXNnKTsKPiAgIAo+IC0JCWhlYWQgPSBnZXRfdHhfYnVmcyhuZXQsIG52cSwg
Jm1zZywgJm91dCwgJmluLCAmbGVuLAo+IC0JCQkJICAgJmJ1c3lsb29wX2ludHIpOwo+ICsJCXJl
dCA9IGdldF90eF9idWZzKG5ldCwgbnZxLCAmYnVmLCAmbXNnLCAmb3V0LCAmaW4sICZsZW4sCj4g
KwkJCQkgICZidXN5bG9vcF9pbnRyKTsKPiAgIAkJLyogT24gZXJyb3IsIHN0b3AgaGFuZGxpbmcg
dW50aWwgdGhlIG5leHQga2ljay4gKi8KPiAtCQlpZiAodW5saWtlbHkoaGVhZCA8IDApKQo+ICsJ
CWlmICh1bmxpa2VseShyZXQgPCAwKSkKPiAgIAkJCWJyZWFrOwo+ICAgCQkvKiBOb3RoaW5nIG5l
dz8gIFdhaXQgZm9yIGV2ZW50ZmQgdG8gdGVsbCB1cyB0aGV5IHJlZmlsbGVkLiAqLwo+IC0JCWlm
IChoZWFkID09IHZxLT5udW0pIHsKPiArCQlpZiAoIXJldCkgewo+ICAgCQkJaWYgKHVubGlrZWx5
KGJ1c3lsb29wX2ludHIpKSB7Cj4gICAJCQkJdmhvc3RfcG9sbF9xdWV1ZSgmdnEtPnBvbGwpOwo+
ICAgCQkJfSBlbHNlIGlmICh1bmxpa2VseSh2aG9zdF9lbmFibGVfbm90aWZ5KCZuZXQtPmRldiwK
PiBAQCAtODA4LDcgKzgyMyw3IEBAIHN0YXRpYyB2b2lkIGhhbmRsZV90eF9jb3B5KHN0cnVjdCB2
aG9zdF9uZXQgKm5ldCwgc3RydWN0IHNvY2tldCAqc29jaykKPiAgIAkJCQlnb3RvIGRvbmU7Cj4g
ICAJCQl9IGVsc2UgaWYgKHVubGlrZWx5KGVyciAhPSAtRU5PU1BDKSkgewo+ICAgCQkJCXZob3N0
X3R4X2JhdGNoKG5ldCwgbnZxLCBzb2NrLCAmbXNnKTsKPiAtCQkJCXZob3N0X2Rpc2NhcmRfdnFf
ZGVzYyh2cSwgMSk7Cj4gKwkJCQl2aG9zdF9kaXNjYXJkX2F2YWlsX2J1ZnModnEsICZidWYsIDEp
Owo+ICAgCQkJCXZob3N0X25ldF9lbmFibGVfdnEobmV0LCB2cSk7Cj4gICAJCQkJYnJlYWs7Cj4g
ICAJCQl9Cj4gQEAgLTgyOSw3ICs4NDQsNyBAQCBzdGF0aWMgdm9pZCBoYW5kbGVfdHhfY29weShz
dHJ1Y3Qgdmhvc3RfbmV0ICpuZXQsIHN0cnVjdCBzb2NrZXQgKnNvY2spCj4gICAJCS8qIFRPRE86
IENoZWNrIHNwZWNpZmljIGVycm9yIGFuZCBib21iIG91dCB1bmxlc3MgRU5PQlVGUz8gKi8KPiAg
IAkJZXJyID0gc29jay0+b3BzLT5zZW5kbXNnKHNvY2ssICZtc2csIGxlbik7Cj4gICAJCWlmICh1
bmxpa2VseShlcnIgPCAwKSkgewo+IC0JCQl2aG9zdF9kaXNjYXJkX3ZxX2Rlc2ModnEsIDEpOwo+
ICsJCQl2aG9zdF9kaXNjYXJkX2F2YWlsX2J1ZnModnEsICZidWYsIDEpOwoKCkRvIHdlIG5lZWQg
dG8gZGVjcmVhc2UgZmlyc3RfZGVzYyBpbiB2aG9zdF9kaXNjYXJkX2F2YWlsX2J1ZnMoKT8KCgo+
ICAgCQkJdmhvc3RfbmV0X2VuYWJsZV92cShuZXQsIHZxKTsKPiAgIAkJCWJyZWFrOwo+ICAgCQl9
Cj4gQEAgLTgzNyw4ICs4NTIsNyBAQCBzdGF0aWMgdm9pZCBoYW5kbGVfdHhfY29weShzdHJ1Y3Qg
dmhvc3RfbmV0ICpuZXQsIHN0cnVjdCBzb2NrZXQgKnNvY2spCj4gICAJCQlwcl9kZWJ1ZygiVHJ1
bmNhdGVkIFRYIHBhY2tldDogbGVuICVkICE9ICV6ZFxuIiwKPiAgIAkJCQkgZXJyLCBsZW4pOwo+
ICAgZG9uZToKPiAtCQl2cS0+aGVhZHNbbnZxLT5kb25lX2lkeF0uaWQgPSBjcHVfdG9fdmhvc3Qz
Mih2cSwgaGVhZCk7Cj4gLQkJdnEtPmhlYWRzW252cS0+ZG9uZV9pZHhdLmxlbiA9IDA7Cj4gKwkJ
bnZxLT5idWZzW252cS0+ZG9uZV9pZHhdID0gYnVmOwo+ICAgCQkrK252cS0+ZG9uZV9pZHg7Cj4g
ICAJfSB3aGlsZSAobGlrZWx5KCF2aG9zdF9leGNlZWRzX3dlaWdodCh2cSwgKytzZW50X3BrdHMs
IHRvdGFsX2xlbikpKTsKPiAgIAo+IEBAIC04NTAsNyArODY0LDcgQEAgc3RhdGljIHZvaWQgaGFu
ZGxlX3R4X3plcm9jb3B5KHN0cnVjdCB2aG9zdF9uZXQgKm5ldCwgc3RydWN0IHNvY2tldCAqc29j
aykKPiAgIAlzdHJ1Y3Qgdmhvc3RfbmV0X3ZpcnRxdWV1ZSAqbnZxID0gJm5ldC0+dnFzW1ZIT1NU
X05FVF9WUV9UWF07Cj4gICAJc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEgPSAmbnZxLT52cTsK
PiAgIAl1bnNpZ25lZCBvdXQsIGluOwo+IC0JaW50IGhlYWQ7Cj4gKwlpbnQgcmV0Owo+ICAgCXN0
cnVjdCBtc2doZHIgbXNnID0gewo+ICAgCQkubXNnX25hbWUgPSBOVUxMLAo+ICAgCQkubXNnX25h
bWVsZW4gPSAwLAo+IEBAIC04NjQsNiArODc4LDcgQEAgc3RhdGljIHZvaWQgaGFuZGxlX3R4X3pl
cm9jb3B5KHN0cnVjdCB2aG9zdF9uZXQgKm5ldCwgc3RydWN0IHNvY2tldCAqc29jaykKPiAgIAlz
dHJ1Y3Qgdmhvc3RfbmV0X3VidWZfcmVmICp1bmluaXRpYWxpemVkX3Zhcih1YnVmcyk7Cj4gICAJ
Ym9vbCB6Y29weV91c2VkOwo+ICAgCWludCBzZW50X3BrdHMgPSAwOwo+ICsJc3RydWN0IHZob3N0
X2J1ZiBidWY7Cj4gICAKPiAgIAlkbyB7Cj4gICAJCWJvb2wgYnVzeWxvb3BfaW50cjsKPiBAQCAt
ODcyLDEzICs4ODcsMTMgQEAgc3RhdGljIHZvaWQgaGFuZGxlX3R4X3plcm9jb3B5KHN0cnVjdCB2
aG9zdF9uZXQgKm5ldCwgc3RydWN0IHNvY2tldCAqc29jaykKPiAgIAkJdmhvc3RfemVyb2NvcHlf
c2lnbmFsX3VzZWQobmV0LCB2cSk7Cj4gICAKPiAgIAkJYnVzeWxvb3BfaW50ciA9IGZhbHNlOwo+
IC0JCWhlYWQgPSBnZXRfdHhfYnVmcyhuZXQsIG52cSwgJm1zZywgJm91dCwgJmluLCAmbGVuLAo+
IC0JCQkJICAgJmJ1c3lsb29wX2ludHIpOwo+ICsJCXJldCA9IGdldF90eF9idWZzKG5ldCwgbnZx
LCAmYnVmLCAmbXNnLCAmb3V0LCAmaW4sICZsZW4sCj4gKwkJCQkgICZidXN5bG9vcF9pbnRyKTsK
PiAgIAkJLyogT24gZXJyb3IsIHN0b3AgaGFuZGxpbmcgdW50aWwgdGhlIG5leHQga2ljay4gKi8K
PiAtCQlpZiAodW5saWtlbHkoaGVhZCA8IDApKQo+ICsJCWlmICh1bmxpa2VseShyZXQgPCAwKSkK
PiAgIAkJCWJyZWFrOwo+ICAgCQkvKiBOb3RoaW5nIG5ldz8gIFdhaXQgZm9yIGV2ZW50ZmQgdG8g
dGVsbCB1cyB0aGV5IHJlZmlsbGVkLiAqLwo+IC0JCWlmIChoZWFkID09IHZxLT5udW0pIHsKPiAr
CQlpZiAoIXJldCkgewo+ICAgCQkJaWYgKHVubGlrZWx5KGJ1c3lsb29wX2ludHIpKSB7Cj4gICAJ
CQkJdmhvc3RfcG9sbF9xdWV1ZSgmdnEtPnBvbGwpOwo+ICAgCQkJfSBlbHNlIGlmICh1bmxpa2Vs
eSh2aG9zdF9lbmFibGVfbm90aWZ5KCZuZXQtPmRldiwgdnEpKSkgewo+IEBAIC04OTcsOCArOTEy
LDggQEAgc3RhdGljIHZvaWQgaGFuZGxlX3R4X3plcm9jb3B5KHN0cnVjdCB2aG9zdF9uZXQgKm5l
dCwgc3RydWN0IHNvY2tldCAqc29jaykKPiAgIAkJCXN0cnVjdCB1YnVmX2luZm8gKnVidWY7Cj4g
ICAJCQl1YnVmID0gbnZxLT51YnVmX2luZm8gKyBudnEtPnVwZW5kX2lkeDsKPiAgIAo+IC0JCQl2
cS0+aGVhZHNbbnZxLT51cGVuZF9pZHhdLmlkID0gY3B1X3RvX3Zob3N0MzIodnEsIGhlYWQpOwo+
IC0JCQl2cS0+aGVhZHNbbnZxLT51cGVuZF9pZHhdLmxlbiA9IFZIT1NUX0RNQV9JTl9QUk9HUkVT
UzsKPiArCQkJbnZxLT5idWZzW252cS0+dXBlbmRfaWR4XSA9IGJ1ZjsKPiArCQkJbnZxLT5idWZz
W252cS0+dXBlbmRfaWR4XS5pbl9sZW4gPSBWSE9TVF9ETUFfSU5fUFJPR1JFU1M7Cj4gICAJCQl1
YnVmLT5jYWxsYmFjayA9IHZob3N0X3plcm9jb3B5X2NhbGxiYWNrOwo+ICAgCQkJdWJ1Zi0+Y3R4
ID0gbnZxLT51YnVmczsKPiAgIAkJCXVidWYtPmRlc2MgPSBudnEtPnVwZW5kX2lkeDsKPiBAQCAt
OTMwLDE3ICs5NDUsMTkgQEAgc3RhdGljIHZvaWQgaGFuZGxlX3R4X3plcm9jb3B5KHN0cnVjdCB2
aG9zdF9uZXQgKm5ldCwgc3RydWN0IHNvY2tldCAqc29jaykKPiAgIAkJCQludnEtPnVwZW5kX2lk
eCA9ICgodW5zaWduZWQpbnZxLT51cGVuZF9pZHggLSAxKQo+ICAgCQkJCQklIFVJT19NQVhJT1Y7
Cj4gICAJCQl9Cj4gLQkJCXZob3N0X2Rpc2NhcmRfdnFfZGVzYyh2cSwgMSk7Cj4gKwkJCXZob3N0
X2Rpc2NhcmRfYXZhaWxfYnVmcyh2cSwgJmJ1ZiwgMSk7Cj4gICAJCQl2aG9zdF9uZXRfZW5hYmxl
X3ZxKG5ldCwgdnEpOwo+ICAgCQkJYnJlYWs7Cj4gICAJCX0KPiAgIAkJaWYgKGVyciAhPSBsZW4p
Cj4gICAJCQlwcl9kZWJ1ZygiVHJ1bmNhdGVkIFRYIHBhY2tldDogIgo+ICAgCQkJCSAiIGxlbiAl
ZCAhPSAlemRcbiIsIGVyciwgbGVuKTsKPiAtCQlpZiAoIXpjb3B5X3VzZWQpCj4gLQkJCXZob3N0
X2FkZF91c2VkX2FuZF9zaWduYWwoJm5ldC0+ZGV2LCB2cSwgaGVhZCwgMCk7Cj4gLQkJZWxzZQo+
ICsJCWlmICghemNvcHlfdXNlZCkgewo+ICsJCQl2aG9zdF9wdXRfdXNlZF9idWYodnEsICZidWYp
Owo+ICsJCQl2aG9zdF9zaWduYWwoJm5ldC0+ZGV2LCB2cSk7CgoKRG8gd2UgbmVlZCBzb21ldGhp
bmcgbGlrZSB2aG9zdF9wdXRfdXNlZF9hbmRfc2lnbmFsKCk/CgpUaGFua3MKCgo+ICsJCX0gZWxz
ZSB7Cj4gICAJCQl2aG9zdF96ZXJvY29weV9zaWduYWxfdXNlZChuZXQsIHZxKTsKPiArCQl9Cj4g
ICAJCXZob3N0X25ldF90eF9wYWNrZXQobmV0KTsKPiAgIAl9IHdoaWxlIChsaWtlbHkoIXZob3N0
X2V4Y2VlZHNfd2VpZ2h0KHZxLCArK3NlbnRfcGt0cywgdG90YWxfbGVuKSkpOwo+ICAgfQo+IEBA
IC0xMDA0LDcgKzEwMjEsNyBAQCBzdGF0aWMgaW50IHZob3N0X25ldF9yeF9wZWVrX2hlYWRfbGVu
KHN0cnVjdCB2aG9zdF9uZXQgKm5ldCwgc3RydWN0IHNvY2sgKnNrLAo+ICAgCWludCBsZW4gPSBw
ZWVrX2hlYWRfbGVuKHJudnEsIHNrKTsKPiAgIAo+ICAgCWlmICghbGVuICYmIHJ2cS0+YnVzeWxv
b3BfdGltZW91dCkgewo+IC0JCS8qIEZsdXNoIGJhdGNoZWQgaGVhZHMgZmlyc3QgKi8KPiArCQkv
KiBGbHVzaCBiYXRjaGVkIGJ1ZnMgZmlyc3QgKi8KPiAgIAkJdmhvc3RfbmV0X3NpZ25hbF91c2Vk
KHJudnEpOwo+ICAgCQkvKiBCb3RoIHR4IHZxIGFuZCByeCBzb2NrZXQgd2VyZSBwb2xsZWQgaGVy
ZSAqLwo+ICAgCQl2aG9zdF9uZXRfYnVzeV9wb2xsKG5ldCwgcnZxLCB0dnEsIGJ1c3lsb29wX2lu
dHIsIHRydWUpOwo+IEBAIC0xMDIyLDExICsxMDM5LDExIEBAIHN0YXRpYyBpbnQgdmhvc3RfbmV0
X3J4X3BlZWtfaGVhZF9sZW4oc3RydWN0IHZob3N0X25ldCAqbmV0LCBzdHJ1Y3Qgc29jayAqc2ss
Cj4gICAgKiBAaW92Y291bnQJLSByZXR1cm5lZCBjb3VudCBvZiBpbyB2ZWN0b3JzIHdlIGZpbGwK
PiAgICAqIEBsb2cJCS0gdmhvc3QgbG9nCj4gICAgKiBAbG9nX251bQktIGxvZyBvZmZzZXQKPiAt
ICogQHF1b3RhICAgICAgIC0gaGVhZGNvdW50IHF1b3RhLCAxIGZvciBiaWcgYnVmZmVyCj4gLSAq
CXJldHVybnMgbnVtYmVyIG9mIGJ1ZmZlciBoZWFkcyBhbGxvY2F0ZWQsIG5lZ2F0aXZlIG9uIGVy
cm9yCj4gKyAqIEBxdW90YSAgICAgICAtIGJ1ZmNvdW50IHF1b3RhLCAxIGZvciBiaWcgYnVmZmVy
Cj4gKyAqCXJldHVybnMgbnVtYmVyIG9mIGJ1ZmZlcnMgYWxsb2NhdGVkLCBuZWdhdGl2ZSBvbiBl
cnJvcgo+ICAgICovCj4gICBzdGF0aWMgaW50IGdldF9yeF9idWZzKHN0cnVjdCB2aG9zdF92aXJ0
cXVldWUgKnZxLAo+IC0JCSAgICAgICBzdHJ1Y3QgdnJpbmdfdXNlZF9lbGVtICpoZWFkcywKPiAr
CQkgICAgICAgc3RydWN0IHZob3N0X2J1ZiAqYnVmcywKPiAgIAkJICAgICAgIGludCBkYXRhbGVu
LAo+ICAgCQkgICAgICAgdW5zaWduZWQgKmlvdmNvdW50LAo+ICAgCQkgICAgICAgc3RydWN0IHZo
b3N0X2xvZyAqbG9nLAo+IEBAIC0xMDM1LDMwICsxMDUyLDI0IEBAIHN0YXRpYyBpbnQgZ2V0X3J4
X2J1ZnMoc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4gICB7Cj4gICAJdW5zaWduZWQgaW50
IG91dCwgaW47Cj4gICAJaW50IHNlZyA9IDA7Cj4gLQlpbnQgaGVhZGNvdW50ID0gMDsKPiAtCXVu
c2lnbmVkIGQ7Cj4gKwlpbnQgYnVmY291bnQgPSAwOwo+ICAgCWludCByLCBubG9ncyA9IDA7Cj4g
ICAJLyogbGVuIGlzIGFsd2F5cyBpbml0aWFsaXplZCBiZWZvcmUgdXNlIHNpbmNlIHdlIGFyZSBh
bHdheXMgY2FsbGVkIHdpdGgKPiAgIAkgKiBkYXRhbGVuID4gMC4KPiAgIAkgKi8KPiAgIAl1MzIg
dW5pbml0aWFsaXplZF92YXIobGVuKTsKPiAgIAo+IC0Jd2hpbGUgKGRhdGFsZW4gPiAwICYmIGhl
YWRjb3VudCA8IHF1b3RhKSB7Cj4gKwl3aGlsZSAoZGF0YWxlbiA+IDAgJiYgYnVmY291bnQgPCBx
dW90YSkgewo+ICAgCQlpZiAodW5saWtlbHkoc2VnID49IFVJT19NQVhJT1YpKSB7Cj4gICAJCQly
ID0gLUVOT0JVRlM7Cj4gICAJCQlnb3RvIGVycjsKPiAgIAkJfQo+IC0JCXIgPSB2aG9zdF9nZXRf
dnFfZGVzYyh2cSwgdnEtPmlvdiArIHNlZywKPiAtCQkJCSAgICAgIEFSUkFZX1NJWkUodnEtPmlv
dikgLSBzZWcsICZvdXQsCj4gLQkJCQkgICAgICAmaW4sIGxvZywgbG9nX251bSk7Cj4gLQkJaWYg
KHVubGlrZWx5KHIgPCAwKSkKPiArCQlyID0gdmhvc3RfZ2V0X2F2YWlsX2J1Zih2cSwgYnVmcyAr
IGJ1ZmNvdW50LCB2cS0+aW92ICsgc2VnLAo+ICsJCQkJCUFSUkFZX1NJWkUodnEtPmlvdikgLSBz
ZWcsICZvdXQsCj4gKwkJCQkJJmluLCBsb2csIGxvZ19udW0pOwo+ICsJCWlmICh1bmxpa2VseShy
IDw9IDApKQo+ICAgCQkJZ290byBlcnI7Cj4gICAKPiAtCQlkID0gcjsKPiAtCQlpZiAoZCA9PSB2
cS0+bnVtKSB7Cj4gLQkJCXIgPSAwOwo+IC0JCQlnb3RvIGVycjsKPiAtCQl9Cj4gICAJCWlmICh1
bmxpa2VseShvdXQgfHwgaW4gPD0gMCkpIHsKPiAgIAkJCXZxX2Vycih2cSwgInVuZXhwZWN0ZWQg
ZGVzY3JpcHRvciBmb3JtYXQgZm9yIFJYOiAiCj4gICAJCQkJIm91dCAlZCwgaW4gJWRcbiIsIG91
dCwgaW4pOwo+IEBAIC0xMDY5LDE0ICsxMDgwLDEyIEBAIHN0YXRpYyBpbnQgZ2V0X3J4X2J1ZnMo
c3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4gICAJCQlubG9ncyArPSAqbG9nX251bTsKPiAg
IAkJCWxvZyArPSAqbG9nX251bTsKPiAgIAkJfQo+IC0JCWhlYWRzW2hlYWRjb3VudF0uaWQgPSBj
cHVfdG9fdmhvc3QzMih2cSwgZCk7Cj4gICAJCWxlbiA9IGlvdl9sZW5ndGgodnEtPmlvdiArIHNl
ZywgaW4pOwo+IC0JCWhlYWRzW2hlYWRjb3VudF0ubGVuID0gY3B1X3RvX3Zob3N0MzIodnEsIGxl
bik7Cj4gICAJCWRhdGFsZW4gLT0gbGVuOwo+IC0JCSsraGVhZGNvdW50Owo+ICsJCSsrYnVmY291
bnQ7Cj4gICAJCXNlZyArPSBpbjsKPiAgIAl9Cj4gLQloZWFkc1toZWFkY291bnQgLSAxXS5sZW4g
PSBjcHVfdG9fdmhvc3QzMih2cSwgbGVuICsgZGF0YWxlbik7Cj4gKwlidWZzW2J1ZmNvdW50IC0g
MV0uaW5fbGVuID0gbGVuICsgZGF0YWxlbjsKPiAgIAkqaW92Y291bnQgPSBzZWc7Cj4gICAJaWYg
KHVubGlrZWx5KGxvZykpCj4gICAJCSpsb2dfbnVtID0gbmxvZ3M7Cj4gQEAgLTEwODYsOSArMTA5
NSw5IEBAIHN0YXRpYyBpbnQgZ2V0X3J4X2J1ZnMoc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEs
Cj4gICAJCXIgPSBVSU9fTUFYSU9WICsgMTsKPiAgIAkJZ290byBlcnI7Cj4gICAJfQo+IC0JcmV0
dXJuIGhlYWRjb3VudDsKPiArCXJldHVybiBidWZjb3VudDsKPiAgIGVycjoKPiAtCXZob3N0X2Rp
c2NhcmRfdnFfZGVzYyh2cSwgaGVhZGNvdW50KTsKPiArCXZob3N0X2Rpc2NhcmRfYXZhaWxfYnVm
cyh2cSwgYnVmcywgYnVmY291bnQpOwo+ICAgCXJldHVybiByOwo+ICAgfQo+ICAgCj4gQEAgLTEx
MTMsNyArMTEyMiw3IEBAIHN0YXRpYyB2b2lkIGhhbmRsZV9yeChzdHJ1Y3Qgdmhvc3RfbmV0ICpu
ZXQpCj4gICAJfTsKPiAgIAlzaXplX3QgdG90YWxfbGVuID0gMDsKPiAgIAlpbnQgZXJyLCBtZXJn
ZWFibGU7Cj4gLQlzMTYgaGVhZGNvdW50Owo+ICsJaW50IGJ1ZmNvdW50Owo+ICAgCXNpemVfdCB2
aG9zdF9obGVuLCBzb2NrX2hsZW47Cj4gICAJc2l6ZV90IHZob3N0X2xlbiwgc29ja19sZW47Cj4g
ICAJYm9vbCBidXN5bG9vcF9pbnRyID0gZmFsc2U7Cj4gQEAgLTExNDcsMTQgKzExNTYsMTQgQEAg
c3RhdGljIHZvaWQgaGFuZGxlX3J4KHN0cnVjdCB2aG9zdF9uZXQgKm5ldCkKPiAgIAkJCWJyZWFr
Owo+ICAgCQlzb2NrX2xlbiArPSBzb2NrX2hsZW47Cj4gICAJCXZob3N0X2xlbiA9IHNvY2tfbGVu
ICsgdmhvc3RfaGxlbjsKPiAtCQloZWFkY291bnQgPSBnZXRfcnhfYnVmcyh2cSwgdnEtPmhlYWRz
ICsgbnZxLT5kb25lX2lkeCwKPiAtCQkJCQl2aG9zdF9sZW4sICZpbiwgdnFfbG9nLCAmbG9nLAo+
IC0JCQkJCWxpa2VseShtZXJnZWFibGUpID8gVUlPX01BWElPViA6IDEpOwo+ICsJCWJ1ZmNvdW50
ID0gZ2V0X3J4X2J1ZnModnEsIG52cS0+YnVmcyArIG52cS0+ZG9uZV9pZHgsCj4gKwkJCQkgICAg
ICAgdmhvc3RfbGVuLCAmaW4sIHZxX2xvZywgJmxvZywKPiArCQkJCSAgICAgICBsaWtlbHkobWVy
Z2VhYmxlKSA/IFVJT19NQVhJT1YgOiAxKTsKPiAgIAkJLyogT24gZXJyb3IsIHN0b3AgaGFuZGxp
bmcgdW50aWwgdGhlIG5leHQga2ljay4gKi8KPiAtCQlpZiAodW5saWtlbHkoaGVhZGNvdW50IDwg
MCkpCj4gKwkJaWYgKHVubGlrZWx5KGJ1ZmNvdW50IDwgMCkpCj4gICAJCQlnb3RvIG91dDsKPiAg
IAkJLyogT0ssIG5vdyB3ZSBuZWVkIHRvIGtub3cgYWJvdXQgYWRkZWQgZGVzY3JpcHRvcnMuICov
Cj4gLQkJaWYgKCFoZWFkY291bnQpIHsKPiArCQlpZiAoIWJ1ZmNvdW50KSB7Cj4gICAJCQlpZiAo
dW5saWtlbHkoYnVzeWxvb3BfaW50cikpIHsKPiAgIAkJCQl2aG9zdF9wb2xsX3F1ZXVlKCZ2cS0+
cG9sbCk7Cj4gICAJCQl9IGVsc2UgaWYgKHVubGlrZWx5KHZob3N0X2VuYWJsZV9ub3RpZnkoJm5l
dC0+ZGV2LCB2cSkpKSB7Cj4gQEAgLTExNzEsNyArMTE4MCw3IEBAIHN0YXRpYyB2b2lkIGhhbmRs
ZV9yeChzdHJ1Y3Qgdmhvc3RfbmV0ICpuZXQpCj4gICAJCWlmIChudnEtPnJ4X3JpbmcpCj4gICAJ
CQltc2cubXNnX2NvbnRyb2wgPSB2aG9zdF9uZXRfYnVmX2NvbnN1bWUoJm52cS0+cnhxKTsKPiAg
IAkJLyogT24gb3ZlcnJ1biwgdHJ1bmNhdGUgYW5kIGRpc2NhcmQgKi8KPiAtCQlpZiAodW5saWtl
bHkoaGVhZGNvdW50ID4gVUlPX01BWElPVikpIHsKPiArCQlpZiAodW5saWtlbHkoYnVmY291bnQg
PiBVSU9fTUFYSU9WKSkgewo+ICAgCQkJaW92X2l0ZXJfaW5pdCgmbXNnLm1zZ19pdGVyLCBSRUFE
LCB2cS0+aW92LCAxLCAxKTsKPiAgIAkJCWVyciA9IHNvY2stPm9wcy0+cmVjdm1zZyhzb2NrLCAm
bXNnLAo+ICAgCQkJCQkJIDEsIE1TR19ET05UV0FJVCB8IE1TR19UUlVOQyk7Cj4gQEAgLTExOTUs
NyArMTIwNCw3IEBAIHN0YXRpYyB2b2lkIGhhbmRsZV9yeChzdHJ1Y3Qgdmhvc3RfbmV0ICpuZXQp
Cj4gICAJCWlmICh1bmxpa2VseShlcnIgIT0gc29ja19sZW4pKSB7Cj4gICAJCQlwcl9kZWJ1Zygi
RGlzY2FyZGVkIHJ4IHBhY2tldDogIgo+ICAgCQkJCSAiIGxlbiAlZCwgZXhwZWN0ZWQgJXpkXG4i
LCBlcnIsIHNvY2tfbGVuKTsKPiAtCQkJdmhvc3RfZGlzY2FyZF92cV9kZXNjKHZxLCBoZWFkY291
bnQpOwo+ICsJCQl2aG9zdF9kaXNjYXJkX2F2YWlsX2J1ZnModnEsIG52cS0+YnVmcyArIG52cS0+
ZG9uZV9pZHgsIGJ1ZmNvdW50KTsKPiAgIAkJCWNvbnRpbnVlOwo+ICAgCQl9Cj4gICAJCS8qIFN1
cHBseSB2aXJ0aW9fbmV0X2hkciBpZiBWSE9TVF9ORVRfRl9WSVJUSU9fTkVUX0hEUiAqLwo+IEBA
IC0xMjE0LDE1ICsxMjIzLDE1IEBAIHN0YXRpYyB2b2lkIGhhbmRsZV9yeChzdHJ1Y3Qgdmhvc3Rf
bmV0ICpuZXQpCj4gICAJCX0KPiAgIAkJLyogVE9ETzogU2hvdWxkIGNoZWNrIGFuZCBoYW5kbGUg
Y2hlY2tzdW0uICovCj4gICAKPiAtCQludW1fYnVmZmVycyA9IGNwdV90b192aG9zdDE2KHZxLCBo
ZWFkY291bnQpOwo+ICsJCW51bV9idWZmZXJzID0gY3B1X3RvX3Zob3N0MTYodnEsIGJ1ZmNvdW50
KTsKPiAgIAkJaWYgKGxpa2VseShtZXJnZWFibGUpICYmCj4gICAJCSAgICBjb3B5X3RvX2l0ZXIo
Jm51bV9idWZmZXJzLCBzaXplb2YgbnVtX2J1ZmZlcnMsCj4gICAJCQkJICZmaXh1cCkgIT0gc2l6
ZW9mIG51bV9idWZmZXJzKSB7Cj4gICAJCQl2cV9lcnIodnEsICJGYWlsZWQgbnVtX2J1ZmZlcnMg
d3JpdGUiKTsKPiAtCQkJdmhvc3RfZGlzY2FyZF92cV9kZXNjKHZxLCBoZWFkY291bnQpOwo+ICsJ
CQl2aG9zdF9kaXNjYXJkX2F2YWlsX2J1ZnModnEsIG52cS0+YnVmcyArIG52cS0+ZG9uZV9pZHgs
IGJ1ZmNvdW50KTsKPiAgIAkJCWdvdG8gb3V0Owo+ICAgCQl9Cj4gLQkJbnZxLT5kb25lX2lkeCAr
PSBoZWFkY291bnQ7Cj4gKwkJbnZxLT5kb25lX2lkeCArPSBidWZjb3VudDsKPiAgIAkJaWYgKG52
cS0+ZG9uZV9pZHggPiBWSE9TVF9ORVRfQkFUQ0gpCj4gICAJCQl2aG9zdF9uZXRfc2lnbmFsX3Vz
ZWQobnZxKTsKPiAgIAkJaWYgKHVubGlrZWx5KHZxX2xvZykpCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QK
VmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5s
aW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
