Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp1.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id C0BE664E7D1
	for <lists.virtualization@lfdr.de>; Fri, 16 Dec 2022 08:36:02 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp1.osuosl.org (Postfix) with ESMTP id 581598214C;
	Fri, 16 Dec 2022 07:36:01 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 581598214C
Authentication-Results: smtp1.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=Ug6+dH/v
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
	by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id TMlD4cJ7LTne; Fri, 16 Dec 2022 07:36:00 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp1.osuosl.org (Postfix) with ESMTPS id E77D78210C;
	Fri, 16 Dec 2022 07:35:59 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org E77D78210C
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 26609C007C;
	Fri, 16 Dec 2022 07:35:59 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 3FBC3C002D
 for <virtualization@lists.linux-foundation.org>;
 Fri, 16 Dec 2022 07:35:58 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id 1993040187
 for <virtualization@lists.linux-foundation.org>;
 Fri, 16 Dec 2022 07:35:58 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org 1993040187
Authentication-Results: smtp2.osuosl.org;
 dkim=pass (1024-bit key) header.d=redhat.com header.i=@redhat.com
 header.a=rsa-sha256 header.s=mimecast20190719 header.b=Ug6+dH/v
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Dbchex8M4R0R
 for <virtualization@lists.linux-foundation.org>;
 Fri, 16 Dec 2022 07:35:57 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org 2044440143
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.133.124])
 by smtp2.osuosl.org (Postfix) with ESMTPS id 2044440143
 for <virtualization@lists.linux-foundation.org>;
 Fri, 16 Dec 2022 07:35:56 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1671176155;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=Xjf7Uw2lvRn/Y4N/EbhXgyq4369fmFcLv50akapfEMo=;
 b=Ug6+dH/vNsToWt9gDLTshYE7WgVHb2S2xRL+eGg0dfypjxEoLgVHWqQc1hhXqC3ZW/Kj6m
 /9LoKG3c0FEcDUPDTldw1AtIDb/K23XB6iEVwjaABIfdub0UDyZTZhjNndlG2LkRrV8Ltd
 GgxlItM+u5rdMMzWZzxgl6z/gOjGR3w=
Received: from mail-ot1-f69.google.com (mail-ot1-f69.google.com
 [209.85.210.69]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_128_GCM_SHA256) id
 us-mta-164-gbvyFq8fOKWz5gK7cB2REQ-1; Fri, 16 Dec 2022 02:35:54 -0500
X-MC-Unique: gbvyFq8fOKWz5gK7cB2REQ-1
Received: by mail-ot1-f69.google.com with SMTP id
 x26-20020a9d6d9a000000b00672c2f06716so919226otp.21
 for <virtualization@lists.linux-foundation.org>;
 Thu, 15 Dec 2022 23:35:54 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=Xjf7Uw2lvRn/Y4N/EbhXgyq4369fmFcLv50akapfEMo=;
 b=lq7nf+gEUzMsv4S68zVH6UptzYujEsiYG/Rxsz033cWUVBHB6Lsumdgrd/AI9zxnYv
 9/iYhnOe2Io+VKGDmkGgFike59InvPbAK0oH8/OWd/mfnmyeOxRu2Rvl3WKDQCKOUcDG
 /h9jvpIC2XBooq2y4ldEziNQizVovIMUpl1xGm1xhuoBFWlO1l2vsuQBLMORCZa00eOS
 +vq1hi0JR7OYk4eMQBcGBlzFV96ULfygb5bRff1jZYfPP1/YrA+DokBHrrVSc1Svh3aC
 wvYsVeRaEXxAk7Nv/uf2jGG1k8WmwiKNeg3qJa+R1vTdzfsEAdfaGLVIuzw/vTIlAcSu
 x1Zw==
X-Gm-Message-State: ANoB5pmqJiCqyks4RMMqiwdEn8Rym/GUnwbncIBKrTBth/16CMi32FzZ
 zKLU4osrkmDVFRJJGYQB0MAvhAKKk6f3f494ZtpzD8dsu/gmN2Xeep4sSAvNyjgLNzjJ7Ds1967
 WCU6xvbbORbdMj5jLLy70dz6ywkk7IQ2PBtWpC/kMYuSRUjss2ahN+x+I/A==
X-Received: by 2002:a05:6808:114c:b0:35e:7a42:7ab5 with SMTP id
 u12-20020a056808114c00b0035e7a427ab5mr515118oiu.280.1671176153584; 
 Thu, 15 Dec 2022 23:35:53 -0800 (PST)
X-Google-Smtp-Source: AA0mqf69qICvyQuu7IvaCwoLsD676kBKVhLY8/0qmG45U9xXvA/Fp61q/5TrlWXWeo6Dww8IYDzxXLHPI8I1HjWLkzs=
X-Received: by 2002:a05:6808:114c:b0:35e:7a42:7ab5 with SMTP id
 u12-20020a056808114c00b0035e7a427ab5mr515101oiu.280.1671176153334; Thu, 15
 Dec 2022 23:35:53 -0800 (PST)
MIME-Version: 1.0
References: <20221215113144.322011-1-eperezma@redhat.com>
 <20221215113144.322011-13-eperezma@redhat.com>
In-Reply-To: <20221215113144.322011-13-eperezma@redhat.com>
From: Jason Wang <jasowang@redhat.com>
Date: Fri, 16 Dec 2022 15:35:42 +0800
Message-ID: <CACGkMEsjbkMvB9=9JbHq1gPbm5OZdBuGoGt7tRm2vAXH8yr79A@mail.gmail.com>
Subject: Re: [PATCH v9 12/12] vdpa: always start CVQ in SVQ mode if possible
To: =?UTF-8?Q?Eugenio_P=C3=A9rez?= <eperezma@redhat.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: Laurent Vivier <lvivier@redhat.com>, kvm@vger.kernel.org,
 Parav Pandit <parav@mellanox.com>, Cindy Lu <lulu@redhat.com>,
 "Michael S. Tsirkin" <mst@redhat.com>, Cornelia Huck <cohuck@redhat.com>,
 qemu-devel@nongnu.org, Gautam Dawar <gdawar@xilinx.com>,
 virtualization@lists.linux-foundation.org,
 Harpreet Singh Anand <hanand@xilinx.com>,
 Stefan Hajnoczi <stefanha@redhat.com>, Eli Cohen <eli@mellanox.com>,
 Paolo Bonzini <pbonzini@redhat.com>, Liuxiangdong <liuxiangdong5@huawei.com>,
 Longpeng <longpeng2@huawei.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVGh1LCBEZWMgMTUsIDIwMjIgYXQgNzozMiBQTSBFdWdlbmlvIFDDqXJleiA8ZXBlcmV6bWFA
cmVkaGF0LmNvbT4gd3JvdGU6Cj4KPiBJc29sYXRlIGNvbnRyb2wgdmlydHF1ZXVlIGluIGl0cyBv
d24gZ3JvdXAsIGFsbG93aW5nIHRvIGludGVyY2VwdCBjb250cm9sCj4gY29tbWFuZHMgYnV0IGxl
dHRpbmcgZGF0YXBsYW5lIHJ1biB0b3RhbGx5IHBhc3N0aHJvdWdoIHRvIHRoZSBndWVzdC4KPgo+
IFNpZ25lZC1vZmYtYnk6IEV1Z2VuaW8gUMOpcmV6IDxlcGVyZXptYUByZWRoYXQuY29tPgoKQWNr
ZWQtYnk6IEphc29uIFdhbmcgPGphc293YW5nQHJlZGhhdC5jb20+CgpUaGFua3MKCj4gLS0tCj4g
djk6Cj4gKiBSZXVzZSBpb3ZhX3JhbmdlIGZldGNoZWQgZnJvbSB0aGUgZGV2aWNlIGF0IGluaXRp
YWxpemF0aW9uLCBpbnN0ZWFkIG9mCj4gICBmZXRjaCBpdCBhZ2FpbiBhdCB2aG9zdF92ZHBhX25l
dF9jdnFfc3RhcnQuCj4gKiBBZGQgY29tbWVudCBhYm91dCBob3cgbWlncmF0aW9uIGlzIGJsb2Nr
ZWQgaW4gY2FzZSBBU0lEIGRvZXMgbm90IG1ldAo+ICAgb3VyIGV4cGVjdGF0aW9ucy4KPiAqIERl
bGV0ZSB3YXJuaW5nIGFib3V0IENWUSBncm91cCBub3QgYmVpbmcgaW5kZXBlbmRlbnQuCj4KPiB2
ODoKPiAqIERvIG5vdCBhbGxvY2F0ZSBpb3ZhX3RyZWUgb24gbmV0X2luaXRfdmhvc3RfdmRwYSBp
ZiBvbmx5IENWUSBpcwo+ICAgc2hhZG93ZWQuIE1vdmUgdGhlIGlvdmFfdHJlZSBoYW5kbGluZyBp
biB0aGlzIGNhc2UgdG8KPiAgIHZob3N0X3ZkcGFfbmV0X2N2cV9zdGFydCBhbmQgdmhvc3RfdmRw
YV9uZXRfY3ZxX3N0b3AuCj4KPiB2NzoKPiAqIE5ldmVyIGFzayBmb3IgbnVtYmVyIG9mIGFkZHJl
c3Mgc3BhY2VzLCBqdXN0IHJlYWN0IGlmIGlzb2xhdGlvbiBpcyBub3QKPiAgIHBvc3NpYmxlLgo+
ICogUmV0dXJuIEFTSUQgaW9jdGwgZXJyb3JzIGluc3RlYWQgb2YgbWFza2luZyB0aGVtIGFzIGlm
IHRoZSBkZXZpY2UgaGFzCj4gICBubyBhc2lkLgo+ICogU2ltcGxpZnkgbmV0X2luaXRfdmhvc3Rf
dmRwYSBsb2dpYwo+ICogQWRkICJpZiBwb3NzaWJsZSIgc3VmZml4Cj4KPiB2NjoKPiAqIERpc2Fi
bGUgY29udHJvbCBTVlEgaWYgdGhlIGRldmljZSBkb2VzIG5vdCBzdXBwb3J0IGl0IGJlY2F1c2Ug
b2YKPiBmZWF0dXJlcy4KPgo+IHY1Ogo+ICogRml4aW5nIHRoZSBub3QgYWRkaW5nIGN2cSBidWZm
ZXJzIHdoZW4geC1zdnE9b24gaXMgc3BlY2lmaWVkLgo+ICogTW92ZSB2cmluZyBzdGF0ZSBpbiB2
aG9zdF92ZHBhX2dldF92cmluZ19ncm91cCBpbnN0ZWFkIG9mIHVzaW5nIGEKPiAgIHBhcmFtZXRl
ci4KPiAqIFJlbmFtZSBWSE9TVF9WRFBBX05FVF9DVlFfUEFTU1RIUk9VR0ggdG8gVkhPU1RfVkRQ
QV9ORVRfREFUQV9BU0lECj4KPiB2NDoKPiAqIFNxdWFzaCB2aG9zdF92ZHBhX2N2cV9ncm91cF9p
c19pbmRlcGVuZGVudC4KPiAqIFJlYmFzZWQgb24gbGFzdCBDVlEgc3RhcnQgc2VyaWVzLCB0aGF0
IGFsbG9jYXRlZCBDVlEgY21kIGJ1ZnMgYXQgbG9hZAo+ICogRG8gbm90IGNoZWNrIGZvciBjdnEg
aW5kZXggb24gdmhvc3RfdmRwYV9uZXRfcHJlcGFyZSwgd2Ugb25seSBoYXZlIG9uZQo+ICAgdGhh
dCBjYWxsYmFjayByZWdpc3RlcmVkIGluIHRoYXQgTmV0Q2xpZW50SW5mby4KPgo+IHYzOgo+ICog
TWFrZSBhc2lkIHJlbGF0ZWQgcXVlcmllcyBwcmludCBhIHdhcm5pbmcgaW5zdGVhZCBvZiByZXR1
cm5pbmcgYW4KPiAgIGVycm9yIGFuZCBzdG9wIHRoZSBzdGFydCBvZiBxZW11Lgo+IC0tLQo+ICBo
dy92aXJ0aW8vdmhvc3QtdmRwYS5jIHwgICAzICstCj4gIG5ldC92aG9zdC12ZHBhLmMgICAgICAg
fCAxMTAgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0KPiAgMiBmaWxl
cyBjaGFuZ2VkLCAxMTEgaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkKPgo+IGRpZmYgLS1n
aXQgYS9ody92aXJ0aW8vdmhvc3QtdmRwYS5jIGIvaHcvdmlydGlvL3Zob3N0LXZkcGEuYwo+IGlu
ZGV4IDQ4ZDhjNjBlNzYuLjhjZDAwZjVhOTYgMTAwNjQ0Cj4gLS0tIGEvaHcvdmlydGlvL3Zob3N0
LXZkcGEuYwo+ICsrKyBiL2h3L3ZpcnRpby92aG9zdC12ZHBhLmMKPiBAQCAtNjM4LDcgKzYzOCw4
IEBAIHN0YXRpYyBpbnQgdmhvc3RfdmRwYV9zZXRfYmFja2VuZF9jYXAoc3RydWN0IHZob3N0X2Rl
diAqZGV2KQo+ICB7Cj4gICAgICB1aW50NjRfdCBmZWF0dXJlczsKPiAgICAgIHVpbnQ2NF90IGYg
PSAweDFVTEwgPDwgVkhPU1RfQkFDS0VORF9GX0lPVExCX01TR19WMiB8Cj4gLSAgICAgICAgMHgx
VUxMIDw8IFZIT1NUX0JBQ0tFTkRfRl9JT1RMQl9CQVRDSDsKPiArICAgICAgICAweDFVTEwgPDwg
VkhPU1RfQkFDS0VORF9GX0lPVExCX0JBVENIIHwKPiArICAgICAgICAweDFVTEwgPDwgVkhPU1Rf
QkFDS0VORF9GX0lPVExCX0FTSUQ7Cj4gICAgICBpbnQgcjsKPgo+ICAgICAgaWYgKHZob3N0X3Zk
cGFfY2FsbChkZXYsIFZIT1NUX0dFVF9CQUNLRU5EX0ZFQVRVUkVTLCAmZmVhdHVyZXMpKSB7Cj4g
ZGlmZiAtLWdpdCBhL25ldC92aG9zdC12ZHBhLmMgYi9uZXQvdmhvc3QtdmRwYS5jCj4gaW5kZXgg
NzEwYzVlZmU5Ni4uZDM2NjY0ZjMzYSAxMDA2NDQKPiAtLS0gYS9uZXQvdmhvc3QtdmRwYS5jCj4g
KysrIGIvbmV0L3Zob3N0LXZkcGEuYwo+IEBAIC0xMDIsNiArMTAyLDggQEAgc3RhdGljIGNvbnN0
IHVpbnQ2NF90IHZkcGFfc3ZxX2RldmljZV9mZWF0dXJlcyA9Cj4gICAgICBCSVRfVUxMKFZJUlRJ
T19ORVRfRl9SU0NfRVhUKSB8Cj4gICAgICBCSVRfVUxMKFZJUlRJT19ORVRfRl9TVEFOREJZKTsK
Pgo+ICsjZGVmaW5lIFZIT1NUX1ZEUEFfTkVUX0NWUV9BU0lEIDEKPiArCj4gIFZIb3N0TmV0U3Rh
dGUgKnZob3N0X3ZkcGFfZ2V0X3Zob3N0X25ldChOZXRDbGllbnRTdGF0ZSAqbmMpCj4gIHsKPiAg
ICAgIFZob3N0VkRQQVN0YXRlICpzID0gRE9fVVBDQVNUKFZob3N0VkRQQVN0YXRlLCBuYywgbmMp
Owo+IEBAIC0yNDMsNiArMjQ1LDQwIEBAIHN0YXRpYyBOZXRDbGllbnRJbmZvIG5ldF92aG9zdF92
ZHBhX2luZm8gPSB7Cj4gICAgICAgICAgLmNoZWNrX3BlZXJfdHlwZSA9IHZob3N0X3ZkcGFfY2hl
Y2tfcGVlcl90eXBlLAo+ICB9Owo+Cj4gK3N0YXRpYyBpbnQ2NF90IHZob3N0X3ZkcGFfZ2V0X3Zy
aW5nX2dyb3VwKGludCBkZXZpY2VfZmQsIHVuc2lnbmVkIHZxX2luZGV4KQo+ICt7Cj4gKyAgICBz
dHJ1Y3Qgdmhvc3RfdnJpbmdfc3RhdGUgc3RhdGUgPSB7Cj4gKyAgICAgICAgLmluZGV4ID0gdnFf
aW5kZXgsCj4gKyAgICB9Owo+ICsgICAgaW50IHIgPSBpb2N0bChkZXZpY2VfZmQsIFZIT1NUX1ZE
UEFfR0VUX1ZSSU5HX0dST1VQLCAmc3RhdGUpOwo+ICsKPiArICAgIGlmICh1bmxpa2VseShyIDwg
MCkpIHsKPiArICAgICAgICBlcnJvcl9yZXBvcnQoIkNhbm5vdCBnZXQgVlEgJXUgZ3JvdXA6ICVz
IiwgdnFfaW5kZXgsCj4gKyAgICAgICAgICAgICAgICAgICAgIGdfc3RyZXJyb3IoZXJybm8pKTsK
PiArICAgICAgICByZXR1cm4gcjsKPiArICAgIH0KPiArCj4gKyAgICByZXR1cm4gc3RhdGUubnVt
Owo+ICt9Cj4gKwo+ICtzdGF0aWMgaW50IHZob3N0X3ZkcGFfc2V0X2FkZHJlc3Nfc3BhY2VfaWQo
c3RydWN0IHZob3N0X3ZkcGEgKnYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB1bnNpZ25lZCB2cV9ncm91cCwKPiArICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGFzaWRfbnVtKQo+ICt7Cj4gKyAgICBzdHJ1Y3Qg
dmhvc3RfdnJpbmdfc3RhdGUgYXNpZCA9IHsKPiArICAgICAgICAuaW5kZXggPSB2cV9ncm91cCwK
PiArICAgICAgICAubnVtID0gYXNpZF9udW0sCj4gKyAgICB9Owo+ICsgICAgaW50IHI7Cj4gKwo+
ICsgICAgciA9IGlvY3RsKHYtPmRldmljZV9mZCwgVkhPU1RfVkRQQV9TRVRfR1JPVVBfQVNJRCwg
JmFzaWQpOwo+ICsgICAgaWYgKHVubGlrZWx5KHIgPCAwKSkgewo+ICsgICAgICAgIGVycm9yX3Jl
cG9ydCgiQ2FuJ3Qgc2V0IHZxIGdyb3VwICV1IGFzaWQgJXUsIGVycm5vPSVkICglcykiLAo+ICsg
ICAgICAgICAgICAgICAgICAgICBhc2lkLmluZGV4LCBhc2lkLm51bSwgZXJybm8sIGdfc3RyZXJy
b3IoZXJybm8pKTsKPiArICAgIH0KPiArICAgIHJldHVybiByOwo+ICt9Cj4gKwo+ICBzdGF0aWMg
dm9pZCB2aG9zdF92ZHBhX2N2cV91bm1hcF9idWYoc3RydWN0IHZob3N0X3ZkcGEgKnYsIHZvaWQg
KmFkZHIpCj4gIHsKPiAgICAgIFZob3N0SU9WQVRyZWUgKnRyZWUgPSB2LT5pb3ZhX3RyZWU7Cj4g
QEAgLTMxNywxMSArMzUzLDc1IEBAIGRtYV9tYXBfZXJyOgo+ICBzdGF0aWMgaW50IHZob3N0X3Zk
cGFfbmV0X2N2cV9zdGFydChOZXRDbGllbnRTdGF0ZSAqbmMpCj4gIHsKPiAgICAgIFZob3N0VkRQ
QVN0YXRlICpzOwo+IC0gICAgaW50IHI7Cj4gKyAgICBzdHJ1Y3Qgdmhvc3RfdmRwYSAqdjsKPiAr
ICAgIHVpbnQ2NF90IGJhY2tlbmRfZmVhdHVyZXM7Cj4gKyAgICBpbnQ2NF90IGN2cV9ncm91cDsK
PiArICAgIGludCBjdnFfaW5kZXgsIHI7Cj4KPiAgICAgIGFzc2VydChuYy0+aW5mby0+dHlwZSA9
PSBORVRfQ0xJRU5UX0RSSVZFUl9WSE9TVF9WRFBBKTsKPgo+ICAgICAgcyA9IERPX1VQQ0FTVChW
aG9zdFZEUEFTdGF0ZSwgbmMsIG5jKTsKPiArICAgIHYgPSAmcy0+dmhvc3RfdmRwYTsKPiArCj4g
KyAgICB2LT5zaGFkb3dfZGF0YSA9IHMtPmFsd2F5c19zdnE7Cj4gKyAgICB2LT5zaGFkb3dfdnFz
X2VuYWJsZWQgPSBzLT5hbHdheXNfc3ZxOwo+ICsgICAgcy0+dmhvc3RfdmRwYS5hZGRyZXNzX3Nw
YWNlX2lkID0gVkhPU1RfVkRQQV9HVUVTVF9QQV9BU0lEOwo+ICsKPiArICAgIGlmIChzLT5hbHdh
eXNfc3ZxKSB7Cj4gKyAgICAgICAgLyogU1ZRIGlzIGFscmVhZHkgY29uZmlndXJlZCBmb3IgYWxs
IHZpcnRxdWV1ZXMgKi8KPiArICAgICAgICBnb3RvIG91dDsKPiArICAgIH0KPiArCj4gKyAgICAv
Kgo+ICsgICAgICogSWYgd2UgZWFybHkgcmV0dXJuIGluIHRoZXNlIGNhc2VzIFNWUSB3aWxsIG5v
dCBiZSBlbmFibGVkLiBUaGUgbWlncmF0aW9uCj4gKyAgICAgKiB3aWxsIGJlIGJsb2NrZWQgYXMg
bG9uZyBhcyB2aG9zdC12ZHBhIGJhY2tlbmRzIHdpbGwgbm90IG9mZmVyIF9GX0xPRy4KPiArICAg
ICAqCj4gKyAgICAgKiBDYWxsaW5nIFZIT1NUX0dFVF9CQUNLRU5EX0ZFQVRVUkVTIGFzIHRoZXkg
YXJlIG5vdCBhdmFpbGFibGUgaW4gdi0+ZGV2Cj4gKyAgICAgKiB5ZXQuCj4gKyAgICAgKi8KPiAr
ICAgIHIgPSBpb2N0bCh2LT5kZXZpY2VfZmQsIFZIT1NUX0dFVF9CQUNLRU5EX0ZFQVRVUkVTLCAm
YmFja2VuZF9mZWF0dXJlcyk7Cj4gKyAgICBpZiAodW5saWtlbHkociA8IDApKSB7Cj4gKyAgICAg
ICAgZXJyb3JfcmVwb3J0KCJDYW5ub3QgZ2V0IHZkcGEgYmFja2VuZF9mZWF0dXJlczogJXMoJWQp
IiwKPiArICAgICAgICAgICAgZ19zdHJlcnJvcihlcnJubyksIGVycm5vKTsKPiArICAgICAgICBy
ZXR1cm4gLTE7Cj4gKyAgICB9Cj4gKyAgICBpZiAoIShiYWNrZW5kX2ZlYXR1cmVzICYgVkhPU1Rf
QkFDS0VORF9GX0lPVExCX0FTSUQpIHx8Cj4gKyAgICAgICAgIXZob3N0X3ZkcGFfbmV0X3ZhbGlk
X3N2cV9mZWF0dXJlcyh2LT5kZXYtPmZlYXR1cmVzLCBOVUxMKSkgewo+ICsgICAgICAgIHJldHVy
biAwOwo+ICsgICAgfQo+ICsKPiArICAgIC8qCj4gKyAgICAgKiBDaGVjayBpZiBhbGwgdGhlIHZp
cnRxdWV1ZXMgb2YgdGhlIHZpcnRpbyBkZXZpY2UgYXJlIGluIGEgZGlmZmVyZW50IHZxCj4gKyAg
ICAgKiB0aGFuIHRoZSBsYXN0IHZxLiBWUSBncm91cCBvZiBsYXN0IGdyb3VwIHBhc3NlZCBpbiBj
dnFfZ3JvdXAuCj4gKyAgICAgKi8KPiArICAgIGN2cV9pbmRleCA9IHYtPmRldi0+dnFfaW5kZXhf
ZW5kIC0gMTsKPiArICAgIGN2cV9ncm91cCA9IHZob3N0X3ZkcGFfZ2V0X3ZyaW5nX2dyb3VwKHYt
PmRldmljZV9mZCwgY3ZxX2luZGV4KTsKPiArICAgIGlmICh1bmxpa2VseShjdnFfZ3JvdXAgPCAw
KSkgewo+ICsgICAgICAgIHJldHVybiBjdnFfZ3JvdXA7Cj4gKyAgICB9Cj4gKyAgICBmb3IgKGlu
dCBpID0gMDsgaSA8IGN2cV9pbmRleDsgKytpKSB7Cj4gKyAgICAgICAgaW50NjRfdCBncm91cCA9
IHZob3N0X3ZkcGFfZ2V0X3ZyaW5nX2dyb3VwKHYtPmRldmljZV9mZCwgaSk7Cj4gKwo+ICsgICAg
ICAgIGlmICh1bmxpa2VseShncm91cCA8IDApKSB7Cj4gKyAgICAgICAgICAgIHJldHVybiBncm91
cDsKPiArICAgICAgICB9Cj4gKwo+ICsgICAgICAgIGlmIChncm91cCA9PSBjdnFfZ3JvdXApIHsK
PiArICAgICAgICAgICAgcmV0dXJuIDA7Cj4gKyAgICAgICAgfQo+ICsgICAgfQo+ICsKPiArICAg
IHIgPSB2aG9zdF92ZHBhX3NldF9hZGRyZXNzX3NwYWNlX2lkKHYsIGN2cV9ncm91cCwgVkhPU1Rf
VkRQQV9ORVRfQ1ZRX0FTSUQpOwo+ICsgICAgaWYgKHVubGlrZWx5KHIgPCAwKSkgewo+ICsgICAg
ICAgIHJldHVybiByOwo+ICsgICAgfQo+ICsKPiArICAgIHYtPmlvdmFfdHJlZSA9IHZob3N0X2lv
dmFfdHJlZV9uZXcodi0+aW92YV9yYW5nZS5maXJzdCwKPiArICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdi0+aW92YV9yYW5nZS5sYXN0KTsKPiArICAgIHYtPnNoYWRvd192
cXNfZW5hYmxlZCA9IHRydWU7Cj4gKyAgICBzLT52aG9zdF92ZHBhLmFkZHJlc3Nfc3BhY2VfaWQg
PSBWSE9TVF9WRFBBX05FVF9DVlFfQVNJRDsKPiArCj4gK291dDoKPiAgICAgIGlmICghcy0+dmhv
c3RfdmRwYS5zaGFkb3dfdnFzX2VuYWJsZWQpIHsKPiAgICAgICAgICByZXR1cm4gMDsKPiAgICAg
IH0KPiBAQCAtMzUwLDYgKzQ1MCwxNCBAQCBzdGF0aWMgdm9pZCB2aG9zdF92ZHBhX25ldF9jdnFf
c3RvcChOZXRDbGllbnRTdGF0ZSAqbmMpCj4gICAgICBpZiAocy0+dmhvc3RfdmRwYS5zaGFkb3df
dnFzX2VuYWJsZWQpIHsKPiAgICAgICAgICB2aG9zdF92ZHBhX2N2cV91bm1hcF9idWYoJnMtPnZo
b3N0X3ZkcGEsIHMtPmN2cV9jbWRfb3V0X2J1ZmZlcik7Cj4gICAgICAgICAgdmhvc3RfdmRwYV9j
dnFfdW5tYXBfYnVmKCZzLT52aG9zdF92ZHBhLCBzLT5zdGF0dXMpOwo+ICsgICAgICAgIGlmICgh
cy0+YWx3YXlzX3N2cSkgewo+ICsgICAgICAgICAgICAvKgo+ICsgICAgICAgICAgICAgKiBJZiBv
bmx5IHRoZSBDVlEgaXMgc2hhZG93ZWQgd2UgY2FuIGRlbGV0ZSB0aGlzIHNhZmVseS4KPiArICAg
ICAgICAgICAgICogSWYgYWxsIHRoZSBWUXMgYXJlIHNoYWRvd3MgdGhpcyB3aWxsIGJlIG5lZWRl
ZCBieSB0aGUgdGltZSB0aGUKPiArICAgICAgICAgICAgICogZGV2aWNlIGlzIHN0YXJ0ZWQgYWdh
aW4gdG8gcmVnaXN0ZXIgU1ZRIHZyaW5ncyBhbmQgc2ltaWxhci4KPiArICAgICAgICAgICAgICov
Cj4gKyAgICAgICAgICAgIGdfY2xlYXJfcG9pbnRlcigmcy0+dmhvc3RfdmRwYS5pb3ZhX3RyZWUs
IHZob3N0X2lvdmFfdHJlZV9kZWxldGUpOwo+ICsgICAgICAgIH0KPiAgICAgIH0KPiAgfQo+Cj4g
LS0KPiAyLjMxLjEKPgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxp
bnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWls
bWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
