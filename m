Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id 65E77228B2A
	for <lists.virtualization@lfdr.de>; Tue, 21 Jul 2020 23:26:14 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by whitealder.osuosl.org (Postfix) with ESMTP id 12F7B882CB;
	Tue, 21 Jul 2020 21:26:13 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id ysTHjAZjLZhd; Tue, 21 Jul 2020 21:26:07 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by whitealder.osuosl.org (Postfix) with ESMTP id 3BF63882D1;
	Tue, 21 Jul 2020 21:26:01 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 1C74AC088E;
	Tue, 21 Jul 2020 21:26:01 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 86FCCC08A8
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:56 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id 649252276C
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:56 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id dEeKJZOQPBvc
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:53 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by silver.osuosl.org (Postfix) with ESMTPS id B2F5420408
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:52 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 3A6253031FC9; Wed, 22 Jul 2020 00:09:24 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 0427F304FA13;
 Wed, 22 Jul 2020 00:09:24 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v9 35/84] KVM: x86: wire in the preread/prewrite/preexec page
 trackers
Date: Wed, 22 Jul 2020 00:08:33 +0300
Message-Id: <20200721210922.7646-36-alazar@bitdefender.com>
In-Reply-To: <20200721210922.7646-1-alazar@bitdefender.com>
References: <20200721210922.7646-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 Stefan Sicleru <ssicleru@bitdefender.com>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Marian Rotariu <marian.c.rotariu@gmail.com>,
 Paolo Bonzini <pbonzini@redhat.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhlc2UgYXJlIG5l
ZWRlZCBpbiBvcmRlciB0byBub3RpZnkgdGhlIGludHJvc3BlY3Rpb24gdG9vbCB3aGVuCnJlYWQv
d3JpdGUvZXhlY3V0ZSBhY2Nlc3MgaGFwcGVucyBvbiBvbmUgb2YgdGhlIHRyYWNrZWQgbWVtb3J5
IHBhZ2VzLgoKQWxzbywgdGhpcyBwYXRjaCBhZGRzIHRoZSBjYXNlIHdoZW4gdGhlIGludHJvc3Bl
Y3Rpb24gdG9vbCByZXF1ZXN0cwp0aGF0IHRoZSB2Q1BVIHJlLWVudGVyIGluIGd1ZXN0IChhbmQg
YWJvcnQgdGhlIGVtdWxhdGlvbiBvZiB0aGUgY3VycmVudAppbnN0cnVjdGlvbikuCgpTaWduZWQt
b2ZmLWJ5OiBNaWhhaSBEb27Im3UgPG1kb250dUBiaXRkZWZlbmRlci5jb20+CkNvLWRldmVsb3Bl
ZC1ieTogTWFyaWFuIFJvdGFyaXUgPG1hcmlhbi5jLnJvdGFyaXVAZ21haWwuY29tPgpTaWduZWQt
b2ZmLWJ5OiBNYXJpYW4gUm90YXJpdSA8bWFyaWFuLmMucm90YXJpdUBnbWFpbC5jb20+CkNvLWRl
dmVsb3BlZC1ieTogU3RlZmFuIFNpY2xlcnUgPHNzaWNsZXJ1QGJpdGRlZmVuZGVyLmNvbT4KU2ln
bmVkLW9mZi1ieTogU3RlZmFuIFNpY2xlcnUgPHNzaWNsZXJ1QGJpdGRlZmVuZGVyLmNvbT4KU2ln
bmVkLW9mZi1ieTogQWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgotLS0K
IGFyY2gveDg2L2t2bS9lbXVsYXRlLmMgICAgIHwgIDQgKysrCiBhcmNoL3g4Ni9rdm0va3ZtX2Vt
dWxhdGUuaCB8ICAxICsKIGFyY2gveDg2L2t2bS9tbXUvbW11LmMgICAgIHwgNTggKysrKysrKysr
KysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0KIGFyY2gveDg2L2t2bS94ODYuYyAgICAgICAg
IHwgNDUgKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0KIDQgZmlsZXMgY2hhbmdlZCwgODUg
aW5zZXJ0aW9ucygrKSwgMjMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3Zt
L2VtdWxhdGUuYyBiL2FyY2gveDg2L2t2bS9lbXVsYXRlLmMKaW5kZXggZDBlMjgyNWFlNjE3Li4x
NWEwMDVhM2IzZjUgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS9lbXVsYXRlLmMKKysrIGIvYXJj
aC94ODYva3ZtL2VtdWxhdGUuYwpAQCAtNTQ0Miw2ICs1NDQyLDggQEAgaW50IHg4Nl9kZWNvZGVf
aW5zbihzdHJ1Y3QgeDg2X2VtdWxhdGVfY3R4dCAqY3R4dCwgdm9pZCAqaW5zbiwgaW50IGluc25f
bGVuKQogCQkJCQljdHh0LT5tZW1vcHAtPmFkZHIubWVtLmVhICsgY3R4dC0+X2VpcCk7CiAKIGRv
bmU6CisJaWYgKHJjID09IFg4NkVNVUxfUkVUUllfSU5TVFIpCisJCXJldHVybiBFTVVMQVRJT05f
UkVUUllfSU5TVFI7CiAJaWYgKHJjID09IFg4NkVNVUxfUFJPUEFHQVRFX0ZBVUxUKQogCQljdHh0
LT5oYXZlX2V4Y2VwdGlvbiA9IHRydWU7CiAJcmV0dXJuIChyYyAhPSBYODZFTVVMX0NPTlRJTlVF
KSA/IEVNVUxBVElPTl9GQUlMRUQgOiBFTVVMQVRJT05fT0s7CkBAIC01ODEzLDYgKzU4MTUsOCBA
QCBpbnQgeDg2X2VtdWxhdGVfaW5zbihzdHJ1Y3QgeDg2X2VtdWxhdGVfY3R4dCAqY3R4dCkKIAlp
ZiAocmMgPT0gWDg2RU1VTF9JTlRFUkNFUFRFRCkKIAkJcmV0dXJuIEVNVUxBVElPTl9JTlRFUkNF
UFRFRDsKIAorCWlmIChyYyA9PSBYODZFTVVMX1JFVFJZX0lOU1RSKQorCQlyZXR1cm4gRU1VTEFU
SU9OX1JFVFJZX0lOU1RSOwogCWlmIChyYyA9PSBYODZFTVVMX0NPTlRJTlVFKQogCQl3cml0ZWJh
Y2tfcmVnaXN0ZXJzKGN0eHQpOwogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtX2VtdWxh
dGUuaCBiL2FyY2gveDg2L2t2bS9rdm1fZW11bGF0ZS5oCmluZGV4IDQzYzkzZmZhNzZlZC4uNWJm
YWI4ZDY1Y2QxIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0va3ZtX2VtdWxhdGUuaAorKysgYi9h
cmNoL3g4Ni9rdm0va3ZtX2VtdWxhdGUuaApAQCAtNDk2LDYgKzQ5Niw3IEBAIGJvb2wgeDg2X3Bh
Z2VfdGFibGVfd3JpdGluZ19pbnNuKHN0cnVjdCB4ODZfZW11bGF0ZV9jdHh0ICpjdHh0KTsKICNk
ZWZpbmUgRU1VTEFUSU9OX09LIDAKICNkZWZpbmUgRU1VTEFUSU9OX1JFU1RBUlQgMQogI2RlZmlu
ZSBFTVVMQVRJT05fSU5URVJDRVBURUQgMgorI2RlZmluZSBFTVVMQVRJT05fUkVUUllfSU5TVFIg
Mwogdm9pZCBpbml0X2RlY29kZV9jYWNoZShzdHJ1Y3QgeDg2X2VtdWxhdGVfY3R4dCAqY3R4dCk7
CiBpbnQgeDg2X2VtdWxhdGVfaW5zbihzdHJ1Y3QgeDg2X2VtdWxhdGVfY3R4dCAqY3R4dCk7CiBp
bnQgZW11bGF0b3JfdGFza19zd2l0Y2goc3RydWN0IHg4Nl9lbXVsYXRlX2N0eHQgKmN0eHQsCmRp
ZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0vbW11L21tdS5jIGIvYXJjaC94ODYva3ZtL21tdS9tbXUu
YwppbmRleCBlZGU4ZWY2ZDFlMzQuLmRhNTczMjFlMGNlYyAxMDA2NDQKLS0tIGEvYXJjaC94ODYv
a3ZtL21tdS9tbXUuYworKysgYi9hcmNoL3g4Ni9rdm0vbW11L21tdS5jCkBAIC0xMjI2LDkgKzEy
MjYsMTMgQEAgc3RhdGljIHZvaWQgYWNjb3VudF9zaGFkb3dlZChzdHJ1Y3Qga3ZtICprdm0sIHN0
cnVjdCBrdm1fbW11X3BhZ2UgKnNwKQogCXNsb3QgPSBfX2dmbl90b19tZW1zbG90KHNsb3RzLCBn
Zm4pOwogCiAJLyogdGhlIG5vbi1sZWFmIHNoYWRvdyBwYWdlcyBhcmUga2VlcGluZyByZWFkb25s
eS4gKi8KLQlpZiAoc3AtPnJvbGUubGV2ZWwgPiBQR19MRVZFTF80SykKLQkJcmV0dXJuIGt2bV9z
bG90X3BhZ2VfdHJhY2tfYWRkX3BhZ2Uoa3ZtLCBzbG90LCBnZm4sCi0JCQkJCQkgICAgS1ZNX1BB
R0VfVFJBQ0tfV1JJVEUpOworCWlmIChzcC0+cm9sZS5sZXZlbCA+IFBHX0xFVkVMXzRLKSB7CisJ
CWt2bV9zbG90X3BhZ2VfdHJhY2tfYWRkX3BhZ2Uoa3ZtLCBzbG90LCBnZm4sCisJCQkJCSAgICAg
S1ZNX1BBR0VfVFJBQ0tfUFJFV1JJVEUpOworCQlrdm1fc2xvdF9wYWdlX3RyYWNrX2FkZF9wYWdl
KGt2bSwgc2xvdCwgZ2ZuLAorCQkJCQkgICAgIEtWTV9QQUdFX1RSQUNLX1dSSVRFKTsKKwkJcmV0
dXJuOworCX0KIAogCWt2bV9tbXVfZ2ZuX2Rpc2FsbG93X2xwYWdlKHNsb3QsIGdmbik7CiB9CkBA
IC0xMjU0LDkgKzEyNTgsMTMgQEAgc3RhdGljIHZvaWQgdW5hY2NvdW50X3NoYWRvd2VkKHN0cnVj
dCBrdm0gKmt2bSwgc3RydWN0IGt2bV9tbXVfcGFnZSAqc3ApCiAJZ2ZuID0gc3AtPmdmbjsKIAlz
bG90cyA9IGt2bV9tZW1zbG90c19mb3Jfc3B0ZV9yb2xlKGt2bSwgc3AtPnJvbGUpOwogCXNsb3Qg
PSBfX2dmbl90b19tZW1zbG90KHNsb3RzLCBnZm4pOwotCWlmIChzcC0+cm9sZS5sZXZlbCA+IFBH
X0xFVkVMXzRLKQotCQlyZXR1cm4ga3ZtX3Nsb3RfcGFnZV90cmFja19yZW1vdmVfcGFnZShrdm0s
IHNsb3QsIGdmbiwKLQkJCQkJCSAgICAgICBLVk1fUEFHRV9UUkFDS19XUklURSk7CisJaWYgKHNw
LT5yb2xlLmxldmVsID4gUEdfTEVWRUxfNEspIHsKKwkJa3ZtX3Nsb3RfcGFnZV90cmFja19yZW1v
dmVfcGFnZShrdm0sIHNsb3QsIGdmbiwKKwkJCQkJCUtWTV9QQUdFX1RSQUNLX1BSRVdSSVRFKTsK
KwkJa3ZtX3Nsb3RfcGFnZV90cmFja19yZW1vdmVfcGFnZShrdm0sIHNsb3QsIGdmbiwKKwkJCQkJ
CUtWTV9QQUdFX1RSQUNLX1dSSVRFKTsKKwkJcmV0dXJuOworCX0KIAogCWt2bV9tbXVfZ2ZuX2Fs
bG93X2xwYWdlKHNsb3QsIGdmbik7CiB9CkBAIC0yOTg3LDcgKzI5OTUsOCBAQCBzdGF0aWMgYm9v
bCBtbXVfbmVlZF93cml0ZV9wcm90ZWN0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgZ2ZuX3QgZ2Zu
LAogewogCXN0cnVjdCBrdm1fbW11X3BhZ2UgKnNwOwogCi0JaWYgKGt2bV9wYWdlX3RyYWNrX2lz
X2FjdGl2ZSh2Y3B1LCBnZm4sIEtWTV9QQUdFX1RSQUNLX1dSSVRFKSkKKwlpZiAoa3ZtX3BhZ2Vf
dHJhY2tfaXNfYWN0aXZlKHZjcHUsIGdmbiwgS1ZNX1BBR0VfVFJBQ0tfUFJFV1JJVEUpIHx8CisJ
ICAgIGt2bV9wYWdlX3RyYWNrX2lzX2FjdGl2ZSh2Y3B1LCBnZm4sIEtWTV9QQUdFX1RSQUNLX1dS
SVRFKSkKIAkJcmV0dXJuIHRydWU7CiAKIAlmb3JfZWFjaF9nZm5faW5kaXJlY3RfdmFsaWRfc3Ao
dmNwdS0+a3ZtLCBzcCwgZ2ZuKSB7CkBAIC0zNDA1LDYgKzM0MTQsMjEgQEAgc3RhdGljIHZvaWQg
ZGlzYWxsb3dlZF9odWdlcGFnZV9hZGp1c3Qoc3RydWN0IGt2bV9zaGFkb3dfd2Fsa19pdGVyYXRv
ciBpdCwKIAl9CiB9CiAKK3N0YXRpYyB1bnNpZ25lZCBpbnQga3ZtX21tdV9hcHBseV9pbnRyb3Nw
ZWN0aW9uX2FjY2VzcyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCisJCQkJCQkJZ2ZuX3QgZ2ZuLAor
CQkJCQkJCXVuc2lnbmVkIGludCBhY2MpCit7CisJaWYgKGt2bV9wYWdlX3RyYWNrX2lzX2FjdGl2
ZSh2Y3B1LCBnZm4sIEtWTV9QQUdFX1RSQUNLX1BSRVJFQUQpKQorCQlhY2MgJj0gfkFDQ19VU0VS
X01BU0s7CisJaWYgKGt2bV9wYWdlX3RyYWNrX2lzX2FjdGl2ZSh2Y3B1LCBnZm4sIEtWTV9QQUdF
X1RSQUNLX1BSRVdSSVRFKSB8fAorCSAgICBrdm1fcGFnZV90cmFja19pc19hY3RpdmUodmNwdSwg
Z2ZuLCBLVk1fUEFHRV9UUkFDS19XUklURSkpCisJCWFjYyAmPSB+QUNDX1dSSVRFX01BU0s7CisJ
aWYgKGt2bV9wYWdlX3RyYWNrX2lzX2FjdGl2ZSh2Y3B1LCBnZm4sIEtWTV9QQUdFX1RSQUNLX1BS
RUVYRUMpKQorCQlhY2MgJj0gfkFDQ19FWEVDX01BU0s7CisKKwlyZXR1cm4gYWNjOworfQorCiBz
dGF0aWMgaW50IF9fZGlyZWN0X21hcChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGdwYV90IGdwYSwg
aW50IHdyaXRlLAogCQkJaW50IG1hcF93cml0YWJsZSwgaW50IG1heF9sZXZlbCwga3ZtX3Bmbl90
IHBmbiwKIAkJCWJvb2wgcHJlZmF1bHQsIGJvb2wgYWNjb3VudF9kaXNhbGxvd2VkX254X2xwYWdl
KQpAQCAtMzQxNCw2ICszNDM4LDcgQEAgc3RhdGljIGludCBfX2RpcmVjdF9tYXAoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1LCBncGFfdCBncGEsIGludCB3cml0ZSwKIAlpbnQgbGV2ZWwsIHJldDsKIAln
Zm5fdCBnZm4gPSBncGEgPj4gUEFHRV9TSElGVDsKIAlnZm5fdCBiYXNlX2dmbiA9IGdmbjsKKwl1
bnNpZ25lZCBpbnQgYWNjOwogCiAJaWYgKFdBUk5fT04oIVZBTElEX1BBR0UodmNwdS0+YXJjaC5t
bXUtPnJvb3RfaHBhKSkpCiAJCXJldHVybiBSRVRfUEZfUkVUUlk7CkBAIC0zNDQzLDcgKzM0Njgs
OSBAQCBzdGF0aWMgaW50IF9fZGlyZWN0X21hcChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGdwYV90
IGdwYSwgaW50IHdyaXRlLAogCQl9CiAJfQogCi0JcmV0ID0gbW11X3NldF9zcHRlKHZjcHUsIGl0
LnNwdGVwLCBBQ0NfQUxMLAorCWFjYyA9IGt2bV9tbXVfYXBwbHlfaW50cm9zcGVjdGlvbl9hY2Nl
c3ModmNwdSwgYmFzZV9nZm4sIEFDQ19BTEwpOworCisJcmV0ID0gbW11X3NldF9zcHRlKHZjcHUs
IGl0LnNwdGVwLCBhY2MsCiAJCQkgICB3cml0ZSwgbGV2ZWwsIGJhc2VfZ2ZuLCBwZm4sIHByZWZh
dWx0LAogCQkJICAgbWFwX3dyaXRhYmxlKTsKIAlkaXJlY3RfcHRlX3ByZWZldGNoKHZjcHUsIGl0
LnNwdGVwKTsKQEAgLTQwOTgsMTUgKzQxMjUsMTggQEAgc3RhdGljIGJvb2wgcGFnZV9mYXVsdF9o
YW5kbGVfcGFnZV90cmFjayhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJaWYgKHVubGlrZWx5KGVy
cm9yX2NvZGUgJiBQRkVSUl9SU1ZEX01BU0spKQogCQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAoIShl
cnJvcl9jb2RlICYgUEZFUlJfUFJFU0VOVF9NQVNLKSB8fAotCSAgICAgICEoZXJyb3JfY29kZSAm
IFBGRVJSX1dSSVRFX01BU0spKQotCQlyZXR1cm4gZmFsc2U7Ci0KIAkvKgotCSAqIGd1ZXN0IGlz
IHdyaXRpbmcgdGhlIHBhZ2Ugd2hpY2ggaXMgd3JpdGUgdHJhY2tlZCB3aGljaCBjYW4KKwkgKiBn
dWVzdCBpcyByZWFkaW5nL3dyaXRpbmcvZmV0Y2hpbmcgdGhlIHBhZ2Ugd2hpY2ggaXMKKwkgKiBy
ZWFkL3dyaXRlL2V4ZWN1dGUgdHJhY2tlZCB3aGljaCBjYW4KIAkgKiBub3QgYmUgZml4ZWQgYnkg
cGFnZSBmYXVsdCBoYW5kbGVyLgogCSAqLwotCWlmIChrdm1fcGFnZV90cmFja19pc19hY3RpdmUo
dmNwdSwgZ2ZuLCBLVk1fUEFHRV9UUkFDS19XUklURSkpCisJaWYgKCgoZXJyb3JfY29kZSAmIFBG
RVJSX1VTRVJfTUFTSykKKwkJJiYga3ZtX3BhZ2VfdHJhY2tfaXNfYWN0aXZlKHZjcHUsIGdmbiwg
S1ZNX1BBR0VfVFJBQ0tfUFJFUkVBRCkpCisJICAgIHx8ICgoZXJyb3JfY29kZSAmIFBGRVJSX1dS
SVRFX01BU0spCisJCSYmIChrdm1fcGFnZV90cmFja19pc19hY3RpdmUodmNwdSwgZ2ZuLCBLVk1f
UEFHRV9UUkFDS19QUkVXUklURSkKKwkJIHx8IGt2bV9wYWdlX3RyYWNrX2lzX2FjdGl2ZSh2Y3B1
LCBnZm4sIEtWTV9QQUdFX1RSQUNLX1dSSVRFKSkpCisJICAgIHx8ICgoZXJyb3JfY29kZSAmIFBG
RVJSX0ZFVENIX01BU0spCisJCSYmIGt2bV9wYWdlX3RyYWNrX2lzX2FjdGl2ZSh2Y3B1LCBnZm4s
IEtWTV9QQUdFX1RSQUNLX1BSRUVYRUMpKSkKIAkJcmV0dXJuIHRydWU7CiAKIAlyZXR1cm4gZmFs
c2U7CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0veDg2LmMgYi9hcmNoL3g4Ni9rdm0veDg2LmMK
aW5kZXggODM0MjQzMzllYTlkLi43NjY4Y2E1YjhhN2EgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2
bS94ODYuYworKysgYi9hcmNoL3g4Ni9rdm0veDg2LmMKQEAgLTU1MTksNiArNTUxOSw4IEBAIHN0
YXRpYyBpbnQga3ZtX3JlYWRfZ3Vlc3RfdmlydF9oZWxwZXIoZ3ZhX3QgYWRkciwgdm9pZCAqdmFs
LCB1bnNpZ25lZCBpbnQgYnl0ZXMsCiAKIAkJaWYgKGdwYSA9PSBVTk1BUFBFRF9HVkEpCiAJCQly
ZXR1cm4gWDg2RU1VTF9QUk9QQUdBVEVfRkFVTFQ7CisJCWlmICgha3ZtX3BhZ2VfdHJhY2tfcHJl
cmVhZCh2Y3B1LCBncGEsIGFkZHIsIHRvcmVhZCkpCisJCQlyZXR1cm4gWDg2RU1VTF9SRVRSWV9J
TlNUUjsKIAkJcmV0ID0ga3ZtX3ZjcHVfcmVhZF9ndWVzdF9wYWdlKHZjcHUsIGdwYSA+PiBQQUdF
X1NISUZULCBkYXRhLAogCQkJCQkgICAgICAgb2Zmc2V0LCB0b3JlYWQpOwogCQlpZiAocmV0IDwg
MCkgewpAQCAtNTU1MCw2ICs1NTUyLDkgQEAgc3RhdGljIGludCBrdm1fZmV0Y2hfZ3Vlc3Rfdmly
dChzdHJ1Y3QgeDg2X2VtdWxhdGVfY3R4dCAqY3R4dCwKIAlpZiAodW5saWtlbHkoZ3BhID09IFVO
TUFQUEVEX0dWQSkpCiAJCXJldHVybiBYODZFTVVMX1BST1BBR0FURV9GQVVMVDsKIAorCWlmICgh
a3ZtX3BhZ2VfdHJhY2tfcHJlZXhlYyh2Y3B1LCBncGEsIGFkZHIpKQorCQlyZXR1cm4gWDg2RU1V
TF9SRVRSWV9JTlNUUjsKKwogCW9mZnNldCA9IGFkZHIgJiAoUEFHRV9TSVpFLTEpOwogCWlmIChX
QVJOX09OKG9mZnNldCArIGJ5dGVzID4gUEFHRV9TSVpFKSkKIAkJYnl0ZXMgPSAodW5zaWduZWQp
UEFHRV9TSVpFIC0gb2Zmc2V0OwpAQCAtNTYxOCwxMSArNTYyMywxNCBAQCBzdGF0aWMgaW50IGt2
bV93cml0ZV9ndWVzdF92aXJ0X2hlbHBlcihndmFfdCBhZGRyLCB2b2lkICp2YWwsIHVuc2lnbmVk
IGludCBieXRlcwogCiAJCWlmIChncGEgPT0gVU5NQVBQRURfR1ZBKQogCQkJcmV0dXJuIFg4NkVN
VUxfUFJPUEFHQVRFX0ZBVUxUOworCQlpZiAoIWt2bV9wYWdlX3RyYWNrX3ByZXdyaXRlKHZjcHUs
IGdwYSwgYWRkciwgZGF0YSwgdG93cml0ZSkpCisJCQlyZXR1cm4gWDg2RU1VTF9SRVRSWV9JTlNU
UjsKIAkJcmV0ID0ga3ZtX3ZjcHVfd3JpdGVfZ3Vlc3QodmNwdSwgZ3BhLCBkYXRhLCB0b3dyaXRl
KTsKIAkJaWYgKHJldCA8IDApIHsKIAkJCXIgPSBYODZFTVVMX0lPX05FRURFRDsKIAkJCWdvdG8g
b3V0OwogCQl9CisJCWt2bV9wYWdlX3RyYWNrX3dyaXRlKHZjcHUsIGdwYSwgYWRkciwgZGF0YSwg
dG93cml0ZSk7CiAKIAkJYnl0ZXMgLT0gdG93cml0ZTsKIAkJZGF0YSArPSB0b3dyaXRlOwpAQCAt
NTcyMywxMyArNTczMSwyMiBAQCBzdGF0aWMgaW50IHZjcHVfbW1pb19ndmFfdG9fZ3BhKHN0cnVj
dCBrdm1fdmNwdSAqdmNwdSwgdW5zaWduZWQgbG9uZyBndmEsCiBpbnQgZW11bGF0b3Jfd3JpdGVf
cGh5cyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGdwYV90IGdwYSwgZ3ZhX3QgZ3ZhLAogCQkJY29u
c3Qgdm9pZCAqdmFsLCBpbnQgYnl0ZXMpCiB7Ci0JaW50IHJldDsKLQotCXJldCA9IGt2bV92Y3B1
X3dyaXRlX2d1ZXN0KHZjcHUsIGdwYSwgdmFsLCBieXRlcyk7Ci0JaWYgKHJldCA8IDApCi0JCXJl
dHVybiAwOworCWlmICgha3ZtX3BhZ2VfdHJhY2tfcHJld3JpdGUodmNwdSwgZ3BhLCBndmEsIHZh
bCwgYnl0ZXMpKQorCQlyZXR1cm4gWDg2RU1VTF9SRVRSWV9JTlNUUjsKKwlpZiAoa3ZtX3ZjcHVf
d3JpdGVfZ3Vlc3QodmNwdSwgZ3BhLCB2YWwsIGJ5dGVzKSA8IDApCisJCXJldHVybiBYODZFTVVM
X1VOSEFORExFQUJMRTsKIAlrdm1fcGFnZV90cmFja193cml0ZSh2Y3B1LCBncGEsIGd2YSwgdmFs
LCBieXRlcyk7Ci0JcmV0dXJuIDE7CisJcmV0dXJuIFg4NkVNVUxfQ09OVElOVUU7Cit9CisKK3N0
YXRpYyBpbnQgZW11bGF0b3JfcmVhZF9waHlzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgZ3BhX3Qg
Z3BhLCBndmFfdCBndmEsCisJCQkgICAgICB2b2lkICp2YWwsIGludCBieXRlcykKK3sKKwlpZiAo
IWt2bV9wYWdlX3RyYWNrX3ByZXJlYWQodmNwdSwgZ3BhLCBndmEsIGJ5dGVzKSkKKwkJcmV0dXJu
IFg4NkVNVUxfUkVUUllfSU5TVFI7CisJaWYgKGt2bV92Y3B1X3JlYWRfZ3Vlc3QodmNwdSwgZ3Bh
LCB2YWwsIGJ5dGVzKSA8IDApCisJCXJldHVybiBYODZFTVVMX1VOSEFORExFQUJMRTsKKwlyZXR1
cm4gWDg2RU1VTF9DT05USU5VRTsKIH0KIAogc3RydWN0IHJlYWRfd3JpdGVfZW11bGF0b3Jfb3Bz
IHsKQEAgLTU3NTksNyArNTc3Niw3IEBAIHN0YXRpYyBpbnQgcmVhZF9wcmVwYXJlKHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSwgdm9pZCAqdmFsLCBpbnQgYnl0ZXMpCiBzdGF0aWMgaW50IHJlYWRfZW11
bGF0ZShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGdwYV90IGdwYSwgZ3ZhX3QgZ3ZhLAogCQkJdm9p
ZCAqdmFsLCBpbnQgYnl0ZXMpCiB7Ci0JcmV0dXJuICFrdm1fdmNwdV9yZWFkX2d1ZXN0KHZjcHUs
IGdwYSwgdmFsLCBieXRlcyk7CisJcmV0dXJuIGVtdWxhdG9yX3JlYWRfcGh5cyh2Y3B1LCBncGEs
IGd2YSwgdmFsLCBieXRlcyk7CiB9CiAKIHN0YXRpYyBpbnQgd3JpdGVfZW11bGF0ZShzdHJ1Y3Qg
a3ZtX3ZjcHUgKnZjcHUsIGdwYV90IGdwYSwgZ3ZhX3QgZ3ZhLApAQCAtNTgzMyw4ICs1ODUwLDEx
IEBAIHN0YXRpYyBpbnQgZW11bGF0b3JfcmVhZF93cml0ZV9vbmVwYWdlKHVuc2lnbmVkIGxvbmcg
YWRkciwgdm9pZCAqdmFsLAogCQkJcmV0dXJuIFg4NkVNVUxfUFJPUEFHQVRFX0ZBVUxUOwogCX0K
IAotCWlmICghcmV0ICYmIG9wcy0+cmVhZF93cml0ZV9lbXVsYXRlKHZjcHUsIGdwYSwgYWRkciwg
dmFsLCBieXRlcykpCi0JCXJldHVybiBYODZFTVVMX0NPTlRJTlVFOworCWlmICghcmV0KSB7CisJ
CXJldCA9IG9wcy0+cmVhZF93cml0ZV9lbXVsYXRlKHZjcHUsIGdwYSwgYWRkciwgdmFsLCBieXRl
cyk7CisJCWlmIChyZXQgPT0gWDg2RU1VTF9DT05USU5VRSB8fCByZXQgPT0gWDg2RU1VTF9SRVRS
WV9JTlNUUikKKwkJCXJldHVybiByZXQ7CisJfQogCiAJLyoKIAkgKiBJcyB0aGlzIE1NSU8gaGFu
ZGxlZCBsb2NhbGx5PwpAQCAtNTk3OCw2ICs1OTk4LDkgQEAgc3RhdGljIGludCBlbXVsYXRvcl9j
bXB4Y2hnX2VtdWxhdGVkKHN0cnVjdCB4ODZfZW11bGF0ZV9jdHh0ICpjdHh0LAogCWlmIChrdm1f
dmNwdV9tYXAodmNwdSwgZ3BhX3RvX2dmbihncGEpLCAmbWFwKSkKIAkJZ290byBlbXVsX3dyaXRl
OwogCisJaWYgKCFrdm1fcGFnZV90cmFja19wcmV3cml0ZSh2Y3B1LCBncGEsIGFkZHIsIG5ldywg
Ynl0ZXMpKQorCQlyZXR1cm4gWDg2RU1VTF9SRVRSWV9JTlNUUjsKKwogCWthZGRyID0gbWFwLmh2
YSArIG9mZnNldF9pbl9wYWdlKGdwYSk7CiAKIAlzd2l0Y2ggKGJ5dGVzKSB7CkBAIC02OTA0LDYg
KzY5MjcsOCBAQCBpbnQgeDg2X2VtdWxhdGVfaW5zdHJ1Y3Rpb24oc3RydWN0IGt2bV92Y3B1ICp2
Y3B1LCBncGFfdCBjcjJfb3JfZ3BhLAogCiAJCXRyYWNlX2t2bV9lbXVsYXRlX2luc25fc3RhcnQo
dmNwdSk7CiAJCSsrdmNwdS0+c3RhdC5pbnNuX2VtdWxhdGlvbjsKKwkJaWYgKHIgPT0gRU1VTEFU
SU9OX1JFVFJZX0lOU1RSKQorCQkJcmV0dXJuIDE7CiAJCWlmIChyICE9IEVNVUxBVElPTl9PSykg
IHsKIAkJCWlmICgoZW11bGF0aW9uX3R5cGUgJiBFTVVMVFlQRV9UUkFQX1VEKSB8fAogCQkJICAg
IChlbXVsYXRpb25fdHlwZSAmIEVNVUxUWVBFX1RSQVBfVURfRk9SQ0VEKSkgewpAQCAtNjk3Myw2
ICs2OTk4LDggQEAgaW50IHg4Nl9lbXVsYXRlX2luc3RydWN0aW9uKHN0cnVjdCBrdm1fdmNwdSAq
dmNwdSwgZ3BhX3QgY3IyX29yX2dwYSwKIAogCXIgPSB4ODZfZW11bGF0ZV9pbnNuKGN0eHQpOwog
CisJaWYgKHIgPT0gRU1VTEFUSU9OX1JFVFJZX0lOU1RSKQorCQlyZXR1cm4gMTsKIAlpZiAociA9
PSBFTVVMQVRJT05fSU5URVJDRVBURUQpCiAJCXJldHVybiAxOwogCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlz
dApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3Rz
LmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
