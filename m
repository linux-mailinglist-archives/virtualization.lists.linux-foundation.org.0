Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id 85A05228B34
	for <lists.virtualization@lfdr.de>; Tue, 21 Jul 2020 23:26:21 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 342A288418;
	Tue, 21 Jul 2020 21:26:20 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id gI5IOZ4Xl0uc; Tue, 21 Jul 2020 21:26:11 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id BA29988419;
	Tue, 21 Jul 2020 21:26:11 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id A6D11C088E;
	Tue, 21 Jul 2020 21:26:11 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 3C46EC016F
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:05 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 2B2C28832B
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:05 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id zVyctdl4hnvK
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:55 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id D856488236
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:54 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 9A456305D4FA; Wed, 22 Jul 2020 00:09:29 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 71989304FA13;
 Wed, 22 Jul 2020 00:09:29 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v9 66/84] KVM: introspection: add KVMI_VCPU_INJECT_EXCEPTION +
 KVMI_EVENT_TRAP
Date: Wed, 22 Jul 2020 00:09:04 +0300
Message-Id: <20200721210922.7646-67-alazar@bitdefender.com>
In-Reply-To: <20200721210922.7646-1-alazar@bitdefender.com>
References: <20200721210922.7646-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <ncitu@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhlIEtWTUlfVkNQ
VV9JTkpFQ1RfRVhDRVBUSU9OIGNvbW1hbmQgaXMgdXNlZCBieSB0aGUgaW50cm9zcGVjdGlvbiB0
b29sCnRvIGluamVjdCBleGNlcHRpb25zLCBmb3IgZXhhbXBsZSwgdG8gZ2V0IGEgcGFnZSBmcm9t
IHN3YXAuCgpUaGUgZXhjZXB0aW9uIGlzIHF1ZXVlZCByaWdodCBiZWZvcmUgZW50ZXJpbmcgaW4g
Z3Vlc3QgdW5sZXNzIHRoZXJlIGlzCmFscmVhZHkgYW4gZXhjZXB0aW9uIHBlbmRpbmcuIFRoZSBp
bnRyb3NwZWN0aW9uIHRvb2wgaXMgbm90aWZpZWQgd2l0aAphbiBLVk1JX0VWRU5UX1RSQVAgZXZl
bnQgYWJvdXQgdGhlIHN1Y2Nlc3Mgb2YgdGhlIGluamVjdGlvbi4gIEluIGNhc2UKb2YgZmFpbHVy
ZSwgdGhlIGludHJvc3BlY2lvbiB0b29sIGlzIGV4cGVjdGVkIHRvIHRyeSBhZ2FpbiBsYXRlci4K
ClNpZ25lZC1vZmYtYnk6IE1paGFpIERvbsibdSA8bWRvbnR1QGJpdGRlZmVuZGVyLmNvbT4KQ28t
ZGV2ZWxvcGVkLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5jaXR1QGJpdGRlZmVuZGVyLmNvbT4KU2ln
bmVkLW9mZi1ieTogTmljdciZb3IgQ8OuyJt1IDxuY2l0dUBiaXRkZWZlbmRlci5jb20+CkNvLWRl
dmVsb3BlZC1ieTogQWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgpTaWdu
ZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQog
RG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCAgICAgICAgICAgICAgIHwgIDc0ICsrKysr
KysrKysrCiBhcmNoL3g4Ni9rdm0va3ZtaS5jICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAx
MDMgKysrKysrKysrKysrKysrKwogYXJjaC94ODYva3ZtL3g4Ni5jICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHwgICAzICsKIGluY2x1ZGUvbGludXgva3ZtaV9ob3N0LmggICAgICAgICAgICAg
ICAgICAgICB8ICAxMiArKwogaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaCAgICAgICAgICAgICAg
ICAgICAgIHwgIDIwICsrLQogLi4uL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90
ZXN0LmMgIHwgMTE1ICsrKysrKysrKysrKysrKysrLQogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pLmMgICAgICAgICAgICAgICAgIHwgIDQ1ICsrKysrKysKIHZpcnQva3ZtL2ludHJvc3BlY3Rp
b24va3ZtaV9pbnQuaCAgICAgICAgICAgICB8ICAgOCArKwogdmlydC9rdm0vaW50cm9zcGVjdGlv
bi9rdm1pX21zZy5jICAgICAgICAgICAgIHwgIDUwICsrKysrKy0tCiA5IGZpbGVzIGNoYW5nZWQs
IDQxOCBpbnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9Eb2N1bWVu
dGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJz
dAppbmRleCBlMWY5NzhmYzc5OWIuLjQyNjNhOWFjOTBlNCAxMDA2NDQKLS0tIGEvRG9jdW1lbnRh
dGlvbi92aXJ0L2t2bS9rdm1pLnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWku
cnN0CkBAIC01NjEsNiArNTYxLDcgQEAgYmVjYXVzZSB0aGVzZSBhcmUgc2VudCBhcyBhIHJlc3Vs
dCBvZiBjZXJ0YWluIGNvbW1hbmRzIChidXQgdGhleSBjYW4gYmUKIGRpc2FsbG93ZWQgYnkgdGhl
IGRldmljZSBtYW5hZ2VyKSA6OgogCiAJS1ZNSV9FVkVOVF9QQVVTRV9WQ1BVCisJS1ZNSV9FVkVO
VF9UUkFQCiAKIFRoZSBWTSBldmVudHMgKGUuZy4gKktWTUlfRVZFTlRfVU5IT09LKikgYXJlIGNv
bnRyb2xsZWQgd2l0aAogdGhlICpLVk1JX1ZNX0NPTlRST0xfRVZFTlRTKiBjb21tYW5kLgpAQCAt
NzQ5LDYgKzc1MCw0NSBAQCBJRCBzZXQuCiAqIC1LVk1fRUlOVkFMIC0gdGhlIHBhZGRpbmcgaXMg
bm90IHplcm8KICogLUtWTV9FQUdBSU4gLSB0aGUgc2VsZWN0ZWQgdkNQVSBjYW4ndCBiZSBpbnRy
b3NwZWN0ZWQgeWV0CiAKKzE2LiBLVk1JX1ZDUFVfSU5KRUNUX0VYQ0VQVElPTgorLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKKzpBcmNoaXRlY3R1cmVzOiBhbGwKKzpWZXJzaW9uczog
Pj0gMQorOlBhcmFtZXRlcnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2hkcjsKKwlzdHJ1
Y3Qga3ZtaV92Y3B1X2luamVjdF9leGNlcHRpb24geworCQlfX3U4IG5yOworCQlfX3U4IHBhZGRp
bmcxOworCQlfX3UxNiBwYWRkaW5nMjsKKwkJX191MzIgZXJyb3JfY29kZTsKKwkJX191NjQgYWRk
cmVzczsKKwl9OworCis6UmV0dXJuczoKKworOjoKKworCXN0cnVjdCBrdm1pX2Vycm9yX2NvZGUK
KworSW5qZWN0cyBhIHZDUFUgZXhjZXB0aW9uIHdpdGggb3Igd2l0aG91dCBhbiBlcnJvciBjb2Rl
LiBJbiBjYXNlIG9mIHBhZ2UgZmF1bHQKK2V4Y2VwdGlvbiwgdGhlIGd1ZXN0IHZpcnR1YWwgYWRk
cmVzcyBoYXMgdG8gYmUgc3BlY2lmaWVkLgorCitUaGUgKktWTUlfRVZFTlRfVFJBUCogZXZlbnQg
d2lsbCBiZSBzZW50IHdpdGggdGhlIGVmZmVjdGl2ZSBpbmplY3RlZAorZXhjZXB0aW9uLgorCis6
RXJyb3JzOgorCisqIC1LVk1fRVBFUk0gIC0gdGhlICpLVk1JX0VWRU5UX1RSQVAqIGV2ZW50IGlz
IGRpc2FsbG93ZWQKKyogLUtWTV9FSU5WQUwgLSB0aGUgc2VsZWN0ZWQgdkNQVSBpcyBpbnZhbGlk
CisqIC1LVk1fRUlOVkFMIC0gdGhlIHBhZGRpbmcgaXMgbm90IHplcm8KKyogLUtWTV9FQUdBSU4g
LSB0aGUgc2VsZWN0ZWQgdkNQVSBjYW4ndCBiZSBpbnRyb3NwZWN0ZWQgeWV0CisqIC1LVk1fRUJV
U1kgLSBhbm90aGVyICpLVk1JX1ZDUFVfSU5KRUNUX0VYQ0VQVElPTiotKktWTUlfRVZFTlRfVFJB
UCogcGFpcgorICAgICAgICAgICAgICAgaXMgaW4gcHJvZ3Jlc3MKKwogRXZlbnRzCiA9PT09PT0K
IApAQCAtOTYwLDMgKzEwMDAsMzcgQEAgcmVnaXN0ZXIgKHNlZSAqKktWTUlfVkNQVV9DT05UUk9M
X0VWRU5UUyoqKS4KIAogYGBrdm1pX2V2ZW50YGAsIHRoZSBjb250cm9sIHJlZ2lzdGVyIG51bWJl
ciwgdGhlIG9sZCB2YWx1ZSBhbmQgdGhlIG5ldyB2YWx1ZQogYXJlIHNlbnQgdG8gdGhlIGludHJv
c3BlY3Rpb24gdG9vbC4gVGhlICpDT05USU5VRSogYWN0aW9uIHdpbGwgc2V0IHRoZSBgYG5ld192
YWxgYC4KKworNi4gS1ZNSV9FVkVOVF9UUkFQCistLS0tLS0tLS0tLS0tLS0tLS0KKworOkFyY2hp
dGVjdHVyZXM6IGFsbAorOlZlcnNpb25zOiA+PSAxCis6QWN0aW9uczogQ09OVElOVUUsIENSQVNI
Cis6UGFyYW1ldGVyczoKKworOjoKKworCXN0cnVjdCBrdm1pX2V2ZW50OworCXN0cnVjdCBrdm1p
X2V2ZW50X3RyYXAgeworCQlfX3U4IG5yOworCQlfX3U4IHBhZGRpbmcxOworCQlfX3UxNiBwYWRk
aW5nMjsKKwkJX191MzIgZXJyb3JfY29kZTsKKwkJX191NjQgYWRkcmVzczsKKwl9OworCis6UmV0
dXJuczoKKworOjoKKworCXN0cnVjdCBrdm1pX3ZjcHVfaGRyOworCXN0cnVjdCBrdm1pX2V2ZW50
X3JlcGx5OworCitUaGlzIGV2ZW50IGlzIHNlbnQgaWYgYSBwcmV2aW91cyAqS1ZNSV9WQ1BVX0lO
SkVDVF9FWENFUFRJT04qIGNvbW1hbmQKK3Rvb2sgcGxhY2UuIEJlY2F1c2UgaXQgaGFzIGEgaGln
aCBwcmlvcml0eSwgaXQgd2lsbCBiZSBzZW50IGJlZm9yZSBhbnkKK290aGVyIHZDUFUgaW50cm9z
cGVjdGlvbiBldmVudC4KKworYGBrdm1pX2V2ZW50YGAsIGV4Y2VwdGlvbi9pbnRlcnJ1cHQgbnVt
YmVyLCBleGNlcHRpb24gY29kZQorKGBgZXJyb3JfY29kZWBgKSBhbmQgYWRkcmVzcyBhcmUgc2Vu
dCB0byB0aGUgaW50cm9zcGVjdGlvbiB0b29sLAord2hpY2ggc2hvdWxkIGNoZWNrIGlmIGl0cyBl
eGNlcHRpb24gaGFzIGJlZW4gaW5qZWN0ZWQgb3Igb3ZlcnJpZGRlbi4KZGlmZiAtLWdpdCBhL2Fy
Y2gveDg2L2t2bS9rdm1pLmMgYi9hcmNoL3g4Ni9rdm0va3ZtaS5jCmluZGV4IGUzNDBhMmMzNTAw
Zi4uMGM2YWIxMzYwODRmIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0va3ZtaS5jCisrKyBiL2Fy
Y2gveDg2L2t2bS9rdm1pLmMKQEAgLTU2OSwzICs1NjksMTA2IEBAIGJvb2wga3ZtaV9jcjNfaW50
ZXJjZXB0ZWQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogCXJldHVybiByZXQ7CiB9CiBFWFBPUlRf
U1lNQk9MKGt2bWlfY3IzX2ludGVyY2VwdGVkKTsKKworaW50IGt2bWlfYXJjaF9jbWRfdmNwdV9p
bmplY3RfZXhjZXB0aW9uKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTggdmVjdG9yLAorCQkJCQl1
MzIgZXJyb3JfY29kZSwgdTY0IGFkZHJlc3MpCit7CisJc3RydWN0IGt2bV92Y3B1X2ludHJvc3Bl
Y3Rpb24gKnZjcHVpID0gVkNQVUkodmNwdSk7CisJYm9vbCBoYXNfZXJyb3I7CisKKwlpZiAodmNw
dWktPmV4Y2VwdGlvbi5wZW5kaW5nIHx8IHZjcHVpLT5leGNlcHRpb24uc2VuZF9ldmVudCkKKwkJ
cmV0dXJuIC1LVk1fRUJVU1k7CisKKwl2Y3B1aS0+ZXhjZXB0aW9uLnBlbmRpbmcgPSB0cnVlOwor
CisJaGFzX2Vycm9yID0geDg2X2V4Y2VwdGlvbl9oYXNfZXJyb3JfY29kZSh2ZWN0b3IpOworCisJ
dmNwdWktPmV4Y2VwdGlvbi5uciA9IHZlY3RvcjsKKwl2Y3B1aS0+ZXhjZXB0aW9uLmVycm9yX2Nv
ZGUgPSBoYXNfZXJyb3IgPyBlcnJvcl9jb2RlIDogMDsKKwl2Y3B1aS0+ZXhjZXB0aW9uLmVycm9y
X2NvZGVfdmFsaWQgPSBoYXNfZXJyb3I7CisJdmNwdWktPmV4Y2VwdGlvbi5hZGRyZXNzID0gYWRk
cmVzczsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBrdm1pX2FyY2hfcXVldWVfZXhj
ZXB0aW9uKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKK3sKKwlzdHJ1Y3Qga3ZtX3ZjcHVfaW50cm9z
cGVjdGlvbiAqdmNwdWkgPSBWQ1BVSSh2Y3B1KTsKKwlzdHJ1Y3QgeDg2X2V4Y2VwdGlvbiBlID0g
eworCQkudmVjdG9yID0gdmNwdWktPmV4Y2VwdGlvbi5uciwKKwkJLmVycm9yX2NvZGVfdmFsaWQg
PSB2Y3B1aS0+ZXhjZXB0aW9uLmVycm9yX2NvZGVfdmFsaWQsCisJCS5lcnJvcl9jb2RlID0gdmNw
dWktPmV4Y2VwdGlvbi5lcnJvcl9jb2RlLAorCQkuYWRkcmVzcyA9IHZjcHVpLT5leGNlcHRpb24u
YWRkcmVzcywKKwl9OworCisJaWYgKGUudmVjdG9yID09IFBGX1ZFQ1RPUikKKwkJa3ZtX2luamVj
dF9wYWdlX2ZhdWx0KHZjcHUsICZlKTsKKwllbHNlIGlmIChlLmVycm9yX2NvZGVfdmFsaWQpCisJ
CWt2bV9xdWV1ZV9leGNlcHRpb25fZSh2Y3B1LCBlLnZlY3RvciwgZS5lcnJvcl9jb2RlKTsKKwll
bHNlCisJCWt2bV9xdWV1ZV9leGNlcHRpb24odmNwdSwgZS52ZWN0b3IpOworfQorCitzdGF0aWMg
dm9pZCBrdm1pX2FyY2hfc2F2ZV9pbmplY3RlZF9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUp
Cit7CisJc3RydWN0IGt2bV92Y3B1X2ludHJvc3BlY3Rpb24gKnZjcHVpID0gVkNQVUkodmNwdSk7
CisKKwl2Y3B1aS0+ZXhjZXB0aW9uLmVycm9yX2NvZGUgPSAwOworCXZjcHVpLT5leGNlcHRpb24u
ZXJyb3JfY29kZV92YWxpZCA9IGZhbHNlOworCisJdmNwdWktPmV4Y2VwdGlvbi5hZGRyZXNzID0g
dmNwdS0+YXJjaC5jcjI7CisJaWYgKHZjcHUtPmFyY2guZXhjZXB0aW9uLmluamVjdGVkKSB7CisJ
CXZjcHVpLT5leGNlcHRpb24ubnIgPSB2Y3B1LT5hcmNoLmV4Y2VwdGlvbi5ucjsKKwkJdmNwdWkt
PmV4Y2VwdGlvbi5lcnJvcl9jb2RlX3ZhbGlkID0KKwkJCXg4Nl9leGNlcHRpb25faGFzX2Vycm9y
X2NvZGUodmNwdS0+YXJjaC5leGNlcHRpb24ubnIpOworCQl2Y3B1aS0+ZXhjZXB0aW9uLmVycm9y
X2NvZGUgPSB2Y3B1LT5hcmNoLmV4Y2VwdGlvbi5lcnJvcl9jb2RlOworCX0gZWxzZSBpZiAodmNw
dS0+YXJjaC5pbnRlcnJ1cHQuaW5qZWN0ZWQpIHsKKwkJdmNwdWktPmV4Y2VwdGlvbi5uciA9IHZj
cHUtPmFyY2guaW50ZXJydXB0Lm5yOworCX0KK30KKwordm9pZCBrdm1pX2FyY2hfaW5qZWN0X2V4
Y2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCit7CisJaWYgKCFrdm1fZXZlbnRfbmVlZHNf
cmVpbmplY3Rpb24odmNwdSkpIHsKKwkJa3ZtaV9hcmNoX3F1ZXVlX2V4Y2VwdGlvbih2Y3B1KTsK
KwkJa3ZtX2luamVjdF9wZW5kaW5nX2V4Y2VwdGlvbih2Y3B1KTsKKwl9CisKKwlrdm1pX2FyY2hf
c2F2ZV9pbmplY3RlZF9ldmVudCh2Y3B1KTsKK30KKworc3RhdGljIHUzMiBrdm1pX3NlbmRfdHJh
cChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHU4IG5yLAorCQkJICB1MzIgZXJyb3JfY29kZSwgdTY0
IGFkZHIpCit7CisJc3RydWN0IGt2bWlfZXZlbnRfdHJhcCBlOworCWludCBlcnIsIGFjdGlvbjsK
KworCW1lbXNldCgmZSwgMCwgc2l6ZW9mKGUpKTsKKwllLm5yID0gbnI7CisJZS5lcnJvcl9jb2Rl
ID0gZXJyb3JfY29kZTsKKwllLmFkZHJlc3MgPSBhZGRyOworCisJZXJyID0gX19rdm1pX3NlbmRf
ZXZlbnQodmNwdSwgS1ZNSV9FVkVOVF9UUkFQLCAmZSwgc2l6ZW9mKGUpLAorCQkJCU5VTEwsIDAs
ICZhY3Rpb24pOworCWlmIChlcnIpCisJCXJldHVybiBLVk1JX0VWRU5UX0FDVElPTl9DT05USU5V
RTsKKworCXJldHVybiBhY3Rpb247Cit9CisKK3ZvaWQga3ZtaV9hcmNoX3NlbmRfdHJhcF9ldmVu
dChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCit7CisJc3RydWN0IGt2bV92Y3B1X2ludHJvc3BlY3Rp
b24gKnZjcHVpID0gVkNQVUkodmNwdSk7CisJdTMyIGFjdGlvbjsKKworCWFjdGlvbiA9IGt2bWlf
c2VuZF90cmFwKHZjcHUsIHZjcHVpLT5leGNlcHRpb24ubnIsCisJCQkJdmNwdWktPmV4Y2VwdGlv
bi5lcnJvcl9jb2RlLAorCQkJCXZjcHVpLT5leGNlcHRpb24uYWRkcmVzcyk7CisKKwlzd2l0Y2gg
KGFjdGlvbikgeworCWNhc2UgS1ZNSV9FVkVOVF9BQ1RJT05fQ09OVElOVUU6CisJCWJyZWFrOwor
CWRlZmF1bHQ6CisJCWt2bWlfaGFuZGxlX2NvbW1vbl9ldmVudF9hY3Rpb25zKHZjcHUtPmt2bSwg
YWN0aW9uKTsKKwl9Cit9CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0veDg2LmMgYi9hcmNoL3g4
Ni9rdm0veDg2LmMKaW5kZXggYTEyYWE4ZTEyNWQzLi5hZjk4N2FkMWExNzQgMTAwNjQ0Ci0tLSBh
L2FyY2gveDg2L2t2bS94ODYuYworKysgYi9hcmNoL3g4Ni9rdm0veDg2LmMKQEAgLTg1NjYsNiAr
ODU2Niw5IEBAIHN0YXRpYyBpbnQgdmNwdV9lbnRlcl9ndWVzdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUpCiAJCWdvdG8gY2FuY2VsX2luamVjdGlvbjsKIAl9CiAKKwlpZiAoIWt2bWlfZW50ZXJfZ3Vl
c3QodmNwdSkpCisJCXJlcV9pbW1lZGlhdGVfZXhpdCA9IHRydWU7CisKIAlpZiAocmVxX2ltbWVk
aWF0ZV9leGl0KSB7CiAJCWt2bV9tYWtlX3JlcXVlc3QoS1ZNX1JFUV9FVkVOVCwgdmNwdSk7CiAJ
CWt2bV94ODZfb3BzLnJlcXVlc3RfaW1tZWRpYXRlX2V4aXQodmNwdSk7CmRpZmYgLS1naXQgYS9p
bmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oIGIvaW5jbHVkZS9saW51eC9rdm1pX2hvc3QuaAppbmRl
eCAwMTIxOWM1NmQwNDIuLjFmYWU1ODlkOWQzNSAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9r
dm1pX2hvc3QuaAorKysgYi9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCkBAIC0zNiw2ICszNiwx
NSBAQCBzdHJ1Y3Qga3ZtX3ZjcHVfaW50cm9zcGVjdGlvbiB7CiAKIAlzdHJ1Y3Qga3ZtX3JlZ3Mg
ZGVsYXllZF9yZWdzOwogCWJvb2wgaGF2ZV9kZWxheWVkX3JlZ3M7CisKKwlzdHJ1Y3QgeworCQl1
OCBucjsKKwkJdTMyIGVycm9yX2NvZGU7CisJCWJvb2wgZXJyb3JfY29kZV92YWxpZDsKKwkJdTY0
IGFkZHJlc3M7CisJCWJvb2wgcGVuZGluZzsKKwkJYm9vbCBzZW5kX2V2ZW50OworCX0gZXhjZXB0
aW9uOwogfTsKIAogc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uIHsKQEAgLTc2LDYgKzg1LDcgQEAg
aW50IGt2bWlfaW9jdGxfcHJldW5ob29rKHN0cnVjdCBrdm0gKmt2bSk7CiB2b2lkIGt2bWlfaGFu
ZGxlX3JlcXVlc3RzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiBib29sIGt2bWlfaHlwZXJjYWxs
X2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiBib29sIGt2bWlfYnJlYWtwb2ludF9ldmVu
dChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHU2NCBndmEsIHU4IGluc25fbGVuKTsKK2Jvb2wga3Zt
aV9lbnRlcl9ndWVzdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwogCiAjZWxzZQogCkBAIC05MCw2
ICsxMDAsOCBAQCBzdGF0aWMgaW5saW5lIGJvb2wga3ZtaV9oeXBlcmNhbGxfZXZlbnQoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1KSB7IHJldHVybiBmYWxzZTsgfQogc3RhdGljIGlubGluZSBib29sIGt2
bWlfYnJlYWtwb2ludF9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHU2NCBndmEsCiAJCQkJ
CSB1OCBpbnNuX2xlbikKIAkJCXsgcmV0dXJuIHRydWU7IH0KK3N0YXRpYyBpbmxpbmUgYm9vbCBr
dm1pX2VudGVyX2d1ZXN0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKKwkJCXsgcmV0dXJuIHRydWU7
IH0KIAogI2VuZGlmIC8qIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCmRpZmYgLS1naXQg
YS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaApp
bmRleCBlMzFiNDc0ZTM0OTYuLmZhZjQ2MjRkN2E5NyAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBp
L2xpbnV4L2t2bWkuaAorKysgYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCkBAIC0zNCw3ICsz
NCw4IEBAIGVudW0gewogCiAJS1ZNSV9WTV9DT05UUk9MX0NMRUFOVVAgPSAxNCwKIAotCUtWTUlf
VkNQVV9DT05UUk9MX0NSID0gMTUsCisJS1ZNSV9WQ1BVX0NPTlRST0xfQ1IgICAgICAgPSAxNSwK
KwlLVk1JX1ZDUFVfSU5KRUNUX0VYQ0VQVElPTiA9IDE2LAogCiAJS1ZNSV9OVU1fTUVTU0FHRVMK
IH07CkBAIC00NSw2ICs0Niw3IEBAIGVudW0gewogCUtWTUlfRVZFTlRfSFlQRVJDQUxMICA9IDIs
CiAJS1ZNSV9FVkVOVF9CUkVBS1BPSU5UID0gMywKIAlLVk1JX0VWRU5UX0NSICAgICAgICAgPSA0
LAorCUtWTUlfRVZFTlRfVFJBUCAgICAgICA9IDUsCiAKIAlLVk1JX05VTV9FVkVOVFMKIH07CkBA
IC0xNjIsNCArMTY0LDIwIEBAIHN0cnVjdCBrdm1pX2V2ZW50X3JlcGx5IHsKIAlfX3UzMiBwYWRk
aW5nMjsKIH07CiAKK3N0cnVjdCBrdm1pX2V2ZW50X3RyYXAgeworCV9fdTggbnI7CisJX191OCBw
YWRkaW5nMTsKKwlfX3UxNiBwYWRkaW5nMjsKKwlfX3UzMiBlcnJvcl9jb2RlOworCV9fdTY0IGFk
ZHJlc3M7Cit9OworCitzdHJ1Y3Qga3ZtaV92Y3B1X2luamVjdF9leGNlcHRpb24geworCV9fdTgg
bnI7CisJX191OCBwYWRkaW5nMTsKKwlfX3UxNiBwYWRkaW5nMjsKKwlfX3UzMiBlcnJvcl9jb2Rl
OworCV9fdTY0IGFkZHJlc3M7Cit9OworCiAjZW5kaWYgLyogX1VBUElfX0xJTlVYX0tWTUlfSCAq
LwpkaWZmIC0tZ2l0IGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rl
c3QuYyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKaW5k
ZXggNzY5NGZhOGZlZjg5Li45YWJmNGVjMGQwOWEgMTAwNjQ0Ci0tLSBhL3Rvb2xzL3Rlc3Rpbmcv
c2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKKysrIGIvdG9vbHMvdGVzdGluZy9zZWxm
dGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYwpAQCAtNDUsNiArNDUsOCBAQCBzdHJ1Y3QgdmNw
dV93b3JrZXJfZGF0YSB7CiAJaW50IHZjcHVfaWQ7CiAJaW50IHRlc3RfaWQ7CiAJYm9vbCBzdG9w
OworCWJvb2wgc2h1dGRvd247CisJYm9vbCByZXN0YXJ0X29uX3NodXRkb3duOwogfTsKIAogZW51
bSB7CkBAIC02ODcsMTEgKzY4OSwxOSBAQCBzdGF0aWMgdm9pZCAqdmNwdV93b3JrZXIodm9pZCAq
ZGF0YSkKIAogCQl2Y3B1X3J1bihjdHgtPnZtLCBjdHgtPnZjcHVfaWQpOwogCi0JCVRFU1RfQVNT
RVJUKHJ1bi0+ZXhpdF9yZWFzb24gPT0gS1ZNX0VYSVRfSU8sCisJCVRFU1RfQVNTRVJUKHJ1bi0+
ZXhpdF9yZWFzb24gPT0gS1ZNX0VYSVRfSU8KKwkJCXx8IChydW4tPmV4aXRfcmVhc29uID09IEtW
TV9FWElUX1NIVVRET1dOCisJCQkJJiYgY3R4LT5zaHV0ZG93biksCiAJCQkidmNwdV9ydW4oKSBm
YWlsZWQsIHRlc3RfaWQgJWQsIGV4aXQgcmVhc29uICV1ICglcylcbiIsCiAJCQljdHgtPnRlc3Rf
aWQsIHJ1bi0+ZXhpdF9yZWFzb24sCiAJCQlleGl0X3JlYXNvbl9zdHIocnVuLT5leGl0X3JlYXNv
bikpOwogCisJCWlmIChydW4tPmV4aXRfcmVhc29uID09IEtWTV9FWElUX1NIVVRET1dOKSB7CisJ
CQlpZiAoY3R4LT5yZXN0YXJ0X29uX3NodXRkb3duKQorCQkJCWNvbnRpbnVlOworCQkJYnJlYWs7
CisJCX0KKwogCQlURVNUX0FTU0VSVChnZXRfdWNhbGwoY3R4LT52bSwgY3R4LT52Y3B1X2lkLCAm
dWMpLAogCQkJIk5vIGd1ZXN0IHJlcXVlc3RcbiIpOwogCkBAIC0xMzA4LDYgKzEzMTgsMTA4IEBA
IHN0YXRpYyB2b2lkIHRlc3RfY21kX3ZjcHVfY29udHJvbF9jcihzdHJ1Y3Qga3ZtX3ZtICp2bSkK
IAl0ZXN0X2ludmFsaWRfdmNwdV9jb250cm9sX2NyKHZtKTsKIH0KIAorc3RhdGljIHZvaWQgX19p
bmplY3RfZXhjZXB0aW9uKGludCBucikKK3sKKwlzdHJ1Y3QgeworCQlzdHJ1Y3Qga3ZtaV9tc2df
aGRyIGhkcjsKKwkJc3RydWN0IGt2bWlfdmNwdV9oZHIgdmNwdV9oZHI7CisJCXN0cnVjdCBrdm1p
X3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbiBjbWQ7CisJfSByZXEgPSB7fTsKKwlpbnQgcjsKKworCXJl
cS5jbWQubnIgPSBucjsKKworCXIgPSBfX2RvX3ZjcHUwX2NvbW1hbmQoS1ZNSV9WQ1BVX0lOSkVD
VF9FWENFUFRJT04sCisJCQkgICAgICAgJnJlcS5oZHIsIHNpemVvZihyZXEpLCBOVUxMLCAwKTsK
KwlURVNUX0FTU0VSVChyID09IDAsCisJCSJLVk1JX1ZDUFVfSU5KRUNUX0VYQ0VQVElPTiBmYWls
ZWQsIGVycm9yICVkKCVzKVxuIiwKKwkJLXIsIGt2bV9zdHJlcnJvcigtcikpOworfQorCitzdGF0
aWMgdm9pZCByZWNlaXZlX2V4Y2VwdGlvbl9ldmVudChpbnQgbnIpCit7CisJc3RydWN0IGt2bWlf
bXNnX2hkciBoZHI7CisJc3RydWN0IHsKKwkJc3RydWN0IGt2bWlfZXZlbnQgY29tbW9uOworCQlz
dHJ1Y3Qga3ZtaV9ldmVudF90cmFwIHRyYXA7CisJfSBldjsKKwlzdHJ1Y3QgdmNwdV9yZXBseSBy
cGwgPSB7fTsKKworCXJlY2VpdmVfZXZlbnQoJmhkciwgJmV2LmNvbW1vbiwgc2l6ZW9mKGV2KSwg
S1ZNSV9FVkVOVF9UUkFQKTsKKworCXByX2luZm8oIkV4Y2VwdGlvbiBldmVudDogdmVjdG9yICV1
LCBlcnJvcl9jb2RlIDB4JXgsIGFkZHJlc3MgMHglbGx4XG4iLAorCQlldi50cmFwLm5yLCBldi50
cmFwLmVycm9yX2NvZGUsIGV2LnRyYXAuYWRkcmVzcyk7CisKKwlURVNUX0FTU0VSVChldi50cmFw
Lm5yID09IG5yLAorCQkiSW5qZWN0ZWQgZXhjZXB0aW9uICV1IGluc3RlYWQgb2YgJXVcbiIsCisJ
CWV2LnRyYXAubnIsIG5yKTsKKworCXJlcGx5X3RvX2V2ZW50KCZoZHIsICZldi5jb21tb24sIEtW
TUlfRVZFTlRfQUNUSU9OX0NPTlRJTlVFLAorCQkJJnJwbCwgc2l6ZW9mKHJwbCkpOworfQorCitz
dGF0aWMgdm9pZCB0ZXN0X3N1Y2NlZGVkX3VkX2luamVjdGlvbih2b2lkKQoreworCV9fdTggdWRf
dmVjdG9yID0gNjsKKworCV9faW5qZWN0X2V4Y2VwdGlvbih1ZF92ZWN0b3IpOworCisJcmVjZWl2
ZV9leGNlcHRpb25fZXZlbnQodWRfdmVjdG9yKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9mYWls
ZWRfdWRfaW5qZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtLAorCQkJCSAgICAgc3RydWN0IHZjcHVf
d29ya2VyX2RhdGEgKmRhdGEpCit7CisJc3RydWN0IGt2bWlfbXNnX2hkciBoZHI7CisJc3RydWN0
IHsKKwkJc3RydWN0IGt2bWlfZXZlbnQgY29tbW9uOworCQlzdHJ1Y3Qga3ZtaV9ldmVudF9icmVh
a3BvaW50IGJwOworCX0gZXY7CisJc3RydWN0IHZjcHVfcmVwbHkgcnBsID0ge307CisJX191OCB1
ZF92ZWN0b3IgPSA2LCBicF92ZWN0b3IgPSAzOworCisJV1JJVEVfT05DRShkYXRhLT50ZXN0X2lk
LCBHVUVTVF9URVNUX0JQKTsKKworCXJlY2VpdmVfZXZlbnQoJmhkciwgJmV2LmNvbW1vbiwgc2l6
ZW9mKGV2KSwgS1ZNSV9FVkVOVF9CUkVBS1BPSU5UKTsKKworCS8qIHNraXAgdGhlIGJyZWFrcG9p
bnQgaW5zdHJ1Y3Rpb24sIG5leHQgdGltZSBndWVzdF9icF90ZXN0KCkgcnVucyAqLworCWV2LmNv
bW1vbi5hcmNoLnJlZ3MucmlwICs9IGV2LmJwLmluc25fbGVuOworCV9fc2V0X3JlZ2lzdGVycyh2
bSwgJmV2LmNvbW1vbi5hcmNoLnJlZ3MpOworCisJX19pbmplY3RfZXhjZXB0aW9uKHVkX3ZlY3Rv
cik7CisKKwkvKiByZWluamVjdCB0aGUgI0JQIGV4Y2VwdGlvbiBiZWNhdXNlIG9mIHRoZSBjb250
aW51ZSBhY3Rpb24gKi8KKwlyZXBseV90b19ldmVudCgmaGRyLCAmZXYuY29tbW9uLCBLVk1JX0VW
RU5UX0FDVElPTl9DT05USU5VRSwKKwkJCSZycGwsIHNpemVvZihycGwpKTsKKworCXJlY2VpdmVf
ZXhjZXB0aW9uX2V2ZW50KGJwX3ZlY3Rvcik7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfY21kX3Zj
cHVfaW5qZWN0X2V4Y2VwdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKK3sKKwlzdHJ1Y3QgdmNwdV93
b3JrZXJfZGF0YSBkYXRhID0geworCQkudm0gPSB2bSwKKwkJLnZjcHVfaWQgPSBWQ1BVX0lELAor
CQkuc2h1dGRvd24gPSB0cnVlLAorCQkucmVzdGFydF9vbl9zaHV0ZG93biA9IHRydWUsCisJfTsK
KwlwdGhyZWFkX3QgdmNwdV90aHJlYWQ7CisKKwlpZiAoIWlzX2ludGVsX2NwdSgpKSB7CisJCXBy
aW50X3NraXAoIlRPRE86ICVzKCkgLSBtYWtlIGl0IHdvcmsgd2l0aCBBTUQiLCBfX2Z1bmNfXyk7
CisJCXJldHVybjsKKwl9CisKKwllbmFibGVfdmNwdV9ldmVudCh2bSwgS1ZNSV9FVkVOVF9CUkVB
S1BPSU5UKTsKKwl2Y3B1X3RocmVhZCA9IHN0YXJ0X3ZjcHVfd29ya2VyKCZkYXRhKTsKKworCXRl
c3Rfc3VjY2VkZWRfdWRfaW5qZWN0aW9uKCk7CisJdGVzdF9mYWlsZWRfdWRfaW5qZWN0aW9uKHZt
LCAmZGF0YSk7CisKKwlzdG9wX3ZjcHVfd29ya2VyKHZjcHVfdGhyZWFkLCAmZGF0YSk7CisJZGlz
YWJsZV92Y3B1X2V2ZW50KHZtLCBLVk1JX0VWRU5UX0JSRUFLUE9JTlQpOworfQorCiBzdGF0aWMg
dm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAqdm0pCiB7CiAJc3JhbmRvbSh0
aW1lKDApKTsKQEAgLTEzMzIsNiArMTQ0NCw3IEBAIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVj
dGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIAl0ZXN0X2V2ZW50X2JyZWFrcG9pbnQodm0pOwogCXRl
c3RfY21kX3ZtX2NvbnRyb2xfY2xlYW51cCh2bSk7CiAJdGVzdF9jbWRfdmNwdV9jb250cm9sX2Ny
KHZtKTsKKwl0ZXN0X2NtZF92Y3B1X2luamVjdF9leGNlcHRpb24odm0pOwogCiAJdW5ob29rX2lu
dHJvc3BlY3Rpb24odm0pOwogfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwppbmRleCAyZGQ4MmFhNWUxMWMu
LmQ0YjM5ZDA4MDBlZSAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMK
KysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKQEAgLTEwMSw2ICsxMDEsNyBAQCBz
dGF0aWMgdm9pZCBzZXR1cF9rbm93bl9ldmVudHModm9pZCkKIAlzZXRfYml0KEtWTUlfRVZFTlRf
Q1IsIEt2bWlfa25vd25fdmNwdV9ldmVudHMpOwogCXNldF9iaXQoS1ZNSV9FVkVOVF9IWVBFUkNB
TEwsIEt2bWlfa25vd25fdmNwdV9ldmVudHMpOwogCXNldF9iaXQoS1ZNSV9FVkVOVF9QQVVTRV9W
Q1BVLCBLdm1pX2tub3duX3ZjcHVfZXZlbnRzKTsKKwlzZXRfYml0KEtWTUlfRVZFTlRfVFJBUCwg
S3ZtaV9rbm93bl92Y3B1X2V2ZW50cyk7CiAKIAliaXRtYXBfb3IoS3ZtaV9rbm93bl9ldmVudHMs
IEt2bWlfa25vd25fdm1fZXZlbnRzLAogCQkgIEt2bWlfa25vd25fdmNwdV9ldmVudHMsIEtWTUlf
TlVNX0VWRU5UUyk7CkBAIC04NTUsNiArODU2LDE2IEBAIHN0YXRpYyB2b2lkIGt2bWlfdmNwdV9w
YXVzZV9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJfQogfQogCit2b2lkIGt2bWlfc2Vu
ZF9wZW5kaW5nX2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKK3sKKwlzdHJ1Y3Qga3ZtX3Zj
cHVfaW50cm9zcGVjdGlvbiAqdmNwdWkgPSBWQ1BVSSh2Y3B1KTsKKworCWlmICh2Y3B1aS0+ZXhj
ZXB0aW9uLnNlbmRfZXZlbnQpIHsKKwkJdmNwdWktPmV4Y2VwdGlvbi5zZW5kX2V2ZW50ID0gZmFs
c2U7CisJCWt2bWlfYXJjaF9zZW5kX3RyYXBfZXZlbnQodmNwdSk7CisJfQorfQorCiB2b2lkIGt2
bWlfaGFuZGxlX3JlcXVlc3RzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIHsKIAlzdHJ1Y3Qga3Zt
X3ZjcHVfaW50cm9zcGVjdGlvbiAqdmNwdWkgPSBWQ1BVSSh2Y3B1KTsKQEAgLTg2NCw2ICs4NzUs
OCBAQCB2b2lkIGt2bWlfaGFuZGxlX3JlcXVlc3RzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAlp
ZiAoIWt2bWkpCiAJCWdvdG8gb3V0OwogCisJa3ZtaV9zZW5kX3BlbmRpbmdfZXZlbnQodmNwdSk7
CisKIAlmb3IgKDs7KSB7CiAJCWt2bWlfcnVuX2pvYnModmNwdSk7CiAKQEAgLTk2MiwzICs5NzUs
MzUgQEAgYm9vbCBrdm1pX2JyZWFrcG9pbnRfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1
NjQgZ3ZhLCB1OCBpbnNuX2xlbikKIAlyZXR1cm4gcmV0OwogfQogRVhQT1JUX1NZTUJPTChrdm1p
X2JyZWFrcG9pbnRfZXZlbnQpOworCitzdGF0aWMgdm9pZCBrdm1pX2luamVjdF9wZW5kaW5nX2V4
Y2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCit7CisJc3RydWN0IGt2bV92Y3B1X2ludHJv
c3BlY3Rpb24gKnZjcHVpID0gVkNQVUkodmNwdSk7CisKKwlrdm1pX2FyY2hfaW5qZWN0X2V4Y2Vw
dGlvbih2Y3B1KTsKKworCXZjcHVpLT5leGNlcHRpb24ucGVuZGluZyA9IGZhbHNlOworCXZjcHVp
LT5leGNlcHRpb24uc2VuZF9ldmVudCA9IHRydWU7CisJa3ZtX21ha2VfcmVxdWVzdChLVk1fUkVR
X0lOVFJPU1BFQ1RJT04sIHZjcHUpOworfQorCitib29sIGt2bWlfZW50ZXJfZ3Vlc3Qoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1KQoreworCXN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0aW9uICp2Y3B1
aTsKKwlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWk7CisJYm9vbCByID0gdHJ1ZTsKKwor
CWt2bWkgPSBrdm1pX2dldCh2Y3B1LT5rdm0pOworCWlmICgha3ZtaSkKKwkJcmV0dXJuIHRydWU7
CisKKwl2Y3B1aSA9IFZDUFVJKHZjcHUpOworCisJaWYgKHZjcHVpLT5leGNlcHRpb24ucGVuZGlu
ZykgeworCQlrdm1pX2luamVjdF9wZW5kaW5nX2V4Y2VwdGlvbih2Y3B1KTsKKwkJciA9IGZhbHNl
OworCX0KKworCWt2bWlfcHV0KHZjcHUtPmt2bSk7CisJcmV0dXJuIHI7Cit9CmRpZmYgLS1naXQg
YS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmggYi92aXJ0L2t2bS9pbnRyb3NwZWN0
aW9uL2t2bWlfaW50LmgKaW5kZXggYzIwNjM3NmViMGFkLi41MWMwMzA5N2E3ZDUgMTAwNjQ0Ci0t
LSBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaAorKysgYi92aXJ0L2t2bS9pbnRy
b3NwZWN0aW9uL2t2bWlfaW50LmgKQEAgLTM0LDYgKzM0LDkgQEAgYm9vbCBrdm1pX21zZ19wcm9j
ZXNzKHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSk7CiBpbnQga3ZtaV9zZW5kX2V2ZW50
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTMyIGV2X2lkLAogCQkgICAgdm9pZCAqZXYsIHNpemVf
dCBldl9zaXplLAogCQkgICAgdm9pZCAqcnBsLCBzaXplX3QgcnBsX3NpemUsIGludCAqYWN0aW9u
KTsKK2ludCBfX2t2bWlfc2VuZF9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiBldl9p
ZCwKKwkJICAgICAgdm9pZCAqZXYsIHNpemVfdCBldl9zaXplLAorCQkgICAgICB2b2lkICpycGws
IHNpemVfdCBycGxfc2l6ZSwgaW50ICphY3Rpb24pOwogaW50IGt2bWlfbXNnX3NlbmRfdW5ob29r
KHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSk7CiB1MzIga3ZtaV9tc2dfc2VuZF92Y3B1
X3BhdXNlKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiB1MzIga3ZtaV9tc2dfc2VuZF9oeXBlcmNh
bGwoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsKQEAgLTU1LDYgKzU4LDcgQEAgdm9pZCBrdm1pX2hh
bmRsZV9jb21tb25fZXZlbnRfYWN0aW9ucyhzdHJ1Y3Qga3ZtICprdm0sIHUzMiBhY3Rpb24pOwog
dm9pZCBrdm1pX2NtZF92bV9jb250cm9sX2NsZWFudXAoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9u
ICprdm1pLCBib29sIGVuYWJsZSk7CiBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKiBfX211c3Rf
Y2hlY2sga3ZtaV9nZXQoc3RydWN0IGt2bSAqa3ZtKTsKIHZvaWQga3ZtaV9wdXQoc3RydWN0IGt2
bSAqa3ZtKTsKK3ZvaWQga3ZtaV9zZW5kX3BlbmRpbmdfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2
Y3B1KTsKIGludCBrdm1pX2NtZF92bV9jb250cm9sX2V2ZW50cyhzdHJ1Y3Qga3ZtX2ludHJvc3Bl
Y3Rpb24gKmt2bWksCiAJCQkJdW5zaWduZWQgaW50IGV2ZW50X2lkLCBib29sIGVuYWJsZSk7CiBp
bnQga3ZtaV9jbWRfdmNwdV9jb250cm9sX2V2ZW50cyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCkBA
IC05Nyw1ICsxMDEsOSBAQCBpbnQga3ZtaV9hcmNoX2NtZF9jb250cm9sX2ludGVyY2VwdChzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQkJICAgIHVuc2lnbmVkIGludCBldmVudF9pZCwgYm9vbCBl
bmFibGUpOwogaW50IGt2bWlfYXJjaF9jbWRfdmNwdV9jb250cm9sX2NyKHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwKIAkJCQkgIGNvbnN0IHN0cnVjdCBrdm1pX3ZjcHVfY29udHJvbF9jciAqcmVxKTsK
K2ludCBrdm1pX2FyY2hfY21kX3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUg
KnZjcHUsIHU4IHZlY3RvciwKKwkJCQkJdTMyIGVycm9yX2NvZGUsIHU2NCBhZGRyZXNzKTsKK3Zv
aWQga3ZtaV9hcmNoX3NlbmRfdHJhcF9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwordm9p
ZCBrdm1pX2FyY2hfaW5qZWN0X2V4Y2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwogCiAj
ZW5kaWYKZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYyBiL3Zp
cnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwppbmRleCAzMzBmYWQyN2UxZGYuLjYzZWZi
ODVmZjFhZSAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCisr
KyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwpAQCAtNDkyLDYgKzQ5MiwyNSBA
QCBzdGF0aWMgaW50IGhhbmRsZV92Y3B1X2NvbnRyb2xfY3IoY29uc3Qgc3RydWN0IGt2bWlfdmNw
dV9tc2dfam9iICpqb2IsCiAJcmV0dXJuIGt2bWlfbXNnX3ZjcHVfcmVwbHkoam9iLCBtc2csIGVj
LCBOVUxMLCAwKTsKIH0KIAorc3RhdGljIGludCBoYW5kbGVfdmNwdV9pbmplY3RfZXhjZXB0aW9u
KGNvbnN0IHN0cnVjdCBrdm1pX3ZjcHVfbXNnX2pvYiAqam9iLAorCQkJCQljb25zdCBzdHJ1Y3Qg
a3ZtaV9tc2dfaGRyICptc2csCisJCQkJCWNvbnN0IHZvaWQgKl9yZXEpCit7CisJY29uc3Qgc3Ry
dWN0IGt2bWlfdmNwdV9pbmplY3RfZXhjZXB0aW9uICpyZXEgPSBfcmVxOworCWludCBlYzsKKwor
CWlmICghaXNfZXZlbnRfYWxsb3dlZChLVk1JKGpvYi0+dmNwdS0+a3ZtKSwgS1ZNSV9FVkVOVF9U
UkFQKSkKKwkJZWMgPSAtS1ZNX0VQRVJNOworCWVsc2UgaWYgKHJlcS0+cGFkZGluZzEgfHwgcmVx
LT5wYWRkaW5nMikKKwkJZWMgPSAtS1ZNX0VJTlZBTDsKKwllbHNlCisJCWVjID0ga3ZtaV9hcmNo
X2NtZF92Y3B1X2luamVjdF9leGNlcHRpb24oam9iLT52Y3B1LCByZXEtPm5yLAorCQkJCQkJCSBy
ZXEtPmVycm9yX2NvZGUsCisJCQkJCQkJIHJlcS0+YWRkcmVzcyk7CisKKwlyZXR1cm4ga3ZtaV9t
c2dfdmNwdV9yZXBseShqb2IsIG1zZywgZWMsIE5VTEwsIDApOworfQorCiAvKgogICogVGhlc2Ug
ZnVuY3Rpb25zIGFyZSBleGVjdXRlZCBmcm9tIHRoZSB2Q1BVIHRocmVhZC4gVGhlIHJlY2Vpdmlu
ZyB0aHJlYWQKICAqIHBhc3NlcyB0aGUgbWVzc2FnZXMgdXNpbmcgYSBuZXdseSBhbGxvY2F0ZWQg
J3N0cnVjdCBrdm1pX3ZjcHVfbXNnX2pvYicKQEAgLTUwMCwxMyArNTE5LDE0IEBAIHN0YXRpYyBp
bnQgaGFuZGxlX3ZjcHVfY29udHJvbF9jcihjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X21zZ19qb2Ig
KmpvYiwKICAqLwogc3RhdGljIGludCgqY29uc3QgbXNnX3ZjcHVbXSkoY29uc3Qgc3RydWN0IGt2
bWlfdmNwdV9tc2dfam9iICosCiAJCQkgICAgICBjb25zdCBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICos
IGNvbnN0IHZvaWQgKikgPSB7Ci0JW0tWTUlfRVZFTlRdICAgICAgICAgICAgICAgPSBoYW5kbGVf
dmNwdV9ldmVudF9yZXBseSwKLQlbS1ZNSV9WQ1BVX0NPTlRST0xfQ1JdICAgICA9IGhhbmRsZV92
Y3B1X2NvbnRyb2xfY3IsCi0JW0tWTUlfVkNQVV9DT05UUk9MX0VWRU5UU10gPSBoYW5kbGVfdmNw
dV9jb250cm9sX2V2ZW50cywKLQlbS1ZNSV9WQ1BVX0dFVF9DUFVJRF0gICAgICA9IGhhbmRsZV92
Y3B1X2dldF9jcHVpZCwKLQlbS1ZNSV9WQ1BVX0dFVF9JTkZPXSAgICAgICA9IGhhbmRsZV92Y3B1
X2dldF9pbmZvLAotCVtLVk1JX1ZDUFVfR0VUX1JFR0lTVEVSU10gID0gaGFuZGxlX3ZjcHVfZ2V0
X3JlZ2lzdGVycywKLQlbS1ZNSV9WQ1BVX1NFVF9SRUdJU1RFUlNdICA9IGhhbmRsZV92Y3B1X3Nl
dF9yZWdpc3RlcnMsCisJW0tWTUlfRVZFTlRdICAgICAgICAgICAgICAgICA9IGhhbmRsZV92Y3B1
X2V2ZW50X3JlcGx5LAorCVtLVk1JX1ZDUFVfQ09OVFJPTF9DUl0gICAgICAgPSBoYW5kbGVfdmNw
dV9jb250cm9sX2NyLAorCVtLVk1JX1ZDUFVfQ09OVFJPTF9FVkVOVFNdICAgPSBoYW5kbGVfdmNw
dV9jb250cm9sX2V2ZW50cywKKwlbS1ZNSV9WQ1BVX0dFVF9DUFVJRF0gICAgICAgID0gaGFuZGxl
X3ZjcHVfZ2V0X2NwdWlkLAorCVtLVk1JX1ZDUFVfR0VUX0lORk9dICAgICAgICAgPSBoYW5kbGVf
dmNwdV9nZXRfaW5mbywKKwlbS1ZNSV9WQ1BVX0dFVF9SRUdJU1RFUlNdICAgID0gaGFuZGxlX3Zj
cHVfZ2V0X3JlZ2lzdGVycywKKwlbS1ZNSV9WQ1BVX0lOSkVDVF9FWENFUFRJT05dID0gaGFuZGxl
X3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbiwKKwlbS1ZNSV9WQ1BVX1NFVF9SRUdJU1RFUlNdICAgID0g
aGFuZGxlX3ZjcHVfc2V0X3JlZ2lzdGVycywKIH07CiAKIHN0YXRpYyBib29sIGlzX3ZjcHVfY29t
bWFuZCh1MTYgaWQpCkBAIC03NzAsOSArNzkwLDkgQEAgc3RhdGljIHZvaWQga3ZtaV9zZXR1cF92
Y3B1X3JlcGx5KHN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0aW9uICp2Y3B1aSwKIAl2Y3B1aS0+
d2FpdGluZ19mb3JfcmVwbHkgPSB0cnVlOwogfQogCi1pbnQga3ZtaV9zZW5kX2V2ZW50KHN0cnVj
dCBrdm1fdmNwdSAqdmNwdSwgdTMyIGV2X2lkLAotCQkgICAgdm9pZCAqZXYsIHNpemVfdCBldl9z
aXplLAotCQkgICAgdm9pZCAqcnBsLCBzaXplX3QgcnBsX3NpemUsIGludCAqYWN0aW9uKQoraW50
IF9fa3ZtaV9zZW5kX2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTMyIGV2X2lkLAorCQkg
ICAgICB2b2lkICpldiwgc2l6ZV90IGV2X3NpemUsCisJCSAgICAgIHZvaWQgKnJwbCwgc2l6ZV90
IHJwbF9zaXplLCBpbnQgKmFjdGlvbikKIHsKIAlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKIAlz
dHJ1Y3Qga3ZtaV9ldmVudCBjb21tb247CkBAIC04MTIsNiArODMyLDE2IEBAIGludCBrdm1pX3Nl
bmRfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgZXZfaWQsCiAJcmV0dXJuIGVycjsK
IH0KIAoraW50IGt2bWlfc2VuZF9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiBldl9p
ZCwKKwkJICAgIHZvaWQgKmV2LCBzaXplX3QgZXZfc2l6ZSwKKwkJICAgIHZvaWQgKnJwbCwgc2l6
ZV90IHJwbF9zaXplLCBpbnQgKmFjdGlvbikKK3sKKwlrdm1pX3NlbmRfcGVuZGluZ19ldmVudCh2
Y3B1KTsKKworCXJldHVybiBfX2t2bWlfc2VuZF9ldmVudCh2Y3B1LCBldl9pZCwgZXYsIGV2X3Np
emUsCisJCQkJIHJwbCwgcnBsX3NpemUsIGFjdGlvbik7Cit9CisKIHUzMiBrdm1pX21zZ19zZW5k
X3ZjcHVfcGF1c2Uoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogewogCWludCBlcnIsIGFjdGlvbjsK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6
YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24u
b3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3Zp
cnR1YWxpemF0aW9u
