Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id E86331978D3
	for <lists.virtualization@lfdr.de>; Mon, 30 Mar 2020 12:20:10 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 9E5758843F;
	Mon, 30 Mar 2020 10:20:09 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id JaaoD+wfHyS3; Mon, 30 Mar 2020 10:20:06 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 17253884DE;
	Mon, 30 Mar 2020 10:20:05 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 0503BC1D7E;
	Mon, 30 Mar 2020 10:20:05 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 018D5C07FF
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:55 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id F2C5488471
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:54 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id VhY2nQ4+S2ID
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:53 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by hemlock.osuosl.org (Postfix) with ESMTPS id A734188454
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:52 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 AC3B1305FFA4; Mon, 30 Mar 2020 13:12:56 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 8DCA3305B7A0;
 Mon, 30 Mar 2020 13:12:56 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v8 49/81] KVM: introspection: add a jobs list to every
 introspected vCPU
Date: Mon, 30 Mar 2020 13:12:36 +0300
Message-Id: <20200330101308.21702-50-alazar@bitdefender.com>
In-Reply-To: <20200330101308.21702-1-alazar@bitdefender.com>
References: <20200330101308.21702-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <ncitu@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RXZlcnkgdkNQVSBoYXMgYSBsb2NrLXByb3RlY3RlZCBsaXN0IGluIHdoaWNoIHRoZSByZWNlaXZp
bmcgd29ya2VyCnBsYWNlcyB0aGUgam9icyB0aGF0IGhhcyB0byBiZSBkb25lIGJ5IHRoZSB2Q1BV
IHRocmVhZApvbmNlIGl0IGlzIGtpY2tlZCBvdXQgb2YgZ3Vlc3QgKEtWTV9SRVFfSU5UUk9TUEVD
VElPTikuCgpBIGpvYiBpcyBkZWZpbmVkIGJ5IGEgImRvIiBmdW5jdGlvbiwgYSAiZnJlZSIgZnVu
Y3Rpb24gYW5kIGEgcG9pbnRlcgoodGhlIGNvbnRleHQpLgoKQ28tZGV2ZWxvcGVkLWJ5OiBOaWN1
yJlvciBDw67Im3UgPG5jaXR1QGJpdGRlZmVuZGVyLmNvbT4KU2lnbmVkLW9mZi1ieTogTmljdciZ
b3IgQ8OuyJt1IDxuY2l0dUBiaXRkZWZlbmRlci5jb20+ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0
IExhesSDciA8YWxhemFyQGJpdGRlZmVuZGVyLmNvbT4KLS0tCiBpbmNsdWRlL2xpbnV4L2t2bWlf
aG9zdC5oICAgICAgICAgfCAxMCArKysrKwogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMg
ICAgIHwgNzIgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrLQogdmlydC9rdm0vaW50cm9z
cGVjdGlvbi9rdm1pX2ludC5oIHwgIDEgKwogMyBmaWxlcyBjaGFuZ2VkLCA4MSBpbnNlcnRpb25z
KCspLCAyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0
LmggYi9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCmluZGV4IGNhMmRiODA0M2E1My4uMWQ4MGQy
MzNmYmQ1IDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCisrKyBiL2luY2x1
ZGUvbGludXgva3ZtaV9ob3N0LmgKQEAgLTExLDggKzExLDE4IEBAIHN0cnVjdCBrdm1fdmNwdTsK
IAogI2RlZmluZSBLVk1JX05VTV9DT01NQU5EUyBLVk1JX05VTV9NRVNTQUdFUwogCitzdHJ1Y3Qg
a3ZtaV9qb2IgeworCXN0cnVjdCBsaXN0X2hlYWQgbGluazsKKwl2b2lkICpjdHg7CisJdm9pZCAo
KmZjdCkoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB2b2lkICpjdHgpOworCXZvaWQgKCpmcmVlX2Zj
dCkodm9pZCAqY3R4KTsKK307CisKIHN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0aW9uIHsKIAlz
dHJ1Y3Qga3ZtX3ZjcHVfYXJjaF9pbnRyb3NwZWN0aW9uIGFyY2g7CisKKwlzdHJ1Y3QgbGlzdF9o
ZWFkIGpvYl9saXN0OworCXNwaW5sb2NrX3Qgam9iX2xvY2s7CiB9OwogCiBzdHJ1Y3Qga3ZtX2lu
dHJvc3BlY3Rpb24gewpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMg
Yi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwppbmRleCBhOWY5YWZiYTZiYTIuLmUzNjQ2
MGI3NTVlOSAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKKysrIGIv
dmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKQEAgLTE3LDYgKzE3LDcgQEAgREVDTEFSRV9C
SVRNQVAoS3ZtaV9rbm93bl92bV9ldmVudHMsIEtWTUlfTlVNX0VWRU5UUyk7CiBzdGF0aWMgREVD
TEFSRV9CSVRNQVAoS3ZtaV9rbm93bl92Y3B1X2V2ZW50cywgS1ZNSV9OVU1fRVZFTlRTKTsKIAog
c3RhdGljIHN0cnVjdCBrbWVtX2NhY2hlICptc2dfY2FjaGU7CitzdGF0aWMgc3RydWN0IGttZW1f
Y2FjaGUgKmpvYl9jYWNoZTsKIAogdm9pZCAqa3ZtaV9tc2dfYWxsb2Modm9pZCkKIHsKQEAgLTMz
LDE0ICszNCwxOSBAQCBzdGF0aWMgdm9pZCBrdm1pX2NhY2hlX2Rlc3Ryb3kodm9pZCkKIHsKIAlr
bWVtX2NhY2hlX2Rlc3Ryb3kobXNnX2NhY2hlKTsKIAltc2dfY2FjaGUgPSBOVUxMOworCWttZW1f
Y2FjaGVfZGVzdHJveShqb2JfY2FjaGUpOworCWpvYl9jYWNoZSA9IE5VTEw7CiB9CiAKIHN0YXRp
YyBpbnQga3ZtaV9jYWNoZV9jcmVhdGUodm9pZCkKIHsKIAltc2dfY2FjaGUgPSBrbWVtX2NhY2hl
X2NyZWF0ZSgia3ZtaV9tc2ciLCBLVk1JX01TR19TSVpFX0FMTE9DLAogCQkJCSAgICAgIDQwOTYs
IFNMQUJfQUNDT1VOVCwgTlVMTCk7CisJam9iX2NhY2hlID0ga21lbV9jYWNoZV9jcmVhdGUoImt2
bWlfam9iIiwKKwkJCQkgICAgICBzaXplb2Yoc3RydWN0IGt2bWlfam9iKSwKKwkJCQkgICAgICAw
LCBTTEFCX0FDQ09VTlQsIE5VTEwpOwogCi0JaWYgKCFtc2dfY2FjaGUpIHsKKwlpZiAoIW1zZ19j
YWNoZSB8fCAham9iX2NhY2hlKSB7CiAJCWt2bWlfY2FjaGVfZGVzdHJveSgpOwogCiAJCXJldHVy
biAtMTsKQEAgLTgxLDYgKzg3LDQ4IEBAIHZvaWQga3ZtaV91bmluaXQodm9pZCkKIAlrdm1pX2Nh
Y2hlX2Rlc3Ryb3koKTsKIH0KIAorc3RhdGljIGludCBfX2t2bWlfYWRkX2pvYihzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsCisJCQkgIHZvaWQgKCpmY3QpKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdm9p
ZCAqY3R4KSwKKwkJCSAgdm9pZCAqY3R4LCB2b2lkICgqZnJlZV9mY3QpKHZvaWQgKmN0eCkpCit7
CisJc3RydWN0IGt2bV92Y3B1X2ludHJvc3BlY3Rpb24gKnZjcHVpID0gVkNQVUkodmNwdSk7CisJ
c3RydWN0IGt2bWlfam9iICpqb2I7CisKKwlqb2IgPSBrbWVtX2NhY2hlX3phbGxvYyhqb2JfY2Fj
aGUsIEdGUF9LRVJORUwpOworCWlmICh1bmxpa2VseSgham9iKSkKKwkJcmV0dXJuIC1FTk9NRU07
CisKKwlJTklUX0xJU1RfSEVBRCgmam9iLT5saW5rKTsKKwlqb2ItPmZjdCA9IGZjdDsKKwlqb2It
PmN0eCA9IGN0eDsKKwlqb2ItPmZyZWVfZmN0ID0gZnJlZV9mY3Q7CisKKwlzcGluX2xvY2soJnZj
cHVpLT5qb2JfbG9jayk7CisJbGlzdF9hZGRfdGFpbCgmam9iLT5saW5rLCAmdmNwdWktPmpvYl9s
aXN0KTsKKwlzcGluX3VubG9jaygmdmNwdWktPmpvYl9sb2NrKTsKKworCXJldHVybiAwOworfQor
CitpbnQga3ZtaV9hZGRfam9iKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKKwkJIHZvaWQgKCpmY3Qp
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdm9pZCAqY3R4KSwKKwkJIHZvaWQgKmN0eCwgdm9pZCAo
KmZyZWVfZmN0KSh2b2lkICpjdHgpKQoreworCWludCBlcnI7CisKKwllcnIgPSBfX2t2bWlfYWRk
X2pvYih2Y3B1LCBmY3QsIGN0eCwgZnJlZV9mY3QpOworCisJcmV0dXJuIGVycjsKK30KKworc3Rh
dGljIHZvaWQga3ZtaV9mcmVlX2pvYihzdHJ1Y3Qga3ZtaV9qb2IgKmpvYikKK3sKKwlpZiAoam9i
LT5mcmVlX2ZjdCkKKwkJam9iLT5mcmVlX2ZjdChqb2ItPmN0eCk7CisKKwlrbWVtX2NhY2hlX2Zy
ZWUoam9iX2NhY2hlLCBqb2IpOworfQorCiBzdGF0aWMgYm9vbCBhbGxvY192Y3B1aShzdHJ1Y3Qg
a3ZtX3ZjcHUgKnZjcHUpCiB7CiAJc3RydWN0IGt2bV92Y3B1X2ludHJvc3BlY3Rpb24gKnZjcHVp
OwpAQCAtODksNiArMTM3LDkgQEAgc3RhdGljIGJvb2wgYWxsb2NfdmNwdWkoc3RydWN0IGt2bV92
Y3B1ICp2Y3B1KQogCWlmICghdmNwdWkpCiAJCXJldHVybiBmYWxzZTsKIAorCUlOSVRfTElTVF9I
RUFEKCZ2Y3B1aS0+am9iX2xpc3QpOworCXNwaW5fbG9ja19pbml0KCZ2Y3B1aS0+am9iX2xvY2sp
OworCiAJdmNwdS0+a3ZtaSA9IHZjcHVpOwogCiAJcmV0dXJuIHRydWU7CkBAIC0xMDIsOSArMTUz
LDI2IEBAIHN0YXRpYyBpbnQgY3JlYXRlX3ZjcHVpKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAly
ZXR1cm4gMDsKIH0KIAorc3RhdGljIHZvaWQgZnJlZV92Y3B1X2pvYnMoc3RydWN0IGt2bV92Y3B1
X2ludHJvc3BlY3Rpb24gKnZjcHVpKQoreworCXN0cnVjdCBrdm1pX2pvYiAqY3VyLCAqbmV4dDsK
KworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShjdXIsIG5leHQsICZ2Y3B1aS0+am9iX2xpc3Qs
IGxpbmspIHsKKwkJbGlzdF9kZWwoJmN1ci0+bGluayk7CisJCWt2bWlfZnJlZV9qb2IoY3VyKTsK
Kwl9Cit9CisKIHN0YXRpYyB2b2lkIGZyZWVfdmNwdWkoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQog
ewotCWtmcmVlKHZjcHUtPmt2bWkpOworCXN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0aW9uICp2
Y3B1aSA9IFZDUFVJKHZjcHUpOworCisJaWYgKCF2Y3B1aSkKKwkJcmV0dXJuOworCisJZnJlZV92
Y3B1X2pvYnModmNwdWkpOworCisJa2ZyZWUodmNwdWkpOwogCXZjcHUtPmt2bWkgPSBOVUxMOwog
fQogCmRpZmYgLS1naXQgYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmggYi92aXJ0
L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgKaW5kZXggNmExODA4NTg1YTMyLi41ZDQwZDg3
MmU0OTMgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaAorKysg
Yi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgKQEAgLTIwLDYgKzIwLDcgQEAgZXh0
ZXJuIERFQ0xBUkVfQklUTUFQKEt2bWlfa25vd25fZXZlbnRzLCBLVk1JX05VTV9FVkVOVFMpOwog
ZXh0ZXJuIERFQ0xBUkVfQklUTUFQKEt2bWlfa25vd25fdm1fZXZlbnRzLCBLVk1JX05VTV9FVkVO
VFMpOwogCiAjZGVmaW5lIEtWTUkoa3ZtKSAoKGt2bSktPmt2bWkpCisjZGVmaW5lIFZDUFVJKHZj
cHUpICgodmNwdSktPmt2bWkpCiAKIC8qIGt2bWlfbXNnLmMgKi8KIGJvb2wga3ZtaV9zb2NrX2dl
dChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksIGludCBmZCk7Cl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcg
bGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xp
c3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
