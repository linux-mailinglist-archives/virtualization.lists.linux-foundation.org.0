Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id A2CFC229C75
	for <lists.virtualization@lfdr.de>; Wed, 22 Jul 2020 18:01:47 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id A610588739;
	Wed, 22 Jul 2020 16:01:44 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Ads4s+oi5AF8; Wed, 22 Jul 2020 16:01:40 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 4EF0A88660;
	Wed, 22 Jul 2020 16:01:40 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 1CD01C004E;
	Wed, 22 Jul 2020 16:01:40 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 9E10AC004C
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:36 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by fraxinus.osuosl.org (Postfix) with ESMTP id 8E2EA86B10
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:36 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id v9rKkJb1WyrK
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:35 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by fraxinus.osuosl.org (Postfix) with ESMTPS id 5FF6886AE9
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:35 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 1F3C2305D7EA; Wed, 22 Jul 2020 19:01:32 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.6])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 064B9307278A;
 Wed, 22 Jul 2020 19:01:32 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [RFC PATCH v1 06/34] KVM: x86: mmu: add support for EPT switching
Date: Wed, 22 Jul 2020 19:00:53 +0300
Message-Id: <20200722160121.9601-7-alazar@bitdefender.com>
In-Reply-To: <20200722160121.9601-1-alazar@bitdefender.com>
References: <20200722160121.9601-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 Marian Rotariu <marian.c.rotariu@gmail.com>,
 =?UTF-8?q?=C8=98tefan=20=C8=98icleru?= <ssicleru@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWFyaWFuIFJvdGFyaXUgPG1hcmlhbi5jLnJvdGFyaXVAZ21haWwuY29tPgoKVGhlIGlu
dHJvc3BlY3Rpb24gdG9vbCB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gY2hlY2sgdGhlIGhhcmR3YXJl
IHN1cHBvcnQKZm9yIEVQVCBzd2l0Y2hpbmcsIHdoaWNoIGNhbiBiZSB1c2VkIGVpdGhlciB0byBz
aW5nbGVzdGVwIHZDUFVzCm9uIGEgdW5wcm90ZWN0ZWQgRVBUIHZpZXcgb3IgdG8gdXNlICNWRSBp
biBvcmRlciB0byBhdm9pZCBmaWx0ZXIgb3V0ClZNLWV4aXRzIGNhdXNlZCBieSBFUFQgdmlvbGF0
aW9ucy4KClNpZ25lZC1vZmYtYnk6IE1hcmlhbiBSb3Rhcml1IDxtYXJpYW4uYy5yb3Rhcml1QGdt
YWlsLmNvbT4KQ28tZGV2ZWxvcGVkLWJ5OiDImHRlZmFuIMiYaWNsZXJ1IDxzc2ljbGVydUBiaXRk
ZWZlbmRlci5jb20+ClNpZ25lZC1vZmYtYnk6IMiYdGVmYW4gyJhpY2xlcnUgPHNzaWNsZXJ1QGJp
dGRlZmVuZGVyLmNvbT4KU2lnbmVkLW9mZi1ieTogQWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0
ZGVmZW5kZXIuY29tPgotLS0KIGFyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmggfCAgMSAr
CiBhcmNoL3g4Ni9rdm0vbW11L21tdS5jICAgICAgICAgIHwgMTIgKystLQogYXJjaC94ODYva3Zt
L3ZteC92bXguYyAgICAgICAgICB8IDk4ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KwogYXJjaC94ODYva3ZtL3ZteC92bXguaCAgICAgICAgICB8ICAxICsKIDQgZmlsZXMgY2hhbmdl
ZCwgMTA4IGluc2VydGlvbnMoKyksIDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvYXJjaC94
ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaCBiL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0
LmgKaW5kZXggYmQ0NTc3OGUwOTA0Li4xMDM1MzA4OTQwZmUgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2
L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmgKKysrIGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hv
c3QuaApAQCAtNDIxLDYgKzQyMSw3IEBAIHN0cnVjdCBrdm1fbW11IHsKIAl2b2lkICgqdXBkYXRl
X3B0ZSkoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBzdHJ1Y3Qga3ZtX21tdV9wYWdlICpzcCwKIAkJ
CSAgIHU2NCAqc3B0ZSwgY29uc3Qgdm9pZCAqcHRlKTsKIAlocGFfdCByb290X2hwYTsKKwlocGFf
dCByb290X2hwYV9hbHR2aWV3c1tLVk1fTUFYX0VQVF9WSUVXU107CiAJZ3BhX3Qgcm9vdF9wZ2Q7
CiAJdW5pb24ga3ZtX21tdV9yb2xlIG1tdV9yb2xlOwogCXU4IHJvb3RfbGV2ZWw7CmRpZmYgLS1n
aXQgYS9hcmNoL3g4Ni9rdm0vbW11L21tdS5jIGIvYXJjaC94ODYva3ZtL21tdS9tbXUuYwppbmRl
eCAwYjY1MjdhMWViZTYuLjU1MzQyNWFiMzUxOCAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL21t
dS9tbXUuYworKysgYi9hcmNoL3g4Ni9rdm0vbW11L21tdS5jCkBAIC0zNzYwLDggKzM3NjAsMTEg
QEAgdm9pZCBrdm1fbW11X2ZyZWVfcm9vdHMoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBzdHJ1Y3Qg
a3ZtX21tdSAqbW11LAogCWlmIChmcmVlX2FjdGl2ZV9yb290KSB7CiAJCWlmIChtbXUtPnNoYWRv
d19yb290X2xldmVsID49IFBUNjRfUk9PVF80TEVWRUwgJiYKIAkJICAgIChtbXUtPnJvb3RfbGV2
ZWwgPj0gUFQ2NF9ST09UXzRMRVZFTCB8fCBtbXUtPmRpcmVjdF9tYXApKSB7Ci0JCQltbXVfZnJl
ZV9yb290X3BhZ2UodmNwdS0+a3ZtLCAmbW11LT5yb290X2hwYSwKLQkJCQkJICAgJmludmFsaWRf
bGlzdCk7CisJCQlmb3IgKGkgPSAwOyBpIDwgS1ZNX01BWF9FUFRfVklFV1M7IGkrKykKKwkJCQlt
bXVfZnJlZV9yb290X3BhZ2UodmNwdS0+a3ZtLAorCQkJCQkJICAgbW11LT5yb290X2hwYV9hbHR2
aWV3cyArIGksCisJCQkJCQkgICAmaW52YWxpZF9saXN0KTsKKwkJCW1tdS0+cm9vdF9ocGEgPSBJ
TlZBTElEX1BBR0U7CiAJCX0gZWxzZSB7CiAJCQlmb3IgKGkgPSAwOyBpIDwgNDsgKytpKQogCQkJ
CWlmIChtbXUtPnBhZV9yb290W2ldICE9IDApCkBAIC0zODIxLDkgKzM4MjQsMTAgQEAgc3RhdGlj
IGludCBtbXVfYWxsb2NfZGlyZWN0X3Jvb3RzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAkJCQkJ
ICAgICAgc2hhZG93X3Jvb3RfbGV2ZWwsIHRydWUsIGkpOwogCQkJaWYgKCFWQUxJRF9QQUdFKHJv
b3QpKQogCQkJCXJldHVybiAtRU5PU1BDOwotCQkJaWYgKGkgPT0gMCkKLQkJCQl2Y3B1LT5hcmNo
Lm1tdS0+cm9vdF9ocGEgPSByb290OworCQkJdmNwdS0+YXJjaC5tbXUtPnJvb3RfaHBhX2FsdHZp
ZXdzW2ldID0gcm9vdDsKIAkJfQorCQl2Y3B1LT5hcmNoLm1tdS0+cm9vdF9ocGEgPQorCQkgIHZj
cHUtPmFyY2gubW11LT5yb290X2hwYV9hbHR2aWV3c1trdm1fZ2V0X2VwdF92aWV3KHZjcHUpXTsK
IAl9IGVsc2UgaWYgKHNoYWRvd19yb290X2xldmVsID09IFBUMzJFX1JPT1RfTEVWRUwpIHsKIAkJ
Zm9yIChpID0gMDsgaSA8IDQ7ICsraSkgewogCQkJTU1VX1dBUk5fT04oVkFMSURfUEFHRSh2Y3B1
LT5hcmNoLm1tdS0+cGFlX3Jvb3RbaV0pKTsKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2t2bS92bXgv
dm14LmMgYi9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jCmluZGV4IDAyNTZjM2E5M2M4Ny4uMjAyNGVm
NGQ5YTc0IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jCisrKyBiL2FyY2gveDg2
L2t2bS92bXgvdm14LmMKQEAgLTMxMjQsNiArMzEyNCwzMiBAQCB1NjQgY29uc3RydWN0X2VwdHAo
c3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1bnNpZ25lZCBsb25nIHJvb3RfaHBhKQogCXJldHVybiBl
cHRwOwogfQogCitzdGF0aWMgdm9pZCB2bXhfY29uc3RydWN0X2VwdHBfd2l0aF9pbmRleChzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUsCisJCQkJCSAgdW5zaWduZWQgc2hvcnQgdmlldykKK3sKKwlzdHJ1
Y3QgdmNwdV92bXggKnZteCA9IHRvX3ZteCh2Y3B1KTsKKwl1NjQgKmVwdHBfbGlzdCA9IE5VTEw7
CisKKwlpZiAoIXZteC0+ZXB0cF9saXN0X3BnKQorCQlyZXR1cm47CisKKwllcHRwX2xpc3QgPSBw
aHlzX3RvX3ZpcnQocGFnZV90b19waHlzKHZteC0+ZXB0cF9saXN0X3BnKSk7CisKKwlpZiAoIWVw
dHBfbGlzdCkKKwkJcmV0dXJuOworCisJZXB0cF9saXN0W3ZpZXddID0gY29uc3RydWN0X2VwdHAo
dmNwdSwKKwkJCQl2Y3B1LT5hcmNoLm1tdS0+cm9vdF9ocGFfYWx0dmlld3Nbdmlld10pOworfQor
CitzdGF0aWMgdm9pZCB2bXhfY29uc3RydWN0X2VwdHBfbGlzdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUpCit7CisJdW5zaWduZWQgc2hvcnQgdmlldzsKKworCWZvciAodmlldyA9IDA7IHZpZXcgPCBL
Vk1fTUFYX0VQVF9WSUVXUzsgdmlldysrKQorCQl2bXhfY29uc3RydWN0X2VwdHBfd2l0aF9pbmRl
eCh2Y3B1LCB2aWV3KTsKK30KKwogdm9pZCB2bXhfbG9hZF9tbXVfcGdkKHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwgdW5zaWduZWQgbG9uZyBwZ2QpCiB7CiAJc3RydWN0IGt2bSAqa3ZtID0gdmNwdS0+
a3ZtOwpAQCAtMzEzNSw2ICszMTYxLDggQEAgdm9pZCB2bXhfbG9hZF9tbXVfcGdkKHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSwgdW5zaWduZWQgbG9uZyBwZ2QpCiAJCWVwdHAgPSBjb25zdHJ1Y3RfZXB0
cCh2Y3B1LCBwZ2QpOwogCQl2bWNzX3dyaXRlNjQoRVBUX1BPSU5URVIsIGVwdHApOwogCisJCXZt
eF9jb25zdHJ1Y3RfZXB0cF9saXN0KHZjcHUpOworCiAJCWlmIChrdm1feDg2X29wcy50bGJfcmVt
b3RlX2ZsdXNoKSB7CiAJCQlzcGluX2xvY2soJnRvX2t2bV92bXgoa3ZtKS0+ZXB0X3BvaW50ZXJf
bG9jayk7CiAJCQl0b192bXgodmNwdSktPmVwdF9wb2ludGVyID0gZXB0cDsKQEAgLTQzMzYsNiAr
NDM2NCwxNSBAQCBzdGF0aWMgdm9pZCBlcHRfc2V0X21taW9fc3B0ZV9tYXNrKHZvaWQpCiAJa3Zt
X21tdV9zZXRfbW1pb19zcHRlX21hc2soVk1YX0VQVF9NSVNDT05GSUdfV1hfVkFMVUUsIDApOwog
fQogCitzdGF0aWMgaW50IHZteF9hbGxvY19lcHRwX2xpc3RfcGFnZShzdHJ1Y3QgdmNwdV92bXgg
KnZteCkKK3sKKwl2bXgtPmVwdHBfbGlzdF9wZyA9IGFsbG9jX3BhZ2UoR0ZQX0tFUk5FTCB8IF9f
R0ZQX1pFUk8pOworCWlmICghdm14LT5lcHRwX2xpc3RfcGcpCisJCXJldHVybiAtRU5PTUVNOwor
CisJcmV0dXJuIDA7Cit9CisKICNkZWZpbmUgVk1YX1hTU19FWElUX0JJVE1BUCAwCiAKIC8qCkBA
IC00NDI2LDYgKzQ0NjMsMTAgQEAgc3RhdGljIHZvaWQgaW5pdF92bWNzKHN0cnVjdCB2Y3B1X3Zt
eCAqdm14KQogCWlmIChjcHVfaGFzX3ZteF9lbmNsc192bWV4aXQoKSkKIAkJdm1jc193cml0ZTY0
KEVOQ0xTX0VYSVRJTkdfQklUTUFQLCAtMXVsbCk7CiAKKwlpZiAodm14LT5lcHRwX2xpc3RfcGcp
CisJCXZtY3Nfd3JpdGU2NChFUFRQX0xJU1RfQUREUkVTUywKKwkJCQlwYWdlX3RvX3BoeXModm14
LT5lcHRwX2xpc3RfcGcpKTsKKwogCWlmICh2bXhfcHRfbW9kZV9pc19ob3N0X2d1ZXN0KCkpIHsK
IAkJbWVtc2V0KCZ2bXgtPnB0X2Rlc2MsIDAsIHNpemVvZih2bXgtPnB0X2Rlc2MpKTsKIAkJLyog
Qml0WzZ+MF0gYXJlIGZvcmNlZCB0byAxLCB3cml0ZXMgYXJlIGlnbm9yZWQuICovCkBAIC01OTEz
LDYgKzU5NTQsMjQgQEAgc3RhdGljIHZvaWQgdm14X2R1bXBfZHRzZWwoY2hhciAqbmFtZSwgdWlu
dDMyX3QgbGltaXQpCiAJICAgICAgIHZtY3NfcmVhZGwobGltaXQgKyBHVUVTVF9HRFRSX0JBU0Ug
LSBHVUVTVF9HRFRSX0xJTUlUKSk7CiB9CiAKK3N0YXRpYyB2b2lkIGR1bXBfZXB0cF9saXN0KHZv
aWQpCit7CisJcGh5c19hZGRyX3QgZXB0cF9saXN0X3BoeXMsICplcHRwX2xpc3QgPSBOVUxMOwor
CWludCBpOworCisJZXB0cF9saXN0X3BoeXMgPSAocGh5c19hZGRyX3Qpdm1jc19yZWFkNjQoRVBU
UF9MSVNUX0FERFJFU1MpOworCWlmICghZXB0cF9saXN0X3BoeXMpCisJCXJldHVybjsKKworCWVw
dHBfbGlzdCA9IHBoeXNfdG9fdmlydChlcHRwX2xpc3RfcGh5cyk7CisKKwlwcl9lcnIoIioqKiBF
UFRQIFN3aXRjaGluZyAqKipcbiIpOworCXByX2VycigiRVBUUCBMaXN0IEFkZHJlc3M6ICVwIChw
aHlzICVwKVxuIiwKKwkJZXB0cF9saXN0LCAodm9pZCAqKWVwdHBfbGlzdF9waHlzKTsKKwlmb3Ig
KGkgPSAwOyBpIDwgS1ZNX01BWF9FUFRfVklFV1M7IGkrKykKKwkJcHJfZXJyKCIlZDogJTAxNmxs
eFxuIiwgaSwgKihlcHRwX2xpc3QgKyBpKSk7Cit9CisKIHZvaWQgZHVtcF92bWNzKHZvaWQpCiB7
CiAJdTMyIHZtZW50cnlfY3RsLCB2bWV4aXRfY3RsOwpAQCAtNjA2MSw2ICs2MTIwLDIzIEBAIHZv
aWQgZHVtcF92bWNzKHZvaWQpCiAJaWYgKHNlY29uZGFyeV9leGVjX2NvbnRyb2wgJiBTRUNPTkRB
UllfRVhFQ19FTkFCTEVfVlBJRCkKIAkJcHJfZXJyKCJWaXJ0dWFsIHByb2Nlc3NvciBJRCA9IDB4
JTA0eFxuIiwKIAkJICAgICAgIHZtY3NfcmVhZDE2KFZJUlRVQUxfUFJPQ0VTU09SX0lEKSk7CisK
KwlkdW1wX2VwdHBfbGlzdCgpOworfQorCitzdGF0aWMgdW5zaWduZWQgaW50IHVwZGF0ZV9lcHRf
dmlldyhzdHJ1Y3QgdmNwdV92bXggKnZteCkKK3sKKwl1NjQgKmVwdHBfbGlzdCA9IHBoeXNfdG9f
dmlydChwYWdlX3RvX3BoeXModm14LT5lcHRwX2xpc3RfcGcpKTsKKwl1NjQgZXB0cCA9IHZtY3Nf
cmVhZDY0KEVQVF9QT0lOVEVSKTsKKwl1bnNpZ25lZCBpbnQgdmlldzsKKworCWZvciAodmlldyA9
IDA7IHZpZXcgPCBLVk1fTUFYX0VQVF9WSUVXUzsgdmlldysrKQorCQlpZiAoZXB0cF9saXN0W3Zp
ZXddID09IGVwdHApIHsKKwkJCXZteC0+dmlldyA9IHZpZXc7CisJCQlicmVhazsKKwkJfQorCisJ
cmV0dXJuIHZteC0+dmlldzsKIH0KIAogLyoKQEAgLTYwNzMsNiArNjE0OSwxMyBAQCBzdGF0aWMg
aW50IHZteF9oYW5kbGVfZXhpdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGZhc3RwYXRoX3QgZXhp
dF9mYXN0cGF0aCkKIAl1MzIgZXhpdF9yZWFzb24gPSB2bXgtPmV4aXRfcmVhc29uOwogCXUzMiB2
ZWN0b3JpbmdfaW5mbyA9IHZteC0+aWR0X3ZlY3RvcmluZ19pbmZvOwogCisJaWYgKHZteC0+ZXB0
cF9saXN0X3BnKSB7CisJCXVuc2lnbmVkIGludCB2aWV3ID0gdXBkYXRlX2VwdF92aWV3KHZteCk7
CisJCXN0cnVjdCBrdm1fbW11ICptbXUgPSB2Y3B1LT5hcmNoLm1tdTsKKworCQltbXUtPnJvb3Rf
aHBhID0gbW11LT5yb290X2hwYV9hbHR2aWV3c1t2aWV3XTsKKwl9CisKIAkvKgogCSAqIEZsdXNo
IGxvZ2dlZCBHUEFzIFBNTCBidWZmZXIsIHRoaXMgd2lsbCBtYWtlIGRpcnR5X2JpdG1hcCBtb3Jl
CiAJICogdXBkYXRlZC4gQW5vdGhlciBnb29kIGlzLCBpbiBrdm1fdm1faW9jdGxfZ2V0X2RpcnR5
X2xvZywgYmVmb3JlCkBAIC02OTUxLDEyICs3MDM0LDIxIEBAIHN0YXRpYyBmYXN0cGF0aF90IHZt
eF92Y3B1X3J1bihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJcmV0dXJuIGV4aXRfZmFzdHBhdGg7
CiB9CiAKK3N0YXRpYyB2b2lkIHZteF9kZXN0cm95X2VwdHBfbGlzdF9wYWdlKHN0cnVjdCB2Y3B1
X3ZteCAqdm14KQoreworCWlmICh2bXgtPmVwdHBfbGlzdF9wZykgeworCQlfX2ZyZWVfcGFnZSh2
bXgtPmVwdHBfbGlzdF9wZyk7CisJCXZteC0+ZXB0cF9saXN0X3BnID0gTlVMTDsKKwl9Cit9CisK
IHN0YXRpYyB2b2lkIHZteF9mcmVlX3ZjcHUoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogewogCXN0
cnVjdCB2Y3B1X3ZteCAqdm14ID0gdG9fdm14KHZjcHUpOwogCiAJaWYgKGVuYWJsZV9wbWwpCiAJ
CXZteF9kZXN0cm95X3BtbF9idWZmZXIodm14KTsKKwl2bXhfZGVzdHJveV9lcHRwX2xpc3RfcGFn
ZSh2bXgpOwogCWZyZWVfdnBpZCh2bXgtPnZwaWQpOwogCW5lc3RlZF92bXhfZnJlZV92Y3B1KHZj
cHUpOwogCWZyZWVfbG9hZGVkX3ZtY3Modm14LT5sb2FkZWRfdm1jcyk7CkBAIC03MDIxLDYgKzcx
MTMsMTIgQEAgc3RhdGljIGludCB2bXhfY3JlYXRlX3ZjcHUoc3RydWN0IGt2bV92Y3B1ICp2Y3B1
KQogCWlmIChlcnIgPCAwKQogCQlnb3RvIGZyZWVfcG1sOwogCisJaWYgKGt2bV9lcHRwX3N3aXRj
aGluZ19zdXBwb3J0ZWQpIHsKKwkJZXJyID0gdm14X2FsbG9jX2VwdHBfbGlzdF9wYWdlKHZteCk7
CisJCWlmIChlcnIpCisJCQlnb3RvIGZyZWVfcG1sOworCX0KKwogCW1zcl9iaXRtYXAgPSB2bXgt
PnZtY3MwMS5tc3JfYml0bWFwOwogCXZteF9kaXNhYmxlX2ludGVyY2VwdF9mb3JfbXNyKE5VTEws
IG1zcl9iaXRtYXAsIE1TUl9JQTMyX1RTQywgTVNSX1RZUEVfUik7CiAJdm14X2Rpc2FibGVfaW50
ZXJjZXB0X2Zvcl9tc3IoTlVMTCwgbXNyX2JpdG1hcCwgTVNSX0ZTX0JBU0UsIE1TUl9UWVBFX1JX
KTsKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2t2bS92bXgvdm14LmggYi9hcmNoL3g4Ni9rdm0vdm14
L3ZteC5oCmluZGV4IDE0ZjBiOTEwMmQ1OC4uNGUyZjg2NDU4Y2EyIDEwMDY0NAotLS0gYS9hcmNo
L3g4Ni9rdm0vdm14L3ZteC5oCisrKyBiL2FyY2gveDg2L2t2bS92bXgvdm14LmgKQEAgLTI5Nyw2
ICsyOTcsNyBAQCBzdHJ1Y3QgdmNwdV92bXggewogCiAJc3RydWN0IHB0X2Rlc2MgcHRfZGVzYzsK
IAorCXN0cnVjdCBwYWdlICplcHRwX2xpc3RfcGc7CiAJLyogVGhlIHZpZXcgdGhpcyB2Y3B1IG9w
ZXJhdGVzIG9uLiAqLwogCXUxNiB2aWV3OwogfTsKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxp
emF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3Vu
ZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
