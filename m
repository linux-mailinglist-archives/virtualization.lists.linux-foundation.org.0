Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id 8EF80228B1F
	for <lists.virtualization@lfdr.de>; Tue, 21 Jul 2020 23:26:05 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by whitealder.osuosl.org (Postfix) with ESMTP id 3096288325;
	Tue, 21 Jul 2020 21:26:04 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id FXms5uWCodo4; Tue, 21 Jul 2020 21:25:58 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by whitealder.osuosl.org (Postfix) with ESMTP id D26A588278;
	Tue, 21 Jul 2020 21:25:56 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id BA86FC016F;
	Tue, 21 Jul 2020 21:25:56 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 1AE21C08A6
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:55 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id F1DB22274B
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:54 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id q+Ignuvx6+Go
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:53 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by silver.osuosl.org (Postfix) with ESMTPS id B317C21F76
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:52 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 8F379305D618; Wed, 22 Jul 2020 00:09:25 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 598B6304FA13;
 Wed, 22 Jul 2020 00:09:25 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v9 43/84] KVM: introspection: add KVMI_VM_GET_INFO
Date: Wed, 22 Jul 2020 00:08:41 +0300
Message-Id: <20200721210922.7646-44-alazar@bitdefender.com>
In-Reply-To: <20200721210922.7646-1-alazar@bitdefender.com>
References: <20200721210922.7646-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKRm9yIG5vdywgdGhp
cyBjb21tYW5kIHJldHVybnMgb25seSB0aGUgbnVtYmVyIG9mIG9ubGluZSB2Q1BVcy4KClRoZSBp
bnRyb3NwZWN0aW9uIHRvb2wgdXNlcyB0aGUgdkNQVSBpbmRleCB0byBzcGVjaWZ5IHRvIHdoaWNo
IHZDUFUKdGhlIGludHJvc3BlY3Rpb24gY29tbWFuZCBhcHBsaWVzIHRvLgoKU2lnbmVkLW9mZi1i
eTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgpTaWduZWQtb2ZmLWJ5OiBB
ZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogRG9jdW1lbnRhdGlv
bi92aXJ0L2t2bS9rdm1pLnJzdCAgICAgICAgICAgICAgIHwgMTggKysrKysrKysrKwogaW5jbHVk
ZS91YXBpL2xpbnV4L2t2bWkuaCAgICAgICAgICAgICAgICAgICAgIHwgIDYgKysrKwogLi4uL3Rl
c3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMgIHwgMzUgKysrKysrKysrKysr
KysrKystLQogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jICAgICAgICAgICAgIHwg
MTMgKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCA2OSBpbnNlcnRpb25zKCspLCAzIGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QgYi9Eb2N1
bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CmluZGV4IGEyY2RhMzI2OGRhMC4uYTgxZjIyY2I4
YzE4IDEwMDY0NAotLS0gYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CisrKyBiL0Rv
Y3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKQEAgLTMyMywzICszMjMsMjEgQEAgVGhpcyBj
b21tYW5kIGlzIGFsd2F5cyBhbGxvd2VkLgogKiAtS1ZNX0VOT0VOVCAtIHRoZSBldmVudCBzcGVj
aWZpZWQgYnkgYGBpZGBgIGlzIHVuc3VwcG9ydGVkCiAqIC1LVk1fRVBFUk0gLSB0aGUgZXZlbnQg
c3BlY2lmaWVkIGJ5IGBgaWRgYCBpcyBkaXNhbGxvd2VkCiAqIC1LVk1fRUlOVkFMIC0gdGhlIHBh
ZGRpbmcgaXMgbm90IHplcm8KKworNC4gS1ZNSV9WTV9HRVRfSU5GTworLS0tLS0tLS0tLS0tLS0t
LS0tLQorCis6QXJjaGl0ZWN0dXJlczogYWxsCis6VmVyc2lvbnM6ID49IDEKKzpQYXJhbWV0ZXJz
OiBub25lCis6UmV0dXJuczoKKworOjoKKworCXN0cnVjdCBrdm1pX2Vycm9yX2NvZGU7CisJc3Ry
dWN0IGt2bWlfdm1fZ2V0X2luZm9fcmVwbHkgeworCQlfX3UzMiB2Y3B1X2NvdW50OworCQlfX3Uz
MiBwYWRkaW5nWzNdOworCX07CisKK1JldHVybnMgdGhlIG51bWJlciBvZiBvbmxpbmUgdkNQVXMu
CmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oIGIvaW5jbHVkZS91YXBpL2xp
bnV4L2t2bWkuaAppbmRleCBlNTVhMGZhNjZhYzUuLmVhYmFmN2NlYTFkZiAxMDA2NDQKLS0tIGEv
aW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAorKysgYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5o
CkBAIC0xNyw2ICsxNyw3IEBAIGVudW0gewogCUtWTUlfR0VUX1ZFUlNJT04gICAgICA9IDEsCiAJ
S1ZNSV9WTV9DSEVDS19DT01NQU5EID0gMiwKIAlLVk1JX1ZNX0NIRUNLX0VWRU5UICAgPSAzLAor
CUtWTUlfVk1fR0VUX0lORk8gICAgICA9IDQsCiAKIAlLVk1JX05VTV9NRVNTQUdFUwogfTsKQEAg
LTYzLDQgKzY0LDkgQEAgc3RydWN0IGt2bWlfdm1fY2hlY2tfZXZlbnQgewogCV9fdTMyIHBhZGRp
bmcyOwogfTsKIAorc3RydWN0IGt2bWlfdm1fZ2V0X2luZm9fcmVwbHkgeworCV9fdTMyIHZjcHVf
Y291bnQ7CisJX191MzIgcGFkZGluZ1szXTsKK307CisKICNlbmRpZiAvKiBfVUFQSV9fTElOVVhf
S1ZNSV9IICovCmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0
L2t2bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rl
c3QuYwppbmRleCAyODIxNmM0ZThiOWQuLjFmNGExNjVhYjY0MCAxMDA2NDQKLS0tIGEvdG9vbHMv
dGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYworKysgYi90b29scy90ZXN0
aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCkBAIC04NCw2ICs4NCwxNiBAQCBz
dGF0aWMgdm9pZCBzZXRfY29tbWFuZF9wZXJtKHN0cnVjdCBrdm1fdm0gKnZtLCBfX3MzMiBpZCwg
X191MzIgYWxsb3csCiAJCSAiS1ZNX0lOVFJPU1BFQ1RJT05fQ09NTUFORCIpOwogfQogCitzdGF0
aWMgdm9pZCBkaXNhbGxvd19jb21tYW5kKHN0cnVjdCBrdm1fdm0gKnZtLCBfX3MzMiBpZCkKK3sK
KwlzZXRfY29tbWFuZF9wZXJtKHZtLCBpZCwgMCwgMCk7Cit9CisKK3N0YXRpYyB2b2lkIGFsbG93
X2NvbW1hbmQoc3RydWN0IGt2bV92bSAqdm0sIF9fczMyIGlkKQoreworCXNldF9jb21tYW5kX3Bl
cm0odm0sIGlkLCAxLCAwKTsKK30KKwogc3RhdGljIHZvaWQgaG9va19pbnRyb3NwZWN0aW9uKHN0
cnVjdCBrdm1fdm0gKnZtKQogewogCV9fdTMyIGFsbG93ID0gMSwgZGlzYWxsb3cgPSAwLCBhbGxv
d19pbnZhbCA9IDI7CkBAIC0yNTgsMTQgKzI2OCwxOCBAQCBzdGF0aWMgdm9pZCBjbWRfdm1fY2hl
Y2tfY29tbWFuZChfX3UxNiBpZCwgX191MTYgcGFkZGluZywgaW50IGV4cGVjdGVkX2VycikKIAkJ
LXIsIGt2bV9zdHJlcnJvcigtciksIGV4cGVjdGVkX2Vycik7CiB9CiAKLXN0YXRpYyB2b2lkIHRl
c3RfY21kX3ZtX2NoZWNrX2NvbW1hbmQodm9pZCkKK3N0YXRpYyB2b2lkIHRlc3RfY21kX3ZtX2No
ZWNrX2NvbW1hbmQoc3RydWN0IGt2bV92bSAqdm0pCiB7Ci0JX191MTYgdmFsaWRfaWQgPSBLVk1J
X0dFVF9WRVJTSU9OLCBpbnZhbGlkX2lkID0gMHhmZmZmOworCV9fdTE2IHZhbGlkX2lkID0gS1ZN
SV9WTV9HRVRfSU5GTywgaW52YWxpZF9pZCA9IDB4ZmZmZjsKIAlfX3UxNiBwYWRkaW5nID0gMSwg
bm9fcGFkZGluZyA9IDA7CiAKIAljbWRfdm1fY2hlY2tfY29tbWFuZCh2YWxpZF9pZCwgbm9fcGFk
ZGluZywgMCk7CiAJY21kX3ZtX2NoZWNrX2NvbW1hbmQodmFsaWRfaWQsIHBhZGRpbmcsIC1LVk1f
RUlOVkFMKTsKIAljbWRfdm1fY2hlY2tfY29tbWFuZChpbnZhbGlkX2lkLCBub19wYWRkaW5nLCAt
S1ZNX0VOT0VOVCk7CisKKwlkaXNhbGxvd19jb21tYW5kKHZtLCB2YWxpZF9pZCk7CisJY21kX3Zt
X2NoZWNrX2NvbW1hbmQodmFsaWRfaWQsIG5vX3BhZGRpbmcsIC1LVk1fRVBFUk0pOworCWFsbG93
X2NvbW1hbmQodm0sIHZhbGlkX2lkKTsKIH0KIAogc3RhdGljIHZvaWQgY21kX3ZtX2NoZWNrX2V2
ZW50KF9fdTE2IGlkLCBfX3UxNiBwYWRkaW5nLCBpbnQgZXhwZWN0ZWRfZXJyKQpAQCAtMjk1LDYg
KzMwOSwyMCBAQCBzdGF0aWMgdm9pZCB0ZXN0X2NtZF92bV9jaGVja19ldmVudCh2b2lkKQogCWNt
ZF92bV9jaGVja19ldmVudChpbnZhbGlkX2lkLCBub19wYWRkaW5nLCAtS1ZNX0VOT0VOVCk7CiB9
CiAKK3N0YXRpYyB2b2lkIHRlc3RfY21kX3ZtX2dldF9pbmZvKHZvaWQpCit7CisJc3RydWN0IGt2
bWlfdm1fZ2V0X2luZm9fcmVwbHkgcnBsOworCXN0cnVjdCBrdm1pX21zZ19oZHIgcmVxOworCisJ
dGVzdF92bV9jb21tYW5kKEtWTUlfVk1fR0VUX0lORk8sICZyZXEsIHNpemVvZihyZXEpLCAmcnBs
LAorCQkJc2l6ZW9mKHJwbCkpOworCVRFU1RfQVNTRVJUKHJwbC52Y3B1X2NvdW50ID09IDEsCisJ
CSAgICAiVW5leHBlY3RlZCBudW1iZXIgb2YgdkNQVSBjb3VudCAldVxuIiwKKwkJICAgIHJwbC52
Y3B1X2NvdW50KTsKKworCXByX2luZm8oInZjcHUgY291bnQ6ICV1XG4iLCBycGwudmNwdV9jb3Vu
dCk7Cit9CisKIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2
bSkKIHsKIAlzZXR1cF9zb2NrZXQoKTsKQEAgLTMwMiw4ICszMzAsOSBAQCBzdGF0aWMgdm9pZCB0
ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAqdm0pCiAKIAl0ZXN0X2NtZF9pbnZhbGlk
KCk7CiAJdGVzdF9jbWRfZ2V0X3ZlcnNpb24oKTsKLQl0ZXN0X2NtZF92bV9jaGVja19jb21tYW5k
KCk7CisJdGVzdF9jbWRfdm1fY2hlY2tfY29tbWFuZCh2bSk7CiAJdGVzdF9jbWRfdm1fY2hlY2tf
ZXZlbnQoKTsKKwl0ZXN0X2NtZF92bV9nZXRfaW5mbygpOwogCiAJdW5ob29rX2ludHJvc3BlY3Rp
b24odm0pOwogfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5j
IGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCmluZGV4IDg2YzM1NmFmYzE1NC4u
M2RmMThmNzk2NWMwIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNn
LmMKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCkBAIC0xNTAsNiArMTUw
LDE4IEBAIHN0YXRpYyBpbnQgaGFuZGxlX3ZtX2NoZWNrX2V2ZW50KHN0cnVjdCBrdm1faW50cm9z
cGVjdGlvbiAqa3ZtaSwKIAlyZXR1cm4ga3ZtaV9tc2dfdm1fcmVwbHkoa3ZtaSwgbXNnLCBlYywg
TlVMTCwgMCk7CiB9CiAKK3N0YXRpYyBpbnQgaGFuZGxlX3ZtX2dldF9pbmZvKHN0cnVjdCBrdm1f
aW50cm9zcGVjdGlvbiAqa3ZtaSwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIg
Km1zZywKKwkJCSAgICAgIGNvbnN0IHZvaWQgKnJlcSkKK3sKKwlzdHJ1Y3Qga3ZtaV92bV9nZXRf
aW5mb19yZXBseSBycGw7CisKKwltZW1zZXQoJnJwbCwgMCwgc2l6ZW9mKHJwbCkpOworCXJwbC52
Y3B1X2NvdW50ID0gYXRvbWljX3JlYWQoJmt2bWktPmt2bS0+b25saW5lX3ZjcHVzKTsKKworCXJl
dHVybiBrdm1pX21zZ192bV9yZXBseShrdm1pLCBtc2csIDAsICZycGwsIHNpemVvZihycGwpKTsK
K30KKwogLyoKICAqIFRoZXNlIGNvbW1hbmRzIGFyZSBleGVjdXRlZCBieSB0aGUgcmVjZWl2aW5n
IHRocmVhZC4KICAqLwpAQCAtMTU4LDYgKzE3MCw3IEBAIHN0YXRpYyBpbnQoKmNvbnN0IG1zZ192
bVtdKShzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKiwKIAlbS1ZNSV9HRVRfVkVSU0lPTl0gICAg
ICA9IGhhbmRsZV9nZXRfdmVyc2lvbiwKIAlbS1ZNSV9WTV9DSEVDS19DT01NQU5EXSA9IGhhbmRs
ZV92bV9jaGVja19jb21tYW5kLAogCVtLVk1JX1ZNX0NIRUNLX0VWRU5UXSAgID0gaGFuZGxlX3Zt
X2NoZWNrX2V2ZW50LAorCVtLVk1JX1ZNX0dFVF9JTkZPXSAgICAgID0gaGFuZGxlX3ZtX2dldF9p
bmZvLAogfTsKIAogc3RhdGljIGJvb2wgaXNfdm1fY29tbWFuZCh1MTYgaWQpCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxp
bmcgbGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczov
L2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlv
bg==
