Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
	by mail.lfdr.de (Postfix) with ESMTPS id 5D95942453A
	for <lists.virtualization@lfdr.de>; Wed,  6 Oct 2021 19:50:55 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id 4F1C060F02;
	Wed,  6 Oct 2021 17:50:50 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id oO36iK66Jfrs; Wed,  6 Oct 2021 17:50:49 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp3.osuosl.org (Postfix) with ESMTPS id 88BD760EF6;
	Wed,  6 Oct 2021 17:50:48 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 72A84C0011;
	Wed,  6 Oct 2021 17:50:47 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 25A8EC000D
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:44 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id B8B78407EB
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:43 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id f5vK270EaUCd
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:42 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.8.0
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by smtp2.osuosl.org (Postfix) with ESMTPS id 65EB9407D0
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:42 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 AC8DB305D355; Wed,  6 Oct 2021 20:31:15 +0300 (EEST)
Received: from localhost (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 8FFE23064495;
 Wed,  6 Oct 2021 20:31:15 +0300 (EEST)
X-Is-Junk-Enabled: fGZTSsP0qEJE2AIKtlSuFiRRwg9xyHmJ
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v12 52/77] KVM: introspection: add KVMI_VCPU_GET_CPUID
Date: Wed,  6 Oct 2021 20:30:48 +0300
Message-Id: <20211006173113.26445-53-alazar@bitdefender.com>
In-Reply-To: <20211006173113.26445-1-alazar@bitdefender.com>
References: <20211006173113.26445-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: Tamas K Lengyel <tamas@tklengyel.com>, Wanpeng Li <wanpengli@tencent.com>,
 Sean Christopherson <seanjc@google.com>, Joerg Roedel <joro@8bytes.org>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Marian Rotariu <marian.c.rotariu@gmail.com>,
 Mathieu Tarral <mathieu.tarral@protonmail.com>,
 Paolo Bonzini <pbonzini@redhat.com>, Jim Mattson <jmattson@google.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWFyaWFuIFJvdGFyaXUgPG1hcmlhbi5jLnJvdGFyaXVAZ21haWwuY29tPgoKVGhpcyBj
b21tYW5kIHJldHVybnMgYSBDUFVJRCBsZWFmIChhcyBzZWVuIGJ5IHRoZSBndWVzdCBPUykuCgpT
aWduZWQtb2ZmLWJ5OiBNYXJpYW4gUm90YXJpdSA8bWFyaWFuLmMucm90YXJpdUBnbWFpbC5jb20+
CkNvLWRldmVsb3BlZC1ieTogQWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29t
PgpTaWduZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+
Ci0tLQogRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCAgICAgICAgICAgICAgIHwgMzYg
KysrKysrKysrKysrKysrKysrKwogYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmggICAg
ICAgICAgICAgIHwgMTIgKysrKysrKwogYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMgICAgICAgICAg
ICAgICAgICAgICAgIHwgMjYgKysrKysrKysrKysrKysKIGluY2x1ZGUvdWFwaS9saW51eC9rdm1p
LmggICAgICAgICAgICAgICAgICAgICB8ICAxICsKIC4uLi90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0v
eDg2XzY0L2t2bWlfdGVzdC5jICB8IDMwICsrKysrKysrKysrKysrKysKIDUgZmlsZXMgY2hhbmdl
ZCwgMTA1IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3Zt
L2t2bWkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAppbmRleCBiZWVhMjBh
MzA2ZWYuLjhiOTkzODAzMjY1MCAxMDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9r
dm1pLnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CkBAIC02MzAsNiAr
NjMwLDQyIEBAIGN1cnJlbnRseSBiZWluZyBoYW5kbGVkIGlzIHJlcGxpZWQgdG8uCiAqIC1LVk1f
RUFHQUlOIC0gdGhlIHNlbGVjdGVkIHZDUFUgY2FuJ3QgYmUgaW50cm9zcGVjdGVkIHlldAogKiAt
S1ZNX0VPUE5PVFNVUFAgLSB0aGUgY29tbWFuZCBoYXNuJ3QgYmVlbiByZWNlaXZlZCBkdXJpbmcg
YW4gaW50cm9zcGVjdGlvbiBldmVudAogCisxMy4gS1ZNSV9WQ1BVX0dFVF9DUFVJRAorLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0KKworOkFyY2hpdGVjdHVyZXM6IHg4NgorOlZlcnNpb25zOiA+PSAx
Cis6UGFyYW1ldGVyczoKKworOjoKKworCXN0cnVjdCBrdm1pX3ZjcHVfaGRyOworCXN0cnVjdCBr
dm1pX3ZjcHVfZ2V0X2NwdWlkIHsKKwkJX191MzIgZnVuY3Rpb247CisJCV9fdTMyIGluZGV4Owor
CX07CisKKzpSZXR1cm5zOgorCis6OgorCisJc3RydWN0IGt2bWlfZXJyb3JfY29kZTsKKwlzdHJ1
Y3Qga3ZtaV92Y3B1X2dldF9jcHVpZF9yZXBseSB7CisJCV9fdTMyIGVheDsKKwkJX191MzIgZWJ4
OworCQlfX3UzMiBlY3g7CisJCV9fdTMyIGVkeDsKKwl9OworCitSZXR1cm5zIGEgQ1BVSUQgbGVh
ZiAoYXMgc2VlbiBieSB0aGUgZ3Vlc3QgT1MpLgorCis6RXJyb3JzOgorCisqIC1LVk1fRUlOVkFM
IC0gdGhlIHNlbGVjdGVkIHZDUFUgaXMgaW52YWxpZAorKiAtS1ZNX0VJTlZBTCAtIHRoZSBwYWRk
aW5nIGlzIG5vdCB6ZXJvCisqIC1LVk1fRUFHQUlOIC0gdGhlIHNlbGVjdGVkIHZDUFUgY2FuJ3Qg
YmUgaW50cm9zcGVjdGVkIHlldAorKiAtS1ZNX0VOT0VOVCAtIHRoZSBzZWxlY3RlZCBsZWFmIGlz
IG5vdCBwcmVzZW50IG9yIGlzIGludmFsaWQKKwogRXZlbnRzCiA9PT09PT0KIApkaWZmIC0tZ2l0
IGEvYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmggYi9hcmNoL3g4Ni9pbmNsdWRlL3Vh
cGkvYXNtL2t2bWkuaAppbmRleCAxMTgzNWJmOWJkYzYuLjM2MzFkYTllZWY4YyAxMDA2NDQKLS0t
IGEvYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmgKKysrIGIvYXJjaC94ODYvaW5jbHVk
ZS91YXBpL2FzbS9rdm1pLmgKQEAgLTQ1LDQgKzQ1LDE2IEBAIHN0cnVjdCBrdm1pX3ZjcHVfZ2V0
X3JlZ2lzdGVyc19yZXBseSB7CiAJc3RydWN0IGt2bV9tc3JzIG1zcnM7CiB9OwogCitzdHJ1Y3Qg
a3ZtaV92Y3B1X2dldF9jcHVpZCB7CisJX191MzIgZnVuY3Rpb247CisJX191MzIgaW5kZXg7Cit9
OworCitzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9jcHVpZF9yZXBseSB7CisJX191MzIgZWF4OworCV9f
dTMyIGVieDsKKwlfX3UzMiBlY3g7CisJX191MzIgZWR4OworfTsKKwogI2VuZGlmIC8qIF9VQVBJ
X0FTTV9YODZfS1ZNSV9IICovCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYyBi
L2FyY2gveDg2L2t2bS9rdm1pX21zZy5jCmluZGV4IGI0MTEzNzQ5YmNkMC4uZDQ4YWJmZTUxMzNi
IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYworKysgYi9hcmNoL3g4Ni9rdm0v
a3ZtaV9tc2cuYwpAQCAtNiw2ICs2LDcgQEAKICAqCiAgKi8KIAorI2luY2x1ZGUgImNwdWlkLmgi
CiAjaW5jbHVkZSAiLi4vLi4vLi4vdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oIgog
I2luY2x1ZGUgImt2bWkuaCIKIApAQCAtMTEwLDcgKzExMSwzMiBAQCBzdGF0aWMgaW50IGhhbmRs
ZV92Y3B1X3NldF9yZWdpc3RlcnMoY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9tc2dfam9iICpqb2Is
CiAJcmV0dXJuIGt2bWlfbXNnX3ZjcHVfcmVwbHkoam9iLCBtc2csIGVjLCBOVUxMLCAwKTsKIH0K
IAorc3RhdGljIGludCBoYW5kbGVfdmNwdV9nZXRfY3B1aWQoY29uc3Qgc3RydWN0IGt2bWlfdmNw
dV9tc2dfam9iICpqb2IsCisJCQkJIGNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZywKKwkJ
CQkgY29uc3Qgdm9pZCAqX3JlcSkKK3sKKwljb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9jcHVp
ZCAqcmVxID0gX3JlcTsKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9jcHVpZF9yZXBseSBycGw7CisJ
c3RydWN0IGt2bV9jcHVpZF9lbnRyeTIgKmVudHJ5OworCWludCBlYyA9IDA7CisKKwllbnRyeSA9
IGt2bV9maW5kX2NwdWlkX2VudHJ5KGpvYi0+dmNwdSwgcmVxLT5mdW5jdGlvbiwgcmVxLT5pbmRl
eCk7CisJaWYgKCFlbnRyeSkgeworCQllYyA9IC1LVk1fRU5PRU5UOworCX0gZWxzZSB7CisJCW1l
bXNldCgmcnBsLCAwLCBzaXplb2YocnBsKSk7CisKKwkJcnBsLmVheCA9IGVudHJ5LT5lYXg7CisJ
CXJwbC5lYnggPSBlbnRyeS0+ZWJ4OworCQlycGwuZWN4ID0gZW50cnktPmVjeDsKKwkJcnBsLmVk
eCA9IGVudHJ5LT5lZHg7CisJfQorCisJcmV0dXJuIGt2bWlfbXNnX3ZjcHVfcmVwbHkoam9iLCBt
c2csIGVjLCAmcnBsLCBzaXplb2YocnBsKSk7Cit9CisKIHN0YXRpYyBjb25zdCBrdm1pX3ZjcHVf
bXNnX2pvYl9mY3QgbXNnX3ZjcHVbXSA9IHsKKwlbS1ZNSV9WQ1BVX0dFVF9DUFVJRF0gICAgID0g
aGFuZGxlX3ZjcHVfZ2V0X2NwdWlkLAogCVtLVk1JX1ZDUFVfR0VUX0lORk9dICAgICAgPSBoYW5k
bGVfdmNwdV9nZXRfaW5mbywKIAlbS1ZNSV9WQ1BVX0dFVF9SRUdJU1RFUlNdID0gaGFuZGxlX3Zj
cHVfZ2V0X3JlZ2lzdGVycywKIAlbS1ZNSV9WQ1BVX1NFVF9SRUdJU1RFUlNdID0gaGFuZGxlX3Zj
cHVfc2V0X3JlZ2lzdGVycywKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgg
Yi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCmluZGV4IDRiNzU2ZDM4OGFkMy4uMmM5M2EzNmJm
YTQzIDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2luY2x1ZGUv
dWFwaS9saW51eC9rdm1pLmgKQEAgLTM5LDYgKzM5LDcgQEAgZW51bSB7CiAJS1ZNSV9WQ1BVX0NP
TlRST0xfRVZFTlRTID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoMiksCiAJS1ZNSV9WQ1BVX0dFVF9S
RUdJU1RFUlMgID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoMyksCiAJS1ZNSV9WQ1BVX1NFVF9SRUdJ
U1RFUlMgID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoNCksCisJS1ZNSV9WQ1BVX0dFVF9DUFVJRCAg
ICAgID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoNSksCiAKIAlLVk1JX05FWFRfVkNQVV9NRVNTQUdF
CiB9OwpkaWZmIC0tZ2l0IGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1p
X3Rlc3QuYyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMK
aW5kZXggNGU5M2I3MGRkN2QzLi44MzdkMTRkYWU0NDggMTAwNjQ0Ci0tLSBhL3Rvb2xzL3Rlc3Rp
bmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKKysrIGIvdG9vbHMvdGVzdGluZy9z
ZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYwpAQCAtOTYyLDYgKzk2MiwzNSBAQCBzdGF0
aWMgdm9pZCB0ZXN0X2NtZF92Y3B1X3NldF9yZWdpc3RlcnMoc3RydWN0IGt2bV92bSAqdm0pCiAJ
d2FpdF92Y3B1X3dvcmtlcih2Y3B1X3RocmVhZCk7CiB9CiAKK3N0YXRpYyB2b2lkIGNtZF92Y3B1
X2dldF9jcHVpZChzdHJ1Y3Qga3ZtX3ZtICp2bSwKKwkJCSAgICAgICBfX3UzMiBmdW5jdGlvbiwg
X191MzIgaW5kZXgsCisJCQkgICAgICAgc3RydWN0IGt2bWlfdmNwdV9nZXRfY3B1aWRfcmVwbHkg
KnJwbCkKK3sKKwlzdHJ1Y3QgeworCQlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwkJc3RydWN0
IGt2bWlfdmNwdV9oZHIgdmNwdV9oZHI7CisJCXN0cnVjdCBrdm1pX3ZjcHVfZ2V0X2NwdWlkIGNt
ZDsKKwl9IHJlcSA9IHt9OworCisJcmVxLmNtZC5mdW5jdGlvbiA9IGZ1bmN0aW9uOworCXJlcS5j
bWQuaW5kZXggPSBpbmRleDsKKworCXRlc3RfdmNwdTBfY29tbWFuZCh2bSwgS1ZNSV9WQ1BVX0dF
VF9DUFVJRCwgJnJlcS5oZHIsIHNpemVvZihyZXEpLAorCQkJICAgcnBsLCBzaXplb2YoKnJwbCks
IDApOworfQorCitzdGF0aWMgdm9pZCB0ZXN0X2NtZF92Y3B1X2dldF9jcHVpZChzdHJ1Y3Qga3Zt
X3ZtICp2bSkKK3sKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9jcHVpZF9yZXBseSBycGwgPSB7fTsK
KwlfX3UzMiBmdW5jdGlvbiA9IDA7CisJX191MzIgaW5kZXggPSAwOworCisJY21kX3ZjcHVfZ2V0
X2NwdWlkKHZtLCBmdW5jdGlvbiwgaW5kZXgsICZycGwpOworCisJcHJfZGVidWcoImNwdWlkKCV1
LCAldSkgPT4gZWF4IDB4JS44eCwgZWJ4IDB4JS44eCwgZWN4IDB4JS44eCwgZWR4IDB4JS44eFxu
IiwKKwkgICAgICBmdW5jdGlvbiwgaW5kZXgsIHJwbC5lYXgsIHJwbC5lYngsIHJwbC5lY3gsIHJw
bC5lZHgpOworfQorCiBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92
bSAqdm0pCiB7CiAJc3JhbmRvbSh0aW1lKDApKTsKQEAgLTk4MSw2ICsxMDEwLDcgQEAgc3RhdGlj
IHZvaWQgdGVzdF9pbnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtKQogCXRlc3RfY21kX3Zj
cHVfY29udHJvbF9ldmVudHModm0pOwogCXRlc3RfY21kX3ZjcHVfZ2V0X3JlZ2lzdGVycyh2bSk7
CiAJdGVzdF9jbWRfdmNwdV9zZXRfcmVnaXN0ZXJzKHZtKTsKKwl0ZXN0X2NtZF92Y3B1X2dldF9j
cHVpZCh2bSk7CiAKIAl1bmhvb2tfaW50cm9zcGVjdGlvbih2bSk7CiB9Cl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcg
bGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xp
c3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
