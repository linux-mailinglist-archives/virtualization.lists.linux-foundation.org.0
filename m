Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id 72DE7197949
	for <lists.virtualization@lfdr.de>; Mon, 30 Mar 2020 12:29:54 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by whitealder.osuosl.org (Postfix) with ESMTP id E25D487C99;
	Mon, 30 Mar 2020 10:29:52 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 4N3K7YGu0kVi; Mon, 30 Mar 2020 10:29:51 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by whitealder.osuosl.org (Postfix) with ESMTP id 76CBE87C4F;
	Mon, 30 Mar 2020 10:29:51 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 68171C07FF;
	Mon, 30 Mar 2020 10:29:51 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id EEE9EC07FF
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:29:49 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id D981987C4F
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:29:49 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id uWTUkdtxjyOY
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:29:49 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id A995B87C30
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:29:48 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 D39C5305FFA5; Mon, 30 Mar 2020 13:12:56 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id AF115305B7A3;
 Mon, 30 Mar 2020 13:12:56 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v8 50/81] KVM: introspection: handle vCPU introspection
 requests
Date: Mon, 30 Mar 2020 13:12:37 +0300
Message-Id: <20200330101308.21702-51-alazar@bitdefender.com>
In-Reply-To: <20200330101308.21702-1-alazar@bitdefender.com>
References: <20200330101308.21702-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Mircea=20C=C3=AErjaliu?= <mcirjaliu@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhlIGludHJvc3Bl
Y3Rpb24gcmVxdWVzdHMgKEtWTV9SRVFfSU5UUk9TUEVDVElPTikgYXJlIGNoZWNrZWQgYmVmb3Jl
CmVudGVyaW5nIGd1ZXN0IG9yIHdoZW4gdGhlIHZDUFUgaXMgaGFsdGVkLgoKU2lnbmVkLW9mZi1i
eTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgpDby1kZXZlbG9wZWQtYnk6
IE1pcmNlYSBDw65yamFsaXUgPG1jaXJqYWxpdUBiaXRkZWZlbmRlci5jb20+ClNpZ25lZC1vZmYt
Ynk6IE1pcmNlYSBDw65yamFsaXUgPG1jaXJqYWxpdUBiaXRkZWZlbmRlci5jb20+CkNvLWRldmVs
b3BlZC1ieTogQWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgpTaWduZWQt
b2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogYXJj
aC94ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaCB8ICAxICsKIGFyY2gveDg2L2t2bS94ODYuYyAg
ICAgICAgICAgICAgfCAgMyArKwogaW5jbHVkZS9saW51eC9rdm1pX2hvc3QuaCAgICAgICB8ICA0
ICsrKwogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMgICB8IDU4ICsrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKwogdmlydC9rdm0va3ZtX21haW4uYyAgICAgICAgICAgICB8ICAy
ICsrCiA1IGZpbGVzIGNoYW5nZWQsIDY4IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9hcmNo
L3g4Ni9pbmNsdWRlL2FzbS9rdm1faG9zdC5oIGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hv
c3QuaAppbmRleCA2MTY5ZTEyZDI1NDAuLmMyMTc2MDEyNjc2ZCAxMDA2NDQKLS0tIGEvYXJjaC94
ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaAorKysgYi9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1f
aG9zdC5oCkBAIC04MCw2ICs4MCw3IEBACiAjZGVmaW5lIEtWTV9SRVFfR0VUX1ZNQ1MxMl9QQUdF
UwlLVk1fQVJDSF9SRVEoMjQpCiAjZGVmaW5lIEtWTV9SRVFfQVBJQ1ZfVVBEQVRFIFwKIAlLVk1f
QVJDSF9SRVFfRkxBR1MoMjUsIEtWTV9SRVFVRVNUX1dBSVQgfCBLVk1fUkVRVUVTVF9OT19XQUtF
VVApCisjZGVmaW5lIEtWTV9SRVFfSU5UUk9TUEVDVElPTgkJS1ZNX0FSQ0hfUkVRKDI2KQogCiAj
ZGVmaW5lIENSMF9SRVNFUlZFRF9CSVRTICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBcCiAJKH4odW5zaWduZWQgbG9uZykoWDg2X0NSMF9QRSB8IFg4Nl9DUjBf
TVAgfCBYODZfQ1IwX0VNIHwgWDg2X0NSMF9UUyBcCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0v
eDg2LmMgYi9hcmNoL3g4Ni9rdm0veDg2LmMKaW5kZXggNGZhMTFjOTk4MzI1Li45NjdjODM3OTFi
MzcgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS94ODYuYworKysgYi9hcmNoL3g4Ni9rdm0veDg2
LmMKQEAgLTg1NDksNiArODU0OSw5IEBAIHN0YXRpYyBpbnQgdmNwdV9ydW4oc3RydWN0IGt2bV92
Y3B1ICp2Y3B1KQogCXZjcHUtPmFyY2gubDF0Zl9mbHVzaF9sMWQgPSB0cnVlOwogCiAJZm9yICg7
OykgeworCQlpZiAoa3ZtX2NoZWNrX3JlcXVlc3QoS1ZNX1JFUV9JTlRST1NQRUNUSU9OLCB2Y3B1
KSkKKwkJCWt2bWlfaGFuZGxlX3JlcXVlc3RzKHZjcHUpOworCiAJCWlmIChrdm1fdmNwdV9ydW5u
aW5nKHZjcHUpKSB7CiAJCQlyID0gdmNwdV9lbnRlcl9ndWVzdCh2Y3B1KTsKIAkJfSBlbHNlIHsK
ZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmggYi9pbmNsdWRlL2xpbnV4L2t2
bWlfaG9zdC5oCmluZGV4IDFkODBkMjMzZmJkNS4uNmEwZmI0ODFiMTkyIDEwMDY0NAotLS0gYS9p
bmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCisrKyBiL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmgK
QEAgLTU2LDYgKzU2LDggQEAgaW50IGt2bWlfaW9jdGxfY29tbWFuZChzdHJ1Y3Qga3ZtICprdm0s
IHZvaWQgX191c2VyICphcmdwKTsKIGludCBrdm1pX2lvY3RsX2V2ZW50KHN0cnVjdCBrdm0gKmt2
bSwgdm9pZCBfX3VzZXIgKmFyZ3ApOwogaW50IGt2bWlfaW9jdGxfcHJldW5ob29rKHN0cnVjdCBr
dm0gKmt2bSk7CiAKK3ZvaWQga3ZtaV9oYW5kbGVfcmVxdWVzdHMoc3RydWN0IGt2bV92Y3B1ICp2
Y3B1KTsKKwogI2Vsc2UKIAogc3RhdGljIGlubGluZSBpbnQga3ZtaV9pbml0KHZvaWQpIHsgcmV0
dXJuIDA7IH0KQEAgLTY0LDYgKzY2LDggQEAgc3RhdGljIGlubGluZSB2b2lkIGt2bWlfY3JlYXRl
X3ZtKHN0cnVjdCBrdm0gKmt2bSkgeyB9CiBzdGF0aWMgaW5saW5lIHZvaWQga3ZtaV9kZXN0cm95
X3ZtKHN0cnVjdCBrdm0gKmt2bSkgeyB9CiBzdGF0aWMgaW5saW5lIHZvaWQga3ZtaV92Y3B1X3Vu
aW5pdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpIHsgfQogCitzdGF0aWMgaW5saW5lIHZvaWQga3Zt
aV9oYW5kbGVfcmVxdWVzdHMoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KSB7IH0KKwogI2VuZGlmIC8q
IENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCiAjZW5kaWYKZGlmZiAtLWdpdCBhL3ZpcnQv
a3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMK
aW5kZXggZTM2NDYwYjc1NWU5Li42NWE3N2I4ZDI2MTYgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2lu
dHJvc3BlY3Rpb24va3ZtaS5jCisrKyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCkBA
IC04Nyw2ICs4NywxMiBAQCB2b2lkIGt2bWlfdW5pbml0KHZvaWQpCiAJa3ZtaV9jYWNoZV9kZXN0
cm95KCk7CiB9CiAKK3N0YXRpYyB2b2lkIGt2bWlfbWFrZV9yZXF1ZXN0KHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSkKK3sKKwlrdm1fbWFrZV9yZXF1ZXN0KEtWTV9SRVFfSU5UUk9TUEVDVElPTiwgdmNw
dSk7CisJa3ZtX3ZjcHVfa2ljayh2Y3B1KTsKK30KKwogc3RhdGljIGludCBfX2t2bWlfYWRkX2pv
YihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQkgIHZvaWQgKCpmY3QpKHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwgdm9pZCAqY3R4KSwKIAkJCSAgdm9pZCAqY3R4LCB2b2lkICgqZnJlZV9mY3QpKHZv
aWQgKmN0eCkpCkBAIC0xMTgsNiArMTI0LDkgQEAgaW50IGt2bWlfYWRkX2pvYihzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsCiAKIAllcnIgPSBfX2t2bWlfYWRkX2pvYih2Y3B1LCBmY3QsIGN0eCwgZnJl
ZV9mY3QpOwogCisJaWYgKCFlcnIpCisJCWt2bWlfbWFrZV9yZXF1ZXN0KHZjcHUpOworCiAJcmV0
dXJuIGVycjsKIH0KIApAQCAtMjcwLDYgKzI3OSwxNCBAQCBpbnQga3ZtaV9pb2N0bF91bmhvb2so
c3RydWN0IGt2bSAqa3ZtKQogCXJldHVybiAwOwogfQogCitzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rp
b24gKiBfX211c3RfY2hlY2sga3ZtaV9nZXQoc3RydWN0IGt2bSAqa3ZtKQoreworCWlmIChyZWZj
b3VudF9pbmNfbm90X3plcm8oJmt2bS0+a3ZtaV9yZWYpKQorCQlyZXR1cm4ga3ZtLT5rdm1pOwor
CisJcmV0dXJuIE5VTEw7Cit9CisKIHZvaWQga3ZtaV9wdXQoc3RydWN0IGt2bSAqa3ZtKQogewog
CWlmIChyZWZjb3VudF9kZWNfYW5kX3Rlc3QoJmt2bS0+a3ZtaV9yZWYpKQpAQCAtMzMxLDYgKzM0
OCwxMCBAQCBpbnQga3ZtaV9ob29rKHN0cnVjdCBrdm0gKmt2bSwgY29uc3Qgc3RydWN0IGt2bV9p
bnRyb3NwZWN0aW9uX2hvb2sgKmhvb2spCiAJaW5pdF9jb21wbGV0aW9uKCZrdm0tPmt2bWlfY29t
cGxldGUpOwogCiAJcmVmY291bnRfc2V0KCZrdm0tPmt2bWlfcmVmLCAxKTsKKwkvKgorCSAqIFBh
aXJlZCB3aXRoIHJlZmNvdW50X2luY19ub3RfemVybygpIGZyb20ga3ZtaV9nZXQoKS4KKwkgKi8K
KwlzbXBfd21iKCk7CiAKIAlrdm1pLT5yZWN2ID0ga3RocmVhZF9ydW4oa3ZtaV9yZWN2X3RocmVh
ZCwga3ZtaSwgImt2bWktcmVjdiIpOwogCWlmIChJU19FUlIoa3ZtaS0+cmVjdikpIHsKQEAgLTYz
NSwzICs2NTYsNDAgQEAgaW50IGt2bWlfY21kX3dyaXRlX3BoeXNpY2FsKHN0cnVjdCBrdm0gKmt2
bSwgdTY0IGdwYSwgc2l6ZV90IHNpemUsCiAKIAlyZXR1cm4gMDsKIH0KKworc3RhdGljIHN0cnVj
dCBrdm1pX2pvYiAqa3ZtaV9wdWxsX2pvYihzdHJ1Y3Qga3ZtX3ZjcHVfaW50cm9zcGVjdGlvbiAq
dmNwdWkpCit7CisJc3RydWN0IGt2bWlfam9iICpqb2IgPSBOVUxMOworCisJc3Bpbl9sb2NrKCZ2
Y3B1aS0+am9iX2xvY2spOworCWpvYiA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgmdmNwdWkt
PmpvYl9saXN0LCB0eXBlb2YoKmpvYiksIGxpbmspOworCWlmIChqb2IpCisJCWxpc3RfZGVsKCZq
b2ItPmxpbmspOworCXNwaW5fdW5sb2NrKCZ2Y3B1aS0+am9iX2xvY2spOworCisJcmV0dXJuIGpv
YjsKK30KKwordm9pZCBrdm1pX3J1bl9qb2JzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKK3sKKwlz
dHJ1Y3Qga3ZtX3ZjcHVfaW50cm9zcGVjdGlvbiAqdmNwdWkgPSBWQ1BVSSh2Y3B1KTsKKwlzdHJ1
Y3Qga3ZtaV9qb2IgKmpvYjsKKworCXdoaWxlICgoam9iID0ga3ZtaV9wdWxsX2pvYih2Y3B1aSkp
KSB7CisJCWpvYi0+ZmN0KHZjcHUsIGpvYi0+Y3R4KTsKKwkJa3ZtaV9mcmVlX2pvYihqb2IpOwor
CX0KK30KKwordm9pZCBrdm1pX2hhbmRsZV9yZXF1ZXN0cyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUp
Cit7CisJc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pOworCisJa3ZtaSA9IGt2bWlfZ2V0
KHZjcHUtPmt2bSk7CisJaWYgKCFrdm1pKQorCQlyZXR1cm47CisKKwlrdm1pX3J1bl9qb2JzKHZj
cHUpOworCisJa3ZtaV9wdXQodmNwdS0+a3ZtKTsKK30KZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2t2
bV9tYWluLmMgYi92aXJ0L2t2bS9rdm1fbWFpbi5jCmluZGV4IDhkMmE0YTFhZTNiMC4uNWYyMDMx
MjM0NjM2IDEwMDY0NAotLS0gYS92aXJ0L2t2bS9rdm1fbWFpbi5jCisrKyBiL3ZpcnQva3ZtL2t2
bV9tYWluLmMKQEAgLTI0ODQsNiArMjQ4NCw4IEBAIHN0YXRpYyBpbnQga3ZtX3ZjcHVfY2hlY2tf
YmxvY2soc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogCQlnb3RvIG91dDsKIAlpZiAoc2lnbmFsX3Bl
bmRpbmcoY3VycmVudCkpCiAJCWdvdG8gb3V0OworCWlmIChrdm1fdGVzdF9yZXF1ZXN0KEtWTV9S
RVFfSU5UUk9TUEVDVElPTiwgdmNwdSkpCisJCWdvdG8gb3V0OwogCiAJcmV0ID0gMDsKIG91dDoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6
YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24u
b3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3Zp
cnR1YWxpemF0aW9u
