Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [IPv6:2605:bc80:3010::136])
	by mail.lfdr.de (Postfix) with ESMTPS id 43A1E751758
	for <lists.virtualization@lfdr.de>; Thu, 13 Jul 2023 06:21:50 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id 7D7AE61267;
	Thu, 13 Jul 2023 04:21:48 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 7D7AE61267
Authentication-Results: smtp3.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=JUvgeb/S
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id ighYhmxbVyDL; Thu, 13 Jul 2023 04:21:47 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp3.osuosl.org (Postfix) with ESMTPS id 218466126C;
	Thu, 13 Jul 2023 04:21:47 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 218466126C
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 5A6B1C0DD4;
	Thu, 13 Jul 2023 04:21:46 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id EA9CFC0032
 for <virtualization@lists.linux-foundation.org>;
 Thu, 13 Jul 2023 04:21:44 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp3.osuosl.org (Postfix) with ESMTP id D1D4961267
 for <virtualization@lists.linux-foundation.org>;
 Thu, 13 Jul 2023 04:21:44 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org D1D4961267
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
 by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 3SxgZofROGTs
 for <virtualization@lists.linux-foundation.org>;
 Thu, 13 Jul 2023 04:21:42 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org CF66660E00
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.133.124])
 by smtp3.osuosl.org (Postfix) with ESMTPS id CF66660E00
 for <virtualization@lists.linux-foundation.org>;
 Thu, 13 Jul 2023 04:21:41 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1689222100;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=dLo1vx1xabIYqsJH8uPqcvgVoarGRmWsq9sDIdaBh7c=;
 b=JUvgeb/SJaFfpNdJGtw2JlJ4XHvfSL0d3p2HRNHCyi9rWW9G+cK4FGwHuinwFgjtja47PK
 UlymRAReHUgpna+89lDHFZy+laVMph4LThovV0t1TFHTGf3w5qf2NTi7NoGFitQpZijxQG
 xrNVIj5rxr4fKB4KX+stZ6fG33eAUeI=
Received: from mail-qv1-f72.google.com (mail-qv1-f72.google.com
 [209.85.219.72]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-658-PVdqZ6hHPKOxiNHIpF74NQ-1; Thu, 13 Jul 2023 00:21:39 -0400
X-MC-Unique: PVdqZ6hHPKOxiNHIpF74NQ-1
Received: by mail-qv1-f72.google.com with SMTP id
 6a1803df08f44-6238c3bf768so2782446d6.0
 for <virtualization@lists.linux-foundation.org>;
 Wed, 12 Jul 2023 21:21:39 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20221208; t=1689222099; x=1691814099;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=dLo1vx1xabIYqsJH8uPqcvgVoarGRmWsq9sDIdaBh7c=;
 b=dy81/cp3m4Hv0u2AV6jjbNY6P0pBTv+hIR93o19LYtUzftMY7AShkPoRgSyZ3SuQCR
 lNgLB40K7IvsrFb6Byqh4Un/gjOb90S+HC5VxopafT39ajpWhLGknGAVjYk4pthY7214
 GZyLBWeZQNXD8dvwwoMXyWfgosdCcUA8ps1HWbb65UYMy4ZgOlSMw9HQM1XMO7CIGhxx
 qOsoZeP1YYqLWj7hqwpq8thdV8ssZso0uEedPdKmJUeeyWpCk/UXAQogNccyuKbhnjyO
 HAMiAZ+aPRuNMaP7XsMtF5uMGxnBOyjC8KmKtCCWpgZ7vW4dEAveaO1qHHWJ1mECnuKP
 QHpw==
X-Gm-Message-State: ABy/qLbEqX7v9aa9Eu+1xdpkRTvlNHo/7yK6ogOmuzcGICUvOiBP7/V8
 ReWbByoTSFKTZq7xfgDEAIiXckQdyFrnmStCyH4aDt7P+Ywh65DRG+4r1ZR1yF5LoJgbBvZSkjj
 be4hpQRB0BHnvQ9dXnSNSAFMsVeta+gm2/4F2WdYgJY4ujPXS44b2avwLjg==
X-Received: by 2002:a0c:f5ca:0:b0:636:f84f:f0c5 with SMTP id
 q10-20020a0cf5ca000000b00636f84ff0c5mr397777qvm.38.1689222098932; 
 Wed, 12 Jul 2023 21:21:38 -0700 (PDT)
X-Google-Smtp-Source: APBJJlHhoFtBDWp73vtxIEnB9+oewiDO1sXWeNw2L429Ed5m4sBifl86rd/0M3TxSS2QP/e9pgbIDSg9yH+KxpSO7SY=
X-Received: by 2002:a0c:f5ca:0:b0:636:f84f:f0c5 with SMTP id
 q10-20020a0cf5ca000000b00636f84ff0c5mr397768qvm.38.1689222098615; Wed, 12 Jul
 2023 21:21:38 -0700 (PDT)
MIME-Version: 1.0
References: <20230710034237.12391-1-xuanzhuo@linux.alibaba.com>
 <20230710034237.12391-7-xuanzhuo@linux.alibaba.com>
 <CACGkMEtb_wYyXLU6kAaC2Ju2d4K=J+YbytUCMvKcNtPF+BvpJw@mail.gmail.com>
 <1689220976.8908284-1-xuanzhuo@linux.alibaba.com>
In-Reply-To: <1689220976.8908284-1-xuanzhuo@linux.alibaba.com>
From: Jason Wang <jasowang@redhat.com>
Date: Thu, 13 Jul 2023 12:21:26 +0800
Message-ID: <CACGkMEtt8Po5saxdEQDK_RkML3UK4LKRp3B4owyoLQQYXHt+oA@mail.gmail.com>
Subject: Re: [PATCH vhost v11 06/10] virtio_ring: skip unmap for premapped
To: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: Jesper Dangaard Brouer <hawk@kernel.org>,
 Daniel Borkmann <daniel@iogearbox.net>, "Michael S. Tsirkin" <mst@redhat.com>,
 netdev@vger.kernel.org, John Fastabend <john.fastabend@gmail.com>,
 Alexei Starovoitov <ast@kernel.org>, virtualization@lists.linux-foundation.org,
 Christoph Hellwig <hch@infradead.org>, Eric Dumazet <edumazet@google.com>,
 Jakub Kicinski <kuba@kernel.org>, bpf@vger.kernel.org,
 Paolo Abeni <pabeni@redhat.com>, "David S. Miller" <davem@davemloft.net>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVGh1LCBKdWwgMTMsIDIwMjMgYXQgMTI6MDbigK9QTSBYdWFuIFpodW8gPHh1YW56aHVvQGxp
bnV4LmFsaWJhYmEuY29tPiB3cm90ZToKPgo+IE9uIFRodSwgMTMgSnVsIDIwMjMgMTE6NTA6NTcg
KzA4MDAsIEphc29uIFdhbmcgPGphc293YW5nQHJlZGhhdC5jb20+IHdyb3RlOgo+ID4gT24gTW9u
LCBKdWwgMTAsIDIwMjMgYXQgMTE6NDLigK9BTSBYdWFuIFpodW8gPHh1YW56aHVvQGxpbnV4LmFs
aWJhYmEuY29tPiB3cm90ZToKPiA+ID4KPiA+ID4gTm93IHdlIGFkZCBhIGNhc2Ugd2hlcmUgd2Ug
c2tpcCBkbWEgdW5tYXAsIHRoZSB2cS0+cHJlbWFwcGVkIGlzIHRydWUuCj4gPiA+Cj4gPiA+IFdl
IGNhbid0IGp1c3QgcmVseSBvbiB1c2VfZG1hX2FwaSB0byBkZXRlcm1pbmUgd2hldGhlciB0byBz
a2lwIHRoZSBkbWEKPiA+ID4gb3BlcmF0aW9uLiBGb3IgY29udmVuaWVuY2UsIEkgaW50cm9kdWNl
ZCB0aGUgImRvX3VubWFwIi4gQnkgZGVmYXVsdCwgaXQKPiA+ID4gaXMgdGhlIHNhbWUgYXMgdXNl
X2RtYV9hcGkuIElmIHRoZSBkcml2ZXIgaXMgY29uZmlndXJlZCB3aXRoIHByZW1hcHBlZCwKPiA+
ID4gdGhlbiBkb191bm1hcCBpcyBmYWxzZS4KPiA+ID4KPiA+ID4gU28gYXMgbG9uZyBhcyBkb191
bm1hcCBpcyBmYWxzZSwgZm9yIGFkZHIgb2YgZGVzYywgd2Ugc2hvdWxkIHNraXAgZG1hCj4gPiA+
IHVubWFwIG9wZXJhdGlvbi4KPiA+ID4KPiA+ID4gU2lnbmVkLW9mZi1ieTogWHVhbiBaaHVvIDx4
dWFuemh1b0BsaW51eC5hbGliYWJhLmNvbT4KPiA+ID4gLS0tCj4gPiA+ICBkcml2ZXJzL3ZpcnRp
by92aXJ0aW9fcmluZy5jIHwgNDIgKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0t
Cj4gPiA+ICAxIGZpbGUgY2hhbmdlZCwgMjggaW5zZXJ0aW9ucygrKSwgMTQgZGVsZXRpb25zKC0p
Cj4gPiA+Cj4gPiA+IGRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fcmluZy5jIGIv
ZHJpdmVycy92aXJ0aW8vdmlydGlvX3JpbmcuYwo+ID4gPiBpbmRleCAxZmIyYzZkY2E5ZWEuLjEw
ZWUzYjdjZTU3MSAxMDA2NDQKPiA+ID4gLS0tIGEvZHJpdmVycy92aXJ0aW8vdmlydGlvX3Jpbmcu
Ywo+ID4gPiArKysgYi9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fcmluZy5jCj4gPiA+IEBAIC0xNzUs
NiArMTc1LDExIEBAIHN0cnVjdCB2cmluZ192aXJ0cXVldWUgewo+ID4gPiAgICAgICAgIC8qIERv
IERNQSBtYXBwaW5nIGJ5IGRyaXZlciAqLwo+ID4gPiAgICAgICAgIGJvb2wgcHJlbWFwcGVkOwo+
ID4gPgo+ID4gPiArICAgICAgIC8qIERvIHVubWFwIG9yIG5vdCBmb3IgZGVzYy4gSnVzdCB3aGVu
IHByZW1hcHBlZCBpcyBGYWxzZSBhbmQKPiA+ID4gKyAgICAgICAgKiB1c2VfZG1hX2FwaSBpcyB0
cnVlLCB0aGlzIGlzIHRydWUuCj4gPiA+ICsgICAgICAgICovCj4gPiA+ICsgICAgICAgYm9vbCBk
b191bm1hcDsKPiA+ID4gKwo+ID4gPiAgICAgICAgIC8qIEhlYWQgb2YgZnJlZSBidWZmZXIgbGlz
dC4gKi8KPiA+ID4gICAgICAgICB1bnNpZ25lZCBpbnQgZnJlZV9oZWFkOwo+ID4gPiAgICAgICAg
IC8qIE51bWJlciB3ZSd2ZSBhZGRlZCBzaW5jZSBsYXN0IHN5bmMuICovCj4gPiA+IEBAIC00NDAs
NyArNDQ1LDcgQEAgc3RhdGljIHZvaWQgdnJpbmdfdW5tYXBfb25lX3NwbGl0X2luZGlyZWN0KGNv
bnN0IHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxLAo+ID4gPiAgewo+ID4gPiAgICAgICAgIHUx
NiBmbGFnczsKPiA+ID4KPiA+ID4gLSAgICAgICBpZiAoIXZxLT51c2VfZG1hX2FwaSkKPiA+ID4g
KyAgICAgICBpZiAoIXZxLT5kb191bm1hcCkKPiA+ID4gICAgICAgICAgICAgICAgIHJldHVybjsK
PiA+ID4KPiA+ID4gICAgICAgICBmbGFncyA9IHZpcnRpbzE2X3RvX2NwdSh2cS0+dnEudmRldiwg
ZGVzYy0+ZmxhZ3MpOwo+ID4gPiBAQCAtNDU4LDE4ICs0NjMsMjEgQEAgc3RhdGljIHVuc2lnbmVk
IGludCB2cmluZ191bm1hcF9vbmVfc3BsaXQoY29uc3Qgc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAq
dnEsCj4gPiA+ICAgICAgICAgc3RydWN0IHZyaW5nX2Rlc2NfZXh0cmEgKmV4dHJhID0gdnEtPnNw
bGl0LmRlc2NfZXh0cmE7Cj4gPiA+ICAgICAgICAgdTE2IGZsYWdzOwo+ID4gPgo+ID4gPiAtICAg
ICAgIGlmICghdnEtPnVzZV9kbWFfYXBpKQo+ID4gPiAtICAgICAgICAgICAgICAgZ290byBvdXQ7
Cj4gPiA+IC0KPiA+ID4gICAgICAgICBmbGFncyA9IGV4dHJhW2ldLmZsYWdzOwo+ID4gPgo+ID4g
PiAgICAgICAgIGlmIChmbGFncyAmIFZSSU5HX0RFU0NfRl9JTkRJUkVDVCkgewo+ID4gPiArICAg
ICAgICAgICAgICAgaWYgKCF2cS0+dXNlX2RtYV9hcGkpCj4gPiA+ICsgICAgICAgICAgICAgICAg
ICAgICAgIGdvdG8gb3V0Owo+ID4gPiArCj4gPiA+ICAgICAgICAgICAgICAgICBkbWFfdW5tYXBf
c2luZ2xlKHZyaW5nX2RtYV9kZXYodnEpLAo+ID4gPiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBleHRyYVtpXS5hZGRyLAo+ID4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBleHRyYVtpXS5sZW4sCj4gPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IChmbGFncyAmIFZSSU5HX0RFU0NfRl9XUklURSkgPwo+ID4gPiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBETUFfRlJPTV9ERVZJQ0UgOiBETUFfVE9fREVWSUNFKTsKPiA+ID4gICAg
ICAgICB9IGVsc2Ugewo+ID4gPiArICAgICAgICAgICAgICAgaWYgKCF2cS0+ZG9fdW5tYXApCj4g
PiA+ICsgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gb3V0Owo+ID4gPiArCj4gPiA+ICAgICAg
ICAgICAgICAgICBkbWFfdW5tYXBfcGFnZSh2cmluZ19kbWFfZGV2KHZxKSwKPiA+ID4gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhW2ldLmFkZHIsCj4gPiA+ICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBleHRyYVtpXS5sZW4sCj4gPiA+IEBAIC02MzUsNyArNjQzLDcg
QEAgc3RhdGljIGlubGluZSBpbnQgdmlydHF1ZXVlX2FkZF9zcGxpdChzdHJ1Y3QgdmlydHF1ZXVl
ICpfdnEsCj4gPiA+ICAgICAgICAgfQo+ID4gPiAgICAgICAgIC8qIExhc3Qgb25lIGRvZXNuJ3Qg
Y29udGludWUuICovCj4gPiA+ICAgICAgICAgZGVzY1twcmV2XS5mbGFncyAmPSBjcHVfdG9fdmly
dGlvMTYoX3ZxLT52ZGV2LCB+VlJJTkdfREVTQ19GX05FWFQpOwo+ID4gPiAtICAgICAgIGlmICgh
aW5kaXJlY3QgJiYgdnEtPnVzZV9kbWFfYXBpKQo+ID4gPiArICAgICAgIGlmICghaW5kaXJlY3Qg
JiYgdnEtPmRvX3VubWFwKQo+ID4gPiAgICAgICAgICAgICAgICAgdnEtPnNwbGl0LmRlc2NfZXh0
cmFbcHJldiAmICh2cS0+c3BsaXQudnJpbmcubnVtIC0gMSldLmZsYWdzICY9Cj4gPiA+ICAgICAg
ICAgICAgICAgICAgICAgICAgIH5WUklOR19ERVNDX0ZfTkVYVDsKPiA+ID4KPiA+ID4gQEAgLTc5
NCw3ICs4MDIsNyBAQCBzdGF0aWMgdm9pZCBkZXRhY2hfYnVmX3NwbGl0KHN0cnVjdCB2cmluZ192
aXJ0cXVldWUgKnZxLCB1bnNpZ25lZCBpbnQgaGVhZCwKPiA+ID4gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBWUklOR19ERVNDX0ZfSU5ESVJFQ1QpKTsKPiA+ID4gICAgICAgICAgICAg
ICAgIEJVR19PTihsZW4gPT0gMCB8fCBsZW4gJSBzaXplb2Yoc3RydWN0IHZyaW5nX2Rlc2MpKTsK
PiA+ID4KPiA+ID4gLSAgICAgICAgICAgICAgIGlmICh2cS0+dXNlX2RtYV9hcGkpIHsKPiA+ID4g
KyAgICAgICAgICAgICAgIGlmICh2cS0+ZG9fdW5tYXApIHsKPiA+ID4gICAgICAgICAgICAgICAg
ICAgICAgICAgZm9yIChqID0gMDsgaiA8IGxlbiAvIHNpemVvZihzdHJ1Y3QgdnJpbmdfZGVzYyk7
IGorKykKPiA+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2cmluZ191bm1hcF9v
bmVfc3BsaXRfaW5kaXJlY3QodnEsICZpbmRpcl9kZXNjW2pdKTsKPiA+ID4gICAgICAgICAgICAg
ICAgIH0KPiA+ID4gQEAgLTEyMTcsMTcgKzEyMjUsMjAgQEAgc3RhdGljIHZvaWQgdnJpbmdfdW5t
YXBfZXh0cmFfcGFja2VkKGNvbnN0IHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxLAo+ID4gPiAg
ewo+ID4gPiAgICAgICAgIHUxNiBmbGFnczsKPiA+ID4KPiA+ID4gLSAgICAgICBpZiAoIXZxLT51
c2VfZG1hX2FwaSkKPiA+ID4gLSAgICAgICAgICAgICAgIHJldHVybjsKPiA+ID4gLQo+ID4gPiAg
ICAgICAgIGZsYWdzID0gZXh0cmEtPmZsYWdzOwo+ID4gPgo+ID4gPiAgICAgICAgIGlmIChmbGFn
cyAmIFZSSU5HX0RFU0NfRl9JTkRJUkVDVCkgewo+ID4gPiArICAgICAgICAgICAgICAgaWYgKCF2
cS0+dXNlX2RtYV9hcGkpCj4gPiA+ICsgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKPiA+
ID4gKwo+ID4gPiAgICAgICAgICAgICAgICAgZG1hX3VubWFwX3NpbmdsZSh2cmluZ19kbWFfZGV2
KHZxKSwKPiA+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmEtPmFkZHIs
IGV4dHJhLT5sZW4sCj4gPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmbGFn
cyAmIFZSSU5HX0RFU0NfRl9XUklURSkgPwo+ID4gPiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBETUFfRlJPTV9ERVZJQ0UgOiBETUFfVE9fREVWSUNFKTsKPiA+ID4gICAgICAgICB9
IGVsc2Ugewo+ID4gPiArICAgICAgICAgICAgICAgaWYgKCF2cS0+ZG9fdW5tYXApCj4gPiA+ICsg
ICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKPiA+Cj4gPiBUaGlzIHNlZW1zIG5vdCBzdHJh
aWdodGZvcndhcmQgdGhhbjoKPiA+Cj4gPiBpZiAoIXZxLT51c2VfZG1hX2FwaSkKPiA+ICAgICBy
ZXR1cm47Cj4gPgo+ID4gaWYgKElORElSRUNUKSB7Cj4gPiB9IGVsc2UgaWYgKCF2cS0+cHJlbWFw
cGVkKSB7Cj4gPiB9Cj4gPgo+ID4gPwo+Cj4KPiBNeSBsb2dpYyBoZXJlIGlzIHRoYXQgZm9yIHRo
ZSByZWFsIGJ1ZmZlciwgd2UgdXNlIGRvX3VubWFwIHRvIGp1ZGdlIHVuaWZvcm1seS4KPiBBbmQg
aW5kaXJlY3Qgc3RpbGwgdXNlIHVzZV9kbWFfYXBpIHRvIGp1ZGdlLgo+Cj4gRnJvbSB0aGlzIHBv
aW50IG9mIHZpZXcsIGhvdyBkbyB5b3UgZmVlbD8KCldlIGNhbiBoZWFyIGZyb20gb3RoZXJzIGJ1
dCBhIHN0YXRlIG1hY2hpbmUgd2l0aCB0aHJlZSBib29sZWFucyBzZWVtcwpub3QgZWFzeSBmb3Ig
bWUgdG8gcmVhZC4KClRoYW5rcwoKPgo+IFRoYW5rcy4KPgo+Cj4gPgo+ID4gVGhhbmtzCj4gPgo+
ID4gPiArCj4gPiA+ICAgICAgICAgICAgICAgICBkbWFfdW5tYXBfcGFnZSh2cmluZ19kbWFfZGV2
KHZxKSwKPiA+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhLT5hZGRyLCBl
eHRyYS0+bGVuLAo+ID4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZsYWdzICYg
VlJJTkdfREVTQ19GX1dSSVRFKSA/Cj4gPiA+IEBAIC0xMjQwLDcgKzEyNTEsNyBAQCBzdGF0aWMg
dm9pZCB2cmluZ191bm1hcF9kZXNjX3BhY2tlZChjb25zdCBzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVl
ICp2cSwKPiA+ID4gIHsKPiA+ID4gICAgICAgICB1MTYgZmxhZ3M7Cj4gPiA+Cj4gPiA+IC0gICAg
ICAgaWYgKCF2cS0+dXNlX2RtYV9hcGkpCj4gPiA+ICsgICAgICAgaWYgKCF2cS0+ZG9fdW5tYXAp
Cj4gPiA+ICAgICAgICAgICAgICAgICByZXR1cm47Cj4gPiA+Cj4gPiA+ICAgICAgICAgZmxhZ3Mg
PSBsZTE2X3RvX2NwdShkZXNjLT5mbGFncyk7Cj4gPiA+IEBAIC0xMzI5LDcgKzEzNDAsNyBAQCBz
dGF0aWMgaW50IHZpcnRxdWV1ZV9hZGRfaW5kaXJlY3RfcGFja2VkKHN0cnVjdCB2cmluZ192aXJ0
cXVldWUgKnZxLAo+ID4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihz
dHJ1Y3QgdnJpbmdfcGFja2VkX2Rlc2MpKTsKPiA+ID4gICAgICAgICB2cS0+cGFja2VkLnZyaW5n
LmRlc2NbaGVhZF0uaWQgPSBjcHVfdG9fbGUxNihpZCk7Cj4gPiA+Cj4gPiA+IC0gICAgICAgaWYg
KHZxLT51c2VfZG1hX2FwaSkgewo+ID4gPiArICAgICAgIGlmICh2cS0+ZG9fdW5tYXApIHsKPiA+
ID4gICAgICAgICAgICAgICAgIHZxLT5wYWNrZWQuZGVzY19leHRyYVtpZF0uYWRkciA9IGFkZHI7
Cj4gPiA+ICAgICAgICAgICAgICAgICB2cS0+cGFja2VkLmRlc2NfZXh0cmFbaWRdLmxlbiA9IHRv
dGFsX3NnICoKPiA+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2Yoc3Ry
dWN0IHZyaW5nX3BhY2tlZF9kZXNjKTsKPiA+ID4gQEAgLTE0NzAsNyArMTQ4MSw3IEBAIHN0YXRp
YyBpbmxpbmUgaW50IHZpcnRxdWV1ZV9hZGRfcGFja2VkKHN0cnVjdCB2aXJ0cXVldWUgKl92cSwK
PiA+ID4gICAgICAgICAgICAgICAgICAgICAgICAgZGVzY1tpXS5sZW4gPSBjcHVfdG9fbGUzMihz
Zy0+bGVuZ3RoKTsKPiA+ID4gICAgICAgICAgICAgICAgICAgICAgICAgZGVzY1tpXS5pZCA9IGNw
dV90b19sZTE2KGlkKTsKPiA+ID4KPiA+ID4gLSAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVu
bGlrZWx5KHZxLT51c2VfZG1hX2FwaSkpIHsKPiA+ID4gKyAgICAgICAgICAgICAgICAgICAgICAg
aWYgKHVubGlrZWx5KHZxLT5kb191bm1hcCkpIHsKPiA+ID4gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB2cS0+cGFja2VkLmRlc2NfZXh0cmFbY3Vycl0uYWRkciA9IGFkZHI7Cj4gPiA+
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnEtPnBhY2tlZC5kZXNjX2V4dHJhW2N1
cnJdLmxlbiA9IHNnLT5sZW5ndGg7Cj4gPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdnEtPnBhY2tlZC5kZXNjX2V4dHJhW2N1cnJdLmZsYWdzID0KPiA+ID4gQEAgLTE2MDQsNyAr
MTYxNSw3IEBAIHN0YXRpYyB2b2lkIGRldGFjaF9idWZfcGFja2VkKHN0cnVjdCB2cmluZ192aXJ0
cXVldWUgKnZxLAo+ID4gPiAgICAgICAgIHZxLT5mcmVlX2hlYWQgPSBpZDsKPiA+ID4gICAgICAg
ICB2cS0+dnEubnVtX2ZyZWUgKz0gc3RhdGUtPm51bTsKPiA+ID4KPiA+ID4gLSAgICAgICBpZiAo
dW5saWtlbHkodnEtPnVzZV9kbWFfYXBpKSkgewo+ID4gPiArICAgICAgIGlmICh1bmxpa2VseSh2
cS0+ZG9fdW5tYXApKSB7Cj4gPiA+ICAgICAgICAgICAgICAgICBjdXJyID0gaWQ7Cj4gPiA+ICAg
ICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc3RhdGUtPm51bTsgaSsrKSB7Cj4gPiA+ICAg
ICAgICAgICAgICAgICAgICAgICAgIHZyaW5nX3VubWFwX2V4dHJhX3BhY2tlZCh2cSwKPiA+ID4g
QEAgLTE2MjEsNyArMTYzMiw3IEBAIHN0YXRpYyB2b2lkIGRldGFjaF9idWZfcGFja2VkKHN0cnVj
dCB2cmluZ192aXJ0cXVldWUgKnZxLAo+ID4gPiAgICAgICAgICAgICAgICAgaWYgKCFkZXNjKQo+
ID4gPiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47Cj4gPiA+Cj4gPiA+IC0gICAgICAg
ICAgICAgICBpZiAodnEtPnVzZV9kbWFfYXBpKSB7Cj4gPiA+ICsgICAgICAgICAgICAgICBpZiAo
dnEtPmRvX3VubWFwKSB7Cj4gPiA+ICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiA9IHZxLT5w
YWNrZWQuZGVzY19leHRyYVtpZF0ubGVuOwo+ID4gPiAgICAgICAgICAgICAgICAgICAgICAgICBm
b3IgKGkgPSAwOyBpIDwgbGVuIC8gc2l6ZW9mKHN0cnVjdCB2cmluZ19wYWNrZWRfZGVzYyk7Cj4g
PiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKyspCj4gPiA+IEBA
IC0yMDgwLDYgKzIwOTEsNyBAQCBzdGF0aWMgc3RydWN0IHZpcnRxdWV1ZSAqdnJpbmdfY3JlYXRl
X3ZpcnRxdWV1ZV9wYWNrZWQoCj4gPiA+ICAgICAgICAgdnEtPmRtYV9kZXYgPSBkbWFfZGV2Owo+
ID4gPiAgICAgICAgIHZxLT51c2VfZG1hX2FwaSA9IHZyaW5nX3VzZV9kbWFfYXBpKHZkZXYpOwo+
ID4gPiAgICAgICAgIHZxLT5wcmVtYXBwZWQgPSBmYWxzZTsKPiA+ID4gKyAgICAgICB2cS0+ZG9f
dW5tYXAgPSB2cS0+dXNlX2RtYV9hcGk7Cj4gPiA+Cj4gPiA+ICAgICAgICAgdnEtPmluZGlyZWN0
ID0gdmlydGlvX2hhc19mZWF0dXJlKHZkZXYsIFZJUlRJT19SSU5HX0ZfSU5ESVJFQ1RfREVTQykg
JiYKPiA+ID4gICAgICAgICAgICAgICAgICFjb250ZXh0Owo+ID4gPiBAQCAtMjU4Nyw2ICsyNTk5
LDcgQEAgc3RhdGljIHN0cnVjdCB2aXJ0cXVldWUgKl9fdnJpbmdfbmV3X3ZpcnRxdWV1ZSh1bnNp
Z25lZCBpbnQgaW5kZXgsCj4gPiA+ICAgICAgICAgdnEtPmRtYV9kZXYgPSBkbWFfZGV2Owo+ID4g
PiAgICAgICAgIHZxLT51c2VfZG1hX2FwaSA9IHZyaW5nX3VzZV9kbWFfYXBpKHZkZXYpOwo+ID4g
PiAgICAgICAgIHZxLT5wcmVtYXBwZWQgPSBmYWxzZTsKPiA+ID4gKyAgICAgICB2cS0+ZG9fdW5t
YXAgPSB2cS0+dXNlX2RtYV9hcGk7Cj4gPiA+Cj4gPiA+ICAgICAgICAgdnEtPmluZGlyZWN0ID0g
dmlydGlvX2hhc19mZWF0dXJlKHZkZXYsIFZJUlRJT19SSU5HX0ZfSU5ESVJFQ1RfREVTQykgJiYK
PiA+ID4gICAgICAgICAgICAgICAgICFjb250ZXh0Owo+ID4gPiBAQCAtMjc2NSw2ICsyNzc4LDcg
QEAgaW50IHZpcnRxdWV1ZV9zZXRfcHJlbWFwcGVkKHN0cnVjdCB2aXJ0cXVldWUgKl92cSkKPiA+
ID4gICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwo+ID4gPgo+ID4gPiAgICAgICAgIHZx
LT5wcmVtYXBwZWQgPSB0cnVlOwo+ID4gPiArICAgICAgIHZxLT5kb191bm1hcCA9IGZhbHNlOwo+
ID4gPgo+ID4gPiAgICAgICAgIHJldHVybiAwOwo+ID4gPiAgfQo+ID4gPiAtLQo+ID4gPiAyLjMy
LjAuMy5nMDExOTVjZjlmCj4gPiA+Cj4gPgo+CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6
YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5k
YXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
