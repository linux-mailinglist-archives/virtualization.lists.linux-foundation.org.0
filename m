Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id E24EC229C9D
	for <lists.virtualization@lfdr.de>; Wed, 22 Jul 2020 18:02:05 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 6D74C88703;
	Wed, 22 Jul 2020 16:02:04 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id YUsEdtIz5e+r; Wed, 22 Jul 2020 16:02:04 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 275CD885FB;
	Wed, 22 Jul 2020 16:01:46 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id ECA0FC004E;
	Wed, 22 Jul 2020 16:01:45 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id F3AABC004C
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:39 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id E866E2273B
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:39 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id OOJiLD927UsJ
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:36 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by silver.osuosl.org (Postfix) with ESMTPS id 95F8F20471
 for <virtualization@lists.linux-foundation.org>;
 Wed, 22 Jul 2020 16:01:35 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 33F84305D7F3; Wed, 22 Jul 2020 19:01:32 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.6])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 291933073698;
 Wed, 22 Jul 2020 19:01:32 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [RFC PATCH v1 10/34] KVM: x86: page track: allow page tracking for
 different EPT views
Date: Wed, 22 Jul 2020 19:00:57 +0300
Message-Id: <20200722160121.9601-11-alazar@bitdefender.com>
In-Reply-To: <20200722160121.9601-1-alazar@bitdefender.com>
References: <20200722160121.9601-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?=C8=98tefan=20=C8=98icleru?= <ssicleru@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogyJh0ZWZhbiDImGljbGVydSA8c3NpY2xlcnVAYml0ZGVmZW5kZXIuY29tPgoKVGhlIGlu
dHJvc3BlY3Rpb24gdG9vbCB1c2VzIHRoaXMgdG8gc2V0IGRpc3RpbmN0IGFjY2VzcyByaWdodHMg
b24KZGlmZmVyZW50IEVQVCB2aWV3cy4KClNpZ25lZC1vZmYtYnk6IMiYdGVmYW4gyJhpY2xlcnUg
PHNzaWNsZXJ1QGJpdGRlZmVuZGVyLmNvbT4KU2lnbmVkLW9mZi1ieTogQWRhbGJlcnQgTGF6xINy
IDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgotLS0KIGFyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9o
b3N0LmggICAgICAgfCAgMiArLQogYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX3BhZ2VfdHJhY2su
aCB8ICA0ICstCiBhcmNoL3g4Ni9rdm0va3ZtaS5jICAgICAgICAgICAgICAgICAgIHwgIDYgKyst
CiBhcmNoL3g4Ni9rdm0vbW11LmggICAgICAgICAgICAgICAgICAgIHwgIDkgKystLQogYXJjaC94
ODYva3ZtL21tdS9tbXUuYyAgICAgICAgICAgICAgICB8IDYwICsrKysrKysrKysrKysrKysrLS0t
LS0tLS0tLQogYXJjaC94ODYva3ZtL21tdS9wYWdlX3RyYWNrLmMgICAgICAgICB8IDU2ICsrKysr
KysrKysrKystLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9rdm1ndC5jICAg
ICAgfCAgOCArKy0tCiA3IGZpbGVzIGNoYW5nZWQsIDg2IGluc2VydGlvbnMoKyksIDU5IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmggYi9h
cmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1faG9zdC5oCmluZGV4IDVlMjQxODYzMTUzZi4uMmZiYjI2
YjU0Y2YxIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1faG9zdC5oCisrKyBi
L2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmgKQEAgLTg2MCw3ICs4NjAsNyBAQCBzdHJ1
Y3Qga3ZtX2xwYWdlX2luZm8gewogc3RydWN0IGt2bV9hcmNoX21lbW9yeV9zbG90IHsKIAlzdHJ1
Y3Qga3ZtX3JtYXBfaGVhZCAqcm1hcFtLVk1fTlJfUEFHRV9TSVpFU107CiAJc3RydWN0IGt2bV9s
cGFnZV9pbmZvICpscGFnZV9pbmZvW0tWTV9OUl9QQUdFX1NJWkVTIC0gMV07Ci0JdW5zaWduZWQg
c2hvcnQgKmdmbl90cmFja1tLVk1fUEFHRV9UUkFDS19NQVhdOworCXVuc2lnbmVkIHNob3J0ICpn
Zm5fdHJhY2tbS1ZNX01BWF9FUFRfVklFV1NdW0tWTV9QQUdFX1RSQUNLX01BWF07CiB9OwogCiAv
KgpkaWZmIC0tZ2l0IGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX3BhZ2VfdHJhY2suaCBiL2Fy
Y2gveDg2L2luY2x1ZGUvYXNtL2t2bV9wYWdlX3RyYWNrLmgKaW5kZXggYzEwZjBmNjVjNzdhLi45
NmQyYWI3ZGE0YTcgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9wYWdlX3Ry
YWNrLmgKKysrIGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX3BhZ2VfdHJhY2suaApAQCAtMTA5
LDEwICsxMDksMTAgQEAgaW50IGt2bV9wYWdlX3RyYWNrX2NyZWF0ZV9tZW1zbG90KHN0cnVjdCBr
dm0gKmt2bSwgc3RydWN0IGt2bV9tZW1vcnlfc2xvdCAqc2xvdCwKIAogdm9pZCBrdm1fc2xvdF9w
YWdlX3RyYWNrX2FkZF9wYWdlKHN0cnVjdCBrdm0gKmt2bSwKIAkJCQkgIHN0cnVjdCBrdm1fbWVt
b3J5X3Nsb3QgKnNsb3QsIGdmbl90IGdmbiwKLQkJCQkgIGVudW0ga3ZtX3BhZ2VfdHJhY2tfbW9k
ZSBtb2RlKTsKKwkJCQkgIGVudW0ga3ZtX3BhZ2VfdHJhY2tfbW9kZSBtb2RlLCB1MTYgdmlldyk7
CiB2b2lkIGt2bV9zbG90X3BhZ2VfdHJhY2tfcmVtb3ZlX3BhZ2Uoc3RydWN0IGt2bSAqa3ZtLAog
CQkJCSAgICAgc3RydWN0IGt2bV9tZW1vcnlfc2xvdCAqc2xvdCwgZ2ZuX3QgZ2ZuLAotCQkJCSAg
ICAgZW51bSBrdm1fcGFnZV90cmFja19tb2RlIG1vZGUpOworCQkJCSAgICAgZW51bSBrdm1fcGFn
ZV90cmFja19tb2RlIG1vZGUsIHUxNiB2aWV3KTsKIGJvb2wga3ZtX3BhZ2VfdHJhY2tfaXNfYWN0
aXZlKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgZ2ZuX3QgZ2ZuLAogCQkJICAgICAgZW51bSBrdm1f
cGFnZV90cmFja19tb2RlIG1vZGUpOwogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaS5j
IGIvYXJjaC94ODYva3ZtL2t2bWkuYwppbmRleCA0ZTc1ODU4YzAzYjQuLjdiM2I2NGQyN2QxOCAx
MDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL2t2bWkuYworKysgYi9hcmNoL3g4Ni9rdm0va3ZtaS5j
CkBAIC0xMjE1LDExICsxMjE1LDEzIEBAIHZvaWQga3ZtaV9hcmNoX3VwZGF0ZV9wYWdlX3RyYWNr
aW5nKHN0cnVjdCBrdm0gKmt2bSwKIAkJaWYgKG0tPmFjY2VzcyAmIGFsbG93X2JpdCkgewogCQkJ
aWYgKHNsb3RfdHJhY2tlZCkgewogCQkJCWt2bV9zbG90X3BhZ2VfdHJhY2tfcmVtb3ZlX3BhZ2Uo
a3ZtLCBzbG90LAotCQkJCQkJCQltLT5nZm4sIG1vZGUpOworCQkJCQkJCQltLT5nZm4sIG1vZGUs
CisJCQkJCQkJCTApOwogCQkJCWNsZWFyX2JpdChzbG90LT5pZCwgYXJjaC0+YWN0aXZlW21vZGVd
KTsKIAkJCX0KIAkJfSBlbHNlIGlmICghc2xvdF90cmFja2VkKSB7Ci0JCQlrdm1fc2xvdF9wYWdl
X3RyYWNrX2FkZF9wYWdlKGt2bSwgc2xvdCwgbS0+Z2ZuLCBtb2RlKTsKKwkJCWt2bV9zbG90X3Bh
Z2VfdHJhY2tfYWRkX3BhZ2Uoa3ZtLCBzbG90LCBtLT5nZm4sIG1vZGUsCisJCQkJCQkgICAgIDAp
OwogCQkJc2V0X2JpdChzbG90LT5pZCwgYXJjaC0+YWN0aXZlW21vZGVdKTsKIAkJfQogCX0KZGlm
ZiAtLWdpdCBhL2FyY2gveDg2L2t2bS9tbXUuaCBiL2FyY2gveDg2L2t2bS9tbXUuaAppbmRleCBl
MmMwNTE4YWY3NTAuLjI2OTJiMTRmYjYwNSAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL21tdS5o
CisrKyBiL2FyY2gveDg2L2t2bS9tbXUuaApAQCAtMjIxLDExICsyMjEsMTQgQEAgdm9pZCBrdm1f
emFwX2dmbl9yYW5nZShzdHJ1Y3Qga3ZtICprdm0sIGdmbl90IGdmbl9zdGFydCwgZ2ZuX3QgZ2Zu
X2VuZCk7CiB2b2lkIGt2bV9tbXVfZ2ZuX2Rpc2FsbG93X2xwYWdlKHN0cnVjdCBrdm1fbWVtb3J5
X3Nsb3QgKnNsb3QsIGdmbl90IGdmbik7CiB2b2lkIGt2bV9tbXVfZ2ZuX2FsbG93X2xwYWdlKHN0
cnVjdCBrdm1fbWVtb3J5X3Nsb3QgKnNsb3QsIGdmbl90IGdmbik7CiBib29sIGt2bV9tbXVfc2xv
dF9nZm5fd3JpdGVfcHJvdGVjdChzdHJ1Y3Qga3ZtICprdm0sCi0JCQkJICAgIHN0cnVjdCBrdm1f
bWVtb3J5X3Nsb3QgKnNsb3QsIHU2NCBnZm4pOworCQkJCSAgICBzdHJ1Y3Qga3ZtX21lbW9yeV9z
bG90ICpzbG90LCB1NjQgZ2ZuLAorCQkJCSAgICB1MTYgdmlldyk7CiBib29sIGt2bV9tbXVfc2xv
dF9nZm5fcmVhZF9wcm90ZWN0KHN0cnVjdCBrdm0gKmt2bSwKLQkJCQkgICBzdHJ1Y3Qga3ZtX21l
bW9yeV9zbG90ICpzbG90LCB1NjQgZ2ZuKTsKKwkJCQkgICBzdHJ1Y3Qga3ZtX21lbW9yeV9zbG90
ICpzbG90LCB1NjQgZ2ZuLAorCQkJCSAgIHUxNiB2aWV3KTsKIGJvb2wga3ZtX21tdV9zbG90X2dm
bl9leGVjX3Byb3RlY3Qoc3RydWN0IGt2bSAqa3ZtLAotCQkJCSAgIHN0cnVjdCBrdm1fbWVtb3J5
X3Nsb3QgKnNsb3QsIHU2NCBnZm4pOworCQkJCSAgIHN0cnVjdCBrdm1fbWVtb3J5X3Nsb3QgKnNs
b3QsIHU2NCBnZm4sCisJCQkJICAgdTE2IHZpZXcpOwogaW50IGt2bV9hcmNoX3dyaXRlX2xvZ19k
aXJ0eShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGdwYV90IGwyX2dwYSk7CiAKIGludCBrdm1fbW11
X3Bvc3RfaW5pdF92bShzdHJ1Y3Qga3ZtICprdm0pOwpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3Zt
L21tdS9tbXUuYyBiL2FyY2gveDg2L2t2bS9tbXUvbW11LmMKaW5kZXggNzA0NjFjN2VmNThjLi5j
Y2ExMjk4MmI3OTUgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS9tbXUvbW11LmMKKysrIGIvYXJj
aC94ODYva3ZtL21tdS9tbXUuYwpAQCAtMTIzMSw5ICsxMjMxLDkgQEAgc3RhdGljIHZvaWQgYWNj
b3VudF9zaGFkb3dlZChzdHJ1Y3Qga3ZtICprdm0sIHN0cnVjdCBrdm1fbW11X3BhZ2UgKnNwKQog
CS8qIHRoZSBub24tbGVhZiBzaGFkb3cgcGFnZXMgYXJlIGtlZXBpbmcgcmVhZG9ubHkuICovCiAJ
aWYgKHNwLT5yb2xlLmxldmVsID4gUEdfTEVWRUxfNEspIHsKIAkJa3ZtX3Nsb3RfcGFnZV90cmFj
a19hZGRfcGFnZShrdm0sIHNsb3QsIGdmbiwKLQkJCQkJICAgICBLVk1fUEFHRV9UUkFDS19QUkVX
UklURSk7CisJCQkJCSAgICAgS1ZNX1BBR0VfVFJBQ0tfUFJFV1JJVEUsIDApOwogCQlrdm1fc2xv
dF9wYWdlX3RyYWNrX2FkZF9wYWdlKGt2bSwgc2xvdCwgZ2ZuLAotCQkJCQkgICAgIEtWTV9QQUdF
X1RSQUNLX1dSSVRFKTsKKwkJCQkJICAgICBLVk1fUEFHRV9UUkFDS19XUklURSwgMCk7CiAJCXJl
dHVybjsKIAl9CiAKQEAgLTEyNjMsOSArMTI2Myw5IEBAIHN0YXRpYyB2b2lkIHVuYWNjb3VudF9z
aGFkb3dlZChzdHJ1Y3Qga3ZtICprdm0sIHN0cnVjdCBrdm1fbW11X3BhZ2UgKnNwKQogCXNsb3Qg
PSBfX2dmbl90b19tZW1zbG90KHNsb3RzLCBnZm4pOwogCWlmIChzcC0+cm9sZS5sZXZlbCA+IFBH
X0xFVkVMXzRLKSB7CiAJCWt2bV9zbG90X3BhZ2VfdHJhY2tfcmVtb3ZlX3BhZ2Uoa3ZtLCBzbG90
LCBnZm4sCi0JCQkJCQlLVk1fUEFHRV9UUkFDS19QUkVXUklURSk7CisJCQkJCQlLVk1fUEFHRV9U
UkFDS19QUkVXUklURSwgMCk7CiAJCWt2bV9zbG90X3BhZ2VfdHJhY2tfcmVtb3ZlX3BhZ2Uoa3Zt
LCBzbG90LCBnZm4sCi0JCQkJCQlLVk1fUEFHRV9UUkFDS19XUklURSk7CisJCQkJCQlLVk1fUEFH
RV9UUkFDS19XUklURSwgMCk7CiAJCXJldHVybjsKIAl9CiAKQEAgLTE2MTcsNDAgKzE2MTcsNTIg
QEAgc3RhdGljIGJvb2wgc3B0ZV9leGVjX3Byb3RlY3QodTY0ICpzcHRlcCkKIAogc3RhdGljIGJv
b2wgX19ybWFwX3dyaXRlX3Byb3RlY3Qoc3RydWN0IGt2bSAqa3ZtLAogCQkJCSBzdHJ1Y3Qga3Zt
X3JtYXBfaGVhZCAqcm1hcF9oZWFkLAotCQkJCSBib29sIHB0X3Byb3RlY3QpCisJCQkJIGJvb2wg
cHRfcHJvdGVjdCwgdTE2IHZpZXcpCiB7CiAJdTY0ICpzcHRlcDsKIAlzdHJ1Y3Qgcm1hcF9pdGVy
YXRvciBpdGVyOwogCWJvb2wgZmx1c2ggPSBmYWxzZTsKKwlzdHJ1Y3Qga3ZtX21tdV9wYWdlICpz
cDsKIAotCWZvcl9lYWNoX3JtYXBfc3B0ZShybWFwX2hlYWQsICZpdGVyLCBzcHRlcCkKLQkJZmx1
c2ggfD0gc3B0ZV93cml0ZV9wcm90ZWN0KHNwdGVwLCBwdF9wcm90ZWN0KTsKKwlmb3JfZWFjaF9y
bWFwX3NwdGUocm1hcF9oZWFkLCAmaXRlciwgc3B0ZXApIHsKKwkJc3AgPSBwYWdlX2hlYWRlcihf
X3BhKHNwdGVwKSk7CisJCWlmICh2aWV3ID09IDAgfHwgKHZpZXcgPiAwICYmIHNwLT52aWV3ID09
IHZpZXcpKQorCQkJZmx1c2ggfD0gc3B0ZV93cml0ZV9wcm90ZWN0KHNwdGVwLCBwdF9wcm90ZWN0
KTsKKwl9CiAKIAlyZXR1cm4gZmx1c2g7CiB9CiAKIHN0YXRpYyBib29sIF9fcm1hcF9yZWFkX3By
b3RlY3Qoc3RydWN0IGt2bSAqa3ZtLAotCQkJCXN0cnVjdCBrdm1fcm1hcF9oZWFkICpybWFwX2hl
YWQpCisJCQkJc3RydWN0IGt2bV9ybWFwX2hlYWQgKnJtYXBfaGVhZCwgdTE2IHZpZXcpCiB7CiAJ
c3RydWN0IHJtYXBfaXRlcmF0b3IgaXRlcjsKKwlzdHJ1Y3Qga3ZtX21tdV9wYWdlICpzcDsKIAli
b29sIGZsdXNoID0gZmFsc2U7CiAJdTY0ICpzcHRlcDsKIAotCWZvcl9lYWNoX3JtYXBfc3B0ZShy
bWFwX2hlYWQsICZpdGVyLCBzcHRlcCkKLQkJZmx1c2ggfD0gc3B0ZV9yZWFkX3Byb3RlY3Qoc3B0
ZXApOworCWZvcl9lYWNoX3JtYXBfc3B0ZShybWFwX2hlYWQsICZpdGVyLCBzcHRlcCkgeworCQlz
cCA9IHBhZ2VfaGVhZGVyKF9fcGEoc3B0ZXApKTsKKwkJaWYgKHZpZXcgPT0gMCB8fCAodmlldyA+
IDAgJiYgc3AtPnZpZXcgPT0gdmlldykpCisJCQlmbHVzaCB8PSBzcHRlX3JlYWRfcHJvdGVjdChz
cHRlcCk7CisJfQogCiAJcmV0dXJuIGZsdXNoOwogfQogCiBzdGF0aWMgYm9vbCBfX3JtYXBfZXhl
Y19wcm90ZWN0KHN0cnVjdCBrdm0gKmt2bSwKLQkJCQlzdHJ1Y3Qga3ZtX3JtYXBfaGVhZCAqcm1h
cF9oZWFkKQorCQkJCXN0cnVjdCBrdm1fcm1hcF9oZWFkICpybWFwX2hlYWQsIHUxNiB2aWV3KQog
ewogCXN0cnVjdCBybWFwX2l0ZXJhdG9yIGl0ZXI7CisJc3RydWN0IGt2bV9tbXVfcGFnZSAqc3A7
CiAJYm9vbCBmbHVzaCA9IGZhbHNlOwogCXU2NCAqc3B0ZXA7CiAKLQlmb3JfZWFjaF9ybWFwX3Nw
dGUocm1hcF9oZWFkLCAmaXRlciwgc3B0ZXApCi0JCWZsdXNoIHw9IHNwdGVfZXhlY19wcm90ZWN0
KHNwdGVwKTsKKwlmb3JfZWFjaF9ybWFwX3NwdGUocm1hcF9oZWFkLCAmaXRlciwgc3B0ZXApIHsK
KwkJc3AgPSBwYWdlX2hlYWRlcihfX3BhKHNwdGVwKSk7CisJCWlmICh2aWV3ID09IDAgfHwgKHZp
ZXcgPiAwICYmIHNwLT52aWV3ID09IHZpZXcpKQorCQkJZmx1c2ggfD0gc3B0ZV9leGVjX3Byb3Rl
Y3Qoc3B0ZXApOworCX0KIAogCXJldHVybiBmbHVzaDsKIH0KQEAgLTE3NDUsNyArMTc1Nyw3IEBA
IHN0YXRpYyB2b2lkIGt2bV9tbXVfd3JpdGVfcHJvdGVjdF9wdF9tYXNrZWQoc3RydWN0IGt2bSAq
a3ZtLAogCXdoaWxlIChtYXNrKSB7CiAJCXJtYXBfaGVhZCA9IF9fZ2ZuX3RvX3JtYXAoc2xvdC0+
YmFzZV9nZm4gKyBnZm5fb2Zmc2V0ICsgX19mZnMobWFzayksCiAJCQkJCSAgUEdfTEVWRUxfNEss
IHNsb3QpOwotCQlfX3JtYXBfd3JpdGVfcHJvdGVjdChrdm0sIHJtYXBfaGVhZCwgZmFsc2UpOwor
CQlfX3JtYXBfd3JpdGVfcHJvdGVjdChrdm0sIHJtYXBfaGVhZCwgZmFsc2UsIDApOwogCiAJCS8q
IGNsZWFyIHRoZSBmaXJzdCBzZXQgYml0ICovCiAJCW1hc2sgJj0gbWFzayAtIDE7CkBAIC0xODE2
LDcgKzE4MjgsOCBAQCBpbnQga3ZtX2FyY2hfd3JpdGVfbG9nX2RpcnR5KHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwgZ3BhX3QgbDJfZ3BhKQogfQogCiBib29sIGt2bV9tbXVfc2xvdF9nZm5fd3JpdGVf
cHJvdGVjdChzdHJ1Y3Qga3ZtICprdm0sCi0JCQkJICAgIHN0cnVjdCBrdm1fbWVtb3J5X3Nsb3Qg
KnNsb3QsIHU2NCBnZm4pCisJCQkJICAgIHN0cnVjdCBrdm1fbWVtb3J5X3Nsb3QgKnNsb3QsIHU2
NCBnZm4sCisJCQkJICAgIHUxNiB2aWV3KQogewogCXN0cnVjdCBrdm1fcm1hcF9oZWFkICpybWFw
X2hlYWQ7CiAJaW50IGk7CkBAIC0xODI0LDE0ICsxODM3LDE2IEBAIGJvb2wga3ZtX21tdV9zbG90
X2dmbl93cml0ZV9wcm90ZWN0KHN0cnVjdCBrdm0gKmt2bSwKIAogCWZvciAoaSA9IFBHX0xFVkVM
XzRLOyBpIDw9IEtWTV9NQVhfSFVHRVBBR0VfTEVWRUw7ICsraSkgewogCQlybWFwX2hlYWQgPSBf
X2dmbl90b19ybWFwKGdmbiwgaSwgc2xvdCk7Ci0JCXdyaXRlX3Byb3RlY3RlZCB8PSBfX3JtYXBf
d3JpdGVfcHJvdGVjdChrdm0sIHJtYXBfaGVhZCwgdHJ1ZSk7CisJCXdyaXRlX3Byb3RlY3RlZCB8
PSBfX3JtYXBfd3JpdGVfcHJvdGVjdChrdm0sIHJtYXBfaGVhZCwgdHJ1ZSwKKwkJCQkJCQl2aWV3
KTsKIAl9CiAKIAlyZXR1cm4gd3JpdGVfcHJvdGVjdGVkOwogfQogCiBib29sIGt2bV9tbXVfc2xv
dF9nZm5fcmVhZF9wcm90ZWN0KHN0cnVjdCBrdm0gKmt2bSwKLQkJCQkgICBzdHJ1Y3Qga3ZtX21l
bW9yeV9zbG90ICpzbG90LCB1NjQgZ2ZuKQorCQkJCSAgIHN0cnVjdCBrdm1fbWVtb3J5X3Nsb3Qg
KnNsb3QsIHU2NCBnZm4sCisJCQkJICAgdTE2IHZpZXcpCiB7CiAJc3RydWN0IGt2bV9ybWFwX2hl
YWQgKnJtYXBfaGVhZDsKIAlib29sIHJlYWRfcHJvdGVjdGVkID0gZmFsc2U7CkBAIC0xODM5LDE0
ICsxODU0LDE1IEBAIGJvb2wga3ZtX21tdV9zbG90X2dmbl9yZWFkX3Byb3RlY3Qoc3RydWN0IGt2
bSAqa3ZtLAogCiAJZm9yIChpID0gUEdfTEVWRUxfNEs7IGkgPD0gS1ZNX01BWF9IVUdFUEFHRV9M
RVZFTDsgKytpKSB7CiAJCXJtYXBfaGVhZCA9IF9fZ2ZuX3RvX3JtYXAoZ2ZuLCBpLCBzbG90KTsK
LQkJcmVhZF9wcm90ZWN0ZWQgfD0gX19ybWFwX3JlYWRfcHJvdGVjdChrdm0sIHJtYXBfaGVhZCk7
CisJCXJlYWRfcHJvdGVjdGVkIHw9IF9fcm1hcF9yZWFkX3Byb3RlY3Qoa3ZtLCBybWFwX2hlYWQs
IHZpZXcpOwogCX0KIAogCXJldHVybiByZWFkX3Byb3RlY3RlZDsKIH0KIAogYm9vbCBrdm1fbW11
X3Nsb3RfZ2ZuX2V4ZWNfcHJvdGVjdChzdHJ1Y3Qga3ZtICprdm0sCi0JCQkJICAgc3RydWN0IGt2
bV9tZW1vcnlfc2xvdCAqc2xvdCwgdTY0IGdmbikKKwkJCQkgICBzdHJ1Y3Qga3ZtX21lbW9yeV9z
bG90ICpzbG90LCB1NjQgZ2ZuLAorCQkJCSAgIHUxNiB2aWV3KQogewogCXN0cnVjdCBrdm1fcm1h
cF9oZWFkICpybWFwX2hlYWQ7CiAJYm9vbCBleGVjX3Byb3RlY3RlZCA9IGZhbHNlOwpAQCAtMTg1
NCw3ICsxODcwLDcgQEAgYm9vbCBrdm1fbW11X3Nsb3RfZ2ZuX2V4ZWNfcHJvdGVjdChzdHJ1Y3Qg
a3ZtICprdm0sCiAKIAlmb3IgKGkgPSBQR19MRVZFTF80SzsgaSA8PSBLVk1fTUFYX0hVR0VQQUdF
X0xFVkVMOyArK2kpIHsKIAkJcm1hcF9oZWFkID0gX19nZm5fdG9fcm1hcChnZm4sIGksIHNsb3Qp
OwotCQlleGVjX3Byb3RlY3RlZCB8PSBfX3JtYXBfZXhlY19wcm90ZWN0KGt2bSwgcm1hcF9oZWFk
KTsKKwkJZXhlY19wcm90ZWN0ZWQgfD0gX19ybWFwX2V4ZWNfcHJvdGVjdChrdm0sIHJtYXBfaGVh
ZCwgdmlldyk7CiAJfQogCiAJcmV0dXJuIGV4ZWNfcHJvdGVjdGVkOwpAQCAtMTg2NSw3ICsxODgx
LDcgQEAgc3RhdGljIGJvb2wgcm1hcF93cml0ZV9wcm90ZWN0KHN0cnVjdCBrdm1fdmNwdSAqdmNw
dSwgdTY0IGdmbikKIAlzdHJ1Y3Qga3ZtX21lbW9yeV9zbG90ICpzbG90OwogCiAJc2xvdCA9IGt2
bV92Y3B1X2dmbl90b19tZW1zbG90KHZjcHUsIGdmbik7Ci0JcmV0dXJuIGt2bV9tbXVfc2xvdF9n
Zm5fd3JpdGVfcHJvdGVjdCh2Y3B1LT5rdm0sIHNsb3QsIGdmbik7CisJcmV0dXJuIGt2bV9tbXVf
c2xvdF9nZm5fd3JpdGVfcHJvdGVjdCh2Y3B1LT5rdm0sIHNsb3QsIGdmbiwgMCk7CiB9CiAKIHN0
YXRpYyBib29sIGt2bV96YXBfcm1hcHAoc3RydWN0IGt2bSAqa3ZtLCBzdHJ1Y3Qga3ZtX3JtYXBf
aGVhZCAqcm1hcF9oZWFkKQpAQCAtNjAwOCw3ICs2MDI0LDcgQEAgdm9pZCBrdm1femFwX2dmbl9y
YW5nZShzdHJ1Y3Qga3ZtICprdm0sIGdmbl90IGdmbl9zdGFydCwgZ2ZuX3QgZ2ZuX2VuZCkKIHN0
YXRpYyBib29sIHNsb3Rfcm1hcF93cml0ZV9wcm90ZWN0KHN0cnVjdCBrdm0gKmt2bSwKIAkJCQkg
ICAgc3RydWN0IGt2bV9ybWFwX2hlYWQgKnJtYXBfaGVhZCkKIHsKLQlyZXR1cm4gX19ybWFwX3dy
aXRlX3Byb3RlY3Qoa3ZtLCBybWFwX2hlYWQsIGZhbHNlKTsKKwlyZXR1cm4gX19ybWFwX3dyaXRl
X3Byb3RlY3Qoa3ZtLCBybWFwX2hlYWQsIGZhbHNlLCAwKTsKIH0KIAogdm9pZCBrdm1fbW11X3Ns
b3RfcmVtb3ZlX3dyaXRlX2FjY2VzcyhzdHJ1Y3Qga3ZtICprdm0sCmRpZmYgLS1naXQgYS9hcmNo
L3g4Ni9rdm0vbW11L3BhZ2VfdHJhY2suYyBiL2FyY2gveDg2L2t2bS9tbXUvcGFnZV90cmFjay5j
CmluZGV4IGI1OTNiY2Y4MGJlMC4uYmYyNmIyMWNmZWI4IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9r
dm0vbW11L3BhZ2VfdHJhY2suYworKysgYi9hcmNoL3g4Ni9rdm0vbW11L3BhZ2VfdHJhY2suYwpA
QCAtMjAsMTIgKzIwLDEzIEBACiAKIHZvaWQga3ZtX3BhZ2VfdHJhY2tfZnJlZV9tZW1zbG90KHN0
cnVjdCBrdm1fbWVtb3J5X3Nsb3QgKnNsb3QpCiB7Ci0JaW50IGk7CisJaW50IGksIHZpZXc7CiAK
LQlmb3IgKGkgPSAwOyBpIDwgS1ZNX1BBR0VfVFJBQ0tfTUFYOyBpKyspIHsKLQkJa3ZmcmVlKHNs
b3QtPmFyY2guZ2ZuX3RyYWNrW2ldKTsKLQkJc2xvdC0+YXJjaC5nZm5fdHJhY2tbaV0gPSBOVUxM
OwotCX0KKwlmb3IgKHZpZXcgPSAwOyB2aWV3IDwgS1ZNX01BWF9FUFRfVklFV1M7IHZpZXcrKykK
KwkJZm9yIChpID0gMDsgaSA8IEtWTV9QQUdFX1RSQUNLX01BWDsgaSsrKSB7CisJCQlrdmZyZWUo
c2xvdC0+YXJjaC5nZm5fdHJhY2tbdmlld11baV0pOworCQkJc2xvdC0+YXJjaC5nZm5fdHJhY2tb
dmlld11baV0gPSBOVUxMOworCQl9CiB9CiAKIGludCBrdm1fcGFnZV90cmFja19jcmVhdGVfbWVt
c2xvdChzdHJ1Y3Qga3ZtICprdm0sIHN0cnVjdCBrdm1fbWVtb3J5X3Nsb3QgKnNsb3QsCkBAIC0z
MywxNiArMzQsMTcgQEAgaW50IGt2bV9wYWdlX3RyYWNrX2NyZWF0ZV9tZW1zbG90KHN0cnVjdCBr
dm0gKmt2bSwgc3RydWN0IGt2bV9tZW1vcnlfc2xvdCAqc2xvdCwKIHsKIAlzdHJ1Y3Qga3ZtX3Bh
Z2VfdHJhY2tfbm90aWZpZXJfaGVhZCAqaGVhZDsKIAlzdHJ1Y3Qga3ZtX3BhZ2VfdHJhY2tfbm90
aWZpZXJfbm9kZSAqbjsKLQlpbnQgaWR4OwotCWludCAgaTsKKwlpbnQgdmlldywgaWR4LCBpOwog
Ci0JZm9yIChpID0gMDsgaSA8IEtWTV9QQUdFX1RSQUNLX01BWDsgaSsrKSB7Ci0JCXNsb3QtPmFy
Y2guZ2ZuX3RyYWNrW2ldID0KLQkJCWt2Y2FsbG9jKG5wYWdlcywgc2l6ZW9mKCpzbG90LT5hcmNo
Lmdmbl90cmFja1tpXSksCi0JCQkJIEdGUF9LRVJORUxfQUNDT1VOVCk7Ci0JCWlmICghc2xvdC0+
YXJjaC5nZm5fdHJhY2tbaV0pCi0JCQlnb3RvIHRyYWNrX2ZyZWU7Ci0JfQorCWZvciAodmlldyA9
IDA7IHZpZXcgPCBLVk1fTUFYX0VQVF9WSUVXUzsgdmlldysrKQorCQlmb3IgKGkgPSAwOyBpIDwg
S1ZNX1BBR0VfVFJBQ0tfTUFYOyBpKyspIHsKKwkJCXNsb3QtPmFyY2guZ2ZuX3RyYWNrW3ZpZXdd
W2ldID0KKwkJCQlrdmNhbGxvYyhucGFnZXMsCisJCQkJCSBzaXplb2YoKnNsb3QtPmFyY2guZ2Zu
X3RyYWNrW3ZpZXddW2ldKSwKKwkJCQkJIEdGUF9LRVJORUxfQUNDT1VOVCk7CisJCQlpZiAoIXNs
b3QtPmFyY2guZ2ZuX3RyYWNrW3ZpZXddW2ldKQorCQkJCWdvdG8gdHJhY2tfZnJlZTsKKwkJfQog
CiAJaGVhZCA9ICZrdm0tPmFyY2gudHJhY2tfbm90aWZpZXJfaGVhZDsKIApAQCAtNzEsMTggKzcz
LDE5IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBwYWdlX3RyYWNrX21vZGVfaXNfdmFsaWQoZW51bSBr
dm1fcGFnZV90cmFja19tb2RlIG1vZGUpCiB9CiAKIHN0YXRpYyB2b2lkIHVwZGF0ZV9nZm5fdHJh
Y2soc3RydWN0IGt2bV9tZW1vcnlfc2xvdCAqc2xvdCwgZ2ZuX3QgZ2ZuLAotCQkJICAgICBlbnVt
IGt2bV9wYWdlX3RyYWNrX21vZGUgbW9kZSwgc2hvcnQgY291bnQpCisJCQkgICAgIGVudW0ga3Zt
X3BhZ2VfdHJhY2tfbW9kZSBtb2RlLCBzaG9ydCBjb3VudCwKKwkJCSAgICAgdTE2IHZpZXcpCiB7
CiAJaW50IGluZGV4LCB2YWw7CiAKIAlpbmRleCA9IGdmbl90b19pbmRleChnZm4sIHNsb3QtPmJh
c2VfZ2ZuLCBQR19MRVZFTF80Syk7CiAKLQl2YWwgPSBzbG90LT5hcmNoLmdmbl90cmFja1ttb2Rl
XVtpbmRleF07CisJdmFsID0gc2xvdC0+YXJjaC5nZm5fdHJhY2tbdmlld11bbW9kZV1baW5kZXhd
OwogCiAJaWYgKFdBUk5fT04odmFsICsgY291bnQgPCAwIHx8IHZhbCArIGNvdW50ID4gVVNIUlRf
TUFYKSkKIAkJcmV0dXJuOwogCi0Jc2xvdC0+YXJjaC5nZm5fdHJhY2tbbW9kZV1baW5kZXhdICs9
IGNvdW50OworCXNsb3QtPmFyY2guZ2ZuX3RyYWNrW3ZpZXddW21vZGVdW2luZGV4XSArPSBjb3Vu
dDsKIH0KIAogLyoKQEAgLTk5LDEzICsxMDIsMTMgQEAgc3RhdGljIHZvaWQgdXBkYXRlX2dmbl90
cmFjayhzdHJ1Y3Qga3ZtX21lbW9yeV9zbG90ICpzbG90LCBnZm5fdCBnZm4sCiAgKi8KIHZvaWQg
a3ZtX3Nsb3RfcGFnZV90cmFja19hZGRfcGFnZShzdHJ1Y3Qga3ZtICprdm0sCiAJCQkJICBzdHJ1
Y3Qga3ZtX21lbW9yeV9zbG90ICpzbG90LCBnZm5fdCBnZm4sCi0JCQkJICBlbnVtIGt2bV9wYWdl
X3RyYWNrX21vZGUgbW9kZSkKKwkJCQkgIGVudW0ga3ZtX3BhZ2VfdHJhY2tfbW9kZSBtb2RlLCB1
MTYgdmlldykKIHsKIAogCWlmIChXQVJOX09OKCFwYWdlX3RyYWNrX21vZGVfaXNfdmFsaWQobW9k
ZSkpKQogCQlyZXR1cm47CiAKLQl1cGRhdGVfZ2ZuX3RyYWNrKHNsb3QsIGdmbiwgbW9kZSwgMSk7
CisJdXBkYXRlX2dmbl90cmFjayhzbG90LCBnZm4sIG1vZGUsIDEsIHZpZXcpOwogCiAJLyoKIAkg
KiBuZXcgdHJhY2sgc3RvcHMgbGFyZ2UgcGFnZSBtYXBwaW5nIGZvciB0aGUKQEAgLTExNCwxMyAr
MTE3LDEzIEBAIHZvaWQga3ZtX3Nsb3RfcGFnZV90cmFja19hZGRfcGFnZShzdHJ1Y3Qga3ZtICpr
dm0sCiAJa3ZtX21tdV9nZm5fZGlzYWxsb3dfbHBhZ2Uoc2xvdCwgZ2ZuKTsKIAogCWlmIChtb2Rl
ID09IEtWTV9QQUdFX1RSQUNLX1BSRVdSSVRFIHx8IG1vZGUgPT0gS1ZNX1BBR0VfVFJBQ0tfV1JJ
VEUpIHsKLQkJaWYgKGt2bV9tbXVfc2xvdF9nZm5fd3JpdGVfcHJvdGVjdChrdm0sIHNsb3QsIGdm
bikpCisJCWlmIChrdm1fbW11X3Nsb3RfZ2ZuX3dyaXRlX3Byb3RlY3Qoa3ZtLCBzbG90LCBnZm4s
IHZpZXcpKQogCQkJa3ZtX2ZsdXNoX3JlbW90ZV90bGJzKGt2bSk7CiAJfSBlbHNlIGlmIChtb2Rl
ID09IEtWTV9QQUdFX1RSQUNLX1BSRVJFQUQpIHsKLQkJaWYgKGt2bV9tbXVfc2xvdF9nZm5fcmVh
ZF9wcm90ZWN0KGt2bSwgc2xvdCwgZ2ZuKSkKKwkJaWYgKGt2bV9tbXVfc2xvdF9nZm5fcmVhZF9w
cm90ZWN0KGt2bSwgc2xvdCwgZ2ZuLCB2aWV3KSkKIAkJCWt2bV9mbHVzaF9yZW1vdGVfdGxicyhr
dm0pOwogCX0gZWxzZSBpZiAobW9kZSA9PSBLVk1fUEFHRV9UUkFDS19QUkVFWEVDKSB7Ci0JCWlm
IChrdm1fbW11X3Nsb3RfZ2ZuX2V4ZWNfcHJvdGVjdChrdm0sIHNsb3QsIGdmbikpCisJCWlmIChr
dm1fbW11X3Nsb3RfZ2ZuX2V4ZWNfcHJvdGVjdChrdm0sIHNsb3QsIGdmbiwgdmlldykpCiAJCQlr
dm1fZmx1c2hfcmVtb3RlX3RsYnMoa3ZtKTsKIAl9CiB9CkBAIC0xNDEsMTIgKzE0NCwxMiBAQCBF
WFBPUlRfU1lNQk9MX0dQTChrdm1fc2xvdF9wYWdlX3RyYWNrX2FkZF9wYWdlKTsKICAqLwogdm9p
ZCBrdm1fc2xvdF9wYWdlX3RyYWNrX3JlbW92ZV9wYWdlKHN0cnVjdCBrdm0gKmt2bSwKIAkJCQkg
ICAgIHN0cnVjdCBrdm1fbWVtb3J5X3Nsb3QgKnNsb3QsIGdmbl90IGdmbiwKLQkJCQkgICAgIGVu
dW0ga3ZtX3BhZ2VfdHJhY2tfbW9kZSBtb2RlKQorCQkJCSAgICAgZW51bSBrdm1fcGFnZV90cmFj
a19tb2RlIG1vZGUsIHUxNiB2aWV3KQogewogCWlmIChXQVJOX09OKCFwYWdlX3RyYWNrX21vZGVf
aXNfdmFsaWQobW9kZSkpKQogCQlyZXR1cm47CiAKLQl1cGRhdGVfZ2ZuX3RyYWNrKHNsb3QsIGdm
biwgbW9kZSwgLTEpOworCXVwZGF0ZV9nZm5fdHJhY2soc2xvdCwgZ2ZuLCBtb2RlLCAtMSwgdmll
dyk7CiAKIAkvKgogCSAqIGFsbG93IGxhcmdlIHBhZ2UgbWFwcGluZyBmb3IgdGhlIHRyYWNrZWQg
cGFnZQpAQCAtMTYzLDcgKzE2Niw3IEBAIGJvb2wga3ZtX3BhZ2VfdHJhY2tfaXNfYWN0aXZlKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSwgZ2ZuX3QgZ2ZuLAogCQkJICAgICAgZW51bSBrdm1fcGFnZV90
cmFja19tb2RlIG1vZGUpCiB7CiAJc3RydWN0IGt2bV9tZW1vcnlfc2xvdCAqc2xvdDsKLQlpbnQg
aW5kZXg7CisJaW50IGluZGV4LCB2aWV3OwogCiAJaWYgKFdBUk5fT04oIXBhZ2VfdHJhY2tfbW9k
ZV9pc192YWxpZChtb2RlKSkpCiAJCXJldHVybiBmYWxzZTsKQEAgLTE3Myw3ICsxNzYsOCBAQCBi
b29sIGt2bV9wYWdlX3RyYWNrX2lzX2FjdGl2ZShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGdmbl90
IGdmbiwKIAkJcmV0dXJuIGZhbHNlOwogCiAJaW5kZXggPSBnZm5fdG9faW5kZXgoZ2ZuLCBzbG90
LT5iYXNlX2dmbiwgUEdfTEVWRUxfNEspOwotCXJldHVybiAhIVJFQURfT05DRShzbG90LT5hcmNo
Lmdmbl90cmFja1ttb2RlXVtpbmRleF0pOworCXZpZXcgPSBrdm1fZ2V0X2VwdF92aWV3KHZjcHUp
OworCXJldHVybiAhIVJFQURfT05DRShzbG90LT5hcmNoLmdmbl90cmFja1t2aWV3XVttb2RlXVtp
bmRleF0pOwogfQogCiB2b2lkIGt2bV9wYWdlX3RyYWNrX2NsZWFudXAoc3RydWN0IGt2bSAqa3Zt
KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2t2bWd0LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQva3ZtZ3QuYwppbmRleCA0ZTM3MGIyMTYzNjUuLjk4ZTJlNzVjMGQy
MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2t2bWd0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2t2bWd0LmMKQEAgLTE3MDYsNyArMTcwNiw4IEBAIHN0YXRp
YyBpbnQga3ZtZ3RfcGFnZV90cmFja19hZGQodW5zaWduZWQgbG9uZyBoYW5kbGUsIHU2NCBnZm4p
CiAJaWYgKGt2bWd0X2dmbl9pc193cml0ZV9wcm90ZWN0ZWQoaW5mbywgZ2ZuKSkKIAkJZ290byBv
dXQ7CiAKLQlrdm1fc2xvdF9wYWdlX3RyYWNrX2FkZF9wYWdlKGt2bSwgc2xvdCwgZ2ZuLCBLVk1f
UEFHRV9UUkFDS19XUklURSk7CisJa3ZtX3Nsb3RfcGFnZV90cmFja19hZGRfcGFnZShrdm0sIHNs
b3QsIGdmbiwKKwkJCQkgICAgIEtWTV9QQUdFX1RSQUNLX1dSSVRFLCAwKTsKIAlrdm1ndF9wcm90
ZWN0X3RhYmxlX2FkZChpbmZvLCBnZm4pOwogCiBvdXQ6CkBAIC0xNzQwLDcgKzE3NDEsOCBAQCBz
dGF0aWMgaW50IGt2bWd0X3BhZ2VfdHJhY2tfcmVtb3ZlKHVuc2lnbmVkIGxvbmcgaGFuZGxlLCB1
NjQgZ2ZuKQogCWlmICgha3ZtZ3RfZ2ZuX2lzX3dyaXRlX3Byb3RlY3RlZChpbmZvLCBnZm4pKQog
CQlnb3RvIG91dDsKIAotCWt2bV9zbG90X3BhZ2VfdHJhY2tfcmVtb3ZlX3BhZ2Uoa3ZtLCBzbG90
LCBnZm4sIEtWTV9QQUdFX1RSQUNLX1dSSVRFKTsKKwlrdm1fc2xvdF9wYWdlX3RyYWNrX3JlbW92
ZV9wYWdlKGt2bSwgc2xvdCwgZ2ZuLAorCQkJCQlLVk1fUEFHRV9UUkFDS19XUklURSwgMCk7CiAJ
a3ZtZ3RfcHJvdGVjdF90YWJsZV9kZWwoaW5mbywgZ2ZuKTsKIAogb3V0OgpAQCAtMTc3NSw3ICsx
Nzc3LDcgQEAgc3RhdGljIHZvaWQga3ZtZ3RfcGFnZV90cmFja19mbHVzaF9zbG90KHN0cnVjdCBr
dm0gKmt2bSwKIAkJZ2ZuID0gc2xvdC0+YmFzZV9nZm4gKyBpOwogCQlpZiAoa3ZtZ3RfZ2ZuX2lz
X3dyaXRlX3Byb3RlY3RlZChpbmZvLCBnZm4pKSB7CiAJCQlrdm1fc2xvdF9wYWdlX3RyYWNrX3Jl
bW92ZV9wYWdlKGt2bSwgc2xvdCwgZ2ZuLAotCQkJCQkJS1ZNX1BBR0VfVFJBQ0tfV1JJVEUpOwor
CQkJCQkJS1ZNX1BBR0VfVFJBQ0tfV1JJVEUsIDApOwogCQkJa3ZtZ3RfcHJvdGVjdF90YWJsZV9k
ZWwoaW5mbywgZ2ZuKTsKIAkJfQogCX0KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9u
QGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9u
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
