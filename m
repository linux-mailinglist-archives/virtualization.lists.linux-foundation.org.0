Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id C11AA2D1ADC
	for <lists.virtualization@lfdr.de>; Mon,  7 Dec 2020 21:46:45 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by whitealder.osuosl.org (Postfix) with ESMTP id 71C4487ABA;
	Mon,  7 Dec 2020 20:46:44 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id f-ZJ+QmiJfnH; Mon,  7 Dec 2020 20:46:36 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by whitealder.osuosl.org (Postfix) with ESMTP id 2E3B787B41;
	Mon,  7 Dec 2020 20:46:23 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 20DDDC013B;
	Mon,  7 Dec 2020 20:46:23 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id DA407C013B
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:46:18 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id C018D87899
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:46:18 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id mwCJOMqhEDFR
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:46:17 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by hemlock.osuosl.org (Postfix) with ESMTPS id 8D1E58789F
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:46:17 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 7C8C2305D509; Mon,  7 Dec 2020 22:46:14 +0200 (EET)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 53D873072784;
 Mon,  7 Dec 2020 22:46:14 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v11 16/81] KVM: x86: svm: use the vmx convention to control
 the MSR interception
Date: Mon,  7 Dec 2020 22:45:17 +0200
Message-Id: <20201207204622.15258-17-alazar@bitdefender.com>
In-Reply-To: <20201207204622.15258-1-alazar@bitdefender.com>
References: <20201207204622.15258-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <nicu.citu@icloud.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTmljdciZb3IgQ8OuyJt1IDxuaWN1LmNpdHVAaWNsb3VkLmNvbT4KClRoaXMgaXMgYSBw
cmVwYXJhdG9yeSBwYXRjaCBpbiBvcmRlciB0byB1c2UgYSBjb21tb24gaW50ZXJmYWNlIHRvCmVu
YWJsZS9kaXNhYmxlIHRoZSBNU1IgaW50ZXJjZXB0aW9uLgoKQWxzbywgaXQgd2lsbCBhbGxvdyB0
byBpbmRlcGVuZGVudGx5IGNvbnRyb2wgdGhlIHJlYWQgYW5kIHdyaXRlCmludGVyY2VwdGlvbnMu
CgpTaWduZWQtb2ZmLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5pY3UuY2l0dUBpY2xvdWQuY29tPgpT
aWduZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0t
LQogYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaCB8ICA0ICsrCiBhcmNoL3g4Ni9rdm0v
c3ZtL3N2bS5jICAgICAgICAgIHwgODggKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0t
CiBhcmNoL3g4Ni9rdm0vdm14L3ZteC5oICAgICAgICAgIHwgIDQgLS0KIDMgZmlsZXMgY2hhbmdl
ZCwgNjAgaW5zZXJ0aW9ucygrKSwgMzYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvYXJjaC94
ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaCBiL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0
LmgKaW5kZXggNTIzNjAwOGQyMzFmLi44NTg2YzlmNGZlYmEgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2
L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmgKKysrIGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hv
c3QuaApAQCAtMTQxLDYgKzE0MSwxMCBAQCBzdGF0aWMgaW5saW5lIGdmbl90IGdmbl90b19pbmRl
eChnZm5fdCBnZm4sIGdmbl90IGJhc2VfZ2ZuLCBpbnQgbGV2ZWwpCiAjZGVmaW5lIENSX1RZUEVf
VwkyCiAjZGVmaW5lIENSX1RZUEVfUlcJMwogCisjZGVmaW5lIE1TUl9UWVBFX1IJMQorI2RlZmlu
ZSBNU1JfVFlQRV9XCTIKKyNkZWZpbmUgTVNSX1RZUEVfUlcJMworCiAjZGVmaW5lIEFTWU5DX1BG
X1BFUl9WQ1BVIDY0CiAKIGVudW0ga3ZtX3JlZyB7CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0v
c3ZtL3N2bS5jIGIvYXJjaC94ODYva3ZtL3N2bS9zdm0uYwppbmRleCA0NDc4OTQyZjEwYTUuLjhk
NjYyY2NmNWI2MiAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL3N2bS9zdm0uYworKysgYi9hcmNo
L3g4Ni9rdm0vc3ZtL3N2bS5jCkBAIC01ODQsOCArNTg0LDggQEAgc3RhdGljIGludCBkaXJlY3Rf
YWNjZXNzX21zcl9zbG90KHUzMiBtc3IpCiAJcmV0dXJuIC1FTk9FTlQ7CiB9CiAKLXN0YXRpYyB2
b2lkIHNldF9zaGFkb3dfbXNyX2ludGVyY2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiBt
c3IsIGludCByZWFkLAotCQkJCSAgICAgaW50IHdyaXRlKQorc3RhdGljIHZvaWQgc2V0X3NoYWRv
d19tc3JfaW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTMyIG1zciwKKwkJCQkgICAg
IGludCB0eXBlLCBib29sIHZhbHVlKQogewogCXN0cnVjdCB2Y3B1X3N2bSAqc3ZtID0gdG9fc3Zt
KHZjcHUpOwogCWludCBzbG90ID0gZGlyZWN0X2FjY2Vzc19tc3Jfc2xvdChtc3IpOwpAQCAtNTk0
LDE1ICs1OTQsMTkgQEAgc3RhdGljIHZvaWQgc2V0X3NoYWRvd19tc3JfaW50ZXJjZXB0KHN0cnVj
dCBrdm1fdmNwdSAqdmNwdSwgdTMyIG1zciwgaW50IHJlYWQsCiAJCXJldHVybjsKIAogCS8qIFNl
dCB0aGUgc2hhZG93IGJpdG1hcHMgdG8gdGhlIGRlc2lyZWQgaW50ZXJjZXB0IHN0YXRlcyAqLwot
CWlmIChyZWFkKQotCQlzZXRfYml0KHNsb3QsIHN2bS0+c2hhZG93X21zcl9pbnRlcmNlcHQucmVh
ZCk7Ci0JZWxzZQotCQljbGVhcl9iaXQoc2xvdCwgc3ZtLT5zaGFkb3dfbXNyX2ludGVyY2VwdC5y
ZWFkKTsKKwlpZiAodHlwZSAmIE1TUl9UWVBFX1IpIHsKKwkJaWYgKHZhbHVlKQorCQkJc2V0X2Jp
dChzbG90LCBzdm0tPnNoYWRvd19tc3JfaW50ZXJjZXB0LnJlYWQpOworCQllbHNlCisJCQljbGVh
cl9iaXQoc2xvdCwgc3ZtLT5zaGFkb3dfbXNyX2ludGVyY2VwdC5yZWFkKTsKKwl9CiAKLQlpZiAo
d3JpdGUpCi0JCXNldF9iaXQoc2xvdCwgc3ZtLT5zaGFkb3dfbXNyX2ludGVyY2VwdC53cml0ZSk7
Ci0JZWxzZQotCQljbGVhcl9iaXQoc2xvdCwgc3ZtLT5zaGFkb3dfbXNyX2ludGVyY2VwdC53cml0
ZSk7CisJaWYgKHR5cGUgJiBNU1JfVFlQRV9XKSB7CisJCWlmICh2YWx1ZSkKKwkJCXNldF9iaXQo
c2xvdCwgc3ZtLT5zaGFkb3dfbXNyX2ludGVyY2VwdC53cml0ZSk7CisJCWVsc2UKKwkJCWNsZWFy
X2JpdChzbG90LCBzdm0tPnNoYWRvd19tc3JfaW50ZXJjZXB0LndyaXRlKTsKKwl9CiB9CiAKIHN0
YXRpYyBib29sIHZhbGlkX21zcl9pbnRlcmNlcHQodTMyIGluZGV4KQpAQCAtNjMwLDcgKzYzNCw3
IEBAIHN0YXRpYyBib29sIG1zcl93cml0ZV9pbnRlcmNlcHRlZChzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUsIHUzMiBtc3IpCiB9CiAKIHN0YXRpYyB2b2lkIHNldF9tc3JfaW50ZXJjZXB0aW9uX2JpdG1h
cChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiAqbXNycG0sCi0JCQkJCXUzMiBtc3IsIGludCBy
ZWFkLCBpbnQgd3JpdGUpCisJCQkJCXUzMiBtc3IsIGludCB0eXBlLCBib29sIHZhbHVlKQogewog
CXU4IGJpdF9yZWFkLCBiaXRfd3JpdGU7CiAJdW5zaWduZWQgbG9uZyB0bXA7CkBAIC02NDMsMTEg
KzY0NywxMyBAQCBzdGF0aWMgdm9pZCBzZXRfbXNyX2ludGVyY2VwdGlvbl9iaXRtYXAoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1LCB1MzIgKm1zcnBtLAogCVdBUk5fT04oIXZhbGlkX21zcl9pbnRlcmNl
cHQobXNyKSk7CiAKIAkvKiBFbmZvcmNlIG5vbiBhbGxvd2VkIE1TUnMgdG8gdHJhcCAqLwotCWlm
IChyZWFkICYmICFrdm1fbXNyX2FsbG93ZWQodmNwdSwgbXNyLCBLVk1fTVNSX0ZJTFRFUl9SRUFE
KSkKLQkJcmVhZCA9IDA7CisJaWYgKHZhbHVlICYmICh0eXBlICYgTVNSX1RZUEVfUikgJiYKKwkg
ICAgIWt2bV9tc3JfYWxsb3dlZCh2Y3B1LCBtc3IsIEtWTV9NU1JfRklMVEVSX1JFQUQpKQorCQl0
eXBlICY9IH5NU1JfVFlQRV9SOwogCi0JaWYgKHdyaXRlICYmICFrdm1fbXNyX2FsbG93ZWQodmNw
dSwgbXNyLCBLVk1fTVNSX0ZJTFRFUl9XUklURSkpCi0JCXdyaXRlID0gMDsKKwlpZiAodmFsdWUg
JiYgKHR5cGUgJiBNU1JfVFlQRV9XKSAmJgorCSAgICAha3ZtX21zcl9hbGxvd2VkKHZjcHUsIG1z
ciwgS1ZNX01TUl9GSUxURVJfV1JJVEUpKQorCQl0eXBlICY9IH5NU1JfVFlQRV9XOwogCiAJb2Zm
c2V0ICAgID0gc3ZtX21zcnBtX29mZnNldChtc3IpOwogCWJpdF9yZWFkICA9IDIgKiAobXNyICYg
MHgwZik7CkBAIC02NTYsMTcgKzY2MiwxOSBAQCBzdGF0aWMgdm9pZCBzZXRfbXNyX2ludGVyY2Vw
dGlvbl9iaXRtYXAoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgKm1zcnBtLAogCiAJQlVHX09O
KG9mZnNldCA9PSBNU1JfSU5WQUxJRCk7CiAKLQlyZWFkICA/IGNsZWFyX2JpdChiaXRfcmVhZCwg
ICZ0bXApIDogc2V0X2JpdChiaXRfcmVhZCwgICZ0bXApOwotCXdyaXRlID8gY2xlYXJfYml0KGJp
dF93cml0ZSwgJnRtcCkgOiBzZXRfYml0KGJpdF93cml0ZSwgJnRtcCk7CisJaWYgKHR5cGUgJiBN
U1JfVFlQRV9SKQorCQl2YWx1ZSAgPyBjbGVhcl9iaXQoYml0X3JlYWQsICAmdG1wKSA6IHNldF9i
aXQoYml0X3JlYWQsICAmdG1wKTsKKwlpZiAodHlwZSAmIE1TUl9UWVBFX1cpCisJCXZhbHVlICA/
IGNsZWFyX2JpdChiaXRfd3JpdGUsICZ0bXApIDogc2V0X2JpdChiaXRfd3JpdGUsICZ0bXApOwog
CiAJbXNycG1bb2Zmc2V0XSA9IHRtcDsKIH0KIAogc3RhdGljIHZvaWQgc2V0X21zcl9pbnRlcmNl
cHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgKm1zcnBtLCB1MzIgbXNyLAotCQkJCSBp
bnQgcmVhZCwgaW50IHdyaXRlKQorCQkJCSBpbnQgdHlwZSwgYm9vbCB2YWx1ZSkKIHsKLQlzZXRf
c2hhZG93X21zcl9pbnRlcmNlcHQodmNwdSwgbXNyLCByZWFkLCB3cml0ZSk7Ci0Jc2V0X21zcl9p
bnRlcmNlcHRpb25fYml0bWFwKHZjcHUsIG1zcnBtLCBtc3IsIHJlYWQsIHdyaXRlKTsKKwlzZXRf
c2hhZG93X21zcl9pbnRlcmNlcHQodmNwdSwgbXNyLCB0eXBlLCB2YWx1ZSk7CisJc2V0X21zcl9p
bnRlcmNlcHRpb25fYml0bWFwKHZjcHUsIG1zcnBtLCBtc3IsIHR5cGUsIHZhbHVlKTsKIH0KIAog
dTMyICpzdm1fdmNwdV9hbGxvY19tc3JwbSh2b2lkKQpAQCAtNjkwLDcgKzY5OCw4IEBAIHZvaWQg
c3ZtX3ZjcHVfaW5pdF9tc3JwbShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiAqbXNycG0pCiAJ
Zm9yIChpID0gMDsgZGlyZWN0X2FjY2Vzc19tc3JzW2ldLmluZGV4ICE9IE1TUl9JTlZBTElEOyBp
KyspIHsKIAkJaWYgKCFkaXJlY3RfYWNjZXNzX21zcnNbaV0uYWx3YXlzKQogCQkJY29udGludWU7
Ci0JCXNldF9tc3JfaW50ZXJjZXB0aW9uKHZjcHUsIG1zcnBtLCBkaXJlY3RfYWNjZXNzX21zcnNb
aV0uaW5kZXgsIDEsIDEpOworCQlzZXRfbXNyX2ludGVyY2VwdGlvbih2Y3B1LCBtc3JwbSwgZGly
ZWN0X2FjY2Vzc19tc3JzW2ldLmluZGV4LAorCQkJCSAgICAgTVNSX1RZUEVfUlcsIDEpOwogCX0K
IH0KIApAQCAtNzE1LDcgKzcyNCwxMCBAQCBzdGF0aWMgdm9pZCBzdm1fbXNyX2ZpbHRlcl9jaGFu
Z2VkKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAkJdTMyIHJlYWQgPSB0ZXN0X2JpdChpLCBzdm0t
PnNoYWRvd19tc3JfaW50ZXJjZXB0LnJlYWQpOwogCQl1MzIgd3JpdGUgPSB0ZXN0X2JpdChpLCBz
dm0tPnNoYWRvd19tc3JfaW50ZXJjZXB0LndyaXRlKTsKIAotCQlzZXRfbXNyX2ludGVyY2VwdGlv
bl9iaXRtYXAodmNwdSwgc3ZtLT5tc3JwbSwgbXNyLCByZWFkLCB3cml0ZSk7CisJCXNldF9tc3Jf
aW50ZXJjZXB0aW9uX2JpdG1hcCh2Y3B1LCBzdm0tPm1zcnBtLCBtc3IsCisJCQkJCSAgICBNU1Jf
VFlQRV9SLCByZWFkKTsKKwkJc2V0X21zcl9pbnRlcmNlcHRpb25fYml0bWFwKHZjcHUsIHN2bS0+
bXNycG0sIG1zciwKKwkJCQkJICAgIE1TUl9UWVBFX1csIHdyaXRlKTsKIAl9CiB9CiAKQEAgLTc2
NywxMCArNzc5LDE0IEBAIHN0YXRpYyB2b2lkIHN2bV9lbmFibGVfbGJydihzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUpCiAJc3RydWN0IHZjcHVfc3ZtICpzdm0gPSB0b19zdm0odmNwdSk7CiAKIAlzdm0t
PnZtY2ItPmNvbnRyb2wudmlydF9leHQgfD0gTEJSX0NUTF9FTkFCTEVfTUFTSzsKLQlzZXRfbXNy
X2ludGVyY2VwdGlvbih2Y3B1LCBzdm0tPm1zcnBtLCBNU1JfSUEzMl9MQVNUQlJBTkNIRlJPTUlQ
LCAxLCAxKTsKLQlzZXRfbXNyX2ludGVyY2VwdGlvbih2Y3B1LCBzdm0tPm1zcnBtLCBNU1JfSUEz
Ml9MQVNUQlJBTkNIVE9JUCwgMSwgMSk7Ci0Jc2V0X21zcl9pbnRlcmNlcHRpb24odmNwdSwgc3Zt
LT5tc3JwbSwgTVNSX0lBMzJfTEFTVElOVEZST01JUCwgMSwgMSk7Ci0Jc2V0X21zcl9pbnRlcmNl
cHRpb24odmNwdSwgc3ZtLT5tc3JwbSwgTVNSX0lBMzJfTEFTVElOVFRPSVAsIDEsIDEpOworCXNl
dF9tc3JfaW50ZXJjZXB0aW9uKHZjcHUsIHN2bS0+bXNycG0sIE1TUl9JQTMyX0xBU1RCUkFOQ0hG
Uk9NSVAsCisJCQkgICAgIE1TUl9UWVBFX1JXLCAxKTsKKwlzZXRfbXNyX2ludGVyY2VwdGlvbih2
Y3B1LCBzdm0tPm1zcnBtLCBNU1JfSUEzMl9MQVNUQlJBTkNIVE9JUCwKKwkJCSAgICAgTVNSX1RZ
UEVfUlcsIDEpOworCXNldF9tc3JfaW50ZXJjZXB0aW9uKHZjcHUsIHN2bS0+bXNycG0sIE1TUl9J
QTMyX0xBU1RJTlRGUk9NSVAsCisJCQkgICAgIE1TUl9UWVBFX1JXLCAxKTsKKwlzZXRfbXNyX2lu
dGVyY2VwdGlvbih2Y3B1LCBzdm0tPm1zcnBtLCBNU1JfSUEzMl9MQVNUSU5UVE9JUCwKKwkJCSAg
ICAgTVNSX1RZUEVfUlcsIDEpOwogfQogCiBzdGF0aWMgdm9pZCBzdm1fZGlzYWJsZV9sYnJ2KHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSkKQEAgLTc3OCwxMCArNzk0LDE0IEBAIHN0YXRpYyB2b2lkIHN2
bV9kaXNhYmxlX2xicnYoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogCXN0cnVjdCB2Y3B1X3N2bSAq
c3ZtID0gdG9fc3ZtKHZjcHUpOwogCiAJc3ZtLT52bWNiLT5jb250cm9sLnZpcnRfZXh0ICY9IH5M
QlJfQ1RMX0VOQUJMRV9NQVNLOwotCXNldF9tc3JfaW50ZXJjZXB0aW9uKHZjcHUsIHN2bS0+bXNy
cG0sIE1TUl9JQTMyX0xBU1RCUkFOQ0hGUk9NSVAsIDAsIDApOwotCXNldF9tc3JfaW50ZXJjZXB0
aW9uKHZjcHUsIHN2bS0+bXNycG0sIE1TUl9JQTMyX0xBU1RCUkFOQ0hUT0lQLCAwLCAwKTsKLQlz
ZXRfbXNyX2ludGVyY2VwdGlvbih2Y3B1LCBzdm0tPm1zcnBtLCBNU1JfSUEzMl9MQVNUSU5URlJP
TUlQLCAwLCAwKTsKLQlzZXRfbXNyX2ludGVyY2VwdGlvbih2Y3B1LCBzdm0tPm1zcnBtLCBNU1Jf
SUEzMl9MQVNUSU5UVE9JUCwgMCwgMCk7CisJc2V0X21zcl9pbnRlcmNlcHRpb24odmNwdSwgc3Zt
LT5tc3JwbSwgTVNSX0lBMzJfTEFTVEJSQU5DSEZST01JUCwKKwkJCSAgICAgTVNSX1RZUEVfUlcs
IDApOworCXNldF9tc3JfaW50ZXJjZXB0aW9uKHZjcHUsIHN2bS0+bXNycG0sIE1TUl9JQTMyX0xB
U1RCUkFOQ0hUT0lQLAorCQkJICAgICBNU1JfVFlQRV9SVywgMCk7CisJc2V0X21zcl9pbnRlcmNl
cHRpb24odmNwdSwgc3ZtLT5tc3JwbSwgTVNSX0lBMzJfTEFTVElOVEZST01JUCwKKwkJCSAgICAg
TVNSX1RZUEVfUlcsIDApOworCXNldF9tc3JfaW50ZXJjZXB0aW9uKHZjcHUsIHN2bS0+bXNycG0s
IE1TUl9JQTMyX0xBU1RJTlRUT0lQLAorCQkJICAgICBNU1JfVFlQRV9SVywgMCk7CiB9CiAKIHZv
aWQgZGlzYWJsZV9ubWlfc2luZ2xlc3RlcChzdHJ1Y3QgdmNwdV9zdm0gKnN2bSkKQEAgLTI3MzQs
NyArMjc1NCw4IEBAIHN0YXRpYyBpbnQgc3ZtX3NldF9tc3Ioc3RydWN0IGt2bV92Y3B1ICp2Y3B1
LCBzdHJ1Y3QgbXNyX2RhdGEgKm1zcikKIAkJICogV2UgdXBkYXRlIHRoZSBMMSBNU1IgYml0IGFz
IHdlbGwgc2luY2UgaXQgd2lsbCBlbmQgdXAKIAkJICogdG91Y2hpbmcgdGhlIE1TUiBhbnl3YXkg
bm93LgogCQkgKi8KLQkJc2V0X21zcl9pbnRlcmNlcHRpb24odmNwdSwgc3ZtLT5tc3JwbSwgTVNS
X0lBMzJfU1BFQ19DVFJMLCAxLCAxKTsKKwkJc2V0X21zcl9pbnRlcmNlcHRpb24odmNwdSwgc3Zt
LT5tc3JwbSwgTVNSX0lBMzJfU1BFQ19DVFJMLAorCQkJCSAgICAgTVNSX1RZUEVfUlcsIDEpOwog
CQlicmVhazsKIAljYXNlIE1TUl9JQTMyX1BSRURfQ01EOgogCQlpZiAoIW1zci0+aG9zdF9pbml0
aWF0ZWQgJiYKQEAgLTI3NDksNyArMjc3MCwxMCBAQCBzdGF0aWMgaW50IHN2bV9zZXRfbXNyKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSwgc3RydWN0IG1zcl9kYXRhICptc3IpCiAJCQlicmVhazsKIAog
CQl3cm1zcmwoTVNSX0lBMzJfUFJFRF9DTUQsIFBSRURfQ01EX0lCUEIpOwotCQlzZXRfbXNyX2lu
dGVyY2VwdGlvbih2Y3B1LCBzdm0tPm1zcnBtLCBNU1JfSUEzMl9QUkVEX0NNRCwgMCwgMSk7CisJ
CXNldF9tc3JfaW50ZXJjZXB0aW9uKHZjcHUsIHN2bS0+bXNycG0sIE1TUl9JQTMyX1BSRURfQ01E
LAorCQkJCSAgICAgTVNSX1RZUEVfUiwgMCk7CisJCXNldF9tc3JfaW50ZXJjZXB0aW9uKHZjcHUs
IHN2bS0+bXNycG0sIE1TUl9JQTMyX1BSRURfQ01ELAorCQkJCSAgICAgTVNSX1RZUEVfVywgMSk7
CiAJCWJyZWFrOwogCWNhc2UgTVNSX0FNRDY0X1ZJUlRfU1BFQ19DVFJMOgogCQlpZiAoIW1zci0+
aG9zdF9pbml0aWF0ZWQgJiYKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2t2bS92bXgvdm14LmggYi9h
cmNoL3g4Ni9rdm0vdm14L3ZteC5oCmluZGV4IDlkM2E1NTc5NDlhYy4uODkyZTljYTY0M2M0IDEw
MDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0vdm14L3ZteC5oCisrKyBiL2FyY2gveDg2L2t2bS92bXgv
dm14LmgKQEAgLTE2LDEwICsxNiw2IEBACiAKIGV4dGVybiBjb25zdCB1MzIgdm14X21zcl9pbmRl
eFtdOwogCi0jZGVmaW5lIE1TUl9UWVBFX1IJMQotI2RlZmluZSBNU1JfVFlQRV9XCTIKLSNkZWZp
bmUgTVNSX1RZUEVfUlcJMwotCiAjZGVmaW5lIFgyQVBJQ19NU1IocikgKEFQSUNfQkFTRV9NU1Ig
KyAoKHIpID4+IDQpKQogCiAjaWZkZWYgQ09ORklHX1g4Nl82NApfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QK
VmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5s
aW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
