Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 99EE22D1B65
	for <lists.virtualization@lfdr.de>; Mon,  7 Dec 2020 21:57:15 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 400388710C;
	Mon,  7 Dec 2020 20:57:14 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id JGskaPXCINYb; Mon,  7 Dec 2020 20:57:08 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id EF8918720F;
	Mon,  7 Dec 2020 20:56:59 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id D60C4C013B;
	Mon,  7 Dec 2020 20:56:59 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 921A3C163C
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:56:57 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 7848C87A8A
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:56:57 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id B2YVRaPzZemC
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:56:57 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id EC7F387A85
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:56:56 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 1F74A305D469; Mon,  7 Dec 2020 22:46:19 +0200 (EET)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id E9ECD3072784;
 Mon,  7 Dec 2020 22:46:18 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v11 42/81] KVM: introspection: add
 KVMI_VM_READ_PHYSICAL/KVMI_VM_WRITE_PHYSICAL
Date: Mon,  7 Dec 2020 22:45:43 +0200
Message-Id: <20201207204622.15258-43-alazar@bitdefender.com>
In-Reply-To: <20201207204622.15258-1-alazar@bitdefender.com>
References: <20201207204622.15258-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhlc2UgY29tbWFu
ZHMgYWxsb3cgdGhlIGludHJvc3BlY3Rpb24gdG9vbCB0byByZWFkL3dyaXRlIGZyb20vdG8KdGhl
IGd1ZXN0IG1lbW9yeS4KClNpZ25lZC1vZmYtYnk6IE1paGFpIERvbsibdSA8bWRvbnR1QGJpdGRl
ZmVuZGVyLmNvbT4KQ28tZGV2ZWxvcGVkLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRk
ZWZlbmRlci5jb20+ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJpdGRl
ZmVuZGVyLmNvbT4KLS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgICAgICAg
ICAgICAgfCAgNjggKysrKysrKysrKwogaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaCAgICAgICAg
ICAgICAgICAgICAgIHwgIDE3ICsrKwogLi4uL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQv
a3ZtaV90ZXN0LmMgIHwgMTI0ICsrKysrKysrKysrKysrKysrKwogdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pLmMgICAgICAgICAgICAgICAgIHwgIDk4ICsrKysrKysrKysrKysrCiB2aXJ0L2t2
bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmggICAgICAgICAgICAgfCAgIDcgKwogdmlydC9rdm0v
aW50cm9zcGVjdGlvbi9rdm1pX21zZy5jICAgICAgICAgICAgIHwgIDQ0ICsrKysrKysKIDYgZmls
ZXMgY2hhbmdlZCwgMzU4IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9u
L3ZpcnQva3ZtL2t2bWkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAppbmRl
eCBiNGNlN2RiMzIxNTAuLjc4MTJkNjIyNDBjMCAxMDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi92
aXJ0L2t2bS9rdm1pLnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CkBA
IC0zNjUsNiArMzY1LDc0IEBAIHRoZSBmb2xsb3dpbmcgZXZlbnRzOjoKICogLUtWTV9FSU5WQUwg
LSB0aGUgZXZlbnQgSUQgaXMgdW5rbm93biAodXNlICpLVk1JX1ZNX0NIRUNLX0VWRU5UKiBmaXJz
dCkKICogLUtWTV9FUEVSTSAtIHRoZSBhY2Nlc3MgaXMgZGlzYWxsb3dlZCAodXNlICpLVk1JX1ZN
X0NIRUNLX0VWRU5UKiBmaXJzdCkKIAorNi4gS1ZNSV9WTV9SRUFEX1BIWVNJQ0FMCistLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0KKworOkFyY2hpdGVjdHVyZXM6IGFsbAorOlZlcnNpb25zOiA+PSAx
Cis6UGFyYW1ldGVyczoKKworOjoKKworCXN0cnVjdCBrdm1pX3ZtX3JlYWRfcGh5c2ljYWwgewor
CQlfX3U2NCBncGE7CisJCV9fdTE2IHNpemU7CisJCV9fdTE2IHBhZGRpbmcxOworCQlfX3UzMiBw
YWRkaW5nMjsKKwl9OworCis6UmV0dXJuczoKKworOjoKKworCXN0cnVjdCBrdm1pX2Vycm9yX2Nv
ZGU7CisJX191OCBkYXRhWzBdOworCitSZWFkcyBmcm9tIHRoZSBndWVzdCBtZW1vcnkuCisKK0N1
cnJlbnRseSwgdGhlIHNpemUgbXVzdCBiZSBub24temVybyBhbmQgdGhlIHJlYWQgbXVzdCBiZSBy
ZXN0cmljdGVkIHRvCitvbmUgcGFnZSAob2Zmc2V0ICsgc2l6ZSA8PSBQQUdFX1NJWkUpLgorCis6
RXJyb3JzOgorCisqIC1LVk1fRU5PRU5UIC0gdGhlIGd1ZXN0IHBhZ2UgZG9lc24ndCBleGlzdHMK
KyogLUtWTV9FSU5WQUwgLSB0aGUgc3BlY2lmaWVkIGdwYS9zaXplIHBhaXIgaXMgaW52YWxpZAor
KiAtS1ZNX0VJTlZBTCAtIHRoZSBwYWRkaW5nIGlzIG5vdCB6ZXJvCisKKzcuIEtWTUlfVk1fV1JJ
VEVfUEhZU0lDQUwKKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKworOkFyY2hpdGVjdHVyZXM6
IGFsbAorOlZlcnNpb25zOiA+PSAxCis6UGFyYW1ldGVyczoKKworOjoKKworCXN0cnVjdCBrdm1p
X3ZtX3dyaXRlX3BoeXNpY2FsIHsKKwkJX191NjQgZ3BhOworCQlfX3UxNiBzaXplOworCQlfX3Ux
NiBwYWRkaW5nMTsKKwkJX191MzIgcGFkZGluZzI7CisJCV9fdTggIGRhdGFbMF07CisJfTsKKwor
OlJldHVybnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV9lcnJvcl9jb2RlCisKK1dyaXRlcyBpbnRv
IHRoZSBndWVzdCBtZW1vcnkuCisKK0N1cnJlbnRseSwgdGhlIHNpemUgbXVzdCBiZSBub24temVy
byBhbmQgdGhlIHdyaXRlIG11c3QgYmUgcmVzdHJpY3RlZCB0bworb25lIHBhZ2UgKG9mZnNldCAr
IHNpemUgPD0gUEFHRV9TSVpFKS4KKworOkVycm9yczoKKworKiAtS1ZNX0VOT0VOVCAtIHRoZSBn
dWVzdCBwYWdlIGRvZXNuJ3QgZXhpc3RzCisqIC1LVk1fRUlOVkFMIC0gdGhlIHNwZWNpZmllZCBn
cGEvc2l6ZSBwYWlyIGlzIGludmFsaWQKKyogLUtWTV9FSU5WQUwgLSB0aGUgcGFkZGluZyBpcyBu
b3QgemVybworCiBFdmVudHMKID09PT09PQogCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvbGlu
dXgva3ZtaS5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAppbmRleCA5YTEwZWYyY2Q4OTAu
LjA0OGFmYWQwMWJlNiAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAorKysg
Yi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCkBAIC0yNCw2ICsyNCw4IEBAIGVudW0gewogCUtW
TUlfVk1fQ0hFQ0tfRVZFTlQgICAgPSBLVk1JX1ZNX01FU1NBR0VfSUQoMyksCiAJS1ZNSV9WTV9H
RVRfSU5GTyAgICAgICA9IEtWTUlfVk1fTUVTU0FHRV9JRCg0KSwKIAlLVk1JX1ZNX0NPTlRST0xf
RVZFTlRTID0gS1ZNSV9WTV9NRVNTQUdFX0lEKDUpLAorCUtWTUlfVk1fUkVBRF9QSFlTSUNBTCAg
PSBLVk1JX1ZNX01FU1NBR0VfSUQoNiksCisJS1ZNSV9WTV9XUklURV9QSFlTSUNBTCA9IEtWTUlf
Vk1fTUVTU0FHRV9JRCg3KSwKIAogCUtWTUlfTkVYVF9WTV9NRVNTQUdFCiB9OwpAQCAtOTAsNCAr
OTIsMTkgQEAgc3RydWN0IGt2bWlfdm1fY29udHJvbF9ldmVudHMgewogCV9fdTMyIHBhZGRpbmcy
OwogfTsKIAorc3RydWN0IGt2bWlfdm1fcmVhZF9waHlzaWNhbCB7CisJX191NjQgZ3BhOworCV9f
dTE2IHNpemU7CisJX191MTYgcGFkZGluZzE7CisJX191MzIgcGFkZGluZzI7Cit9OworCitzdHJ1
Y3Qga3ZtaV92bV93cml0ZV9waHlzaWNhbCB7CisJX191NjQgZ3BhOworCV9fdTE2IHNpemU7CisJ
X191MTYgcGFkZGluZzE7CisJX191MzIgcGFkZGluZzI7CisJX191OCAgZGF0YVswXTsKK307CisK
ICNlbmRpZiAvKiBfVUFQSV9fTElOVVhfS1ZNSV9IICovCmRpZmYgLS1naXQgYS90b29scy90ZXN0
aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9zZWxm
dGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYwppbmRleCA0MzA2ODVhMzM3MWUuLmI0OTNlZGI1
MzRiMCAxMDA2NDQKLS0tIGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1p
X3Rlc3QuYworKysgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVz
dC5jCkBAIC04LDYgKzgsNyBAQAogI2RlZmluZSBfR05VX1NPVVJDRSAvKiBmb3IgcHJvZ3JhbV9p
bnZvY2F0aW9uX3Nob3J0X25hbWUgKi8KICNpbmNsdWRlIDxzeXMvdHlwZXMuaD4KICNpbmNsdWRl
IDxzeXMvc29ja2V0Lmg+CisjaW5jbHVkZSA8dGltZS5oPgogCiAjaW5jbHVkZSAidGVzdF91dGls
LmgiCiAKQEAgLTI0LDYgKzI1LDEyIEBAIHN0YXRpYyBpbnQgc29ja2V0X3BhaXJbMl07CiAjZGVm
aW5lIEt2bV9zb2NrZXQgICAgICAgc29ja2V0X3BhaXJbMF0KICNkZWZpbmUgVXNlcnNwYWNlX3Nv
Y2tldCBzb2NrZXRfcGFpclsxXQogCitzdGF0aWMgdm1fdmFkZHJfdCB0ZXN0X2d2YTsKK3N0YXRp
YyB2b2lkICp0ZXN0X2h2YTsKK3N0YXRpYyB2bV9wYWRkcl90IHRlc3RfZ3BhOworCitzdGF0aWMg
aW50IHBhZ2Vfc2l6ZTsKKwogdm9pZCBzZXR1cF9zb2NrZXQodm9pZCkKIHsKIAlpbnQgcjsKQEAg
LTQyMCw4ICs0MjcsMTEyIEBAIHN0YXRpYyB2b2lkIHRlc3RfY21kX3ZtX2NvbnRyb2xfZXZlbnRz
KHN0cnVjdCBrdm1fdm0gKnZtKQogCWFsbG93X2V2ZW50KHZtLCBpZCk7CiB9CiAKK3N0YXRpYyB2
b2lkIGNtZF92bV93cml0ZV9wYWdlKF9fdTY0IGdwYSwgX191NjQgc2l6ZSwgdm9pZCAqcCwKKwkJ
CSAgICAgIGludCBleHBlY3RlZF9lcnIpCit7CisJc3RydWN0IGt2bWlfdm1fd3JpdGVfcGh5c2lj
YWwgKmNtZDsKKwlzdHJ1Y3Qga3ZtaV9tc2dfaGRyICpyZXE7CisJc2l6ZV90IHJlcV9zaXplOwor
CisJcmVxX3NpemUgPSBzaXplb2YoKnJlcSkgKyBzaXplb2YoKmNtZCkgKyBzaXplOworCXJlcSA9
IGNhbGxvYygxLCByZXFfc2l6ZSk7CisKKwljbWQgPSAoc3RydWN0IGt2bWlfdm1fd3JpdGVfcGh5
c2ljYWwgKikocmVxICsgMSk7CisJY21kLT5ncGEgPSBncGE7CisJY21kLT5zaXplID0gc2l6ZTsK
KworCW1lbWNweShjbWQgKyAxLCBwLCBzaXplKTsKKworCXRlc3Rfdm1fY29tbWFuZChLVk1JX1ZN
X1dSSVRFX1BIWVNJQ0FMLCByZXEsIHJlcV9zaXplLCBOVUxMLCAwLAorCQkJZXhwZWN0ZWRfZXJy
KTsKKworCWZyZWUocmVxKTsKK30KKworc3RhdGljIHZvaWQgd3JpdGVfZ3Vlc3RfcGFnZShfX3U2
NCBncGEsIHZvaWQgKnApCit7CisJY21kX3ZtX3dyaXRlX3BhZ2UoZ3BhLCBwYWdlX3NpemUsIHAs
IDApOworfQorCitzdGF0aWMgdm9pZCB3cml0ZV93aXRoX2ludmFsaWRfYXJndW1lbnRzKF9fdTY0
IGdwYSwgX191NjQgc2l6ZSwgdm9pZCAqcCkKK3sKKwljbWRfdm1fd3JpdGVfcGFnZShncGEsIHNp
emUsIHAsIC1LVk1fRUlOVkFMKTsKK30KKworc3RhdGljIHZvaWQgd3JpdGVfaW52YWxpZF9ndWVz
dF9wYWdlKHN0cnVjdCBrdm1fdm0gKnZtLCB2b2lkICpwKQoreworCV9fdTY0IGdwYSA9IHZtLT5t
YXhfZ2ZuIDw8IHZtLT5wYWdlX3NoaWZ0OworCV9fdTY0IHNpemUgPSAxOworCisJY21kX3ZtX3dy
aXRlX3BhZ2UoZ3BhLCBzaXplLCBwLCAtS1ZNX0VOT0VOVCk7Cit9CisKK3N0YXRpYyB2b2lkIGNt
ZF92bV9yZWFkX3BhZ2UoX191NjQgZ3BhLCBfX3U2NCBzaXplLCB2b2lkICpwLAorCQkJICAgICBp
bnQgZXhwZWN0ZWRfZXJyKQoreworCXN0cnVjdCB7CisJCXN0cnVjdCBrdm1pX21zZ19oZHIgaGRy
OworCQlzdHJ1Y3Qga3ZtaV92bV9yZWFkX3BoeXNpY2FsIGNtZDsKKwl9IHJlcSA9IHsgfTsKKwor
CXJlcS5jbWQuZ3BhID0gZ3BhOworCXJlcS5jbWQuc2l6ZSA9IHNpemU7CisKKwl0ZXN0X3ZtX2Nv
bW1hbmQoS1ZNSV9WTV9SRUFEX1BIWVNJQ0FMLCAmcmVxLmhkciwgc2l6ZW9mKHJlcSksIHAsIHNp
emUsCisJCQlleHBlY3RlZF9lcnIpOworfQorCitzdGF0aWMgdm9pZCByZWFkX2d1ZXN0X3BhZ2Uo
X191NjQgZ3BhLCB2b2lkICpwKQoreworCWNtZF92bV9yZWFkX3BhZ2UoZ3BhLCBwYWdlX3NpemUs
IHAsIDApOworfQorCitzdGF0aWMgdm9pZCByZWFkX3dpdGhfaW52YWxpZF9hcmd1bWVudHMoX191
NjQgZ3BhLCBfX3U2NCBzaXplLCB2b2lkICpwKQoreworCWNtZF92bV9yZWFkX3BhZ2UoZ3BhLCBz
aXplLCBwLCAtS1ZNX0VJTlZBTCk7Cit9CisKK3N0YXRpYyB2b2lkIHJlYWRfaW52YWxpZF9ndWVz
dF9wYWdlKHN0cnVjdCBrdm1fdm0gKnZtKQoreworCV9fdTY0IGdwYSA9IHZtLT5tYXhfZ2ZuIDw8
IHZtLT5wYWdlX3NoaWZ0OworCV9fdTY0IHNpemUgPSAxOworCisJY21kX3ZtX3JlYWRfcGFnZShn
cGEsIHNpemUsIE5VTEwsIC1LVk1fRU5PRU5UKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9tZW1v
cnlfYWNjZXNzKHN0cnVjdCBrdm1fdm0gKnZtKQoreworCXZvaWQgKnB3LCAqcHI7CisKKwlwdyA9
IG1hbGxvYyhwYWdlX3NpemUpOworCVRFU1RfQVNTRVJUKHB3LCAiSW5zdWZmaWNpZW50IE1lbW9y
eVxuIik7CisKKwltZW1zZXQocHcsIDEsIHBhZ2Vfc2l6ZSk7CisKKwl3cml0ZV9ndWVzdF9wYWdl
KHRlc3RfZ3BhLCBwdyk7CisJVEVTVF9BU1NFUlQobWVtY21wKHB3LCB0ZXN0X2h2YSwgcGFnZV9z
aXplKSA9PSAwLAorCQkiV3JpdGUgcGFnZSB0ZXN0IGZhaWxlZCIpOworCisJcHIgPSBtYWxsb2Mo
cGFnZV9zaXplKTsKKwlURVNUX0FTU0VSVChwciwgIkluc3VmZmljaWVudCBNZW1vcnlcbiIpOwor
CisJcmVhZF9ndWVzdF9wYWdlKHRlc3RfZ3BhLCBwcik7CisJVEVTVF9BU1NFUlQobWVtY21wKHB3
LCBwciwgcGFnZV9zaXplKSA9PSAwLAorCQkiUmVhZCBwYWdlIHRlc3QgZmFpbGVkIik7CisKKwly
ZWFkX3dpdGhfaW52YWxpZF9hcmd1bWVudHModGVzdF9ncGEsIDAsIHByKTsKKwl3cml0ZV93aXRo
X2ludmFsaWRfYXJndW1lbnRzKHRlc3RfZ3BhLCAwLCBwdyk7CisJd3JpdGVfaW52YWxpZF9ndWVz
dF9wYWdlKHZtLCBwdyk7CisKKwlmcmVlKHB3KTsKKwlmcmVlKHByKTsKKworCXJlYWRfaW52YWxp
ZF9ndWVzdF9wYWdlKHZtKTsKK30KKwogc3RhdGljIHZvaWQgdGVzdF9pbnRyb3NwZWN0aW9uKHN0
cnVjdCBrdm1fdm0gKnZtKQogeworCXNyYW5kb20odGltZSgwKSk7CiAJc2V0dXBfc29ja2V0KCk7
CiAJaG9va19pbnRyb3NwZWN0aW9uKHZtKTsKIApAQCAtNDMyLDEwICs1NDMsMjAgQEAgc3RhdGlj
IHZvaWQgdGVzdF9pbnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtKQogCXRlc3RfY21kX3Zt
X2dldF9pbmZvKCk7CiAJdGVzdF9ldmVudF91bmhvb2sodm0pOwogCXRlc3RfY21kX3ZtX2NvbnRy
b2xfZXZlbnRzKHZtKTsKKwl0ZXN0X21lbW9yeV9hY2Nlc3Modm0pOwogCiAJdW5ob29rX2ludHJv
c3BlY3Rpb24odm0pOwogfQogCitzdGF0aWMgdm9pZCBzZXR1cF90ZXN0X3BhZ2VzKHN0cnVjdCBr
dm1fdm0gKnZtKQoreworCXRlc3RfZ3ZhID0gdm1fdmFkZHJfYWxsb2Modm0sIHBhZ2Vfc2l6ZSwg
S1ZNX1VUSUxfTUlOX1ZBRERSLCAwLCAwKTsKKwlzeW5jX2dsb2JhbF90b19ndWVzdCh2bSwgdGVz
dF9ndmEpOworCisJdGVzdF9odmEgPSBhZGRyX2d2YTJodmEodm0sIHRlc3RfZ3ZhKTsKKwl0ZXN0
X2dwYSA9IGFkZHJfZ3ZhMmdwYSh2bSwgdGVzdF9ndmEpOworfQorCiBpbnQgbWFpbihpbnQgYXJn
YywgY2hhciAqYXJndltdKQogewogCXN0cnVjdCBrdm1fdm0gKnZtOwpAQCAtNDQ4LDYgKzU2OSw5
IEBAIGludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pCiAJdm0gPSB2bV9jcmVhdGVfZGVm
YXVsdChWQ1BVX0lELCAwLCBOVUxMKTsKIAl2Y3B1X3NldF9jcHVpZCh2bSwgVkNQVV9JRCwga3Zt
X2dldF9zdXBwb3J0ZWRfY3B1aWQoKSk7CiAKKwlwYWdlX3NpemUgPSBnZXRwYWdlc2l6ZSgpOwor
CXNldHVwX3Rlc3RfcGFnZXModm0pOworCiAJdGVzdF9pbnRyb3NwZWN0aW9uKHZtKTsKIAogCWt2
bV92bV9mcmVlKHZtKTsKZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5j
IGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKaW5kZXggZTAxMmRiNzgyYTMyLi5jOTlj
MjdjMjQ5ZWEgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCisrKyBi
L3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCkBAIC01LDcgKzUsOSBAQAogICogQ29weXJp
Z2h0IChDKSAyMDE3LTIwMjAgQml0ZGVmZW5kZXIgUy5SLkwuCiAgKgogICovCisjaW5jbHVkZSA8
bGludXgvbW11X2NvbnRleHQuaD4KICNpbmNsdWRlIDxsaW51eC9rdGhyZWFkLmg+CisjaW5jbHVk
ZSA8bGludXgvaGlnaG1lbS5oPgogI2luY2x1ZGUgImt2bWlfaW50LmgiCiAKICNkZWZpbmUgS1ZN
SV9OVU1fQ09NTUFORFMgX19jbXAoKGludClLVk1JX05FWFRfVk1fTUVTU0FHRSwgXApAQCAtNDUz
LDMgKzQ1NSw5OSBAQCBpbnQga3ZtaV9jbWRfdm1fY29udHJvbF9ldmVudHMoc3RydWN0IGt2bV9p
bnRyb3NwZWN0aW9uICprdm1pLAogCiAJcmV0dXJuIDA7CiB9CisKK3N0YXRpYyBsb25nCitnZXRf
dXNlcl9wYWdlc19yZW1vdGVfdW5sb2NrZWQoc3RydWN0IG1tX3N0cnVjdCAqbW0sIHVuc2lnbmVk
IGxvbmcgc3RhcnQsCisJCQkJdW5zaWduZWQgbG9uZyBucl9wYWdlcywgdW5zaWduZWQgaW50IGd1
cF9mbGFncywKKwkJCQlzdHJ1Y3QgcGFnZSAqKnBhZ2VzKQoreworCXN0cnVjdCB2bV9hcmVhX3N0
cnVjdCAqKnZtYXMgPSBOVUxMOworCWludCBsb2NrZWQgPSAxOworCWxvbmcgcjsKKworCW1tYXBf
cmVhZF9sb2NrKG1tKTsKKwlyID0gZ2V0X3VzZXJfcGFnZXNfcmVtb3RlKG1tLCBzdGFydCwgbnJf
cGFnZXMsIGd1cF9mbGFncywKKwkJCQkgIHBhZ2VzLCB2bWFzLCAmbG9ja2VkKTsKKwlpZiAobG9j
a2VkKQorCQltbWFwX3JlYWRfdW5sb2NrKG1tKTsKKworCXJldHVybiByOworfQorCitzdGF0aWMg
dm9pZCAqZ2V0X3BhZ2VfcHRyKHN0cnVjdCBrdm0gKmt2bSwgZ3BhX3QgZ3BhLCBzdHJ1Y3QgcGFn
ZSAqKnBhZ2UsCisJCQkgIGJvb2wgd3JpdGUsIGludCAqc3JjdV9pZHgpCit7CisJdW5zaWduZWQg
aW50IGZsYWdzID0gd3JpdGUgPyBGT0xMX1dSSVRFIDogMDsKKwl1bnNpZ25lZCBsb25nIGh2YTsK
KworCSpwYWdlID0gTlVMTDsKKworCSpzcmN1X2lkeCA9IHNyY3VfcmVhZF9sb2NrKCZrdm0tPnNy
Y3UpOworCWh2YSA9IGdmbl90b19odmEoa3ZtLCBncGFfdG9fZ2ZuKGdwYSkpOworCisJaWYgKGt2
bV9pc19lcnJvcl9odmEoaHZhKSkKKwkJZ290byBvdXRfZXJyOworCisJaWYgKGdldF91c2VyX3Bh
Z2VzX3JlbW90ZV91bmxvY2tlZChrdm0tPm1tLCBodmEsIDEsIGZsYWdzLCBwYWdlKSAhPSAxKQor
CQlnb3RvIG91dF9lcnI7CisKKwlyZXR1cm4gd3JpdGUgPyBrbWFwX2F0b21pYygqcGFnZSkgOiBr
bWFwKCpwYWdlKTsKK291dF9lcnI6CisJc3JjdV9yZWFkX3VubG9jaygma3ZtLT5zcmN1LCAqc3Jj
dV9pZHgpOworCXJldHVybiBOVUxMOworfQorCitzdGF0aWMgdm9pZCBwdXRfcGFnZV9wdHIoc3Ry
dWN0IGt2bSAqa3ZtLCB2b2lkICpwdHIsIHN0cnVjdCBwYWdlICpwYWdlLAorCQkJIGJvb2wgd3Jp
dGUsIGludCBzcmN1X2lkeCkKK3sKKwlpZiAod3JpdGUpCisJCWt1bm1hcF9hdG9taWMocHRyKTsK
KwllbHNlCisJCWt1bm1hcChwdHIpOworCisJcHV0X3BhZ2UocGFnZSk7CisKKwlzcmN1X3JlYWRf
dW5sb2NrKCZrdm0tPnNyY3UsIHNyY3VfaWR4KTsKK30KKworaW50IGt2bWlfY21kX3JlYWRfcGh5
c2ljYWwoc3RydWN0IGt2bSAqa3ZtLCB1NjQgZ3BhLCBzaXplX3Qgc2l6ZSwKKwkJCSAgIGludCAo
KnNlbmQpKHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqLAorCQkJCQljb25zdCBzdHJ1Y3Qga3Zt
aV9tc2dfaGRyICosCisJCQkJCWludCBlcnIsIGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90KSwKKwkJ
CSAgIGNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKmN0eCkKK3sKKwlzdHJ1Y3QgcGFnZSAqcGFn
ZTsKKwl2b2lkICpwdHJfcGFnZTsKKwlpbnQgc3JjdV9pZHg7CisJaW50IGVycjsKKworCXB0cl9w
YWdlID0gZ2V0X3BhZ2VfcHRyKGt2bSwgZ3BhLCAmcGFnZSwgZmFsc2UsICZzcmN1X2lkeCk7CisJ
aWYgKCFwdHJfcGFnZSkgeworCQllcnIgPSBzZW5kKEtWTUkoa3ZtKSwgY3R4LCAtS1ZNX0VOT0VO
VCwgTlVMTCwgMCk7CisJfSBlbHNlIHsKKwkJZXJyID0gc2VuZChLVk1JKGt2bSksIGN0eCwgMCwK
KwkJCSAgIHB0cl9wYWdlICsgKGdwYSAmIH5QQUdFX01BU0spLCBzaXplKTsKKworCQlwdXRfcGFn
ZV9wdHIoa3ZtLCBwdHJfcGFnZSwgcGFnZSwgZmFsc2UsIHNyY3VfaWR4KTsKKwl9CisKKwlyZXR1
cm4gZXJyOworfQorCitpbnQga3ZtaV9jbWRfd3JpdGVfcGh5c2ljYWwoc3RydWN0IGt2bSAqa3Zt
LCB1NjQgZ3BhLCBzaXplX3Qgc2l6ZSwKKwkJCSAgICBjb25zdCB2b2lkICpidWYpCit7CisJaW50
IGVjID0gLUtWTV9FTk9FTlQ7CisJc3RydWN0IHBhZ2UgKnBhZ2U7CisJaW50IHNyY3VfaWR4Owor
CXZvaWQgKnB0cjsKKworCXB0ciA9IGdldF9wYWdlX3B0cihrdm0sIGdwYSwgJnBhZ2UsIHRydWUs
ICZzcmN1X2lkeCk7CisJaWYgKHB0cikgeworCQltZW1jcHkocHRyICsgKGdwYSAmIH5QQUdFX01B
U0spLCBidWYsIHNpemUpOworCQlwdXRfcGFnZV9wdHIoa3ZtLCBwdHIsIHBhZ2UsIHRydWUsIHNy
Y3VfaWR4KTsKKwkJZWMgPSAwOworCX0KKworCXJldHVybiBlYzsKK30KZGlmZiAtLWdpdCBhL3Zp
cnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24v
a3ZtaV9pbnQuaAppbmRleCA5ODc1MTNkNmMxYTcuLmI3Yzg3MzBlN2U2ZCAxMDA2NDQKLS0tIGEv
dmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCisrKyBiL3ZpcnQva3ZtL2ludHJvc3Bl
Y3Rpb24va3ZtaV9pbnQuaApAQCAtMjksNiArMjksMTMgQEAgYm9vbCBrdm1pX2lzX2tub3duX2V2
ZW50KHUxNiBpZCk7CiBib29sIGt2bWlfaXNfa25vd25fdm1fZXZlbnQodTE2IGlkKTsKIGludCBr
dm1pX2NtZF92bV9jb250cm9sX2V2ZW50cyhzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWks
CiAJCQkgICAgICAgdTE2IGV2ZW50X2lkLCBib29sIGVuYWJsZSk7CitpbnQga3ZtaV9jbWRfcmVh
ZF9waHlzaWNhbChzdHJ1Y3Qga3ZtICprdm0sIHU2NCBncGEsIHNpemVfdCBzaXplLAorCQkJICAg
aW50ICgqc2VuZCkoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICosCisJCQkJCWNvbnN0IHN0cnVj
dCBrdm1pX21zZ19oZHIqLAorCQkJCQlpbnQgZXJyLCBjb25zdCB2b2lkICpidWYsIHNpemVfdCks
CisJCQkgICBjb25zdCBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICpjdHgpOworaW50IGt2bWlfY21kX3dy
aXRlX3BoeXNpY2FsKHN0cnVjdCBrdm0gKmt2bSwgdTY0IGdwYSwgc2l6ZV90IHNpemUsCisJCQkg
ICAgY29uc3Qgdm9pZCAqYnVmKTsKIAogLyogYXJjaCAqLwogdm9pZCBrdm1pX2FyY2hfaW5pdF92
Y3B1X2V2ZW50c19tYXNrKHVuc2lnbmVkIGxvbmcgKnN1cHBvcnRlZCk7CmRpZmYgLS1naXQgYS92
aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9u
L2t2bWlfbXNnLmMKaW5kZXggZmZkN2Q5NWI2NjRmLi5mMDA1MDk0NTcxMTIgMTAwNjQ0Ci0tLSBh
L3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYworKysgYi92aXJ0L2t2bS9pbnRyb3Nw
ZWN0aW9uL2t2bWlfbXNnLmMKQEAgLTE4Miw2ICsxODIsNDggQEAgc3RhdGljIGludCBoYW5kbGVf
dm1fY29udHJvbF9ldmVudHMoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAogCXJldHVy
biBrdm1pX21zZ192bV9yZXBseShrdm1pLCBtc2csIGVjLCBOVUxMLCAwKTsKIH0KIAorc3RhdGlj
IGJvb2wgaW52YWxpZF9wYWdlX2FjY2Vzcyh1NjQgZ3BhLCB1NjQgc2l6ZSkKK3sKKwl1NjQgb2Zm
ID0gZ3BhICYgflBBR0VfTUFTSzsKKworCXJldHVybiAoc2l6ZSA9PSAwIHx8IHNpemUgPiBQQUdF
X1NJWkUgfHwgb2ZmICsgc2l6ZSA+IFBBR0VfU0laRSk7Cit9CisKK3N0YXRpYyBpbnQgaGFuZGxl
X3ZtX3JlYWRfcGh5c2ljYWwoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJCSAg
IGNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZywKKwkJCQkgICBjb25zdCB2b2lkICpfcmVx
KQoreworCWNvbnN0IHN0cnVjdCBrdm1pX3ZtX3JlYWRfcGh5c2ljYWwgKnJlcSA9IF9yZXE7CisK
KwlpZiAoaW52YWxpZF9wYWdlX2FjY2VzcyhyZXEtPmdwYSwgcmVxLT5zaXplKSB8fAorCSAgICBy
ZXEtPnBhZGRpbmcxIHx8IHJlcS0+cGFkZGluZzIpCisJCXJldHVybiBrdm1pX21zZ192bV9yZXBs
eShrdm1pLCBtc2csIC1LVk1fRUlOVkFMLCBOVUxMLCAwKTsKKworCXJldHVybiBrdm1pX2NtZF9y
ZWFkX3BoeXNpY2FsKGt2bWktPmt2bSwgcmVxLT5ncGEsIHJlcS0+c2l6ZSwKKwkJCQkgICAgICBr
dm1pX21zZ192bV9yZXBseSwgbXNnKTsKK30KKworc3RhdGljIGludCBoYW5kbGVfdm1fd3JpdGVf
cGh5c2ljYWwoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJCSAgICBjb25zdCBz
dHJ1Y3Qga3ZtaV9tc2dfaGRyICptc2csCisJCQkJICAgIGNvbnN0IHZvaWQgKl9yZXEpCit7CisJ
Y29uc3Qgc3RydWN0IGt2bWlfdm1fd3JpdGVfcGh5c2ljYWwgKnJlcSA9IF9yZXE7CisJaW50IGVj
OworCisJaWYgKHN0cnVjdF9zaXplKHJlcSwgZGF0YSwgcmVxLT5zaXplKSA+IG1zZy0+c2l6ZSkK
KwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoaW52YWxpZF9wYWdlX2FjY2VzcyhyZXEtPmdwYSwg
cmVxLT5zaXplKSkKKwkJZWMgPSAtS1ZNX0VJTlZBTDsKKwllbHNlIGlmIChyZXEtPnBhZGRpbmcx
IHx8IHJlcS0+cGFkZGluZzIpCisJCWVjID0gLUtWTV9FSU5WQUw7CisJZWxzZQorCQllYyA9IGt2
bWlfY21kX3dyaXRlX3BoeXNpY2FsKGt2bWktPmt2bSwgcmVxLT5ncGEsCisJCQkJCSAgICAgcmVx
LT5zaXplLCByZXEtPmRhdGEpOworCisJcmV0dXJuIGt2bWlfbXNnX3ZtX3JlcGx5KGt2bWksIG1z
ZywgZWMsIE5VTEwsIDApOworfQorCiAvKgogICogVGhlc2UgY29tbWFuZHMgYXJlIGV4ZWN1dGVk
IGJ5IHRoZSByZWNlaXZpbmcgdGhyZWFkLgogICovCkBAIC0xOTEsNiArMjMzLDggQEAgc3RhdGlj
IGt2bWlfdm1fbXNnX2ZjdCBjb25zdCBtc2dfdm1bXSA9IHsKIAlbS1ZNSV9WTV9DSEVDS19FVkVO
VF0gICAgPSBoYW5kbGVfdm1fY2hlY2tfZXZlbnQsCiAJW0tWTUlfVk1fQ09OVFJPTF9FVkVOVFNd
ID0gaGFuZGxlX3ZtX2NvbnRyb2xfZXZlbnRzLAogCVtLVk1JX1ZNX0dFVF9JTkZPXSAgICAgICA9
IGhhbmRsZV92bV9nZXRfaW5mbywKKwlbS1ZNSV9WTV9SRUFEX1BIWVNJQ0FMXSAgPSBoYW5kbGVf
dm1fcmVhZF9waHlzaWNhbCwKKwlbS1ZNSV9WTV9XUklURV9QSFlTSUNBTF0gPSBoYW5kbGVfdm1f
d3JpdGVfcGh5c2ljYWwsCiB9OwogCiBzdGF0aWMga3ZtaV92bV9tc2dfZmN0IGdldF92bV9tc2df
aGFuZGxlcih1MTYgaWQpCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5s
aW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFp
bG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
