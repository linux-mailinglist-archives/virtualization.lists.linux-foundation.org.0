Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id 141E3228B3A
	for <lists.virtualization@lfdr.de>; Tue, 21 Jul 2020 23:26:27 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 9A041884D6;
	Tue, 21 Jul 2020 21:26:25 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id p7XVciHzPZKC; Tue, 21 Jul 2020 21:26:21 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 83A5B88501;
	Tue, 21 Jul 2020 21:26:21 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 6331CC016F;
	Tue, 21 Jul 2020 21:26:21 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 7CA01C08A9
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:13 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id 5760A22802
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:13 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 3CSJETDE+2Iv
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:26:03 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by silver.osuosl.org (Postfix) with ESMTPS id B695122782
 for <virtualization@lists.linux-foundation.org>;
 Tue, 21 Jul 2020 21:25:56 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 29629305D50A; Wed, 22 Jul 2020 00:09:32 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 0FD45304FA15;
 Wed, 22 Jul 2020 00:09:32 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v9 82/84] KVM: introspection: add KVMI_VCPU_TRANSLATE_GVA
Date: Wed, 22 Jul 2020 00:09:20 +0300
Message-Id: <20200721210922.7646-83-alazar@bitdefender.com>
In-Reply-To: <20200721210922.7646-1-alazar@bitdefender.com>
References: <20200721210922.7646-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>, virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhpcyBoZWxwcyB0aGUgaW50cm9zcGVjdGlvbiB0b29sIHdpdGggdGhlIEdWQSB0byBHUEEgdHJh
bnNsYXRpb25zCndpdGhvdXQgdGhlIG5lZWQgdG8gcmVhZCBvciBtb25pdG9yIHRoZSBndWVzdCBw
YWdlIHRhYmxlcy4KClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJpdGRl
ZmVuZGVyLmNvbT4KLS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgICAgICAg
ICAgICAgfCAzMiArKysrKysrKysrKysrKysrKysrCiBhcmNoL3g4Ni9rdm0va3ZtaS5jICAgICAg
ICAgICAgICAgICAgICAgICAgICAgfCAgNSArKysKIGluY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgg
ICAgICAgICAgICAgICAgICAgICB8ICA5ICsrKysrKwogLi4uL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2
bS94ODZfNjQva3ZtaV90ZXN0LmMgIHwgMzAgKysrKysrKysrKysrKysrKysKIHZpcnQva3ZtL2lu
dHJvc3BlY3Rpb24va3ZtaV9pbnQuaCAgICAgICAgICAgICB8ICAxICsKIHZpcnQva3ZtL2ludHJv
c3BlY3Rpb24va3ZtaV9tc2cuYyAgICAgICAgICAgICB8IDE1ICsrKysrKysrKwogNiBmaWxlcyBj
aGFuZ2VkLCA5MiBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvRG9jdW1lbnRhdGlvbi92aXJ0
L2t2bS9rdm1pLnJzdCBiL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKaW5kZXggM2M0
ODFjMWIyMTg2Li42MjEzOGZhNGI2NWMgMTAwNjQ0Ci0tLSBhL0RvY3VtZW50YXRpb24vdmlydC9r
dm0va3ZtaS5yc3QKKysrIGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdApAQCAtMTA4
Niw2ICsxMDg2LDM4IEBAIHRvIHRoZSBpbnRyb3NwZWN0aW9uIHRvb2wuCiAqIC1LVk1fRUlOVkFM
IC0gdGhlIHBhZGRpbmcgaXMgbm90IHplcm8KICogLUtWTV9FQUdBSU4gLSB0aGUgc2VsZWN0ZWQg
dkNQVSBjYW4ndCBiZSBpbnRyb3NwZWN0ZWQgeWV0CiAKKzI1LiBLVk1JX1ZDUFVfVFJBTlNMQVRF
X0dWQQorLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKKzpBcmNoaXRlY3R1cmU6IHg4Ngor
OlZlcnNpb25zOiA+PSAxCis6UGFyYW1ldGVyczoKKworOjoKKworCXN0cnVjdCBrdm1pX3ZjcHVf
aGRyOworCXN0cnVjdCBrdm1pX3ZjcHVfdHJhbnNsYXRlX2d2YSB7CisJCV9fdTY0IGd2YTsKKwl9
OworCis6UmV0dXJuczoKKworOjoKKworCXN0cnVjdCBrdm1pX2Vycm9yX2NvZGU7CisJc3RydWN0
IGt2bWlfdmNwdV90cmFuc2xhdGVfZ3ZhX3JlcGx5IHsKKwkJX191NjQgZ3BhOworCX07CisKK1Ry
YW5zbGF0ZXMgYSBndWVzdCB2aXJ0dWFsIGFkZHJlc3MgdG8gYSBndWVzdCBwaHlzaWNhbCBhZGRy
ZXNzIG9yIH4wIGlmCit0aGUgYWRkcmVzcyBjYW5ub3QgYmUgdHJhbnNsYXRlZC4KKworOkVycm9y
czoKKworKiAtS1ZNX0VJTlZBTCAtIHRoZSBzZWxlY3RlZCB2Q1BVIGlzIGludmFsaWQKKyogLUtW
TV9FSU5WQUwgLSB0aGUgcGFkZGluZyBpcyBub3QgemVybworKiAtS1ZNX0VBR0FJTiAtIHRoZSBz
ZWxlY3RlZCB2Q1BVIGNhbid0IGJlIGludHJvc3BlY3RlZCB5ZXQKKwogRXZlbnRzCiA9PT09PT0K
IApkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL2t2bWkuYyBiL2FyY2gveDg2L2t2bS9rdm1pLmMK
aW5kZXggMTg3MTMwMDQxNTJkLi44MDUxZDA2MDY0YWIgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2
bS9rdm1pLmMKKysrIGIvYXJjaC94ODYva3ZtL2t2bWkuYwpAQCAtMTM3MywzICsxMzczLDggQEAg
Ym9vbCBrdm1pX2FyY2hfc3RvcF9zaW5nbGVzdGVwKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAlr
dm1feDg2X29wcy5jb250cm9sX3NpbmdsZXN0ZXAodmNwdSwgZmFsc2UpOwogCXJldHVybiB0cnVl
OwogfQorCitncGFfdCBrdm1pX2FyY2hfY21kX3RyYW5zbGF0ZV9ndmEoc3RydWN0IGt2bV92Y3B1
ICp2Y3B1LCBndmFfdCBndmEpCit7CisJcmV0dXJuIGt2bV9tbXVfZ3ZhX3RvX2dwYV9zeXN0ZW0o
dmNwdSwgZ3ZhLCAwLCBOVUxMKTsKK30KZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9r
dm1pLmggYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCmluZGV4IDA0MDA0OWFiZDQ1MC4uM2Mx
NWMxN2QyOGUzIDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2lu
Y2x1ZGUvdWFwaS9saW51eC9rdm1pLmgKQEAgLTQ4LDYgKzQ4LDcgQEAgZW51bSB7CiAJS1ZNSV9W
TV9TRVRfUEFHRV9BQ0NFU1MgPSAyMywKIAogCUtWTUlfVkNQVV9DT05UUk9MX1NJTkdMRVNURVAg
PSAyNCwKKwlLVk1JX1ZDUFVfVFJBTlNMQVRFX0dWQSAgICAgID0gMjUsCiAKIAlLVk1JX05VTV9N
RVNTQUdFUwogfTsKQEAgLTI0Miw0ICsyNDMsMTIgQEAgc3RydWN0IGt2bWlfZXZlbnRfc2luZ2xl
c3RlcCB7CiAJX191OCBwYWRkaW5nWzddOwogfTsKIAorc3RydWN0IGt2bWlfdmNwdV90cmFuc2xh
dGVfZ3ZhIHsKKwlfX3U2NCBndmE7Cit9OworCitzdHJ1Y3Qga3ZtaV92Y3B1X3RyYW5zbGF0ZV9n
dmFfcmVwbHkgeworCV9fdTY0IGdwYTsKK307CisKICNlbmRpZiAvKiBfVUFQSV9fTElOVVhfS1ZN
SV9IICovCmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2
bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3Qu
YwppbmRleCA5NjdlYTU2OGQ5M2MuLmU5NjhiMWE2Zjk2OSAxMDA2NDQKLS0tIGEvdG9vbHMvdGVz
dGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYworKysgYi90b29scy90ZXN0aW5n
L3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCkBAIC0yMDQwLDYgKzIwNDAsMzUgQEAg
c3RhdGljIHZvaWQgdGVzdF9jbWRfdmNwdV9jb250cm9sX3NpbmdsZXN0ZXAoc3RydWN0IGt2bV92
bSAqdm0pCiAJCXRlc3RfdW5zdXBwb3J0ZWRfc2luZ2xlc3RlcCh2bSk7CiB9CiAKK3N0YXRpYyB2
b2lkIGNtZF90cmFuc2xhdGVfZ3ZhKHN0cnVjdCBrdm1fdm0gKnZtLCB2bV92YWRkcl90IGd2YSwK
KwkJCSAgICAgIHZtX3BhZGRyX3QgZXhwZWN0ZWRfZ3BhKQoreworCXN0cnVjdCB7CisJCXN0cnVj
dCBrdm1pX21zZ19oZHIgaGRyOworCQlzdHJ1Y3Qga3ZtaV92Y3B1X2hkciB2Y3B1X2hkcjsKKwkJ
c3RydWN0IGt2bWlfdmNwdV90cmFuc2xhdGVfZ3ZhIGNtZDsKKwl9IHJlcSA9IHsgMCB9OworCXN0
cnVjdCBrdm1pX3ZjcHVfdHJhbnNsYXRlX2d2YV9yZXBseSBycGw7CisKKwlyZXEuY21kLmd2YSA9
IGd2YTsKKworCXRlc3RfdmNwdTBfY29tbWFuZCh2bSwgS1ZNSV9WQ1BVX1RSQU5TTEFURV9HVkEs
ICZyZXEuaGRyLCBzaXplb2YocmVxKSwKKwkJCSAgJnJwbCwgc2l6ZW9mKHJwbCkpOworCVRFU1Rf
QVNTRVJUKHJwbC5ncGEgPT0gZXhwZWN0ZWRfZ3BhLAorCQkgICAgIlRyYW5zbGF0aW9uIGZhaWxl
ZCBmb3IgZ3ZhIDB4JWx4IC0+IGdwYSAweCVsbHggaW5zdGVhZCBvZiAweCVseFxuIiwKKwkJICAg
IGd2YSwgcnBsLmdwYSwgZXhwZWN0ZWRfZ3BhKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9jbWRf
dHJhbnNsYXRlX2d2YShzdHJ1Y3Qga3ZtX3ZtICp2bSkKK3sKKwljbWRfdHJhbnNsYXRlX2d2YSh2
bSwgdGVzdF9ndmEsIHRlc3RfZ3BhKTsKKwlwcl9pbmZvKCJUZXN0ZWQgZ3ZhIDB4JWx4IHRvIGdw
YSAweCVseFxuIiwgdGVzdF9ndmEsIHRlc3RfZ3BhKTsKKworCWNtZF90cmFuc2xhdGVfZ3ZhKHZt
LCAtMSwgfjApOworCXByX2luZm8oIlRlc3RlZCBndmEgMHglbHggdG8gZ3BhIDB4JWx4XG4iLAor
CQkodm1fdmFkZHJfdCktMSwgKHZtX3BhZGRyX3QpLTEpOworfQorCiBzdGF0aWMgdm9pZCB0ZXN0
X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAqdm0pCiB7CiAJc3JhbmRvbSh0aW1lKDApKTsK
QEAgLTIwNzUsNiArMjEwNCw3IEBAIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1
Y3Qga3ZtX3ZtICp2bSkKIAl0ZXN0X2NtZF92bV9zZXRfcGFnZV9hY2Nlc3Modm0pOwogCXRlc3Rf
ZXZlbnRfcGYodm0pOwogCXRlc3RfY21kX3ZjcHVfY29udHJvbF9zaW5nbGVzdGVwKHZtKTsKKwl0
ZXN0X2NtZF90cmFuc2xhdGVfZ3ZhKHZtKTsKIAogCXVuaG9va19pbnRyb3NwZWN0aW9uKHZtKTsK
IH0KZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCBiL3ZpcnQv
a3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaAppbmRleCBlNWZjYTM1MDJiYWIuLmNiODQ1M2Yw
ZmI4NyAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCisrKyBi
L3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaApAQCAtMTQxLDUgKzE0MSw2IEBAIHZv
aWQga3ZtaV9hcmNoX3VuaG9vayhzdHJ1Y3Qga3ZtICprdm0pOwogdm9pZCBrdm1pX2FyY2hfZmVh
dHVyZXMoc3RydWN0IGt2bWlfZmVhdHVyZXMgKmZlYXQpOwogYm9vbCBrdm1pX2FyY2hfc3RhcnRf
c2luZ2xlc3RlcChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwogYm9vbCBrdm1pX2FyY2hfc3RvcF9z
aW5nbGVzdGVwKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CitncGFfdCBrdm1pX2FyY2hfY21kX3Ry
YW5zbGF0ZV9ndmEoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBndmFfdCBndmEpOwogCiAjZW5kaWYK
ZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYyBiL3ZpcnQva3Zt
L2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwppbmRleCA2NDVkZWJjNDdmMTMuLmQ4ODc0YmQ3YThi
NyAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCisrKyBiL3Zp
cnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwpAQCAtNjQ3LDYgKzY0NywyMCBAQCBzdGF0
aWMgaW50IGhhbmRsZV92Y3B1X2NvbnRyb2xfc2luZ2xlc3RlcChjb25zdCBzdHJ1Y3Qga3ZtaV92
Y3B1X21zZ19qb2IgKmpvYiwKIAlyZXR1cm4ga3ZtaV9tc2dfdmNwdV9yZXBseShqb2IsIG1zZywg
ZWMsIE5VTEwsIDApOwogfQogCitzdGF0aWMgaW50IGhhbmRsZV92Y3B1X3RyYW5zbGF0ZV9ndmEo
Y29uc3Qgc3RydWN0IGt2bWlfdmNwdV9tc2dfam9iICpqb2IsCisJCQkJICAgICBjb25zdCBzdHJ1
Y3Qga3ZtaV9tc2dfaGRyICptc2csCisJCQkJICAgICBjb25zdCB2b2lkICpfcmVxKQoreworCWNv
bnN0IHN0cnVjdCBrdm1pX3ZjcHVfdHJhbnNsYXRlX2d2YSAqcmVxID0gX3JlcTsKKwlzdHJ1Y3Qg
a3ZtaV92Y3B1X3RyYW5zbGF0ZV9ndmFfcmVwbHkgcnBsOworCisJbWVtc2V0KCZycGwsIDAsIHNp
emVvZihycGwpKTsKKworCXJwbC5ncGEgPSBrdm1pX2FyY2hfY21kX3RyYW5zbGF0ZV9ndmEoam9i
LT52Y3B1LCByZXEtPmd2YSk7CisKKwlyZXR1cm4ga3ZtaV9tc2dfdmNwdV9yZXBseShqb2IsIG1z
ZywgMCwgJnJwbCwgc2l6ZW9mKHJwbCkpOworfQorCiAvKgogICogVGhlc2UgZnVuY3Rpb25zIGFy
ZSBleGVjdXRlZCBmcm9tIHRoZSB2Q1BVIHRocmVhZC4gVGhlIHJlY2VpdmluZyB0aHJlYWQKICAq
IHBhc3NlcyB0aGUgbWVzc2FnZXMgdXNpbmcgYSBuZXdseSBhbGxvY2F0ZWQgJ3N0cnVjdCBrdm1p
X3ZjcHVfbXNnX2pvYicKQEAgLTY2OSw2ICs2ODMsNyBAQCBzdGF0aWMgaW50KCpjb25zdCBtc2df
dmNwdVtdKShjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X21zZ19qb2IgKiwKIAlbS1ZNSV9WQ1BVX0lO
SkVDVF9FWENFUFRJT05dICAgPSBoYW5kbGVfdmNwdV9pbmplY3RfZXhjZXB0aW9uLAogCVtLVk1J
X1ZDUFVfU0VUX1JFR0lTVEVSU10gICAgICA9IGhhbmRsZV92Y3B1X3NldF9yZWdpc3RlcnMsCiAJ
W0tWTUlfVkNQVV9TRVRfWFNBVkVdICAgICAgICAgID0gaGFuZGxlX3ZjcHVfc2V0X3hzYXZlLAor
CVtLVk1JX1ZDUFVfVFJBTlNMQVRFX0dWQV0gICAgICA9IGhhbmRsZV92Y3B1X3RyYW5zbGF0ZV9n
dmEsCiB9OwogCiBzdGF0aWMgYm9vbCBpc192Y3B1X2NvbW1hbmQodTE2IGlkKQpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWls
aW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6
Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRp
b24=
