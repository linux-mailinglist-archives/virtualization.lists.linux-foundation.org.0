Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [IPv6:2605:bc80:3010::136])
	by mail.lfdr.de (Postfix) with ESMTPS id 9CF0C6E2386
	for <lists.virtualization@lfdr.de>; Fri, 14 Apr 2023 14:39:34 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id E6AA36FF46;
	Fri, 14 Apr 2023 12:39:32 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org E6AA36FF46
Authentication-Results: smtp3.osuosl.org;
	dkim=fail reason="signature verification failed" (2048-bit key) header.d=igel-co-jp.20221208.gappssmtp.com header.i=@igel-co-jp.20221208.gappssmtp.com header.a=rsa-sha256 header.s=20221208 header.b=MWd39ynI
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id XkLYpcY4cEjr; Fri, 14 Apr 2023 12:39:31 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp3.osuosl.org (Postfix) with ESMTPS id 31DC46FF51;
	Fri, 14 Apr 2023 12:39:31 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 31DC46FF51
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 81827C002A;
	Fri, 14 Apr 2023 12:39:30 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [IPv6:2605:bc80:3010::133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 80401C002A
 for <virtualization@lists.linux-foundation.org>;
 Fri, 14 Apr 2023 12:39:28 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id 4E91642B11
 for <virtualization@lists.linux-foundation.org>;
 Fri, 14 Apr 2023 12:39:28 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org 4E91642B11
Authentication-Results: smtp2.osuosl.org;
 dkim=pass (2048-bit key) header.d=igel-co-jp.20221208.gappssmtp.com
 header.i=@igel-co-jp.20221208.gappssmtp.com header.a=rsa-sha256
 header.s=20221208 header.b=MWd39ynI
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 70M9RlA14qVP
 for <virtualization@lists.linux-foundation.org>;
 Fri, 14 Apr 2023 12:39:27 +0000 (UTC)
X-Greylist: whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org 06A8040439
Received: from mail-pj1-x102a.google.com (mail-pj1-x102a.google.com
 [IPv6:2607:f8b0:4864:20::102a])
 by smtp2.osuosl.org (Postfix) with ESMTPS id 06A8040439
 for <virtualization@lists.linux-foundation.org>;
 Fri, 14 Apr 2023 12:39:26 +0000 (UTC)
Received: by mail-pj1-x102a.google.com with SMTP id
 h24-20020a17090a9c1800b002404be7920aso18496031pjp.5
 for <virtualization@lists.linux-foundation.org>;
 Fri, 14 Apr 2023 05:39:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=igel-co-jp.20221208.gappssmtp.com; s=20221208; t=1681475966; x=1684067966;
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:from:to:cc:subject:date
 :message-id:reply-to;
 bh=/bZUOCFJCwCTXEmIix5ExPWra6yq8PYVXPbuX/TUPYk=;
 b=MWd39ynIJViiyKLNZn7EmzvAfFb5U2QYe7bxTITH6C0UqB4h0+hQOioJcUMB5sXmdJ
 T+0pxHnd5pF8+ZGgmMjFnmacv5+Sqbjyi+doh5eUfIXYXgHceY5LXPU4PZLz6kZTkj4/
 Sk4f6jvOpziowEWlOzaCrm+flcJG9VblgAPwa3wu51aWiPxxBdyioxBEueuk70Vq1XOB
 tfgKhzc5a7T66KLw7BIOIH6nZj/oTzuveSJ74OE9h+5FEffp4M5jZuqqeIl/An8leEej
 0hEu6KmRhV/4fzsRccGZyASLI4BSogF7Jhm2d+uGh4lXHOLgTibth7oDERYhVXMknPwb
 AoUA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20221208; t=1681475966; x=1684067966;
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=/bZUOCFJCwCTXEmIix5ExPWra6yq8PYVXPbuX/TUPYk=;
 b=IFf9L7YrMmKKswXtt80Sob95mBSkWXbKGWTSo4CO8JYj10z9ZIa8NAnJKQtnKiLg1N
 wzpnRwaPBlTK+vh3vGubXqhukpxbgxy/oyC2dW1OjAUSf+w8s68lmg7HXSkFjlib3TiM
 YMPX4Rn+aFtG3EfPv55Gm8DNFkTYqi1RU6KaxtpVMapKjvFqJrkaXuIhDQW0h8OA0HWX
 om9K5XYsJH2HbdvXDcKx/g6GJ58UpjLWS1BFlDDpZpA7zxHNtr9krhs3OTb2CYFlN2kQ
 5EmOXtG2dkRGHz7FriSST93/MRcxVZBDbsoDzUfy/1PNQrB1ERo0TEXLfTn4ELsebtZe
 6t4g==
X-Gm-Message-State: AAQBX9dcfb2IzTt+AEA7xjTzR7e4AouYLurGQ88rZNqaeMzn9EkvTC5N
 1q2jc7P1UZDJ5uTWrrMrNheRjg==
X-Google-Smtp-Source: AKy350ak1/UH0qD0KBNwE0XAaWFqrzYdc0/21yPnYwvrMkNXVZpN7ZN3WtHAXMZqRGKGPlGPgDKswA==
X-Received: by 2002:a17:902:b18c:b0:19f:2ae8:54b9 with SMTP id
 s12-20020a170902b18c00b0019f2ae854b9mr2159184plr.32.1681475966341; 
 Fri, 14 Apr 2023 05:39:26 -0700 (PDT)
Received: from tyrell.hq.igel.co.jp (napt.igel.co.jp. [219.106.231.132])
 by smtp.gmail.com with ESMTPSA id
 v21-20020a1709028d9500b001a527761c31sm3015366plo.79.2023.04.14.05.39.22
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 14 Apr 2023 05:39:25 -0700 (PDT)
From: Shunsuke Mie <mie@igel.co.jp>
To: Lorenzo Pieralisi <lpieralisi@kernel.org>
Subject: [RFC PATCH 3/3] PCI: endpoint: Add EP function driver to provide
 virtio-console functionality
Date: Fri, 14 Apr 2023 21:39:03 +0900
Message-Id: <20230414123903.896914-4-mie@igel.co.jp>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20230414123903.896914-1-mie@igel.co.jp>
References: <20230414123903.896914-1-mie@igel.co.jp>
MIME-Version: 1.0
Cc: Kishon Vijay Abraham I <kishon@kernel.org>,
 =?UTF-8?q?Krzysztof=20Wilczy=C5=84ski?= <kw@linux.com>,
 Randy Dunlap <rdunlap@infradead.org>, "Michael S. Tsirkin" <mst@redhat.com>,
 linux-pci@vger.kernel.org, Manivannan Sadhasivam <mani@kernel.org>,
 Frank Li <Frank.Li@nxp.com>, linux-kernel@vger.kernel.org,
 virtualization@lists.linux-foundation.org, Ren Zhijie <renzhijie2@huawei.com>,
 Shunsuke Mie <mie@igel.co.jp>, Jon Mason <jdmason@kudzu.us>,
 Bjorn Helgaas <bhelgaas@google.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

QWRkIGEgbmV3IFBDSWUgZW5kcG9pbnQgZnVuY3Rpb24gZHJpdmVyIHRoYXQgd29ya3MgYXMgYSBw
Y2kgdmlydGlvLWNvbnNvbGUKZGV2aWNlLiBUaGUgY29uc29sZSBjb25uZWN0IHRvIGVuZHBvaW50
IHNpZGUgY29uc29sZS4gSXQgZW5hYmxlcyB0bwpjb21tdW5pY2F0ZSBQQ0llIGhvc3QgYW5kIGVu
ZHBvaW50LgoKQXJjaGl0ZWN0dXJlIGlzIGZvbGxvd2luZzoKCiDilIzilIDilIDilIDilIDilIDi
lIDilIDilIDilIDilIDilIDilIDilJAgICAgICAgICDilIzilIDilIDilIDilIDilIDilIDilIDi
lIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilKzilIDilIDilIDi
lIDilIDilIDilIDilIDilIDilIDilIDilIDilJAKIOKUgnZpcnRpb2UgICAgIOKUgiAgICAgICAg
IOKUgiAgICAgICAgICAgICAgICAgICAgICDilIJ2aXJ0aW8gICAgICDilIIKIOKUgmNvbnNvbGUg
ZHJ2IOKUgiAgICAgICAgIOKUnOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKU
gOKUgOKUgOKUkCAgICAgIOKUgmNvbnNvbGUgZHJ2IOKUggog4pSc4pSA4pSA4pSA4pSA4pSA4pSA
4pSA4pSA4pSA4pSA4pSA4pSA4pSkICAgICAgICAg4pSCKHZpcnRpbyBjb25zb2xl4pSCICAgICAg
4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSkCiDilIIgdmlydGlvIGJ1
cyDilIIgICAgICAgICDilIIgZGV2aWNlKSAgICAgICDilILil4TilIDilIDilIDilIDilrrilIIg
dmlydGlvIGJ1cyDilIIKIOKUnOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKU
pCAgICAgICAgIOKUnC0tLS0tLS0tLS0tLS0tLeKUpCAgICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKU
gOKUgOKUgOKUgOKUgOKUgOKUgOKUpAog4pSCICAgICAgICAgICAg4pSCICAgICAgICAg4pSCIHBj
aSBlcCB2aXJ0aW8g4pSCICAgICAgICAgICAgICAgICAgIOKUggog4pSCICBwY2kgYnVzICAg4pSC
ICAgICAgICAg4pSCICBjb25zb2xlIGRydiAg4pSCICAgICAgICAgICAgICAgICAgIOKUggog4pSC
ICAgICAgICAgICAg4pSCICBwY2llICAg4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA
4pSA4pSA4pSA4pSA4pSA4pSkICAgICAgICAgICAgICAgICAgIOKUggog4pSCICAgICAgICAgICAg
4pSCIOKXhOKUgOKUgOKUgOKUgOKUgOKWuiDilIIgIHBjaSBlcCBCdXMgICDilIIgICAgICAgICAg
ICAgICAgICAg4pSCCiDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJgg
ICAgICAgICDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDi
lLTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDi
lIDilJgKICAgUENJZSBSb290ICAgICAgICAgICAgICBQQ0llIEVuZHBvaW50CgpUaGlzIGRyaXZl
ciBoYXMgdHdvIHJvbGVzLiBUaGUgZmlyc3QgaXMgYXMgYSBQQ0llIGVuZHBvaW50IHZpcnRpbyBj
b25zb2xlCmZ1bmN0aW9uLCB3aGljaCBpcyBpbXBsZW1lbnRlZCB1c2luZyB0aGUgUENJZSBlbmRw
b2ludCBmcmFtZXdvcmsgYW5kIFBDSWUKRVAgdmlydGlvIGhlbHBlcnMuIFRoZSBzZWNvbmQgaXMg
YXMgYSB2aXJ0dWFsIHZpcnRpbyBjb25zb2xlIGRldmljZQpjb25uZWN0ZWQgdG8gdGhlIHZpcnRp
byBidXMgb24gUENJZSBlbmRwb2ludCBMaW51eC4KCkNvbW11bmljYXRpb24gYmV0d2VlbiB0aGUg
dHdvIGlzIGFjaGlldmVkIGJ5IGNvcHlpbmcgdGhlIHZpcnRxdWV1ZSBkYXRhCmJldHdlZW4gUENJ
ZSByb290IGFuZCBlbmRwb2ludCwgcmVzcGVjdGl2ZWx5LgoKVGhpcyBpcyBhIHNpbXBsZSBpbXBs
ZW1lbnRhdGlvbiBhbmQgZG9lcyBub3QgaW5jbHVkZSBmZWF0dXJlcyBvZgp2aXJ0aW8tY29uc29s
ZSBzdWNoIGFzIE1VTFRJUE9SVCwgRU1FUkdfV1JJVEUsIGV0Yy4gQXMgYSByZXN1bHQsIGVhY2gK
dmlydGlvIGNvbnNvbGUgZHJpdmVyIG9ubHkgZGlzcGxheXMgL2Rldi9odmMwLgoKQXMgYW4gZXhh
bXBsZSBvZiB1c2FnZSwgYnkgc2V0dGluZyBnZXR0eSB0byAvZGV2L2h2YzAsIGl0IGlzIHBvc3Np
YmxlIHRvCmxvZ2luIHRvIGFub3RoZXIgaG9zdC4KClNpZ25lZC1vZmYtYnk6IFNodW5zdWtlIE1p
ZSA8bWllQGlnZWwuY28uanA+Ci0tLQogZHJpdmVycy9wY2kvZW5kcG9pbnQvZnVuY3Rpb25zL0tj
b25maWcgICAgICAgIHwgIDEyICsKIGRyaXZlcnMvcGNpL2VuZHBvaW50L2Z1bmN0aW9ucy9NYWtl
ZmlsZSAgICAgICB8ICAgMSArCiBkcml2ZXJzL3BjaS9lbmRwb2ludC9mdW5jdGlvbnMvcGNpLWVw
Zi12Y29uLmMgfCA1NTQgKysrKysrKysrKysrKysrKysrCiAzIGZpbGVzIGNoYW5nZWQsIDU2NyBp
bnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9wY2kvZW5kcG9pbnQvZnVu
Y3Rpb25zL3BjaS1lcGYtdmNvbi5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9wY2kvZW5kcG9pbnQv
ZnVuY3Rpb25zL0tjb25maWcgYi9kcml2ZXJzL3BjaS9lbmRwb2ludC9mdW5jdGlvbnMvS2NvbmZp
ZwppbmRleCBjZjE2ZDMzYzk1ODUuLjg5MGUwN2I1MWNiZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9w
Y2kvZW5kcG9pbnQvZnVuY3Rpb25zL0tjb25maWcKKysrIGIvZHJpdmVycy9wY2kvZW5kcG9pbnQv
ZnVuY3Rpb25zL0tjb25maWcKQEAgLTQ0LDMgKzQ0LDE1IEBAIGNvbmZpZyBQQ0lfRVBGX1ZJUlRJ
TwogCXNlbGVjdCBWSE9TVF9JT01FTQogCWhlbHAKIAkgIEhlbHBlcnMgdG8gaW1wbGVtZW50IFBD
SSB2aXJ0aW8gRW5kcG9pbnQgZnVuY3Rpb24KKworY29uZmlnIFBDSV9FUEZfVkNPTgorCXRyaXN0
YXRlICJQQ0kgRW5kcG9pbnQgdmlyaXRvLWNvbnNvbGUgZHJpdmVyIgorCWRlcGVuZHMgb24gUENJ
X0VORFBPSU5UCisJc2VsZWN0IFZIT1NUX1JJTkcKKwlzZWxlY3QgUENJX0VQRl9WSVJUSU8KKwlo
ZWxwCisJICBQQ0llIEVuZHBvaW50IHZpcnRpby1jb25zb2xlIGZ1bmN0aW9uIGltcGxlbWVudGF0
aW5vLiBUaGlzIG1vZHVsZQorCSAgZW5hYmxlcyB0byBzaG93IHRoZSB2aXJ0aW8tY29uc29sZSBh
cyBwY2kgZGV2aWNlIHRvIFBDSWUgaG9zdCBzaWRlLCBhbmQKKwkgIGFub3RoZXIgdmlydHVhbCB2
aXJ0aW8tY29uc29sZSBkZXZpY2UgcmVnaXN0ZXJzIHRvIGVuZHBvaW50IHN5c3RlbS4KKwkgIFRo
b3NlIGRldmljZXMgYXJlIGNvbm5lY3RlZCB2aXJ0dWFsbHkgYW5kIGNhbiBjb21tdW5pY2F0ZSBl
YWNoIG90aGVyLgorCmRpZmYgLS1naXQgYS9kcml2ZXJzL3BjaS9lbmRwb2ludC9mdW5jdGlvbnMv
TWFrZWZpbGUgYi9kcml2ZXJzL3BjaS9lbmRwb2ludC9mdW5jdGlvbnMvTWFrZWZpbGUKaW5kZXgg
YTk2ZjEyN2NlOTAwLi5iNDA1NjY4OWNlMzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvcGNpL2VuZHBv
aW50L2Z1bmN0aW9ucy9NYWtlZmlsZQorKysgYi9kcml2ZXJzL3BjaS9lbmRwb2ludC9mdW5jdGlv
bnMvTWFrZWZpbGUKQEAgLTcsMyArNyw0IEBAIG9iai0kKENPTkZJR19QQ0lfRVBGX1RFU1QpCQkr
PSBwY2ktZXBmLXRlc3Qubwogb2JqLSQoQ09ORklHX1BDSV9FUEZfTlRCKQkJKz0gcGNpLWVwZi1u
dGIubwogb2JqLSQoQ09ORklHX1BDSV9FUEZfVk5UQikgCQkrPSBwY2ktZXBmLXZudGIubwogb2Jq
LSQoQ09ORklHX1BDSV9FUEZfVklSVElPKQkJKz0gcGNpLWVwZi12aXJ0aW8ubworb2JqLSQoQ09O
RklHX1BDSV9FUEZfVkNPTikJCSs9IHBjaS1lcGYtdmNvbi5vCmRpZmYgLS1naXQgYS9kcml2ZXJz
L3BjaS9lbmRwb2ludC9mdW5jdGlvbnMvcGNpLWVwZi12Y29uLmMgYi9kcml2ZXJzL3BjaS9lbmRw
b2ludC9mdW5jdGlvbnMvcGNpLWVwZi12Y29uLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MDAwMDAwMDAwMDAwLi4zOTUzODEzM2UzOWQKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL3Bj
aS9lbmRwb2ludC9mdW5jdGlvbnMvcGNpLWVwZi12Y29uLmMKQEAgLTAsMCArMSw1NTQgQEAKKy8v
IFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogUENJIEVuZHBvaW50IGZ1
bmN0aW9uIGRyaXZlciB0byBpbXBsaW1lbnQgdmlydGlvLWNvbnNvbGUgZGV2aWNlCisgKiBmdW5j
dGlvbmFsaXR5LgorICovCisjaW5jbHVkZSA8bGludXgvcGNpLWVwZi5oPgorI2luY2x1ZGUgPGxp
bnV4L3ZpcnRpb19pZHMuaD4KKyNpbmNsdWRlIDxsaW51eC92aXJ0aW9fcGNpLmg+CisjaW5jbHVk
ZSA8bGludXgvdmlydGlvX2NvbnNvbGUuaD4KKyNpbmNsdWRlIDxsaW51eC92aXJ0aW9fcmluZy5o
PgorCisjaW5jbHVkZSAicGNpLWVwZi12aXJ0aW8uaCIKKworc3RhdGljIGludCB2aXJ0aW9fcXVl
dWVfc2l6ZSA9IDB4MTAwOworbW9kdWxlX3BhcmFtKHZpcnRpb19xdWV1ZV9zaXplLCBpbnQsIDA0
NDQpOworTU9EVUxFX1BBUk1fREVTQyh2aXJ0aW9fcXVldWVfc2l6ZSwgIkEgbGVuZ3RoIG9mIHZp
cnRxdWV1ZSIpOworCitzdHJ1Y3QgZXBmX3Zjb24geworCS8qIFRvIGFjY2VzcyB2aXJ0cXVldWVz
IG9uIHJlbW90ZSBob3N0ICovCisJc3RydWN0IGVwZl92aXJ0aW8gZXZpbzsKKwlzdHJ1Y3QgdnJp
bmdoX2tpb3YgKnJkZXZfaW92czsKKworCS8qIFRvIHJlZ2lzdGVyIGEgbG9jYWwgdmlydGlvIGJ1
cyAqLworCXN0cnVjdCB2aXJ0aW9fZGV2aWNlIHZkZXY7CisKKwkvKiBUbyBhY2Nlc3MgdmlydHF1
ZXVzIG9mIGxvY2FsIGhvc3QgZHJpdmVyICovCisJc3RydWN0IHZyaW5naCAqdmRldl92cmhzOwor
CXN0cnVjdCB2cmluZ2hfa2lvdiAqdmRldl9pb3ZzOworCXN0cnVjdCB2aXJ0cXVldWUgKip2ZGV2
X3ZxczsKKworCS8qIEZvciB0cmFuc3BvcnRhdGlvbiBhbmQgbm90aWZpY2F0aW9uICovCisJc3Ry
dWN0IHdvcmtxdWV1ZV9zdHJ1Y3QgKnRhc2tfd3E7CisJc3RydWN0IHdvcmtfc3RydWN0IHJhaXNl
X2lycV93b3JrLCByeF93b3JrLCB0eF93b3JrOworCisJLyogVG8gcmV0YWluIHZpcnRpbyBmZWF0
dXJlcy4gSXQgaXMgY29tbW9ubHkgdXNlZCBsb2NhbCBhbmQgcmVtb3RlLiAqLworCXU2NCBmZWF0
dXJlczsKKworCS8qIFRvIHNob3cgYSBzdGF0dXMgd2hldGhlciB0aGlzIGRyaXZlciBpcyByZWFk
eSBhbmQgdGhlIHJlbW90ZSBpcyBjb25uZWN0ZWQgKi8KKwlib29sIGNvbm5lY3RlZDsKK307CisK
K2VudW0geworCVZDT05fVklSVFFVRVVFX1JYLAorCVZDT05fVklSVFFVRVVFX1RYLAorfTsKKwor
c3RhdGljIHN0cnVjdCBlcGZfdmNvbiAqdmRldl90b192Y29uKHN0cnVjdCB2aXJ0aW9fZGV2aWNl
ICp2ZGV2KQoreworCXJldHVybiBjb250YWluZXJfb2YodmRldiwgc3RydWN0IGVwZl92Y29uLCB2
ZGV2KTsKK30KKworc3RhdGljIHVuc2lnbmVkIGludCBlcGZfdmNvbl9nZXRfbnZxKHN0cnVjdCBl
cGZfdmNvbiAqdmNvbikKK3sKKwkvKiBUaGlzIGlzIGEgbWluaW11bSBpbXBsZW1lbnRhdGlvbi4g
RG9lc24ndCBzdXBwb3J0IGFueSBmZWF0dXJlcyBvZgorCSAqIHZpcnRpbyBjb25zb2xlLiBJdCBt
ZWFucyBkcml2ZXIgYW5kIGRldmljZSB1c2UganVzdCAyIHZpcnR1cXVlIGZvciB0eAorCSAqIGFu
ZCByeC4KKwkgKi8KKwlyZXR1cm4gMjsKK30KKworc3RhdGljIHZvaWQgZXBmX3Zjb25fcnhfaGFu
ZGxlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCit7CisJc3RydWN0IGVwZl92Y29uICp2Y29u
ID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBlcGZfdmNvbiwgcnhfd29yayk7CisJc3RydWN0
IGVwZl92aXJ0aW8gKmV2aW8gPSAmdmNvbi0+ZXZpbzsKKwlzdHJ1Y3QgdnJpbmdoICpzdnJoLCAq
ZHZyaDsKKwlzdHJ1Y3QgdnJpbmdoX2tpb3YgKnNpb3YsICpkaW92OworCWludCByZXQ7CisKKwlp
ZiAodW5saWtlbHkoIXZjb24tPmNvbm5lY3RlZCkpCisJCXJldHVybjsKKworCXN2cmggPSAmZXZp
by0+dnJoc1tWQ09OX1ZJUlRRVUVVRV9UWF0tPnZyaDsKKwlkdnJoID0gJnZjb24tPnZkZXZfdnJo
c1tWQ09OX1ZJUlRRVUVVRV9SWF07CisJc2lvdiA9ICZ2Y29uLT5yZGV2X2lvdnNbVkNPTl9WSVJU
UVVFVUVfVFhdOworCWRpb3YgPSAmdmNvbi0+dmRldl9pb3ZzW1ZDT05fVklSVFFVRVVFX1JYXTsK
KworCWRvIHsKKwkJcmV0ID0gZXBmX3ZpcnRpb192cmhfbWVtY3B5KGV2aW8sIHN2cmgsIHNpb3Ys
IGR2cmgsIGRpb3YsCisJCQkJCSAgICBFUEZfVklSVElPX0NPUFlfRElSX0ZST01fREVWKTsKKwkJ
aWYgKHVubGlrZWx5KHJldCA8IDApKQorCQkJcHJfZXJyKCJmYWlsZWQgdG8gY29weSBkZXNjIG9u
IHZpcnRxdWV1ZSBmb3IgcnhcbiIpOworCX0gd2hpbGUgKHJldCA+IDApOworCisJdnJpbmdfaW50
ZXJydXB0KDAsIHZjb24tPnZkZXZfdnFzW1ZDT05fVklSVFFVRVVFX1JYXSk7Cit9CisKK3N0YXRp
YyB2b2lkIGVwZl92Y29uX3R4X2hhbmRsZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQorewor
CXN0cnVjdCBlcGZfdmNvbiAqdmNvbiA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZXBmX3Zj
b24sIHR4X3dvcmspOworCXN0cnVjdCBlcGZfdmlydGlvICpldmlvID0gJnZjb24tPmV2aW87CisJ
c3RydWN0IHZyaW5naCAqc3ZyaCwgKmR2cmg7CisJc3RydWN0IHZyaW5naF9raW92ICpzaW92LCAq
ZGlvdjsKKwlpbnQgcmV0OworCisJaWYgKHVubGlrZWx5KCF2Y29uLT5jb25uZWN0ZWQpKQorCQly
ZXR1cm47CisKKwlzdnJoID0gJnZjb24tPnZkZXZfdnJoc1tWQ09OX1ZJUlRRVUVVRV9UWF07CisJ
ZHZyaCA9ICZldmlvLT52cmhzW1ZDT05fVklSVFFVRVVFX1JYXS0+dnJoOworCXNpb3YgPSAmdmNv
bi0+dmRldl9pb3ZzW1ZDT05fVklSVFFVRVVFX1RYXTsKKwlkaW92ID0gJnZjb24tPnJkZXZfaW92
c1tWQ09OX1ZJUlRRVUVVRV9SWF07CisKKwlkbyB7CisJCXJldCA9IGVwZl92aXJ0aW9fdnJoX21l
bWNweShldmlvLCBzdnJoLCBzaW92LCBkdnJoLCBkaW92LAorCQkJCQkgICAgRVBGX1ZJUlRJT19D
T1BZX0RJUl9UT19ERVYpOworCQlpZiAodW5saWtlbHkocmV0IDwgMCkpCisJCQlwcl9lcnIoImZh
aWxlZCB0byBjb3B5IGRlc2Mgb24gdmlydHF1ZXVlIGZvciB0eFxuIik7CisJfSB3aGlsZSAocmV0
ID4gMCk7CisKKwlxdWV1ZV93b3JrKHZjb24tPnRhc2tfd3EsICZ2Y29uLT5yYWlzZV9pcnFfd29y
ayk7Cit9CisKK3N0YXRpYyB2b2lkIGVwZl92Y29uX3JhaXNlX2lycV9oYW5kbGVyKHN0cnVjdCB3
b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgZXBmX3Zjb24gKnZjb24gPQorCQljb250YWlu
ZXJfb2Yod29yaywgc3RydWN0IGVwZl92Y29uLCByYWlzZV9pcnFfd29yayk7CisJc3RydWN0IHBj
aV9lcGYgKmVwZiA9IHZjb24tPmV2aW8uZXBmOworCisJcGNpX2VwY19yYWlzZV9pcnEoZXBmLT5l
cGMsIGVwZi0+ZnVuY19ubywgZXBmLT52ZnVuY19ubywKKwkJCSAgUENJX0VQQ19JUlFfTEVHQUNZ
LCAwKTsKK30KKworc3RhdGljIGludCBlcGZfdmNvbl9zZXR1cF9jb21tb24oc3RydWN0IGVwZl92
Y29uICp2Y29uKQoreworCXZjb24tPmZlYXR1cmVzID0gMDsKKwl2Y29uLT5jb25uZWN0ZWQgPSBm
YWxzZTsKKworCXZjb24tPnRhc2tfd3EgPQorCQlhbGxvY193b3JrcXVldWUoInBjaS1lcGYtdmNv
bi90YXNrLXdxIiwKKwkJCQlXUV9NRU1fUkVDTEFJTSB8IFdRX0hJR0hQUkkgfCBXUV9VTkJPVU5E
LCAwKTsKKwlpZiAoIXZjb24tPnRhc2tfd3EpCisJCXJldHVybiAtRU5PTUVNOworCisJSU5JVF9X
T1JLKCZ2Y29uLT5yeF93b3JrLCBlcGZfdmNvbl9yeF9oYW5kbGVyKTsKKwlJTklUX1dPUksoJnZj
b24tPnR4X3dvcmssIGVwZl92Y29uX3R4X2hhbmRsZXIpOworCUlOSVRfV09SSygmdmNvbi0+cmFp
c2VfaXJxX3dvcmssIGVwZl92Y29uX3JhaXNlX2lycV9oYW5kbGVyKTsKKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgdm9pZCBlcGZfdmNvbl9jbGVhbnVwX2NvbW1vbihzdHJ1Y3QgZXBmX3Zjb24g
KnZjb24pCit7CisJLyogU2hvdWxkIGRvIGZpcnN0IHRvIHN0b3AgcG9sbGluZyBpbiBvdGhlciBr
ZXJuZWwgdGhyZWFkICovCisJdmNvbi0+Y29ubmVjdGVkID0gZmFsc2U7CisKKwlmbHVzaF93b3Jr
KCZ2Y29uLT5yYWlzZV9pcnFfd29yayk7CisJZmx1c2hfd29yaygmdmNvbi0+dHhfd29yayk7CisJ
Zmx1c2hfd29yaygmdmNvbi0+cnhfd29yayk7CisKKwlkZXN0cm95X3dvcmtxdWV1ZSh2Y29uLT50
YXNrX3dxKTsKK30KKworc3RhdGljIHZvaWQgZXBmX3Zjb25fcW5vdGlmeV9jYWxsYmFjayh2b2lk
ICpwYXJhbSkKK3sKKwlzdHJ1Y3QgZXBmX3Zjb24gKnZjb24gPSBwYXJhbTsKKworCXF1ZXVlX3dv
cmsodmNvbi0+dGFza193cSwgJnZjb24tPnJ4X3dvcmspOworfQorCitzdGF0aWMgdm9pZCBlcGZf
dmNvbl9pbml0aWFsaXplX2NvbXBsZXRlKHZvaWQgKnBhcmFtKQoreworCXN0cnVjdCBlcGZfdmNv
biAqdmNvbiA9IHBhcmFtOworCisJcHJfZGVidWcoIlJlbW90ZSBob3N0IGhhcyBjb25uZWN0ZWRc
biIpOworCisJdmNvbi0+Y29ubmVjdGVkID0gdHJ1ZTsKKworCS8qIHNlbmQgZmlsbGVkIGJ1ZmZl
ciAqLworCXF1ZXVlX3dvcmsodmNvbi0+dGFza193cSwgJnZjb24tPnR4X3dvcmspOworfQorCitz
dGF0aWMgc3RydWN0IHBjaV9lcGZfaGVhZGVyIGVwZl92Y29uX3BjaV9oZWFkZXIgPSB7CisJLnZl
bmRvcmlkID0gUENJX1ZFTkRPUl9JRF9SRURIQVRfUVVNUkFORVQsCisJLmRldmljZWlkID0gVklS
VElPX1RSQU5TX0lEX0NPTlNPTEUsCisJLnN1YnN5c192ZW5kb3JfaWQgPSBQQ0lfVkVORE9SX0lE
X1JFREhBVF9RVU1SQU5FVCwKKwkuc3Vic3lzX2lkID0gVklSVElPX0lEX0NPTlNPTEUsCisJLnJl
dmlkID0gMCwKKwkuYmFzZWNsYXNzX2NvZGUgPSBQQ0lfQkFTRV9DTEFTU19DT01NVU5JQ0FUSU9O
LAorCS5pbnRlcnJ1cHRfcGluID0gUENJX0lOVEVSUlVQVF9QSU4sCit9OworCitzdGF0aWMgaW50
IGVwZl92Y29uX3NldHVwX2VwX2Z1bmMoc3RydWN0IGVwZl92Y29uICp2Y29uLCBzdHJ1Y3QgcGNp
X2VwZiAqZXBmKQoreworCWludCBlcnI7CisJc3RydWN0IGVwZl92aXJ0aW8gKmV2aW8gPSAmdmNv
bi0+ZXZpbzsKKwl1bnNpZ25lZCBpbnQgbnZxID0gZXBmX3Zjb25fZ2V0X252cSh2Y29uKTsKKwor
CXZjb24tPnJkZXZfaW92cyA9CisJCWttYWxsb2NfYXJyYXkobnZxLCBzaXplb2YodmNvbi0+cmRl
dl9pb3ZzWzBdKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCF2Y29uLT5yZGV2X2lvdnMpCisJCXJldHVy
biAtRU5PTUVNOworCisJZm9yIChpbnQgaSA9IDA7IGkgPCBudnE7IGkrKykKKwkJdnJpbmdoX2tp
b3ZfaW5pdCgmdmNvbi0+cmRldl9pb3ZzW2ldLCBOVUxMLCAwKTsKKworCWV2aW8tPmVwZiA9IGVw
ZjsKKwlldmlvLT5mZWF0dXJlcyA9IHZjb24tPmZlYXR1cmVzOworCWV2aW8tPm52cSA9IG52cTsK
KwlldmlvLT52cWxlbiA9IHZpcnRpb19xdWV1ZV9zaXplOworCisJZXZpby0+cW5fY2FsbGJhY2sg
PSBlcGZfdmNvbl9xbm90aWZ5X2NhbGxiYWNrOworCWV2aW8tPnFuX3BhcmFtID0gdmNvbjsKKwor
CWV2aW8tPmljX2NhbGxiYWNrID0gZXBmX3Zjb25faW5pdGlhbGl6ZV9jb21wbGV0ZTsKKwlldmlv
LT5pY19wYXJhbSA9IHZjb247CisKKwllcnIgPSBlcGZfdmlydGlvX2luaXQoZXZpbywgJmVwZl92
Y29uX3BjaV9oZWFkZXIsIDApOworCWlmIChlcnIpCisJCWdvdG8gZXJyX2NsZWFudXBfa2lvdjsK
KworCWVyciA9IGVwZl92aXJ0aW9fbGF1bmNoX2JndGFzayhldmlvKTsKKwlpZiAoZXJyKQorCQln
b3RvIGVycl92aXJ0aW9fZmluYWw7CisKKwlyZXR1cm4gMDsKKworZXJyX3ZpcnRpb19maW5hbDoK
KwllcGZfdmlydGlvX2ZpbmFsKGV2aW8pOworCitlcnJfY2xlYW51cF9raW92OgorCWZvciAoaW50
IGkgPSAwOyBpIDwgbnZxOyBpKyspCisJCXZyaW5naF9raW92X2NsZWFudXAoJnZjb24tPnJkZXZf
aW92c1tpXSk7CisKKwlrZnJlZSh2Y29uLT5yZGV2X2lvdnMpOworCisJcmV0dXJuIGVycjsKK30K
Kworc3RhdGljIHZvaWQgZXBmX3Zjb25fY2xlYW51cF9lcF9mdW5jKHN0cnVjdCBlcGZfdmNvbiAq
dmNvbikKK3sKKwllcGZfdmlydGlvX3Rlcm1pbmF0ZV9iZ3Rhc2soJnZjb24tPmV2aW8pOworCisJ
ZXBmX3ZpcnRpb19maW5hbCgmdmNvbi0+ZXZpbyk7CisKKwlrZnJlZSh2Y29uLT5yZGV2X2lvdnMp
OworfQorCisvKgorICogRnVuY3Rpb25zIGZvciBsb2NhbCB2aXJ0aW8gZGV2aWNlIG9wZXJhdGlv
bgorICovCitzdGF0aWMgdTY0IGVwZl92Y29uX3ZkZXZfZ2V0X2ZlYXR1cmVzKHN0cnVjdCB2aXJ0
aW9fZGV2aWNlICp2ZGV2KQoreworCXN0cnVjdCBlcGZfdmNvbiAqdmNvbiA9IHZkZXZfdG9fdmNv
bih2ZGV2KTsKKworCXJldHVybiB2Y29uLT5mZWF0dXJlczsKK30KKworc3RhdGljIGludCBlcGZf
dmNvbl92ZGV2X2ZpbmFsaXplX2ZlYXR1cmVzKHN0cnVjdCB2aXJ0aW9fZGV2aWNlICp2ZGV2KQor
eworCXN0cnVjdCBlcGZfdmNvbiAqdmNvbiA9IHZkZXZfdG9fdmNvbih2ZGV2KTsKKworCXJldHVy
biB2ZGV2LT5mZWF0dXJlcyAhPSB2Y29uLT5mZWF0dXJlczsKK30KKworc3RhdGljIHZvaWQgZXBm
X3Zjb25fdmRldl9nZXRfY29uZmlnKHN0cnVjdCB2aXJ0aW9fZGV2aWNlICp2ZGV2LAorCQkJCSAg
ICAgdW5zaWduZWQgaW50IG9mZnNldCwgdm9pZCAqYnVmLAorCQkJCSAgICAgdW5zaWduZWQgaW50
IGxlbikKK3sKKwkvKiBUaGVyZSBpcyBubyBjb25maWcgZm9yIHZpcnRpbyBjb25zb2xlIGJlY2F1
c2UgdGhpcyBjb25zb2xlIGRldmljZQorCSAqIGRvZXNuJ3QgYW55IHN1cHBvcnQgZmVhdHVyZXMK
KwkgKi8KKwltZW1zZXQoYnVmLCAweDAwLCBsZW4pOworfQorCitzdGF0aWMgdm9pZCBlcGZfdmNv
bl92ZGV2X3NldF9jb25maWcoc3RydWN0IHZpcnRpb19kZXZpY2UgKnZkZXYsCisJCQkJICAgICB1
bnNpZ25lZCBpbnQgb2Zmc2V0LCBjb25zdCB2b2lkICpidWYsCisJCQkJICAgICB1bnNpZ25lZCBp
bnQgbGVuKQoreworCS8qIERvIG5vdGhpbmcgYmVjYXVzZSB0aGlzIGNvbnNvbGUgZGV2aWNlIGRv
ZXNuJ3QgYW55IHN1cHBvcnQgZmVhdHVyZXMgKi8KK30KKworc3RhdGljIHU4IGVwZl92Y29uX3Zk
ZXZfZ2V0X3N0YXR1cyhzdHJ1Y3QgdmlydGlvX2RldmljZSAqdmRldikKK3sKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIHZvaWQgZXBmX3Zjb25fdmRldl9zZXRfc3RhdHVzKHN0cnVjdCB2aXJ0aW9f
ZGV2aWNlICp2ZGV2LCB1OCBzdGF0dXMpCit7CisJaWYgKHN0YXR1cyAmIFZJUlRJT19DT05GSUdf
U19GQUlMRUQpCisJCXByX2RlYnVnKCJkcml2ZXIgZmFpbGVkIHRvIHNldHVwIHRoaXMgZGV2aWNl
XG4iKTsKK30KKworc3RhdGljIHZvaWQgZXBmX3Zjb25fdmRldl9yZXNldChzdHJ1Y3QgdmlydGlv
X2RldmljZSAqdmRldikKK3sKKwlzdHJ1Y3QgZXBmX3Zjb24gKnZjb24gPSB2ZGV2X3RvX3Zjb24o
dmRldik7CisKKwllcGZfdmlydGlvX3Jlc2V0KCZ2Y29uLT5ldmlvKTsKK30KKworc3RhdGljIGJv
b2wgZXBmX3Zjb25fdmRldl92cV9ub3RpZnkoc3RydWN0IHZpcnRxdWV1ZSAqdnEpCit7CisJc3Ry
dWN0IGVwZl92Y29uICp2Y29uID0gdmRldl90b192Y29uKHZxLT52ZGV2KTsKKworCXN3aXRjaCAo
dnEtPmluZGV4KSB7CisJY2FzZSBWQ09OX1ZJUlRRVUVVRV9SWDoKKwljYXNlIFZDT05fVklSVFFV
RVVFX1RYOgorCQlxdWV1ZV93b3JrKHZjb24tPnRhc2tfd3EsICZ2Y29uLT50eF93b3JrKTsKKwkJ
YnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNlOworCX0KKworCXJldHVybiB0cnVlOwor
fQorCitzdGF0aWMgaW50IGVwZl92Y29uX3ZkZXZfZmluZF92cXMoc3RydWN0IHZpcnRpb19kZXZp
Y2UgKnZkZXYsIHVuc2lnbmVkIGludCBudnFzLAorCQkJCSAgc3RydWN0IHZpcnRxdWV1ZSAqdnFz
W10sCisJCQkJICB2cV9jYWxsYmFja190ICpjYWxsYmFja1tdLAorCQkJCSAgY29uc3QgY2hhciAq
Y29uc3QgbmFtZXNbXSwgY29uc3QgYm9vbCAqY3R4LAorCQkJCSAgc3RydWN0IGlycV9hZmZpbml0
eSAqZGVzYykKK3sKKwlzdHJ1Y3QgZXBmX3Zjb24gKnZjb24gPSB2ZGV2X3RvX3Zjb24odmRldik7
CisJaW50IGVycjsKKwlpbnQgcWlkeCwgaTsKKworCWlmIChudnFzID4gZXBmX3Zjb25fZ2V0X252
cSh2Y29uKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlmb3IgKHFpZHggPSAwLCBpID0gMDsgaSA8
IG52cXM7IGkrKykgeworCQlzdHJ1Y3QgdmlydHF1ZXVlICp2cTsKKwkJY29uc3Qgc3RydWN0IHZy
aW5nICp2cmluZzsKKworCQlpZiAoIW5hbWVzW2ldKSB7CisJCQl2cXNbaV0gPSBOVUxMOworCQkJ
Y29udGludWU7CisJCX0KKworCQl2cSA9IHZyaW5nX2NyZWF0ZV92aXJ0cXVldWUocWlkeCsrLCB2
aXJ0aW9fcXVldWVfc2l6ZSwKKwkJCQkJICAgIFZJUlRJT19QQ0lfVlJJTkdfQUxJR04sIHZkZXYs
IHRydWUsCisJCQkJCSAgICBmYWxzZSwgY3R4ID8gY3R4W2ldIDogZmFsc2UsCisJCQkJCSAgICBl
cGZfdmNvbl92ZGV2X3ZxX25vdGlmeSwKKwkJCQkJICAgIGNhbGxiYWNrW2ldLCBuYW1lc1tpXSk7
CisJCWlmICghdnEpIHsKKwkJCWVyciA9IC1FTk9NRU07CisJCQlnb3RvIGVycl9kZWxfdnFzOwor
CQl9CisKKwkJdnFzW2ldID0gdnE7CisJCXZjb24tPnZkZXZfdnFzW2ldID0gdnE7CisKKwkJdnJp
bmcgPSB2aXJ0cXVldWVfZ2V0X3ZyaW5nKHZxKTsKKwkJZXJyID0gdnJpbmdoX2luaXRfa2Vybigm
dmNvbi0+dmRldl92cmhzW2ldLCB2Y29uLT5mZWF0dXJlcywKKwkJCQkgICAgICAgdmlydGlvX3F1
ZXVlX3NpemUsIGZhbHNlLCBHRlBfS0VSTkVMLAorCQkJCSAgICAgICB2cmluZy0+ZGVzYywgdnJp
bmctPmF2YWlsLCB2cmluZy0+dXNlZCk7CisJCWlmIChlcnIpIHsKKwkJCXByX2VycigiZmFpbGVk
IHRvIGluaXQgdnJpbmdoIGZvciB2cmluZyAlZFxuIiwgaSk7CisJCQlnb3RvIGVycl9kZWxfdnFz
OworCQl9CisJfQorCisJcmV0dXJuIDA7CisKK2Vycl9kZWxfdnFzOgorCWZvciAoOyBpID49IDA7
IGktLSkgeworCQlpZiAoIW5hbWVzW2ldKQorCQkJY29udGludWU7CisKKwkJaWYgKCF2cXNbaV0p
CisJCQljb250aW51ZTsKKworCQl2cmluZ19kZWxfdmlydHF1ZXVlKHZxc1tpXSk7CisJfQorCXJl
dHVybiBlcnI7Cit9CisKK3N0YXRpYyB2b2lkIGVwZl92Y29uX3ZkZXZfZGVsX3ZxcyhzdHJ1Y3Qg
dmlydGlvX2RldmljZSAqdmRldikKK3sKKwlzdHJ1Y3QgZXBmX3Zjb24gKnZjb24gPSB2ZGV2X3Rv
X3Zjb24odmRldik7CisKKwlmb3IgKGludCBpID0gMDsgaSA8IGVwZl92Y29uX2dldF9udnEodmNv
bik7IGkrKykgeworCQlpZiAoIXZjb24tPnZkZXZfdnFzW2ldKQorCQkJY29udGludWU7CisKKwkJ
dnJpbmdfZGVsX3ZpcnRxdWV1ZSh2Y29uLT52ZGV2X3Zxc1tpXSk7CisJfQorfQorCitzdGF0aWMg
Y29uc3Qgc3RydWN0IHZpcnRpb19jb25maWdfb3BzIGVwZl92Y29uX3ZkZXZfY29uZmlnX29wcyA9
IHsKKwkuZ2V0X2ZlYXR1cmVzID0gZXBmX3Zjb25fdmRldl9nZXRfZmVhdHVyZXMsCisJLmZpbmFs
aXplX2ZlYXR1cmVzID0gZXBmX3Zjb25fdmRldl9maW5hbGl6ZV9mZWF0dXJlcywKKwkuZ2V0ID0g
ZXBmX3Zjb25fdmRldl9nZXRfY29uZmlnLAorCS5zZXQgPSBlcGZfdmNvbl92ZGV2X3NldF9jb25m
aWcsCisJLmdldF9zdGF0dXMgPSBlcGZfdmNvbl92ZGV2X2dldF9zdGF0dXMsCisJLnNldF9zdGF0
dXMgPSBlcGZfdmNvbl92ZGV2X3NldF9zdGF0dXMsCisJLnJlc2V0ID0gZXBmX3Zjb25fdmRldl9y
ZXNldCwKKwkuZmluZF92cXMgPSBlcGZfdmNvbl92ZGV2X2ZpbmRfdnFzLAorCS5kZWxfdnFzID0g
ZXBmX3Zjb25fdmRldl9kZWxfdnFzLAorfTsKKworc3RhdGljIHZvaWQgZXBmX3Zjb25fdmRldl9y
ZWxlYXNlKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwkvKiBEbyBub3RoaW5nLCBiZWNhdXNlIHRo
ZSBzdHJ1Y3QgdmlydGlvX2RldmljZSB3aWxsIGJlIHJldXNlZC4gKi8KK30KKworc3RhdGljIGlu
dCBlcGZfdmNvbl9zZXR1cF92ZGV2KHN0cnVjdCBlcGZfdmNvbiAqdmNvbiwgc3RydWN0IGRldmlj
ZSAqcGFyZW50KQoreworCWludCBlcnI7CisJc3RydWN0IHZpcnRpb19kZXZpY2UgKnZkZXYgPSAm
dmNvbi0+dmRldjsKKwljb25zdCB1bnNpZ25lZCBpbnQgbnZxID0gZXBmX3Zjb25fZ2V0X252cSh2
Y29uKTsKKworCXZjb24tPnZkZXZfdnJocyA9CisJCWttYWxsb2NfYXJyYXkobnZxLCBzaXplb2Yo
dmNvbi0+dmRldl92cmhzWzBdKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCF2Y29uLT52ZGV2X3ZyaHMp
CisJCXJldHVybiAtRU5PTUVNOworCisJdmNvbi0+dmRldl9pb3ZzID0KKwkJa21hbGxvY19hcnJh
eShudnEsIHNpemVvZih2Y29uLT52ZGV2X2lvdnNbMF0pLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXZj
b24tPnZkZXZfaW92cykgeworCQllcnIgPSAtRU5PTUVNOworCQlnb3RvIGVycl9mcmVlX3ZyaHM7
CisJfQorCisJZm9yIChpbnQgaSA9IDA7IGkgPCBudnE7IGkrKykKKwkJdnJpbmdoX2tpb3ZfaW5p
dCgmdmNvbi0+dmRldl9pb3ZzW2ldLCBOVUxMLCAwKTsKKworCXZjb24tPnZkZXZfdnFzID0KKwkJ
a21hbGxvY19hcnJheShudnEsIHNpemVvZih2Y29uLT52ZGV2X3ZyaHNbMF0pLCBHRlBfS0VSTkVM
KTsKKwlpZiAoIXZjb24tPnZkZXZfdnFzKSB7CisJCWVyciA9IC1FTk9NRU07CisJCWdvdG8gZXJy
X2NsZWFudXBfa2lvdjsKKwl9CisKKwl2ZGV2LT5kZXYucGFyZW50ID0gcGFyZW50OworCXZkZXYt
PmRldi5yZWxlYXNlID0gZXBmX3Zjb25fdmRldl9yZWxlYXNlOworCXZkZXYtPmNvbmZpZyA9ICZl
cGZfdmNvbl92ZGV2X2NvbmZpZ19vcHM7CisJdmRldi0+aWQudmVuZG9yID0gUENJX1ZFTkRPUl9J
RF9SRURIQVRfUVVNUkFORVQ7CisJdmRldi0+aWQuZGV2aWNlID0gVklSVElPX0lEX0NPTlNPTEU7
CisKKwllcnIgPSByZWdpc3Rlcl92aXJ0aW9fZGV2aWNlKHZkZXYpOworCWlmIChlcnIpCisJCWdv
dG8gZXJyX2ZyZWVfdmRldl92cXM7CisKKwlyZXR1cm4gMDsKKworZXJyX2ZyZWVfdmRldl92cXM6
CisJa2ZyZWUodmNvbi0+dmRldl92cXMpOworCitlcnJfY2xlYW51cF9raW92OgorCWZvciAoaW50
IGkgPSAwOyBpIDwgbnZxOyBpKyspCisJCXZyaW5naF9raW92X2NsZWFudXAoJnZjb24tPnZkZXZf
aW92c1tpXSk7CisKKwlrZnJlZSh2Y29uLT52ZGV2X2lvdnMpOworCitlcnJfZnJlZV92cmhzOgor
CWtmcmVlKHZjb24tPnZkZXZfdnJocyk7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9p
ZCBlcGZfdmNvbl9jbGVhbnVwX3ZkZXYoc3RydWN0IGVwZl92Y29uICp2Y29uKQoreworCXVucmVn
aXN0ZXJfdmlydGlvX2RldmljZSgmdmNvbi0+dmRldik7CisJLyogQ2xlYW51cCBzdHJ1Y3Qgdmly
dGlvX2RldmljZSB0aGF0IGhhcyBrb2JqZWN0LCBvdGhlcndpc2UgZXJyb3Igb2NjdXJlcyB3aGVu
CisJICogcmVyZWdpc3RlciB0aGUgdmlydGlvIGRldmljZS4KKwkgKi8KKwltZW1zZXQoJnZjb24t
PnZkZXYsIDB4MDAsIHNpemVvZih2Y29uLT52ZGV2KSk7CisKKwlrZnJlZSh2Y29uLT52ZGV2X3Zx
cyk7CisKKwlmb3IgKGludCBpID0gMDsgaSA8IGVwZl92Y29uX2dldF9udnEodmNvbik7IGkrKykK
KwkJdnJpbmdoX2tpb3ZfY2xlYW51cCgmdmNvbi0+dmRldl9pb3ZzW2ldKTsKKworCWtmcmVlKHZj
b24tPnZkZXZfaW92cyk7CisJa2ZyZWUodmNvbi0+dmRldl92cmhzKTsKK30KKworc3RhdGljIGlu
dCBlcGZfdmNvbl9iaW5kKHN0cnVjdCBwY2lfZXBmICplcGYpCit7CisJc3RydWN0IGVwZl92Y29u
ICp2Y29uID0gZXBmX2dldF9kcnZkYXRhKGVwZik7CisJaW50IGVycjsKKworCWVyciA9IGVwZl92
Y29uX3NldHVwX2NvbW1vbih2Y29uKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZXJy
ID0gZXBmX3Zjb25fc2V0dXBfZXBfZnVuYyh2Y29uLCBlcGYpOworCWlmIChlcnIpCisJCWdvdG8g
ZXJyX2NsZWFudXBfY29tbW9uOworCisJZXJyID0gZXBmX3Zjb25fc2V0dXBfdmRldih2Y29uLCBl
cGYtPmVwYy0+ZGV2LnBhcmVudCk7CisJaWYgKGVycikKKwkJZ290byBlcnJfY2xlYW51cF9lcF9m
dW5jOworCisJcmV0dXJuIDA7CisKK2Vycl9jbGVhbnVwX2NvbW1vbjoKKwllcGZfdmNvbl9jbGVh
bnVwX2NvbW1vbih2Y29uKTsKKworZXJyX2NsZWFudXBfZXBfZnVuYzoKKwllcGZfdmNvbl9jbGVh
bnVwX2VwX2Z1bmModmNvbik7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZCBlcGZf
dmNvbl91bmJpbmQoc3RydWN0IHBjaV9lcGYgKmVwZikKK3sKKwlzdHJ1Y3QgZXBmX3Zjb24gKnZj
b24gPSBlcGZfZ2V0X2RydmRhdGEoZXBmKTsKKworCWVwZl92Y29uX2NsZWFudXBfY29tbW9uKHZj
b24pOworCWVwZl92Y29uX2NsZWFudXBfZXBfZnVuYyh2Y29uKTsKKwllcGZfdmNvbl9jbGVhbnVw
X3ZkZXYodmNvbik7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgcGNpX2VwZl9vcHMgZXBmX3Zjb25fb3Bz
ID0geworCS5iaW5kID0gZXBmX3Zjb25fYmluZCwKKwkudW5iaW5kID0gZXBmX3Zjb25fdW5iaW5k
LAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBwY2lfZXBmX2RldmljZV9pZCBlcGZfdmNvbl9p
ZHNbXSA9IHsKKwl7IC5uYW1lID0gInBjaV9lcGZfdmNvbiIgfSwKKwl7fQorfTsKKworc3RhdGlj
IGludCBlcGZfdmNvbl9wcm9iZShzdHJ1Y3QgcGNpX2VwZiAqZXBmKQoreworCXN0cnVjdCBlcGZf
dmNvbiAqdmNvbjsKKworCXZjb24gPSBkZXZtX2t6YWxsb2MoJmVwZi0+ZGV2LCBzaXplb2YoKnZj
b24pLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXZjb24pCisJCXJldHVybiAtRU5PTUVNOworCisJZXBm
X3NldF9kcnZkYXRhKGVwZiwgdmNvbik7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHN0cnVj
dCBwY2lfZXBmX2RyaXZlciBlcGZfdmNvbl9kcnYgPSB7CisJLmRyaXZlci5uYW1lID0gInBjaV9l
cGZfdmNvbiIsCisJLm9wcyA9ICZlcGZfdmNvbl9vcHMsCisJLmlkX3RhYmxlID0gZXBmX3Zjb25f
aWRzLAorCS5wcm9iZSA9IGVwZl92Y29uX3Byb2JlLAorCS5vd25lciA9IFRISVNfTU9EVUxFLAor
fTsKKworc3RhdGljIGludCBfX2luaXQgZXBmX3Zjb25faW5pdCh2b2lkKQoreworCWludCBlcnI7
CisKKwllcnIgPSBwY2lfZXBmX3JlZ2lzdGVyX2RyaXZlcigmZXBmX3Zjb25fZHJ2KTsKKwlpZiAo
ZXJyKQorCQlwcl9lcnIoIkZhaWxlZCB0byByZWdpc3RlciBQQ0kgRVAgdmlydGlvLWNvbnNvbGUg
ZnVuY3Rpb25cbiIpOworCisJcmV0dXJuIDA7Cit9Cittb2R1bGVfaW5pdChlcGZfdmNvbl9pbml0
KTsKKworc3RhdGljIHZvaWQgZXBmX3Zjb25fZXhpdCh2b2lkKQoreworCXBjaV9lcGZfdW5yZWdp
c3Rlcl9kcml2ZXIoJmVwZl92Y29uX2Rydik7Cit9Cittb2R1bGVfZXhpdChlcGZfdmNvbl9leGl0
KTsKKworTU9EVUxFX0xJQ0VOU0UoIkdQTCIpOworTU9EVUxFX0FVVEhPUigiU2h1bnN1a2UgTWll
IDxtaWVAaWdlbC5jby5qcD4iKTsKLS0gCjIuMjUuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1
YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhm
b3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
