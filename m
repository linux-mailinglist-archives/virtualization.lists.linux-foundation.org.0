Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 701BC4244A3
	for <lists.virtualization@lfdr.de>; Wed,  6 Oct 2021 19:40:56 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id EA9B2408F6;
	Wed,  6 Oct 2021 17:40:54 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id dFfHNnUQqQV5; Wed,  6 Oct 2021 17:40:53 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp4.osuosl.org (Postfix) with ESMTPS id 184F4405CB;
	Wed,  6 Oct 2021 17:40:53 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 94178C0011;
	Wed,  6 Oct 2021 17:40:52 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 0EEBEC002C
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:47 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp4.osuosl.org (Postfix) with ESMTP id 4E9C3408DC
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:46 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
 by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id VHOQW8BEQymT
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:45 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.8.0
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by smtp4.osuosl.org (Postfix) with ESMTPS id C68AB408CF
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:44 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 3EC5B30828BA; Wed,  6 Oct 2021 20:31:23 +0300 (EEST)
Received: from localhost (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 2064B3064495;
 Wed,  6 Oct 2021 20:31:23 +0300 (EEST)
X-Is-Junk-Enabled: fGZTSsP0qEJE2AIKtlSuFiRRwg9xyHmJ
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v12 70/77] KVM: introspection: add KVMI_VM_SET_PAGE_ACCESS
Date: Wed,  6 Oct 2021 20:31:06 +0300
Message-Id: <20211006173113.26445-71-alazar@bitdefender.com>
In-Reply-To: <20211006173113.26445-1-alazar@bitdefender.com>
References: <20211006173113.26445-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: Tamas K Lengyel <tamas@tklengyel.com>, Wanpeng Li <wanpengli@tencent.com>,
 Sean Christopherson <seanjc@google.com>, Joerg Roedel <joro@8bytes.org>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Mathieu Tarral <mathieu.tarral@protonmail.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 Jim Mattson <jmattson@google.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhpcyBjb21tYW5k
IHNldHMgdGhlIHNwdGUgYWNjZXNzIGJpdHMgKHJ3eCkgZm9yIGFuIGFycmF5IG9mIGd1ZXN0CnBo
eXNpY2FsIGFkZHJlc3NlcyAodGhyb3VnaCB0aGUgcGFnZSB0cmFja2luZyBzdWJzeXN0ZW0pLgoK
VGhlc2UgR1BBcywgd2l0aCB0aGUgcmVxdWVzdGVkIGFjY2VzcyBiaXRzLCBhcmUgYWxzbyBrZXB0
IGluIGEgcmFkaXgKdHJlZSBpbiBvcmRlciB0byBmaWx0ZXIgb3V0IHRoZSAjUEYgZXZlbnRzIHdo
aWNoIGFyZSBvZiBubyBpbnRlcmVzdCB0bwp0aGUgaW50cm9zcGVjdGlvbiB0b29sIGFuZCB0byBy
ZWFwcGx5IHRoZSBzZXR0aW5ncyB3aGVuIGEgbWVtb3J5IHNsb3QKaXMgbW92ZWQuCgpTaWduZWQt
b2ZmLWJ5OiBNaWhhaSBEb27Im3UgPG1kb250dUBiaXRkZWZlbmRlci5jb20+CkNvLWRldmVsb3Bl
ZC1ieTogQWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgpTaWduZWQtb2Zm
LWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogRG9jdW1l
bnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCAgICAgICAgICAgICAgIHwgIDU5ICsrKysrKysrKwog
YXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaCAgICAgICAgICAgICAgIHwgICAyICsKIGFy
Y2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oICAgICAgICAgICAgICB8ICAgOCArKwogYXJj
aC94ODYva3ZtL2t2bWkuYyAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDQyICsrKysrKwog
aW5jbHVkZS9saW51eC9rdm1pX2hvc3QuaCAgICAgICAgICAgICAgICAgICAgIHwgICAzICsKIGlu
Y2x1ZGUvdWFwaS9saW51eC9rdm1pLmggICAgICAgICAgICAgICAgICAgICB8ICAyMCArKysKIC4u
Li90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jICB8ICA1MCArKysrKysr
KwogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMgICAgICAgICAgICAgICAgIHwgMTIwICsr
KysrKysrKysrKysrKysrLQogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oICAgICAg
ICAgICAgIHwgIDEwICsrCiB2aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMgICAgICAg
ICAgICAgfCAgNTkgKysrKysrKysrCiAxMCBmaWxlcyBjaGFuZ2VkLCAzNzIgaW5zZXJ0aW9ucygr
KSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3Zt
aS5yc3QgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CmluZGV4IGIzOWQ2YWM0N2M5
YS4uMDJiOWYwYTI0MGMwIDEwMDY0NAotLS0gYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWku
cnN0CisrKyBiL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKQEAgLTk0Niw2ICs5NDYs
NjUgQEAgdG8gY29udHJvbCBldmVudHMgZm9yIGFueSBvdGhlciByZWdpc3RlciB3aWxsIGZhaWwg
d2l0aCAtS1ZNX0VJTlZBTDo6CiAqIC1LVk1fRVBFUk0gIC0gdGhlIGludGVyY2VwdGlvbiBvZiB0
aGUgc2VsZWN0ZWQgTVNSIGlzIGRpc2FsbG93ZWQKICAgICAgICAgICAgICAgICBmcm9tIHVzZXJz
cGFjZSAoS1ZNX1g4Nl9TRVRfTVNSX0ZJTFRFUikKIAorMjIuIEtWTUlfVk1fU0VUX1BBR0VfQUND
RVNTCistLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKworOkFyY2hpdGVjdHVyZXM6IHg4Ngor
OlZlcnNpb25zOiA+PSAxCis6UGFyYW1ldGVyczoKKworOjoKKworCXN0cnVjdCBrdm1pX3ZtX3Nl
dF9wYWdlX2FjY2VzcyB7CisJCV9fdTE2IGNvdW50OworCQlfX3UxNiBwYWRkaW5nMTsKKwkJX191
MzIgcGFkZGluZzI7CisJCXN0cnVjdCBrdm1pX3BhZ2VfYWNjZXNzX2VudHJ5IGVudHJpZXNbMF07
CisJfTsKKword2hlcmU6OgorCisJc3RydWN0IGt2bWlfcGFnZV9hY2Nlc3NfZW50cnkgeworCQlf
X3U2NCBncGE7CisJCV9fdTggYWNjZXNzOworCQlfX3U4IHBhZGRpbmdbN107CisJfTsKKworCis6
UmV0dXJuczoKKworOjoKKworCXN0cnVjdCBrdm1pX2Vycm9yX2NvZGUKKworU2V0cyB0aGUgYWNj
ZXNzIGJpdHMgKHJ3eCkgZm9yIGFuIGFycmF5IG9mIGBgY291bnRgYCBndWVzdCBwaHlzaWNhbAor
YWRkcmVzc2VzIChgYGdwYWBgKS4KKworVGhlIHZhbGlkIGFjY2VzcyBiaXRzIGFyZTo6CisKKwlL
Vk1JX1BBR0VfQUNDRVNTX1IKKwlLVk1JX1BBR0VfQUNDRVNTX1cKKwlLVk1JX1BBR0VfQUNDRVNT
X1gKKworCitUaGUgY29tbWFuZCB3aWxsIGZhaWwgd2l0aCAtS1ZNX0VJTlZBTCBpZiBhbnkgb2Yg
dGhlIHNwZWNpZmllZCBjb21iaW5hdGlvbgorb2YgYWNjZXNzIGJpdHMgaXMgbm90IHN1cHBvcnRl
ZCBvciB0aGUgYWRkcmVzcyAoYGBncGFgYCkgaXMgbm90IHZhbGlkCisodmlzaWJsZSkuCisKK1Ro
ZSBjb21tYW5kIHdpbGwgdHJ5IHRvIGFwcGx5IGFsbCBjaGFuZ2VzIGFuZCByZXR1cm4gdGhlIGZp
cnN0IGVycm9yIGlmCitzb21lIGZhaWxlZC4gVGhlIGludHJvc3BlY3Rpb24gdG9vbCBzaG91bGQg
aGFuZGxlIHRoZSByb2xsYmFjay4KKworSW4gb3JkZXIgdG8gJ2ZvcmdldCcgYW4gYWRkcmVzcywg
YWxsIHRocmVlIGJpdHMgKCdyd3gnKSBtdXN0IGJlIHNldC4KKworOkVycm9yczoKKworKiAtS1ZN
X0VJTlZBTCAtIHRoZSBzcGVjaWZpZWQgYWNjZXNzIGJpdHMgY29tYmluYXRpb24gaXMgaW52YWxp
ZAorKiAtS1ZNX0VJTlZBTCAtIHRoZSBhZGRyZXNzIGlzIG5vdCB2YWxpZAorKiAtS1ZNX0VJTlZB
TCAtIHRoZSBwYWRkaW5nIGlzIG5vdCB6ZXJvCisqIC1LVk1fRUlOVkFMIC0gdGhlIG1lc3NhZ2Ug
c2l6ZSBpcyBpbnZhbGlkCisqIC1LVk1fRUFHQUlOIC0gdGhlIHNlbGVjdGVkIHZDUFUgY2FuJ3Qg
YmUgaW50cm9zcGVjdGVkIHlldAorKiAtS1ZNX0VOT01FTSAtIHRoZXJlIGlzIG5vdCBlbm91Z2gg
bWVtb3J5IHRvIGFkZCB0aGUgcGFnZSB0cmFja2luZyBzdHJ1Y3R1cmVzCisKIEV2ZW50cwogPT09
PT09CiAKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmggYi9hcmNo
L3g4Ni9pbmNsdWRlL2FzbS9rdm1faG9zdC5oCmluZGV4IGYxZTlhZGMyNDAyNS4uZDBjZTYzMjE3
NTAyIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1faG9zdC5oCisrKyBiL2Fy
Y2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmgKQEAgLTU1LDYgKzU1LDggQEAKIC8qIG1lbW9y
eSBzbG90cyB0aGF0IGFyZSBub3QgZXhwb3NlZCB0byB1c2Vyc3BhY2UgKi8KICNkZWZpbmUgS1ZN
X1BSSVZBVEVfTUVNX1NMT1RTIDMKIAorI2luY2x1ZGUgPGFzbS9rdm1pX2hvc3QuaD4KKwogI2Rl
ZmluZSBLVk1fSEFMVF9QT0xMX05TX0RFRkFVTFQgMjAwMDAwCiAKICNkZWZpbmUgS1ZNX0lSUUNI
SVBfTlVNX1BJTlMgIEtWTV9JT0FQSUNfTlVNX1BJTlMKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2lu
Y2x1ZGUvYXNtL2t2bWlfaG9zdC5oIGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmgK
aW5kZXggODgyMmYwMzEwMTU2Li4zZTc0OTIwOGI4YTEgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2lu
Y2x1ZGUvYXNtL2t2bWlfaG9zdC5oCisrKyBiL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9z
dC5oCkBAIC0yLDYgKzIsNyBAQAogI2lmbmRlZiBfQVNNX1g4Nl9LVk1JX0hPU1RfSAogI2RlZmlu
ZSBfQVNNX1g4Nl9LVk1JX0hPU1RfSAogCisjaW5jbHVkZSA8YXNtL2t2bV9wYWdlX3RyYWNrLmg+
CiAjaW5jbHVkZSA8YXNtL2t2bWkuaD4KIAogc3RydWN0IG1zcl9kYXRhOwpAQCAtNTQsNiArNTUs
MTMgQEAgc3RydWN0IGt2bV92Y3B1X2FyY2hfaW50cm9zcGVjdGlvbiB7CiBzdHJ1Y3Qga3ZtX2Fy
Y2hfaW50cm9zcGVjdGlvbiB7CiB9OwogCisjZGVmaW5lIEtWTUlfTUVNX1NMT1RTX05VTSBTSFJU
X01BWAorI2RlZmluZSBTTE9UU19TSVpFIEJJVFNfVE9fTE9OR1MoS1ZNSV9NRU1fU0xPVFNfTlVN
KQorCitzdHJ1Y3Qga3ZtaV9hcmNoX21lbV9hY2Nlc3MgeworCXVuc2lnbmVkIGxvbmcgYWN0aXZl
W0tWTV9QQUdFX1RSQUNLX01BWF1bU0xPVFNfU0laRV07Cit9OworCiAjaWZkZWYgQ09ORklHX0tW
TV9JTlRST1NQRUNUSU9OCiAKIGJvb2wga3ZtaV9tb25pdG9yX2JwX2ludGVyY2VwdChzdHJ1Y3Qg
a3ZtX3ZjcHUgKnZjcHUsIHUzMiBkYmcpOwpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL2t2bWku
YyBiL2FyY2gveDg2L2t2bS9rdm1pLmMKaW5kZXggNGUyNWZmYzNkMTMxLi43M2VhZTk2ZDIxNjcg
MTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS9rdm1pLmMKKysrIGIvYXJjaC94ODYva3ZtL2t2bWku
YwpAQCAtMTIsNiArMTIsOCBAQAogCiB2b2lkIGt2bWlfYXJjaF9pbml0X3ZjcHVfZXZlbnRzX21h
c2sodW5zaWduZWQgbG9uZyAqc3VwcG9ydGVkKQogeworCUJVSUxEX0JVR19PTihLVk1fTUVNX1NM
T1RTX05VTSAhPSBLVk1JX01FTV9TTE9UU19OVU0pOworCiAJc2V0X2JpdChLVk1JX1ZDUFVfRVZF
TlRfQlJFQUtQT0lOVCwgc3VwcG9ydGVkKTsKIAlzZXRfYml0KEtWTUlfVkNQVV9FVkVOVF9DUiwg
c3VwcG9ydGVkKTsKIAlzZXRfYml0KEtWTUlfVkNQVV9FVkVOVF9IWVBFUkNBTEwsIHN1cHBvcnRl
ZCk7CkBAIC05MjAsMyArOTIyLDQzIEBAIGJvb2wga3ZtaV9tc3JfZXZlbnQoc3RydWN0IGt2bV92
Y3B1ICp2Y3B1LCBzdHJ1Y3QgbXNyX2RhdGEgKm1zcikKIAogCXJldHVybiByZXQ7CiB9CisKK3N0
YXRpYyBjb25zdCBzdHJ1Y3QgeworCXVuc2lnbmVkIGludCBhbGxvd19iaXQ7CisJZW51bSBrdm1f
cGFnZV90cmFja19tb2RlIHRyYWNrX21vZGU7Cit9IHRyYWNrX21vZGVzW10gPSB7CisJeyBLVk1J
X1BBR0VfQUNDRVNTX1IsIEtWTV9QQUdFX1RSQUNLX1BSRVJFQUQgfSwKKwl7IEtWTUlfUEFHRV9B
Q0NFU1NfVywgS1ZNX1BBR0VfVFJBQ0tfUFJFV1JJVEUgfSwKKwl7IEtWTUlfUEFHRV9BQ0NFU1Nf
WCwgS1ZNX1BBR0VfVFJBQ0tfUFJFRVhFQyB9LAorfTsKKwordm9pZCBrdm1pX2FyY2hfdXBkYXRl
X3BhZ2VfdHJhY2tpbmcoc3RydWN0IGt2bSAqa3ZtLAorCQkJCSAgICBzdHJ1Y3Qga3ZtX21lbW9y
eV9zbG90ICpzbG90LAorCQkJCSAgICBzdHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzICptKQoreworCXN0
cnVjdCBrdm1pX2FyY2hfbWVtX2FjY2VzcyAqYXJjaCA9ICZtLT5hcmNoOworCWludCBpOworCisJ
aWYgKCFzbG90KSB7CisJCXNsb3QgPSBnZm5fdG9fbWVtc2xvdChrdm0sIG0tPmdmbik7CisJCWlm
ICghc2xvdCkKKwkJCXJldHVybjsKKwl9CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRSh0
cmFja19tb2Rlcyk7IGkrKykgeworCQl1bnNpZ25lZCBpbnQgYWxsb3dfYml0ID0gdHJhY2tfbW9k
ZXNbaV0uYWxsb3dfYml0OworCQllbnVtIGt2bV9wYWdlX3RyYWNrX21vZGUgbW9kZSA9IHRyYWNr
X21vZGVzW2ldLnRyYWNrX21vZGU7CisJCWJvb2wgc2xvdF90cmFja2VkID0gdGVzdF9iaXQoc2xv
dC0+aWQsIGFyY2gtPmFjdGl2ZVttb2RlXSk7CisKKwkJaWYgKG0tPmFjY2VzcyAmIGFsbG93X2Jp
dCkgeworCQkJaWYgKHNsb3RfdHJhY2tlZCkgeworCQkJCWt2bV9zbG90X3BhZ2VfdHJhY2tfcmVt
b3ZlX3BhZ2Uoa3ZtLCBzbG90LAorCQkJCQkJCQltLT5nZm4sIG1vZGUpOworCQkJCWNsZWFyX2Jp
dChzbG90LT5pZCwgYXJjaC0+YWN0aXZlW21vZGVdKTsKKwkJCX0KKwkJfSBlbHNlIGlmICghc2xv
dF90cmFja2VkKSB7CisJCQlrdm1fc2xvdF9wYWdlX3RyYWNrX2FkZF9wYWdlKGt2bSwgc2xvdCwg
bS0+Z2ZuLCBtb2RlKTsKKwkJCXNldF9iaXQoc2xvdC0+aWQsIGFyY2gtPmFjdGl2ZVttb2RlXSk7
CisJCX0KKwl9Cit9CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oIGIvaW5j
bHVkZS9saW51eC9rdm1pX2hvc3QuaAppbmRleCA3YTczNjAzMDY4MTIuLjE0YWMwNzVhM2VhOSAx
MDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9rdm1pX2hvc3QuaAorKysgYi9pbmNsdWRlL2xpbnV4
L2t2bWlfaG9zdC5oCkBAIC01Miw2ICs1Miw5IEBAIHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiB7
CiAJYXRvbWljX3QgZXZfc2VxOwogCiAJYm9vbCByZXN0b3JlX29uX3VuaG9vazsKKworCXN0cnVj
dCByYWRpeF90cmVlX3Jvb3QgYWNjZXNzX3RyZWU7CisJcndsb2NrX3QgYWNjZXNzX3RyZWVfbG9j
azsKIH07CiAKIGludCBrdm1pX3ZlcnNpb24odm9pZCk7CmRpZmYgLS1naXQgYS9pbmNsdWRlL3Vh
cGkvbGludXgva3ZtaS5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAppbmRleCAyZDNlYzg5
OTg4MDEuLjM4YWZlOGFiMjE1ZSAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWku
aAorKysgYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCkBAIC0yOSw2ICsyOSw3IEBAIGVudW0g
ewogCUtWTUlfVk1fV1JJVEVfUEhZU0lDQUwgID0gS1ZNSV9WTV9NRVNTQUdFX0lEKDcpLAogCUtW
TUlfVk1fUEFVU0VfVkNQVSAgICAgID0gS1ZNSV9WTV9NRVNTQUdFX0lEKDgpLAogCUtWTUlfVk1f
Q09OVFJPTF9DTEVBTlVQID0gS1ZNSV9WTV9NRVNTQUdFX0lEKDkpLAorCUtWTUlfVk1fU0VUX1BB
R0VfQUNDRVNTID0gS1ZNSV9WTV9NRVNTQUdFX0lEKDEwKSwKIAogCUtWTUlfTkVYVF9WTV9NRVNT
QUdFCiB9OwpAQCAtODAsNiArODEsMTIgQEAgZW51bSB7CiAJS1ZNSV9FVkVOVF9BQ1RJT05fQ1JB
U0ggICAgPSAyLAogfTsKIAorZW51bSB7CisJS1ZNSV9QQUdFX0FDQ0VTU19SID0gMSA8PCAwLAor
CUtWTUlfUEFHRV9BQ0NFU1NfVyA9IDEgPDwgMSwKKwlLVk1JX1BBR0VfQUNDRVNTX1ggPSAxIDw8
IDIsCit9OworCiBzdHJ1Y3Qga3ZtaV9tc2dfaGRyIHsKIAlfX3UxNiBpZDsKIAlfX3UxNiBzaXpl
OwpAQCAtMTg1LDQgKzE5MiwxNyBAQCBzdHJ1Y3Qga3ZtaV92bV9jb250cm9sX2NsZWFudXAgewog
CV9fdTggcGFkZGluZ1s3XTsKIH07CiAKK3N0cnVjdCBrdm1pX3BhZ2VfYWNjZXNzX2VudHJ5IHsK
KwlfX3U2NCBncGE7CisJX191OCBhY2Nlc3M7CisJX191OCBwYWRkaW5nWzddOworfTsKKworc3Ry
dWN0IGt2bWlfdm1fc2V0X3BhZ2VfYWNjZXNzIHsKKwlfX3UxNiBjb3VudDsKKwlfX3UxNiBwYWRk
aW5nMTsKKwlfX3UzMiBwYWRkaW5nMjsKKwlzdHJ1Y3Qga3ZtaV9wYWdlX2FjY2Vzc19lbnRyeSBl
bnRyaWVzWzBdOworfTsKKwogI2VuZGlmIC8qIF9VQVBJX19MSU5VWF9LVk1JX0ggKi8KZGlmZiAt
LWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMgYi90
b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCmluZGV4IDM5M2E3
Y2M5M2NlNi4uODFhYjM4NWVmMWRmIDEwMDY0NAotLS0gYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0
cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCisrKyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2
bS94ODZfNjQva3ZtaV90ZXN0LmMKQEAgLTE2NzgsNiArMTY3OCw1NSBAQCBzdGF0aWMgdm9pZCB0
ZXN0X2NtZF92Y3B1X2NvbnRyb2xfbXNyKHN0cnVjdCBrdm1fdm0gKnZtKQogCXRlc3RfaW52YWxp
ZF9jb250cm9sX21zcih2bSwgbXNyKTsKIH0KIAorc3RhdGljIGludCBjbWRfc2V0X3BhZ2VfYWNj
ZXNzKF9fdTE2IGNvdW50LCBfX3U2NCAqZ3BhLCBfX3U4ICphY2Nlc3MpCit7CisJc3RydWN0IGt2
bWlfcGFnZV9hY2Nlc3NfZW50cnkgKmVudHJ5LCAqZW5kOworCXN0cnVjdCBrdm1pX3ZtX3NldF9w
YWdlX2FjY2VzcyAqY21kOworCXN0cnVjdCBrdm1pX21zZ19oZHIgKnJlcTsKKwlzaXplX3QgcmVx
X3NpemU7CisJaW50IHI7CisKKwlyZXFfc2l6ZSA9IHNpemVvZigqcmVxKSArIHNpemVvZigqY21k
KSArIGNvdW50ICogc2l6ZW9mKCplbnRyeSk7CisJcmVxID0gY2FsbG9jKDEsIHJlcV9zaXplKTsK
KworCWNtZCA9IChzdHJ1Y3Qga3ZtaV92bV9zZXRfcGFnZV9hY2Nlc3MgKikocmVxICsgMSk7CisJ
Y21kLT5jb3VudCA9IGNvdW50OworCisJZW50cnkgPSBjbWQtPmVudHJpZXM7CisJZW5kID0gY21k
LT5lbnRyaWVzICsgY291bnQ7CisJZm9yICg7IGVudHJ5IDwgZW5kOyBlbnRyeSsrKSB7CisJCWVu
dHJ5LT5ncGEgPSAqZ3BhKys7CisJCWVudHJ5LT5hY2Nlc3MgPSAqYWNjZXNzKys7CisJfQorCisJ
ciA9IGRvX2NvbW1hbmQoS1ZNSV9WTV9TRVRfUEFHRV9BQ0NFU1MsIHJlcSwgcmVxX3NpemUsIE5V
TEwsIDApOworCisJZnJlZShyZXEpOworCXJldHVybiByOworfQorCitzdGF0aWMgdm9pZCBzZXRf
cGFnZV9hY2Nlc3MoX191NjQgZ3BhLCBfX3U4IGFjY2VzcykKK3sKKwlpbnQgcjsKKworCXIgPSBj
bWRfc2V0X3BhZ2VfYWNjZXNzKDEsICZncGEsICZhY2Nlc3MpOworCVRFU1RfQVNTRVJUKHIgPT0g
MCwKKwkJIktWTUlfVk1fU0VUX1BBR0VfQUNDRVNTIGZhaWxlZCwgZ3BhIDB4JWxseCwgYWNjZXNz
IDB4JXgsIGVycm9yICVkICglcylcbiIsCisJCWdwYSwgYWNjZXNzLCAtciwga3ZtX3N0cmVycm9y
KC1yKSk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfY21kX3ZtX3NldF9wYWdlX2FjY2VzcyhzdHJ1
Y3Qga3ZtX3ZtICp2bSkKK3sKKwlfX3U4IGZ1bGxfYWNjZXNzID0gS1ZNSV9QQUdFX0FDQ0VTU19S
IHwgS1ZNSV9QQUdFX0FDQ0VTU19XIHwKKwkJCSAgIEtWTUlfUEFHRV9BQ0NFU1NfWDsKKwlfX3U4
IG5vX2FjY2VzcyA9IDA7CisJX191NjQgZ3BhID0gMDsKKworCXNldF9wYWdlX2FjY2VzcyhncGEs
IG5vX2FjY2Vzcyk7CisKKwlzZXRfcGFnZV9hY2Nlc3MoZ3BhLCBmdWxsX2FjY2Vzcyk7Cit9CisK
IHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIHsKIAlz
cmFuZG9tKHRpbWUoMCkpOwpAQCAtMTcwOSw2ICsxNzU4LDcgQEAgc3RhdGljIHZvaWQgdGVzdF9p
bnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtKQogCXRlc3RfY21kX3ZjcHVfZ2V0X210cnJf
dHlwZSh2bSk7CiAJdGVzdF9ldmVudF9kZXNjcmlwdG9yKHZtKTsKIAl0ZXN0X2NtZF92Y3B1X2Nv
bnRyb2xfbXNyKHZtKTsKKwl0ZXN0X2NtZF92bV9zZXRfcGFnZV9hY2Nlc3Modm0pOwogCiAJdW5o
b29rX2ludHJvc3BlY3Rpb24odm0pOwogfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwppbmRleCA1ZDY1MzE0
ZGI3YjguLjc5ZjRlZTU2MjMwYiAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pLmMKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKQEAgLTksNiArOSw3IEBA
CiAjaW5jbHVkZSA8bGludXgva3RocmVhZC5oPgogI2luY2x1ZGUgPGxpbnV4L2hpZ2htZW0uaD4K
ICNpbmNsdWRlICJrdm1pX2ludC5oIgorI2luY2x1ZGUgIi4uL21tdV9sb2NrLmgiCiAKICNkZWZp
bmUgS1ZNSV9OVU1fQ09NTUFORFMgX19jbXAoKGludClLVk1JX05FWFRfVk1fTUVTU0FHRSwgXAog
CQkJCShpbnQpS1ZNSV9ORVhUX1ZDUFVfTUVTU0FHRSwgPikKQEAgLTI2LDYgKzI3LDExIEBAIHN0
YXRpYyBERUNMQVJFX0JJVE1BUChLdm1pX2tub3duX3ZjcHVfZXZlbnRzLCBLVk1JX05VTV9FVkVO
VFMpOwogCiBzdGF0aWMgc3RydWN0IGttZW1fY2FjaGUgKm1zZ19jYWNoZTsKIHN0YXRpYyBzdHJ1
Y3Qga21lbV9jYWNoZSAqam9iX2NhY2hlOworc3RhdGljIHN0cnVjdCBrbWVtX2NhY2hlICpyYWRp
eF9jYWNoZTsKKworc3RhdGljIGNvbnN0IHU4IGZ1bGxfYWNjZXNzICA9CUtWTUlfUEFHRV9BQ0NF
U1NfUiB8CisJCQkJS1ZNSV9QQUdFX0FDQ0VTU19XIHwKKwkJCQlLVk1JX1BBR0VfQUNDRVNTX1g7
CiAKIHZvaWQgKmt2bWlfbXNnX2FsbG9jKHZvaWQpCiB7CkBAIC00NCw2ICs1MCw4IEBAIHN0YXRp
YyB2b2lkIGt2bWlfY2FjaGVfZGVzdHJveSh2b2lkKQogCW1zZ19jYWNoZSA9IE5VTEw7CiAJa21l
bV9jYWNoZV9kZXN0cm95KGpvYl9jYWNoZSk7CiAJam9iX2NhY2hlID0gTlVMTDsKKwlrbWVtX2Nh
Y2hlX2Rlc3Ryb3kocmFkaXhfY2FjaGUpOworCXJhZGl4X2NhY2hlID0gTlVMTDsKIH0KIAogc3Rh
dGljIGludCBrdm1pX2NhY2hlX2NyZWF0ZSh2b2lkKQpAQCAtNTMsOCArNjEsMTEgQEAgc3RhdGlj
IGludCBrdm1pX2NhY2hlX2NyZWF0ZSh2b2lkKQogCWpvYl9jYWNoZSA9IGttZW1fY2FjaGVfY3Jl
YXRlKCJrdm1pX2pvYiIsCiAJCQkJICAgICAgc2l6ZW9mKHN0cnVjdCBrdm1pX2pvYiksCiAJCQkJ
ICAgICAgMCwgU0xBQl9BQ0NPVU5ULCBOVUxMKTsKKwlyYWRpeF9jYWNoZSA9IGttZW1fY2FjaGVf
Y3JlYXRlKCJrdm1pX3JhZGl4X3RyZWUiLAorCQkJCQlzaXplb2Yoc3RydWN0IGt2bWlfbWVtX2Fj
Y2VzcyksCisJCQkJCTAsIFNMQUJfQUNDT1VOVCwgTlVMTCk7CiAKLQlpZiAoIW1zZ19jYWNoZSB8
fCAham9iX2NhY2hlKSB7CisJaWYgKCFtc2dfY2FjaGUgfHwgIWpvYl9jYWNoZSB8fCAhcmFkaXhf
Y2FjaGUpIHsKIAkJa3ZtaV9jYWNoZV9kZXN0cm95KCk7CiAKIAkJcmV0dXJuIC0xOwpAQCAtMjQ1
LDEyICsyNTYsMzggQEAgc3RhdGljIHZvaWQga3ZtaV9mcmVlX3ZjcHVpKHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwgYm9vbCByZXN0b3JlX2ludGVyY2VwdGlvbikKIAlrdm1pX21ha2VfcmVxdWVzdCh2
Y3B1LCBmYWxzZSk7CiB9CiAKK3N0YXRpYyB2b2lkIGt2bWlfY2xlYXJfbWVtX2FjY2VzcyhzdHJ1
Y3Qga3ZtICprdm0pCit7CisJc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pID0gS1ZNSShr
dm0pOworCXN0cnVjdCByYWRpeF90cmVlX2l0ZXIgaXRlcjsKKwl2b2lkICoqc2xvdDsKKwlpbnQg
aWR4OworCisJaWR4ID0gc3JjdV9yZWFkX2xvY2soJmt2bS0+c3JjdSk7CisJS1ZNX01NVV9MT0NL
KGt2bSk7CisKKwlyYWRpeF90cmVlX2Zvcl9lYWNoX3Nsb3Qoc2xvdCwgJmt2bWktPmFjY2Vzc190
cmVlLCAmaXRlciwgMCkgeworCQlzdHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzICptID0gKnNsb3Q7CisK
KwkJbS0+YWNjZXNzID0gZnVsbF9hY2Nlc3M7CisJCWt2bWlfYXJjaF91cGRhdGVfcGFnZV90cmFj
a2luZyhrdm0sIE5VTEwsIG0pOworCisJCXJhZGl4X3RyZWVfaXRlcl9kZWxldGUoJmt2bWktPmFj
Y2Vzc190cmVlLCAmaXRlciwgc2xvdCk7CisJCWttZW1fY2FjaGVfZnJlZShyYWRpeF9jYWNoZSwg
bSk7CisJfQorCisJS1ZNX01NVV9VTkxPQ0soa3ZtKTsKKwlzcmN1X3JlYWRfdW5sb2NrKCZrdm0t
PnNyY3UsIGlkeCk7Cit9CisKIHN0YXRpYyB2b2lkIGt2bWlfZnJlZShzdHJ1Y3Qga3ZtICprdm0p
CiB7CiAJYm9vbCByZXN0b3JlX2ludGVyY2VwdGlvbiA9IEtWTUkoa3ZtKS0+cmVzdG9yZV9vbl91
bmhvb2s7CiAJc3RydWN0IGt2bV92Y3B1ICp2Y3B1OwogCWludCBpOwogCisJa3ZtaV9jbGVhcl9t
ZW1fYWNjZXNzKGt2bSk7CisKIAlrdm1fZm9yX2VhY2hfdmNwdShpLCB2Y3B1LCBrdm0pCiAJCWt2
bWlfZnJlZV92Y3B1aSh2Y3B1LCByZXN0b3JlX2ludGVyY2VwdGlvbik7CiAKQEAgLTMwNSw2ICsz
NDIsMTAgQEAga3ZtaV9hbGxvYyhzdHJ1Y3Qga3ZtICprdm0sIGNvbnN0IHN0cnVjdCBrdm1faW50
cm9zcGVjdGlvbl9ob29rICpob29rKQogCiAJYXRvbWljX3NldCgma3ZtaS0+ZXZfc2VxLCAwKTsK
IAorCUlOSVRfUkFESVhfVFJFRSgma3ZtaS0+YWNjZXNzX3RyZWUsCisJCQlHRlBfS0VSTkVMICYg
fl9fR0ZQX0RJUkVDVF9SRUNMQUlNKTsKKwlyd2xvY2tfaW5pdCgma3ZtaS0+YWNjZXNzX3RyZWVf
bG9jayk7CisKIAlrdm1fZm9yX2VhY2hfdmNwdShpLCB2Y3B1LCBrdm0pIHsKIAkJaW50IGVyciA9
IGt2bWlfY3JlYXRlX3ZjcHVpKHZjcHUpOwogCkBAIC05MzgsMyArOTc5LDgwIEBAIGJvb2wga3Zt
aV9icmVha3BvaW50X2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTY0IGd2YSwgdTggaW5z
bl9sZW4pCiAJcmV0dXJuIHJldDsKIH0KIEVYUE9SVF9TWU1CT0woa3ZtaV9icmVha3BvaW50X2V2
ZW50KTsKKworc3RhdGljIHN0cnVjdCBrdm1pX21lbV9hY2Nlc3MgKgorX19rdm1pX2dldF9nZm5f
YWNjZXNzKHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSwgY29uc3QgZ2ZuX3QgZ2ZuKQor
eworCXJldHVybiByYWRpeF90cmVlX2xvb2t1cCgma3ZtaS0+YWNjZXNzX3RyZWUsIGdmbik7Cit9
CisKK3N0YXRpYyB2b2lkIGt2bWlfdXBkYXRlX21lbV9hY2Nlc3Moc3RydWN0IGt2bSAqa3ZtLCBz
dHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzICptKQoreworCXN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAq
a3ZtaSA9IEtWTUkoa3ZtKTsKKworCWt2bWlfYXJjaF91cGRhdGVfcGFnZV90cmFja2luZyhrdm0s
IE5VTEwsIG0pOworCisJaWYgKG0tPmFjY2VzcyA9PSBmdWxsX2FjY2VzcykgeworCQlyYWRpeF90
cmVlX2RlbGV0ZSgma3ZtaS0+YWNjZXNzX3RyZWUsIG0tPmdmbik7CisJCWttZW1fY2FjaGVfZnJl
ZShyYWRpeF9jYWNoZSwgbSk7CisJfQorfQorCitzdGF0aWMgdm9pZCBrdm1pX2luc2VydF9tZW1f
YWNjZXNzKHN0cnVjdCBrdm0gKmt2bSwgc3RydWN0IGt2bWlfbWVtX2FjY2VzcyAqbSkKK3sKKwlz
dHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWkgPSBLVk1JKGt2bSk7CisKKwlyYWRpeF90cmVl
X2luc2VydCgma3ZtaS0+YWNjZXNzX3RyZWUsIG0tPmdmbiwgbSk7CisJa3ZtaV9hcmNoX3VwZGF0
ZV9wYWdlX3RyYWNraW5nKGt2bSwgTlVMTCwgbSk7Cit9CisKK3N0YXRpYyB2b2lkIGt2bWlfc2V0
X21lbV9hY2Nlc3Moc3RydWN0IGt2bSAqa3ZtLCBzdHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzICptLAor
CQkJCWJvb2wgKnVzZWQpCit7CisJc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pID0gS1ZN
SShrdm0pOworCXN0cnVjdCBrdm1pX21lbV9hY2Nlc3MgKmZvdW5kOworCWludCBpZHg7CisKKwlp
ZHggPSBzcmN1X3JlYWRfbG9jaygma3ZtLT5zcmN1KTsKKwlLVk1fTU1VX0xPQ0soa3ZtKTsKKwl3
cml0ZV9sb2NrKCZrdm1pLT5hY2Nlc3NfdHJlZV9sb2NrKTsKKworCWZvdW5kID0gX19rdm1pX2dl
dF9nZm5fYWNjZXNzKGt2bWksIG0tPmdmbik7CisJaWYgKGZvdW5kKSB7CisJCWZvdW5kLT5hY2Nl
c3MgPSBtLT5hY2Nlc3M7CisJCWt2bWlfdXBkYXRlX21lbV9hY2Nlc3Moa3ZtLCBmb3VuZCk7CisJ
fSBlbHNlIGlmIChtLT5hY2Nlc3MgIT0gZnVsbF9hY2Nlc3MpIHsKKwkJa3ZtaV9pbnNlcnRfbWVt
X2FjY2Vzcyhrdm0sIG0pOworCQkqdXNlZCA9IHRydWU7CisJfQorCisJd3JpdGVfdW5sb2NrKCZr
dm1pLT5hY2Nlc3NfdHJlZV9sb2NrKTsKKwlLVk1fTU1VX1VOTE9DSyhrdm0pOworCXNyY3VfcmVh
ZF91bmxvY2soJmt2bS0+c3JjdSwgaWR4KTsKK30KKworaW50IGt2bWlfc2V0X2dmbl9hY2Nlc3Mo
c3RydWN0IGt2bSAqa3ZtLCBnZm5fdCBnZm4sIHU4IGFjY2VzcykKK3sKKwlzdHJ1Y3Qga3ZtaV9t
ZW1fYWNjZXNzICptOworCWJvb2wgdXNlZCA9IGZhbHNlOworCWludCBlcnIgPSAwOworCisJbSA9
IGttZW1fY2FjaGVfemFsbG9jKHJhZGl4X2NhY2hlLCBHRlBfS0VSTkVMKTsKKwlpZiAoIW0pCisJ
CXJldHVybiAtS1ZNX0VOT01FTTsKKworCW0tPmdmbiA9IGdmbjsKKwltLT5hY2Nlc3MgPSBhY2Nl
c3M7CisKKwlpZiAocmFkaXhfdHJlZV9wcmVsb2FkKEdGUF9LRVJORUwpKQorCQllcnIgPSAtS1ZN
X0VOT01FTTsKKwllbHNlCisJCWt2bWlfc2V0X21lbV9hY2Nlc3Moa3ZtLCBtLCAmdXNlZCk7CisK
KwlyYWRpeF90cmVlX3ByZWxvYWRfZW5kKCk7CisKKwlpZiAoIXVzZWQpCisJCWttZW1fY2FjaGVf
ZnJlZShyYWRpeF9jYWNoZSwgbSk7CisKKwlyZXR1cm4gZXJyOworfQpkaWZmIC0tZ2l0IGEvdmly
dC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pX2ludC5oCmluZGV4IDBhN2E4Mjg1Yjk4MS4uNDE3MjBiMTk0NDU4IDEwMDY0NAotLS0gYS92
aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgKKysrIGIvdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pX2ludC5oCkBAIC0yNiw2ICsyNiwxMiBAQCB0eXBlZGVmIGludCAoKmt2bWlfdmNw
dV9tc2dfam9iX2ZjdCkoY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9tc2dfam9iICpqb2IsCiAJCQkJ
ICAgICBjb25zdCBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICptc2csCiAJCQkJICAgICBjb25zdCB2b2lk
ICpyZXEpOwogCitzdHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzIHsKKwlnZm5fdCBnZm47CisJdTggYWNj
ZXNzOworCXN0cnVjdCBrdm1pX2FyY2hfbWVtX2FjY2VzcyBhcmNoOworfTsKKwogc3RhdGljIGlu
bGluZSBib29sIGlzX3ZjcHVfZXZlbnRfZW5hYmxlZChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUx
NiBldmVudF9pZCkKIHsKIAlyZXR1cm4gdGVzdF9iaXQoZXZlbnRfaWQsIFZDUFVJKHZjcHUpLT5l
dl9lbmFibGVfbWFzayk7CkBAIC04Niw2ICs5Miw3IEBAIGludCBrdm1pX2NtZF9yZWFkX3BoeXNp
Y2FsKHN0cnVjdCBrdm0gKmt2bSwgdTY0IGdwYSwgc2l6ZV90IHNpemUsCiBpbnQga3ZtaV9jbWRf
d3JpdGVfcGh5c2ljYWwoc3RydWN0IGt2bSAqa3ZtLCB1NjQgZ3BhLCBzaXplX3Qgc2l6ZSwKIAkJ
CSAgICBjb25zdCB2b2lkICpidWYpOwogaW50IGt2bWlfY21kX3ZjcHVfcGF1c2Uoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1LCBib29sIHdhaXQpOworaW50IGt2bWlfc2V0X2dmbl9hY2Nlc3Moc3RydWN0
IGt2bSAqa3ZtLCBnZm5fdCBnZm4sIHU4IGFjY2Vzcyk7CiAKIC8qIGFyY2ggKi8KIHZvaWQga3Zt
aV9hcmNoX2luaXRfdmNwdV9ldmVudHNfbWFzayh1bnNpZ25lZCBsb25nICpzdXBwb3J0ZWQpOwpA
QCAtMTA0LDUgKzExMSw4IEBAIHZvaWQga3ZtaV9hcmNoX2JyZWFrcG9pbnRfZXZlbnQoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1LCB1NjQgZ3ZhLCB1OCBpbnNuX2xlbik7CiBpbnQga3ZtaV9hcmNoX2Nt
ZF9jb250cm9sX2ludGVyY2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQkJICAgIHVuc2ln
bmVkIGludCBldmVudF9pZCwgYm9vbCBlbmFibGUpOwogdm9pZCBrdm1pX2FyY2hfc2VuZF9wZW5k
aW5nX2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7Cit2b2lkIGt2bWlfYXJjaF91cGRhdGVf
cGFnZV90cmFja2luZyhzdHJ1Y3Qga3ZtICprdm0sCisJCQkJICAgIHN0cnVjdCBrdm1fbWVtb3J5
X3Nsb3QgKnNsb3QsCisJCQkJICAgIHN0cnVjdCBrdm1pX21lbV9hY2Nlc3MgKm0pOwogCiAjZW5k
aWYKZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYyBiL3ZpcnQv
a3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwppbmRleCAxZmVkZmE2ZDQ4MTQuLmQyZjg0M2Ni
ZTJjMCAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCisrKyBi
L3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwpAQCAtMjkwLDYgKzI5MCw2NCBAQCBz
dGF0aWMgaW50IGhhbmRsZV92bV9jb250cm9sX2NsZWFudXAoc3RydWN0IGt2bV9pbnRyb3NwZWN0
aW9uICprdm1pLAogCXJldHVybiBrdm1pX21zZ192bV9yZXBseShrdm1pLCBtc2csIGVjLCBOVUxM
LCAwKTsKIH0KIAorc3RhdGljIGJvb2wga3ZtaV9pc192aXNpYmxlX2dmbihzdHJ1Y3Qga3ZtICpr
dm0sIGdmbl90IGdmbikKK3sKKwlib29sIHZpc2libGU7CisJaW50IGlkeDsKKworCWlkeCA9IHNy
Y3VfcmVhZF9sb2NrKCZrdm0tPnNyY3UpOworCXZpc2libGUgPSBrdm1faXNfdmlzaWJsZV9nZm4o
a3ZtLCBnZm4pOworCXNyY3VfcmVhZF91bmxvY2soJmt2bS0+c3JjdSwgaWR4KTsKKworCXJldHVy
biB2aXNpYmxlOworfQorCitzdGF0aWMgaW50IHNldF9wYWdlX2FjY2Vzc19lbnRyeShzdHJ1Y3Qg
a3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksCisJCQkJIGNvbnN0IHN0cnVjdCBrdm1pX3BhZ2VfYWNj
ZXNzX2VudHJ5ICplbnRyeSkKK3sKKwl1OCB1bmtub3duX2JpdHMgPSB+KEtWTUlfUEFHRV9BQ0NF
U1NfUiB8IEtWTUlfUEFHRV9BQ0NFU1NfVyB8CisJCQkgICAgS1ZNSV9QQUdFX0FDQ0VTU19YKTsK
KwlnZm5fdCBnZm4gPSBncGFfdG9fZ2ZuKGVudHJ5LT5ncGEpOworCXN0cnVjdCBrdm0gKmt2bSA9
IGt2bWktPmt2bTsKKworCWlmICgoZW50cnktPmFjY2VzcyAmIHVua25vd25fYml0cykgfHwKKwkg
ICAgIG5vbl96ZXJvX3BhZGRpbmcoZW50cnktPnBhZGRpbmcsIEFSUkFZX1NJWkUoZW50cnktPnBh
ZGRpbmcpKSkKKwkJcmV0dXJuIC1LVk1fRUlOVkFMOworCisJaWYgKCFrdm1pX2lzX3Zpc2libGVf
Z2ZuKGt2bSwgZ2ZuKSkKKwkJcmV0dXJuIC1LVk1fRUlOVkFMOworCisJcmV0dXJuIGt2bWlfc2V0
X2dmbl9hY2Nlc3Moa3ZtLCBnZm4sIGVudHJ5LT5hY2Nlc3MpOworfQorCitzdGF0aWMgaW50IGhh
bmRsZV92bV9zZXRfcGFnZV9hY2Nlc3Moc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAor
CQkJCSAgICAgY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAqbXNnLAorCQkJCSAgICAgY29uc3Qg
dm9pZCAqX3JlcSkKK3sKKwljb25zdCBzdHJ1Y3Qga3ZtaV92bV9zZXRfcGFnZV9hY2Nlc3MgKnJl
cSA9IF9yZXE7CisJY29uc3Qgc3RydWN0IGt2bWlfcGFnZV9hY2Nlc3NfZW50cnkgKmVudHJ5Owor
CXNpemVfdCBuID0gcmVxLT5jb3VudDsKKwlpbnQgZWMgPSAwOworCisJaWYgKHN0cnVjdF9zaXpl
KHJlcSwgZW50cmllcywgbikgPiBtc2ctPnNpemUpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYg
KHJlcS0+cGFkZGluZzEgfHwgcmVxLT5wYWRkaW5nMikgeworCQllYyA9IC1LVk1fRUlOVkFMOwor
CQlnb3RvIHJlcGx5OworCX0KKworCWZvciAoZW50cnkgPSByZXEtPmVudHJpZXM7IG47IG4tLSwg
ZW50cnkrKykgeworCQlpbnQgZXJyID0gc2V0X3BhZ2VfYWNjZXNzX2VudHJ5KGt2bWksIGVudHJ5
KTsKKworCQlpZiAoZXJyICYmICFlYykKKwkJCWVjID0gZXJyOworCX0KKworcmVwbHk6CisJcmV0
dXJuIGt2bWlfbXNnX3ZtX3JlcGx5KGt2bWksIG1zZywgZWMsIE5VTEwsIDApOworfQorCiAvKgog
ICogVGhlc2UgY29tbWFuZHMgYXJlIGV4ZWN1dGVkIGJ5IHRoZSByZWNlaXZpbmcgdGhyZWFkLgog
ICovCkBAIC0zMDIsNiArMzYwLDcgQEAgc3RhdGljIGNvbnN0IGt2bWlfdm1fbXNnX2ZjdCBtc2df
dm1bXSA9IHsKIAlbS1ZNSV9WTV9HRVRfSU5GT10gICAgICAgID0gaGFuZGxlX3ZtX2dldF9pbmZv
LAogCVtLVk1JX1ZNX1BBVVNFX1ZDUFVdICAgICAgPSBoYW5kbGVfdm1fcGF1c2VfdmNwdSwKIAlb
S1ZNSV9WTV9SRUFEX1BIWVNJQ0FMXSAgID0gaGFuZGxlX3ZtX3JlYWRfcGh5c2ljYWwsCisJW0tW
TUlfVk1fU0VUX1BBR0VfQUNDRVNTXSA9IGhhbmRsZV92bV9zZXRfcGFnZV9hY2Nlc3MsCiAJW0tW
TUlfVk1fV1JJVEVfUEhZU0lDQUxdICA9IGhhbmRsZV92bV93cml0ZV9waHlzaWNhbCwKIH07CiAK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6
YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24u
b3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3Zp
cnR1YWxpemF0aW9u
