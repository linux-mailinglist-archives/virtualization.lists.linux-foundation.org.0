Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id C6D5E1978D9
	for <lists.virtualization@lfdr.de>; Mon, 30 Mar 2020 12:20:16 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 7E53A884EA;
	Mon, 30 Mar 2020 10:20:15 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id i0XiApcP8hYk; Mon, 30 Mar 2020 10:20:13 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id EB338884E5;
	Mon, 30 Mar 2020 10:20:12 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id D484BC07FF;
	Mon, 30 Mar 2020 10:20:12 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 0E655C07FF
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:57 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id F2D2C88489
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:56 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id hRsGRK-1NJJi
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:53 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by hemlock.osuosl.org (Postfix) with ESMTPS id C1F9F88456
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:52 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 A6DB3305D48D; Mon, 30 Mar 2020 13:12:58 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 89790305B7A1;
 Mon, 30 Mar 2020 13:12:58 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v8 62/81] KVM: introspection: restore the state of #BP
 interception on unhook
Date: Mon, 30 Mar 2020 13:12:49 +0300
Message-Id: <20200330101308.21702-63-alazar@bitdefender.com>
In-Reply-To: <20200330101308.21702-1-alazar@bitdefender.com>
References: <20200330101308.21702-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <ncitu@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTmljdciZb3IgQ8OuyJt1IDxuY2l0dUBiaXRkZWZlbmRlci5jb20+CgpUaGlzIGNvbW1p
dCBhbHNvIGVuc3VyZXMgdGhhdCBvbmx5IHRoZSB1c2Vyc3BhY2Ugb3IgdGhlIGludHJvc3BlY3Rp
b24KdG9vbCBjYW4gY29udHJvbCB0aGUgI0JQIGludGVyY2VwdGlvbiBleGNsdXNpdmVseSBhdCBv
bmUgdGltZS4KClNpZ25lZC1vZmYtYnk6IE5pY3XImW9yIEPDrsibdSA8bmNpdHVAYml0ZGVmZW5k
ZXIuY29tPgpTaWduZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRl
ci5jb20+Ci0tLQogYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaCAgIHwgIDMgKwogYXJj
aC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmggIHwgMjIgKysrKysrKwogYXJjaC94ODYva3Zt
L2t2bWkuYyAgICAgICAgICAgICAgIHwgOTkgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
LQogYXJjaC94ODYva3ZtL3g4Ni5jICAgICAgICAgICAgICAgIHwgIDUgKysKIHZpcnQva3ZtL2lu
dHJvc3BlY3Rpb24va3ZtaS5jICAgICB8IDI3ICsrKysrKysrLQogdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pX2ludC5oIHwgIDYgKy0KIDYgZmlsZXMgY2hhbmdlZCwgMTU3IGluc2VydGlvbnMo
KyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3Zt
X2hvc3QuaCBiL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmgKaW5kZXggYzIxNzYwMTI2
NzZkLi41ZjNiNmYyMDcxOGYgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9o
b3N0LmgKKysrIGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaApAQCAtODMyLDYgKzgz
Miw5IEBAIHN0cnVjdCBrdm1fdmNwdV9hcmNoIHsKIAogCS8qICNQRiB0cmFuc2xhdGVkIGVycm9y
IGNvZGUgZnJvbSBFUFQvTlBUIGV4aXQgcmVhc29uICovCiAJdTY0IGVycm9yX2NvZGU7CisKKwkv
KiBDb250cm9sIHRoZSBpbnRlcmNlcHRpb24gZm9yIEtWTSBJbnRyb3NwZWN0aW9uICovCisJc3Ry
dWN0IGt2bWlfaW50ZXJjZXB0aW9uICprdm1pOwogfTsKIAogc3RydWN0IGt2bV9scGFnZV9pbmZv
IHsKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oIGIvYXJjaC94
ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmgKaW5kZXggMzYwYTU3ZGQ5MDE5Li5jOGI3OTM5MTVi
ODQgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCisrKyBiL2Fy
Y2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCkBAIC0yLDEwICsyLDMyIEBACiAjaWZuZGVm
IF9BU01fWDg2X0tWTUlfSE9TVF9ICiAjZGVmaW5lIF9BU01fWDg2X0tWTUlfSE9TVF9ICiAKK3N0
cnVjdCBrdm1pX21vbml0b3JfaW50ZXJjZXB0aW9uIHsKKwlib29sIGt2bWlfaW50ZXJjZXB0ZWQ7
CisJYm9vbCBrdm1faW50ZXJjZXB0ZWQ7CisJYm9vbCAoKm1vbml0b3JfZmN0KShzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsIGJvb2wgZW5hYmxlKTsKK307CisKK3N0cnVjdCBrdm1pX2ludGVyY2VwdGlv
biB7CisJYm9vbCByZXN0b3JlX2ludGVyY2VwdGlvbjsKKwlzdHJ1Y3Qga3ZtaV9tb25pdG9yX2lu
dGVyY2VwdGlvbiBicmVha3BvaW50OworfTsKKwogc3RydWN0IGt2bV92Y3B1X2FyY2hfaW50cm9z
cGVjdGlvbiB7CiB9OwogCiBzdHJ1Y3Qga3ZtX2FyY2hfaW50cm9zcGVjdGlvbiB7CiB9OwogCisj
aWZkZWYgQ09ORklHX0tWTV9JTlRST1NQRUNUSU9OCisKK2Jvb2wga3ZtaV9tb25pdG9yX2JwX2lu
dGVyY2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiBkYmcpOworCisjZWxzZSAvKiBDT05G
SUdfS1ZNX0lOVFJPU1BFQ1RJT04gKi8KKworc3RhdGljIGlubGluZSBib29sIGt2bWlfbW9uaXRv
cl9icF9pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgZGJnKQorCXsgcmV0dXJu
IGZhbHNlOyB9CisKKyNlbmRpZiAvKiBDT05GSUdfS1ZNX0lOVFJPU1BFQ1RJT04gKi8KKwogI2Vu
ZGlmIC8qIF9BU01fWDg2X0tWTUlfSE9TVF9IICovCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0v
a3ZtaS5jIGIvYXJjaC94ODYva3ZtL2t2bWkuYwppbmRleCA5MjMxNDM0MWIzYTkuLjc0ZmNhNTY2
YTQ0YSAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL2t2bWkuYworKysgYi9hcmNoL3g4Ni9rdm0v
a3ZtaS5jCkBAIC0yNDIsMTggKzI0Miw3MSBAQCB2b2lkIGt2bWlfYXJjaF9oeXBlcmNhbGxfZXZl
bnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogCX0KIH0KIAorLyoKKyAqIFJldHVybnMgdHJ1ZSBp
ZiBvbmUgc2lkZSAoa3ZtIG9yIGt2bWkpIHRyaWVzIHRvIGVuYWJsZS9kaXNhYmxlIHRoZSBicmVh
a3BvaW50CisgKiBpbnRlcmNlcHRpb24gd2hpbGUgdGhlIG90aGVyIHNpZGUgaXMgc3RpbGwgdHJh
Y2tpbmcgaXQuCisgKi8KK2Jvb2wga3ZtaV9tb25pdG9yX2JwX2ludGVyY2VwdChzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsIHUzMiBkYmcpCit7CisJc3RydWN0IGt2bWlfaW50ZXJjZXB0aW9uICphcmNo
X3ZjcHVpID0gUkVBRF9PTkNFKHZjcHUtPmFyY2gua3ZtaSk7CisJdTMyIGJwX21hc2sgPSBLVk1f
R1VFU1REQkdfRU5BQkxFIHwgS1ZNX0dVRVNUREJHX1VTRV9TV19CUDsKKwlib29sIGVuYWJsZSA9
IGZhbHNlOworCisJaWYgKChkYmcgJiBicF9tYXNrKSA9PSBicF9tYXNrKQorCQllbmFibGUgPSB0
cnVlOworCisJcmV0dXJuIChhcmNoX3ZjcHVpICYmIGFyY2hfdmNwdWktPmJyZWFrcG9pbnQubW9u
aXRvcl9mY3QodmNwdSwgZW5hYmxlKSk7Cit9CitFWFBPUlRfU1lNQk9MKGt2bWlfbW9uaXRvcl9i
cF9pbnRlcmNlcHQpOworCitzdGF0aWMgYm9vbCBtb25pdG9yX2JwX2ZjdF9rdm1pKHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSwgYm9vbCBlbmFibGUpCit7CisJaWYgKGVuYWJsZSkgeworCQlpZiAoa3Zt
X3g4Nl9vcHMtPmJwX2ludGVyY2VwdGVkKHZjcHUpKQorCQkJcmV0dXJuIHRydWU7CisJfSBlbHNl
IGlmICghdmNwdS0+YXJjaC5rdm1pLT5icmVha3BvaW50Lmt2bWlfaW50ZXJjZXB0ZWQpCisJCXJl
dHVybiB0cnVlOworCisJdmNwdS0+YXJjaC5rdm1pLT5icmVha3BvaW50Lmt2bWlfaW50ZXJjZXB0
ZWQgPSBlbmFibGU7CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKK3N0YXRpYyBib29sIG1vbml0b3Jf
YnBfZmN0X2t2bShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGJvb2wgZW5hYmxlKQoreworCWlmIChl
bmFibGUpIHsKKwkJaWYgKGt2bV94ODZfb3BzLT5icF9pbnRlcmNlcHRlZCh2Y3B1KSkKKwkJCXJl
dHVybiB0cnVlOworCX0gZWxzZSBpZiAoIXZjcHUtPmFyY2gua3ZtaS0+YnJlYWtwb2ludC5rdm1f
aW50ZXJjZXB0ZWQpCisJCXJldHVybiB0cnVlOworCisJdmNwdS0+YXJjaC5rdm1pLT5icmVha3Bv
aW50Lmt2bV9pbnRlcmNlcHRlZCA9IGVuYWJsZTsKKworCXJldHVybiBmYWxzZTsKK30KKwogc3Rh
dGljIGludCBrdm1pX2NvbnRyb2xfYnBfaW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwg
Ym9vbCBlbmFibGUpCiB7CiAJc3RydWN0IGt2bV9ndWVzdF9kZWJ1ZyBkYmcgPSB7fTsKIAlpbnQg
ZXJyID0gMDsKIAorCXZjcHUtPmFyY2gua3ZtaS0+YnJlYWtwb2ludC5tb25pdG9yX2ZjdCA9IG1v
bml0b3JfYnBfZmN0X2t2bWk7CiAJaWYgKGVuYWJsZSkKIAkJZGJnLmNvbnRyb2wgPSBLVk1fR1VF
U1REQkdfRU5BQkxFIHwgS1ZNX0dVRVNUREJHX1VTRV9TV19CUDsKIAllcnIgPSBrdm1fYXJjaF92
Y3B1X3NldF9ndWVzdF9kZWJ1Zyh2Y3B1LCAmZGJnKTsKKwl2Y3B1LT5hcmNoLmt2bWktPmJyZWFr
cG9pbnQubW9uaXRvcl9mY3QgPSBtb25pdG9yX2JwX2ZjdF9rdm07CiAKIAlyZXR1cm4gZXJyOwog
fQogCitzdGF0aWMgdm9pZCBrdm1pX2FyY2hfZGlzYWJsZV9icF9pbnRlcmNlcHQoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1KQoreworCWt2bWlfY29udHJvbF9icF9pbnRlcmNlcHQodmNwdSwgZmFsc2Up
OworCisJdmNwdS0+YXJjaC5rdm1pLT5icmVha3BvaW50Lmt2bWlfaW50ZXJjZXB0ZWQgPSBmYWxz
ZTsKKwl2Y3B1LT5hcmNoLmt2bWktPmJyZWFrcG9pbnQua3ZtX2ludGVyY2VwdGVkID0gZmFsc2U7
Cit9CisKIGludCBrdm1pX2FyY2hfY21kX2NvbnRyb2xfaW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwKIAkJCQkgICAgdW5zaWduZWQgaW50IGV2ZW50X2lkLCBib29sIGVuYWJsZSkKIHsK
QEAgLTI5MCw2ICszNDMsNTAgQEAgdm9pZCBrdm1pX2FyY2hfYnJlYWtwb2ludF9ldmVudChzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUsIHU2NCBndmEsIHU4IGluc25fbGVuKQogCX0KIH0KIAotdm9pZCBr
dm1pX2FyY2hfcmVzdG9yZV9pbnRlcmNlcHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQorYm9v
bCBrdm1pX2FyY2hfcmVzdG9yZV9pbnRlcmNlcHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQog
eworCXN0cnVjdCBrdm1pX2ludGVyY2VwdGlvbiAqYXJjaF92Y3B1aSA9IHZjcHUtPmFyY2gua3Zt
aTsKKworCWlmICghYXJjaF92Y3B1aSB8fCAhYXJjaF92Y3B1aS0+cmVzdG9yZV9pbnRlcmNlcHRp
b24pCisJCXJldHVybiBmYWxzZTsKKworCWt2bWlfYXJjaF9kaXNhYmxlX2JwX2ludGVyY2VwdCh2
Y3B1KTsKKworCXJldHVybiB0cnVlOworfQorCitib29sIGt2bWlfYXJjaF92Y3B1X2FsbG9jKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSkKK3sKKwlzdHJ1Y3Qga3ZtaV9pbnRlcmNlcHRpb24gKmFyY2hf
dmNwdWk7CisKKwlhcmNoX3ZjcHVpID0ga3phbGxvYyhzaXplb2YoKmFyY2hfdmNwdWkpLCBHRlBf
S0VSTkVMKTsKKwlpZiAoIWFyY2hfdmNwdWkpCisJCXJldHVybiBmYWxzZTsKKworCWFyY2hfdmNw
dWktPmJyZWFrcG9pbnQubW9uaXRvcl9mY3QgPSBtb25pdG9yX2JwX2ZjdF9rdm07CisKKwkvKiBw
YWlyIHdpdGgga3ZtaV9tb25pdG9yX2JwX2ludGVyY2VwdCgpICovCisJc21wX3dtYigpOworCVdS
SVRFX09OQ0UodmNwdS0+YXJjaC5rdm1pLCBhcmNoX3ZjcHVpKTsKKworCXJldHVybiB0cnVlOwor
fQorCit2b2lkIGt2bWlfYXJjaF92Y3B1X2ZyZWUoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQorewor
CWtmcmVlKHZjcHUtPmFyY2gua3ZtaSk7CisJV1JJVEVfT05DRSh2Y3B1LT5hcmNoLmt2bWksIE5V
TEwpOworfQorCitib29sIGt2bWlfYXJjaF92Y3B1X2ludHJvc3BlY3RlZChzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUpCit7CisJcmV0dXJuICEhUkVBRF9PTkNFKHZjcHUtPmFyY2gua3ZtaSk7Cit9CisK
K3ZvaWQga3ZtaV9hcmNoX3JlcXVlc3RfcmVzdG9yZV9pbnRlcmNlcHRpb24oc3RydWN0IGt2bV92
Y3B1ICp2Y3B1KQoreworCXN0cnVjdCBrdm1pX2ludGVyY2VwdGlvbiAqYXJjaF92Y3B1aSA9IFJF
QURfT05DRSh2Y3B1LT5hcmNoLmt2bWkpOworCisJaWYgKGFyY2hfdmNwdWkpCisJCWFyY2hfdmNw
dWktPnJlc3RvcmVfaW50ZXJjZXB0aW9uID0gdHJ1ZTsKIH0KZGlmZiAtLWdpdCBhL2FyY2gveDg2
L2t2bS94ODYuYyBiL2FyY2gveDg2L2t2bS94ODYuYwppbmRleCBiYWQ2NjQyMGYwNTQuLjMxMjcz
YzRjN2Y4ZCAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL3g4Ni5jCisrKyBiL2FyY2gveDg2L2t2
bS94ODYuYwpAQCAtOTE2OSw2ICs5MTY5LDExIEBAIGludCBrdm1fYXJjaF92Y3B1X3NldF9ndWVz
dF9kZWJ1ZyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQlrdm1fcXVldWVfZXhjZXB0aW9uKHZj
cHUsIEJQX1ZFQ1RPUik7CiAJfQogCisJaWYgKGt2bWlfbW9uaXRvcl9icF9pbnRlcmNlcHQodmNw
dSwgZGJnLT5jb250cm9sKSkgeworCQlyID0gLUVCVVNZOworCQlnb3RvIG91dDsKKwl9CisKIAkv
KgogCSAqIFJlYWQgcmZsYWdzIGFzIGxvbmcgYXMgcG90ZW50aWFsbHkgaW5qZWN0ZWQgdHJhY2Ug
ZmxhZ3MgYXJlIHN0aWxsCiAJICogZmlsdGVyZWQgb3V0LgpkaWZmIC0tZ2l0IGEvdmlydC9rdm0v
aW50cm9zcGVjdGlvbi9rdm1pLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwppbmRl
eCAzMjUxNmNjNzA5MjguLjdlYTA1MTJiYzU4MCAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9z
cGVjdGlvbi9rdm1pLmMKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKQEAgLTE2
Nyw3ICsxNjcsNyBAQCBzdGF0aWMgYm9vbCBhbGxvY192Y3B1aShzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUpCiAKIAl2Y3B1LT5rdm1pID0gdmNwdWk7CiAKLQlyZXR1cm4gdHJ1ZTsKKwlyZXR1cm4ga3Zt
aV9hcmNoX3ZjcHVfYWxsb2ModmNwdSk7CiB9CiAKIHN0YXRpYyBpbnQgY3JlYXRlX3ZjcHVpKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSkKQEAgLTIwMCw2ICsyMDAsNyBAQCBzdGF0aWMgdm9pZCBmcmVl
X3ZjcHVpKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAlrZnJlZSh2Y3B1aSk7CiAJdmNwdS0+a3Zt
aSA9IE5VTEw7CiAKKwlrdm1pX2FyY2hfcmVxdWVzdF9yZXN0b3JlX2ludGVyY2VwdGlvbih2Y3B1
KTsKIAlrdm1pX21ha2VfcmVxdWVzdCh2Y3B1LCBmYWxzZSk7CiB9CiAKQEAgLTIxOSw2ICsyMjAs
NyBAQCB2b2lkIGt2bWlfdmNwdV91bmluaXQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogewogCW11
dGV4X2xvY2soJnZjcHUtPmt2bS0+a3ZtaV9sb2NrKTsKIAlmcmVlX3ZjcHVpKHZjcHUpOworCWt2
bWlfYXJjaF92Y3B1X2ZyZWUodmNwdSk7CiAJbXV0ZXhfdW5sb2NrKCZ2Y3B1LT5rdm0tPmt2bWlf
bG9jayk7CiB9CiAKQEAgLTM1OCw2ICszNjAsMjEgQEAgc3RhdGljIGludCBrdm1pX3JlY3ZfdGhy
ZWFkKHZvaWQgKmFyZykKIAlyZXR1cm4gMDsKIH0KIAorc3RhdGljIGJvb2wgcmVhZHlfdG9faG9v
ayhzdHJ1Y3Qga3ZtICprdm0pCit7CisJc3RydWN0IGt2bV92Y3B1ICp2Y3B1OworCWludCBpOwor
CisJaWYgKGt2bS0+a3ZtaSkKKwkJcmV0dXJuIGZhbHNlOworCisJa3ZtX2Zvcl9lYWNoX3ZjcHUo
aSwgdmNwdSwga3ZtKQorCQlpZiAoa3ZtaV9hcmNoX3ZjcHVfaW50cm9zcGVjdGVkKHZjcHUpKQor
CQkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuIHRydWU7Cit9CisKIGludCBrdm1pX2hvb2soc3Ry
dWN0IGt2bSAqa3ZtLCBjb25zdCBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25faG9vayAqaG9vaykK
IHsKIAlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWk7CkBAIC0zNjUsNyArMzgyLDcgQEAg
aW50IGt2bWlfaG9vayhzdHJ1Y3Qga3ZtICprdm0sIGNvbnN0IHN0cnVjdCBrdm1faW50cm9zcGVj
dGlvbl9ob29rICpob29rKQogCiAJbXV0ZXhfbG9jaygma3ZtLT5rdm1pX2xvY2spOwogCi0JaWYg
KGt2bS0+a3ZtaSkgeworCWlmICghcmVhZHlfdG9faG9vayhrdm0pKSB7CiAJCWVyciA9IC1FRVhJ
U1Q7CiAJCWdvdG8gb3V0OwogCX0KQEAgLTgwNiw3ICs4MjMsMTEgQEAgdm9pZCBrdm1pX2hhbmRs
ZV9yZXF1ZXN0cyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJa3ZtaV9wdXQodmNwdS0+a3ZtKTsK
IAogb3V0OgotCWt2bWlfYXJjaF9yZXN0b3JlX2ludGVyY2VwdGlvbih2Y3B1KTsKKwlpZiAoa3Zt
aV9hcmNoX3Jlc3RvcmVfaW50ZXJjZXB0aW9uKHZjcHUpKSB7CisJCW11dGV4X2xvY2soJnZjcHUt
Pmt2bS0+a3ZtaV9sb2NrKTsKKwkJa3ZtaV9hcmNoX3ZjcHVfZnJlZSh2Y3B1KTsKKwkJbXV0ZXhf
dW5sb2NrKCZ2Y3B1LT5rdm0tPmt2bWlfbG9jayk7CisJfQogfQogCiBpbnQga3ZtaV9jbWRfdmNw
dV9wYXVzZShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGJvb2wgd2FpdCkKZGlmZiAtLWdpdCBhL3Zp
cnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24v
a3ZtaV9pbnQuaAppbmRleCAwZmM2MjJiMmM5NmQuLjcwMjRiZmEzZGY2MSAxMDA2NDQKLS0tIGEv
dmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCisrKyBiL3ZpcnQva3ZtL2ludHJvc3Bl
Y3Rpb24va3ZtaV9pbnQuaApAQCAtNjUsNyArNjUsMTEgQEAgaW50IGt2bWlfY21kX3ZjcHVfc2V0
X3JlZ2lzdGVycyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQkJY29uc3Qgc3RydWN0IGt2bV9y
ZWdzICpyZWdzKTsKIAogLyogYXJjaCAqLwotdm9pZCBrdm1pX2FyY2hfcmVzdG9yZV9pbnRlcmNl
cHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsKK2Jvb2wga3ZtaV9hcmNoX3ZjcHVfYWxsb2Mo
c3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsKK3ZvaWQga3ZtaV9hcmNoX3ZjcHVfZnJlZShzdHJ1Y3Qg
a3ZtX3ZjcHUgKnZjcHUpOworYm9vbCBrdm1pX2FyY2hfdmNwdV9pbnRyb3NwZWN0ZWQoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1KTsKK2Jvb2wga3ZtaV9hcmNoX3Jlc3RvcmVfaW50ZXJjZXB0aW9uKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSk7Cit2b2lkIGt2bWlfYXJjaF9yZXF1ZXN0X3Jlc3RvcmVfaW50
ZXJjZXB0aW9uKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiBpbnQga3ZtaV9hcmNoX2NtZF92Y3B1
X2dldF9pbmZvKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAkJCQlzdHJ1Y3Qga3ZtaV92Y3B1X2dl
dF9pbmZvX3JlcGx5ICpycGwpOwogdm9pZCBrdm1pX2FyY2hfc2V0dXBfZXZlbnQoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1LCBzdHJ1Y3Qga3ZtaV9ldmVudCAqZXYpOwpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QK
VmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5s
aW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
