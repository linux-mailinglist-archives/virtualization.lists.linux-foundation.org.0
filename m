Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from mail.linuxfoundation.org (mail.linuxfoundation.org [140.211.169.12])
	by mail.lfdr.de (Postfix) with ESMTPS id 6EB24AD37A
	for <lists.virtualization@lfdr.de>; Mon,  9 Sep 2019 09:16:39 +0200 (CEST)
Received: from mail.linux-foundation.org (localhost [127.0.0.1])
	by mail.linuxfoundation.org (Postfix) with ESMTP id 9F4E6BDC;
	Mon,  9 Sep 2019 07:16:32 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@mail.linuxfoundation.org
Received: from smtp1.linuxfoundation.org (smtp1.linux-foundation.org
	[172.17.192.35])
	by mail.linuxfoundation.org (Postfix) with ESMTPS id 59C678D7
	for <virtualization@lists.linux-foundation.org>;
	Mon,  9 Sep 2019 07:16:31 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
	by smtp1.linuxfoundation.org (Postfix) with ESMTPS id E52BA7DB
	for <virtualization@lists.linux-foundation.org>;
	Mon,  9 Sep 2019 07:16:29 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
	[10.5.11.14])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mx1.redhat.com (Postfix) with ESMTPS id 467BD2F366A;
	Mon,  9 Sep 2019 07:16:29 +0000 (UTC)
Received: from [10.72.12.61] (ovpn-12-61.pek2.redhat.com [10.72.12.61])
	by smtp.corp.redhat.com (Postfix) with ESMTP id 0208D5D9D6;
	Mon,  9 Sep 2019 07:16:04 +0000 (UTC)
Subject: Re: [PATCH 1/2] Revert "vhost: access vq metadata through kernel
	virtual address"
To: "Michael S. Tsirkin" <mst@redhat.com>
References: <20190905122736.19768-1-jasowang@redhat.com>
	<20190905122736.19768-2-jasowang@redhat.com>
	<20190906094332-mutt-send-email-mst@kernel.org>
From: Jason Wang <jasowang@redhat.com>
Message-ID: <6d0b968f-87c3-99a0-fcc6-a696d383b47c@redhat.com>
Date: Mon, 9 Sep 2019 15:16:02 +0800
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
	Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190906094332-mutt-send-email-mst@kernel.org>
Content-Language: en-US
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
	(mx1.redhat.com [10.5.110.29]);
	Mon, 09 Sep 2019 07:16:29 +0000 (UTC)
X-Spam-Status: No, score=-6.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_HI
	autolearn=ham version=3.3.1
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	smtp1.linux-foundation.org
Cc: aarcange@redhat.com, kvm@vger.kernel.org, netdev@vger.kernel.org,
	linux-kernel@vger.kernel.org,
	virtualization@lists.linux-foundation.org, linux-mm@kvack.org,
	jglisse@redhat.com, jgg@mellanox.com
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.12
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Sender: virtualization-bounces@lists.linux-foundation.org
Errors-To: virtualization-bounces@lists.linux-foundation.org

Ck9uIDIwMTkvOS82IOS4i+WNiDk6NDYsIE1pY2hhZWwgUy4gVHNpcmtpbiB3cm90ZToKPiBPbiBU
aHUsIFNlcCAwNSwgMjAxOSBhdCAwODoyNzozNVBNICswODAwLCBKYXNvbiBXYW5nIHdyb3RlOgo+
PiBJdCB3YXMgcmVwb3J0ZWQgdGhhdCBtZXRhZGF0YSBhY2NlbGVyYXRpb24gaW50cm9kdWNlcyBz
ZXZlcmFsIGlzc3VlcywKPj4gc28gdGhpcyBwYXRjaCByZXZlcnRzIGNvbW1pdCBmZjQ2NjAzMmRj
OWU1YTYxMjE3ZjIyZWEzNGIyZGY5MzI3ODZiYmZjLAo+PiA3M2Y2MjhlYzllNmJjYzQ1Yjc3YzUz
ZmU2ZDBjMGVjNTVlYWY4MmFmIGFuZAo+PiAwYjRhNzA5MmZmZTU2OGE1NWJmOGYzY2VmZGY3OWZm
NjY2NTg2ZDkxLgo+Pgo+PiBXZSB3aWxsIHJld29yayBpdCBvbiB0aGUgbmV4dCB2ZXJzaW9uLgo+
Pgo+PiBDYzogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgo+PiBTaWduZWQtb2Zm
LWJ5OiBKYXNvbiBXYW5nIDxqYXNvd2FuZ0ByZWRoYXQuY29tPgo+Cj4gSSBhbSBjb25mdXNlZCBi
eSB0aGUgYWJvdmUuCj4gV2hhdCBJIHNlZSB1cHN0cmVhbSBpcyA3ZjQ2NjAzMmRjLgo+Cj4gY29t
bWl0IDdmNDY2MDMyZGM5ZTVhNjEyMTdmMjJlYTM0YjJkZjkzMjc4NmJiZmMKPiBBdXRob3I6IEph
c29uIFdhbmcgPGphc293YW5nQHJlZGhhdC5jb20+Cj4gRGF0ZTogICBGcmkgTWF5IDI0IDA0OjEy
OjE4IDIwMTkgLTA0MDAKPgo+ICAgICAgdmhvc3Q6IGFjY2VzcyB2cSBtZXRhZGF0YSB0aHJvdWdo
IGtlcm5lbCB2aXJ0dWFsIGFkZHJlc3MKPgo+IHNvIHRoaXMgaXMgd2hhdCBJIHJldmVydGVkLgo+
Cj4gUGxzIHRha2UgYSBsb29rLCBhbmQgbGV0IG1lIGtub3cgaWYgeW91IHNlZSBpc3N1ZXMuCj4K
PiBUaGFua3MhCgoKWWVzLCBteSBmYXVsdC4KClRoYW5rcwoKCj4+IC0tLQo+PiAgIGRyaXZlcnMv
dmhvc3Qvdmhvc3QuYyB8IDUxNSArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0KPj4gICBkcml2ZXJzL3Zob3N0L3Zob3N0LmggfCAgNDEgLS0tLQo+PiAgIDIgZmlsZXMg
Y2hhbmdlZCwgMyBpbnNlcnRpb25zKCspLCA1NTMgZGVsZXRpb25zKC0pCj4+Cj4+IGRpZmYgLS1n
aXQgYS9kcml2ZXJzL3Zob3N0L3Zob3N0LmMgYi9kcml2ZXJzL3Zob3N0L3Zob3N0LmMKPj4gaW5k
ZXggMDUzNmY4NTI2MzU5Li43OTE1NjJlMDNmZTAgMTAwNjQ0Cj4+IC0tLSBhL2RyaXZlcnMvdmhv
c3Qvdmhvc3QuYwo+PiArKysgYi9kcml2ZXJzL3Zob3N0L3Zob3N0LmMKPj4gQEAgLTI5OCwxNjAg
KzI5OCw2IEBAIHN0YXRpYyB2b2lkIHZob3N0X3ZxX21ldGFfcmVzZXQoc3RydWN0IHZob3N0X2Rl
diAqZCkKPj4gICAJCV9fdmhvc3RfdnFfbWV0YV9yZXNldChkLT52cXNbaV0pOwo+PiAgIH0KPj4g
ICAKPj4gLSNpZiBWSE9TVF9BUkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC1zdGF0aWMgdm9pZCB2
aG9zdF9tYXBfdW5wcmVmZXRjaChzdHJ1Y3Qgdmhvc3RfbWFwICptYXApCj4+IC17Cj4+IC0Ja2Zy
ZWUobWFwLT5wYWdlcyk7Cj4+IC0JbWFwLT5wYWdlcyA9IE5VTEw7Cj4+IC0JbWFwLT5ucGFnZXMg
PSAwOwo+PiAtCW1hcC0+YWRkciA9IE5VTEw7Cj4+IC19Cj4+IC0KPj4gLXN0YXRpYyB2b2lkIHZo
b3N0X3VuaW5pdF92cV9tYXBzKHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxKQo+PiAtewo+PiAt
CXN0cnVjdCB2aG9zdF9tYXAgKm1hcFtWSE9TVF9OVU1fQUREUlNdOwo+PiAtCWludCBpOwo+PiAt
Cj4+IC0Jc3Bpbl9sb2NrKCZ2cS0+bW11X2xvY2spOwo+PiAtCWZvciAoaSA9IDA7IGkgPCBWSE9T
VF9OVU1fQUREUlM7IGkrKykgewo+PiAtCQltYXBbaV0gPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVj
dGVkKHZxLT5tYXBzW2ldLAo+PiAtCQkJCSAgbG9ja2RlcF9pc19oZWxkKCZ2cS0+bW11X2xvY2sp
KTsKPj4gLQkJaWYgKG1hcFtpXSkKPj4gLQkJCXJjdV9hc3NpZ25fcG9pbnRlcih2cS0+bWFwc1tp
XSwgTlVMTCk7Cj4+IC0JfQo+PiAtCXNwaW5fdW5sb2NrKCZ2cS0+bW11X2xvY2spOwo+PiAtCj4+
IC0Jc3luY2hyb25pemVfcmN1KCk7Cj4+IC0KPj4gLQlmb3IgKGkgPSAwOyBpIDwgVkhPU1RfTlVN
X0FERFJTOyBpKyspCj4+IC0JCWlmIChtYXBbaV0pCj4+IC0JCQl2aG9zdF9tYXBfdW5wcmVmZXRj
aChtYXBbaV0pOwo+PiAtCj4+IC19Cj4+IC0KPj4gLXN0YXRpYyB2b2lkIHZob3N0X3Jlc2V0X3Zx
X21hcHMoc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEpCj4+IC17Cj4+IC0JaW50IGk7Cj4+IC0K
Pj4gLQl2aG9zdF91bmluaXRfdnFfbWFwcyh2cSk7Cj4+IC0JZm9yIChpID0gMDsgaSA8IFZIT1NU
X05VTV9BRERSUzsgaSsrKQo+PiAtCQl2cS0+dWFkZHJzW2ldLnNpemUgPSAwOwo+PiAtfQo+PiAt
Cj4+IC1zdGF0aWMgYm9vbCB2aG9zdF9tYXBfcmFuZ2Vfb3ZlcmxhcChzdHJ1Y3Qgdmhvc3RfdWFk
ZHIgKnVhZGRyLAo+PiAtCQkJCSAgICAgdW5zaWduZWQgbG9uZyBzdGFydCwKPj4gLQkJCQkgICAg
IHVuc2lnbmVkIGxvbmcgZW5kKQo+PiAtewo+PiAtCWlmICh1bmxpa2VseSghdWFkZHItPnNpemUp
KQo+PiAtCQlyZXR1cm4gZmFsc2U7Cj4+IC0KPj4gLQlyZXR1cm4gIShlbmQgPCB1YWRkci0+dWFk
ZHIgfHwgc3RhcnQgPiB1YWRkci0+dWFkZHIgLSAxICsgdWFkZHItPnNpemUpOwo+PiAtfQo+PiAt
Cj4+IC1zdGF0aWMgdm9pZCB2aG9zdF9pbnZhbGlkYXRlX3ZxX3N0YXJ0KHN0cnVjdCB2aG9zdF92
aXJ0cXVldWUgKnZxLAo+PiAtCQkJCSAgICAgIGludCBpbmRleCwKPj4gLQkJCQkgICAgICB1bnNp
Z25lZCBsb25nIHN0YXJ0LAo+PiAtCQkJCSAgICAgIHVuc2lnbmVkIGxvbmcgZW5kKQo+PiAtewo+
PiAtCXN0cnVjdCB2aG9zdF91YWRkciAqdWFkZHIgPSAmdnEtPnVhZGRyc1tpbmRleF07Cj4+IC0J
c3RydWN0IHZob3N0X21hcCAqbWFwOwo+PiAtCWludCBpOwo+PiAtCj4+IC0JaWYgKCF2aG9zdF9t
YXBfcmFuZ2Vfb3ZlcmxhcCh1YWRkciwgc3RhcnQsIGVuZCkpCj4+IC0JCXJldHVybjsKPj4gLQo+
PiAtCXNwaW5fbG9jaygmdnEtPm1tdV9sb2NrKTsKPj4gLQkrK3ZxLT5pbnZhbGlkYXRlX2NvdW50
Owo+PiAtCj4+IC0JbWFwID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZCh2cS0+bWFwc1tpbmRl
eF0sCj4+IC0JCQkJCWxvY2tkZXBfaXNfaGVsZCgmdnEtPm1tdV9sb2NrKSk7Cj4+IC0JaWYgKG1h
cCkgewo+PiAtCQlpZiAodWFkZHItPndyaXRlKSB7Cj4+IC0JCQlmb3IgKGkgPSAwOyBpIDwgbWFw
LT5ucGFnZXM7IGkrKykKPj4gLQkJCQlzZXRfcGFnZV9kaXJ0eShtYXAtPnBhZ2VzW2ldKTsKPj4g
LQkJfQo+PiAtCQlyY3VfYXNzaWduX3BvaW50ZXIodnEtPm1hcHNbaW5kZXhdLCBOVUxMKTsKPj4g
LQl9Cj4+IC0Jc3Bpbl91bmxvY2soJnZxLT5tbXVfbG9jayk7Cj4+IC0KPj4gLQlpZiAobWFwKSB7
Cj4+IC0JCXN5bmNocm9uaXplX3JjdSgpOwo+PiAtCQl2aG9zdF9tYXBfdW5wcmVmZXRjaChtYXAp
Owo+PiAtCX0KPj4gLX0KPj4gLQo+PiAtc3RhdGljIHZvaWQgdmhvc3RfaW52YWxpZGF0ZV92cV9l
bmQoc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4+IC0JCQkJICAgIGludCBpbmRleCwKPj4g
LQkJCQkgICAgdW5zaWduZWQgbG9uZyBzdGFydCwKPj4gLQkJCQkgICAgdW5zaWduZWQgbG9uZyBl
bmQpCj4+IC17Cj4+IC0JaWYgKCF2aG9zdF9tYXBfcmFuZ2Vfb3ZlcmxhcCgmdnEtPnVhZGRyc1tp
bmRleF0sIHN0YXJ0LCBlbmQpKQo+PiAtCQlyZXR1cm47Cj4+IC0KPj4gLQlzcGluX2xvY2soJnZx
LT5tbXVfbG9jayk7Cj4+IC0JLS12cS0+aW52YWxpZGF0ZV9jb3VudDsKPj4gLQlzcGluX3VubG9j
aygmdnEtPm1tdV9sb2NrKTsKPj4gLX0KPj4gLQo+PiAtc3RhdGljIGludCB2aG9zdF9pbnZhbGlk
YXRlX3JhbmdlX3N0YXJ0KHN0cnVjdCBtbXVfbm90aWZpZXIgKm1uLAo+PiAtCQkJCQljb25zdCBz
dHJ1Y3QgbW11X25vdGlmaWVyX3JhbmdlICpyYW5nZSkKPj4gLXsKPj4gLQlzdHJ1Y3Qgdmhvc3Rf
ZGV2ICpkZXYgPSBjb250YWluZXJfb2YobW4sIHN0cnVjdCB2aG9zdF9kZXYsCj4+IC0JCQkJCSAg
ICAgbW11X25vdGlmaWVyKTsKPj4gLQlpbnQgaSwgajsKPj4gLQo+PiAtCWlmICghbW11X25vdGlm
aWVyX3JhbmdlX2Jsb2NrYWJsZShyYW5nZSkpCj4+IC0JCXJldHVybiAtRUFHQUlOOwo+PiAtCj4+
IC0JZm9yIChpID0gMDsgaSA8IGRldi0+bnZxczsgaSsrKSB7Cj4+IC0JCXN0cnVjdCB2aG9zdF92
aXJ0cXVldWUgKnZxID0gZGV2LT52cXNbaV07Cj4+IC0KPj4gLQkJZm9yIChqID0gMDsgaiA8IFZI
T1NUX05VTV9BRERSUzsgaisrKQo+PiAtCQkJdmhvc3RfaW52YWxpZGF0ZV92cV9zdGFydCh2cSwg
aiwKPj4gLQkJCQkJCSAgcmFuZ2UtPnN0YXJ0LAo+PiAtCQkJCQkJICByYW5nZS0+ZW5kKTsKPj4g
LQl9Cj4+IC0KPj4gLQlyZXR1cm4gMDsKPj4gLX0KPj4gLQo+PiAtc3RhdGljIHZvaWQgdmhvc3Rf
aW52YWxpZGF0ZV9yYW5nZV9lbmQoc3RydWN0IG1tdV9ub3RpZmllciAqbW4sCj4+IC0JCQkJICAg
ICAgIGNvbnN0IHN0cnVjdCBtbXVfbm90aWZpZXJfcmFuZ2UgKnJhbmdlKQo+PiAtewo+PiAtCXN0
cnVjdCB2aG9zdF9kZXYgKmRldiA9IGNvbnRhaW5lcl9vZihtbiwgc3RydWN0IHZob3N0X2RldiwK
Pj4gLQkJCQkJICAgICBtbXVfbm90aWZpZXIpOwo+PiAtCWludCBpLCBqOwo+PiAtCj4+IC0JZm9y
IChpID0gMDsgaSA8IGRldi0+bnZxczsgaSsrKSB7Cj4+IC0JCXN0cnVjdCB2aG9zdF92aXJ0cXVl
dWUgKnZxID0gZGV2LT52cXNbaV07Cj4+IC0KPj4gLQkJZm9yIChqID0gMDsgaiA8IFZIT1NUX05V
TV9BRERSUzsgaisrKQo+PiAtCQkJdmhvc3RfaW52YWxpZGF0ZV92cV9lbmQodnEsIGosCj4+IC0J
CQkJCQlyYW5nZS0+c3RhcnQsCj4+IC0JCQkJCQlyYW5nZS0+ZW5kKTsKPj4gLQl9Cj4+IC19Cj4+
IC0KPj4gLXN0YXRpYyBjb25zdCBzdHJ1Y3QgbW11X25vdGlmaWVyX29wcyB2aG9zdF9tbXVfbm90
aWZpZXJfb3BzID0gewo+PiAtCS5pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0ID0gdmhvc3RfaW52YWxp
ZGF0ZV9yYW5nZV9zdGFydCwKPj4gLQkuaW52YWxpZGF0ZV9yYW5nZV9lbmQgPSB2aG9zdF9pbnZh
bGlkYXRlX3JhbmdlX2VuZCwKPj4gLX07Cj4+IC0KPj4gLXN0YXRpYyB2b2lkIHZob3N0X2luaXRf
bWFwcyhzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYpCj4+IC17Cj4+IC0Jc3RydWN0IHZob3N0X3ZpcnRx
dWV1ZSAqdnE7Cj4+IC0JaW50IGksIGo7Cj4+IC0KPj4gLQlkZXYtPm1tdV9ub3RpZmllci5vcHMg
PSAmdmhvc3RfbW11X25vdGlmaWVyX29wczsKPj4gLQo+PiAtCWZvciAoaSA9IDA7IGkgPCBkZXYt
Pm52cXM7ICsraSkgewo+PiAtCQl2cSA9IGRldi0+dnFzW2ldOwo+PiAtCQlmb3IgKGogPSAwOyBq
IDwgVkhPU1RfTlVNX0FERFJTOyBqKyspCj4+IC0JCQlSQ1VfSU5JVF9QT0lOVEVSKHZxLT5tYXBz
W2pdLCBOVUxMKTsKPj4gLQl9Cj4+IC19Cj4+IC0jZW5kaWYKPj4gLQo+PiAgIHN0YXRpYyB2b2lk
IHZob3N0X3ZxX3Jlc2V0KHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPj4gICAJCQkgICBzdHJ1Y3Qg
dmhvc3RfdmlydHF1ZXVlICp2cSkKPj4gICB7Cj4+IEBAIC00ODAsMTEgKzMyNiw3IEBAIHN0YXRp
YyB2b2lkIHZob3N0X3ZxX3Jlc2V0KHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPj4gICAJdnEtPmJ1
c3lsb29wX3RpbWVvdXQgPSAwOwo+PiAgIAl2cS0+dW1lbSA9IE5VTEw7Cj4+ICAgCXZxLT5pb3Rs
YiA9IE5VTEw7Cj4+IC0JdnEtPmludmFsaWRhdGVfY291bnQgPSAwOwo+PiAgIAlfX3Zob3N0X3Zx
X21ldGFfcmVzZXQodnEpOwo+PiAtI2lmIFZIT1NUX0FSQ0hfQ0FOX0FDQ0VMX1VBQ0NFU1MKPj4g
LQl2aG9zdF9yZXNldF92cV9tYXBzKHZxKTsKPj4gLSNlbmRpZgo+PiAgIH0KPj4gICAKPj4gICBz
dGF0aWMgaW50IHZob3N0X3dvcmtlcih2b2lkICpkYXRhKQo+PiBAQCAtNjM0LDkgKzQ3Niw3IEBA
IHZvaWQgdmhvc3RfZGV2X2luaXQoc3RydWN0IHZob3N0X2RldiAqZGV2LAo+PiAgIAlJTklUX0xJ
U1RfSEVBRCgmZGV2LT5yZWFkX2xpc3QpOwo+PiAgIAlJTklUX0xJU1RfSEVBRCgmZGV2LT5wZW5k
aW5nX2xpc3QpOwo+PiAgIAlzcGluX2xvY2tfaW5pdCgmZGV2LT5pb3RsYl9sb2NrKTsKPj4gLSNp
ZiBWSE9TVF9BUkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC0Jdmhvc3RfaW5pdF9tYXBzKGRldik7
Cj4+IC0jZW5kaWYKPj4gKwo+PiAgIAo+PiAgIAlmb3IgKGkgPSAwOyBpIDwgZGV2LT5udnFzOyAr
K2kpIHsKPj4gICAJCXZxID0gZGV2LT52cXNbaV07Cj4+IEBAIC02NDUsNyArNDg1LDYgQEAgdm9p
ZCB2aG9zdF9kZXZfaW5pdChzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYsCj4+ICAgCQl2cS0+aGVhZHMg
PSBOVUxMOwo+PiAgIAkJdnEtPmRldiA9IGRldjsKPj4gICAJCW11dGV4X2luaXQoJnZxLT5tdXRl
eCk7Cj4+IC0JCXNwaW5fbG9ja19pbml0KCZ2cS0+bW11X2xvY2spOwo+PiAgIAkJdmhvc3RfdnFf
cmVzZXQoZGV2LCB2cSk7Cj4+ICAgCQlpZiAodnEtPmhhbmRsZV9raWNrKQo+PiAgIAkJCXZob3N0
X3BvbGxfaW5pdCgmdnEtPnBvbGwsIHZxLT5oYW5kbGVfa2ljaywKPj4gQEAgLTcyNSwxOCArNTY0
LDcgQEAgbG9uZyB2aG9zdF9kZXZfc2V0X293bmVyKHN0cnVjdCB2aG9zdF9kZXYgKmRldikKPj4g
ICAJaWYgKGVycikKPj4gICAJCWdvdG8gZXJyX2Nncm91cDsKPj4gICAKPj4gLSNpZiBWSE9TVF9B
UkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC0JZXJyID0gbW11X25vdGlmaWVyX3JlZ2lzdGVyKCZk
ZXYtPm1tdV9ub3RpZmllciwgZGV2LT5tbSk7Cj4+IC0JaWYgKGVycikKPj4gLQkJZ290byBlcnJf
bW11X25vdGlmaWVyOwo+PiAtI2VuZGlmCj4+IC0KPj4gICAJcmV0dXJuIDA7Cj4+IC0KPj4gLSNp
ZiBWSE9TVF9BUkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC1lcnJfbW11X25vdGlmaWVyOgo+PiAt
CXZob3N0X2Rldl9mcmVlX2lvdmVjcyhkZXYpOwo+PiAtI2VuZGlmCj4+ICAgZXJyX2Nncm91cDoK
Pj4gICAJa3RocmVhZF9zdG9wKHdvcmtlcik7Cj4+ICAgCWRldi0+d29ya2VyID0gTlVMTDsKPj4g
QEAgLTgyNywxMDcgKzY1NSw2IEBAIHN0YXRpYyB2b2lkIHZob3N0X2NsZWFyX21zZyhzdHJ1Y3Qg
dmhvc3RfZGV2ICpkZXYpCj4+ICAgCXNwaW5fdW5sb2NrKCZkZXYtPmlvdGxiX2xvY2spOwo+PiAg
IH0KPj4gICAKPj4gLSNpZiBWSE9TVF9BUkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC1zdGF0aWMg
dm9pZCB2aG9zdF9zZXR1cF91YWRkcihzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSwKPj4gLQkJ
CSAgICAgIGludCBpbmRleCwgdW5zaWduZWQgbG9uZyB1YWRkciwKPj4gLQkJCSAgICAgIHNpemVf
dCBzaXplLCBib29sIHdyaXRlKQo+PiAtewo+PiAtCXN0cnVjdCB2aG9zdF91YWRkciAqYWRkciA9
ICZ2cS0+dWFkZHJzW2luZGV4XTsKPj4gLQo+PiAtCWFkZHItPnVhZGRyID0gdWFkZHI7Cj4+IC0J
YWRkci0+c2l6ZSA9IHNpemU7Cj4+IC0JYWRkci0+d3JpdGUgPSB3cml0ZTsKPj4gLX0KPj4gLQo+
PiAtc3RhdGljIHZvaWQgdmhvc3Rfc2V0dXBfdnFfdWFkZHIoc3RydWN0IHZob3N0X3ZpcnRxdWV1
ZSAqdnEpCj4+IC17Cj4+IC0Jdmhvc3Rfc2V0dXBfdWFkZHIodnEsIFZIT1NUX0FERFJfREVTQywK
Pj4gLQkJCSAgKHVuc2lnbmVkIGxvbmcpdnEtPmRlc2MsCj4+IC0JCQkgIHZob3N0X2dldF9kZXNj
X3NpemUodnEsIHZxLT5udW0pLAo+PiAtCQkJICBmYWxzZSk7Cj4+IC0Jdmhvc3Rfc2V0dXBfdWFk
ZHIodnEsIFZIT1NUX0FERFJfQVZBSUwsCj4+IC0JCQkgICh1bnNpZ25lZCBsb25nKXZxLT5hdmFp
bCwKPj4gLQkJCSAgdmhvc3RfZ2V0X2F2YWlsX3NpemUodnEsIHZxLT5udW0pLAo+PiAtCQkJICBm
YWxzZSk7Cj4+IC0Jdmhvc3Rfc2V0dXBfdWFkZHIodnEsIFZIT1NUX0FERFJfVVNFRCwKPj4gLQkJ
CSAgKHVuc2lnbmVkIGxvbmcpdnEtPnVzZWQsCj4+IC0JCQkgIHZob3N0X2dldF91c2VkX3NpemUo
dnEsIHZxLT5udW0pLAo+PiAtCQkJICB0cnVlKTsKPj4gLX0KPj4gLQo+PiAtc3RhdGljIGludCB2
aG9zdF9tYXBfcHJlZmV0Y2goc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4+IC0JCQkgICAg
ICAgaW50IGluZGV4KQo+PiAtewo+PiAtCXN0cnVjdCB2aG9zdF9tYXAgKm1hcDsKPj4gLQlzdHJ1
Y3Qgdmhvc3RfdWFkZHIgKnVhZGRyID0gJnZxLT51YWRkcnNbaW5kZXhdOwo+PiAtCXN0cnVjdCBw
YWdlICoqcGFnZXM7Cj4+IC0JaW50IG5wYWdlcyA9IERJVl9ST1VORF9VUCh1YWRkci0+c2l6ZSwg
UEFHRV9TSVpFKTsKPj4gLQlpbnQgbnBpbm5lZDsKPj4gLQl2b2lkICp2YWRkciwgKnY7Cj4+IC0J
aW50IGVycjsKPj4gLQlpbnQgaTsKPj4gLQo+PiAtCXNwaW5fbG9jaygmdnEtPm1tdV9sb2NrKTsK
Pj4gLQo+PiAtCWVyciA9IC1FRkFVTFQ7Cj4+IC0JaWYgKHZxLT5pbnZhbGlkYXRlX2NvdW50KQo+
PiAtCQlnb3RvIGVycjsKPj4gLQo+PiAtCWVyciA9IC1FTk9NRU07Cj4+IC0JbWFwID0ga21hbGxv
YyhzaXplb2YoKm1hcCksIEdGUF9BVE9NSUMpOwo+PiAtCWlmICghbWFwKQo+PiAtCQlnb3RvIGVy
cjsKPj4gLQo+PiAtCXBhZ2VzID0ga21hbGxvY19hcnJheShucGFnZXMsIHNpemVvZihzdHJ1Y3Qg
cGFnZSAqKSwgR0ZQX0FUT01JQyk7Cj4+IC0JaWYgKCFwYWdlcykKPj4gLQkJZ290byBlcnJfcGFn
ZXM7Cj4+IC0KPj4gLQllcnIgPSBFRkFVTFQ7Cj4+IC0JbnBpbm5lZCA9IF9fZ2V0X3VzZXJfcGFn
ZXNfZmFzdCh1YWRkci0+dWFkZHIsIG5wYWdlcywKPj4gLQkJCQkJdWFkZHItPndyaXRlLCBwYWdl
cyk7Cj4+IC0JaWYgKG5waW5uZWQgPiAwKQo+PiAtCQlyZWxlYXNlX3BhZ2VzKHBhZ2VzLCBucGlu
bmVkKTsKPj4gLQlpZiAobnBpbm5lZCAhPSBucGFnZXMpCj4+IC0JCWdvdG8gZXJyX2d1cDsKPj4g
LQo+PiAtCWZvciAoaSA9IDA7IGkgPCBucGlubmVkOyBpKyspCj4+IC0JCWlmIChQYWdlSGlnaE1l
bShwYWdlc1tpXSkpCj4+IC0JCQlnb3RvIGVycl9ndXA7Cj4+IC0KPj4gLQl2YWRkciA9IHYgPSBw
YWdlX2FkZHJlc3MocGFnZXNbMF0pOwo+PiAtCj4+IC0JLyogRm9yIHNpbXBsaWNpdHksIGZhbGxi
YWNrIHRvIHVzZXJzcGFjZSBhZGRyZXNzIGlmIFZBIGlzIG5vdAo+PiAtCSAqIGNvbnRpZ2lvdXMu
Cj4+IC0JICovCj4+IC0JZm9yIChpID0gMTsgaSA8IG5waW5uZWQ7IGkrKykgewo+PiAtCQl2ICs9
IFBBR0VfU0laRTsKPj4gLQkJaWYgKHYgIT0gcGFnZV9hZGRyZXNzKHBhZ2VzW2ldKSkKPj4gLQkJ
CWdvdG8gZXJyX2d1cDsKPj4gLQl9Cj4+IC0KPj4gLQltYXAtPmFkZHIgPSB2YWRkciArICh1YWRk
ci0+dWFkZHIgJiAoUEFHRV9TSVpFIC0gMSkpOwo+PiAtCW1hcC0+bnBhZ2VzID0gbnBhZ2VzOwo+
PiAtCW1hcC0+cGFnZXMgPSBwYWdlczsKPj4gLQo+PiAtCXJjdV9hc3NpZ25fcG9pbnRlcih2cS0+
bWFwc1tpbmRleF0sIG1hcCk7Cj4+IC0JLyogTm8gbmVlZCBmb3IgYSBzeW5jaHJvbml6ZV9yY3Uo
KS4gVGhpcyBmdW5jdGlvbiBzaG91bGQgYmUKPj4gLQkgKiBjYWxsZWQgYnkgZGV2LT53b3JrZXIg
c28gd2UgYXJlIHNlcmlhbGl6ZWQgd2l0aCBhbGwKPj4gLQkgKiByZWFkZXJzLgo+PiAtCSAqLwo+
PiAtCXNwaW5fdW5sb2NrKCZ2cS0+bW11X2xvY2spOwo+PiAtCj4+IC0JcmV0dXJuIDA7Cj4+IC0K
Pj4gLWVycl9ndXA6Cj4+IC0Ja2ZyZWUocGFnZXMpOwo+PiAtZXJyX3BhZ2VzOgo+PiAtCWtmcmVl
KG1hcCk7Cj4+IC1lcnI6Cj4+IC0Jc3Bpbl91bmxvY2soJnZxLT5tbXVfbG9jayk7Cj4+IC0JcmV0
dXJuIGVycjsKPj4gLX0KPj4gLSNlbmRpZgo+PiAtCj4+ICAgdm9pZCB2aG9zdF9kZXZfY2xlYW51
cChzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYpCj4+ICAgewo+PiAgIAlpbnQgaTsKPj4gQEAgLTk1Nywx
NiArNjg0LDggQEAgdm9pZCB2aG9zdF9kZXZfY2xlYW51cChzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYp
Cj4+ICAgCQlrdGhyZWFkX3N0b3AoZGV2LT53b3JrZXIpOwo+PiAgIAkJZGV2LT53b3JrZXIgPSBO
VUxMOwo+PiAgIAl9Cj4+IC0JaWYgKGRldi0+bW0pIHsKPj4gLSNpZiBWSE9TVF9BUkNIX0NBTl9B
Q0NFTF9VQUNDRVNTCj4+IC0JCW1tdV9ub3RpZmllcl91bnJlZ2lzdGVyKCZkZXYtPm1tdV9ub3Rp
ZmllciwgZGV2LT5tbSk7Cj4+IC0jZW5kaWYKPj4gKwlpZiAoZGV2LT5tbSkKPj4gICAJCW1tcHV0
KGRldi0+bW0pOwo+PiAtCX0KPj4gLSNpZiBWSE9TVF9BUkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+
IC0JZm9yIChpID0gMDsgaSA8IGRldi0+bnZxczsgaSsrKQo+PiAtCQl2aG9zdF91bmluaXRfdnFf
bWFwcyhkZXYtPnZxc1tpXSk7Cj4+IC0jZW5kaWYKPj4gICAJZGV2LT5tbSA9IE5VTEw7Cj4+ICAg
fQo+PiAgIEVYUE9SVF9TWU1CT0xfR1BMKHZob3N0X2Rldl9jbGVhbnVwKTsKPj4gQEAgLTExOTUs
MjYgKzkxNCw2IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBfX3VzZXIgKl9fdmhvc3RfZ2V0X3VzZXIo
c3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4+ICAgCj4+ICAgc3RhdGljIGlubGluZSBpbnQg
dmhvc3RfcHV0X2F2YWlsX2V2ZW50KHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxKQo+PiAgIHsK
Pj4gLSNpZiBWSE9TVF9BUkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC0Jc3RydWN0IHZob3N0X21h
cCAqbWFwOwo+PiAtCXN0cnVjdCB2cmluZ191c2VkICp1c2VkOwo+PiAtCj4+IC0JaWYgKCF2cS0+
aW90bGIpIHsKPj4gLQkJcmN1X3JlYWRfbG9jaygpOwo+PiAtCj4+IC0JCW1hcCA9IHJjdV9kZXJl
ZmVyZW5jZSh2cS0+bWFwc1tWSE9TVF9BRERSX1VTRURdKTsKPj4gLQkJaWYgKGxpa2VseShtYXAp
KSB7Cj4+IC0JCQl1c2VkID0gbWFwLT5hZGRyOwo+PiAtCQkJKigoX192aXJ0aW8xNiAqKSZ1c2Vk
LT5yaW5nW3ZxLT5udW1dKSA9Cj4+IC0JCQkJY3B1X3RvX3Zob3N0MTYodnEsIHZxLT5hdmFpbF9p
ZHgpOwo+PiAtCQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4+IC0JCQlyZXR1cm4gMDsKPj4gLQkJfQo+
PiAtCj4+IC0JCXJjdV9yZWFkX3VubG9jaygpOwo+PiAtCX0KPj4gLSNlbmRpZgo+PiAtCj4+ICAg
CXJldHVybiB2aG9zdF9wdXRfdXNlcih2cSwgY3B1X3RvX3Zob3N0MTYodnEsIHZxLT5hdmFpbF9p
ZHgpLAo+PiAgIAkJCSAgICAgIHZob3N0X2F2YWlsX2V2ZW50KHZxKSk7Cj4+ICAgfQo+PiBAQCAt
MTIyMywyNyArOTIyLDYgQEAgc3RhdGljIGlubGluZSBpbnQgdmhvc3RfcHV0X3VzZWQoc3RydWN0
IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4+ICAgCQkJCSBzdHJ1Y3QgdnJpbmdfdXNlZF9lbGVtICpo
ZWFkLCBpbnQgaWR4LAo+PiAgIAkJCQkgaW50IGNvdW50KQo+PiAgIHsKPj4gLSNpZiBWSE9TVF9B
UkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC0Jc3RydWN0IHZob3N0X21hcCAqbWFwOwo+PiAtCXN0
cnVjdCB2cmluZ191c2VkICp1c2VkOwo+PiAtCXNpemVfdCBzaXplOwo+PiAtCj4+IC0JaWYgKCF2
cS0+aW90bGIpIHsKPj4gLQkJcmN1X3JlYWRfbG9jaygpOwo+PiAtCj4+IC0JCW1hcCA9IHJjdV9k
ZXJlZmVyZW5jZSh2cS0+bWFwc1tWSE9TVF9BRERSX1VTRURdKTsKPj4gLQkJaWYgKGxpa2VseSht
YXApKSB7Cj4+IC0JCQl1c2VkID0gbWFwLT5hZGRyOwo+PiAtCQkJc2l6ZSA9IGNvdW50ICogc2l6
ZW9mKCpoZWFkKTsKPj4gLQkJCW1lbWNweSh1c2VkLT5yaW5nICsgaWR4LCBoZWFkLCBzaXplKTsK
Pj4gLQkJCXJjdV9yZWFkX3VubG9jaygpOwo+PiAtCQkJcmV0dXJuIDA7Cj4+IC0JCX0KPj4gLQo+
PiAtCQlyY3VfcmVhZF91bmxvY2soKTsKPj4gLQl9Cj4+IC0jZW5kaWYKPj4gLQo+PiAgIAlyZXR1
cm4gdmhvc3RfY29weV90b191c2VyKHZxLCB2cS0+dXNlZC0+cmluZyArIGlkeCwgaGVhZCwKPj4g
ICAJCQkJICBjb3VudCAqIHNpemVvZigqaGVhZCkpOwo+PiAgIH0KPj4gQEAgLTEyNTEsMjUgKzky
OSw2IEBAIHN0YXRpYyBpbmxpbmUgaW50IHZob3N0X3B1dF91c2VkKHN0cnVjdCB2aG9zdF92aXJ0
cXVldWUgKnZxLAo+PiAgIHN0YXRpYyBpbmxpbmUgaW50IHZob3N0X3B1dF91c2VkX2ZsYWdzKHN0
cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxKQo+PiAgIAo+PiAgIHsKPj4gLSNpZiBWSE9TVF9BUkNI
X0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC0Jc3RydWN0IHZob3N0X21hcCAqbWFwOwo+PiAtCXN0cnVj
dCB2cmluZ191c2VkICp1c2VkOwo+PiAtCj4+IC0JaWYgKCF2cS0+aW90bGIpIHsKPj4gLQkJcmN1
X3JlYWRfbG9jaygpOwo+PiAtCj4+IC0JCW1hcCA9IHJjdV9kZXJlZmVyZW5jZSh2cS0+bWFwc1tW
SE9TVF9BRERSX1VTRURdKTsKPj4gLQkJaWYgKGxpa2VseShtYXApKSB7Cj4+IC0JCQl1c2VkID0g
bWFwLT5hZGRyOwo+PiAtCQkJdXNlZC0+ZmxhZ3MgPSBjcHVfdG9fdmhvc3QxNih2cSwgdnEtPnVz
ZWRfZmxhZ3MpOwo+PiAtCQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4+IC0JCQlyZXR1cm4gMDsKPj4g
LQkJfQo+PiAtCj4+IC0JCXJjdV9yZWFkX3VubG9jaygpOwo+PiAtCX0KPj4gLSNlbmRpZgo+PiAt
Cj4+ICAgCXJldHVybiB2aG9zdF9wdXRfdXNlcih2cSwgY3B1X3RvX3Zob3N0MTYodnEsIHZxLT51
c2VkX2ZsYWdzKSwKPj4gICAJCQkgICAgICAmdnEtPnVzZWQtPmZsYWdzKTsKPj4gICB9Cj4+IEBA
IC0xMjc3LDI1ICs5MzYsNiBAQCBzdGF0aWMgaW5saW5lIGludCB2aG9zdF9wdXRfdXNlZF9mbGFn
cyhzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSkKPj4gICBzdGF0aWMgaW5saW5lIGludCB2aG9z
dF9wdXRfdXNlZF9pZHgoc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEpCj4+ICAgCj4+ICAgewo+
PiAtI2lmIFZIT1NUX0FSQ0hfQ0FOX0FDQ0VMX1VBQ0NFU1MKPj4gLQlzdHJ1Y3Qgdmhvc3RfbWFw
ICptYXA7Cj4+IC0Jc3RydWN0IHZyaW5nX3VzZWQgKnVzZWQ7Cj4+IC0KPj4gLQlpZiAoIXZxLT5p
b3RsYikgewo+PiAtCQlyY3VfcmVhZF9sb2NrKCk7Cj4+IC0KPj4gLQkJbWFwID0gcmN1X2RlcmVm
ZXJlbmNlKHZxLT5tYXBzW1ZIT1NUX0FERFJfVVNFRF0pOwo+PiAtCQlpZiAobGlrZWx5KG1hcCkp
IHsKPj4gLQkJCXVzZWQgPSBtYXAtPmFkZHI7Cj4+IC0JCQl1c2VkLT5pZHggPSBjcHVfdG9fdmhv
c3QxNih2cSwgdnEtPmxhc3RfdXNlZF9pZHgpOwo+PiAtCQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4+
IC0JCQlyZXR1cm4gMDsKPj4gLQkJfQo+PiAtCj4+IC0JCXJjdV9yZWFkX3VubG9jaygpOwo+PiAt
CX0KPj4gLSNlbmRpZgo+PiAtCj4+ICAgCXJldHVybiB2aG9zdF9wdXRfdXNlcih2cSwgY3B1X3Rv
X3Zob3N0MTYodnEsIHZxLT5sYXN0X3VzZWRfaWR4KSwKPj4gICAJCQkgICAgICAmdnEtPnVzZWQt
PmlkeCk7Cj4+ICAgfQo+PiBAQCAtMTM0MSw1MCArOTgxLDEyIEBAIHN0YXRpYyB2b2lkIHZob3N0
X2Rldl91bmxvY2tfdnFzKHN0cnVjdCB2aG9zdF9kZXYgKmQpCj4+ICAgc3RhdGljIGlubGluZSBp
bnQgdmhvc3RfZ2V0X2F2YWlsX2lkeChzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSwKPj4gICAJ
CQkJICAgICAgX192aXJ0aW8xNiAqaWR4KQo+PiAgIHsKPj4gLSNpZiBWSE9TVF9BUkNIX0NBTl9B
Q0NFTF9VQUNDRVNTCj4+IC0Jc3RydWN0IHZob3N0X21hcCAqbWFwOwo+PiAtCXN0cnVjdCB2cmlu
Z19hdmFpbCAqYXZhaWw7Cj4+IC0KPj4gLQlpZiAoIXZxLT5pb3RsYikgewo+PiAtCQlyY3VfcmVh
ZF9sb2NrKCk7Cj4+IC0KPj4gLQkJbWFwID0gcmN1X2RlcmVmZXJlbmNlKHZxLT5tYXBzW1ZIT1NU
X0FERFJfQVZBSUxdKTsKPj4gLQkJaWYgKGxpa2VseShtYXApKSB7Cj4+IC0JCQlhdmFpbCA9IG1h
cC0+YWRkcjsKPj4gLQkJCSppZHggPSBhdmFpbC0+aWR4Owo+PiAtCQkJcmN1X3JlYWRfdW5sb2Nr
KCk7Cj4+IC0JCQlyZXR1cm4gMDsKPj4gLQkJfQo+PiAtCj4+IC0JCXJjdV9yZWFkX3VubG9jaygp
Owo+PiAtCX0KPj4gLSNlbmRpZgo+PiAtCj4+ICAgCXJldHVybiB2aG9zdF9nZXRfYXZhaWwodnEs
ICppZHgsICZ2cS0+YXZhaWwtPmlkeCk7Cj4+ICAgfQo+PiAgIAo+PiAgIHN0YXRpYyBpbmxpbmUg
aW50IHZob3N0X2dldF9hdmFpbF9oZWFkKHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxLAo+PiAg
IAkJCQkgICAgICAgX192aXJ0aW8xNiAqaGVhZCwgaW50IGlkeCkKPj4gICB7Cj4+IC0jaWYgVkhP
U1RfQVJDSF9DQU5fQUNDRUxfVUFDQ0VTUwo+PiAtCXN0cnVjdCB2aG9zdF9tYXAgKm1hcDsKPj4g
LQlzdHJ1Y3QgdnJpbmdfYXZhaWwgKmF2YWlsOwo+PiAtCj4+IC0JaWYgKCF2cS0+aW90bGIpIHsK
Pj4gLQkJcmN1X3JlYWRfbG9jaygpOwo+PiAtCj4+IC0JCW1hcCA9IHJjdV9kZXJlZmVyZW5jZSh2
cS0+bWFwc1tWSE9TVF9BRERSX0FWQUlMXSk7Cj4+IC0JCWlmIChsaWtlbHkobWFwKSkgewo+PiAt
CQkJYXZhaWwgPSBtYXAtPmFkZHI7Cj4+IC0JCQkqaGVhZCA9IGF2YWlsLT5yaW5nW2lkeCAmICh2
cS0+bnVtIC0gMSldOwo+PiAtCQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4+IC0JCQlyZXR1cm4gMDsK
Pj4gLQkJfQo+PiAtCj4+IC0JCXJjdV9yZWFkX3VubG9jaygpOwo+PiAtCX0KPj4gLSNlbmRpZgo+
PiAtCj4+ICAgCXJldHVybiB2aG9zdF9nZXRfYXZhaWwodnEsICpoZWFkLAo+PiAgIAkJCSAgICAg
ICAmdnEtPmF2YWlsLT5yaW5nW2lkeCAmICh2cS0+bnVtIC0gMSldKTsKPj4gICB9Cj4+IEBAIC0x
MzkyLDk4ICs5OTQsMjQgQEAgc3RhdGljIGlubGluZSBpbnQgdmhvc3RfZ2V0X2F2YWlsX2hlYWQo
c3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4+ICAgc3RhdGljIGlubGluZSBpbnQgdmhvc3Rf
Z2V0X2F2YWlsX2ZsYWdzKHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxLAo+PiAgIAkJCQkJX192
aXJ0aW8xNiAqZmxhZ3MpCj4+ICAgewo+PiAtI2lmIFZIT1NUX0FSQ0hfQ0FOX0FDQ0VMX1VBQ0NF
U1MKPj4gLQlzdHJ1Y3Qgdmhvc3RfbWFwICptYXA7Cj4+IC0Jc3RydWN0IHZyaW5nX2F2YWlsICph
dmFpbDsKPj4gLQo+PiAtCWlmICghdnEtPmlvdGxiKSB7Cj4+IC0JCXJjdV9yZWFkX2xvY2soKTsK
Pj4gLQo+PiAtCQltYXAgPSByY3VfZGVyZWZlcmVuY2UodnEtPm1hcHNbVkhPU1RfQUREUl9BVkFJ
TF0pOwo+PiAtCQlpZiAobGlrZWx5KG1hcCkpIHsKPj4gLQkJCWF2YWlsID0gbWFwLT5hZGRyOwo+
PiAtCQkJKmZsYWdzID0gYXZhaWwtPmZsYWdzOwo+PiAtCQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4+
IC0JCQlyZXR1cm4gMDsKPj4gLQkJfQo+PiAtCj4+IC0JCXJjdV9yZWFkX3VubG9jaygpOwo+PiAt
CX0KPj4gLSNlbmRpZgo+PiAtCj4+ICAgCXJldHVybiB2aG9zdF9nZXRfYXZhaWwodnEsICpmbGFn
cywgJnZxLT5hdmFpbC0+ZmxhZ3MpOwo+PiAgIH0KPj4gICAKPj4gICBzdGF0aWMgaW5saW5lIGlu
dCB2aG9zdF9nZXRfdXNlZF9ldmVudChzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSwKPj4gICAJ
CQkJICAgICAgIF9fdmlydGlvMTYgKmV2ZW50KQo+PiAgIHsKPj4gLSNpZiBWSE9TVF9BUkNIX0NB
Tl9BQ0NFTF9VQUNDRVNTCj4+IC0Jc3RydWN0IHZob3N0X21hcCAqbWFwOwo+PiAtCXN0cnVjdCB2
cmluZ19hdmFpbCAqYXZhaWw7Cj4+IC0KPj4gLQlpZiAoIXZxLT5pb3RsYikgewo+PiAtCQlyY3Vf
cmVhZF9sb2NrKCk7Cj4+IC0JCW1hcCA9IHJjdV9kZXJlZmVyZW5jZSh2cS0+bWFwc1tWSE9TVF9B
RERSX0FWQUlMXSk7Cj4+IC0JCWlmIChsaWtlbHkobWFwKSkgewo+PiAtCQkJYXZhaWwgPSBtYXAt
PmFkZHI7Cj4+IC0JCQkqZXZlbnQgPSAoX192aXJ0aW8xNilhdmFpbC0+cmluZ1t2cS0+bnVtXTsK
Pj4gLQkJCXJjdV9yZWFkX3VubG9jaygpOwo+PiAtCQkJcmV0dXJuIDA7Cj4+IC0JCX0KPj4gLQkJ
cmN1X3JlYWRfdW5sb2NrKCk7Cj4+IC0JfQo+PiAtI2VuZGlmCj4+IC0KPj4gICAJcmV0dXJuIHZo
b3N0X2dldF9hdmFpbCh2cSwgKmV2ZW50LCB2aG9zdF91c2VkX2V2ZW50KHZxKSk7Cj4+ICAgfQo+
PiAgIAo+PiAgIHN0YXRpYyBpbmxpbmUgaW50IHZob3N0X2dldF91c2VkX2lkeChzdHJ1Y3Qgdmhv
c3RfdmlydHF1ZXVlICp2cSwKPj4gICAJCQkJICAgICBfX3ZpcnRpbzE2ICppZHgpCj4+ICAgewo+
PiAtI2lmIFZIT1NUX0FSQ0hfQ0FOX0FDQ0VMX1VBQ0NFU1MKPj4gLQlzdHJ1Y3Qgdmhvc3RfbWFw
ICptYXA7Cj4+IC0Jc3RydWN0IHZyaW5nX3VzZWQgKnVzZWQ7Cj4+IC0KPj4gLQlpZiAoIXZxLT5p
b3RsYikgewo+PiAtCQlyY3VfcmVhZF9sb2NrKCk7Cj4+IC0KPj4gLQkJbWFwID0gcmN1X2RlcmVm
ZXJlbmNlKHZxLT5tYXBzW1ZIT1NUX0FERFJfVVNFRF0pOwo+PiAtCQlpZiAobGlrZWx5KG1hcCkp
IHsKPj4gLQkJCXVzZWQgPSBtYXAtPmFkZHI7Cj4+IC0JCQkqaWR4ID0gdXNlZC0+aWR4Owo+PiAt
CQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4+IC0JCQlyZXR1cm4gMDsKPj4gLQkJfQo+PiAtCj4+IC0J
CXJjdV9yZWFkX3VubG9jaygpOwo+PiAtCX0KPj4gLSNlbmRpZgo+PiAtCj4+ICAgCXJldHVybiB2
aG9zdF9nZXRfdXNlZCh2cSwgKmlkeCwgJnZxLT51c2VkLT5pZHgpOwo+PiAgIH0KPj4gICAKPj4g
ICBzdGF0aWMgaW5saW5lIGludCB2aG9zdF9nZXRfZGVzYyhzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVl
ICp2cSwKPj4gICAJCQkJIHN0cnVjdCB2cmluZ19kZXNjICpkZXNjLCBpbnQgaWR4KQo+PiAgIHsK
Pj4gLSNpZiBWSE9TVF9BUkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC0Jc3RydWN0IHZob3N0X21h
cCAqbWFwOwo+PiAtCXN0cnVjdCB2cmluZ19kZXNjICpkOwo+PiAtCj4+IC0JaWYgKCF2cS0+aW90
bGIpIHsKPj4gLQkJcmN1X3JlYWRfbG9jaygpOwo+PiAtCj4+IC0JCW1hcCA9IHJjdV9kZXJlZmVy
ZW5jZSh2cS0+bWFwc1tWSE9TVF9BRERSX0RFU0NdKTsKPj4gLQkJaWYgKGxpa2VseShtYXApKSB7
Cj4+IC0JCQlkID0gbWFwLT5hZGRyOwo+PiAtCQkJKmRlc2MgPSAqKGQgKyBpZHgpOwo+PiAtCQkJ
cmN1X3JlYWRfdW5sb2NrKCk7Cj4+IC0JCQlyZXR1cm4gMDsKPj4gLQkJfQo+PiAtCj4+IC0JCXJj
dV9yZWFkX3VubG9jaygpOwo+PiAtCX0KPj4gLSNlbmRpZgo+PiAtCj4+ICAgCXJldHVybiB2aG9z
dF9jb3B5X2Zyb21fdXNlcih2cSwgZGVzYywgdnEtPmRlc2MgKyBpZHgsIHNpemVvZigqZGVzYykp
Owo+PiAgIH0KPj4gICAKPj4gQEAgLTE4MjQsMzIgKzEzNTIsMTIgQEAgc3RhdGljIGJvb2wgaW90
bGJfYWNjZXNzX29rKHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxLAo+PiAgIAlyZXR1cm4gdHJ1
ZTsKPj4gICB9Cj4+ICAgCj4+IC0jaWYgVkhPU1RfQVJDSF9DQU5fQUNDRUxfVUFDQ0VTUwo+PiAt
c3RhdGljIHZvaWQgdmhvc3RfdnFfbWFwX3ByZWZldGNoKHN0cnVjdCB2aG9zdF92aXJ0cXVldWUg
KnZxKQo+PiAtewo+PiAtCXN0cnVjdCB2aG9zdF9tYXAgX19yY3UgKm1hcDsKPj4gLQlpbnQgaTsK
Pj4gLQo+PiAtCWZvciAoaSA9IDA7IGkgPCBWSE9TVF9OVU1fQUREUlM7IGkrKykgewo+PiAtCQly
Y3VfcmVhZF9sb2NrKCk7Cj4+IC0JCW1hcCA9IHJjdV9kZXJlZmVyZW5jZSh2cS0+bWFwc1tpXSk7
Cj4+IC0JCXJjdV9yZWFkX3VubG9jaygpOwo+PiAtCQlpZiAodW5saWtlbHkoIW1hcCkpCj4+IC0J
CQl2aG9zdF9tYXBfcHJlZmV0Y2godnEsIGkpOwo+PiAtCX0KPj4gLX0KPj4gLSNlbmRpZgo+PiAt
Cj4+ICAgaW50IHZxX21ldGFfcHJlZmV0Y2goc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEpCj4+
ICAgewo+PiAgIAl1bnNpZ25lZCBpbnQgbnVtID0gdnEtPm51bTsKPj4gICAKPj4gLQlpZiAoIXZx
LT5pb3RsYikgewo+PiAtI2lmIFZIT1NUX0FSQ0hfQ0FOX0FDQ0VMX1VBQ0NFU1MKPj4gLQkJdmhv
c3RfdnFfbWFwX3ByZWZldGNoKHZxKTsKPj4gLSNlbmRpZgo+PiArCWlmICghdnEtPmlvdGxiKQo+
PiAgIAkJcmV0dXJuIDE7Cj4+IC0JfQo+PiAgIAo+PiAgIAlyZXR1cm4gaW90bGJfYWNjZXNzX29r
KHZxLCBWSE9TVF9BQ0NFU1NfUk8sICh1NjQpKHVpbnRwdHJfdCl2cS0+ZGVzYywKPj4gICAJCQkg
ICAgICAgdmhvc3RfZ2V0X2Rlc2Nfc2l6ZSh2cSwgbnVtKSwgVkhPU1RfQUREUl9ERVNDKSAmJgo+
PiBAQCAtMjA2MCwxNiArMTU2OCw2IEBAIHN0YXRpYyBsb25nIHZob3N0X3ZyaW5nX3NldF9udW1f
YWRkcihzdHJ1Y3Qgdmhvc3RfZGV2ICpkLAo+PiAgIAo+PiAgIAltdXRleF9sb2NrKCZ2cS0+bXV0
ZXgpOwo+PiAgIAo+PiAtI2lmIFZIT1NUX0FSQ0hfQ0FOX0FDQ0VMX1VBQ0NFU1MKPj4gLQkvKiBV
bnJlZ2lzdGVyIE1NVSBub3RpZmVyIHRvIGFsbG93IGludmFsaWRhdGlvbiBjYWxsYmFjawo+PiAt
CSAqIGNhbiBhY2Nlc3MgdnEtPnVhZGRyc1tdIHdpdGhvdXQgaG9sZGluZyBhIGxvY2suCj4+IC0J
ICovCj4+IC0JaWYgKGQtPm1tKQo+PiAtCQltbXVfbm90aWZpZXJfdW5yZWdpc3RlcigmZC0+bW11
X25vdGlmaWVyLCBkLT5tbSk7Cj4+IC0KPj4gLQl2aG9zdF91bmluaXRfdnFfbWFwcyh2cSk7Cj4+
IC0jZW5kaWYKPj4gLQo+PiAgIAlzd2l0Y2ggKGlvY3RsKSB7Cj4+ICAgCWNhc2UgVkhPU1RfU0VU
X1ZSSU5HX05VTToKPj4gICAJCXIgPSB2aG9zdF92cmluZ19zZXRfbnVtKGQsIHZxLCBhcmdwKTsK
Pj4gQEAgLTIwODEsMTMgKzE1NzksNiBAQCBzdGF0aWMgbG9uZyB2aG9zdF92cmluZ19zZXRfbnVt
X2FkZHIoc3RydWN0IHZob3N0X2RldiAqZCwKPj4gICAJCUJVRygpOwo+PiAgIAl9Cj4+ICAgCj4+
IC0jaWYgVkhPU1RfQVJDSF9DQU5fQUNDRUxfVUFDQ0VTUwo+PiAtCXZob3N0X3NldHVwX3ZxX3Vh
ZGRyKHZxKTsKPj4gLQo+PiAtCWlmIChkLT5tbSkKPj4gLQkJbW11X25vdGlmaWVyX3JlZ2lzdGVy
KCZkLT5tbXVfbm90aWZpZXIsIGQtPm1tKTsKPj4gLSNlbmRpZgo+PiAtCj4+ICAgCW11dGV4X3Vu
bG9jaygmdnEtPm11dGV4KTsKPj4gICAKPj4gICAJcmV0dXJuIHI7Cj4+IGRpZmYgLS1naXQgYS9k
cml2ZXJzL3Zob3N0L3Zob3N0LmggYi9kcml2ZXJzL3Zob3N0L3Zob3N0LmgKPj4gaW5kZXggNDJh
OGMyYTEzYWIxLi5lOWVkMjcyMmI2MzMgMTAwNjQ0Cj4+IC0tLSBhL2RyaXZlcnMvdmhvc3Qvdmhv
c3QuaAo+PiArKysgYi9kcml2ZXJzL3Zob3N0L3Zob3N0LmgKPj4gQEAgLTEyLDkgKzEyLDYgQEAK
Pj4gICAjaW5jbHVkZSA8bGludXgvdmlydGlvX2NvbmZpZy5oPgo+PiAgICNpbmNsdWRlIDxsaW51
eC92aXJ0aW9fcmluZy5oPgo+PiAgICNpbmNsdWRlIDxsaW51eC9hdG9taWMuaD4KPj4gLSNpbmNs
dWRlIDxsaW51eC9wYWdlbWFwLmg+Cj4+IC0jaW5jbHVkZSA8bGludXgvbW11X25vdGlmaWVyLmg+
Cj4+IC0jaW5jbHVkZSA8YXNtL2NhY2hlZmx1c2guaD4KPj4gICAKPj4gICBzdHJ1Y3Qgdmhvc3Rf
d29yazsKPj4gICB0eXBlZGVmIHZvaWQgKCp2aG9zdF93b3JrX2ZuX3QpKHN0cnVjdCB2aG9zdF93
b3JrICp3b3JrKTsKPj4gQEAgLTgzLDI0ICs4MCw2IEBAIGVudW0gdmhvc3RfdWFkZHJfdHlwZSB7
Cj4+ICAgCVZIT1NUX05VTV9BRERSUyA9IDMsCj4+ICAgfTsKPj4gICAKPj4gLXN0cnVjdCB2aG9z
dF9tYXAgewo+PiAtCWludCBucGFnZXM7Cj4+IC0Jdm9pZCAqYWRkcjsKPj4gLQlzdHJ1Y3QgcGFn
ZSAqKnBhZ2VzOwo+PiAtfTsKPj4gLQo+PiAtc3RydWN0IHZob3N0X3VhZGRyIHsKPj4gLQl1bnNp
Z25lZCBsb25nIHVhZGRyOwo+PiAtCXNpemVfdCBzaXplOwo+PiAtCWJvb2wgd3JpdGU7Cj4+IC19
Owo+PiAtCj4+IC0jaWYgZGVmaW5lZChDT05GSUdfTU1VX05PVElGSUVSKSAmJiBBUkNIX0lNUExF
TUVOVFNfRkxVU0hfRENBQ0hFX1BBR0UgPT0gMAo+PiAtI2RlZmluZSBWSE9TVF9BUkNIX0NBTl9B
Q0NFTF9VQUNDRVNTIDAKPj4gLSNlbHNlCj4+IC0jZGVmaW5lIFZIT1NUX0FSQ0hfQ0FOX0FDQ0VM
X1VBQ0NFU1MgMAo+PiAtI2VuZGlmCj4+IC0KPj4gICAvKiBUaGUgdmlydHF1ZXVlIHN0cnVjdHVy
ZSBkZXNjcmliZXMgYSBxdWV1ZSBhdHRhY2hlZCB0byBhIGRldmljZS4gKi8KPj4gICBzdHJ1Y3Qg
dmhvc3RfdmlydHF1ZXVlIHsKPj4gICAJc3RydWN0IHZob3N0X2RldiAqZGV2Owo+PiBAQCAtMTEx
LDIyICs5MCw3IEBAIHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgewo+PiAgIAlzdHJ1Y3QgdnJpbmdf
ZGVzYyBfX3VzZXIgKmRlc2M7Cj4+ICAgCXN0cnVjdCB2cmluZ19hdmFpbCBfX3VzZXIgKmF2YWls
Owo+PiAgIAlzdHJ1Y3QgdnJpbmdfdXNlZCBfX3VzZXIgKnVzZWQ7Cj4+IC0KPj4gLSNpZiBWSE9T
VF9BUkNIX0NBTl9BQ0NFTF9VQUNDRVNTCj4+IC0JLyogUmVhZCBieSBtZW1vcnkgYWNjZXNzb3Jz
LCBtb2RpZmllZCBieSBtZXRhIGRhdGEKPj4gLQkgKiBwcmVmZXRjaGluZywgTU1VIG5vdGlmaWVy
IGFuZCB2cmluZyBpb2N0bCgpLgo+PiAtCSAqIFN5bmNob25yaXplZCB0aHJvdWdoIG1tdV9sb2Nr
ICh3cml0ZXJzKSBhbmQgUkNVICh3cml0ZXJzCj4+IC0JICogYW5kIHJlYWRlcnMpLgo+PiAtCSAq
Lwo+PiAtCXN0cnVjdCB2aG9zdF9tYXAgX19yY3UgKm1hcHNbVkhPU1RfTlVNX0FERFJTXTsKPj4g
LQkvKiBSZWFkIGJ5IE1NVSBub3RpZmllciwgbW9kaWZpZWQgYnkgdnJpbmcgaW9jdGwoKSwKPj4g
LQkgKiBzeW5jaHJvbml6ZWQgdGhyb3VnaCBNTVUgbm90aWZpZXIKPj4gLQkgKiByZWdpc3Rlcmlu
Zy91bnJlZ2lzdGVyaW5nLgo+PiAtCSAqLwo+PiAtCXN0cnVjdCB2aG9zdF91YWRkciB1YWRkcnNb
VkhPU1RfTlVNX0FERFJTXTsKPj4gLSNlbmRpZgo+PiAgIAljb25zdCBzdHJ1Y3Qgdmhvc3RfdW1l
bV9ub2RlICptZXRhX2lvdGxiW1ZIT1NUX05VTV9BRERSU107Cj4+IC0KPj4gICAJc3RydWN0IGZp
bGUgKmtpY2s7Cj4+ICAgCXN0cnVjdCBldmVudGZkX2N0eCAqY2FsbF9jdHg7Cj4+ICAgCXN0cnVj
dCBldmVudGZkX2N0eCAqZXJyb3JfY3R4Owo+PiBAQCAtMTgxLDggKzE0NSw2IEBAIHN0cnVjdCB2
aG9zdF92aXJ0cXVldWUgewo+PiAgIAlib29sIHVzZXJfYmU7Cj4+ICAgI2VuZGlmCj4+ICAgCXUz
MiBidXN5bG9vcF90aW1lb3V0Owo+PiAtCXNwaW5sb2NrX3QgbW11X2xvY2s7Cj4+IC0JaW50IGlu
dmFsaWRhdGVfY291bnQ7Cj4+ICAgfTsKPj4gICAKPj4gICBzdHJ1Y3Qgdmhvc3RfbXNnX25vZGUg
ewo+PiBAQCAtMTk2LDkgKzE1OCw2IEBAIHN0cnVjdCB2aG9zdF9tc2dfbm9kZSB7Cj4+ICAgCj4+
ICAgc3RydWN0IHZob3N0X2RldiB7Cj4+ICAgCXN0cnVjdCBtbV9zdHJ1Y3QgKm1tOwo+PiAtI2lm
ZGVmIENPTkZJR19NTVVfTk9USUZJRVIKPj4gLQlzdHJ1Y3QgbW11X25vdGlmaWVyIG1tdV9ub3Rp
ZmllcjsKPj4gLSNlbmRpZgo+PiAgIAlzdHJ1Y3QgbXV0ZXggbXV0ZXg7Cj4+ICAgCXN0cnVjdCB2
aG9zdF92aXJ0cXVldWUgKip2cXM7Cj4+ICAgCWludCBudnFzOwo+PiAtLSAKPj4gMi4xOS4xCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0
aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9y
ZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0
dWFsaXphdGlvbg==
