Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 20FAE155DF7
	for <lists.virtualization@lfdr.de>; Fri,  7 Feb 2020 19:26:09 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id A8EB386ADD;
	Fri,  7 Feb 2020 18:26:07 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id hTPFG14rTuY3; Fri,  7 Feb 2020 18:26:04 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id F249586985;
	Fri,  7 Feb 2020 18:25:59 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id C6892C013E;
	Fri,  7 Feb 2020 18:25:59 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 9E85DC1D85
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:55 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id 83AEE87F79
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:55 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id ESCM6M6RsZ2D
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:54 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by hemlock.osuosl.org (Postfix) with ESMTPS id A924287ED0
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:53 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 01551305D369; Fri,  7 Feb 2020 20:16:42 +0200 (EET)
Received: from host.bbu.bitdefender.biz (unknown [195.210.4.22])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id E63643052069;
 Fri,  7 Feb 2020 20:16:41 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [RFC PATCH v7 75/78] KVM: introspection: add KVMI_EVENT_SINGLESTEP
Date: Fri,  7 Feb 2020 20:16:33 +0200
Message-Id: <20200207181636.1065-76-alazar@bitdefender.com>
In-Reply-To: <20200207181636.1065-1-alazar@bitdefender.com>
References: <20200207181636.1065-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <ncitu@bitdefender.com>,
 Sean Christopherson <sean.j.christopherson@intel.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTmljdciZb3IgQ8OuyJt1IDxuY2l0dUBiaXRkZWZlbmRlci5jb20+CgpUaGlzIGV2ZW50
IGlzIHNlbnQgd2hlbiB0aGUgY3VycmVudCBpbnN0cnVjdGlvbiBoYXMgYmVlbiBzaW5nbGUgc3Rl
cHBlZAp3aXRoIG9yIHdpdGhvdXQgc3VjY2Vzcy4KClNpZ25lZC1vZmYtYnk6IE5pY3XImW9yIEPD
rsibdSA8bmNpdHVAYml0ZGVmZW5kZXIuY29tPgpDby1kZXZlbG9wZWQtYnk6IEFkYWxiZXJ0IExh
esSDciA8YWxhemFyQGJpdGRlZmVuZGVyLmNvbT4KU2lnbmVkLW9mZi1ieTogQWRhbGJlcnQgTGF6
xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgotLS0KIERvY3VtZW50YXRpb24vdmlydC9rdm0v
a3ZtaS5yc3QgICAgICAgICAgICAgICB8IDI4ICsrKysrKysKIGFyY2gveDg2L2t2bS92bXgvdm14
LmMgICAgICAgICAgICAgICAgICAgICAgICB8ICA2ICsrCiBpbmNsdWRlL2xpbnV4L2t2bWlfaG9z
dC5oICAgICAgICAgICAgICAgICAgICAgfCAgNCArCiBpbmNsdWRlL3VhcGkvbGludXgva3ZtaS5o
ICAgICAgICAgICAgICAgICAgICAgfCAgNiArKwogLi4uL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94
ODZfNjQva3ZtaV90ZXN0LmMgIHwgODAgKysrKysrKysrKysrKysrKy0tLQogdmlydC9rdm0vaW50
cm9zcGVjdGlvbi9rdm1pLmMgICAgICAgICAgICAgICAgIHwgNjEgKysrKysrKysrKysrKysKIHZp
cnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCAgICAgICAgICAgICB8ICAxICsKIDcgZmls
ZXMgY2hhbmdlZCwgMTc3IGluc2VydGlvbnMoKyksIDkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCBiL0RvY3VtZW50YXRpb24vdmlydC9r
dm0va3ZtaS5yc3QKaW5kZXggZmZhMTgzNzQ1NzIyLi4zNTE1ZmVhMWViNzUgMTAwNjQ0Ci0tLSBh
L0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKKysrIGIvRG9jdW1lbnRhdGlvbi92aXJ0
L2t2bS9rdm1pLnJzdApAQCAtNTQ3LDYgKzU0Nyw3IEBAIHRoZSBmb2xsb3dpbmcgZXZlbnRzOjoK
IAlLVk1JX0VWRU5UX0hZUEVSQ0FMTAogCUtWTUlfRVZFTlRfTVNSCiAJS1ZNSV9FVkVOVF9QRgor
CUtWTUlfRVZFTlRfU0lOR0xFU1RFUAogCUtWTUlfRVZFTlRfVFJBUAogCUtWTUlfRVZFTlRfWFNF
VEJWCiAKQEAgLTEzNTIsMyArMTM1MywzMCBAQCBUaGUgKkNPTlRJTlVFKiBhY3Rpb24gd2lsbCBj
b250aW51ZSB0aGUgcGFnZSBmYXVsdCBoYW5kbGluZyB2aWEgZW11bGF0aW9uLgogVGhlICpSRVRS
WSogYWN0aW9uIGlzIHVzZWQgYnkgdGhlIGludHJvc3BlY3Rpb24gdG9vbCB0byByZXRyeSB0aGUK
IGV4ZWN1dGlvbiBvZiB0aGUgY3VycmVudCBpbnN0cnVjdGlvbiwgdXN1YWxseSBiZWNhdXNlIGl0
IGNoYW5nZWQgdGhlCiBpbnN0cnVjdGlvbiBwb2ludGVyIG9yIHRoZSBwYWdlIHJlc3RyaWN0aW9u
cy4KKworMTEuIEtWTUlfRVZFTlRfU0lOR0xFU1RFUAorLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LQorCis6QXJjaGl0ZWN0dXJlczogeDg2Cis6VmVyc2lvbnM6ID49IDEKKzpBY3Rpb25zOiBDT05U
SU5VRSwgQ1JBU0gKKzpQYXJhbWV0ZXJzOgorCis6OgorCisJc3RydWN0IGt2bWlfZXZlbnQ7CisK
KzpSZXR1cm5zOgorCis6OgorCisJc3RydWN0IGt2bWlfdmNwdV9oZHI7CisJc3RydWN0IGt2bWlf
ZXZlbnRfcmVwbHk7CisJc3RydWN0IGt2bWlfZXZlbnRfc2luZ2xlc3RlcCB7CisJCV9fdTggZmFp
bGVkOworCQlfX3U4IHBhZGRpbmdbN107CisJfTsKKworVGhpcyBldmVudCBpcyBzZW50IHdoZW4g
dGhlIGN1cnJlbnQgaW5zdHJ1Y3Rpb24gaGFzIGJlZW4gZXhlY3V0ZWQgb3IgdGhlCitzaW5nbGVz
dGVwIGZhaWxlZCBhbmQgdGhlIGludHJvc3BlY3Rpb24gaGFzIGJlZW4gZW5hYmxlZCBmb3IgdGhp
cyBldmVudAorKHNlZSAqKktWTUlfVkNQVV9DT05UUk9MX0VWRU5UUyoqKS4KZGlmZiAtLWdpdCBh
L2FyY2gveDg2L2t2bS92bXgvdm14LmMgYi9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jCmluZGV4IDJh
YWE3NGNhZWZmZi4uZmVjZTQzNWNlNzQzIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0vdm14L3Zt
eC5jCisrKyBiL2FyY2gveDg2L2t2bS92bXgvdm14LmMKQEAgLTU0MzksNiArNTQzOSw3IEBAIHN0
YXRpYyBpbnQgaGFuZGxlX2ludmFsaWRfb3Aoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogCiBzdGF0
aWMgaW50IGhhbmRsZV9tb25pdG9yX3RyYXAoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogeworCWt2
bWlfc2luZ2xlc3RlcF9kb25lKHZjcHUpOwogCXJldHVybiAxOwogfQogCkBAIC01OTk0LDYgKzU5
OTUsMTEgQEAgc3RhdGljIGludCB2bXhfaGFuZGxlX2V4aXQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1
KQogCQl9CiAJfQogCisJaWYgKGt2bWlfdmNwdV9ydW5uaW5nX3NpbmdsZXN0ZXAodmNwdSkgJiYK
KwkgICAgZXhpdF9yZWFzb24gIT0gRVhJVF9SRUFTT05fRVBUX1ZJT0xBVElPTiAmJgorCSAgICBl
eGl0X3JlYXNvbiAhPSBFWElUX1JFQVNPTl9NT05JVE9SX1RSQVBfRkxBRykKKwkJa3ZtaV9zaW5n
bGVzdGVwX2ZhaWxlZCh2Y3B1KTsKKwogCWlmIChleGl0X3JlYXNvbiA8IGt2bV92bXhfbWF4X2V4
aXRfaGFuZGxlcnMKIAkgICAgJiYga3ZtX3ZteF9leGl0X2hhbmRsZXJzW2V4aXRfcmVhc29uXSkg
ewogI2lmZGVmIENPTkZJR19SRVRQT0xJTkUKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgva3Zt
aV9ob3N0LmggYi9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCmluZGV4IDdjODRjYTY4MTQxMS4u
NzIzYTkwMmY0Yjg5IDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCisrKyBi
L2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmgKQEAgLTk1LDYgKzk1LDggQEAgYm9vbCBrdm1pX2h5
cGVyY2FsbF9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwogYm9vbCBrdm1pX2JyZWFrcG9p
bnRfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1NjQgZ3ZhLCB1OCBpbnNuX2xlbik7CiBi
b29sIGt2bWlfZW50ZXJfZ3Vlc3Qoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsKIGJvb2wga3ZtaV92
Y3B1X3J1bm5pbmdfc2luZ2xlc3RlcChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwordm9pZCBrdm1p
X3NpbmdsZXN0ZXBfZG9uZShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwordm9pZCBrdm1pX3Npbmds
ZXN0ZXBfZmFpbGVkKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiAKICNlbHNlCiAKQEAgLTExMyw2
ICsxMTUsOCBAQCBzdGF0aWMgaW5saW5lIGJvb2wga3ZtaV9lbnRlcl9ndWVzdChzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUpCiAJCQl7IHJldHVybiB0cnVlOyB9CiBzdGF0aWMgaW5saW5lIGJvb2wga3Zt
aV92Y3B1X3J1bm5pbmdfc2luZ2xlc3RlcChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJCQl7IHJl
dHVybiBmYWxzZTsgfQorc3RhdGljIHZvaWQga3ZtaV9zaW5nbGVzdGVwX2RvbmUoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1KSB7IH0KK3N0YXRpYyB2b2lkIGt2bWlfc2luZ2xlc3RlcF9mYWlsZWQoc3Ry
dWN0IGt2bV92Y3B1ICp2Y3B1KSB7IH0KIAogI2VuZGlmIC8qIENPTkZJR19LVk1fSU5UUk9TUEVD
VElPTiAqLwogCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oIGIvaW5jbHVk
ZS91YXBpL2xpbnV4L2t2bWkuaAppbmRleCBjNmM1MDE5Y2NmODUuLjM3YzUxZTY0ZDIyYyAxMDA2
NDQKLS0tIGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAorKysgYi9pbmNsdWRlL3VhcGkvbGlu
dXgva3ZtaS5oCkBAIC01OSw2ICs1OSw3IEBAIGVudW0gewogCUtWTUlfRVZFTlRfREVTQ1JJUFRP
UiA9IDcsCiAJS1ZNSV9FVkVOVF9NU1IgICAgICAgID0gOCwKIAlLVk1JX0VWRU5UX1BGICAgICAg
ICAgPSA5LAorCUtWTUlfRVZFTlRfU0lOR0xFU1RFUCA9IDEwLAogCiAJS1ZNSV9OVU1fRVZFTlRT
CiB9OwpAQCAtMTk5LDQgKzIwMCw5IEBAIHN0cnVjdCBrdm1pX2V2ZW50X3BmIHsKIAlfX3UzMiBw
YWRkaW5nMzsKIH07CiAKK3N0cnVjdCBrdm1pX2V2ZW50X3NpbmdsZXN0ZXAgeworCV9fdTggZmFp
bGVkOworCV9fdTggcGFkZGluZ1s3XTsKK307CisKICNlbmRpZiAvKiBfVUFQSV9fTElOVVhfS1ZN
SV9IICovCmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2
bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3Qu
YwppbmRleCAwOTBjYjdhY2QyZWQuLmNmNWVkZjkxMTk3ZCAxMDA2NDQKLS0tIGEvdG9vbHMvdGVz
dGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYworKysgYi90b29scy90ZXN0aW5n
L3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCkBAIC03MzgsNiArNzM4LDE0IEBAIHN0
YXRpYyB2b2lkIHN0b3BfdmNwdV93b3JrZXIocHRocmVhZF90IHZjcHVfdGhyZWFkLAogCXdhaXRf
dmNwdV93b3JrZXIodmNwdV90aHJlYWQpOwogfQogCitzdGF0aWMgaW50IF9fZG9fdmNwdV9jb21t
YW5kKHN0cnVjdCBrdm1fdm0gKnZtLCBpbnQgY21kX2lkLAorCQkJICAgICBzdHJ1Y3Qga3ZtaV9t
c2dfaGRyICpyZXEsIHNpemVfdCByZXFfc2l6ZSwKKwkJCSAgICAgdm9pZCAqcnBsLCBzaXplX3Qg
cnBsX3NpemUpCit7CisJc2VuZF9tZXNzYWdlKGNtZF9pZCwgcmVxLCByZXFfc2l6ZSk7CisJcmV0
dXJuIHJlY2VpdmVfY21kX3JlcGx5KHJlcSwgcnBsLCBycGxfc2l6ZSk7Cit9CisKIHN0YXRpYyBp
bnQgZG9fdmNwdV9jb21tYW5kKHN0cnVjdCBrdm1fdm0gKnZtLCBpbnQgY21kX2lkLAogCQkJICAg
c3RydWN0IGt2bWlfbXNnX2hkciAqcmVxLCBzaXplX3QgcmVxX3NpemUsCiAJCQkgICB2b2lkICpy
cGwsIHNpemVfdCBycGxfc2l6ZSkKQEAgLTc0OCwxMyArNzU2LDI0IEBAIHN0YXRpYyBpbnQgZG9f
dmNwdV9jb21tYW5kKHN0cnVjdCBrdm1fdm0gKnZtLCBpbnQgY21kX2lkLAogCiAJdmNwdV90aHJl
YWQgPSBzdGFydF92Y3B1X3dvcmtlcigmZGF0YSk7CiAKLQlzZW5kX21lc3NhZ2UoY21kX2lkLCBy
ZXEsIHJlcV9zaXplKTsKLQlyID0gcmVjZWl2ZV9jbWRfcmVwbHkocmVxLCBycGwsIHJwbF9zaXpl
KTsKKwlyID0gX19kb192Y3B1X2NvbW1hbmQodm0sIGNtZF9pZCwgcmVxLCByZXFfc2l6ZSwgcnBs
LCBycGxfc2l6ZSk7CiAKIAlzdG9wX3ZjcHVfd29ya2VyKHZjcHVfdGhyZWFkLCAmZGF0YSk7CiAJ
cmV0dXJuIHI7CiB9CiAKK3N0YXRpYyBpbnQgX19kb192Y3B1MF9jb21tYW5kKHN0cnVjdCBrdm1f
dm0gKnZtLCBpbnQgY21kX2lkLAorCQkJICAgICAgc3RydWN0IGt2bWlfbXNnX2hkciAqcmVxLCBz
aXplX3QgcmVxX3NpemUsCisJCQkgICAgICB2b2lkICpycGwsIHNpemVfdCBycGxfc2l6ZSkKK3sK
KwlzdHJ1Y3Qga3ZtaV92Y3B1X2hkciAqdmNwdV9oZHIgPSAoc3RydWN0IGt2bWlfdmNwdV9oZHIg
KilyZXE7CisKKwl2Y3B1X2hkci0+dmNwdSA9IDA7CisKKwlzZW5kX21lc3NhZ2UoY21kX2lkLCBy
ZXEsIHJlcV9zaXplKTsKKwlyZXR1cm4gcmVjZWl2ZV9jbWRfcmVwbHkocmVxLCBycGwsIHJwbF9z
aXplKTsKK30KKwogc3RhdGljIGludCBkb192Y3B1MF9jb21tYW5kKHN0cnVjdCBrdm1fdm0gKnZt
LCBpbnQgY21kX2lkLAogCQkJICAgIHN0cnVjdCBrdm1pX21zZ19oZHIgKnJlcSwgc2l6ZV90IHJl
cV9zaXplLAogCQkJICAgIHZvaWQgKnJwbCwgc2l6ZV90IHJwbF9zaXplKQpAQCAtMTY4MSwyNCAr
MTcwMCw2NyBAQCBzdGF0aWMgdm9pZCB0ZXN0X2V2ZW50X3BmKHN0cnVjdCBrdm1fdm0gKnZtKQog
CXRlc3RfcGYodm0sIGNia190ZXN0X2V2ZW50X3BmKTsKIH0KIAotc3RhdGljIHZvaWQgdGVzdF9j
bWRfdmNwdV9jb250cm9sX3NpbmdsZXN0ZXAoc3RydWN0IGt2bV92bSAqdm0pCitzdGF0aWMgdm9p
ZCBjb250cm9sX3NpbmdsZXN0ZXAoc3RydWN0IGt2bV92bSAqdm0sIGJvb2wgZW5hYmxlKQogewog
CXN0cnVjdCB7CiAJCXN0cnVjdCBrdm1pX21zZ19oZHIgaGRyOwogCQlzdHJ1Y3Qga3ZtaV92Y3B1
X2hkciB2Y3B1X2hkcjsKIAkJc3RydWN0IGt2bWlfdmNwdV9jb250cm9sX3NpbmdsZXN0ZXAgY21k
OwogCX0gcmVxID0ge307CisJaW50IHI7CisKKwlyZXEuY21kLmVuYWJsZSA9IGVuYWJsZTsKKwly
ID0gX19kb192Y3B1MF9jb21tYW5kKHZtLCBLVk1JX1ZDUFVfQ09OVFJPTF9TSU5HTEVTVEVQLAor
CQkJICAgICAgICZyZXEuaGRyLCBzaXplb2YocmVxKSwgTlVMTCwgMCk7CisJVEVTVF9BU1NFUlQo
ciA9PSAwLAorCQkiS1ZNSV9WQ1BVX0NPTlRST0xfU0lOR0xFU1RFUCBmYWlsZWQsIGVycm9yICVk
ICglcylcbiIsCisJCS1yLCBrdm1fc3RyZXJyb3IoLXIpKTsKK30KKworc3RhdGljIHZvaWQgZW5h
YmxlX3NpbmdsZXN0ZXAoc3RydWN0IGt2bV92bSAqdm0pCit7CisJY29udHJvbF9zaW5nbGVzdGVw
KHZtLCB0cnVlKTsKK30KKworc3RhdGljIHZvaWQgZGlzYWJsZV9zaW5nbGVzdGVwKHN0cnVjdCBr
dm1fdm0gKnZtKQoreworCWNvbnRyb2xfc2luZ2xlc3RlcCh2bSwgZmFsc2UpOworfQorCitzdGF0
aWMgdm9pZCB0ZXN0X2NtZF92Y3B1X2NvbnRyb2xfc2luZ2xlc3RlcChzdHJ1Y3Qga3ZtX3ZtICp2
bSkKK3sKKwlzdHJ1Y3QgdmNwdV93b3JrZXJfZGF0YSBkYXRhID0geyAudm0gPSB2bSwgLnZjcHVf
aWQgPSBWQ1BVX0lEIH07CisJc3RydWN0IHsKKwkJc3RydWN0IGt2bWlfZXZlbnQgY29tbW9uOwor
CQlzdHJ1Y3Qga3ZtaV9ldmVudF9zaW5nbGVzdGVwIHNpbmdsZXN0ZXA7CisJfSBldjsKKwlfX3Ux
NiBldmVudF9pZCA9IEtWTUlfRVZFTlRfU0lOR0xFU1RFUDsKKwlzdHJ1Y3QgdmNwdV9yZXBseSBy
cGwgPSB7fTsKKwlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwlwdGhyZWFkX3QgdmNwdV90aHJl
YWQ7CiAKIAlpZiAoIWZlYXR1cmVzLnNpbmdsZXN0ZXApCiAJCXJldHVybjsKIAotCXJlcS5jbWQu
ZW5hYmxlID0gdHJ1ZTsKLQl0ZXN0X3ZjcHUwX2NvbW1hbmQodm0sIEtWTUlfVkNQVV9DT05UUk9M
X1NJTkdMRVNURVAsCi0JCQkgICAmcmVxLmhkciwgc2l6ZW9mKHJlcSksIE5VTEwsIDApOworCWVu
YWJsZV92Y3B1X2V2ZW50KHZtLCBldmVudF9pZCk7CisKKwl2Y3B1X3RocmVhZCA9IHN0YXJ0X3Zj
cHVfd29ya2VyKCZkYXRhKTsKKworCWVuYWJsZV9zaW5nbGVzdGVwKHZtKTsKKworCXJlY2VpdmVf
ZXZlbnQoJmhkciwgJmV2LmNvbW1vbiwgc2l6ZW9mKGV2KSwgZXZlbnRfaWQpOworCisJREVCVUco
IlNJTkdMRVNURVAgZXZlbnQsIHJpcCAweCVsbHggc3VjY2VzcyAlZFxuIiwKKwkJZXYuY29tbW9u
LmFyY2gucmVncy5yaXAsICFldi5zaW5nbGVzdGVwLmZhaWxlZCk7CisKKwlkaXNhYmxlX3Npbmds
ZXN0ZXAodm0pOworCisJcmVwbHlfdG9fZXZlbnQoJmhkciwgJmV2LmNvbW1vbiwgS1ZNSV9FVkVO
VF9BQ1RJT05fQ09OVElOVUUsCisJCQkmcnBsLCBzaXplb2YocnBsKSk7CisKKwlzdG9wX3ZjcHVf
d29ya2VyKHZjcHVfdGhyZWFkLCAmZGF0YSk7CiAKLQlyZXEuY21kLmVuYWJsZSA9IGZhbHNlOwot
CXRlc3RfdmNwdTBfY29tbWFuZCh2bSwgS1ZNSV9WQ1BVX0NPTlRST0xfU0lOR0xFU1RFUCwKLQkJ
CSAgICZyZXEuaGRyLCBzaXplb2YocmVxKSwgTlVMTCwgMCk7CisJZGlzYWJsZV92Y3B1X2V2ZW50
KHZtLCBLVk1JX0VWRU5UX1NJTkdMRVNURVApOwogfQogCiBzdGF0aWMgdm9pZCB0ZXN0X2ludHJv
c3BlY3Rpb24oc3RydWN0IGt2bV92bSAqdm0pCmRpZmYgLS1naXQgYS92aXJ0L2t2bS9pbnRyb3Nw
ZWN0aW9uL2t2bWkuYyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCmluZGV4IGI3OThl
ZWFiNjYxOC4uNWJiM2UxMjUyMjQyIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9u
L2t2bWkuYworKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwpAQCAtMTMxOSwzICsx
MzE5LDY0IEBAIGJvb2wga3ZtaV92Y3B1X3J1bm5pbmdfc2luZ2xlc3RlcChzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUpCiAJcmV0dXJuIHJldDsKIH0KIEVYUE9SVF9TWU1CT0woa3ZtaV92Y3B1X3J1bm5p
bmdfc2luZ2xlc3RlcCk7CisKK3N0YXRpYyB1MzIga3ZtaV9zZW5kX3NpbmdsZXN0ZXAoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1LCBib29sIHN1Y2Nlc3MpCit7CisJc3RydWN0IGt2bWlfZXZlbnRfc2lu
Z2xlc3RlcCBlOworCWludCBlcnIsIGFjdGlvbjsKKworCW1lbXNldCgmZSwgMCwgc2l6ZW9mKGUp
KTsKKwllLmZhaWxlZCA9IHN1Y2Nlc3MgPyAwIDogMTsKKworCWVyciA9IGt2bWlfc2VuZF9ldmVu
dCh2Y3B1LCBLVk1JX0VWRU5UX1NJTkdMRVNURVAsICZlLCBzaXplb2YoZSksCisJCQkgICAgICBO
VUxMLCAwLCAmYWN0aW9uKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gS1ZNSV9FVkVOVF9BQ1RJT05f
Q09OVElOVUU7CisKKwlyZXR1cm4gYWN0aW9uOworfQorCitzdGF0aWMgdm9pZCBfX2t2bWlfc2lu
Z2xlc3RlcF9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGJvb2wgc3VjY2VzcykKK3sKKwlz
dHJ1Y3Qga3ZtX3ZjcHVfaW50cm9zcGVjdGlvbiAqdmNwdWkgPSBWQ1BVSSh2Y3B1KTsKKwl1MzIg
YWN0aW9uOworCisJaWYgKCF2Y3B1aS0+c2luZ2xlc3RlcC5sb29wKQorCQlyZXR1cm47CisKKwlh
Y3Rpb24gPSBrdm1pX3NlbmRfc2luZ2xlc3RlcCh2Y3B1LCBzdWNjZXNzKTsKKwlzd2l0Y2ggKGFj
dGlvbikgeworCWNhc2UgS1ZNSV9FVkVOVF9BQ1RJT05fQ09OVElOVUU6CisJCWJyZWFrOworCWRl
ZmF1bHQ6CisJCWt2bWlfaGFuZGxlX2NvbW1vbl9ldmVudF9hY3Rpb25zKHZjcHUtPmt2bSwgYWN0
aW9uLAorCQkJCQkJIlNJTkdMRVNURVAiKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGt2bWlfc2lu
Z2xlc3RlcF9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGJvb2wgc3VjY2VzcykKK3sKKwlz
dHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWk7CisJc3RydWN0IGt2bSAqa3ZtID0gdmNwdS0+
a3ZtOworCisJa3ZtaSA9IGt2bWlfZ2V0KGt2bSk7CisJaWYgKCFrdm1pKQorCQlyZXR1cm47CisK
KwlpZiAoaXNfZXZlbnRfZW5hYmxlZCh2Y3B1LCBLVk1JX0VWRU5UX1NJTkdMRVNURVApKQorCQlf
X2t2bWlfc2luZ2xlc3RlcF9ldmVudCh2Y3B1LCBzdWNjZXNzKTsKKworCWt2bWlfcHV0KGt2bSk7
Cit9CisKK3ZvaWQga3ZtaV9zaW5nbGVzdGVwX2RvbmUoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQor
eworCWt2bWlfc2luZ2xlc3RlcF9ldmVudCh2Y3B1LCB0cnVlKTsKK30KK0VYUE9SVF9TWU1CT0wo
a3ZtaV9zaW5nbGVzdGVwX2RvbmUpOworCit2b2lkIGt2bWlfc2luZ2xlc3RlcF9mYWlsZWQoc3Ry
dWN0IGt2bV92Y3B1ICp2Y3B1KQoreworCWt2bWlfc2luZ2xlc3RlcF9ldmVudCh2Y3B1LCBmYWxz
ZSk7Cit9CitFWFBPUlRfU1lNQk9MKGt2bWlfc2luZ2xlc3RlcF9mYWlsZWQpOwpkaWZmIC0tZ2l0
IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oIGIvdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pX2ludC5oCmluZGV4IDY0NDI1ZmYxNmM3ZC4uY2NkOTlkZmRkZjMxIDEwMDY0NAot
LS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgKKysrIGIvdmlydC9rdm0vaW50
cm9zcGVjdGlvbi9rdm1pX2ludC5oCkBAIC0zMCw2ICszMCw3IEBACiAJCQkgIHwgQklUKEtWTUlf
RVZFTlRfVFJBUCkgXAogCQkJICB8IEJJVChLVk1JX0VWRU5UX1BBVVNFX1ZDUFUpIFwKIAkJCSAg
fCBCSVQoS1ZNSV9FVkVOVF9QRikgXAorCQkJICB8IEJJVChLVk1JX0VWRU5UX1NJTkdMRVNURVAp
IFwKIAkJCSAgfCBCSVQoS1ZNSV9FVkVOVF9YU0VUQlYpIFwKIAkJKQogCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcg
bGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xp
c3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
