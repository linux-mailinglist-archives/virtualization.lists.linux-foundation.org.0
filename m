Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
	by mail.lfdr.de (Postfix) with ESMTPS id BBF6E6DD1ED
	for <lists.virtualization@lfdr.de>; Tue, 11 Apr 2023 07:42:03 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id 47259417B6;
	Tue, 11 Apr 2023 05:42:02 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org 47259417B6
Authentication-Results: smtp4.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=WiGaDJ7k
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id ZMmfLGFKv0MD; Tue, 11 Apr 2023 05:42:00 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp4.osuosl.org (Postfix) with ESMTPS id 318E24109F;
	Tue, 11 Apr 2023 05:42:00 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org 318E24109F
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 7A74EC008C;
	Tue, 11 Apr 2023 05:41:59 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 91060C002A
 for <virtualization@lists.linux-foundation.org>;
 Tue, 11 Apr 2023 05:41:57 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp4.osuosl.org (Postfix) with ESMTP id 76CEC41765
 for <virtualization@lists.linux-foundation.org>;
 Tue, 11 Apr 2023 05:41:57 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org 76CEC41765
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
 by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Wg9npn6nONCN
 for <virtualization@lists.linux-foundation.org>;
 Tue, 11 Apr 2023 05:41:56 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org E30274109F
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.133.124])
 by smtp4.osuosl.org (Postfix) with ESMTPS id E30274109F
 for <virtualization@lists.linux-foundation.org>;
 Tue, 11 Apr 2023 05:41:55 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1681191714;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=F4bDRARzkF1gI/5ulEGpZGNsH6UfiOpQWPqUWlQsIBA=;
 b=WiGaDJ7kbZPmyfrgvndmiSJoU6w7rmKDpodaxseg0ZNXqYKWVY/5P3KWiGIPh0MHkvj2C4
 4k6MbOJ4n/GkjkP7f19uKkOePythYeS5wZgCbiiEJQjhNqKin9kWIu84LU6uhpHrIe5AmV
 dOcyRZIolIEb+hsbMqVONX1hABd+Lnk=
Received: from mail-oa1-f70.google.com (mail-oa1-f70.google.com
 [209.85.160.70]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-538-Zkfnkr2XM3uAo5q1HwlvJA-1; Tue, 11 Apr 2023 01:41:53 -0400
X-MC-Unique: Zkfnkr2XM3uAo5q1HwlvJA-1
Received: by mail-oa1-f70.google.com with SMTP id
 586e51a60fabf-1842ccf7ae4so4144547fac.1
 for <virtualization@lists.linux-foundation.org>;
 Mon, 10 Apr 2023 22:41:53 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112; t=1681191712; x=1683783712;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=F4bDRARzkF1gI/5ulEGpZGNsH6UfiOpQWPqUWlQsIBA=;
 b=ng6rakJkUeqaLeKFtDqzAg4/E37rkMflT7/u11OK7KTiMRrcts79iShFwRk+uQCWx9
 tH5Q/Ow1FVPAtl8xD4Cji2aVW5z1XdroyoFBT+Go2wCd0WfneSa63IKFv8FPCGm/LUMK
 U9OgmEY3zzmxfK0zWWprry7tQZICco535FJb4Efc0agnq3jw++hc0PhYFhFmhYVXLr2o
 Ra+DJcC0b0SEc6imMOj8aZUQVwQoiN9HdvxI1hqlVnCk6dNlWsqFJiFxRiTIeUVwYBPs
 qyds04zuQqw7AZoHJ2TAcQ61aZX3wESVZmOl4VHqZiRgXxEC3nhpBNEXI5kvcVfPXTIV
 nAKg==
X-Gm-Message-State: AAQBX9c6qLh17OubdM8StTyZLyaQliPbVflS7UfNQ1gE4uSCYwjCdInP
 XyktrvhzY0d7uIo92g+f/JicHF+sQXwUU5pe/ljI2bitd+GF0r1UqrQuvtM0aEUFTr2L2XqdhN1
 bI6yQcTGsaogcsYuo2DapecpkAq9iGPwdSvqpUuG1KfAh7Gt83jCKfCy6SA==
X-Received: by 2002:a05:6808:915:b0:389:50f2:4aa6 with SMTP id
 w21-20020a056808091500b0038950f24aa6mr3485410oih.9.1681191712439; 
 Mon, 10 Apr 2023 22:41:52 -0700 (PDT)
X-Google-Smtp-Source: AKy350ba79FFjguMP41m14aWnC03kxojFyfpXzYkG9oPN7/mMj3q5qfv4prTvfI8vurRSKAoUOOE20KPuCvEVg5CpGI=
X-Received: by 2002:a05:6808:915:b0:389:50f2:4aa6 with SMTP id
 w21-20020a056808091500b0038950f24aa6mr3485398oih.9.1681191711952; Mon, 10 Apr
 2023 22:41:51 -0700 (PDT)
MIME-Version: 1.0
References: <20230404131326.44403-1-sgarzare@redhat.com>
 <20230404131716.45855-1-sgarzare@redhat.com>
In-Reply-To: <20230404131716.45855-1-sgarzare@redhat.com>
From: Jason Wang <jasowang@redhat.com>
Date: Tue, 11 Apr 2023 13:41:41 +0800
Message-ID: <CACGkMEu_AL7M-szVsp9WmUZDQtD0p8t=XF=D+sxsLP=a5gny4Q@mail.gmail.com>
Subject: Re: [PATCH v5 5/9] vringh: support VA with iotlb
To: Stefano Garzarella <sgarzare@redhat.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: Andrey Zhadchenko <andrey.zhadchenko@virtuozzo.com>, kvm@vger.kernel.org,
 "Michael S. Tsirkin" <mst@redhat.com>, netdev@vger.kernel.org,
 linux-kernel@vger.kernel.org, virtualization@lists.linux-foundation.org,
 eperezma@redhat.com, stefanha@redhat.com
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVHVlLCBBcHIgNCwgMjAyMyBhdCA5OjE34oCvUE0gU3RlZmFubyBHYXJ6YXJlbGxhIDxzZ2Fy
emFyZUByZWRoYXQuY29tPiB3cm90ZToKPgo+IHZEUEEgc3VwcG9ydHMgdGhlIHBvc3NpYmlsaXR5
IHRvIHVzZSB1c2VyIFZBIGluIHRoZSBpb3RsYiBtZXNzYWdlcy4KPiBTbywgbGV0J3MgYWRkIHN1
cHBvcnQgZm9yIHVzZXIgVkEgaW4gdnJpbmdoIHRvIHVzZSBpdCBpbiB0aGUgdkRQQQo+IHNpbXVs
YXRvcnMuCj4KPiBBY2tlZC1ieTogRXVnZW5pbyBQw6lyZXogPGVwZXJlem1hQHJlZGhhdC5jb20+
Cj4gU2lnbmVkLW9mZi1ieTogU3RlZmFubyBHYXJ6YXJlbGxhIDxzZ2FyemFyZUByZWRoYXQuY29t
PgoKQWNrZWQtYnk6IEphc29uIFdhbmcgPGphc293YW5nQHJlZGhhdC5jb20+CgpUaGFua3MKCj4g
LS0tCj4KPiBOb3RlczoKPiAgICAgdjU6Cj4gICAgIC0gcy91c2VycGFjZS91c2Vyc3BhY2UvIGlu
IHRoZSB2cmluZ2hfaW5pdF9pb3RsYl92YSBkb2MgW1NpbW9uXQo+ICAgICB2NDoKPiAgICAgLSB1
c2VkIHVpbnRwdHJfdCBmb3IgYGlvX2FkZHJgIFtFdWdlbmlvXQo+ICAgICAtIGFkZGVkIGBpb19h
ZGRyYCBhbmQgYGlvX2xlbmAgdmFyaWFibGVzIGluIGlvdGxiX3RyYW5zbGF0ZQo+ICAgICAtIGF2
b2lkZWQgb3ZlcmZsb3cgZG9pbmcgYG1hcC0+YWRkciAtIG1hcC0+c3RhcnQgKyBhZGRyYCBbSmFz
b25dCj4gICAgIC0gcmVtb3ZlZCBgaXNfaW92ZWNgIGZpZWxkIGZyb20gc3RydWN0IGlvdGxiX3Zl
YyBbSmFzb25dCj4gICAgIC0gYWRkZWQgdnJpbmdoX2luaXRfaW90bGJfdmEoKSBbSmFzb25dCj4g
ICAgIHYzOgo+ICAgICAtIHJlZmFjdG9yZWQgYXZvaWRpbmcgY29kZSBkdXBsaWNhdGlvbiBbRXVn
ZW5pb10KPiAgICAgdjI6Cj4gICAgIC0gcmVwbGFjZSBrbWFwX2F0b21pYygpIHdpdGgga21hcF9s
b2NhbF9wYWdlKCkgW3NlZSBwcmV2aW91cyBwYXRjaF0KPiAgICAgLSBmaXggY2FzdCB3YXJuaW5n
cyB3aGVuIGJ1aWxkIHdpdGggVz0xIEM9MQo+Cj4gIGluY2x1ZGUvbGludXgvdnJpbmdoLmggfCAg
IDkgKysrCj4gIGRyaXZlcnMvdmhvc3QvdnJpbmdoLmMgfCAxNzEgKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrLS0tLS0tLS0KPiAgMiBmaWxlcyBjaGFuZ2VkLCAxNDggaW5zZXJ0aW9u
cygrKSwgMzIgZGVsZXRpb25zKC0pCj4KPiBkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC92cmlu
Z2guaCBiL2luY2x1ZGUvbGludXgvdnJpbmdoLmgKPiBpbmRleCAxOTkxYTAyYzY0MzEuLmI0ZWRm
YWRmNTQ3OSAxMDA2NDQKPiAtLS0gYS9pbmNsdWRlL2xpbnV4L3ZyaW5naC5oCj4gKysrIGIvaW5j
bHVkZS9saW51eC92cmluZ2guaAo+IEBAIC0zMiw2ICszMiw5IEBAIHN0cnVjdCB2cmluZ2ggewo+
ICAgICAgICAgLyogQ2FuIHdlIGdldCBhd2F5IHdpdGggd2VhayBiYXJyaWVycz8gKi8KPiAgICAg
ICAgIGJvb2wgd2Vha19iYXJyaWVyczsKPgo+ICsgICAgICAgLyogVXNlIHVzZXIncyBWQSAqLwo+
ICsgICAgICAgYm9vbCB1c2VfdmE7Cj4gKwo+ICAgICAgICAgLyogTGFzdCBhdmFpbGFibGUgaW5k
ZXggd2Ugc2F3IChpZS4gd2hlcmUgd2UncmUgdXAgdG8pLiAqLwo+ICAgICAgICAgdTE2IGxhc3Rf
YXZhaWxfaWR4Owo+Cj4gQEAgLTI4NCw2ICsyODcsMTIgQEAgaW50IHZyaW5naF9pbml0X2lvdGxi
KHN0cnVjdCB2cmluZ2ggKnZyaCwgdTY0IGZlYXR1cmVzLAo+ICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgdnJpbmdfYXZhaWwgKmF2YWlsLAo+ICAgICAgICAgICAgICAgICAgICAgICBzdHJ1
Y3QgdnJpbmdfdXNlZCAqdXNlZCk7Cj4KPiAraW50IHZyaW5naF9pbml0X2lvdGxiX3ZhKHN0cnVj
dCB2cmluZ2ggKnZyaCwgdTY0IGZlYXR1cmVzLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICB1
bnNpZ25lZCBpbnQgbnVtLCBib29sIHdlYWtfYmFycmllcnMsCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgIHN0cnVjdCB2cmluZ19kZXNjICpkZXNjLAo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgdnJpbmdfYXZhaWwgKmF2YWlsLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgdnJpbmdfdXNlZCAqdXNlZCk7Cj4gKwo+ICBpbnQgdnJpbmdoX2dldGRlc2NfaW90bGIo
c3RydWN0IHZyaW5naCAqdnJoLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgdnJp
bmdoX2tpb3YgKnJpb3YsCj4gICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2cmluZ2hf
a2lvdiAqd2lvdiwKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy92aG9zdC92cmluZ2guYyBiL2RyaXZl
cnMvdmhvc3QvdnJpbmdoLmMKPiBpbmRleCA0YWVlMjMwZjc2MjIuLmFiOTUxNjBkY2RkOSAxMDA2
NDQKPiAtLS0gYS9kcml2ZXJzL3Zob3N0L3ZyaW5naC5jCj4gKysrIGIvZHJpdmVycy92aG9zdC92
cmluZ2guYwo+IEBAIC0xMDk0LDEwICsxMDk0LDE3IEBAIEVYUE9SVF9TWU1CT0wodnJpbmdoX25l
ZWRfbm90aWZ5X2tlcm4pOwo+Cj4gICNpZiBJU19SRUFDSEFCTEUoQ09ORklHX1ZIT1NUX0lPVExC
KQo+Cj4gK3N0cnVjdCBpb3RsYl92ZWMgewo+ICsgICAgICAgdW5pb24gewo+ICsgICAgICAgICAg
ICAgICBzdHJ1Y3QgaW92ZWMgKmlvdmVjOwo+ICsgICAgICAgICAgICAgICBzdHJ1Y3QgYmlvX3Zl
YyAqYnZlYzsKPiArICAgICAgIH0gaW92Owo+ICsgICAgICAgc2l6ZV90IGNvdW50Owo+ICt9Owo+
ICsKPiAgc3RhdGljIGludCBpb3RsYl90cmFuc2xhdGUoY29uc3Qgc3RydWN0IHZyaW5naCAqdnJo
LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHU2NCBhZGRyLCB1NjQgbGVuLCB1NjQgKnRy
YW5zbGF0ZWQsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGJpb192ZWMgaW92
W10sCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGlvdl9zaXplLCB1MzIgcGVybSkK
PiArICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgaW90bGJfdmVjICppdmVjLCB1MzIg
cGVybSkKPiAgewo+ICAgICAgICAgc3RydWN0IHZob3N0X2lvdGxiX21hcCAqbWFwOwo+ICAgICAg
ICAgc3RydWN0IHZob3N0X2lvdGxiICppb3RsYiA9IHZyaC0+aW90bGI7Cj4gQEAgLTExMDcsOSAr
MTExNCwxMSBAQCBzdGF0aWMgaW50IGlvdGxiX3RyYW5zbGF0ZShjb25zdCBzdHJ1Y3QgdnJpbmdo
ICp2cmgsCj4gICAgICAgICBzcGluX2xvY2sodnJoLT5pb3RsYl9sb2NrKTsKPgo+ICAgICAgICAg
d2hpbGUgKGxlbiA+IHMpIHsKPiAtICAgICAgICAgICAgICAgdTY0IHNpemUsIHBhLCBwZm47Cj4g
KyAgICAgICAgICAgICAgIHVpbnRwdHJfdCBpb19hZGRyOwo+ICsgICAgICAgICAgICAgICBzaXpl
X3QgaW9fbGVuOwo+ICsgICAgICAgICAgICAgICB1NjQgc2l6ZTsKPgo+IC0gICAgICAgICAgICAg
ICBpZiAodW5saWtlbHkocmV0ID49IGlvdl9zaXplKSkgewo+ICsgICAgICAgICAgICAgICBpZiAo
dW5saWtlbHkocmV0ID49IGl2ZWMtPmNvdW50KSkgewo+ICAgICAgICAgICAgICAgICAgICAgICAg
IHJldCA9IC1FTk9CVUZTOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+ICAgICAg
ICAgICAgICAgICB9Cj4gQEAgLTExMjQsMTAgKzExMzMsMjIgQEAgc3RhdGljIGludCBpb3RsYl90
cmFuc2xhdGUoY29uc3Qgc3RydWN0IHZyaW5naCAqdnJoLAo+ICAgICAgICAgICAgICAgICB9Cj4K
PiAgICAgICAgICAgICAgICAgc2l6ZSA9IG1hcC0+c2l6ZSAtIGFkZHIgKyBtYXAtPnN0YXJ0Owo+
IC0gICAgICAgICAgICAgICBwYSA9IG1hcC0+YWRkciArIGFkZHIgLSBtYXAtPnN0YXJ0Owo+IC0g
ICAgICAgICAgICAgICBwZm4gPSBwYSA+PiBQQUdFX1NISUZUOwo+IC0gICAgICAgICAgICAgICBi
dmVjX3NldF9wYWdlKCZpb3ZbcmV0XSwgcGZuX3RvX3BhZ2UocGZuKSwgbWluKGxlbiAtIHMsIHNp
emUpLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhICYgKFBBR0VfU0laRSAtIDEp
KTsKPiArICAgICAgICAgICAgICAgaW9fbGVuID0gbWluKGxlbiAtIHMsIHNpemUpOwo+ICsgICAg
ICAgICAgICAgICBpb19hZGRyID0gbWFwLT5hZGRyIC0gbWFwLT5zdGFydCArIGFkZHI7Cj4gKwo+
ICsgICAgICAgICAgICAgICBpZiAodnJoLT51c2VfdmEpIHsKPiArICAgICAgICAgICAgICAgICAg
ICAgICBzdHJ1Y3QgaW92ZWMgKmlvdmVjID0gaXZlYy0+aW92LmlvdmVjOwo+ICsKPiArICAgICAg
ICAgICAgICAgICAgICAgICBpb3ZlY1tyZXRdLmlvdl9sZW4gPSBpb19sZW47Cj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgaW92ZWNbcmV0XS5pb3ZfYmFzZSA9ICh2b2lkIF9fdXNlciAqKWlvX2Fk
ZHI7Cj4gKyAgICAgICAgICAgICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAg
dTY0IHBmbiA9IGlvX2FkZHIgPj4gUEFHRV9TSElGVDsKPiArICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgYmlvX3ZlYyAqYnZlYyA9IGl2ZWMtPmlvdi5idmVjOwo+ICsKPiArICAgICAgICAg
ICAgICAgICAgICAgICBidmVjX3NldF9wYWdlKCZidmVjW3JldF0sIHBmbl90b19wYWdlKHBmbiks
IGlvX2xlbiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvX2FkZHIg
JiAoUEFHRV9TSVpFIC0gMSkpOwo+ICsgICAgICAgICAgICAgICB9Cj4gKwo+ICAgICAgICAgICAg
ICAgICBzICs9IHNpemU7Cj4gICAgICAgICAgICAgICAgIGFkZHIgKz0gc2l6ZTsKPiAgICAgICAg
ICAgICAgICAgKytyZXQ7Cj4gQEAgLTExNDYsMjMgKzExNjcsMzYgQEAgc3RhdGljIGludCBpb3Rs
Yl90cmFuc2xhdGUoY29uc3Qgc3RydWN0IHZyaW5naCAqdnJoLAo+ICBzdGF0aWMgaW5saW5lIGlu
dCBjb3B5X2Zyb21faW90bGIoY29uc3Qgc3RydWN0IHZyaW5naCAqdnJoLCB2b2lkICpkc3QsCj4g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKnNyYywgc2l6ZV90IGxlbikK
PiAgewo+ICsgICAgICAgc3RydWN0IGlvdGxiX3ZlYyBpdmVjOwo+ICsgICAgICAgdW5pb24gewo+
ICsgICAgICAgICAgICAgICBzdHJ1Y3QgaW92ZWMgaW92ZWNbSU9UTEJfSU9WX1NUUklERV07Cj4g
KyAgICAgICAgICAgICAgIHN0cnVjdCBiaW9fdmVjIGJ2ZWNbSU9UTEJfSU9WX1NUUklERV07Cj4g
KyAgICAgICB9IGlvdjsKPiAgICAgICAgIHU2NCB0b3RhbF90cmFuc2xhdGVkID0gMDsKPgo+ICsg
ICAgICAgaXZlYy5pb3YuaW92ZWMgPSBpb3YuaW92ZWM7Cj4gKyAgICAgICBpdmVjLmNvdW50ID0g
SU9UTEJfSU9WX1NUUklERTsKPiArCj4gICAgICAgICB3aGlsZSAodG90YWxfdHJhbnNsYXRlZCA8
IGxlbikgewo+IC0gICAgICAgICAgICAgICBzdHJ1Y3QgYmlvX3ZlYyBpb3ZbSU9UTEJfSU9WX1NU
UklERV07Cj4gICAgICAgICAgICAgICAgIHN0cnVjdCBpb3ZfaXRlciBpdGVyOwo+ICAgICAgICAg
ICAgICAgICB1NjQgdHJhbnNsYXRlZDsKPiAgICAgICAgICAgICAgICAgaW50IHJldDsKPgo+ICAg
ICAgICAgICAgICAgICByZXQgPSBpb3RsYl90cmFuc2xhdGUodnJoLCAodTY0KSh1aW50cHRyX3Qp
c3JjLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuIC0gdG90YWxf
dHJhbnNsYXRlZCwgJnRyYW5zbGF0ZWQsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpb3YsIEFSUkFZX1NJWkUoaW92KSwgVkhPU1RfTUFQX1JPKTsKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICZpdmVjLCBWSE9TVF9NQVBfUk8pOwo+ICAgICAg
ICAgICAgICAgICBpZiAocmV0ID09IC1FTk9CVUZTKQo+IC0gICAgICAgICAgICAgICAgICAgICAg
IHJldCA9IEFSUkFZX1NJWkUoaW92KTsKPiArICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBJ
T1RMQl9JT1ZfU1RSSURFOwo+ICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXQgPCAwKQo+ICAg
ICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4KPiAtICAgICAgICAgICAgICAgaW92
X2l0ZXJfYnZlYygmaXRlciwgSVRFUl9TT1VSQ0UsIGlvdiwgcmV0LCB0cmFuc2xhdGVkKTsKPiAr
ICAgICAgICAgICAgICAgaWYgKHZyaC0+dXNlX3ZhKSB7Cj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgaW92X2l0ZXJfaW5pdCgmaXRlciwgSVRFUl9TT1VSQ0UsIGl2ZWMuaW92LmlvdmVjLCByZXQs
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGVkKTsKPiAr
ICAgICAgICAgICAgICAgfSBlbHNlIHsKPiArICAgICAgICAgICAgICAgICAgICAgICBpb3ZfaXRl
cl9idmVjKCZpdGVyLCBJVEVSX1NPVVJDRSwgaXZlYy5pb3YuYnZlYywgcmV0LAo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlZCk7Cj4gKyAgICAgICAgICAg
ICAgIH0KPgo+ICAgICAgICAgICAgICAgICByZXQgPSBjb3B5X2Zyb21faXRlcihkc3QsIHRyYW5z
bGF0ZWQsICZpdGVyKTsKPiAgICAgICAgICAgICAgICAgaWYgKHJldCA8IDApCj4gQEAgLTExNzks
MjMgKzEyMTMsMzYgQEAgc3RhdGljIGlubGluZSBpbnQgY29weV9mcm9tX2lvdGxiKGNvbnN0IHN0
cnVjdCB2cmluZ2ggKnZyaCwgdm9pZCAqZHN0LAo+ICBzdGF0aWMgaW5saW5lIGludCBjb3B5X3Rv
X2lvdGxiKGNvbnN0IHN0cnVjdCB2cmluZ2ggKnZyaCwgdm9pZCAqZHN0LAo+ICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdm9pZCAqc3JjLCBzaXplX3QgbGVuKQo+ICB7Cj4gKyAgICAg
ICBzdHJ1Y3QgaW90bGJfdmVjIGl2ZWM7Cj4gKyAgICAgICB1bmlvbiB7Cj4gKyAgICAgICAgICAg
ICAgIHN0cnVjdCBpb3ZlYyBpb3ZlY1tJT1RMQl9JT1ZfU1RSSURFXTsKPiArICAgICAgICAgICAg
ICAgc3RydWN0IGJpb192ZWMgYnZlY1tJT1RMQl9JT1ZfU1RSSURFXTsKPiArICAgICAgIH0gaW92
Owo+ICAgICAgICAgdTY0IHRvdGFsX3RyYW5zbGF0ZWQgPSAwOwo+Cj4gKyAgICAgICBpdmVjLmlv
di5pb3ZlYyA9IGlvdi5pb3ZlYzsKPiArICAgICAgIGl2ZWMuY291bnQgPSBJT1RMQl9JT1ZfU1RS
SURFOwo+ICsKPiAgICAgICAgIHdoaWxlICh0b3RhbF90cmFuc2xhdGVkIDwgbGVuKSB7Cj4gLSAg
ICAgICAgICAgICAgIHN0cnVjdCBiaW9fdmVjIGlvdltJT1RMQl9JT1ZfU1RSSURFXTsKPiAgICAg
ICAgICAgICAgICAgc3RydWN0IGlvdl9pdGVyIGl0ZXI7Cj4gICAgICAgICAgICAgICAgIHU2NCB0
cmFuc2xhdGVkOwo+ICAgICAgICAgICAgICAgICBpbnQgcmV0Owo+Cj4gICAgICAgICAgICAgICAg
IHJldCA9IGlvdGxiX3RyYW5zbGF0ZSh2cmgsICh1NjQpKHVpbnRwdHJfdClkc3QsCj4gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4gLSB0b3RhbF90cmFuc2xhdGVkLCAm
dHJhbnNsYXRlZCwKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvdiwg
QVJSQVlfU0laRShpb3YpLCBWSE9TVF9NQVBfV08pOwo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgJml2ZWMsIFZIT1NUX01BUF9XTyk7Cj4gICAgICAgICAgICAgICAgIGlm
IChyZXQgPT0gLUVOT0JVRlMpCj4gLSAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gQVJSQVlf
U0laRShpb3YpOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IElPVExCX0lPVl9TVFJJ
REU7Cj4gICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJldCA8IDApCj4gICAgICAgICAgICAgICAg
ICAgICAgICAgcmV0dXJuIHJldDsKPgo+IC0gICAgICAgICAgICAgICBpb3ZfaXRlcl9idmVjKCZp
dGVyLCBJVEVSX0RFU1QsIGlvdiwgcmV0LCB0cmFuc2xhdGVkKTsKPiArICAgICAgICAgICAgICAg
aWYgKHZyaC0+dXNlX3ZhKSB7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgaW92X2l0ZXJfaW5p
dCgmaXRlciwgSVRFUl9ERVNULCBpdmVjLmlvdi5pb3ZlYywgcmV0LAo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlZCk7Cj4gKyAgICAgICAgICAgICAgIH0g
ZWxzZSB7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgaW92X2l0ZXJfYnZlYygmaXRlciwgSVRF
Ul9ERVNULCBpdmVjLmlvdi5idmVjLCByZXQsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB0cmFuc2xhdGVkKTsKPiArICAgICAgICAgICAgICAgfQo+Cj4gICAgICAgICAg
ICAgICAgIHJldCA9IGNvcHlfdG9faXRlcihzcmMsIHRyYW5zbGF0ZWQsICZpdGVyKTsKPiAgICAg
ICAgICAgICAgICAgaWYgKHJldCA8IDApCj4gQEAgLTEyMTIsMjAgKzEyNTksMzYgQEAgc3RhdGlj
IGlubGluZSBpbnQgY29weV90b19pb3RsYihjb25zdCBzdHJ1Y3QgdnJpbmdoICp2cmgsIHZvaWQg
KmRzdCwKPiAgc3RhdGljIGlubGluZSBpbnQgZ2V0dTE2X2lvdGxiKGNvbnN0IHN0cnVjdCB2cmlu
Z2ggKnZyaCwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdTE2ICp2YWwsIGNvbnN0
IF9fdmlydGlvMTYgKnApCj4gIHsKPiAtICAgICAgIHN0cnVjdCBiaW9fdmVjIGlvdjsKPiAtICAg
ICAgIHZvaWQgKmthZGRyLCAqZnJvbTsKPiArICAgICAgIHN0cnVjdCBpb3RsYl92ZWMgaXZlYzsK
PiArICAgICAgIHVuaW9uIHsKPiArICAgICAgICAgICAgICAgc3RydWN0IGlvdmVjIGlvdmVjWzFd
Owo+ICsgICAgICAgICAgICAgICBzdHJ1Y3QgYmlvX3ZlYyBidmVjWzFdOwo+ICsgICAgICAgfSBp
b3Y7Cj4gKyAgICAgICBfX3ZpcnRpbzE2IHRtcDsKPiAgICAgICAgIGludCByZXQ7Cj4KPiArICAg
ICAgIGl2ZWMuaW92LmlvdmVjID0gaW92LmlvdmVjOwo+ICsgICAgICAgaXZlYy5jb3VudCA9IDE7
Cj4gKwo+ICAgICAgICAgLyogQXRvbWljIHJlYWQgaXMgbmVlZGVkIGZvciBnZXR1MTYgKi8KPiAt
ICAgICAgIHJldCA9IGlvdGxiX3RyYW5zbGF0ZSh2cmgsICh1NjQpKHVpbnRwdHJfdClwLCBzaXpl
b2YoKnApLCBOVUxMLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICZpb3YsIDEsIFZI
T1NUX01BUF9STyk7Cj4gKyAgICAgICByZXQgPSBpb3RsYl90cmFuc2xhdGUodnJoLCAodTY0KSh1
aW50cHRyX3QpcCwgc2l6ZW9mKCpwKSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICBO
VUxMLCAmaXZlYywgVkhPU1RfTUFQX1JPKTsKPiAgICAgICAgIGlmIChyZXQgPCAwKQo+ICAgICAg
ICAgICAgICAgICByZXR1cm4gcmV0Owo+Cj4gLSAgICAgICBrYWRkciA9IGttYXBfbG9jYWxfcGFn
ZShpb3YuYnZfcGFnZSk7Cj4gLSAgICAgICBmcm9tID0ga2FkZHIgKyBpb3YuYnZfb2Zmc2V0Owo+
IC0gICAgICAgKnZhbCA9IHZyaW5naDE2X3RvX2NwdSh2cmgsIFJFQURfT05DRSgqKF9fdmlydGlv
MTYgKilmcm9tKSk7Cj4gLSAgICAgICBrdW5tYXBfbG9jYWwoa2FkZHIpOwo+ICsgICAgICAgaWYg
KHZyaC0+dXNlX3ZhKSB7Cj4gKyAgICAgICAgICAgICAgIHJldCA9IF9fZ2V0X3VzZXIodG1wLCAo
X192aXJ0aW8xNiBfX3VzZXIgKilpdmVjLmlvdi5pb3ZlY1swXS5pb3ZfYmFzZSk7Cj4gKyAgICAg
ICAgICAgICAgIGlmIChyZXQpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsK
PiArICAgICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgICAgICAgIHZvaWQgKmthZGRyID0ga21hcF9s
b2NhbF9wYWdlKGl2ZWMuaW92LmJ2ZWNbMF0uYnZfcGFnZSk7Cj4gKyAgICAgICAgICAgICAgIHZv
aWQgKmZyb20gPSBrYWRkciArIGl2ZWMuaW92LmJ2ZWNbMF0uYnZfb2Zmc2V0Owo+ICsKPiArICAg
ICAgICAgICAgICAgdG1wID0gUkVBRF9PTkNFKCooX192aXJ0aW8xNiAqKWZyb20pOwo+ICsgICAg
ICAgICAgICAgICBrdW5tYXBfbG9jYWwoa2FkZHIpOwo+ICsgICAgICAgfQo+ICsKPiArICAgICAg
ICp2YWwgPSB2cmluZ2gxNl90b19jcHUodnJoLCB0bXApOwo+Cj4gICAgICAgICByZXR1cm4gMDsK
PiAgfQo+IEBAIC0xMjMzLDIwICsxMjk2LDM2IEBAIHN0YXRpYyBpbmxpbmUgaW50IGdldHUxNl9p
b3RsYihjb25zdCBzdHJ1Y3QgdnJpbmdoICp2cmgsCj4gIHN0YXRpYyBpbmxpbmUgaW50IHB1dHUx
Nl9pb3RsYihjb25zdCBzdHJ1Y3QgdnJpbmdoICp2cmgsCj4gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIF9fdmlydGlvMTYgKnAsIHUxNiB2YWwpCj4gIHsKPiAtICAgICAgIHN0cnVjdCBi
aW9fdmVjIGlvdjsKPiAtICAgICAgIHZvaWQgKmthZGRyLCAqdG87Cj4gKyAgICAgICBzdHJ1Y3Qg
aW90bGJfdmVjIGl2ZWM7Cj4gKyAgICAgICB1bmlvbiB7Cj4gKyAgICAgICAgICAgICAgIHN0cnVj
dCBpb3ZlYyBpb3ZlYzsKPiArICAgICAgICAgICAgICAgc3RydWN0IGJpb192ZWMgYnZlYzsKPiAr
ICAgICAgIH0gaW92Owo+ICsgICAgICAgX192aXJ0aW8xNiB0bXA7Cj4gICAgICAgICBpbnQgcmV0
Owo+Cj4gKyAgICAgICBpdmVjLmlvdi5pb3ZlYyA9ICZpb3YuaW92ZWM7Cj4gKyAgICAgICBpdmVj
LmNvdW50ID0gMTsKPiArCj4gICAgICAgICAvKiBBdG9taWMgd3JpdGUgaXMgbmVlZGVkIGZvciBw
dXR1MTYgKi8KPiAtICAgICAgIHJldCA9IGlvdGxiX3RyYW5zbGF0ZSh2cmgsICh1NjQpKHVpbnRw
dHJfdClwLCBzaXplb2YoKnApLCBOVUxMLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZpb3YsIDEsIFZIT1NUX01BUF9XTyk7Cj4gKyAgICAgICByZXQgPSBpb3RsYl90cmFuc2xhdGUo
dnJoLCAodTY0KSh1aW50cHRyX3QpcCwgc2l6ZW9mKCpwKSwKPiArICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBOVUxMLCAmaXZlYywgVkhPU1RfTUFQX1JPKTsKPiAgICAgICAgIGlmIChyZXQg
PCAwKQo+ICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+Cj4gLSAgICAgICBrYWRkciA9IGtt
YXBfbG9jYWxfcGFnZShpb3YuYnZfcGFnZSk7Cj4gLSAgICAgICB0byA9IGthZGRyICsgaW92LmJ2
X29mZnNldDsKPiAtICAgICAgIFdSSVRFX09OQ0UoKihfX3ZpcnRpbzE2ICopdG8sIGNwdV90b192
cmluZ2gxNih2cmgsIHZhbCkpOwo+IC0gICAgICAga3VubWFwX2xvY2FsKGthZGRyKTsKPiArICAg
ICAgIHRtcCA9IGNwdV90b192cmluZ2gxNih2cmgsIHZhbCk7Cj4gKwo+ICsgICAgICAgaWYgKHZy
aC0+dXNlX3ZhKSB7Cj4gKyAgICAgICAgICAgICAgIHJldCA9IF9fcHV0X3VzZXIodG1wLCAoX192
aXJ0aW8xNiBfX3VzZXIgKilpdmVjLmlvdi5pb3ZlY1swXS5pb3ZfYmFzZSk7Cj4gKyAgICAgICAg
ICAgICAgIGlmIChyZXQpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKPiAr
ICAgICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgICAgICAgIHZvaWQgKmthZGRyID0ga21hcF9sb2Nh
bF9wYWdlKGl2ZWMuaW92LmJ2ZWNbMF0uYnZfcGFnZSk7Cj4gKyAgICAgICAgICAgICAgIHZvaWQg
KnRvID0ga2FkZHIgKyBpdmVjLmlvdi5idmVjWzBdLmJ2X29mZnNldDsKPiArCj4gKyAgICAgICAg
ICAgICAgIFdSSVRFX09OQ0UoKihfX3ZpcnRpbzE2ICopdG8sIHRtcCk7Cj4gKyAgICAgICAgICAg
ICAgIGt1bm1hcF9sb2NhbChrYWRkcik7Cj4gKyAgICAgICB9Cj4KPiAgICAgICAgIHJldHVybiAw
Owo+ICB9Cj4gQEAgLTEzMjAsMTEgKzEzOTksMzkgQEAgaW50IHZyaW5naF9pbml0X2lvdGxiKHN0
cnVjdCB2cmluZ2ggKnZyaCwgdTY0IGZlYXR1cmVzLAo+ICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgdnJpbmdfYXZhaWwgKmF2YWlsLAo+ICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
dnJpbmdfdXNlZCAqdXNlZCkKPiAgewo+ICsgICAgICAgdnJoLT51c2VfdmEgPSBmYWxzZTsKPiAr
Cj4gICAgICAgICByZXR1cm4gdnJpbmdoX2luaXRfa2Vybih2cmgsIGZlYXR1cmVzLCBudW0sIHdl
YWtfYmFycmllcnMsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjLCBhdmFp
bCwgdXNlZCk7Cj4gIH0KPiAgRVhQT1JUX1NZTUJPTCh2cmluZ2hfaW5pdF9pb3RsYik7Cj4KPiAr
LyoqCj4gKyAqIHZyaW5naF9pbml0X2lvdGxiX3ZhIC0gaW5pdGlhbGl6ZSBhIHZyaW5naCBmb3Ig
YSByaW5nIHdpdGggSU9UTEIgY29udGFpbmluZwo+ICsgKiAgICAgICAgICAgICAgICAgICAgICAg
IHVzZXIgVkEuCj4gKyAqIEB2cmg6IHRoZSB2cmluZ2ggdG8gaW5pdGlhbGl6ZS4KPiArICogQGZl
YXR1cmVzOiB0aGUgZmVhdHVyZSBiaXRzIGZvciB0aGlzIHJpbmcuCj4gKyAqIEBudW06IHRoZSBu
dW1iZXIgb2YgZWxlbWVudHMuCj4gKyAqIEB3ZWFrX2JhcnJpZXJzOiB0cnVlIGlmIHdlIG9ubHkg
bmVlZCBtZW1vcnkgYmFycmllcnMsIG5vdCBJL08uCj4gKyAqIEBkZXNjOiB0aGUgdXNlcnNwYWNl
IGRlc2NyaXB0b3IgcG9pbnRlci4KPiArICogQGF2YWlsOiB0aGUgdXNlcnNwYWNlIGF2YWlsIHBv
aW50ZXIuCj4gKyAqIEB1c2VkOiB0aGUgdXNlcnNwYWNlIHVzZWQgcG9pbnRlci4KPiArICoKPiAr
ICogUmV0dXJucyBhbiBlcnJvciBpZiBudW0gaXMgaW52YWxpZC4KPiArICovCj4gK2ludCB2cmlu
Z2hfaW5pdF9pb3RsYl92YShzdHJ1Y3QgdnJpbmdoICp2cmgsIHU2NCBmZWF0dXJlcywKPiArICAg
ICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IG51bSwgYm9vbCB3ZWFrX2JhcnJpZXJz
LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgdnJpbmdfZGVzYyAqZGVzYywKPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZyaW5nX2F2YWlsICphdmFpbCwKPiArICAg
ICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZyaW5nX3VzZWQgKnVzZWQpCj4gK3sKPiArICAg
ICAgIHZyaC0+dXNlX3ZhID0gdHJ1ZTsKPiArCj4gKyAgICAgICByZXR1cm4gdnJpbmdoX2luaXRf
a2Vybih2cmgsIGZlYXR1cmVzLCBudW0sIHdlYWtfYmFycmllcnMsCj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBkZXNjLCBhdmFpbCwgdXNlZCk7Cj4gK30KPiArRVhQT1JUX1NZTUJP
TCh2cmluZ2hfaW5pdF9pb3RsYl92YSk7Cj4gKwo+ICAvKioKPiAgICogdnJpbmdoX3NldF9pb3Rs
YiAtIGluaXRpYWxpemUgYSB2cmluZ2ggZm9yIGEgcmluZyB3aXRoIElPVExCLgo+ICAgKiBAdnJo
OiB0aGUgdnJpbmcKPiAtLQo+IDIuMzkuMgo+CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6
YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5k
YXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
