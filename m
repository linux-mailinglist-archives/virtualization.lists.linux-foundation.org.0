Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
	by mail.lfdr.de (Postfix) with ESMTPS id 957A77E2710
	for <lists.virtualization@lfdr.de>; Mon,  6 Nov 2023 15:36:50 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp1.osuosl.org (Postfix) with ESMTP id 5D172827AF;
	Mon,  6 Nov 2023 14:36:47 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 5D172827AF
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
	by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id ras_8KygzSwp; Mon,  6 Nov 2023 14:36:44 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [IPv6:2605:bc80:3010:104::8cd3:938])
	by smtp1.osuosl.org (Postfix) with ESMTPS id 400B582540;
	Mon,  6 Nov 2023 14:36:44 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 400B582540
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 71A6CC008C;
	Mon,  6 Nov 2023 14:36:43 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 69293C0032
 for <virtualization@lists.linux-foundation.org>;
 Mon,  6 Nov 2023 14:36:42 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp3.osuosl.org (Postfix) with ESMTP id 3F22E61102
 for <virtualization@lists.linux-foundation.org>;
 Mon,  6 Nov 2023 14:36:42 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 3F22E61102
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
 by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id EHbWX2BfQYCs
 for <virtualization@lists.linux-foundation.org>;
 Mon,  6 Nov 2023 14:36:41 +0000 (UTC)
Received: from mail-oo1-f51.google.com (mail-oo1-f51.google.com
 [209.85.161.51])
 by smtp3.osuosl.org (Postfix) with ESMTPS id 032A560B43
 for <virtualization@lists.linux-foundation.org>;
 Mon,  6 Nov 2023 14:36:40 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 032A560B43
Received: by mail-oo1-f51.google.com with SMTP id
 006d021491bc7-582050ce2d8so769258eaf.0
 for <virtualization@lists.linux-foundation.org>;
 Mon, 06 Nov 2023 06:36:40 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20230601; t=1699281400; x=1699886200;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=2cdR2/VKi6UPuhkYIfGhIxLOEjAPCEY76bcIkQ8v+Ms=;
 b=vUKb9SYoE/EPwoUn9qqUcBqw81ZXuhTEgOplmwYXfbR0N6XLr3om8VqCkgFTs79M9D
 08hloXf92SUoekrgbXWhpf1LjNFbls4/vxxVDsgDB9vszF0hTvL9fE680c2bl7+4QE2v
 S+onOb8bxNmYqn5vmJXm1Uvz2BgDW1nGAh8EKEVMsaTSFVHQTVWX5D6SaYvh7aRgXOkR
 VixDWzsQJZD8WQjMBHG/o0deu2jc8Ldh/jALvKTvADFFj/1PEuZFZqUkZ7DHtup47uJs
 vIC3KyLNXuw7CnCCnPK7YjihTEgpgAnQgB2N+Uvc23XqEkxswqXaY+sSLbUhbWcKHnq9
 9yGw==
X-Gm-Message-State: AOJu0Yzb/67KeoaENDREU3SKmjGIyrxGPJ0z7tmBG//2FQUmJszSCzHY
 FvvDj4t2RY55B3q6atqZ5uRjTxq1380HeII9m5k=
X-Google-Smtp-Source: AGHT+IHbe2zI3U23b+PVzNucg829Wp6e2Bcxf0uK0hh0lJZt2GaAY1e0EjSPEFsMQ2ih3YgyFNGuBSiBcA14YA5OhH8=
X-Received: by 2002:a4a:3390:0:b0:587:947b:31f4 with SMTP id
 q138-20020a4a3390000000b00587947b31f4mr5630046ooq.1.1699281399853; Mon, 06
 Nov 2023 06:36:39 -0800 (PST)
MIME-Version: 1.0
References: <0-v1-5f734af130a3+34f-iommu_fwspec_jgg@nvidia.com>
 <10-v1-5f734af130a3+34f-iommu_fwspec_jgg@nvidia.com>
In-Reply-To: <10-v1-5f734af130a3+34f-iommu_fwspec_jgg@nvidia.com>
From: "Rafael J. Wysocki" <rafael@kernel.org>
Date: Mon, 6 Nov 2023 15:36:28 +0100
Message-ID: <CAJZ5v0hh4xUDxWOjDhdczAuMVS-1HneukrqoDvMQgQ6EmeXejQ@mail.gmail.com>
Subject: Re: [PATCH RFC 10/17] acpi: Do not use dev->iommu within
 acpi_iommu_configure()
To: Jason Gunthorpe <jgg@nvidia.com>
Cc: linux-hyperv@vger.kernel.org, "Rafael J. Wysocki" <rafael@kernel.org>,
 Catalin Marinas <catalin.marinas@arm.com>,
 Lorenzo Pieralisi <lpieralisi@kernel.org>,
 Robert Moore <robert.moore@intel.com>,
 Thierry Reding <thierry.reding@gmail.com>, Hanjun Guo <guohanjun@huawei.com>,
 acpica-devel@lists.linuxfoundation.org, Christoph Hellwig <hch@lst.de>,
 Alyssa Rosenzweig <alyssa@rosenzweig.io>,
 Marek Szyprowski <m.szyprowski@samsung.com>,
 Jean-Philippe Brucker <jean-philippe@linaro.org>, Wei Liu <wei.liu@kernel.org>,
 Will Deacon <will@kernel.org>, Joerg Roedel <joro@8bytes.org>,
 Dexuan Cui <decui@microsoft.com>, Russell King <linux@armlinux.org.uk>,
 linux-riscv@lists.infradead.org, Jonathan Hunter <jonathanh@nvidia.com>,
 linux-acpi@vger.kernel.org, iommu@lists.linux.dev,
 Vineet Gupta <vgupta@kernel.org>, linux-snps-arc@lists.infradead.org,
 Len Brown <lenb@kernel.org>, devicetree@vger.kernel.org,
 Albert Ou <aou@eecs.berkeley.edu>, Sven Peter <sven@svenpeter.dev>,
 Haiyang Zhang <haiyangz@microsoft.com>, Krishna Reddy <vdumpa@nvidia.com>,
 Rob Herring <robh+dt@kernel.org>, Paul Walmsley <paul.walmsley@sifive.com>,
 linux-tegra@vger.kernel.org, virtualization@lists.linux-foundation.org,
 linux-arm-kernel@lists.infradead.org,
 Thomas Bogendoerfer <tsbogend@alpha.franken.de>,
 Robin Murphy <robin.murphy@arm.com>, Zhenhua Huang <quic_zhenhuah@quicinc.com>,
 Hector Martin <marcan@marcan.st>, linux-mips@vger.kernel.org,
 Palmer Dabbelt <palmer@dabbelt.com>, asahi@lists.linux.dev,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>,
 Sudeep Holla <sudeep.holla@arm.com>, David Woodhouse <dwmw2@infradead.org>,
 Lu Baolu <baolu.lu@linux.intel.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gRnJpLCBOb3YgMywgMjAyMyBhdCA1OjQ14oCvUE0gSmFzb24gR3VudGhvcnBlIDxqZ2dAbnZp
ZGlhLmNvbT4gd3JvdGU6Cj4KPiBUaGlzIGNhbGwgY2hhaW4gaXMgdXNpbmcgZGV2LT5pb21tdS0+
ZndzcGVjIHRvIHBhc3MgYXJvdW5kIHRoZSBmd3NwZWMKPiBiZXR3ZWVuIHRoZSB0aHJlZSBwYXJ0
cyAoYWNwaV9pb21tdV9jb25maWd1cmUoKSwgYWNwaV9pb21tdV9md3NwZWNfaW5pdCgpLAo+IGlv
bW11X3Byb2JlX2RldmljZSgpKS4KPgo+IEhvd2V2ZXIgdGhlcmUgaXMgbm8gbG9ja2luZyBhcm91
bmQgdGhlIGFjY2Vzc2VzIHRvIGRldi0+aW9tbXUsIHNvIHRoaXMgaXMKPiBhbGwgcmFjeS4KPgo+
IEFsbG9jYXRlIGEgY2xlYW4sIGxvY2FsLCBmd3NwZWMgYXQgdGhlIHN0YXJ0IG9mIGFjcHVfaW9t
bXVfY29uZmlndXJlKCksCj4gcGFzcyBpdCB0aHJvdWdoIGFsbCBmdW5jdGlvbnMgb24gdGhlIHN0
YWNrIHRvIGZpbGwgaXQgd2l0aCBkYXRhLCBhbmQKPiBmaW5hbGx5IHBhc3MgaXQgaW50byBpb21t
dV9wcm9iZV9kZXZpY2VfZndzcGVjKCkgd2hpY2ggd2lsbCBsb2FkIGl0IGludG8KPiBkZXYtPmlv
bW11IHVuZGVyIGEgbG9jay4KPgo+IFNpZ25lZC1vZmYtYnk6IEphc29uIEd1bnRob3JwZSA8amdn
QG52aWRpYS5jb20+CgpBY2tlZC1ieTogUmFmYWVsIEouIFd5c29ja2kgPHJhZmFlbC5qLnd5c29j
a2lAaW50ZWwuY29tPgoKPiAtLS0KPiAgZHJpdmVycy9hY3BpL2FybTY0L2lvcnQuYyB8IDM5ICsr
KysrKysrLS0tLS0tLS0tCj4gIGRyaXZlcnMvYWNwaS9zY2FuLmMgICAgICAgfCA4OSArKysrKysr
KysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0KPiAgZHJpdmVycy9hY3BpL3Zpb3QuYyAg
ICAgICB8IDQ0ICsrKysrKysrKystLS0tLS0tLS0KPiAgZHJpdmVycy9pb21tdS9pb21tdS5jICAg
ICB8ICA1ICstLQo+ICBpbmNsdWRlL2FjcGkvYWNwaV9idXMuaCAgIHwgIDggKystLQo+ICBpbmNs
dWRlL2xpbnV4L2FjcGlfaW9ydC5oIHwgIDMgKy0KPiAgaW5jbHVkZS9saW51eC9hY3BpX3Zpb3Qu
aCB8ICA1ICsrLQo+ICBpbmNsdWRlL2xpbnV4L2lvbW11LmggICAgIHwgIDIgKwo+ICA4IGZpbGVz
IGNoYW5nZWQsIDk3IGluc2VydGlvbnMoKyksIDk4IGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdp
dCBhL2RyaXZlcnMvYWNwaS9hcm02NC9pb3J0LmMgYi9kcml2ZXJzL2FjcGkvYXJtNjQvaW9ydC5j
Cj4gaW5kZXggNjQ5NmZmNWE2YmEyMGQuLmFjY2QwMWRjZmU5M2Y1IDEwMDY0NAo+IC0tLSBhL2Ry
aXZlcnMvYWNwaS9hcm02NC9pb3J0LmMKPiArKysgYi9kcml2ZXJzL2FjcGkvYXJtNjQvaW9ydC5j
Cj4gQEAgLTEyMTgsMTAgKzEyMTgsOSBAQCBzdGF0aWMgYm9vbCBpb3J0X3BjaV9yY19zdXBwb3J0
c19hdHMoc3RydWN0IGFjcGlfaW9ydF9ub2RlICpub2RlKQo+ICAgICAgICAgcmV0dXJuIHBjaV9y
Yy0+YXRzX2F0dHJpYnV0ZSAmIEFDUElfSU9SVF9BVFNfU1VQUE9SVEVEOwo+ICB9Cj4KPiAtc3Rh
dGljIGludCBpb3J0X2lvbW11X3hsYXRlKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGFjcGlf
aW9ydF9ub2RlICpub2RlLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICB1MzIgc3RyZWFt
aWQpCj4gK3N0YXRpYyBpbnQgaW9ydF9pb21tdV94bGF0ZShzdHJ1Y3QgaW9tbXVfZndzcGVjICpm
d3NwZWMsIHN0cnVjdCBkZXZpY2UgKmRldiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
c3RydWN0IGFjcGlfaW9ydF9ub2RlICpub2RlLCB1MzIgc3RyZWFtaWQpCj4gIHsKPiAtICAgICAg
IGNvbnN0IHN0cnVjdCBpb21tdV9vcHMgKm9wczsKPiAgICAgICAgIHN0cnVjdCBmd25vZGVfaGFu
ZGxlICppb3J0X2Z3bm9kZTsKPgo+ICAgICAgICAgaWYgKCFub2RlKQo+IEBAIC0xMjM5LDE3ICsx
MjM4LDE0IEBAIHN0YXRpYyBpbnQgaW9ydF9pb21tdV94bGF0ZShzdHJ1Y3QgZGV2aWNlICpkZXYs
IHN0cnVjdCBhY3BpX2lvcnRfbm9kZSAqbm9kZSwKPiAgICAgICAgICAqIGluIHRoZSBrZXJuZWwg
b3Igbm90LCBkZWZlciB0aGUgSU9NTVUgY29uZmlndXJhdGlvbgo+ICAgICAgICAgICogb3IganVz
dCBhYm9ydCBpdC4KPiAgICAgICAgICAqLwo+IC0gICAgICAgb3BzID0gaW9tbXVfb3BzX2Zyb21f
Zndub2RlKGlvcnRfZndub2RlKTsKPiAtICAgICAgIGlmICghb3BzKQo+IC0gICAgICAgICAgICAg
ICByZXR1cm4gaW9ydF9pb21tdV9kcml2ZXJfZW5hYmxlZChub2RlLT50eXBlKSA/Cj4gLSAgICAg
ICAgICAgICAgICAgICAgICAtRVBST0JFX0RFRkVSIDogLUVOT0RFVjsKPiAtCj4gLSAgICAgICBy
ZXR1cm4gYWNwaV9pb21tdV9md3NwZWNfaW5pdChkZXYsIHN0cmVhbWlkLCBpb3J0X2Z3bm9kZSwg
b3BzKTsKPiArICAgICAgIHJldHVybiBhY3BpX2lvbW11X2Z3c3BlY19pbml0KGZ3c3BlYywgZGV2
LCBzdHJlYW1pZCwgaW9ydF9md25vZGUsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpb3J0X2lvbW11X2RyaXZlcl9lbmFibGVkKG5vZGUtPnR5cGUpKTsKPiAgfQo+Cj4g
IHN0cnVjdCBpb3J0X3BjaV9hbGlhc19pbmZvIHsKPiAgICAgICAgIHN0cnVjdCBkZXZpY2UgKmRl
djsKPiAgICAgICAgIHN0cnVjdCBhY3BpX2lvcnRfbm9kZSAqbm9kZTsKPiArICAgICAgIHN0cnVj
dCBpb21tdV9md3NwZWMgKmZ3c3BlYzsKPiAgfTsKPgo+ICBzdGF0aWMgaW50IGlvcnRfcGNpX2lv
bW11X2luaXQoc3RydWN0IHBjaV9kZXYgKnBkZXYsIHUxNiBhbGlhcywgdm9pZCAqZGF0YSkKPiBA
QCAtMTI2MCw3ICsxMjU2LDcgQEAgc3RhdGljIGludCBpb3J0X3BjaV9pb21tdV9pbml0KHN0cnVj
dCBwY2lfZGV2ICpwZGV2LCB1MTYgYWxpYXMsIHZvaWQgKmRhdGEpCj4KPiAgICAgICAgIHBhcmVu
dCA9IGlvcnRfbm9kZV9tYXBfaWQoaW5mby0+bm9kZSwgYWxpYXMsICZzdHJlYW1pZCwKPiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSU9SVF9JT01NVV9UWVBFKTsKPiAtICAgICAg
IHJldHVybiBpb3J0X2lvbW11X3hsYXRlKGluZm8tPmRldiwgcGFyZW50LCBzdHJlYW1pZCk7Cj4g
KyAgICAgICByZXR1cm4gaW9ydF9pb21tdV94bGF0ZShpbmZvLT5md3NwZWMsIGluZm8tPmRldiwg
cGFyZW50LCBzdHJlYW1pZCk7Cj4gIH0KPgo+ICBzdGF0aWMgdm9pZCBpb3J0X25hbWVkX2NvbXBv
bmVudF9pbml0KHN0cnVjdCBkZXZpY2UgKmRldiwKPiBAQCAtMTI4MCw3ICsxMjc2LDggQEAgc3Rh
dGljIHZvaWQgaW9ydF9uYW1lZF9jb21wb25lbnRfaW5pdChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4g
ICAgICAgICAgICAgICAgIGRldl93YXJuKGRldiwgIkNvdWxkIG5vdCBhZGQgZGV2aWNlIHByb3Bl
cnRpZXNcbiIpOwo+ICB9Cj4KPiAtc3RhdGljIGludCBpb3J0X25jX2lvbW11X21hcChzdHJ1Y3Qg
ZGV2aWNlICpkZXYsIHN0cnVjdCBhY3BpX2lvcnRfbm9kZSAqbm9kZSkKPiArc3RhdGljIGludCBp
b3J0X25jX2lvbW11X21hcChzdHJ1Y3QgaW9tbXVfZndzcGVjICpmd3NwZWMsIHN0cnVjdCBkZXZp
Y2UgKmRldiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBhY3BpX2lvcnRf
bm9kZSAqbm9kZSkKPiAgewo+ICAgICAgICAgc3RydWN0IGFjcGlfaW9ydF9ub2RlICpwYXJlbnQ7
Cj4gICAgICAgICBpbnQgZXJyID0gLUVOT0RFViwgaSA9IDA7Cj4gQEAgLTEyOTMsMTMgKzEyOTAs
MTMgQEAgc3RhdGljIGludCBpb3J0X25jX2lvbW11X21hcChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0
cnVjdCBhY3BpX2lvcnRfbm9kZSAqbm9kZSkKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpKyspOwo+Cj4gICAgICAgICAgICAgICAgIGlmIChwYXJl
bnQpCj4gLSAgICAgICAgICAgICAgICAgICAgICAgZXJyID0gaW9ydF9pb21tdV94bGF0ZShkZXYs
IHBhcmVudCwgc3RyZWFtaWQpOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIGVyciA9IGlvcnRf
aW9tbXVfeGxhdGUoZndzcGVjLCBkZXYsIHBhcmVudCwgc3RyZWFtaWQpOwo+ICAgICAgICAgfSB3
aGlsZSAocGFyZW50ICYmICFlcnIpOwo+Cj4gICAgICAgICByZXR1cm4gZXJyOwo+ICB9Cj4KPiAt
c3RhdGljIGludCBpb3J0X25jX2lvbW11X21hcF9pZChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gK3N0
YXRpYyBpbnQgaW9ydF9uY19pb21tdV9tYXBfaWQoc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVj
LCBzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgYWNwaV9pb3J0X25vZGUgKm5vZGUsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBjb25zdCB1MzIgKmluX2lkKQo+ICB7Cj4gQEAgLTEzMDgsNyArMTMwNSw3IEBAIHN0YXRp
YyBpbnQgaW9ydF9uY19pb21tdV9tYXBfaWQoc3RydWN0IGRldmljZSAqZGV2LAo+Cj4gICAgICAg
ICBwYXJlbnQgPSBpb3J0X25vZGVfbWFwX2lkKG5vZGUsICppbl9pZCwgJnN0cmVhbWlkLCBJT1JU
X0lPTU1VX1RZUEUpOwo+ICAgICAgICAgaWYgKHBhcmVudCkKPiAtICAgICAgICAgICAgICAgcmV0
dXJuIGlvcnRfaW9tbXVfeGxhdGUoZGV2LCBwYXJlbnQsIHN0cmVhbWlkKTsKPiArICAgICAgICAg
ICAgICAgcmV0dXJuIGlvcnRfaW9tbXVfeGxhdGUoZndzcGVjLCBkZXYsIHBhcmVudCwgc3RyZWFt
aWQpOwo+Cj4gICAgICAgICByZXR1cm4gLUVOT0RFVjsKPiAgfQo+IEBAIC0xMzIyLDE1ICsxMzE5
LDE2IEBAIHN0YXRpYyBpbnQgaW9ydF9uY19pb21tdV9tYXBfaWQoc3RydWN0IGRldmljZSAqZGV2
LAo+ICAgKgo+ICAgKiBSZXR1cm5zOiAwIG9uIHN1Y2Nlc3MsIDwwIG9uIGZhaWx1cmUKPiAgICov
Cj4gLWludCBpb3J0X2lvbW11X2NvbmZpZ3VyZV9pZChzdHJ1Y3QgZGV2aWNlICpkZXYsIGNvbnN0
IHUzMiAqaWRfaW4pCj4gK2ludCBpb3J0X2lvbW11X2NvbmZpZ3VyZV9pZChzdHJ1Y3QgaW9tbXVf
ZndzcGVjICpmd3NwZWMsIHN0cnVjdCBkZXZpY2UgKmRldiwKPiArICAgICAgICAgICAgICAgICAg
ICAgICAgICAgY29uc3QgdTMyICppZF9pbikKPiAgewo+ICAgICAgICAgc3RydWN0IGFjcGlfaW9y
dF9ub2RlICpub2RlOwo+ICAgICAgICAgaW50IGVyciA9IC1FTk9ERVY7Cj4KPiAgICAgICAgIGlm
IChkZXZfaXNfcGNpKGRldikpIHsKPiAtICAgICAgICAgICAgICAgc3RydWN0IGlvbW11X2Z3c3Bl
YyAqZndzcGVjOwo+ICAgICAgICAgICAgICAgICBzdHJ1Y3QgcGNpX2J1cyAqYnVzID0gdG9fcGNp
X2RldihkZXYpLT5idXM7Cj4gLSAgICAgICAgICAgICAgIHN0cnVjdCBpb3J0X3BjaV9hbGlhc19p
bmZvIGluZm8gPSB7IC5kZXYgPSBkZXYgfTsKPiArICAgICAgICAgICAgICAgc3RydWN0IGlvcnRf
cGNpX2FsaWFzX2luZm8gaW5mbyA9IHsgLmRldiA9IGRldiwKPiArICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZ3c3BlYyA9IGZ3c3BlYyB9Owo+Cj4g
ICAgICAgICAgICAgICAgIG5vZGUgPSBpb3J0X3NjYW5fbm9kZShBQ1BJX0lPUlRfTk9ERV9QQ0lf
Uk9PVF9DT01QTEVYLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW9y
dF9tYXRjaF9ub2RlX2NhbGxiYWNrLCAmYnVzLT5kZXYpOwo+IEBAIC0xMzQxLDggKzEzMzksNyBA
QCBpbnQgaW9ydF9pb21tdV9jb25maWd1cmVfaWQoc3RydWN0IGRldmljZSAqZGV2LCBjb25zdCB1
MzIgKmlkX2luKQo+ICAgICAgICAgICAgICAgICBlcnIgPSBwY2lfZm9yX2VhY2hfZG1hX2FsaWFz
KHRvX3BjaV9kZXYoZGV2KSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpb3J0X3BjaV9pb21tdV9pbml0LCAmaW5mbyk7Cj4KPiAtICAgICAgICAgICAgICAg
ZndzcGVjID0gZGV2X2lvbW11X2Z3c3BlY19nZXQoZGV2KTsKPiAtICAgICAgICAgICAgICAgaWYg
KGZ3c3BlYyAmJiBpb3J0X3BjaV9yY19zdXBwb3J0c19hdHMobm9kZSkpCj4gKyAgICAgICAgICAg
ICAgIGlmIChpb3J0X3BjaV9yY19zdXBwb3J0c19hdHMobm9kZSkpCj4gICAgICAgICAgICAgICAg
ICAgICAgICAgZndzcGVjLT5mbGFncyB8PSBJT01NVV9GV1NQRUNfUENJX1JDX0FUUzsKPiAgICAg
ICAgIH0gZWxzZSB7Cj4gICAgICAgICAgICAgICAgIG5vZGUgPSBpb3J0X3NjYW5fbm9kZShBQ1BJ
X0lPUlRfTk9ERV9OQU1FRF9DT01QT05FTlQsCj4gQEAgLTEzNTAsOCArMTM0Nyw4IEBAIGludCBp
b3J0X2lvbW11X2NvbmZpZ3VyZV9pZChzdHJ1Y3QgZGV2aWNlICpkZXYsIGNvbnN0IHUzMiAqaWRf
aW4pCj4gICAgICAgICAgICAgICAgIGlmICghbm9kZSkKPiAgICAgICAgICAgICAgICAgICAgICAg
ICByZXR1cm4gLUVOT0RFVjsKPgo+IC0gICAgICAgICAgICAgICBlcnIgPSBpZF9pbiA/IGlvcnRf
bmNfaW9tbXVfbWFwX2lkKGRldiwgbm9kZSwgaWRfaW4pIDoKPiAtICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBpb3J0X25jX2lvbW11X21hcChkZXYsIG5vZGUpOwo+ICsgICAgICAgICAgICAg
ICBlcnIgPSBpZF9pbiA/IGlvcnRfbmNfaW9tbXVfbWFwX2lkKGZ3c3BlYywgZGV2LCBub2RlLCBp
ZF9pbikgOgo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvcnRfbmNfaW9tbXVfbWFw
KGZ3c3BlYywgZGV2LCBub2RlKTsKPgo+ICAgICAgICAgICAgICAgICBpZiAoIWVycikKPiAgICAg
ICAgICAgICAgICAgICAgICAgICBpb3J0X25hbWVkX2NvbXBvbmVudF9pbml0KGRldiwgbm9kZSk7
Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvYWNwaS9zY2FuLmMgYi9kcml2ZXJzL2FjcGkvc2Nhbi5j
Cj4gaW5kZXggZmJhYmRlMDAxYTIzYTIuLjFlMDFhOGUwMzE2ODY3IDEwMDY0NAo+IC0tLSBhL2Ry
aXZlcnMvYWNwaS9zY2FuLmMKPiArKysgYi9kcml2ZXJzL2FjcGkvc2Nhbi5jCj4gQEAgLTE1NDMs
NzQgKzE1NDMsNjcgQEAgaW50IGFjcGlfZG1hX2dldF9yYW5nZShzdHJ1Y3QgZGV2aWNlICpkZXYs
IGNvbnN0IHN0cnVjdCBidXNfZG1hX3JlZ2lvbiAqKm1hcCkKPiAgfQo+Cj4gICNpZmRlZiBDT05G
SUdfSU9NTVVfQVBJCj4gLWludCBhY3BpX2lvbW11X2Z3c3BlY19pbml0KHN0cnVjdCBkZXZpY2Ug
KmRldiwgdTMyIGlkLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBmd25vZGVf
aGFuZGxlICpmd25vZGUsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0
IGlvbW11X29wcyAqb3BzKQo+ICtpbnQgYWNwaV9pb21tdV9md3NwZWNfaW5pdChzdHJ1Y3QgaW9t
bXVfZndzcGVjICpmd3NwZWMsIHN0cnVjdCBkZXZpY2UgKmRldiwKPiArICAgICAgICAgICAgICAg
ICAgICAgICAgICB1MzIgaWQsIHN0cnVjdCBmd25vZGVfaGFuZGxlICpmd25vZGUsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgYm9vbCBpb21tdV9kcml2ZXJfYXZhaWxhYmxlKQo+ICB7Cj4g
LSAgICAgICBpbnQgcmV0ID0gaW9tbXVfZndzcGVjX2luaXQoZGV2LCBmd25vZGUsIG9wcyk7Cj4g
KyAgICAgICBpbnQgcmV0Owo+Cj4gLSAgICAgICBpZiAoIXJldCkKPiAtICAgICAgICAgICAgICAg
cmV0ID0gaW9tbXVfZndzcGVjX2FkZF9pZHMoZGV2LCAmaWQsIDEpOwo+IC0KPiAtICAgICAgIHJl
dHVybiByZXQ7Cj4gLX0KPiAtCj4gLXN0YXRpYyBpbmxpbmUgY29uc3Qgc3RydWN0IGlvbW11X29w
cyAqYWNwaV9pb21tdV9md3NwZWNfb3BzKHN0cnVjdCBkZXZpY2UgKmRldikKPiAtewo+IC0gICAg
ICAgc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjID0gZGV2X2lvbW11X2Z3c3BlY19nZXQoZGV2
KTsKPiAtCj4gLSAgICAgICByZXR1cm4gZndzcGVjID8gZndzcGVjLT5vcHMgOiBOVUxMOwo+ICsg
ICAgICAgcmV0ID0gaW9tbXVfZndzcGVjX2Fzc2lnbl9pb21tdShmd3NwZWMsIGRldiwgZndub2Rl
KTsKPiArICAgICAgIGlmIChyZXQpIHsKPiArICAgICAgICAgICAgICAgaWYgKHJldCA9PSAtRVBS
T0JFX0RFRkVSICYmICFpb21tdV9kcml2ZXJfYXZhaWxhYmxlKQo+ICsgICAgICAgICAgICAgICAg
ICAgICAgIHJldHVybiAtRU5PREVWOwo+ICsgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICsg
ICAgICAgfQo+ICsgICAgICAgcmV0dXJuIGlvbW11X2Z3c3BlY19hcHBlbmRfaWRzKGZ3c3BlYywg
JmlkLCAxKTsKPiAgfQo+Cj4gIHN0YXRpYyBpbnQgYWNwaV9pb21tdV9jb25maWd1cmVfaWQoc3Ry
dWN0IGRldmljZSAqZGV2LCBjb25zdCB1MzIgKmlkX2luKQo+ICB7Cj4gICAgICAgICBpbnQgZXJy
Owo+IC0gICAgICAgY29uc3Qgc3RydWN0IGlvbW11X29wcyAqb3BzOwo+ICsgICAgICAgc3RydWN0
IGlvbW11X2Z3c3BlYyAqZndzcGVjOwo+Cj4gLSAgICAgICAvKgo+IC0gICAgICAgICogSWYgd2Ug
YWxyZWFkeSB0cmFuc2xhdGVkIHRoZSBmd3NwZWMgdGhlcmUgaXMgbm90aGluZyBsZWZ0IHRvIGRv
LAo+IC0gICAgICAgICogcmV0dXJuIHRoZSBpb21tdV9vcHMuCj4gLSAgICAgICAgKi8KPiAtICAg
ICAgIG9wcyA9IGFjcGlfaW9tbXVfZndzcGVjX29wcyhkZXYpOwo+IC0gICAgICAgaWYgKG9wcykK
PiAtICAgICAgICAgICAgICAgcmV0dXJuIDA7Cj4gKyAgICAgICBmd3NwZWMgPSBpb21tdV9md3Nw
ZWNfYWxsb2MoKTsKPiArICAgICAgIGlmIChJU19FUlIoZndzcGVjKSkKPiArICAgICAgICAgICAg
ICAgcmV0dXJuIFBUUl9FUlIoZndzcGVjKTsKPgo+IC0gICAgICAgZXJyID0gaW9ydF9pb21tdV9j
b25maWd1cmVfaWQoZGV2LCBpZF9pbik7Cj4gLSAgICAgICBpZiAoZXJyICYmIGVyciAhPSAtRVBS
T0JFX0RFRkVSKQo+IC0gICAgICAgICAgICAgICBlcnIgPSB2aW90X2lvbW11X2NvbmZpZ3VyZShk
ZXYpOwo+ICsgICAgICAgZXJyID0gaW9ydF9pb21tdV9jb25maWd1cmVfaWQoZndzcGVjLCBkZXYs
IGlkX2luKTsKPiArICAgICAgIGlmIChlcnIgPT0gLUVOT0RFVikKPiArICAgICAgICAgICAgICAg
ZXJyID0gdmlvdF9pb21tdV9jb25maWd1cmUoZndzcGVjLCBkZXYpOwo+ICsgICAgICAgaWYgKGVy
ciA9PSAtRU5PREVWIHx8IGVyciA9PSAtRVBST0JFX0RFRkVSKQo+ICsgICAgICAgICAgICAgICBn
b3RvIGVycl9mcmVlOwo+ICsgICAgICAgaWYgKGVycikKPiArICAgICAgICAgICAgICAgZ290byBl
cnJfbG9nOwo+Cj4gLSAgICAgICAvKgo+IC0gICAgICAgICogSWYgd2UgaGF2ZSByZWFzb24gdG8g
YmVsaWV2ZSB0aGUgSU9NTVUgZHJpdmVyIG1pc3NlZCB0aGUgaW5pdGlhbAo+IC0gICAgICAgICog
aW9tbXVfcHJvYmVfZGV2aWNlKCkgY2FsbCBmb3IgZGV2LCByZXBsYXkgaXQgdG8gZ2V0IHRoaW5n
cyBpbiBvcmRlci4KPiAtICAgICAgICAqLwo+IC0gICAgICAgaWYgKCFlcnIgJiYgZGV2LT5idXMp
Cj4gLSAgICAgICAgICAgICAgIGVyciA9IGlvbW11X3Byb2JlX2RldmljZShkZXYpOwo+IC0KPiAt
ICAgICAgIC8qIElnbm9yZSBhbGwgb3RoZXIgZXJyb3JzIGFwYXJ0IGZyb20gRVBST0JFX0RFRkVS
ICovCj4gLSAgICAgICBpZiAoZXJyID09IC1FUFJPQkVfREVGRVIpIHsKPiAtICAgICAgICAgICAg
ICAgcmV0dXJuIGVycjsKPiAtICAgICAgIH0gZWxzZSBpZiAoZXJyKSB7Cj4gLSAgICAgICAgICAg
ICAgIGRldl9kYmcoZGV2LCAiQWRkaW5nIHRvIElPTU1VIGZhaWxlZDogJWRcbiIsIGVycik7Cj4g
LSAgICAgICAgICAgICAgIHJldHVybiAtRU5PREVWOwo+ICsgICAgICAgZXJyID0gaW9tbXVfcHJv
YmVfZGV2aWNlX2Z3c3BlYyhkZXYsIGZ3c3BlYyk7Cj4gKyAgICAgICBpZiAoZXJyKSB7Cj4gKyAg
ICAgICAgICAgICAgIC8qCj4gKyAgICAgICAgICAgICAgICAqIE93bmVyc2hpcCBmb3IgZndzcGVj
IGFsd2F5cyBwYXNzZXMgaW50bwo+ICsgICAgICAgICAgICAgICAgKiBpb21tdV9wcm9iZV9kZXZp
Y2VfZndzcGVjKCkKPiArICAgICAgICAgICAgICAgICovCj4gKyAgICAgICAgICAgICAgIGZ3c3Bl
YyA9IE5VTEw7Cj4gKyAgICAgICAgICAgICAgIGdvdG8gZXJyX2xvZzsKPiAgICAgICAgIH0KPiAt
ICAgICAgIGlmICghYWNwaV9pb21tdV9md3NwZWNfb3BzKGRldikpCj4gLSAgICAgICAgICAgICAg
IHJldHVybiAtRU5PREVWOwo+IC0gICAgICAgcmV0dXJuIDA7Cj4gKwo+ICtlcnJfbG9nOgo+ICsg
ICAgICAgZGV2X2RiZyhkZXYsICJBZGRpbmcgdG8gSU9NTVUgZmFpbGVkOiAlZFxuIiwgZXJyKTsK
PiArZXJyX2ZyZWU6Cj4gKyAgICAgICBpb21tdV9md3NwZWNfZGVhbGxvYyhmd3NwZWMpOwo+ICsg
ICAgICAgcmV0dXJuIGVycjsKPiAgfQo+Cj4gICNlbHNlIC8qICFDT05GSUdfSU9NTVVfQVBJICov
Cj4KPiAtaW50IGFjcGlfaW9tbXVfZndzcGVjX2luaXQoc3RydWN0IGRldmljZSAqZGV2LCB1MzIg
aWQsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGZ3bm9kZV9oYW5kbGUgKmZ3
bm9kZSwKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJ1Y3QgaW9tbXVfb3Bz
ICpvcHMpCj4gK2ludCBhY3BpX2lvbW11X2Z3c3BlY19pbml0KHN0cnVjdCBpb21tdV9md3NwZWMg
KmZ3c3BlYywgc3RydWN0IGRldmljZSAqZGV2LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAg
IHUzMiBpZCwgc3RydWN0IGZ3bm9kZV9oYW5kbGUgKmZ3bm9kZSwKPiArICAgICAgICAgICAgICAg
ICAgICAgICAgICBib29sIGlvbW11X2RyaXZlcl9hdmFpbGFibGUpCj4gIHsKPiAgICAgICAgIHJl
dHVybiAtRU5PREVWOwo+ICB9Cj4KPiAtc3RhdGljIGNvbnN0IHN0cnVjdCBpb21tdV9vcHMgKmFj
cGlfaW9tbXVfY29uZmlndXJlX2lkKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAtICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdTMyICppZF9p
bikKPiArc3RhdGljIGNvbnN0IGludCBhY3BpX2lvbW11X2NvbmZpZ3VyZV9pZChzdHJ1Y3QgZGV2
aWNlICpkZXYsIGNvbnN0IHUzMiAqaWRfaW4pCj4gIHsKPiAtICAgICAgIHJldHVybiBOVUxMOwo+
ICsgICAgICAgcmV0dXJuIC1FTk9ERVY7Cj4gIH0KPgo+ICAjZW5kaWYgLyogIUNPTkZJR19JT01N
VV9BUEkgKi8KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9hY3BpL3Zpb3QuYyBiL2RyaXZlcnMvYWNw
aS92aW90LmMKPiBpbmRleCBjODAyNTkyMWMxMjliMi4uMzNiNTExZGQyMDJkMTUgMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9hY3BpL3Zpb3QuYwo+ICsrKyBiL2RyaXZlcnMvYWNwaS92aW90LmMKPiBA
QCAtMzA0LDExICszMDQsOSBAQCB2b2lkIF9faW5pdCBhY3BpX3Zpb3RfaW5pdCh2b2lkKQo+ICAg
ICAgICAgYWNwaV9wdXRfdGFibGUoaGRyKTsKPiAgfQo+Cj4gLXN0YXRpYyBpbnQgdmlvdF9kZXZf
aW9tbXVfaW5pdChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCB2aW90X2lvbW11ICp2aW9tbXUs
Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUzMiBlcGlkKQo+ICtzdGF0aWMgaW50
IHZpb3RfZGV2X2lvbW11X2luaXQoc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjLCBzdHJ1Y3Qg
ZGV2aWNlICpkZXYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aW90
X2lvbW11ICp2aW9tbXUsIHUzMiBlcGlkKQo+ICB7Cj4gLSAgICAgICBjb25zdCBzdHJ1Y3QgaW9t
bXVfb3BzICpvcHM7Cj4gLQo+ICAgICAgICAgaWYgKCF2aW9tbXUpCj4gICAgICAgICAgICAgICAg
IHJldHVybiAtRU5PREVWOwo+Cj4gQEAgLTMxNiwxOSArMzE0LDIwIEBAIHN0YXRpYyBpbnQgdmlv
dF9kZXZfaW9tbXVfaW5pdChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCB2aW90X2lvbW11ICp2
aW9tbXUsCj4gICAgICAgICBpZiAoZGV2aWNlX21hdGNoX2Z3bm9kZShkZXYsIHZpb21tdS0+Zndu
b2RlKSkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7Cj4KPiAtICAgICAgIG9wcyA9
IGlvbW11X29wc19mcm9tX2Z3bm9kZSh2aW9tbXUtPmZ3bm9kZSk7Cj4gLSAgICAgICBpZiAoIW9w
cykKPiAtICAgICAgICAgICAgICAgcmV0dXJuIElTX0VOQUJMRUQoQ09ORklHX1ZJUlRJT19JT01N
VSkgPwo+IC0gICAgICAgICAgICAgICAgICAgICAgIC1FUFJPQkVfREVGRVIgOiAtRU5PREVWOwo+
IC0KPiAtICAgICAgIHJldHVybiBhY3BpX2lvbW11X2Z3c3BlY19pbml0KGRldiwgZXBpZCwgdmlv
bW11LT5md25vZGUsIG9wcyk7Cj4gKyAgICAgICByZXR1cm4gYWNwaV9pb21tdV9md3NwZWNfaW5p
dChmd3NwZWMsIGRldiwgZXBpZCwgdmlvbW11LT5md25vZGUsCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBJU19FTkFCTEVEKENPTkZJR19WSVJUSU9fSU9NTVUpKTsKPiAg
fQo+Cj4gK3N0cnVjdCB2aW90X3BjaV9hbGlhc19pbmZvIHsKPiArICAgICAgIHN0cnVjdCBkZXZp
Y2UgKmRldjsKPiArICAgICAgIHN0cnVjdCBpb21tdV9md3NwZWMgKmZ3c3BlYzsKPiArfTsKPiAr
Cj4gIHN0YXRpYyBpbnQgdmlvdF9wY2lfZGV2X2lvbW11X2luaXQoc3RydWN0IHBjaV9kZXYgKnBk
ZXYsIHUxNiBkZXZfaWQsIHZvaWQgKmRhdGEpCj4gIHsKPiAgICAgICAgIHUzMiBlcGlkOwo+ICAg
ICAgICAgc3RydWN0IHZpb3RfZW5kcG9pbnQgKmVwOwo+IC0gICAgICAgc3RydWN0IGRldmljZSAq
YWxpYXNlZF9kZXYgPSBkYXRhOwo+ICsgICAgICAgc3RydWN0IHZpb3RfcGNpX2FsaWFzX2luZm8g
KmluZm8gPSBkYXRhOwo+ICAgICAgICAgdTMyIGRvbWFpbl9uciA9IHBjaV9kb21haW5fbnIocGRl
di0+YnVzKTsKPgo+ICAgICAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeShlcCwgJnZpb3RfcGNpX3Jh
bmdlcywgbGlzdCkgewo+IEBAIC0zMzksMTQgKzMzOCwxNSBAQCBzdGF0aWMgaW50IHZpb3RfcGNp
X2Rldl9pb21tdV9pbml0KHN0cnVjdCBwY2lfZGV2ICpwZGV2LCB1MTYgZGV2X2lkLCB2b2lkICpk
YXRhKQo+ICAgICAgICAgICAgICAgICAgICAgICAgIGVwaWQgPSAoKGRvbWFpbl9uciAtIGVwLT5z
ZWdtZW50X3N0YXJ0KSA8PCAxNikgKwo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ZGV2X2lkIC0gZXAtPmJkZl9zdGFydCArIGVwLT5lbmRwb2ludF9pZDsKPgo+IC0gICAgICAgICAg
ICAgICAgICAgICAgIHJldHVybiB2aW90X2Rldl9pb21tdV9pbml0KGFsaWFzZWRfZGV2LCBlcC0+
dmlvbW11LAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGVwaWQpOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aW90X2Rldl9pb21t
dV9pbml0KGluZm8tPmZ3c3BlYywgaW5mby0+ZGV2LAo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVwLT52aW9tbXUsIGVwaWQpOwo+ICAgICAgICAg
ICAgICAgICB9Cj4gICAgICAgICB9Cj4gICAgICAgICByZXR1cm4gLUVOT0RFVjsKPiAgfQo+Cj4g
LXN0YXRpYyBpbnQgdmlvdF9tbWlvX2Rldl9pb21tdV9pbml0KHN0cnVjdCBwbGF0Zm9ybV9kZXZp
Y2UgKnBkZXYpCj4gK3N0YXRpYyBpbnQgdmlvdF9tbWlvX2Rldl9pb21tdV9pbml0KHN0cnVjdCBp
b21tdV9md3NwZWMgKmZ3c3BlYywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgcmVz
b3VyY2UgKm1lbTsKPiAgICAgICAgIHN0cnVjdCB2aW90X2VuZHBvaW50ICplcDsKPiBAQCAtMzU3
LDggKzM1Nyw4IEBAIHN0YXRpYyBpbnQgdmlvdF9tbWlvX2Rldl9pb21tdV9pbml0KHN0cnVjdCBw
bGF0Zm9ybV9kZXZpY2UgKnBkZXYpCj4KPiAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnkoZXAs
ICZ2aW90X21taW9fZW5kcG9pbnRzLCBsaXN0KSB7Cj4gICAgICAgICAgICAgICAgIGlmIChlcC0+
YWRkcmVzcyA9PSBtZW0tPnN0YXJ0KQo+IC0gICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2
aW90X2Rldl9pb21tdV9pbml0KCZwZGV2LT5kZXYsIGVwLT52aW9tbXUsCj4gLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXAtPmVuZHBvaW50X2lkKTsK
PiArICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlvdF9kZXZfaW9tbXVfaW5pdChmd3Nw
ZWMsICZwZGV2LT5kZXYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZXAtPnZpb21tdSwgZXAtPmVuZHBvaW50X2lkKTsKPiAgICAgICAgIH0KPiAg
ICAgICAgIHJldHVybiAtRU5PREVWOwo+ICB9Cj4gQEAgLTM2OSwxMiArMzY5LDE2IEBAIHN0YXRp
YyBpbnQgdmlvdF9tbWlvX2Rldl9pb21tdV9pbml0KHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBk
ZXYpCj4gICAqCj4gICAqIFJldHVybjogMCBvbiBzdWNjZXNzLCA8MCBvbiBmYWlsdXJlCj4gICAq
Lwo+IC1pbnQgdmlvdF9pb21tdV9jb25maWd1cmUoc3RydWN0IGRldmljZSAqZGV2KQo+ICtpbnQg
dmlvdF9pb21tdV9jb25maWd1cmUoc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjLCBzdHJ1Y3Qg
ZGV2aWNlICpkZXYpCj4gIHsKPiAtICAgICAgIGlmIChkZXZfaXNfcGNpKGRldikpCj4gKyAgICAg
ICBpZiAoZGV2X2lzX3BjaShkZXYpKSB7Cj4gKyAgICAgICAgICAgICAgIHN0cnVjdCB2aW90X3Bj
aV9hbGlhc19pbmZvIGluZm8gPSB7IC5kZXYgPSBkZXYsCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5md3NwZWMgPSBmd3NwZWMgfTsKPiAgICAg
ICAgICAgICAgICAgcmV0dXJuIHBjaV9mb3JfZWFjaF9kbWFfYWxpYXModG9fcGNpX2RldihkZXYp
LAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aW90X3Bj
aV9kZXZfaW9tbXVfaW5pdCwgZGV2KTsKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdmlvdF9wY2lfZGV2X2lvbW11X2luaXQsICZpbmZvKTsKPiArICAgICAg
IH0KPiAgICAgICAgIGVsc2UgaWYgKGRldl9pc19wbGF0Zm9ybShkZXYpKQo+IC0gICAgICAgICAg
ICAgICByZXR1cm4gdmlvdF9tbWlvX2Rldl9pb21tdV9pbml0KHRvX3BsYXRmb3JtX2RldmljZShk
ZXYpKTsKPiArICAgICAgICAgICAgICAgcmV0dXJuIHZpb3RfbW1pb19kZXZfaW9tbXVfaW5pdChm
d3NwZWMsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dG9fcGxhdGZvcm1fZGV2aWNlKGRldikpOwo+ICAgICAgICAgcmV0dXJuIC1FTk9ERVY7Cj4gIH0K
PiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9pb21tdS9pb21tdS5jIGIvZHJpdmVycy9pb21tdS9pb21t
dS5jCj4gaW5kZXggMTVkYmUyZDllYjI0YzIuLjljZmJhOWQxMmQxNDAwIDEwMDY0NAo+IC0tLSBh
L2RyaXZlcnMvaW9tbXUvaW9tbXUuYwo+ICsrKyBiL2RyaXZlcnMvaW9tbXUvaW9tbXUuYwo+IEBA
IC0yOTYwLDkgKzI5NjAsOCBAQCBjb25zdCBzdHJ1Y3QgaW9tbXVfb3BzICppb21tdV9vcHNfZnJv
bV9md25vZGUoc3RydWN0IGZ3bm9kZV9oYW5kbGUgKmZ3bm9kZSkKPiAgICAgICAgIHJldHVybiBv
cHM7Cj4gIH0KPgo+IC1zdGF0aWMgaW50IGlvbW11X2Z3c3BlY19hc3NpZ25faW9tbXUoc3RydWN0
IGlvbW11X2Z3c3BlYyAqZndzcGVjLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0cnVjdCBmd25vZGVfaGFuZGxlICppb21tdV9md25vZGUpCj4gK2ludCBpb21tdV9m
d3NwZWNfYXNzaWduX2lvbW11KHN0cnVjdCBpb21tdV9md3NwZWMgKmZ3c3BlYywgc3RydWN0IGRl
dmljZSAqZGV2LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBmd25vZGVf
aGFuZGxlICppb21tdV9md25vZGUpCj4gIHsKPiAgICAgICAgIGNvbnN0IHN0cnVjdCBpb21tdV9v
cHMgKm9wczsKPgo+IGRpZmYgLS1naXQgYS9pbmNsdWRlL2FjcGkvYWNwaV9idXMuaCBiL2luY2x1
ZGUvYWNwaS9hY3BpX2J1cy5oCj4gaW5kZXggMjU0Njg1MDg1YzgyNWMuLjcwZjk3MDk2Yzc3NmU0
IDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvYWNwaS9hY3BpX2J1cy5oCj4gKysrIGIvaW5jbHVkZS9h
Y3BpL2FjcGlfYnVzLmgKPiBAQCAtMTIsNiArMTIsOCBAQAo+ICAjaW5jbHVkZSA8bGludXgvZGV2
aWNlLmg+Cj4gICNpbmNsdWRlIDxsaW51eC9wcm9wZXJ0eS5oPgo+Cj4gK3N0cnVjdCBpb21tdV9m
d3NwZWM7Cj4gKwo+ICAvKiBUQkQ6IE1ha2UgZHluYW1pYyAqLwo+ICAjZGVmaW5lIEFDUElfTUFY
X0hBTkRMRVMgICAgICAgMTAKPiAgc3RydWN0IGFjcGlfaGFuZGxlX2xpc3Qgewo+IEBAIC02MjUs
OSArNjI3LDkgQEAgc3RydWN0IGFjcGlfcGNpX3Jvb3Qgewo+Cj4gIGJvb2wgYWNwaV9kbWFfc3Vw
cG9ydGVkKGNvbnN0IHN0cnVjdCBhY3BpX2RldmljZSAqYWRldik7Cj4gIGVudW0gZGV2X2RtYV9h
dHRyIGFjcGlfZ2V0X2RtYV9hdHRyKHN0cnVjdCBhY3BpX2RldmljZSAqYWRldik7Cj4gLWludCBh
Y3BpX2lvbW11X2Z3c3BlY19pbml0KHN0cnVjdCBkZXZpY2UgKmRldiwgdTMyIGlkLAo+IC0gICAg
ICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBmd25vZGVfaGFuZGxlICpmd25vZGUsCj4gLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IGlvbW11X29wcyAqb3BzKTsKPiAr
aW50IGFjcGlfaW9tbXVfZndzcGVjX2luaXQoc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjLCBz
dHJ1Y3QgZGV2aWNlICpkZXYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgdTMyIGlkLCBz
dHJ1Y3QgZndub2RlX2hhbmRsZSAqZndub2RlLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAg
IGJvb2wgaW9tbXVfZHJpdmVyX2F2YWlsYWJsZSk7Cj4gIGludCBhY3BpX2RtYV9nZXRfcmFuZ2Uo
c3RydWN0IGRldmljZSAqZGV2LCBjb25zdCBzdHJ1Y3QgYnVzX2RtYV9yZWdpb24gKiptYXApOwo+
ICBpbnQgYWNwaV9kbWFfY29uZmlndXJlX2lkKHN0cnVjdCBkZXZpY2UgKmRldiwgZW51bSBkZXZf
ZG1hX2F0dHIgYXR0ciwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1MzIgKmlu
cHV0X2lkKTsKPiBkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9hY3BpX2lvcnQuaCBiL2luY2x1
ZGUvbGludXgvYWNwaV9pb3J0LmgKPiBpbmRleCAxY2I2NTU5MmM5NWRkMy4uODA3OTRlYzQ1ZDE2
OTMgMTAwNjQ0Cj4gLS0tIGEvaW5jbHVkZS9saW51eC9hY3BpX2lvcnQuaAo+ICsrKyBiL2luY2x1
ZGUvbGludXgvYWNwaV9pb3J0LmgKPiBAQCAtNDAsNyArNDAsOCBAQCB2b2lkIGlvcnRfcHV0X3Jt
cl9zaWRzKHN0cnVjdCBmd25vZGVfaGFuZGxlICppb21tdV9md25vZGUsCj4gICAgICAgICAgICAg
ICAgICAgICAgICBzdHJ1Y3QgbGlzdF9oZWFkICpoZWFkKTsKPiAgLyogSU9NTVUgaW50ZXJmYWNl
ICovCj4gIGludCBpb3J0X2RtYV9nZXRfcmFuZ2VzKHN0cnVjdCBkZXZpY2UgKmRldiwgdTY0ICpz
aXplKTsKPiAtaW50IGlvcnRfaW9tbXVfY29uZmlndXJlX2lkKHN0cnVjdCBkZXZpY2UgKmRldiwg
Y29uc3QgdTMyICppZF9pbik7Cj4gK2ludCBpb3J0X2lvbW11X2NvbmZpZ3VyZV9pZChzdHJ1Y3Qg
aW9tbXVfZndzcGVjICpmd3NwZWMsIHN0cnVjdCBkZXZpY2UgKmRldiwKPiArICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY29uc3QgdTMyICppZF9pbik7Cj4gIHZvaWQgaW9ydF9pb21tdV9nZXRf
cmVzdl9yZWdpb25zKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGxpc3RfaGVhZCAqaGVhZCk7
Cj4gIHBoeXNfYWRkcl90IGFjcGlfaW9ydF9kbWFfZ2V0X21heF9jcHVfYWRkcmVzcyh2b2lkKTsK
PiAgI2Vsc2UKPiBkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9hY3BpX3Zpb3QuaCBiL2luY2x1
ZGUvbGludXgvYWNwaV92aW90LmgKPiBpbmRleCBhNWExMjI0MzE1NjM3Ny4uZjE4NzRjYjZkNDNj
MDkgMTAwNjQ0Cj4gLS0tIGEvaW5jbHVkZS9saW51eC9hY3BpX3Zpb3QuaAo+ICsrKyBiL2luY2x1
ZGUvbGludXgvYWNwaV92aW90LmgKPiBAQCAtOCwxMSArOCwxMiBAQAo+ICAjaWZkZWYgQ09ORklH
X0FDUElfVklPVAo+ICB2b2lkIF9faW5pdCBhY3BpX3Zpb3RfZWFybHlfaW5pdCh2b2lkKTsKPiAg
dm9pZCBfX2luaXQgYWNwaV92aW90X2luaXQodm9pZCk7Cj4gLWludCB2aW90X2lvbW11X2NvbmZp
Z3VyZShzdHJ1Y3QgZGV2aWNlICpkZXYpOwo+ICtpbnQgdmlvdF9pb21tdV9jb25maWd1cmUoc3Ry
dWN0IGlvbW11X2Z3c3BlYyAqZndzcGVjLCBzdHJ1Y3QgZGV2aWNlICpkZXYpOwo+ICAjZWxzZQo+
ICBzdGF0aWMgaW5saW5lIHZvaWQgYWNwaV92aW90X2Vhcmx5X2luaXQodm9pZCkge30KPiAgc3Rh
dGljIGlubGluZSB2b2lkIGFjcGlfdmlvdF9pbml0KHZvaWQpIHt9Cj4gLXN0YXRpYyBpbmxpbmUg
aW50IHZpb3RfaW9tbXVfY29uZmlndXJlKHN0cnVjdCBkZXZpY2UgKmRldikKPiArc3RhdGljIGlu
bGluZSBpbnQgdmlvdF9pb21tdV9jb25maWd1cmUoc3RydWN0IGlvbW11X2Z3c3BlYyAqZndzcGVj
LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkZXZpY2Ug
KmRldikKPiAgewo+ICAgICAgICAgcmV0dXJuIC1FTk9ERVY7Cj4gIH0KPiBkaWZmIC0tZ2l0IGEv
aW5jbHVkZS9saW51eC9pb21tdS5oIGIvaW5jbHVkZS9saW51eC9pb21tdS5oCj4gaW5kZXggYzVh
NWUyYjVlMmNjMmEuLjI3ZTQ2MDVkNDk4ODUwIDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvbGludXgv
aW9tbXUuaAo+ICsrKyBiL2luY2x1ZGUvbGludXgvaW9tbXUuaAo+IEBAIC02ODgsNiArNjg4LDgg
QEAgdm9pZCBpb21tdV9md3NwZWNfZGVhbGxvYyhzdHJ1Y3QgaW9tbXVfZndzcGVjICpmd3NwZWMp
Owo+ICBpbnQgaW9tbXVfZndzcGVjX29mX3hsYXRlKHN0cnVjdCBpb21tdV9md3NwZWMgKmZ3c3Bl
Yywgc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGZ3bm9kZV9oYW5kbGUgKmlvbW11X2Z3bm9kZSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCBvZl9waGFuZGxlX2FyZ3MgKmlvbW11X3NwZWMpOwo+ICtpbnQgaW9tbXVfZndzcGVj
X2Fzc2lnbl9pb21tdShzdHJ1Y3QgaW9tbXVfZndzcGVjICpmd3NwZWMsIHN0cnVjdCBkZXZpY2Ug
KmRldiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgZndub2RlX2hhbmRs
ZSAqaW9tbXVfZndub2RlKTsKPgo+ICBpbnQgaW9tbXVfZndzcGVjX2luaXQoc3RydWN0IGRldmlj
ZSAqZGV2LCBzdHJ1Y3QgZndub2RlX2hhbmRsZSAqaW9tbXVfZndub2RlLAo+ICAgICAgICAgICAg
ICAgICAgICAgICBjb25zdCBzdHJ1Y3QgaW9tbXVfb3BzICpvcHMpOwo+IC0tCj4gMi40Mi4wCj4K
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6
YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24u
b3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3Zp
cnR1YWxpemF0aW9u
