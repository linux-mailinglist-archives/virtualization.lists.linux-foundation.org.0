Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp1.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id 34E846D3CA1
	for <lists.virtualization@lfdr.de>; Mon,  3 Apr 2023 07:01:41 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp1.osuosl.org (Postfix) with ESMTP id B5F0E81E9E;
	Mon,  3 Apr 2023 05:01:39 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org B5F0E81E9E
Authentication-Results: smtp1.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=SHG0omOS
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
	by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id K2lh1gU6aljC; Mon,  3 Apr 2023 05:01:36 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp1.osuosl.org (Postfix) with ESMTPS id EEB7A81EA1;
	Mon,  3 Apr 2023 05:01:35 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org EEB7A81EA1
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 1FE5EC008C;
	Mon,  3 Apr 2023 05:01:35 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 18B75C002F
 for <virtualization@lists.linux-foundation.org>;
 Mon,  3 Apr 2023 05:01:34 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id DF77F81EA0
 for <virtualization@lists.linux-foundation.org>;
 Mon,  3 Apr 2023 05:01:33 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org DF77F81EA0
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id OVG0-LGW6hDn
 for <virtualization@lists.linux-foundation.org>;
 Mon,  3 Apr 2023 05:01:31 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 8900981E9E
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.133.124])
 by smtp1.osuosl.org (Postfix) with ESMTPS id 8900981E9E
 for <virtualization@lists.linux-foundation.org>;
 Mon,  3 Apr 2023 05:01:31 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1680498089;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=xJP/C6H1uZ7ME9s8+9WKsPaLWQqPJu8+sRYQrZeQjsM=;
 b=SHG0omOSYPqLQNchYIGcMwdt3f5oFdRgMJH+UhcOOFWo/27F3uneUH6tw18jA8+ki6IbAh
 ZqSUgB59WFUA8PTKuzqWqPIM32l3okdXk7gJFxWKBmuaqSKA0E5SJ88sPvC+ReGL7CSBt8
 ZAL7x7anaZjYW5xITX+3Q0XmbDhNnyg=
Received: from mail-oa1-f70.google.com (mail-oa1-f70.google.com
 [209.85.160.70]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-578-uDHV15j5M4-HKezmUoRj3w-1; Mon, 03 Apr 2023 01:01:28 -0400
X-MC-Unique: uDHV15j5M4-HKezmUoRj3w-1
Received: by mail-oa1-f70.google.com with SMTP id
 586e51a60fabf-1777dadbde5so14996984fac.7
 for <virtualization@lists.linux-foundation.org>;
 Sun, 02 Apr 2023 22:01:28 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112; t=1680498088; x=1683090088;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=xJP/C6H1uZ7ME9s8+9WKsPaLWQqPJu8+sRYQrZeQjsM=;
 b=4VU0uvAlFiYjCt8H9Azg8yWxGscvEofFnoN1MouKP9tqxRo4gH1dxnGbLjfGiR1Cok
 VbrDY9ThlYSi9YZ3hf4wyASbNm9+AqRy6OvOFZ9kTsrnUvdi3M6wANRQ3lOduD2Zj+S1
 PVp95IPZsD9aurKQedQjwNXKusRWL9XiNMPrzpX7h3Z/aKHR1iRex457JBM74BTEmISp
 6jyr6Ui3GAIvrxVUoPYnBoU/cPHv141Z4CcIqgRta7XzIVih/Zwn9tr9nvvGULXdsr7P
 E2D4YZAZfpBB51IRqqUm3omySDG7nLEbHUZD491EOw7ZWOJ2/y9NFA+OAENBJ5exLZAD
 zDBg==
X-Gm-Message-State: AAQBX9em2MX2UgUmIlUzaXJJv3AMN4vc2im8pBpXPeLKjGZmZdpsaaX5
 j5LVyujttgiwozXOROt3D+8CE8W9siT+/hScuM1+ipxWHgeSWtXzNzYFhkuFB9hPEzBCo30UsxR
 IaSztcD+B4AB7ilE4X7zX0wNpJ+LXkI3XxY1QL8VuI83GfYdg03RMpWsFRg==
X-Received: by 2002:a05:6871:e45:b0:17f:1723:fc82 with SMTP id
 vk5-20020a0568710e4500b0017f1723fc82mr8990498oab.9.1680498087931; 
 Sun, 02 Apr 2023 22:01:27 -0700 (PDT)
X-Google-Smtp-Source: AKy350ZAeIkfvEqD1vimn5EAskIB3Xro3pXunpquLmVVe8B1u34TAwo5xmvrSg5vJfj8q8n1+Mthph1wGcYakO9+qLU=
X-Received: by 2002:a05:6871:e45:b0:17f:1723:fc82 with SMTP id
 vk5-20020a0568710e4500b0017f1723fc82mr8990476oab.9.1680498087162; Sun, 02 Apr
 2023 22:01:27 -0700 (PDT)
MIME-Version: 1.0
References: <20230402141450.99698-1-elic@nvidia.com>
In-Reply-To: <20230402141450.99698-1-elic@nvidia.com>
From: Jason Wang <jasowang@redhat.com>
Date: Mon, 3 Apr 2023 13:01:16 +0800
Message-ID: <CACGkMEv+zBf3wObyKTZUp-9ox6NL5PgWq265v9if19O+Tq6G5w@mail.gmail.com>
Subject: Re: [Patch v3] vdpa/mlx5: Avoid losing link state updates
To: Eli Cohen <elic@nvidia.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: parav@mellanox.com, mst@redhat.com,
 virtualization@lists.linux-foundation.org, eperezma@redhat.com
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gU3VuLCBBcHIgMiwgMjAyMyBhdCAxMDoxNeKAr1BNIEVsaSBDb2hlbiA8ZWxpY0BudmlkaWEu
Y29tPiB3cm90ZToKPgo+IEN1cnJlbnQgY29kZSBpZ25vcmVzIGxpbmsgc3RhdGUgdXBkYXRlcyBp
ZiBWSVJUSU9fTkVUX0ZfU1RBVFVTIHdhcyBub3QKPiBuZWdvdGlhdGVkLiBIb3dldmVyLCBsaW5r
IHN0YXRlIHVwZGF0ZXMgY291bGQgYmUgcmVjZWl2ZWQgYmVmb3JlIGZlYXR1cmUKPiBuZWdvdGlh
dGlvbiB3YXMgY29tcGxldGVkICwgdGhlcmVmb3JlIGNhdXNpbmcgbGluayBzdGF0ZSBldmVudHMg
dG8gYmUKPiBsb3N0LCBwb3NzaWJseSBsZWF2aW5nIHRoZSBsaW5rIHN0YXRlIGRvd24uCj4KPiBN
b2RpZnkgdGhlIGNvZGUgc28gbGluayBzdGF0ZSBub3RpZmllciBpcyByZWdpc3RlcmVkIG9ubHkg
d2hlbgo+IFZJUlRJT19ORVRfRl9TVEFUVVMgZmxpcHMgZnJvbSAwIHRvIDEgYW5kIHVucmVnaXN0
ZXIgaXQgb24gZHJpdmVyIHJlc2V0Cj4gb3Igc3VzcGVuZC4KPgo+IEZpeGVzOiAwMzM3NzlhNzA4
ZjAgKCJ2ZHBhL21seDU6IG1ha2UgTVRVL1NUQVRVUyBwcmVzZW5jZSBjb25kaXRpb25hbCBvbiBm
ZWF0dXJlIGJpdHMiKQo+IFNpZ25lZC1vZmYtYnk6IEVsaSBDb2hlbiA8ZWxpY0BudmlkaWEuY29t
Pgo+IC0tLQo+IHYyIC0+IHYzCj4gT25seSByZWdpc3RlciB0aGUgbGluayBldmVudCBub3RpZmll
ciB3aGVuIFZJUlRJT19ORVRfRl9TVEFUVVMgaXMKPiBuZWdvdGlhdGVkLgo+Cj4gIGRyaXZlcnMv
dmRwYS9tbHg1L25ldC9tbHg1X3ZuZXQuYyB8IDIwMCArKysrKysrKysrKysrKysrKy0tLS0tLS0t
LS0tLS0KPiAgMSBmaWxlIGNoYW5nZWQsIDExMiBpbnNlcnRpb25zKCspLCA4OCBkZWxldGlvbnMo
LSkKPgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL3ZkcGEvbWx4NS9uZXQvbWx4NV92bmV0LmMgYi9k
cml2ZXJzL3ZkcGEvbWx4NS9uZXQvbWx4NV92bmV0LmMKPiBpbmRleCAzMTdjZWY5Yjc4MTMuLjli
MTQzMmUyMjU0MCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL3ZkcGEvbWx4NS9uZXQvbWx4NV92bmV0
LmMKPiArKysgYi9kcml2ZXJzL3ZkcGEvbWx4NS9uZXQvbWx4NV92bmV0LmMKPiBAQCAtMjMyMiwx
MCArMjMyMiwxMTUgQEAgc3RhdGljIHZvaWQgdXBkYXRlX2N2cV9pbmZvKHN0cnVjdCBtbHg1X3Zk
cGFfZGV2ICptdmRldikKPiAgICAgICAgIH0KPiAgfQo+Cj4gK3N0YXRpYyB1OCBxdWVyeV92cG9y
dF9zdGF0ZShzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqbWRldiwgdTggb3Btb2QsIHUxNiB2cG9ydCkK
PiArewo+ICsgICAgICAgdTMyIG91dFtNTFg1X1NUX1NaX0RXKHF1ZXJ5X3Zwb3J0X3N0YXRlX291
dCldID0ge307Cj4gKyAgICAgICB1MzIgaW5bTUxYNV9TVF9TWl9EVyhxdWVyeV92cG9ydF9zdGF0
ZV9pbildID0ge307Cj4gKyAgICAgICBpbnQgZXJyOwo+ICsKPiArICAgICAgIE1MWDVfU0VUKHF1
ZXJ5X3Zwb3J0X3N0YXRlX2luLCBpbiwgb3Bjb2RlLCBNTFg1X0NNRF9PUF9RVUVSWV9WUE9SVF9T
VEFURSk7Cj4gKyAgICAgICBNTFg1X1NFVChxdWVyeV92cG9ydF9zdGF0ZV9pbiwgaW4sIG9wX21v
ZCwgb3Btb2QpOwo+ICsgICAgICAgTUxYNV9TRVQocXVlcnlfdnBvcnRfc3RhdGVfaW4sIGluLCB2
cG9ydF9udW1iZXIsIHZwb3J0KTsKPiArICAgICAgIGlmICh2cG9ydCkKPiArICAgICAgICAgICAg
ICAgTUxYNV9TRVQocXVlcnlfdnBvcnRfc3RhdGVfaW4sIGluLCBvdGhlcl92cG9ydCwgMSk7Cj4g
Kwo+ICsgICAgICAgZXJyID0gbWx4NV9jbWRfZXhlY19pbm91dChtZGV2LCBxdWVyeV92cG9ydF9z
dGF0ZSwgaW4sIG91dCk7Cj4gKyAgICAgICBpZiAoZXJyKQo+ICsgICAgICAgICAgICAgICByZXR1
cm4gMDsKPiArCj4gKyAgICAgICByZXR1cm4gTUxYNV9HRVQocXVlcnlfdnBvcnRfc3RhdGVfb3V0
LCBvdXQsIHN0YXRlKTsKPiArfQo+ICsKPiArc3RhdGljIGJvb2wgZ2V0X2xpbmtfc3RhdGUoc3Ry
dWN0IG1seDVfdmRwYV9kZXYgKm12ZGV2KQo+ICt7Cj4gKyAgICAgICBpZiAocXVlcnlfdnBvcnRf
c3RhdGUobXZkZXYtPm1kZXYsIE1MWDVfVlBPUlRfU1RBVEVfT1BfTU9EX1ZOSUNfVlBPUlQsIDAp
ID09Cj4gKyAgICAgICAgICAgVlBPUlRfU1RBVEVfVVApCj4gKyAgICAgICAgICAgICAgIHJldHVy
biB0cnVlOwo+ICsKPiArICAgICAgIHJldHVybiBmYWxzZTsKPiArfQo+ICsKPiArc3RhdGljIHZv
aWQgdXBkYXRlX2NhcnJpZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICt7Cj4gKyAgICAg
ICBzdHJ1Y3QgbWx4NV92ZHBhX3dxX2VudCAqd3FlbnQ7Cj4gKyAgICAgICBzdHJ1Y3QgbWx4NV92
ZHBhX2RldiAqbXZkZXY7Cj4gKyAgICAgICBzdHJ1Y3QgbWx4NV92ZHBhX25ldCAqbmRldjsKPiAr
Cj4gKyAgICAgICB3cWVudCA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgbWx4NV92ZHBhX3dx
X2VudCwgd29yayk7Cj4gKyAgICAgICBtdmRldiA9IHdxZW50LT5tdmRldjsKPiArICAgICAgIG5k
ZXYgPSB0b19tbHg1X3ZkcGFfbmRldihtdmRldik7Cj4gKyAgICAgICBpZiAoZ2V0X2xpbmtfc3Rh
dGUobXZkZXYpKQo+ICsgICAgICAgICAgICAgICBuZGV2LT5jb25maWcuc3RhdHVzIHw9IGNwdV90
b19tbHg1dmRwYTE2KG12ZGV2LCBWSVJUSU9fTkVUX1NfTElOS19VUCk7Cj4gKyAgICAgICBlbHNl
Cj4gKyAgICAgICAgICAgICAgIG5kZXYtPmNvbmZpZy5zdGF0dXMgJj0gY3B1X3RvX21seDV2ZHBh
MTYobXZkZXYsIH5WSVJUSU9fTkVUX1NfTElOS19VUCk7Cj4gKwo+ICsgICAgICAgaWYgKG5kZXYt
Pm5iX3JlZ2lzdGVyZWQgJiYgbmRldi0+Y29uZmlnX2NiLmNhbGxiYWNrKQoKSXQgbG9va3MgdG8g
bWUgbmJfcmVnaXN0ZXJlZCBpcyBhY2Nlc3NlZCB3aXRob3V0IHN5bmNocm9uaXphdGlvbi4gT3IK
d2UgZG9uJ3QgZXZlbiBuZWVkIHRvIGNoZWNrIHRoYXQgaWYgd2UgZG86Cgp1bnJlZ2lzdGVyKCk7
CmZsdXNoX3dvcmtxdWV1ZSgpOwoKd2hpY2ggaGFzIGJlZW4gZG9uZSBpbiB1bnJlZ2lzdGVyX2xp
bmtfbm90aWZpZXIoKS4KCj4gKyAgICAgICAgICAgICAgIG5kZXYtPmNvbmZpZ19jYi5jYWxsYmFj
ayhuZGV2LT5jb25maWdfY2IucHJpdmF0ZSk7Cj4gKwo+ICsgICAgICAga2ZyZWUod3FlbnQpOwo+
ICt9Cj4gKwo+ICtzdGF0aWMgaW50IHF1ZXVlX2xpbmtfd29yayhzdHJ1Y3QgbWx4NV92ZHBhX25l
dCAqbmRldikKPiArewo+ICsgICAgICAgc3RydWN0IG1seDVfdmRwYV93cV9lbnQgKndxZW50Owo+
ICsKPiArICAgICAgIHdxZW50ID0ga3phbGxvYyhzaXplb2YoKndxZW50KSwgR0ZQX0FUT01JQyk7
Cj4gKyAgICAgICBpZiAoIXdxZW50KQo+ICsgICAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsK
PiArCj4gKyAgICAgICB3cWVudC0+bXZkZXYgPSAmbmRldi0+bXZkZXY7Cj4gKyAgICAgICBJTklU
X1dPUksoJndxZW50LT53b3JrLCB1cGRhdGVfY2Fycmllcik7Cj4gKyAgICAgICBxdWV1ZV93b3Jr
KG5kZXYtPm12ZGV2LndxLCAmd3FlbnQtPndvcmspOwo+ICsgICAgICAgcmV0dXJuIDA7Cj4gK30K
PiArCj4gK3N0YXRpYyBpbnQgZXZlbnRfaGFuZGxlcihzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5i
LCB1bnNpZ25lZCBsb25nIGV2ZW50LCB2b2lkICpwYXJhbSkKPiArewo+ICsgICAgICAgc3RydWN0
IG1seDVfdmRwYV9uZXQgKm5kZXYgPSBjb250YWluZXJfb2YobmIsIHN0cnVjdCBtbHg1X3ZkcGFf
bmV0LCBuYik7Cj4gKyAgICAgICBzdHJ1Y3QgbWx4NV9lcWUgKmVxZSA9IHBhcmFtOwo+ICsgICAg
ICAgaW50IHJldCA9IE5PVElGWV9ET05FOwo+ICsKPiArICAgICAgIGlmIChldmVudCA9PSBNTFg1
X0VWRU5UX1RZUEVfUE9SVF9DSEFOR0UpIHsKPiArICAgICAgICAgICAgICAgc3dpdGNoIChlcWUt
PnN1Yl90eXBlKSB7Cj4gKyAgICAgICAgICAgICAgIGNhc2UgTUxYNV9QT1JUX0NIQU5HRV9TVUJU
WVBFX0RPV046Cj4gKyAgICAgICAgICAgICAgIGNhc2UgTUxYNV9QT1JUX0NIQU5HRV9TVUJUWVBF
X0FDVElWRToKPiArICAgICAgICAgICAgICAgICAgICAgICBpZiAocXVldWVfbGlua193b3JrKG5k
ZXYpKQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5PVElGWV9ET05F
Owo+ICsKPiArICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBOT1RJRllfT0s7Cj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4gKyAgICAgICAgICAgICAgIGRlZmF1bHQ6Cj4gKyAg
ICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5PVElGWV9ET05FOwo+ICsgICAgICAgICAgICAg
ICB9Cj4gKyAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gKyAgICAgICB9Cj4gKyAgICAgICBy
ZXR1cm4gcmV0Owo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCByZWdpc3Rlcl9saW5rX25vdGlmaWVy
KHN0cnVjdCBtbHg1X3ZkcGFfbmV0ICpuZGV2KQo+ICt7Cj4gKyAgICAgICBuZGV2LT5uYi5ub3Rp
Zmllcl9jYWxsID0gZXZlbnRfaGFuZGxlcjsKPiArICAgICAgIG1seDVfbm90aWZpZXJfcmVnaXN0
ZXIobmRldi0+bXZkZXYubWRldiwgJm5kZXYtPm5iKTsKPiArICAgICAgIG5kZXYtPm5iX3JlZ2lz
dGVyZWQgPSB0cnVlOwo+ICsgICAgICAgcXVldWVfbGlua193b3JrKG5kZXYpOwo+ICt9Cj4gKwo+
ICtzdGF0aWMgdm9pZCB1bnJlZ2lzdGVyX2xpbmtfbm90aWZpZXIoc3RydWN0IG1seDVfdmRwYV9u
ZXQgKm5kZXYpCj4gK3sKPiArICAgICAgIGlmICghbmRldi0+bmJfcmVnaXN0ZXJlZCkKPiArICAg
ICAgICAgICAgICAgcmV0dXJuOwo+ICsKPiArICAgICAgIG5kZXYtPm5iX3JlZ2lzdGVyZWQgPSBm
YWxzZTsKPiArICAgICAgIG1seDVfbm90aWZpZXJfdW5yZWdpc3RlcihuZGV2LT5tdmRldi5tZGV2
LCAmbmRldi0+bmIpOwo+ICsgICAgICAgaWYgKG5kZXYtPm12ZGV2LndxKQoKVW5kZXIgd2hpY2gg
Y2FzZSBjb3VsZCB3ZSBoaXQgbXZkZXYud3EgPSBOVUxMPwoKKFdlIGNhbGwgdW5yZWdpc3Rlcl9s
aW5rX25vdGlmaWVyKCkgYmVmb3JlIHNldHRpbmcgbXEgdG8gTlVMTCBkdXJpbmcKZGV2aWNlIGRl
bCkuCgo+ICsgICAgICAgICAgICAgICBmbHVzaF93b3JrcXVldWUobmRldi0+bXZkZXYud3EpOwo+
ICt9Cj4gKwo+ICBzdGF0aWMgaW50IG1seDVfdmRwYV9zZXRfZHJpdmVyX2ZlYXR1cmVzKHN0cnVj
dCB2ZHBhX2RldmljZSAqdmRldiwgdTY0IGZlYXR1cmVzKQo+ICB7Cj4gICAgICAgICBzdHJ1Y3Qg
bWx4NV92ZHBhX2RldiAqbXZkZXYgPSB0b19tdmRldih2ZGV2KTsKPiAgICAgICAgIHN0cnVjdCBt
bHg1X3ZkcGFfbmV0ICpuZGV2ID0gdG9fbWx4NV92ZHBhX25kZXYobXZkZXYpOwo+ICsgICAgICAg
dTY0IG9sZDsKPiAgICAgICAgIGludCBlcnI7Cj4KPiAgICAgICAgIHByaW50X2ZlYXR1cmVzKG12
ZGV2LCBmZWF0dXJlcywgdHJ1ZSk7Cj4gQEAgLTIzMzQsNyArMjQzOSwxMSBAQCBzdGF0aWMgaW50
IG1seDVfdmRwYV9zZXRfZHJpdmVyX2ZlYXR1cmVzKHN0cnVjdCB2ZHBhX2RldmljZSAqdmRldiwg
dTY0IGZlYXR1cmVzKQo+ICAgICAgICAgaWYgKGVycikKPiAgICAgICAgICAgICAgICAgcmV0dXJu
IGVycjsKPgo+ICsgICAgICAgb2xkID0gbmRldi0+bXZkZXYuYWN0dWFsX2ZlYXR1cmVzOwo+ICAg
ICAgICAgbmRldi0+bXZkZXYuYWN0dWFsX2ZlYXR1cmVzID0gZmVhdHVyZXMgJiBuZGV2LT5tdmRl
di5tbHhfZmVhdHVyZXM7Cj4gKyAgICAgICBpZiAofm9sZCAmIG5kZXYtPm12ZGV2LmFjdHVhbF9m
ZWF0dXJlcyAmIEJJVF9VTEwoVklSVElPX05FVF9GX1NUQVRVUykpCj4gKyAgICAgICAgICAgICAg
IHJlZ2lzdGVyX2xpbmtfbm90aWZpZXIobmRldik7Cj4gKwoKSSBzdGlsbCB0aGluayBpdCdzIGJl
dHRlciB0byBtb3ZlIHRoaXMgY2hlY2sgZHVyaW5nIHNldF9zdGF0dXMuCk90aGVyd2lzZSwgd2Ug
bWF5IGhhdmUgYSBzbWFsbCB3aW5kb3cgd2hlcmUgdGhlIGxpbmsgdXBkYXRlIGV2ZW50IGlzCnNl
bnQgYmVmb3JlIERSSVZFUl9PSy4KClRoYW5rcwoKPiAgICAgICAgIGlmIChuZGV2LT5tdmRldi5h
Y3R1YWxfZmVhdHVyZXMgJiBCSVRfVUxMKFZJUlRJT19ORVRfRl9NUSkpCj4gICAgICAgICAgICAg
ICAgIG5kZXYtPnJxdF9zaXplID0gbWx4NXZkcGExNl90b19jcHUobXZkZXYsIG5kZXYtPmNvbmZp
Zy5tYXhfdmlydHF1ZXVlX3BhaXJzKTsKPiAgICAgICAgIGVsc2UKPiBAQCAtMjYyOSw2ICsyNzM4
LDcgQEAgc3RhdGljIGludCBtbHg1X3ZkcGFfcmVzZXQoc3RydWN0IHZkcGFfZGV2aWNlICp2ZGV2
KQo+ICAgICAgICAgbWx4NV92ZHBhX2luZm8obXZkZXYsICJwZXJmb3JtaW5nIGRldmljZSByZXNl
dFxuIik7Cj4KPiAgICAgICAgIGRvd25fd3JpdGUoJm5kZXYtPnJlc2xvY2spOwo+ICsgICAgICAg
dW5yZWdpc3Rlcl9saW5rX25vdGlmaWVyKG5kZXYpOwo+ICAgICAgICAgdGVhcmRvd25fZHJpdmVy
KG5kZXYpOwo+ICAgICAgICAgY2xlYXJfdnFzX3JlYWR5KG5kZXYpOwo+ICAgICAgICAgbWx4NV92
ZHBhX2Rlc3Ryb3lfbXIoJm5kZXYtPm12ZGV2KTsKPiBAQCAtMjg4Myw5ICsyOTkzLDcgQEAgc3Rh
dGljIGludCBtbHg1X3ZkcGFfc3VzcGVuZChzdHJ1Y3QgdmRwYV9kZXZpY2UgKnZkZXYpCj4gICAg
ICAgICBtbHg1X3ZkcGFfaW5mbyhtdmRldiwgInN1c3BlbmRpbmcgZGV2aWNlXG4iKTsKPgo+ICAg
ICAgICAgZG93bl93cml0ZSgmbmRldi0+cmVzbG9jayk7Cj4gLSAgICAgICBuZGV2LT5uYl9yZWdp
c3RlcmVkID0gZmFsc2U7Cj4gLSAgICAgICBtbHg1X25vdGlmaWVyX3VucmVnaXN0ZXIobXZkZXYt
Pm1kZXYsICZuZGV2LT5uYik7Cj4gLSAgICAgICBmbHVzaF93b3JrcXVldWUobmRldi0+bXZkZXYu
d3EpOwo+ICsgICAgICAgdW5yZWdpc3Rlcl9saW5rX25vdGlmaWVyKG5kZXYpOwo+ICAgICAgICAg
Zm9yIChpID0gMDsgaSA8IG5kZXYtPmN1cl9udW1fdnFzOyBpKyspIHsKPiAgICAgICAgICAgICAg
ICAgbXZxID0gJm5kZXYtPnZxc1tpXTsKPiAgICAgICAgICAgICAgICAgc3VzcGVuZF92cShuZGV2
LCBtdnEpOwo+IEBAIC0zMDIyLDg0ICszMTMwLDYgQEAgc3RydWN0IG1seDVfdmRwYV9tZ210ZGV2
IHsKPiAgICAgICAgIHN0cnVjdCBtbHg1X3ZkcGFfbmV0ICpuZGV2Owo+ICB9Owo+Cj4gLXN0YXRp
YyB1OCBxdWVyeV92cG9ydF9zdGF0ZShzdHJ1Y3QgbWx4NV9jb3JlX2RldiAqbWRldiwgdTggb3Bt
b2QsIHUxNiB2cG9ydCkKPiAtewo+IC0gICAgICAgdTMyIG91dFtNTFg1X1NUX1NaX0RXKHF1ZXJ5
X3Zwb3J0X3N0YXRlX291dCldID0ge307Cj4gLSAgICAgICB1MzIgaW5bTUxYNV9TVF9TWl9EVyhx
dWVyeV92cG9ydF9zdGF0ZV9pbildID0ge307Cj4gLSAgICAgICBpbnQgZXJyOwo+IC0KPiAtICAg
ICAgIE1MWDVfU0VUKHF1ZXJ5X3Zwb3J0X3N0YXRlX2luLCBpbiwgb3Bjb2RlLCBNTFg1X0NNRF9P
UF9RVUVSWV9WUE9SVF9TVEFURSk7Cj4gLSAgICAgICBNTFg1X1NFVChxdWVyeV92cG9ydF9zdGF0
ZV9pbiwgaW4sIG9wX21vZCwgb3Btb2QpOwo+IC0gICAgICAgTUxYNV9TRVQocXVlcnlfdnBvcnRf
c3RhdGVfaW4sIGluLCB2cG9ydF9udW1iZXIsIHZwb3J0KTsKPiAtICAgICAgIGlmICh2cG9ydCkK
PiAtICAgICAgICAgICAgICAgTUxYNV9TRVQocXVlcnlfdnBvcnRfc3RhdGVfaW4sIGluLCBvdGhl
cl92cG9ydCwgMSk7Cj4gLQo+IC0gICAgICAgZXJyID0gbWx4NV9jbWRfZXhlY19pbm91dChtZGV2
LCBxdWVyeV92cG9ydF9zdGF0ZSwgaW4sIG91dCk7Cj4gLSAgICAgICBpZiAoZXJyKQo+IC0gICAg
ICAgICAgICAgICByZXR1cm4gMDsKPiAtCj4gLSAgICAgICByZXR1cm4gTUxYNV9HRVQocXVlcnlf
dnBvcnRfc3RhdGVfb3V0LCBvdXQsIHN0YXRlKTsKPiAtfQo+IC0KPiAtc3RhdGljIGJvb2wgZ2V0
X2xpbmtfc3RhdGUoc3RydWN0IG1seDVfdmRwYV9kZXYgKm12ZGV2KQo+IC17Cj4gLSAgICAgICBp
ZiAocXVlcnlfdnBvcnRfc3RhdGUobXZkZXYtPm1kZXYsIE1MWDVfVlBPUlRfU1RBVEVfT1BfTU9E
X1ZOSUNfVlBPUlQsIDApID09Cj4gLSAgICAgICAgICAgVlBPUlRfU1RBVEVfVVApCj4gLSAgICAg
ICAgICAgICAgIHJldHVybiB0cnVlOwo+IC0KPiAtICAgICAgIHJldHVybiBmYWxzZTsKPiAtfQo+
IC0KPiAtc3RhdGljIHZvaWQgdXBkYXRlX2NhcnJpZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQo+IC17Cj4gLSAgICAgICBzdHJ1Y3QgbWx4NV92ZHBhX3dxX2VudCAqd3FlbnQ7Cj4gLSAgICAg
ICBzdHJ1Y3QgbWx4NV92ZHBhX2RldiAqbXZkZXY7Cj4gLSAgICAgICBzdHJ1Y3QgbWx4NV92ZHBh
X25ldCAqbmRldjsKPiAtCj4gLSAgICAgICB3cWVudCA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1
Y3QgbWx4NV92ZHBhX3dxX2VudCwgd29yayk7Cj4gLSAgICAgICBtdmRldiA9IHdxZW50LT5tdmRl
djsKPiAtICAgICAgIG5kZXYgPSB0b19tbHg1X3ZkcGFfbmRldihtdmRldik7Cj4gLSAgICAgICBp
ZiAoZ2V0X2xpbmtfc3RhdGUobXZkZXYpKQo+IC0gICAgICAgICAgICAgICBuZGV2LT5jb25maWcu
c3RhdHVzIHw9IGNwdV90b19tbHg1dmRwYTE2KG12ZGV2LCBWSVJUSU9fTkVUX1NfTElOS19VUCk7
Cj4gLSAgICAgICBlbHNlCj4gLSAgICAgICAgICAgICAgIG5kZXYtPmNvbmZpZy5zdGF0dXMgJj0g
Y3B1X3RvX21seDV2ZHBhMTYobXZkZXYsIH5WSVJUSU9fTkVUX1NfTElOS19VUCk7Cj4gLQo+IC0g
ICAgICAgaWYgKG5kZXYtPm5iX3JlZ2lzdGVyZWQgJiYgbmRldi0+Y29uZmlnX2NiLmNhbGxiYWNr
KQo+IC0gICAgICAgICAgICAgICBuZGV2LT5jb25maWdfY2IuY2FsbGJhY2sobmRldi0+Y29uZmln
X2NiLnByaXZhdGUpOwo+IC0KPiAtICAgICAgIGtmcmVlKHdxZW50KTsKPiAtfQo+IC0KPiAtc3Rh
dGljIGludCBldmVudF9oYW5kbGVyKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsIHVuc2lnbmVk
IGxvbmcgZXZlbnQsIHZvaWQgKnBhcmFtKQo+IC17Cj4gLSAgICAgICBzdHJ1Y3QgbWx4NV92ZHBh
X25ldCAqbmRldiA9IGNvbnRhaW5lcl9vZihuYiwgc3RydWN0IG1seDVfdmRwYV9uZXQsIG5iKTsK
PiAtICAgICAgIHN0cnVjdCBtbHg1X2VxZSAqZXFlID0gcGFyYW07Cj4gLSAgICAgICBpbnQgcmV0
ID0gTk9USUZZX0RPTkU7Cj4gLSAgICAgICBzdHJ1Y3QgbWx4NV92ZHBhX3dxX2VudCAqd3FlbnQ7
Cj4gLQo+IC0gICAgICAgaWYgKGV2ZW50ID09IE1MWDVfRVZFTlRfVFlQRV9QT1JUX0NIQU5HRSkg
ewo+IC0gICAgICAgICAgICAgICBpZiAoIShuZGV2LT5tdmRldi5hY3R1YWxfZmVhdHVyZXMgJiBC
SVRfVUxMKFZJUlRJT19ORVRfRl9TVEFUVVMpKSkKPiAtICAgICAgICAgICAgICAgICAgICAgICBy
ZXR1cm4gTk9USUZZX0RPTkU7Cj4gLSAgICAgICAgICAgICAgIHN3aXRjaCAoZXFlLT5zdWJfdHlw
ZSkgewo+IC0gICAgICAgICAgICAgICBjYXNlIE1MWDVfUE9SVF9DSEFOR0VfU1VCVFlQRV9ET1dO
Ogo+IC0gICAgICAgICAgICAgICBjYXNlIE1MWDVfUE9SVF9DSEFOR0VfU1VCVFlQRV9BQ1RJVkU6
Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgd3FlbnQgPSBremFsbG9jKHNpemVvZigqd3FlbnQp
LCBHRlBfQVRPTUlDKTsKPiAtICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXdxZW50KQo+IC0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5PVElGWV9ET05FOwo+IC0KPiAt
ICAgICAgICAgICAgICAgICAgICAgICB3cWVudC0+bXZkZXYgPSAmbmRldi0+bXZkZXY7Cj4gLSAg
ICAgICAgICAgICAgICAgICAgICAgSU5JVF9XT1JLKCZ3cWVudC0+d29yaywgdXBkYXRlX2NhcnJp
ZXIpOwo+IC0gICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlX3dvcmsobmRldi0+bXZkZXYud3Es
ICZ3cWVudC0+d29yayk7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gTk9USUZZX09L
Owo+IC0gICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+IC0gICAgICAgICAgICAgICBkZWZh
dWx0Ogo+IC0gICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOT1RJRllfRE9ORTsKPiAtICAg
ICAgICAgICAgICAgfQo+IC0gICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+IC0gICAgICAgfQo+
IC0gICAgICAgcmV0dXJuIHJldDsKPiAtfQo+IC0KPiAgc3RhdGljIGludCBjb25maWdfZnVuY19t
dHUoc3RydWN0IG1seDVfY29yZV9kZXYgKm1kZXYsIHUxNiBtdHUpCj4gIHsKPiAgICAgICAgIGlu
dCBpbmxlbiA9IE1MWDVfU1RfU1pfQllURVMobW9kaWZ5X25pY192cG9ydF9jb250ZXh0X2luKTsK
PiBAQCAtMzI4Miw5ICszMzEyLDYgQEAgc3RhdGljIGludCBtbHg1X3ZkcGFfZGV2X2FkZChzdHJ1
Y3QgdmRwYV9tZ210X2RldiAqdl9tZGV2LCBjb25zdCBjaGFyICpuYW1lLAo+ICAgICAgICAgICAg
ICAgICBnb3RvIGVycl9yZXMyOwo+ICAgICAgICAgfQo+Cj4gLSAgICAgICBuZGV2LT5uYi5ub3Rp
Zmllcl9jYWxsID0gZXZlbnRfaGFuZGxlcjsKPiAtICAgICAgIG1seDVfbm90aWZpZXJfcmVnaXN0
ZXIobWRldiwgJm5kZXYtPm5iKTsKPiAtICAgICAgIG5kZXYtPm5iX3JlZ2lzdGVyZWQgPSB0cnVl
Owo+ICAgICAgICAgbXZkZXYtPnZkZXYubWRldiA9ICZtZ3RkZXYtPm1ndGRldjsKPiAgICAgICAg
IGVyciA9IF92ZHBhX3JlZ2lzdGVyX2RldmljZSgmbXZkZXYtPnZkZXYsIG1heF92cXMgKyAxKTsK
PiAgICAgICAgIGlmIChlcnIpCj4gQEAgLTMzMTgsMTAgKzMzNDUsNyBAQCBzdGF0aWMgdm9pZCBt
bHg1X3ZkcGFfZGV2X2RlbChzdHJ1Y3QgdmRwYV9tZ210X2RldiAqdl9tZGV2LCBzdHJ1Y3QgdmRw
YV9kZXZpY2UgKgo+Cj4gICAgICAgICBtbHg1X3ZkcGFfcmVtb3ZlX2RlYnVnZnMobmRldi0+ZGVi
dWdmcyk7Cj4gICAgICAgICBuZGV2LT5kZWJ1Z2ZzID0gTlVMTDsKPiAtICAgICAgIGlmIChuZGV2
LT5uYl9yZWdpc3RlcmVkKSB7Cj4gLSAgICAgICAgICAgICAgIG5kZXYtPm5iX3JlZ2lzdGVyZWQg
PSBmYWxzZTsKPiAtICAgICAgICAgICAgICAgbWx4NV9ub3RpZmllcl91bnJlZ2lzdGVyKG12ZGV2
LT5tZGV2LCAmbmRldi0+bmIpOwo+IC0gICAgICAgfQo+ICsgICAgICAgdW5yZWdpc3Rlcl9saW5r
X25vdGlmaWVyKG5kZXYpOwo+ICAgICAgICAgd3EgPSBtdmRldi0+d3E7Cj4gICAgICAgICBtdmRl
di0+d3EgPSBOVUxMOwo+ICAgICAgICAgZGVzdHJveV93b3JrcXVldWUod3EpOwo+IC0tCj4gMi4z
OC4xCj4KCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZp
cnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3Vu
ZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0
aW5mby92aXJ0dWFsaXphdGlvbg==
