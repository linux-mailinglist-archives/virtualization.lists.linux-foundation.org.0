Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id 3DE0A2C3CE2
	for <lists.virtualization@lfdr.de>; Wed, 25 Nov 2020 10:52:07 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id C29D1874E7;
	Wed, 25 Nov 2020 09:52:05 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 9JI0XKxr5m8b; Wed, 25 Nov 2020 09:51:57 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 1744587488;
	Wed, 25 Nov 2020 09:51:57 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id D1761C0052;
	Wed, 25 Nov 2020 09:51:56 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id E11F5C0052
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:51:54 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id A98CA87488
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:51:54 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id sJ5urcynsYUw
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:51:52 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by hemlock.osuosl.org (Postfix) with ESMTPS id 646678747B
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:51:52 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 272B9305D3CB; Wed, 25 Nov 2020 11:35:53 +0200 (EET)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id EC2873072785;
 Wed, 25 Nov 2020 11:35:52 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v10 63/81] KVM: introspection: add KVMI_VCPU_INJECT_EXCEPTION
 + KVMI_VCPU_EVENT_TRAP
Date: Wed, 25 Nov 2020 11:35:42 +0200
Message-Id: <20201125093600.2766-64-alazar@bitdefender.com>
In-Reply-To: <20201125093600.2766-1-alazar@bitdefender.com>
References: <20201125093600.2766-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <nicu.citu@icloud.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhlIEtWTUlfVkNQ
VV9JTkpFQ1RfRVhDRVBUSU9OIGNvbW1hbmQgaXMgdXNlZCBieSB0aGUgaW50cm9zcGVjdGlvbiB0
b29sCnRvIGluamVjdCBleGNlcHRpb25zLCBmb3IgZXhhbXBsZSwgdG8gZ2V0IGEgcGFnZSBmcm9t
IHN3YXAuCgpUaGUgZXhjZXB0aW9uIGlzIGluamVjdGVkIHJpZ2h0IGJlZm9yZSBlbnRlcmluZyBp
biBndWVzdCB1bmxlc3MgdGhlcmUgaXMKYWxyZWFkeSBhbiBleGNlcHRpb24gcGVuZGluZy4gVGhl
IGludHJvc3BlY3Rpb24gdG9vbCBpcyBub3RpZmllZCB3aXRoCmFuIEtWTUlfVkNQVV9FVkVOVF9U
UkFQIGV2ZW50IGFib3V0IHRoZSBzdWNjZXNzIG9mIHRoZSBpbmplY3Rpb24uIEluCmNhc2Ugb2Yg
ZmFpbHVyZSwgdGhlIGludHJvc3BlY3Rpb24gdG9vbCBpcyBleHBlY3RlZCB0byB0cnkgYWdhaW4g
bGF0ZXIuCgpTaWduZWQtb2ZmLWJ5OiBNaWhhaSBEb27Im3UgPG1kb250dUBiaXRkZWZlbmRlci5j
b20+CkNvLWRldmVsb3BlZC1ieTogTmljdciZb3IgQ8OuyJt1IDxuaWN1LmNpdHVAaWNsb3VkLmNv
bT4KU2lnbmVkLW9mZi1ieTogTmljdciZb3IgQ8OuyJt1IDxuaWN1LmNpdHVAaWNsb3VkLmNvbT4K
Q28tZGV2ZWxvcGVkLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+
ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJpdGRlZmVuZGVyLmNvbT4K
LS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgICAgICAgICAgICAgfCAgNzYg
KysrKysrKysrKysKIGFyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oICAgICAgICAgICAg
ICB8ICAxMSArKwogYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmggICAgICAgICAgICAg
IHwgIDE2ICsrKwogYXJjaC94ODYva3ZtL2t2bWkuYyAgICAgICAgICAgICAgICAgICAgICAgICAg
IHwgMTEwICsrKysrKysrKysrKysrKysKIGFyY2gveDg2L2t2bS9rdm1pLmggICAgICAgICAgICAg
ICAgICAgICAgICAgICB8ICAgMyArCiBhcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYyAgICAgICAgICAg
ICAgICAgICAgICAgfCAgNTUgKysrKysrKy0KIGFyY2gveDg2L2t2bS94ODYuYyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB8ICAgMiArCiBpbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oICAgICAg
ICAgICAgICAgICAgICAgfCAgMTQgKy0KIC4uLi90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0
L2t2bWlfdGVzdC5jICB8IDEyNCArKysrKysrKysrKysrKysrKysKIHZpcnQva3ZtL2ludHJvc3Bl
Y3Rpb24va3ZtaS5jICAgICAgICAgICAgICAgICB8ICAgMiArCiB2aXJ0L2t2bS9pbnRyb3NwZWN0
aW9uL2t2bWlfaW50LmggICAgICAgICAgICAgfCAgIDQgKwogdmlydC9rdm0vaW50cm9zcGVjdGlv
bi9rdm1pX21zZy5jICAgICAgICAgICAgIHwgIDE2ICsrLQogMTIgZmlsZXMgY2hhbmdlZCwgNDE5
IGluc2VydGlvbnMoKyksIDE0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRp
b24vdmlydC9rdm0va3ZtaS5yc3QgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0Cmlu
ZGV4IDg1ZTE0YjgyYWEyZi4uZTY4OGFjMzg3ZmFmIDEwMDY0NAotLS0gYS9Eb2N1bWVudGF0aW9u
L3ZpcnQva3ZtL2t2bWkucnN0CisrKyBiL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QK
QEAgLTU1MCw2ICs1NTAsNyBAQCBiZWNhdXNlIHRoZXNlIGFyZSBzZW50IGFzIGEgcmVzdWx0IG9m
IGNlcnRhaW4gY29tbWFuZHMgKGJ1dCB0aGV5IGNhbiBiZQogZGlzYWxsb3dlZCBieSB0aGUgZGV2
aWNlIG1hbmFnZXIpIDo6CiAKIAlLVk1JX1ZDUFVfRVZFTlRfUEFVU0UKKwlLVk1JX1ZDUFVfRVZF
TlRfVFJBUAogCiBUaGUgVk0gZXZlbnRzIChlLmcuICpLVk1JX1ZNX0VWRU5UX1VOSE9PSyopIGFy
ZSBjb250cm9sbGVkIHdpdGgKIHRoZSAqS1ZNSV9WTV9DT05UUk9MX0VWRU5UUyogY29tbWFuZC4K
QEAgLTczNiw2ICs3MzcsNDYgQEAgSUQgc2V0LgogKiAtS1ZNX0VJTlZBTCAtIHRoZSBwYWRkaW5n
IGlzIG5vdCB6ZXJvCiAqIC1LVk1fRUFHQUlOIC0gdGhlIHNlbGVjdGVkIHZDUFUgY2FuJ3QgYmUg
aW50cm9zcGVjdGVkIHlldAogCisxNi4gS1ZNSV9WQ1BVX0lOSkVDVF9FWENFUFRJT04KKy0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorCis6QXJjaGl0ZWN0dXJlczogeDg2Cis6VmVyc2lv
bnM6ID49IDEKKzpQYXJhbWV0ZXJzOgorCis6OgorCisJc3RydWN0IGt2bWlfdmNwdV9oZHI7CisJ
c3RydWN0IGt2bWlfdmNwdV9pbmplY3RfZXhjZXB0aW9uIHsKKwkJX191OCBucjsKKwkJX191OCBw
YWRkaW5nMTsKKwkJX191MTYgcGFkZGluZzI7CisJCV9fdTMyIGVycm9yX2NvZGU7CisJCV9fdTY0
IGFkZHJlc3M7CisJfTsKKworOlJldHVybnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV9lcnJvcl9j
b2RlCisKK0luamVjdHMgYSB2Q1BVIGV4Y2VwdGlvbiAoYGBucmBgKSB3aXRoIG9yIHdpdGhvdXQg
YW4gZXJyb3IgY29kZSAoYGBlcnJvcl9jb2RlYGApLgorRm9yIHBhZ2UgZmF1bHQgZXhjZXB0aW9u
cywgdGhlIGd1ZXN0IHZpcnR1YWwgYWRkcmVzcyAoYGBhZGRyZXNzYGApCitoYXMgdG8gYmUgc3Bl
Y2lmaWVkIHRvby4KKworVGhlICpLVk1JX1ZDUFVfRVZFTlRfVFJBUCogZXZlbnQgd2lsbCBiZSBz
ZW50IHdpdGggdGhlIGVmZmVjdGl2ZSBpbmplY3RlZAorZXhjZXB0aW9uLgorCis6RXJyb3JzOgor
CisqIC1LVk1fRVBFUk0gIC0gdGhlICpLVk1JX1ZDUFVfRVZFTlRfVFJBUCogZXZlbnQgaXMgZGlz
YWxsb3dlZAorKiAtS1ZNX0VJTlZBTCAtIHRoZSBzZWxlY3RlZCB2Q1BVIGlzIGludmFsaWQKKyog
LUtWTV9FSU5WQUwgLSB0aGUgcGFkZGluZyBpcyBub3QgemVybworKiAtS1ZNX0VBR0FJTiAtIHRo
ZSBzZWxlY3RlZCB2Q1BVIGNhbid0IGJlIGludHJvc3BlY3RlZCB5ZXQKKyogLUtWTV9FQlVTWSAt
IGFub3RoZXIgKktWTUlfVkNQVV9JTkpFQ1RfRVhDRVBUSU9OKi0qS1ZNSV9WQ1BVX0VWRU5UX1RS
QVAqCisgICAgICAgICAgICAgICBwYWlyIGlzIGluIHByb2dyZXNzCisKIEV2ZW50cwogPT09PT09
CiAKQEAgLTk2NiwzICsxMDA3LDM4IEBAIHJlZ2lzdGVyIChzZWUgKipLVk1JX1ZDUFVfQ09OVFJP
TF9FVkVOVFMqKikuCiAoYGBjcmBgKSwgdGhlIG9sZCB2YWx1ZSAoYGBvbGRfdmFsdWVgYCkgYW5k
IHRoZSBuZXcgdmFsdWUgKGBgbmV3X3ZhbHVlYGApCiBhcmUgc2VudCB0byB0aGUgaW50cm9zcGVj
dGlvbiB0b29sLiBUaGUgKkNPTlRJTlVFKiBhY3Rpb24gd2lsbCBzZXQgdGhlCiBgYG5ld192YWxg
YC4KKworNi4gS1ZNSV9WQ1BVX0VWRU5UX1RSQVAKKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisK
KzpBcmNoaXRlY3R1cmVzOiB4ODYKKzpWZXJzaW9uczogPj0gMQorOkFjdGlvbnM6IENPTlRJTlVF
LCBDUkFTSAorOlBhcmFtZXRlcnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2V2ZW50Owor
CXN0cnVjdCBrdm1pX3ZjcHVfZXZlbnRfdHJhcCB7CisJCV9fdTggbnI7CisJCV9fdTggcGFkZGlu
ZzE7CisJCV9fdTE2IHBhZGRpbmcyOworCQlfX3UzMiBlcnJvcl9jb2RlOworCQlfX3U2NCBhZGRy
ZXNzOworCX07CisKKzpSZXR1cm5zOgorCis6OgorCisJc3RydWN0IGt2bWlfdmNwdV9oZHI7CisJ
c3RydWN0IGt2bWlfdmNwdV9ldmVudF9yZXBseTsKKworVGhpcyBldmVudCBpcyBzZW50IGlmIGEg
cHJldmlvdXMgKktWTUlfVkNQVV9JTkpFQ1RfRVhDRVBUSU9OKiBjb21tYW5kCit0b29rIHBsYWNl
LiBCZWNhdXNlIGl0IGhhcyBhIGhpZ2ggcHJpb3JpdHksIGl0IHdpbGwgYmUgc2VudCBiZWZvcmUg
YW55CitvdGhlciB2Q1BVIGludHJvc3BlY3Rpb24gZXZlbnQuCisKK2Bga3ZtaV92Y3B1X2V2ZW50
YGAgKHdpdGggdGhlIHZDUFUgc3RhdGUpLCBleGNlcHRpb24vaW50ZXJydXB0IG51bWJlcgorKGBg
bnJgYCksIGV4Y2VwdGlvbiBjb2RlIChgYGVycm9yX2NvZGVgYCkgYW5kIGBgYWRkcmVzc2BgIGFy
ZSBzZW50IHRvCit0aGUgaW50cm9zcGVjdGlvbiB0b29sLCB3aGljaCBzaG91bGQgY2hlY2sgaWYg
aXRzIGV4Y2VwdGlvbiBoYXMgYmVlbgoraW5qZWN0ZWQgb3Igb3ZlcnJpZGRlbi4KZGlmZiAtLWdp
dCBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oIGIvYXJjaC94ODYvaW5jbHVkZS9h
c20va3ZtaV9ob3N0LmgKaW5kZXggZWRiZWRmMDMxNDY3Li45N2Y1YjFhMDFjOWUgMTAwNjQ0Ci0t
LSBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCisrKyBiL2FyY2gveDg2L2luY2x1
ZGUvYXNtL2t2bWlfaG9zdC5oCkBAIC0yNCw2ICsyNCwxNSBAQCBzdHJ1Y3Qga3ZtX3ZjcHVfYXJj
aF9pbnRyb3NwZWN0aW9uIHsKIAlib29sIGhhdmVfZGVsYXllZF9yZWdzOwogCiAJREVDTEFSRV9C
SVRNQVAoY3JfbWFzaywgS1ZNSV9OVU1fQ1IpOworCisJc3RydWN0IHsKKwkJdTggbnI7CisJCXUz
MiBlcnJvcl9jb2RlOworCQlib29sIGVycm9yX2NvZGVfdmFsaWQ7CisJCXU2NCBhZGRyZXNzOwor
CQlib29sIHBlbmRpbmc7CisJCWJvb2wgc2VuZF9ldmVudDsKKwl9IGV4Y2VwdGlvbjsKIH07CiAK
IHN0cnVjdCBrdm1fYXJjaF9pbnRyb3NwZWN0aW9uIHsKQEAgLTM2LDYgKzQ1LDcgQEAgYm9vbCBr
dm1pX2NyX2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdW5zaWduZWQgaW50IGNyLAogCQkg
ICB1bnNpZ25lZCBsb25nIG9sZF92YWx1ZSwgdW5zaWduZWQgbG9uZyAqbmV3X3ZhbHVlKTsKIGJv
b2wga3ZtaV9jcjNfaW50ZXJjZXB0ZWQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsKIGJvb2wga3Zt
aV9tb25pdG9yX2NyM3dfaW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgYm9vbCBlbmFi
bGUpOwordm9pZCBrdm1pX2VudGVyX2d1ZXN0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiAKICNl
bHNlIC8qIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCkBAIC00OCw2ICs1OCw3IEBAIHN0
YXRpYyBpbmxpbmUgYm9vbCBrdm1pX2NyX2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdW5z
aWduZWQgaW50IGNyLAogc3RhdGljIGlubGluZSBib29sIGt2bWlfY3IzX2ludGVyY2VwdGVkKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSkgeyByZXR1cm4gZmFsc2U7IH0KIHN0YXRpYyBpbmxpbmUgYm9v
bCBrdm1pX21vbml0b3JfY3Izd19pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LAogCQkJ
CQkJYm9vbCBlbmFibGUpIHsgcmV0dXJuIGZhbHNlOyB9CitzdGF0aWMgaW5saW5lIHZvaWQga3Zt
aV9lbnRlcl9ndWVzdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpIHsgfQogCiAjZW5kaWYgLyogQ09O
RklHX0tWTV9JTlRST1NQRUNUSU9OICovCiAKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2luY2x1ZGUv
dWFwaS9hc20va3ZtaS5oIGIvYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmgKaW5kZXgg
MzJjZDE3NDg4MDU4Li5hYTk5MWZiYWI0NzMgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2luY2x1ZGUv
dWFwaS9hc20va3ZtaS5oCisrKyBiL2FyY2gveDg2L2luY2x1ZGUvdWFwaS9hc20va3ZtaS5oCkBA
IC03OSw0ICs3OSwyMCBAQCBzdHJ1Y3Qga3ZtaV92Y3B1X2V2ZW50X2NyX3JlcGx5IHsKIAlfX3U2
NCBuZXdfdmFsOwogfTsKIAorc3RydWN0IGt2bWlfdmNwdV9ldmVudF90cmFwIHsKKwlfX3U4IG5y
OworCV9fdTggcGFkZGluZzE7CisJX191MTYgcGFkZGluZzI7CisJX191MzIgZXJyb3JfY29kZTsK
KwlfX3U2NCBhZGRyZXNzOworfTsKKworc3RydWN0IGt2bWlfdmNwdV9pbmplY3RfZXhjZXB0aW9u
IHsKKwlfX3U4IG5yOworCV9fdTggcGFkZGluZzE7CisJX191MTYgcGFkZGluZzI7CisJX191MzIg
ZXJyb3JfY29kZTsKKwlfX3U2NCBhZGRyZXNzOworfTsKKwogI2VuZGlmIC8qIF9VQVBJX0FTTV9Y
ODZfS1ZNSV9IICovCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaS5jIGIvYXJjaC94ODYv
a3ZtL2t2bWkuYwppbmRleCA4YWQzNjk4ZTU5ODguLjUyYjQ2ZDU2ZWJiNSAxMDA2NDQKLS0tIGEv
YXJjaC94ODYva3ZtL2t2bWkuYworKysgYi9hcmNoL3g4Ni9rdm0va3ZtaS5jCkBAIC0xNSw2ICsx
NSw3IEBAIHZvaWQga3ZtaV9hcmNoX2luaXRfdmNwdV9ldmVudHNfbWFzayh1bnNpZ25lZCBsb25n
ICpzdXBwb3J0ZWQpCiAJc2V0X2JpdChLVk1JX1ZDUFVfRVZFTlRfQlJFQUtQT0lOVCwgc3VwcG9y
dGVkKTsKIAlzZXRfYml0KEtWTUlfVkNQVV9FVkVOVF9DUiwgc3VwcG9ydGVkKTsKIAlzZXRfYml0
KEtWTUlfVkNQVV9FVkVOVF9IWVBFUkNBTEwsIHN1cHBvcnRlZCk7CisJc2V0X2JpdChLVk1JX1ZD
UFVfRVZFTlRfVFJBUCwgc3VwcG9ydGVkKTsKIH0KIAogc3RhdGljIHVuc2lnbmVkIGludCBrdm1p
X3ZjcHVfbW9kZShjb25zdCBzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCkBAIC00NTcsMyArNDU4LDEx
MiBAQCBib29sIGt2bWlfY3IzX2ludGVyY2VwdGVkKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAly
ZXR1cm4gcmV0OwogfQogRVhQT1JUX1NZTUJPTChrdm1pX2NyM19pbnRlcmNlcHRlZCk7CisKK2lu
dCBrdm1pX2FyY2hfY21kX3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUsCisJCQkJCWNvbnN0IHN0cnVjdCBrdm1pX3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbiAqcmVxKQor
eworCXN0cnVjdCBrdm1fdmNwdV9hcmNoX2ludHJvc3BlY3Rpb24gKmFyY2ggPSAmVkNQVUkodmNw
dSktPmFyY2g7CisJYm9vbCBoYXNfZXJyb3I7CisKKwlhcmNoLT5leGNlcHRpb24ucGVuZGluZyA9
IHRydWU7CisKKwloYXNfZXJyb3IgPSB4ODZfZXhjZXB0aW9uX2hhc19lcnJvcl9jb2RlKHJlcS0+
bnIpOworCisJYXJjaC0+ZXhjZXB0aW9uLm5yID0gcmVxLT5ucjsKKwlhcmNoLT5leGNlcHRpb24u
ZXJyb3JfY29kZSA9IGhhc19lcnJvciA/IHJlcS0+ZXJyb3JfY29kZSA6IDA7CisJYXJjaC0+ZXhj
ZXB0aW9uLmVycm9yX2NvZGVfdmFsaWQgPSBoYXNfZXJyb3I7CisJYXJjaC0+ZXhjZXB0aW9uLmFk
ZHJlc3MgPSByZXEtPmFkZHJlc3M7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQga3Zt
aV9xdWV1ZV9leGNlcHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQoreworCXN0cnVjdCBrdm1f
dmNwdV9hcmNoX2ludHJvc3BlY3Rpb24gKmFyY2ggPSAmVkNQVUkodmNwdSktPmFyY2g7CisJc3Ry
dWN0IHg4Nl9leGNlcHRpb24gZSA9IHsKKwkJLnZlY3RvciA9IGFyY2gtPmV4Y2VwdGlvbi5uciwK
KwkJLmVycm9yX2NvZGVfdmFsaWQgPSBhcmNoLT5leGNlcHRpb24uZXJyb3JfY29kZV92YWxpZCwK
KwkJLmVycm9yX2NvZGUgPSBhcmNoLT5leGNlcHRpb24uZXJyb3JfY29kZSwKKwkJLmFkZHJlc3Mg
PSBhcmNoLT5leGNlcHRpb24uYWRkcmVzcywKKwl9OworCisJaWYgKGUudmVjdG9yID09IFBGX1ZF
Q1RPUikKKwkJa3ZtX2luamVjdF9wYWdlX2ZhdWx0KHZjcHUsICZlKTsKKwllbHNlIGlmIChlLmVy
cm9yX2NvZGVfdmFsaWQpCisJCWt2bV9xdWV1ZV9leGNlcHRpb25fZSh2Y3B1LCBlLnZlY3Rvciwg
ZS5lcnJvcl9jb2RlKTsKKwllbHNlCisJCWt2bV9xdWV1ZV9leGNlcHRpb24odmNwdSwgZS52ZWN0
b3IpOworfQorCitzdGF0aWMgdm9pZCBrdm1pX3NhdmVfaW5qZWN0ZWRfZXZlbnQoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1KQoreworCXN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0aW9uICp2Y3B1aSA9
IFZDUFVJKHZjcHUpOworCisJdmNwdWktPmFyY2guZXhjZXB0aW9uLmVycm9yX2NvZGUgPSAwOwor
CXZjcHVpLT5hcmNoLmV4Y2VwdGlvbi5lcnJvcl9jb2RlX3ZhbGlkID0gZmFsc2U7CisKKwl2Y3B1
aS0+YXJjaC5leGNlcHRpb24uYWRkcmVzcyA9IHZjcHUtPmFyY2guY3IyOworCWlmICh2Y3B1LT5h
cmNoLmV4Y2VwdGlvbi5pbmplY3RlZCkgeworCQl2Y3B1aS0+YXJjaC5leGNlcHRpb24ubnIgPSB2
Y3B1LT5hcmNoLmV4Y2VwdGlvbi5ucjsKKwkJdmNwdWktPmFyY2guZXhjZXB0aW9uLmVycm9yX2Nv
ZGVfdmFsaWQgPQorCQkJeDg2X2V4Y2VwdGlvbl9oYXNfZXJyb3JfY29kZSh2Y3B1LT5hcmNoLmV4
Y2VwdGlvbi5ucik7CisJCXZjcHVpLT5hcmNoLmV4Y2VwdGlvbi5lcnJvcl9jb2RlID0gdmNwdS0+
YXJjaC5leGNlcHRpb24uZXJyb3JfY29kZTsKKwl9IGVsc2UgaWYgKHZjcHUtPmFyY2guaW50ZXJy
dXB0LmluamVjdGVkKSB7CisJCXZjcHVpLT5hcmNoLmV4Y2VwdGlvbi5uciA9IHZjcHUtPmFyY2gu
aW50ZXJydXB0Lm5yOworCX0KK30KKworc3RhdGljIHZvaWQga3ZtaV9pbmplY3RfcGVuZGluZ19l
eGNlcHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQoreworCXN0cnVjdCBrdm1fdmNwdV9pbnRy
b3NwZWN0aW9uICp2Y3B1aSA9IFZDUFVJKHZjcHUpOworCisJaWYgKCFrdm1fZXZlbnRfbmVlZHNf
cmVpbmplY3Rpb24odmNwdSkpIHsKKwkJa3ZtaV9xdWV1ZV9leGNlcHRpb24odmNwdSk7CisJCWt2
bV9pbmplY3RfcGVuZGluZ19leGNlcHRpb24odmNwdSk7CisJfQorCisJa3ZtaV9zYXZlX2luamVj
dGVkX2V2ZW50KHZjcHUpOworCisJdmNwdWktPmFyY2guZXhjZXB0aW9uLnBlbmRpbmcgPSBmYWxz
ZTsKKwl2Y3B1aS0+YXJjaC5leGNlcHRpb24uc2VuZF9ldmVudCA9IHRydWU7CisJa3ZtX21ha2Vf
cmVxdWVzdChLVk1fUkVRX0lOVFJPU1BFQ1RJT04sIHZjcHUpOworfQorCit2b2lkIGt2bWlfZW50
ZXJfZ3Vlc3Qoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQoreworCXN0cnVjdCBrdm1fdmNwdV9pbnRy
b3NwZWN0aW9uICp2Y3B1aTsKKwlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWk7CisKKwlr
dm1pID0ga3ZtaV9nZXQodmNwdS0+a3ZtKTsKKwlpZiAoa3ZtaSkgeworCQl2Y3B1aSA9IFZDUFVJ
KHZjcHUpOworCisJCWlmICh2Y3B1aS0+YXJjaC5leGNlcHRpb24ucGVuZGluZykKKwkJCWt2bWlf
aW5qZWN0X3BlbmRpbmdfZXhjZXB0aW9uKHZjcHUpOworCisJCWt2bWlfcHV0KHZjcHUtPmt2bSk7
CisJfQorfQorCitzdGF0aWMgdm9pZCBrdm1pX3NlbmRfdHJhcF9ldmVudChzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUpCit7CisJdTMyIGFjdGlvbjsKKworCWFjdGlvbiA9IGt2bWlfbXNnX3NlbmRfdmNw
dV90cmFwKHZjcHUpOworCXN3aXRjaCAoYWN0aW9uKSB7CisJY2FzZSBLVk1JX0VWRU5UX0FDVElP
Tl9DT05USU5VRToKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJa3ZtaV9oYW5kbGVfY29tbW9uX2V2
ZW50X2FjdGlvbnModmNwdSwgYWN0aW9uKTsKKwl9Cit9CisKK3ZvaWQga3ZtaV9hcmNoX3NlbmRf
cGVuZGluZ19ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCit7CisJc3RydWN0IGt2bV92Y3B1
X2ludHJvc3BlY3Rpb24gKnZjcHVpID0gVkNQVUkodmNwdSk7CisKKwlpZiAodmNwdWktPmFyY2gu
ZXhjZXB0aW9uLnNlbmRfZXZlbnQpIHsKKwkJdmNwdWktPmFyY2guZXhjZXB0aW9uLnNlbmRfZXZl
bnQgPSBmYWxzZTsKKwkJa3ZtaV9zZW5kX3RyYXBfZXZlbnQodmNwdSk7CisJfQorfQpkaWZmIC0t
Z2l0IGEvYXJjaC94ODYva3ZtL2t2bWkuaCBiL2FyY2gveDg2L2t2bS9rdm1pLmgKaW5kZXggNmE0
NDQ0MjhiODMxLi4yNjVmZWNlMTQ4ZDIgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS9rdm1pLmgK
KysrIGIvYXJjaC94ODYva3ZtL2t2bWkuaApAQCAtOCw4ICs4LDExIEBAIGludCBrdm1pX2FyY2hf
Y21kX3ZjcHVfZ2V0X3JlZ2lzdGVycyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiB2b2lkIGt2bWlf
YXJjaF9jbWRfdmNwdV9zZXRfcmVnaXN0ZXJzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAkJCQkg
ICAgICBjb25zdCBzdHJ1Y3Qga3ZtX3JlZ3MgKnJlZ3MpOwogaW50IGt2bWlfYXJjaF9jbWRfdmNw
dV9jb250cm9sX2NyKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgaW50IGNyLCBib29sIGVuYWJsZSk7
CitpbnQga3ZtaV9hcmNoX2NtZF92Y3B1X2luamVjdF9leGNlcHRpb24oc3RydWN0IGt2bV92Y3B1
ICp2Y3B1LAorCQkJCWNvbnN0IHN0cnVjdCBrdm1pX3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbiAqcmVx
KTsKIAogdTMyIGt2bWlfbXNnX3NlbmRfdmNwdV9jcihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUz
MiBjciwgdTY0IG9sZF92YWx1ZSwKIAkJCSAgdTY0IG5ld192YWx1ZSwgdTY0ICpyZXRfdmFsdWUp
OwordTMyIGt2bWlfbXNnX3NlbmRfdmNwdV90cmFwKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiAK
ICNlbmRpZgpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMgYi9hcmNoL3g4Ni9r
dm0va3ZtaV9tc2cuYwppbmRleCAzNGFlZGI0Nzg1ZTQuLjBiNzMxNDJhYjczYSAxMDA2NDQKLS0t
IGEvYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMKKysrIGIvYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMK
QEAgLTE1MCwxMiArMTUwLDM3IEBAIHN0YXRpYyBpbnQgaGFuZGxlX3ZjcHVfY29udHJvbF9jcihj
b25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X21zZ19qb2IgKmpvYiwKIAlyZXR1cm4ga3ZtaV9tc2dfdmNw
dV9yZXBseShqb2IsIG1zZywgZWMsIE5VTEwsIDApOwogfQogCitzdGF0aWMgaW50IGhhbmRsZV92
Y3B1X2luamVjdF9leGNlcHRpb24oY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9tc2dfam9iICpqb2Is
CisJCQkJCWNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZywKKwkJCQkJY29uc3Qgdm9pZCAq
X3JlcSkKK3sKKwljb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X2luamVjdF9leGNlcHRpb24gKnJlcSA9
IF9yZXE7CisJc3RydWN0IGt2bV92Y3B1X2FyY2hfaW50cm9zcGVjdGlvbiAqYXJjaDsKKwlzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUgPSBqb2ItPnZjcHU7CisJaW50IGVjOworCisJYXJjaCA9ICZWQ1BV
SSh2Y3B1KS0+YXJjaDsKKworCWlmICgha3ZtaV9pc19ldmVudF9hbGxvd2VkKEtWTUkodmNwdS0+
a3ZtKSwgS1ZNSV9WQ1BVX0VWRU5UX1RSQVApKQorCQllYyA9IC1LVk1fRVBFUk07CisJZWxzZSBp
ZiAocmVxLT5wYWRkaW5nMSB8fCByZXEtPnBhZGRpbmcyKQorCQllYyA9IC1LVk1fRUlOVkFMOwor
CWVsc2UgaWYgKFZDUFVJKHZjcHUpLT5hcmNoLmV4Y2VwdGlvbi5wZW5kaW5nIHx8CisJCQlWQ1BV
SSh2Y3B1KS0+YXJjaC5leGNlcHRpb24uc2VuZF9ldmVudCkKKwkJZWMgPSAtS1ZNX0VCVVNZOwor
CWVsc2UKKwkJZWMgPSBrdm1pX2FyY2hfY21kX3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbih2Y3B1LCBy
ZXEpOworCisJcmV0dXJuIGt2bWlfbXNnX3ZjcHVfcmVwbHkoam9iLCBtc2csIGVjLCBOVUxMLCAw
KTsKK30KKwogc3RhdGljIGt2bWlfdmNwdV9tc2dfam9iX2ZjdCBjb25zdCBtc2dfdmNwdVtdID0g
ewotCVtLVk1JX1ZDUFVfQ09OVFJPTF9DUl0gICAgPSBoYW5kbGVfdmNwdV9jb250cm9sX2NyLAot
CVtLVk1JX1ZDUFVfR0VUX0NQVUlEXSAgICAgPSBoYW5kbGVfdmNwdV9nZXRfY3B1aWQsCi0JW0tW
TUlfVkNQVV9HRVRfSU5GT10gICAgICA9IGhhbmRsZV92Y3B1X2dldF9pbmZvLAotCVtLVk1JX1ZD
UFVfR0VUX1JFR0lTVEVSU10gPSBoYW5kbGVfdmNwdV9nZXRfcmVnaXN0ZXJzLAotCVtLVk1JX1ZD
UFVfU0VUX1JFR0lTVEVSU10gPSBoYW5kbGVfdmNwdV9zZXRfcmVnaXN0ZXJzLAorCVtLVk1JX1ZD
UFVfQ09OVFJPTF9DUl0gICAgICAgPSBoYW5kbGVfdmNwdV9jb250cm9sX2NyLAorCVtLVk1JX1ZD
UFVfR0VUX0NQVUlEXSAgICAgICAgPSBoYW5kbGVfdmNwdV9nZXRfY3B1aWQsCisJW0tWTUlfVkNQ
VV9HRVRfSU5GT10gICAgICAgICA9IGhhbmRsZV92Y3B1X2dldF9pbmZvLAorCVtLVk1JX1ZDUFVf
R0VUX1JFR0lTVEVSU10gICAgPSBoYW5kbGVfdmNwdV9nZXRfcmVnaXN0ZXJzLAorCVtLVk1JX1ZD
UFVfSU5KRUNUX0VYQ0VQVElPTl0gPSBoYW5kbGVfdmNwdV9pbmplY3RfZXhjZXB0aW9uLAorCVtL
Vk1JX1ZDUFVfU0VUX1JFR0lTVEVSU10gICAgPSBoYW5kbGVfdmNwdV9zZXRfcmVnaXN0ZXJzLAog
fTsKIAoga3ZtaV92Y3B1X21zZ19qb2JfZmN0IGt2bWlfYXJjaF92Y3B1X21zZ19oYW5kbGVyKHUx
NiBpZCkKQEAgLTE4NywzICsyMTIsMjMgQEAgdTMyIGt2bWlfbXNnX3NlbmRfdmNwdV9jcihzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiBjciwgdTY0IG9sZF92YWx1ZSwKIAogCXJldHVybiBhY3Rp
b247CiB9CisKK3UzMiBrdm1pX21zZ19zZW5kX3ZjcHVfdHJhcChzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUpCit7CisJc3RydWN0IGt2bV92Y3B1X2ludHJvc3BlY3Rpb24gKnZjcHVpID0gVkNQVUkodmNw
dSk7CisJc3RydWN0IGt2bWlfdmNwdV9ldmVudF90cmFwIGU7CisJdTMyIGFjdGlvbjsKKwlpbnQg
ZXJyOworCisJbWVtc2V0KCZlLCAwLCBzaXplb2YoZSkpOworCWUubnIgPSB2Y3B1aS0+YXJjaC5l
eGNlcHRpb24ubnI7CisJZS5lcnJvcl9jb2RlID0gdmNwdWktPmFyY2guZXhjZXB0aW9uLmVycm9y
X2NvZGU7CisJZS5hZGRyZXNzID0gdmNwdWktPmFyY2guZXhjZXB0aW9uLmFkZHJlc3M7CisKKwll
cnIgPSBfX2t2bWlfc2VuZF92Y3B1X2V2ZW50KHZjcHUsIEtWTUlfVkNQVV9FVkVOVF9UUkFQLAor
CQkJCSAgICAgJmUsIHNpemVvZihlKSwgTlVMTCwgMCwgJmFjdGlvbik7CisJaWYgKGVycikKKwkJ
YWN0aW9uID0gS1ZNSV9FVkVOVF9BQ1RJT05fQ09OVElOVUU7CisKKwlyZXR1cm4gYWN0aW9uOwor
fQpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL3g4Ni5jIGIvYXJjaC94ODYva3ZtL3g4Ni5jCmlu
ZGV4IDlhNGVjMGI0NzE0Yy4uYmViMTgzYjlmOTc5IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0v
eDg2LmMKKysrIGIvYXJjaC94ODYva3ZtL3g4Ni5jCkBAIC05MDA4LDYgKzkwMDgsOCBAQCBzdGF0
aWMgaW50IHZjcHVfZW50ZXJfZ3Vlc3Qoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogCQlnb3RvIGNh
bmNlbF9pbmplY3Rpb247CiAJfQogCisJa3ZtaV9lbnRlcl9ndWVzdCh2Y3B1KTsKKwogCWlmIChy
ZXFfaW1tZWRpYXRlX2V4aXQpIHsKIAkJa3ZtX21ha2VfcmVxdWVzdChLVk1fUkVRX0VWRU5ULCB2
Y3B1KTsKIAkJa3ZtX3g4Nl9vcHMucmVxdWVzdF9pbW1lZGlhdGVfZXhpdCh2Y3B1KTsKZGlmZiAt
LWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggYi9pbmNsdWRlL3VhcGkvbGludXgva3Zt
aS5oCmluZGV4IGMxZDhjZjAyMDE4Yi4uMjYzZDk4YTU5MDNlIDEwMDY0NAotLS0gYS9pbmNsdWRl
L3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgKQEAgLTM2
LDEyICszNiwxMyBAQCBlbnVtIHsKIGVudW0gewogCUtWTUlfVkNQVV9FVkVOVCA9IEtWTUlfVkNQ
VV9NRVNTQUdFX0lEKDApLAogCi0JS1ZNSV9WQ1BVX0dFVF9JTkZPICAgICAgID0gS1ZNSV9WQ1BV
X01FU1NBR0VfSUQoMSksCi0JS1ZNSV9WQ1BVX0NPTlRST0xfRVZFTlRTID0gS1ZNSV9WQ1BVX01F
U1NBR0VfSUQoMiksCi0JS1ZNSV9WQ1BVX0dFVF9SRUdJU1RFUlMgID0gS1ZNSV9WQ1BVX01FU1NB
R0VfSUQoMyksCi0JS1ZNSV9WQ1BVX1NFVF9SRUdJU1RFUlMgID0gS1ZNSV9WQ1BVX01FU1NBR0Vf
SUQoNCksCi0JS1ZNSV9WQ1BVX0dFVF9DUFVJRCAgICAgID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQo
NSksCi0JS1ZNSV9WQ1BVX0NPTlRST0xfQ1IgICAgID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoNiks
CisJS1ZNSV9WQ1BVX0dFVF9JTkZPICAgICAgICAgPSBLVk1JX1ZDUFVfTUVTU0FHRV9JRCgxKSwK
KwlLVk1JX1ZDUFVfQ09OVFJPTF9FVkVOVFMgICA9IEtWTUlfVkNQVV9NRVNTQUdFX0lEKDIpLAor
CUtWTUlfVkNQVV9HRVRfUkVHSVNURVJTICAgID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoMyksCisJ
S1ZNSV9WQ1BVX1NFVF9SRUdJU1RFUlMgICAgPSBLVk1JX1ZDUFVfTUVTU0FHRV9JRCg0KSwKKwlL
Vk1JX1ZDUFVfR0VUX0NQVUlEICAgICAgICA9IEtWTUlfVkNQVV9NRVNTQUdFX0lEKDUpLAorCUtW
TUlfVkNQVV9DT05UUk9MX0NSICAgICAgID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoNiksCisJS1ZN
SV9WQ1BVX0lOSkVDVF9FWENFUFRJT04gPSBLVk1JX1ZDUFVfTUVTU0FHRV9JRCg3KSwKIAogCUtW
TUlfTkVYVF9WQ1BVX01FU1NBR0UKIH07CkBAIC02MCw2ICs2MSw3IEBAIGVudW0gewogCUtWTUlf
VkNQVV9FVkVOVF9IWVBFUkNBTEwgID0gS1ZNSV9WQ1BVX0VWRU5UX0lEKDEpLAogCUtWTUlfVkNQ
VV9FVkVOVF9CUkVBS1BPSU5UID0gS1ZNSV9WQ1BVX0VWRU5UX0lEKDIpLAogCUtWTUlfVkNQVV9F
VkVOVF9DUiAgICAgICAgID0gS1ZNSV9WQ1BVX0VWRU5UX0lEKDMpLAorCUtWTUlfVkNQVV9FVkVO
VF9UUkFQICAgICAgID0gS1ZNSV9WQ1BVX0VWRU5UX0lEKDQpLAogCiAJS1ZNSV9ORVhUX1ZDUFVf
RVZFTlQKIH07CmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0
L2t2bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rl
c3QuYwppbmRleCA2YTExMDNlYWI3N2EuLmRjOWYyZjBkOTllOCAxMDA2NDQKLS0tIGEvdG9vbHMv
dGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYworKysgYi90b29scy90ZXN0
aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCkBAIC00OSw2ICs0OSw3IEBAIHN0
cnVjdCB2Y3B1X3dvcmtlcl9kYXRhIHsKIAlzdHJ1Y3Qga3ZtX3ZtICp2bTsKIAlpbnQgdmNwdV9p
ZDsKIAlpbnQgdGVzdF9pZDsKKwlib29sIHJlc3RhcnRfb25fc2h1dGRvd247CiB9OwogCiBlbnVt
IHsKQEAgLTYzMyw2ICs2MzQsMTAgQEAgc3RhdGljIHZvaWQgKnZjcHVfd29ya2VyKHZvaWQgKmRh
dGEpCiAKIAkJdmNwdV9ydW4oY3R4LT52bSwgY3R4LT52Y3B1X2lkKTsKIAorCQlpZiAocnVuLT5l
eGl0X3JlYXNvbiA9PSBLVk1fRVhJVF9TSFVURE9XTiAmJgorCQkgICAgY3R4LT5yZXN0YXJ0X29u
X3NodXRkb3duKQorCQkJY29udGludWU7CisKIAkJVEVTVF9BU1NFUlQocnVuLT5leGl0X3JlYXNv
biA9PSBLVk1fRVhJVF9JTywKIAkJCSJ2Y3B1X3J1bigpIGZhaWxlZCwgdGVzdF9pZCAlZCwgZXhp
dCByZWFzb24gJXUgKCVzKVxuIiwKIAkJCWN0eC0+dGVzdF9pZCwgcnVuLT5leGl0X3JlYXNvbiwK
QEAgLTExOTksNiArMTIwNCwxMjQgQEAgc3RhdGljIHZvaWQgdGVzdF9jbWRfdmNwdV9jb250cm9s
X2NyKHN0cnVjdCBrdm1fdm0gKnZtKQogCXRlc3RfaW52YWxpZF92Y3B1X2NvbnRyb2xfY3Iodm0p
OwogfQogCitzdGF0aWMgdm9pZCBfX2luamVjdF9leGNlcHRpb24oaW50IG5yKQoreworCXN0cnVj
dCB7CisJCXN0cnVjdCBrdm1pX21zZ19oZHIgaGRyOworCQlzdHJ1Y3Qga3ZtaV92Y3B1X2hkciB2
Y3B1X2hkcjsKKwkJc3RydWN0IGt2bWlfdmNwdV9pbmplY3RfZXhjZXB0aW9uIGNtZDsKKwl9IHJl
cSA9IHt9OworCWludCByOworCisJcmVxLmNtZC5uciA9IG5yOworCisJciA9IF9fZG9fdmNwdTBf
Y29tbWFuZChLVk1JX1ZDUFVfSU5KRUNUX0VYQ0VQVElPTiwKKwkJCSAgICAgICAmcmVxLmhkciwg
c2l6ZW9mKHJlcSksIE5VTEwsIDApOworCVRFU1RfQVNTRVJUKHIgPT0gMCwKKwkJIktWTUlfVkNQ
VV9JTkpFQ1RfRVhDRVBUSU9OIGZhaWxlZCwgZXJyb3IgJWQoJXMpXG4iLAorCQktciwga3ZtX3N0
cmVycm9yKC1yKSk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfZGlzYWxsb3dlZF90cmFwX2V2ZW50
KHN0cnVjdCBrdm1fdm0gKnZtKQoreworCXN0cnVjdCB7CisJCXN0cnVjdCBrdm1pX21zZ19oZHIg
aGRyOworCQlzdHJ1Y3Qga3ZtaV92Y3B1X2hkciB2Y3B1X2hkcjsKKwkJc3RydWN0IGt2bWlfdmNw
dV9pbmplY3RfZXhjZXB0aW9uIGNtZDsKKwl9IHJlcSA9IHt9OworCisJZGlzYWxsb3dfZXZlbnQo
dm0sIEtWTUlfVkNQVV9FVkVOVF9UUkFQKTsKKwl0ZXN0X3ZjcHUwX2NvbW1hbmQodm0sIEtWTUlf
VkNQVV9JTkpFQ1RfRVhDRVBUSU9OLAorCQkJICAgJnJlcS5oZHIsIHNpemVvZihyZXEpLCBOVUxM
LCAwLCAtS1ZNX0VQRVJNKTsKKwlhbGxvd19ldmVudCh2bSwgS1ZNSV9WQ1BVX0VWRU5UX1RSQVAp
OworfQorCitzdGF0aWMgdm9pZCByZWNlaXZlX2V4Y2VwdGlvbl9ldmVudChpbnQgbnIpCit7CisJ
c3RydWN0IGt2bWlfbXNnX2hkciBoZHI7CisJc3RydWN0IHsKKwkJc3RydWN0IHZjcHVfZXZlbnQg
dmNwdV9ldjsKKwkJc3RydWN0IGt2bWlfdmNwdV9ldmVudF90cmFwIHRyYXA7CisJfSBldjsKKwlz
dHJ1Y3QgdmNwdV9yZXBseSBycGwgPSB7fTsKKworCXJlY2VpdmVfdmNwdV9ldmVudCgmaGRyLCAm
ZXYudmNwdV9ldiwgc2l6ZW9mKGV2KSwgS1ZNSV9WQ1BVX0VWRU5UX1RSQVApOworCisJcHJfZGVi
dWcoIkV4Y2VwdGlvbiBldmVudDogdmVjdG9yICV1LCBlcnJvcl9jb2RlIDB4JXgsIGFkZHJlc3Mg
MHglbGx4XG4iLAorCQlldi50cmFwLm5yLCBldi50cmFwLmVycm9yX2NvZGUsIGV2LnRyYXAuYWRk
cmVzcyk7CisKKwlURVNUX0FTU0VSVChldi50cmFwLm5yID09IG5yLAorCQkiSW5qZWN0ZWQgZXhj
ZXB0aW9uICV1IGluc3RlYWQgb2YgJXVcbiIsCisJCWV2LnRyYXAubnIsIG5yKTsKKworCXJlcGx5
X3RvX2V2ZW50KCZoZHIsICZldi52Y3B1X2V2LCBLVk1JX0VWRU5UX0FDVElPTl9DT05USU5VRSwK
KwkJCSZycGwsIHNpemVvZihycGwpKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9zdWNjZWRlZF91
ZF9pbmplY3Rpb24odm9pZCkKK3sKKwlfX3U4IHVkX3ZlY3RvciA9IDY7CisKKwlfX2luamVjdF9l
eGNlcHRpb24odWRfdmVjdG9yKTsKKworCXJlY2VpdmVfZXhjZXB0aW9uX2V2ZW50KHVkX3ZlY3Rv
cik7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfZmFpbGVkX3VkX2luamVjdGlvbihzdHJ1Y3Qga3Zt
X3ZtICp2bSwKKwkJCQkgICAgIHN0cnVjdCB2Y3B1X3dvcmtlcl9kYXRhICpkYXRhKQoreworCXN0
cnVjdCBrdm1pX21zZ19oZHIgaGRyOworCXN0cnVjdCB7CisJCXN0cnVjdCB2Y3B1X2V2ZW50IHZj
cHVfZXY7CisJCXN0cnVjdCBrdm1pX3ZjcHVfZXZlbnRfYnJlYWtwb2ludCBicDsKKwl9IGV2Owor
CXN0cnVjdCB2Y3B1X3JlcGx5IHJwbCA9IHt9OworCV9fdTggdWRfdmVjdG9yID0gNiwgYnBfdmVj
dG9yID0gMzsKKworCVdSSVRFX09OQ0UoZGF0YS0+dGVzdF9pZCwgR1VFU1RfVEVTVF9CUCk7CisK
KwlyZWNlaXZlX3ZjcHVfZXZlbnQoJmhkciwgJmV2LnZjcHVfZXYsIHNpemVvZihldiksCisJCQkg
ICBLVk1JX1ZDUFVfRVZFTlRfQlJFQUtQT0lOVCk7CisKKwkvKiBza2lwIHRoZSBicmVha3BvaW50
IGluc3RydWN0aW9uLCBuZXh0IHRpbWUgZ3Vlc3RfYnBfdGVzdCgpIHJ1bnMgKi8KKwlldi52Y3B1
X2V2LmNvbW1vbi5hcmNoLnJlZ3MucmlwICs9IGV2LmJwLmluc25fbGVuOworCV9fc2V0X3JlZ2lz
dGVycyh2bSwgJmV2LnZjcHVfZXYuY29tbW9uLmFyY2gucmVncyk7CisKKwlfX2luamVjdF9leGNl
cHRpb24odWRfdmVjdG9yKTsKKworCS8qIHJlaW5qZWN0IHRoZSAjQlAgZXhjZXB0aW9uIGJlY2F1
c2Ugb2YgdGhlIGNvbnRpbnVlIGFjdGlvbiAqLworCXJlcGx5X3RvX2V2ZW50KCZoZHIsICZldi52
Y3B1X2V2LCBLVk1JX0VWRU5UX0FDVElPTl9DT05USU5VRSwKKwkJCSZycGwsIHNpemVvZihycGwp
KTsKKworCXJlY2VpdmVfZXhjZXB0aW9uX2V2ZW50KGJwX3ZlY3Rvcik7Cit9CisKK3N0YXRpYyB2
b2lkIHRlc3RfY21kX3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKK3sK
KwlzdHJ1Y3QgdmNwdV93b3JrZXJfZGF0YSBkYXRhID0geworCQkudm0gPSB2bSwKKwkJLnZjcHVf
aWQgPSBWQ1BVX0lELAorCQkucmVzdGFydF9vbl9zaHV0ZG93biA9IHRydWUsCisJfTsKKwlwdGhy
ZWFkX3QgdmNwdV90aHJlYWQ7CisKKwlpZiAoIWlzX2ludGVsX2NwdSgpKSB7CisJCXByaW50X3Nr
aXAoIlRPRE86ICVzKCkgLSBtYWtlIGl0IHdvcmsgd2l0aCBBTUQiLCBfX2Z1bmNfXyk7CisJCXJl
dHVybjsKKwl9CisKKwl0ZXN0X2Rpc2FsbG93ZWRfdHJhcF9ldmVudCh2bSk7CisKKwllbmFibGVf
dmNwdV9ldmVudCh2bSwgS1ZNSV9WQ1BVX0VWRU5UX0JSRUFLUE9JTlQpOworCXZjcHVfdGhyZWFk
ID0gc3RhcnRfdmNwdV93b3JrZXIoJmRhdGEpOworCisJdGVzdF9zdWNjZWRlZF91ZF9pbmplY3Rp
b24oKTsKKwl0ZXN0X2ZhaWxlZF91ZF9pbmplY3Rpb24odm0sICZkYXRhKTsKKworCXdhaXRfdmNw
dV93b3JrZXIodmNwdV90aHJlYWQpOworCWRpc2FibGVfdmNwdV9ldmVudCh2bSwgS1ZNSV9WQ1BV
X0VWRU5UX0JSRUFLUE9JTlQpOworfQorCiBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24o
c3RydWN0IGt2bV92bSAqdm0pCiB7CiAJc3JhbmRvbSh0aW1lKDApKTsKQEAgLTEyMjMsNiArMTM0
Niw3IEBAIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkK
IAl0ZXN0X2V2ZW50X2JyZWFrcG9pbnQodm0pOwogCXRlc3RfY21kX3ZtX2NvbnRyb2xfY2xlYW51
cCh2bSk7CiAJdGVzdF9jbWRfdmNwdV9jb250cm9sX2NyKHZtKTsKKwl0ZXN0X2NtZF92Y3B1X2lu
amVjdF9leGNlcHRpb24odm0pOwogCiAJdW5ob29rX2ludHJvc3BlY3Rpb24odm0pOwogfQpkaWZm
IC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMgYi92aXJ0L2t2bS9pbnRyb3Nw
ZWN0aW9uL2t2bWkuYwppbmRleCBlNjMzMzcwOGM1ODQuLmIzNjZiYTY4MjBkNiAxMDA2NDQKLS0t
IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKKysrIGIvdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pLmMKQEAgLTg0NSw2ICs4NDUsOCBAQCB2b2lkIGt2bWlfaGFuZGxlX3JlcXVlc3Rz
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAlpZiAoIWt2bWkpCiAJCWdvdG8gb3V0OwogCisJa3Zt
aV9hcmNoX3NlbmRfcGVuZGluZ19ldmVudCh2Y3B1KTsKKwogCWZvciAoOzspIHsKIAkJa3ZtaV9y
dW5fam9icyh2Y3B1KTsKIApkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1p
X2ludC5oIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCmluZGV4IGIxODc3YTc3
MGZjYi4uMGE3YTgyODViOTgxIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2
bWlfaW50LmgKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCkBAIC00OCw2
ICs0OCw5IEBAIGludCBrdm1pX21zZ19zZW5kX3VuaG9vayhzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rp
b24gKmt2bWkpOwogaW50IGt2bWlfc2VuZF92Y3B1X2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNw
dSwgdTMyIGV2X2lkLAogCQkJIHZvaWQgKmV2LCBzaXplX3QgZXZfc2l6ZSwKIAkJCSB2b2lkICpy
cGwsIHNpemVfdCBycGxfc2l6ZSwgdTMyICphY3Rpb24pOworaW50IF9fa3ZtaV9zZW5kX3ZjcHVf
ZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgZXZfaWQsCisJCQkgICB2b2lkICpldiwg
c2l6ZV90IGV2X3NpemUsCisJCQkgICB2b2lkICpycGwsIHNpemVfdCBycGxfc2l6ZSwgdTMyICph
Y3Rpb24pOwogaW50IGt2bWlfbXNnX3ZjcHVfcmVwbHkoY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9t
c2dfam9iICpqb2IsCiAJCQljb25zdCBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICptc2csIGludCBlcnIs
CiAJCQljb25zdCB2b2lkICpycGwsIHNpemVfdCBycGxfc2l6ZSk7CkBAIC0xMDAsNSArMTAzLDYg
QEAgYm9vbCBrdm1pX2FyY2hfaXNfYWdlbnRfaHlwZXJjYWxsKHN0cnVjdCBrdm1fdmNwdSAqdmNw
dSk7CiB2b2lkIGt2bWlfYXJjaF9icmVha3BvaW50X2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNw
dSwgdTY0IGd2YSwgdTggaW5zbl9sZW4pOwogaW50IGt2bWlfYXJjaF9jbWRfY29udHJvbF9pbnRl
cmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LAogCQkJCSAgICB1bnNpZ25lZCBpbnQgZXZlbnRf
aWQsIGJvb2wgZW5hYmxlKTsKK3ZvaWQga3ZtaV9hcmNoX3NlbmRfcGVuZGluZ19ldmVudChzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUpOwogCiAjZW5kaWYKZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJv
c3BlY3Rpb24va3ZtaV9tc2cuYyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwpp
bmRleCA5YzFkNjljYWFmMTEuLjc2MmZiNTIyN2RkOSAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50
cm9zcGVjdGlvbi9rdm1pX21zZy5jCisrKyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9t
c2cuYwpAQCAtNzE1LDkgKzcxNSw5IEBAIHN0YXRpYyBpbnQga3ZtaV9maWxsX2FuZF9zZW50X3Zj
cHVfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LAogCXJldHVybiBrdm1pX3NvY2tfd3JpdGUo
a3ZtaSwgdmVjLCBuLCBtc2dfc2l6ZSk7CiB9CiAKLWludCBrdm1pX3NlbmRfdmNwdV9ldmVudChz
dHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiBldl9pZCwKLQkJCSB2b2lkICpldiwgc2l6ZV90IGV2
X3NpemUsCi0JCQkgdm9pZCAqcnBsLCBzaXplX3QgcnBsX3NpemUsIHUzMiAqYWN0aW9uKQoraW50
IF9fa3ZtaV9zZW5kX3ZjcHVfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgZXZfaWQs
CisJCQkgICB2b2lkICpldiwgc2l6ZV90IGV2X3NpemUsCisJCQkgICB2b2lkICpycGwsIHNpemVf
dCBycGxfc2l6ZSwgdTMyICphY3Rpb24pCiB7CiAJc3RydWN0IGt2bV92Y3B1X2ludHJvc3BlY3Rp
b24gKnZjcHVpID0gVkNQVUkodmNwdSk7CiAJc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1p
ID0gS1ZNSSh2Y3B1LT5rdm0pOwpAQCAtNzQ1LDYgKzc0NSwxNiBAQCBpbnQga3ZtaV9zZW5kX3Zj
cHVfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgZXZfaWQsCiAJcmV0dXJuIGVycjsK
IH0KIAoraW50IGt2bWlfc2VuZF92Y3B1X2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKKwkJ
CSB1MzIgZXZfaWQsIHZvaWQgKmV2LCBzaXplX3QgZXZfc2l6ZSwKKwkJCSB2b2lkICpycGwsIHNp
emVfdCBycGxfc2l6ZSwgdTMyICphY3Rpb24pCit7CisJa3ZtaV9hcmNoX3NlbmRfcGVuZGluZ19l
dmVudCh2Y3B1KTsKKworCXJldHVybiBfX2t2bWlfc2VuZF92Y3B1X2V2ZW50KHZjcHUsIGV2X2lk
LCBldiwgZXZfc2l6ZSwKKwkJCQkgICAgICBycGwsIHJwbF9zaXplLCBhY3Rpb24pOworfQorCiB1
MzIga3ZtaV9tc2dfc2VuZF92Y3B1X3BhdXNlKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIHsKIAl1
MzIgYWN0aW9uOwpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGludXgt
Zm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4v
bGlzdGluZm8vdmlydHVhbGl6YXRpb24=
