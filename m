Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from mail.linuxfoundation.org (mail.linuxfoundation.org [140.211.169.12])
	by mail.lfdr.de (Postfix) with ESMTPS id 430067BC7E
	for <lists.virtualization@lfdr.de>; Wed, 31 Jul 2019 11:03:43 +0200 (CEST)
Received: from mail.linux-foundation.org (localhost [127.0.0.1])
	by mail.linuxfoundation.org (Postfix) with ESMTP id 10DE63B2E;
	Wed, 31 Jul 2019 09:03:36 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@mail.linuxfoundation.org
Received: from smtp1.linuxfoundation.org (smtp1.linux-foundation.org
	[172.17.192.35])
	by mail.linuxfoundation.org (Postfix) with ESMTPS id 622CC3B23
	for <virtualization@lists.linux-foundation.org>;
	Wed, 31 Jul 2019 08:51:03 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
	by smtp1.linuxfoundation.org (Postfix) with ESMTPS id 757466CE
	for <virtualization@lists.linux-foundation.org>;
	Wed, 31 Jul 2019 08:51:02 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
	[10.5.11.15])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mx1.redhat.com (Postfix) with ESMTPS id CF17C3084025;
	Wed, 31 Jul 2019 08:51:01 +0000 (UTC)
Received: from [10.72.12.51] (ovpn-12-51.pek2.redhat.com [10.72.12.51])
	by smtp.corp.redhat.com (Postfix) with ESMTP id F03B85D6A7;
	Wed, 31 Jul 2019 08:50:55 +0000 (UTC)
Subject: Re: [PATCH V2 7/9] vhost: do not use RCU to synchronize MMU notifier
	with worker
To: mst@redhat.com, kvm@vger.kernel.org,
	virtualization@lists.linux-foundation.org, netdev@vger.kernel.org
References: <20190731084655.7024-1-jasowang@redhat.com>
	<20190731084655.7024-8-jasowang@redhat.com>
From: Jason Wang <jasowang@redhat.com>
Message-ID: <cab99dc3-962e-57a2-70f3-73e9f64f3a49@redhat.com>
Date: Wed, 31 Jul 2019 16:50:54 +0800
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
	Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190731084655.7024-8-jasowang@redhat.com>
Content-Language: en-US
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
	(mx1.redhat.com [10.5.110.40]);
	Wed, 31 Jul 2019 08:51:01 +0000 (UTC)
X-Spam-Status: No, score=-6.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_HI
	autolearn=ham version=3.3.1
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	smtp1.linux-foundation.org
Cc: linux-mm@kvack.org, linux-kernel@vger.kernel.org, jgg@ziepe.ca
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.12
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Sender: virtualization-bounces@lists.linux-foundation.org
Errors-To: virtualization-bounces@lists.linux-foundation.org

Ck9uIDIwMTkvNy8zMSDkuIvljYg0OjQ2LCBKYXNvbiBXYW5nIHdyb3RlOgo+IFdlIHVzZWQgdG8g
dXNlIFJDVSB0byBzeW5jaHJvbml6ZSBNTVUgbm90aWZpZXIgd2l0aCB3b3JrZXIuIFRoaXMgbGVh
ZHMKPiBjYWxsaW5nIHN5bmNocm9uaXplX3JjdSgpIGluIGludmFsaWRhdGVfcmFuZ2Vfc3RhcnQo
KS4gQnV0IG9uIGEgYnVzeQo+IHN5c3RlbSwgdGhlcmUgd291bGQgYmUgbWFueSBmYWN0b3JzIHRo
YXQgbWF5IHNsb3cgZG93biB0aGUKPiBzeW5jaHJvbml6ZV9yY3UoKSB3aGljaCBtYWtlcyBpdCB1
bnN1aXRhYmxlIHRvIGJlIGNhbGxlZCBpbiBNTVUKPiBub3RpZmllci4KPgo+IEEgc29sdXRpb24g
aXMgU1JDVSBidXQgaXRzIG92ZXJoZWFkIGlzIG9idmlvdXMgd2l0aCB0aGUgZXhwZW5zaXZlIGZ1
bGwKPiBtZW1vcnkgYmFycmllci4gQW5vdGhlciBjaG9pY2UgaXMgdG8gdXNlIHNlcWxvY2ssIGJ1
dCBpdCBkb2Vzbid0Cj4gcHJvdmlkZSBhIHN5bmNocm9uaXphdGlvbiBtZXRob2QgYmV0d2VlbiBy
ZWFkZXJzIGFuZCB3cml0ZXJzLiBUaGUgbGFzdAo+IGNob2ljZSBpcyB0byB1c2UgdnEgbXV0ZXgs
IGJ1dCBpdCBuZWVkIHRvIGRlYWwgd2l0aCB0aGUgd29yc3QgY2FzZQo+IHRoYXQgTU1VIG5vdGlm
aWVyIG11c3QgYmUgYmxvY2tlZCBhbmQgd2FpdCBmb3IgdGhlIGZpbmlzaCBvZiBzd2FwIGluLgo+
Cj4gU28gdGhpcyBwYXRjaCBzd2l0Y2hlcyB1c2UgYSBjb3VudGVyIHRvIHRyYWNrIHdoZXRoZXIg
b3Igbm90IHRoZSBtYXAKPiB3YXMgdXNlZC4gVGhlIGNvdW50ZXIgd2FzIGluY3JlYXNlZCB3aGVu
IHZxIHRyeSB0byBzdGFydCBvciBmaW5pc2gKPiB1c2VzIHRoZSBtYXAuIFRoaXMgbWVhbnMsIHdo
ZW4gaXQgd2FzIGV2ZW4sIHdlJ3JlIHN1cmUgdGhlcmUncyBubwo+IHJlYWRlcnMgYW5kIE1NVSBu
b3RpZmllciBpcyBzeW5jaHJvbml6ZWQuIFdoZW4gaXQgd2FzIG9kZCwgaXQgbWVhbnMKPiB0aGVy
ZSdzIGEgcmVhZGVyIHdlIG5lZWQgdG8gd2FpdCBpdCB0byBiZSBldmVuIGFnYWluIHRoZW4gd2Ug
YXJlCj4gc3luY2hyb25pemVkLiBUbyBhdm9pZCBmdWxsIG1lbW9yeSBiYXJyaWVyLCBzdG9yZV9y
ZWxlYXNlICsKPiBsb2FkX2FjcXVpcmUgb24gdGhlIGNvdW50ZXIgaXMgdXNlZC4KCgpGb3IgcmV2
aWV3ZXJzLCBJIHRyeSBoYXJkIHRvIGF2b2lkIGUuZyBzbXBfbWIoKSwgcGxlYXNlIGRvdWJsZSBj
aGVjayAKd2hldGhlciBvciBub3QgdGhpcyB0cmljayB3b3JrLgoKVGhhbmtzCgoKPgo+IENvbnNp
ZGVyIHRoZSByZWFkIGNyaXRpY2FsIHNlY3Rpb24gaXMgcHJldHR5IHNtYWxsIHRoZSBzeW5jaHJv
bml6YXRpb24KPiBzaG91bGQgYmUgZG9uZSB2ZXJ5IGZhc3QuCj4KPiBOb3RlIHRoZSBwYXRjaCBs
ZWFkIGFib3V0IDMlIFBQUyBkcm9wcGluZy4KPgo+IFJlcG9ydGVkLWJ5OiBNaWNoYWVsIFMuIFRz
aXJraW4gPG1zdEByZWRoYXQuY29tPgo+IEZpeGVzOiA3ZjQ2NjAzMmRjOWUgKCJ2aG9zdDogYWNj
ZXNzIHZxIG1ldGFkYXRhIHRocm91Z2gga2VybmVsIHZpcnR1YWwgYWRkcmVzcyIpCj4gU2lnbmVk
LW9mZi1ieTogSmFzb24gV2FuZyA8amFzb3dhbmdAcmVkaGF0LmNvbT4KPiAtLS0KPiAgIGRyaXZl
cnMvdmhvc3Qvdmhvc3QuYyB8IDE0NSArKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0t
LS0tLS0tLS0KPiAgIGRyaXZlcnMvdmhvc3Qvdmhvc3QuaCB8ICAgNyArLQo+ICAgMiBmaWxlcyBj
aGFuZ2VkLCA5NCBpbnNlcnRpb25zKCspLCA1OCBkZWxldGlvbnMoLSkKPgo+IGRpZmYgLS1naXQg
YS9kcml2ZXJzL3Zob3N0L3Zob3N0LmMgYi9kcml2ZXJzL3Zob3N0L3Zob3N0LmMKPiBpbmRleCBj
ZmMxMWY5ZWQ5YzkuLmRiMmM4MWNiMWU5MCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL3Zob3N0L3Zo
b3N0LmMKPiArKysgYi9kcml2ZXJzL3Zob3N0L3Zob3N0LmMKPiBAQCAtMzI0LDE3ICszMjQsMTYg
QEAgc3RhdGljIHZvaWQgdmhvc3RfdW5pbml0X3ZxX21hcHMoc3RydWN0IHZob3N0X3ZpcnRxdWV1
ZSAqdnEpCj4gICAKPiAgIAlzcGluX2xvY2soJnZxLT5tbXVfbG9jayk7Cj4gICAJZm9yIChpID0g
MDsgaSA8IFZIT1NUX05VTV9BRERSUzsgaSsrKSB7Cj4gLQkJbWFwW2ldID0gcmN1X2RlcmVmZXJl
bmNlX3Byb3RlY3RlZCh2cS0+bWFwc1tpXSwKPiAtCQkJCSAgbG9ja2RlcF9pc19oZWxkKCZ2cS0+
bW11X2xvY2spKTsKPiArCQltYXBbaV0gPSB2cS0+bWFwc1tpXTsKPiAgIAkJaWYgKG1hcFtpXSkg
ewo+ICAgCQkJdmhvc3Rfc2V0X21hcF9kaXJ0eSh2cSwgbWFwW2ldLCBpKTsKPiAtCQkJcmN1X2Fz
c2lnbl9wb2ludGVyKHZxLT5tYXBzW2ldLCBOVUxMKTsKPiArCQkJdnEtPm1hcHNbaV0gPSBOVUxM
Owo+ICAgCQl9Cj4gICAJfQo+ICAgCXNwaW5fdW5sb2NrKCZ2cS0+bW11X2xvY2spOwo+ICAgCj4g
LQkvKiBObyBuZWVkIGZvciBzeW5jaHJvbml6ZV9yY3UoKSBvciBrZnJlZV9yY3UoKSBzaW5jZSB3
ZSBhcmUKPiAtCSAqIHNlcmlhbGl6ZWQgd2l0aCBtZW1vcnkgYWNjZXNzb3JzIChlLmcgdnEgbXV0
ZXggaGVsZCkuCj4gKwkvKiBObyBuZWVkIGZvciBzeW5jaHJvbml6YXRpb24gc2luY2Ugd2UgYXJl
IHNlcmlhbGl6ZWQgd2l0aAo+ICsJICogbWVtb3J5IGFjY2Vzc29ycyAoZS5nIHZxIG11dGV4IGhl
bGQpLgo+ICAgCSAqLwo+ICAgCj4gICAJZm9yIChpID0gMDsgaSA8IFZIT1NUX05VTV9BRERSUzsg
aSsrKQo+IEBAIC0zNjIsNiArMzYxLDQ0IEBAIHN0YXRpYyBib29sIHZob3N0X21hcF9yYW5nZV9v
dmVybGFwKHN0cnVjdCB2aG9zdF91YWRkciAqdWFkZHIsCj4gICAJcmV0dXJuICEoZW5kIDwgdWFk
ZHItPnVhZGRyIHx8IHN0YXJ0ID4gdWFkZHItPnVhZGRyIC0gMSArIHVhZGRyLT5zaXplKTsKPiAg
IH0KPiAgIAo+ICtzdGF0aWMgdm9pZCBpbmxpbmUgdmhvc3RfdnFfYWNjZXNzX21hcF9iZWdpbihz
dHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSkKPiArewo+ICsJaW50IHJlZiA9IFJFQURfT05DRSh2
cS0+cmVmKTsKPiArCj4gKwlzbXBfc3RvcmVfcmVsZWFzZSgmdnEtPnJlZiwgcmVmICsgMSk7Cj4g
KwkvKiBNYWtlIHN1cmUgcmVmIGNvdW50ZXIgaXMgdmlzaWJsZSBiZWZvcmUgYWNjZXNzaW5nIHRo
ZSBtYXAgKi8KPiArCXNtcF9sb2FkX2FjcXVpcmUoJnZxLT5yZWYpOwo+ICt9Cj4gKwo+ICtzdGF0
aWMgdm9pZCBpbmxpbmUgdmhvc3RfdnFfYWNjZXNzX21hcF9lbmQoc3RydWN0IHZob3N0X3ZpcnRx
dWV1ZSAqdnEpCj4gK3sKPiArCWludCByZWYgPSBSRUFEX09OQ0UodnEtPnJlZik7Cj4gKwo+ICsJ
LyogTWFrZSBzdXJlIHZxIGFjY2VzcyBpcyBkb25lIGJlZm9yZSBpbmNyZWFzaW5nIHJlZiBjb3Vu
dGVyICovCj4gKwlzbXBfc3RvcmVfcmVsZWFzZSgmdnEtPnJlZiwgcmVmICsgMSk7Cj4gK30KPiAr
Cj4gK3N0YXRpYyB2b2lkIGlubGluZSB2aG9zdF92cV9zeW5jX2FjY2VzcyhzdHJ1Y3Qgdmhvc3Rf
dmlydHF1ZXVlICp2cSkKPiArewo+ICsJaW50IHJlZjsKPiArCj4gKwkvKiBNYWtlIHN1cmUgbWFw
IGNoYW5nZSB3YXMgZG9uZSBiZWZvcmUgY2hlY2tpbmcgcmVmIGNvdW50ZXIgKi8KPiArCXNtcF9t
YigpOwo+ICsKPiArCXJlZiA9IFJFQURfT05DRSh2cS0+cmVmKTsKPiArCWlmIChyZWYgJiAweDEp
IHsKPiArCQkvKiBXaGVuIHJlZiBjaGFuZ2UsIHdlIGFyZSBzdXJlIG5vIHJlYWRlciBjYW4gc2Vl
Cj4gKwkJICogcHJldmlvdXMgbWFwICovCj4gKwkJd2hpbGUgKFJFQURfT05DRSh2cS0+cmVmKSA9
PSByZWYpIHsKPiArCQkJc2V0X2N1cnJlbnRfc3RhdGUoVEFTS19SVU5OSU5HKTsKPiArCQkJc2No
ZWR1bGUoKTsKPiArCQl9Cj4gKwl9Cj4gKwkvKiBNYWtlIHN1cmUgcmVmIGNvdW50ZXIgd2FzIGNo
ZWNrZWQgYmVmb3JlIGFueSBvdGhlcgo+ICsJICogb3BlcmF0aW9ucyB0aGF0IHdhcyBkZW5lIG9u
IG1hcC4gKi8KPiArCXNtcF9tYigpOwo+ICt9Cj4gKwo+ICAgc3RhdGljIHZvaWQgdmhvc3RfaW52
YWxpZGF0ZV92cV9zdGFydChzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSwKPiAgIAkJCQkgICAg
ICBpbnQgaW5kZXgsCj4gICAJCQkJICAgICAgdW5zaWduZWQgbG9uZyBzdGFydCwKPiBAQCAtMzc2
LDE2ICs0MTMsMTUgQEAgc3RhdGljIHZvaWQgdmhvc3RfaW52YWxpZGF0ZV92cV9zdGFydChzdHJ1
Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSwKPiAgIAlzcGluX2xvY2soJnZxLT5tbXVfbG9jayk7Cj4g
ICAJKyt2cS0+aW52YWxpZGF0ZV9jb3VudDsKPiAgIAo+IC0JbWFwID0gcmN1X2RlcmVmZXJlbmNl
X3Byb3RlY3RlZCh2cS0+bWFwc1tpbmRleF0sCj4gLQkJCQkJbG9ja2RlcF9pc19oZWxkKCZ2cS0+
bW11X2xvY2spKTsKPiArCW1hcCA9IHZxLT5tYXBzW2luZGV4XTsKPiAgIAlpZiAobWFwKSB7Cj4g
ICAJCXZob3N0X3NldF9tYXBfZGlydHkodnEsIG1hcCwgaW5kZXgpOwo+IC0JCXJjdV9hc3NpZ25f
cG9pbnRlcih2cS0+bWFwc1tpbmRleF0sIE5VTEwpOwo+ICsJCXZxLT5tYXBzW2luZGV4XSA9IE5V
TEw7Cj4gICAJfQo+ICAgCXNwaW5fdW5sb2NrKCZ2cS0+bW11X2xvY2spOwo+ICAgCj4gICAJaWYg
KG1hcCkgewo+IC0JCXN5bmNocm9uaXplX3JjdSgpOwo+ICsJCXZob3N0X3ZxX3N5bmNfYWNjZXNz
KHZxKTsKPiAgIAkJdmhvc3RfbWFwX3VucHJlZmV0Y2gobWFwKTsKPiAgIAl9Cj4gICB9Cj4gQEAg
LTQ1Nyw3ICs0OTMsNyBAQCBzdGF0aWMgdm9pZCB2aG9zdF9pbml0X21hcHMoc3RydWN0IHZob3N0
X2RldiAqZGV2KQo+ICAgCWZvciAoaSA9IDA7IGkgPCBkZXYtPm52cXM7ICsraSkgewo+ICAgCQl2
cSA9IGRldi0+dnFzW2ldOwo+ICAgCQlmb3IgKGogPSAwOyBqIDwgVkhPU1RfTlVNX0FERFJTOyBq
KyspCj4gLQkJCVJDVV9JTklUX1BPSU5URVIodnEtPm1hcHNbal0sIE5VTEwpOwo+ICsJCQl2cS0+
bWFwc1tqXSA9IE5VTEw7Cj4gICAJfQo+ICAgfQo+ICAgI2VuZGlmCj4gQEAgLTY1NSw2ICs2OTEs
NyBAQCB2b2lkIHZob3N0X2Rldl9pbml0KHN0cnVjdCB2aG9zdF9kZXYgKmRldiwKPiAgIAkJdnEt
PmluZGlyZWN0ID0gTlVMTDsKPiAgIAkJdnEtPmhlYWRzID0gTlVMTDsKPiAgIAkJdnEtPmRldiA9
IGRldjsKPiArCQl2cS0+cmVmID0gMDsKPiAgIAkJbXV0ZXhfaW5pdCgmdnEtPm11dGV4KTsKPiAg
IAkJc3Bpbl9sb2NrX2luaXQoJnZxLT5tbXVfbG9jayk7Cj4gICAJCXZob3N0X3ZxX3Jlc2V0KGRl
diwgdnEpOwo+IEBAIC05MjEsNyArOTU4LDcgQEAgc3RhdGljIGludCB2aG9zdF9tYXBfcHJlZmV0
Y2goc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4gICAJbWFwLT5ucGFnZXMgPSBucGFnZXM7
Cj4gICAJbWFwLT5wYWdlcyA9IHBhZ2VzOwo+ICAgCj4gLQlyY3VfYXNzaWduX3BvaW50ZXIodnEt
Pm1hcHNbaW5kZXhdLCBtYXApOwo+ICsJdnEtPm1hcHNbaW5kZXhdID0gbWFwOwo+ICAgCS8qIE5v
IG5lZWQgZm9yIGEgc3luY2hyb25pemVfcmN1KCkuIFRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlCj4g
ICAJICogY2FsbGVkIGJ5IGRldi0+d29ya2VyIHNvIHdlIGFyZSBzZXJpYWxpemVkIHdpdGggYWxs
Cj4gICAJICogcmVhZGVycy4KPiBAQCAtMTIxNiwxOCArMTI1MywxOCBAQCBzdGF0aWMgaW5saW5l
IGludCB2aG9zdF9wdXRfYXZhaWxfZXZlbnQoc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEpCj4g
ICAJc3RydWN0IHZyaW5nX3VzZWQgKnVzZWQ7Cj4gICAKPiAgIAlpZiAoIXZxLT5pb3RsYikgewo+
IC0JCXJjdV9yZWFkX2xvY2soKTsKPiArCQl2aG9zdF92cV9hY2Nlc3NfbWFwX2JlZ2luKHZxKTsK
PiAgIAo+IC0JCW1hcCA9IHJjdV9kZXJlZmVyZW5jZSh2cS0+bWFwc1tWSE9TVF9BRERSX1VTRURd
KTsKPiArCQltYXAgPSB2cS0+bWFwc1tWSE9TVF9BRERSX1VTRURdOwo+ICAgCQlpZiAobGlrZWx5
KG1hcCkpIHsKPiAgIAkJCXVzZWQgPSBtYXAtPmFkZHI7Cj4gICAJCQkqKChfX3ZpcnRpbzE2ICop
JnVzZWQtPnJpbmdbdnEtPm51bV0pID0KPiAgIAkJCQljcHVfdG9fdmhvc3QxNih2cSwgdnEtPmF2
YWlsX2lkeCk7Cj4gLQkJCXJjdV9yZWFkX3VubG9jaygpOwo+ICsJCQl2aG9zdF92cV9hY2Nlc3Nf
bWFwX2VuZCh2cSk7Cj4gICAJCQlyZXR1cm4gMDsKPiAgIAkJfQo+ICAgCj4gLQkJcmN1X3JlYWRf
dW5sb2NrKCk7Cj4gKwkJdmhvc3RfdnFfYWNjZXNzX21hcF9lbmQodnEpOwo+ICAgCX0KPiAgICNl
bmRpZgo+ICAgCj4gQEAgLTEyNDUsMTggKzEyODIsMTggQEAgc3RhdGljIGlubGluZSBpbnQgdmhv
c3RfcHV0X3VzZWQoc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4gICAJc2l6ZV90IHNpemU7
Cj4gICAKPiAgIAlpZiAoIXZxLT5pb3RsYikgewo+IC0JCXJjdV9yZWFkX2xvY2soKTsKPiArCQl2
aG9zdF92cV9hY2Nlc3NfbWFwX2JlZ2luKHZxKTsKPiAgIAo+IC0JCW1hcCA9IHJjdV9kZXJlZmVy
ZW5jZSh2cS0+bWFwc1tWSE9TVF9BRERSX1VTRURdKTsKPiArCQltYXAgPSB2cS0+bWFwc1tWSE9T
VF9BRERSX1VTRURdOwo+ICAgCQlpZiAobGlrZWx5KG1hcCkpIHsKPiAgIAkJCXVzZWQgPSBtYXAt
PmFkZHI7Cj4gICAJCQlzaXplID0gY291bnQgKiBzaXplb2YoKmhlYWQpOwo+ICAgCQkJbWVtY3B5
KHVzZWQtPnJpbmcgKyBpZHgsIGhlYWQsIHNpemUpOwo+IC0JCQlyY3VfcmVhZF91bmxvY2soKTsK
PiArCQkJdmhvc3RfdnFfYWNjZXNzX21hcF9lbmQodnEpOwo+ICAgCQkJcmV0dXJuIDA7Cj4gICAJ
CX0KPiAgIAo+IC0JCXJjdV9yZWFkX3VubG9jaygpOwo+ICsJCXZob3N0X3ZxX2FjY2Vzc19tYXBf
ZW5kKHZxKTsKPiAgIAl9Cj4gICAjZW5kaWYKPiAgIAo+IEBAIC0xMjcyLDE3ICsxMzA5LDE3IEBA
IHN0YXRpYyBpbmxpbmUgaW50IHZob3N0X3B1dF91c2VkX2ZsYWdzKHN0cnVjdCB2aG9zdF92aXJ0
cXVldWUgKnZxKQo+ICAgCXN0cnVjdCB2cmluZ191c2VkICp1c2VkOwo+ICAgCj4gICAJaWYgKCF2
cS0+aW90bGIpIHsKPiAtCQlyY3VfcmVhZF9sb2NrKCk7Cj4gKwkJdmhvc3RfdnFfYWNjZXNzX21h
cF9iZWdpbih2cSk7Cj4gICAKPiAtCQltYXAgPSByY3VfZGVyZWZlcmVuY2UodnEtPm1hcHNbVkhP
U1RfQUREUl9VU0VEXSk7Cj4gKwkJbWFwID0gdnEtPm1hcHNbVkhPU1RfQUREUl9VU0VEXTsKPiAg
IAkJaWYgKGxpa2VseShtYXApKSB7Cj4gICAJCQl1c2VkID0gbWFwLT5hZGRyOwo+ICAgCQkJdXNl
ZC0+ZmxhZ3MgPSBjcHVfdG9fdmhvc3QxNih2cSwgdnEtPnVzZWRfZmxhZ3MpOwo+IC0JCQlyY3Vf
cmVhZF91bmxvY2soKTsKPiArCQkJdmhvc3RfdnFfYWNjZXNzX21hcF9lbmQodnEpOwo+ICAgCQkJ
cmV0dXJuIDA7Cj4gICAJCX0KPiAgIAo+IC0JCXJjdV9yZWFkX3VubG9jaygpOwo+ICsJCXZob3N0
X3ZxX2FjY2Vzc19tYXBfZW5kKHZxKTsKPiAgIAl9Cj4gICAjZW5kaWYKPiAgIAo+IEBAIC0xMjk4
LDE3ICsxMzM1LDE3IEBAIHN0YXRpYyBpbmxpbmUgaW50IHZob3N0X3B1dF91c2VkX2lkeChzdHJ1
Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSkKPiAgIAlzdHJ1Y3QgdnJpbmdfdXNlZCAqdXNlZDsKPiAg
IAo+ICAgCWlmICghdnEtPmlvdGxiKSB7Cj4gLQkJcmN1X3JlYWRfbG9jaygpOwo+ICsJCXZob3N0
X3ZxX2FjY2Vzc19tYXBfYmVnaW4odnEpOwo+ICAgCj4gLQkJbWFwID0gcmN1X2RlcmVmZXJlbmNl
KHZxLT5tYXBzW1ZIT1NUX0FERFJfVVNFRF0pOwo+ICsJCW1hcCA9IHZxLT5tYXBzW1ZIT1NUX0FE
RFJfVVNFRF07Cj4gICAJCWlmIChsaWtlbHkobWFwKSkgewo+ICAgCQkJdXNlZCA9IG1hcC0+YWRk
cjsKPiAgIAkJCXVzZWQtPmlkeCA9IGNwdV90b192aG9zdDE2KHZxLCB2cS0+bGFzdF91c2VkX2lk
eCk7Cj4gLQkJCXJjdV9yZWFkX3VubG9jaygpOwo+ICsJCQl2aG9zdF92cV9hY2Nlc3NfbWFwX2Vu
ZCh2cSk7Cj4gICAJCQlyZXR1cm4gMDsKPiAgIAkJfQo+ICAgCj4gLQkJcmN1X3JlYWRfdW5sb2Nr
KCk7Cj4gKwkJdmhvc3RfdnFfYWNjZXNzX21hcF9lbmQodnEpOwo+ICAgCX0KPiAgICNlbmRpZgo+
ICAgCj4gQEAgLTEzNjIsMTcgKzEzOTksMTcgQEAgc3RhdGljIGlubGluZSBpbnQgdmhvc3RfZ2V0
X2F2YWlsX2lkeChzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSwKPiAgIAlzdHJ1Y3QgdnJpbmdf
YXZhaWwgKmF2YWlsOwo+ICAgCj4gICAJaWYgKCF2cS0+aW90bGIpIHsKPiAtCQlyY3VfcmVhZF9s
b2NrKCk7Cj4gKwkJdmhvc3RfdnFfYWNjZXNzX21hcF9iZWdpbih2cSk7Cj4gICAKPiAtCQltYXAg
PSByY3VfZGVyZWZlcmVuY2UodnEtPm1hcHNbVkhPU1RfQUREUl9BVkFJTF0pOwo+ICsJCW1hcCA9
IHZxLT5tYXBzW1ZIT1NUX0FERFJfQVZBSUxdOwo+ICAgCQlpZiAobGlrZWx5KG1hcCkpIHsKPiAg
IAkJCWF2YWlsID0gbWFwLT5hZGRyOwo+ICAgCQkJKmlkeCA9IGF2YWlsLT5pZHg7Cj4gLQkJCXJj
dV9yZWFkX3VubG9jaygpOwo+ICsJCQl2aG9zdF92cV9hY2Nlc3NfbWFwX2VuZCh2cSk7Cj4gICAJ
CQlyZXR1cm4gMDsKPiAgIAkJfQo+ICAgCj4gLQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4gKwkJdmhv
c3RfdnFfYWNjZXNzX21hcF9lbmQodnEpOwo+ICAgCX0KPiAgICNlbmRpZgo+ICAgCj4gQEAgLTEz
ODcsMTcgKzE0MjQsMTcgQEAgc3RhdGljIGlubGluZSBpbnQgdmhvc3RfZ2V0X2F2YWlsX2hlYWQo
c3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4gICAJc3RydWN0IHZyaW5nX2F2YWlsICphdmFp
bDsKPiAgIAo+ICAgCWlmICghdnEtPmlvdGxiKSB7Cj4gLQkJcmN1X3JlYWRfbG9jaygpOwo+ICsJ
CXZob3N0X3ZxX2FjY2Vzc19tYXBfYmVnaW4odnEpOwo+ICAgCj4gLQkJbWFwID0gcmN1X2RlcmVm
ZXJlbmNlKHZxLT5tYXBzW1ZIT1NUX0FERFJfQVZBSUxdKTsKPiArCQltYXAgPSB2cS0+bWFwc1tW
SE9TVF9BRERSX0FWQUlMXTsKPiAgIAkJaWYgKGxpa2VseShtYXApKSB7Cj4gICAJCQlhdmFpbCA9
IG1hcC0+YWRkcjsKPiAgIAkJCSpoZWFkID0gYXZhaWwtPnJpbmdbaWR4ICYgKHZxLT5udW0gLSAx
KV07Cj4gLQkJCXJjdV9yZWFkX3VubG9jaygpOwo+ICsJCQl2aG9zdF92cV9hY2Nlc3NfbWFwX2Vu
ZCh2cSk7Cj4gICAJCQlyZXR1cm4gMDsKPiAgIAkJfQo+ICAgCj4gLQkJcmN1X3JlYWRfdW5sb2Nr
KCk7Cj4gKwkJdmhvc3RfdnFfYWNjZXNzX21hcF9lbmQodnEpOwo+ICAgCX0KPiAgICNlbmRpZgo+
ICAgCj4gQEAgLTE0MTMsMTcgKzE0NTAsMTcgQEAgc3RhdGljIGlubGluZSBpbnQgdmhvc3RfZ2V0
X2F2YWlsX2ZsYWdzKHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxLAo+ICAgCXN0cnVjdCB2cmlu
Z19hdmFpbCAqYXZhaWw7Cj4gICAKPiAgIAlpZiAoIXZxLT5pb3RsYikgewo+IC0JCXJjdV9yZWFk
X2xvY2soKTsKPiArCQl2aG9zdF92cV9hY2Nlc3NfbWFwX2JlZ2luKHZxKTsKPiAgIAo+IC0JCW1h
cCA9IHJjdV9kZXJlZmVyZW5jZSh2cS0+bWFwc1tWSE9TVF9BRERSX0FWQUlMXSk7Cj4gKwkJbWFw
ID0gdnEtPm1hcHNbVkhPU1RfQUREUl9BVkFJTF07Cj4gICAJCWlmIChsaWtlbHkobWFwKSkgewo+
ICAgCQkJYXZhaWwgPSBtYXAtPmFkZHI7Cj4gICAJCQkqZmxhZ3MgPSBhdmFpbC0+ZmxhZ3M7Cj4g
LQkJCXJjdV9yZWFkX3VubG9jaygpOwo+ICsJCQl2aG9zdF92cV9hY2Nlc3NfbWFwX2VuZCh2cSk7
Cj4gICAJCQlyZXR1cm4gMDsKPiAgIAkJfQo+ICAgCj4gLQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4g
KwkJdmhvc3RfdnFfYWNjZXNzX21hcF9lbmQodnEpOwo+ICAgCX0KPiAgICNlbmRpZgo+ICAgCj4g
QEAgLTE0MzgsMTUgKzE0NzUsMTUgQEAgc3RhdGljIGlubGluZSBpbnQgdmhvc3RfZ2V0X3VzZWRf
ZXZlbnQoc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4gICAJc3RydWN0IHZyaW5nX2F2YWls
ICphdmFpbDsKPiAgIAo+ICAgCWlmICghdnEtPmlvdGxiKSB7Cj4gLQkJcmN1X3JlYWRfbG9jaygp
Owo+IC0JCW1hcCA9IHJjdV9kZXJlZmVyZW5jZSh2cS0+bWFwc1tWSE9TVF9BRERSX0FWQUlMXSk7
Cj4gKwkJdmhvc3RfdnFfYWNjZXNzX21hcF9iZWdpbih2cSk7Cj4gKwkJbWFwID0gdnEtPm1hcHNb
VkhPU1RfQUREUl9BVkFJTF07Cj4gICAJCWlmIChsaWtlbHkobWFwKSkgewo+ICAgCQkJYXZhaWwg
PSBtYXAtPmFkZHI7Cj4gICAJCQkqZXZlbnQgPSAoX192aXJ0aW8xNilhdmFpbC0+cmluZ1t2cS0+
bnVtXTsKPiAtCQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4gKwkJCXZob3N0X3ZxX2FjY2Vzc19tYXBf
ZW5kKHZxKTsKPiAgIAkJCXJldHVybiAwOwo+ICAgCQl9Cj4gLQkJcmN1X3JlYWRfdW5sb2NrKCk7
Cj4gKwkJdmhvc3RfdnFfYWNjZXNzX21hcF9lbmQodnEpOwo+ICAgCX0KPiAgICNlbmRpZgo+ICAg
Cj4gQEAgLTE0NjEsMTcgKzE0OTgsMTcgQEAgc3RhdGljIGlubGluZSBpbnQgdmhvc3RfZ2V0X3Vz
ZWRfaWR4KHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxLAo+ICAgCXN0cnVjdCB2cmluZ191c2Vk
ICp1c2VkOwo+ICAgCj4gICAJaWYgKCF2cS0+aW90bGIpIHsKPiAtCQlyY3VfcmVhZF9sb2NrKCk7
Cj4gKwkJdmhvc3RfdnFfYWNjZXNzX21hcF9iZWdpbih2cSk7Cj4gICAKPiAtCQltYXAgPSByY3Vf
ZGVyZWZlcmVuY2UodnEtPm1hcHNbVkhPU1RfQUREUl9VU0VEXSk7Cj4gKwkJbWFwID0gdnEtPm1h
cHNbVkhPU1RfQUREUl9VU0VEXTsKPiAgIAkJaWYgKGxpa2VseShtYXApKSB7Cj4gICAJCQl1c2Vk
ID0gbWFwLT5hZGRyOwo+ICAgCQkJKmlkeCA9IHVzZWQtPmlkeDsKPiAtCQkJcmN1X3JlYWRfdW5s
b2NrKCk7Cj4gKwkJCXZob3N0X3ZxX2FjY2Vzc19tYXBfZW5kKHZxKTsKPiAgIAkJCXJldHVybiAw
Owo+ICAgCQl9Cj4gICAKPiAtCQlyY3VfcmVhZF91bmxvY2soKTsKPiArCQl2aG9zdF92cV9hY2Nl
c3NfbWFwX2VuZCh2cSk7Cj4gICAJfQo+ICAgI2VuZGlmCj4gICAKPiBAQCAtMTQ4NiwxNyArMTUy
MywxNyBAQCBzdGF0aWMgaW5saW5lIGludCB2aG9zdF9nZXRfZGVzYyhzdHJ1Y3Qgdmhvc3Rfdmly
dHF1ZXVlICp2cSwKPiAgIAlzdHJ1Y3QgdnJpbmdfZGVzYyAqZDsKPiAgIAo+ICAgCWlmICghdnEt
PmlvdGxiKSB7Cj4gLQkJcmN1X3JlYWRfbG9jaygpOwo+ICsJCXZob3N0X3ZxX2FjY2Vzc19tYXBf
YmVnaW4odnEpOwo+ICAgCj4gLQkJbWFwID0gcmN1X2RlcmVmZXJlbmNlKHZxLT5tYXBzW1ZIT1NU
X0FERFJfREVTQ10pOwo+ICsJCW1hcCA9IHZxLT5tYXBzW1ZIT1NUX0FERFJfREVTQ107Cj4gICAJ
CWlmIChsaWtlbHkobWFwKSkgewo+ICAgCQkJZCA9IG1hcC0+YWRkcjsKPiAgIAkJCSpkZXNjID0g
KihkICsgaWR4KTsKPiAtCQkJcmN1X3JlYWRfdW5sb2NrKCk7Cj4gKwkJCXZob3N0X3ZxX2FjY2Vz
c19tYXBfZW5kKHZxKTsKPiAgIAkJCXJldHVybiAwOwo+ICAgCQl9Cj4gICAKPiAtCQlyY3VfcmVh
ZF91bmxvY2soKTsKPiArCQl2aG9zdF92cV9hY2Nlc3NfbWFwX2VuZCh2cSk7Cj4gICAJfQo+ICAg
I2VuZGlmCj4gICAKPiBAQCAtMTg0MywxMyArMTg4MCwxMSBAQCBzdGF0aWMgYm9vbCBpb3RsYl9h
Y2Nlc3Nfb2soc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4gICAjaWYgVkhPU1RfQVJDSF9D
QU5fQUNDRUxfVUFDQ0VTUwo+ICAgc3RhdGljIHZvaWQgdmhvc3RfdnFfbWFwX3ByZWZldGNoKHN0
cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxKQo+ICAgewo+IC0Jc3RydWN0IHZob3N0X21hcCBfX3Jj
dSAqbWFwOwo+ICsJc3RydWN0IHZob3N0X21hcCAqbWFwOwo+ICAgCWludCBpOwo+ICAgCj4gICAJ
Zm9yIChpID0gMDsgaSA8IFZIT1NUX05VTV9BRERSUzsgaSsrKSB7Cj4gLQkJcmN1X3JlYWRfbG9j
aygpOwo+IC0JCW1hcCA9IHJjdV9kZXJlZmVyZW5jZSh2cS0+bWFwc1tpXSk7Cj4gLQkJcmN1X3Jl
YWRfdW5sb2NrKCk7Cj4gKwkJbWFwID0gdnEtPm1hcHNbaV07Cj4gICAJCWlmICh1bmxpa2VseSgh
bWFwKSkKPiAgIAkJCXZob3N0X21hcF9wcmVmZXRjaCh2cSwgaSk7Cj4gICAJfQo+IGRpZmYgLS1n
aXQgYS9kcml2ZXJzL3Zob3N0L3Zob3N0LmggYi9kcml2ZXJzL3Zob3N0L3Zob3N0LmgKPiBpbmRl
eCBhOWEyYTkzODU3ZDIuLmY5ZTk1NThhNTI5ZCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL3Zob3N0
L3Zob3N0LmgKPiArKysgYi9kcml2ZXJzL3Zob3N0L3Zob3N0LmgKPiBAQCAtMTE1LDE2ICsxMTUs
MTcgQEAgc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSB7Cj4gICAjaWYgVkhPU1RfQVJDSF9DQU5fQUND
RUxfVUFDQ0VTUwo+ICAgCS8qIFJlYWQgYnkgbWVtb3J5IGFjY2Vzc29ycywgbW9kaWZpZWQgYnkg
bWV0YSBkYXRhCj4gICAJICogcHJlZmV0Y2hpbmcsIE1NVSBub3RpZmllciBhbmQgdnJpbmcgaW9j
dGwoKS4KPiAtCSAqIFN5bmNob25yaXplZCB0aHJvdWdoIG1tdV9sb2NrICh3cml0ZXJzKSBhbmQg
UkNVICh3cml0ZXJzCj4gLQkgKiBhbmQgcmVhZGVycykuCj4gKwkgKiBTeW5jaG9ucml6ZWQgdGhy
b3VnaCBtbXVfbG9jayAod3JpdGVycykgYW5kIHJlZiBjb3VudGVycywKPiArCSAqIHNlZSB2aG9z
dF92cV9hY2Nlc3NfbWFwX2JlZ2luKCkvdmhvc3RfdnFfYWNjZXNzX21hcF9lbmQoKS4KPiAgIAkg
Ki8KPiAtCXN0cnVjdCB2aG9zdF9tYXAgX19yY3UgKm1hcHNbVkhPU1RfTlVNX0FERFJTXTsKPiAr
CXN0cnVjdCB2aG9zdF9tYXAgKm1hcHNbVkhPU1RfTlVNX0FERFJTXTsKPiAgIAkvKiBSZWFkIGJ5
IE1NVSBub3RpZmllciwgbW9kaWZpZWQgYnkgdnJpbmcgaW9jdGwoKSwKPiAgIAkgKiBzeW5jaHJv
bml6ZWQgdGhyb3VnaCBNTVUgbm90aWZpZXIKPiAgIAkgKiByZWdpc3RlcmluZy91bnJlZ2lzdGVy
aW5nLgo+ICAgCSAqLwo+ICAgCXN0cnVjdCB2aG9zdF91YWRkciB1YWRkcnNbVkhPU1RfTlVNX0FE
RFJTXTsKPiAgICNlbmRpZgo+ICsJaW50IHJlZjsKPiAgIAljb25zdCBzdHJ1Y3Qgdmhvc3RfdW1l
bV9ub2RlICptZXRhX2lvdGxiW1ZIT1NUX05VTV9BRERSU107Cj4gICAKPiAgIAlzdHJ1Y3QgZmls
ZSAqa2ljazsKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
VmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZv
dW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL3ZpcnR1YWxpemF0aW9u
