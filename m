Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp1.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id D121D4EBB50
	for <lists.virtualization@lfdr.de>; Wed, 30 Mar 2022 08:58:54 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp1.osuosl.org (Postfix) with ESMTP id 6C177841EF;
	Wed, 30 Mar 2022 06:58:53 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
	by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id vNyShlNX0HL7; Wed, 30 Mar 2022 06:58:52 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp1.osuosl.org (Postfix) with ESMTPS id D4CFB84289;
	Wed, 30 Mar 2022 06:58:51 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 5DFD7C0082;
	Wed, 30 Mar 2022 06:58:51 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp3.osuosl.org (smtp3.osuosl.org [IPv6:2605:bc80:3010::136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id CD375C0012
 for <virtualization@lists.linux-foundation.org>;
 Wed, 30 Mar 2022 06:58:49 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp3.osuosl.org (Postfix) with ESMTP id BA76A611A4
 for <virtualization@lists.linux-foundation.org>;
 Wed, 30 Mar 2022 06:58:49 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Authentication-Results: smtp3.osuosl.org (amavisd-new);
 dkim=pass (1024-bit key) header.d=redhat.com
Received: from smtp3.osuosl.org ([127.0.0.1])
 by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id XqXIWuPEdLHQ
 for <virtualization@lists.linux-foundation.org>;
 Wed, 30 Mar 2022 06:58:48 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.133.124])
 by smtp3.osuosl.org (Postfix) with ESMTPS id C2A5A6118B
 for <virtualization@lists.linux-foundation.org>;
 Wed, 30 Mar 2022 06:58:48 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1648623527;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=92ECpx1YhTW6SvIgZMnvqrIMrjEx51cySdllX2pM5wI=;
 b=B5YXoeYd+jAqrwV96MgQctIwQreMwz4t486DMpXI+p20v+eHVzyFyJdDHwhAk2ufATi9N2
 aR7asjnsO4OrCB7j/OYmbyQIPSzpd4hvYfevSOKYjJSNJEwurwKye0ir5bLXVHCJHEl7G8
 j9rCzy79wm4G3vgAR9yDImX6YT9tZXY=
Received: from mail-lf1-f71.google.com (mail-lf1-f71.google.com
 [209.85.167.71]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 us-mta-594-nJydI2CGMeiVOGezQhopPw-1; Wed, 30 Mar 2022 02:58:46 -0400
X-MC-Unique: nJydI2CGMeiVOGezQhopPw-1
Received: by mail-lf1-f71.google.com with SMTP id
 br39-20020a056512402700b0044a8067917eso2819838lfb.2
 for <virtualization@lists.linux-foundation.org>;
 Tue, 29 Mar 2022 23:58:46 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=92ECpx1YhTW6SvIgZMnvqrIMrjEx51cySdllX2pM5wI=;
 b=3ir39rBrPjehsWfHpcfJPXSaoEGgwWw7AV4EFVXfYGvn6pTiuDNxEvFWKlNp8w/SPV
 uVKnYOufJmTbz2F6ChUSboV2GuRY+OPJGOacPJQXg4g/ymDaWcZA8E7VQiyMnYBemSVG
 qDZZXSMNc3BVNB6zq3mop9lKj5sXLIF+YUGKDekPvpMXaMHYBdtEOnrWUpcLftEKkROK
 USl1T9seQ/AXFQ/CpGM60ijdy+1UauR7bXTB5u5KA8qkk5PHZzghpmIB5b+kP5P2v72q
 msQUsCY8ZmhRXr+9iZWSLZdyls7B/OXOjVBlJfLEtJqggSZw1CnrkiyWoDVI0tH2gtrN
 F68g==
X-Gm-Message-State: AOAM5326tgpiZjSibOcRHDeNVZnuimp8xWXuBvSyU6dJGY6SWR9PSOJ4
 jjyBlYwd8Txo5qn/IY2fAbT73Xmgaqr51cBXBkSYDOO1O/JfCIdYfh5n9sNZZ737KVxhZYKUsyu
 SSW5N4K2RVWUVy4g6qDVe/ig7p/5+jraKBh5Oef/88qPYqagE4nIPlBycKA==
X-Received: by 2002:a05:651c:90a:b0:249:5d82:fe9c with SMTP id
 e10-20020a05651c090a00b002495d82fe9cmr5691468ljq.300.1648623524661; 
 Tue, 29 Mar 2022 23:58:44 -0700 (PDT)
X-Google-Smtp-Source: ABdhPJzNtWLSyhxA+8IYGVXjzS5JU6kYsYZwhbnPQv0WLAwLRkb3tk3w9MmSAHqWIgdez2TyozFV37ifvkZm0TNHhGE=
X-Received: by 2002:a05:651c:90a:b0:249:5d82:fe9c with SMTP id
 e10-20020a05651c090a00b002495d82fe9cmr5691454ljq.300.1648623524358; Tue, 29
 Mar 2022 23:58:44 -0700 (PDT)
MIME-Version: 1.0
References: <20220314093455.34707-1-xuanzhuo@linux.alibaba.com>
 <20220314093455.34707-12-xuanzhuo@linux.alibaba.com>
 <6e3082b6-98df-670f-748c-baae6246211c@redhat.com>
 <1648110531.7509174-2-xuanzhuo@linux.alibaba.com>
 <1a819720-c672-0a53-5a8f-d5b21179bb63@redhat.com>
 <1648620448.1551938-1-xuanzhuo@linux.alibaba.com>
In-Reply-To: <1648620448.1551938-1-xuanzhuo@linux.alibaba.com>
From: Jason Wang <jasowang@redhat.com>
Date: Wed, 30 Mar 2022 14:58:33 +0800
Message-ID: <CACGkMEsNpm_SgkbtnPA0ugmOKQbKd+SVWW9johhEZfkO40+3aw@mail.gmail.com>
Subject: Re: [PATCH v8 11/16] virtio_ring: packed: extract the logic of alloc
 queue
To: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=jasowang@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: virtualization <virtualization@lists.linux-foundation.org>,
 "Michael S. Tsirkin" <mst@redhat.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gV2VkLCBNYXIgMzAsIDIwMjIgYXQgMjoxMyBQTSBYdWFuIFpodW8gPHh1YW56aHVvQGxpbnV4
LmFsaWJhYmEuY29tPiB3cm90ZToKPgo+IE9uIFdlZCwgMzAgTWFyIDIwMjIgMTE6NTA6NDkgKzA4
MDAsIEphc29uIFdhbmcgPGphc293YW5nQHJlZGhhdC5jb20+IHdyb3RlOgo+ID4KPiA+IOWcqCAy
MDIyLzMvMjQg5LiL5Y2INDoyOCwgWHVhbiBaaHVvIOWGmemBkzoKPiA+ID4gT24gVHVlLCAyMiBN
YXIgMjAyMiAxNDozODoxMiArMDgwMCwgSmFzb24gV2FuZyA8amFzb3dhbmdAcmVkaGF0LmNvbT4g
d3JvdGU6Cj4gPiA+PiDlnKggMjAyMi8zLzE0IOS4i+WNiDU6MzQsIFh1YW4gWmh1byDlhpnpgZM6
Cj4gPiA+Pj4gU2VwYXJhdGUgdGhlIGxvZ2ljIG9mIHBhY2tlZCB0byBjcmVhdGUgdnJpbmcgcXVl
dWUuCj4gPiA+Pj4KPiA+ID4+PiBGb3IgdGhlIGNvbnZlbmllbmNlIG9mIHBhc3NpbmcgcGFyYW1l
dGVycywgYWRkIGEgc3RydWN0dXJlCj4gPiA+Pj4gdnJpbmdfcGFja2VkLgo+ID4gPj4+Cj4gPiA+
Pj4gVGhpcyBmZWF0dXJlIGlzIHJlcXVpcmVkIGZvciBzdWJzZXF1ZW50IHZpcnR1cXVldWUgcmVz
ZXQgdnJpbmcuCj4gPiA+Pj4KPiA+ID4+PiBTaWduZWQtb2ZmLWJ5OiBYdWFuIFpodW8gPHh1YW56
aHVvQGxpbnV4LmFsaWJhYmEuY29tPgo+ID4gPj4+IC0tLQo+ID4gPj4+ICAgIGRyaXZlcnMvdmly
dGlvL3ZpcnRpb19yaW5nLmMgfCAxMjEgKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0t
LS0KPiA+ID4+PiAgICAxIGZpbGUgY2hhbmdlZCwgOTIgaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRp
b25zKC0pCj4gPiA+Pj4KPiA+ID4+PiBkaWZmIC0tZ2l0IGEvZHJpdmVycy92aXJ0aW8vdmlydGlv
X3JpbmcuYyBiL2RyaXZlcnMvdmlydGlvL3ZpcnRpb19yaW5nLmMKPiA+ID4+PiBpbmRleCBhMTU4
Njk1MTQxNDYuLjk2ZmYyZGFiZGExNCAxMDA2NDQKPiA+ID4+PiAtLS0gYS9kcml2ZXJzL3ZpcnRp
by92aXJ0aW9fcmluZy5jCj4gPiA+Pj4gKysrIGIvZHJpdmVycy92aXJ0aW8vdmlydGlvX3Jpbmcu
Ywo+ID4gPj4+IEBAIC04NSw2ICs4NSwxOCBAQCBzdHJ1Y3QgdnJpbmdfZGVzY19leHRyYSB7Cj4g
PiA+Pj4gICAgICAgICAgIHUxNiBuZXh0OyAgICAgICAgICAgICAgICAgICAgICAgLyogVGhlIG5l
eHQgZGVzYyBzdGF0ZSBpbiBhIGxpc3QuICovCj4gPiA+Pj4gICAgfTsKPiA+ID4+Pgo+ID4gPj4+
ICtzdHJ1Y3QgdnJpbmdfcGFja2VkIHsKPiA+ID4+PiArIHUzMiBudW07Cj4gPiA+Pj4gKyBzdHJ1
Y3QgdnJpbmdfcGFja2VkX2Rlc2MgKnJpbmc7Cj4gPiA+Pj4gKyBzdHJ1Y3QgdnJpbmdfcGFja2Vk
X2Rlc2NfZXZlbnQgKmRyaXZlcjsKPiA+ID4+PiArIHN0cnVjdCB2cmluZ19wYWNrZWRfZGVzY19l
dmVudCAqZGV2aWNlOwo+ID4gPj4+ICsgZG1hX2FkZHJfdCByaW5nX2RtYV9hZGRyOwo+ID4gPj4+
ICsgZG1hX2FkZHJfdCBkcml2ZXJfZXZlbnRfZG1hX2FkZHI7Cj4gPiA+Pj4gKyBkbWFfYWRkcl90
IGRldmljZV9ldmVudF9kbWFfYWRkcjsKPiA+ID4+PiArIHNpemVfdCByaW5nX3NpemVfaW5fYnl0
ZXM7Cj4gPiA+Pj4gKyBzaXplX3QgZXZlbnRfc2l6ZV9pbl9ieXRlczsKPiA+ID4+PiArfTsKPiA+
ID4+PiArCj4gPiA+Pgo+ID4gPj4gSW50ZXJlc3RpbmcsICBhIG5pdHBpY2sgaGVyZSBpcyB0aGF0
IGlmIGl0IGlzIG9ubHkgdXNlZCBieSBvbmUgaGVscGVyLAo+ID4gPj4gaXQncyBwcm9iYWJseSBu
b3Qgd29ydGggdG8gYm90aGVyLgo+ID4gPgo+ID4gPiBJbmRlZWQgb25seSBvbmUgaGVscGVyIHdp
bGwgdXNlIGl0LiBCZWNhdXNlIHZyaW5nX2FsbG9jX3F1ZXVlX3BhY2tlZCB3aWxsIHBhc3MKPiA+
ID4gdG9vIG1hbnkgdmFyaWFibGVzLiBJZiB3ZSB1c2UgZnVuY3Rpb24gcGFyYW1ldGVycywgSSB0
aGluayB0aGlzIGZ1bmN0aW9uIGlzIHRvbwo+ID4gPiB1Z2x5Lgo+ID4gPgo+ID4gPgo+ID4gPj4g
QW5kIGlmIHdlIHdhbnQgdG8gZG8gdGhhdCwgd2UgbmVlZAo+ID4gPj4KPiA+ID4+IDEpIHVzZSBh
IHNlcGFyYXRlZCBwYXRjaAo+ID4gPiBJZiB3ZSBzcGxpdCB0aGlzIHBhdGNoIGFnYWluLCB3ZSBj
YW4gb25seSBzZXBhcmF0ZSB2cmluZ19mcmVlX3ZyaW5nX3BhY2tlZCgpCj4gPiA+IG91dC4KPiA+
ID4KPiA+ID4+IDIpIGRvIGl0IGZvciBzcGxpdCB2aXJ0cXVldWUgYXMgd2VsbAo+ID4gPiBFYXJs
aWVyIHZlcnNpb25zLCBJIGRpZCBjcmVhdGUgYSBzdHJ1Y3QgZm9yIHNwbGl0IHRvbywgYnV0IHlv
dSByZXBsaWVkIHRoYXQgaXQKPiA+ID4gd2Fzbid0IHdvcnRoIGl0LCBzbyBJIHJlbW92ZWQgdGhl
IHNlcGFyYXRlIHN0cnVjdCB1c2VkIGJ5IHNwbGl0Lgo+ID4KPiA+Cj4gPiBTbyBJIHRoaW5rIGxl
dCdzIGp1c3Qgc3RpY2sgdG8gdGhlIGN1cnJlbnQgc3R5bGUgYnkgcGFzc2luZyBpbmRpdmlkdWFs
Cj4gPiBwYXJhbWV0ZXJzLCBhbmQgd2UgY2FuIHJlZmFjdG9yIGl0IG9uIHRvcCBvZiB0aGlzIHNl
cmllcy4KPiA+Cj4gPiBUaGlzIHdpbGwgbGV0IHVzIHRvIGZvY3VzIG9uIHRoZSBjb3JlIGxvZ2lj
Lgo+Cj4gSSBhbSBpbXBsZW1lbnRpbmcgdGhlIGZ1bmN0aW9uIG9mIHJldXNpbmcgdGhlIGJ1ZmZl
ciBtZW50aW9uZWQgYnkgTWljaGFlbCwgYW5kCj4gYXQgdGhpcyB0aW1lIHRoZXJlIHdpbGwgYmUg
YSBsb3Qgb2YgZGVwZW5kZW5jZSBvbiB0aGlzIHN0cnVjdHVyZS4gQmVjYXVzZSBJCj4gd2FudCB0
byBzYXZlIHNvbWUgaW5mb3JtYXRpb24oZGVzYywgZGVzY19leHRyYSwgZGVzY19zdGV0ZSksIHRo
ZXNlIHN0cnVjdHVyZXMKPiBhcmUgdmVyeSB1c2VmdWwgYXQgdGhpcyB0aW1lLgo+Cj4gVGhlIG9u
bHkgcHJvYmxlbSBpcyB0aGF0IHRoaXMgcGF0Y2ggc2V0IGlzIHRvbyBiaWcuIF5fXgoKT2ssIG5v
dCBhIG11c3QsIGVzcGVjaWFsbHkgaWYgTWljaGFlbCBpcyBmaW5lIHdpdGggdGhpcy4KClRoYW5r
cwoKPgo+IFRoYW5rcy4KPgo+ID4KPiA+IFRoYW5rcwo+ID4KPiA+Cj4gPiA+Cj4gPiA+IFRoYW5r
cy4KPiA+ID4KPiA+ID4+IFRoYW5rcwo+ID4gPj4KPiA+ID4+Cj4gPiA+Pj4gICAgc3RydWN0IHZy
aW5nX3ZpcnRxdWV1ZSB7Cj4gPiA+Pj4gICAgICAgICAgIHN0cnVjdCB2aXJ0cXVldWUgdnE7Cj4g
PiA+Pj4KPiA+ID4+PiBAQCAtMTczNSw0NSArMTc0NywxMDEgQEAgc3RhdGljIHN0cnVjdCB2cmlu
Z19kZXNjX2V4dHJhICp2cmluZ19hbGxvY19kZXNjX2V4dHJhKHVuc2lnbmVkIGludCBudW0pCj4g
PiA+Pj4gICAgICAgICAgIHJldHVybiBkZXNjX2V4dHJhOwo+ID4gPj4+ICAgIH0KPiA+ID4+Pgo+
ID4gPj4+IC1zdGF0aWMgc3RydWN0IHZpcnRxdWV1ZSAqdnJpbmdfY3JlYXRlX3ZpcnRxdWV1ZV9w
YWNrZWQoCj4gPiA+Pj4gLSB1bnNpZ25lZCBpbnQgaW5kZXgsCj4gPiA+Pj4gLSB1bnNpZ25lZCBp
bnQgbnVtLAo+ID4gPj4+IC0gdW5zaWduZWQgaW50IHZyaW5nX2FsaWduLAo+ID4gPj4+IC0gc3Ry
dWN0IHZpcnRpb19kZXZpY2UgKnZkZXYsCj4gPiA+Pj4gLSBib29sIHdlYWtfYmFycmllcnMsCj4g
PiA+Pj4gLSBib29sIG1heV9yZWR1Y2VfbnVtLAo+ID4gPj4+IC0gYm9vbCBjb250ZXh0LAo+ID4g
Pj4+IC0gYm9vbCAoKm5vdGlmeSkoc3RydWN0IHZpcnRxdWV1ZSAqKSwKPiA+ID4+PiAtIHZvaWQg
KCpjYWxsYmFjaykoc3RydWN0IHZpcnRxdWV1ZSAqKSwKPiA+ID4+PiAtIGNvbnN0IGNoYXIgKm5h
bWUpCj4gPiA+Pj4gK3N0YXRpYyB2b2lkIHZyaW5nX2ZyZWVfdnJpbmdfcGFja2VkKHN0cnVjdCB2
cmluZ19wYWNrZWQgKnZyaW5nLAo+ID4gPj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCB2aXJ0aW9fZGV2aWNlICp2ZGV2KQo+ID4gPj4+ICt7Cj4gPiA+Pj4gKyBkbWFfYWRk
cl90IHJpbmdfZG1hX2FkZHIsIGRyaXZlcl9ldmVudF9kbWFfYWRkciwgZGV2aWNlX2V2ZW50X2Rt
YV9hZGRyOwo+ID4gPj4+ICsgc3RydWN0IHZyaW5nX3BhY2tlZF9kZXNjX2V2ZW50ICpkcml2ZXIs
ICpkZXZpY2U7Cj4gPiA+Pj4gKyBzaXplX3QgcmluZ19zaXplX2luX2J5dGVzLCBldmVudF9zaXpl
X2luX2J5dGVzOwo+ID4gPj4+ICsgc3RydWN0IHZyaW5nX3BhY2tlZF9kZXNjICpyaW5nOwo+ID4g
Pj4+ICsKPiA+ID4+PiArIHJpbmcgICAgICAgICAgICAgICAgICA9IHZyaW5nLT5yaW5nOwo+ID4g
Pj4+ICsgZHJpdmVyICAgICAgICAgICAgICAgID0gdnJpbmctPmRyaXZlcjsKPiA+ID4+PiArIGRl
dmljZSAgICAgICAgICAgICAgICA9IHZyaW5nLT5kZXZpY2U7Cj4gPiA+Pj4gKyByaW5nX3NpemVf
aW5fYnl0ZXMgICAgPSB2cmluZy0+cmluZ19zaXplX2luX2J5dGVzOwo+ID4gPj4+ICsgZXZlbnRf
c2l6ZV9pbl9ieXRlcyAgID0gdnJpbmctPmV2ZW50X3NpemVfaW5fYnl0ZXM7Cj4gPiA+Pj4gKyBy
aW5nX2RtYV9hZGRyICAgICAgICAgPSB2cmluZy0+cmluZ19kbWFfYWRkcjsKPiA+ID4+PiArIGRy
aXZlcl9ldmVudF9kbWFfYWRkciA9IHZyaW5nLT5kcml2ZXJfZXZlbnRfZG1hX2FkZHI7Cj4gPiA+
Pj4gKyBkZXZpY2VfZXZlbnRfZG1hX2FkZHIgPSB2cmluZy0+ZGV2aWNlX2V2ZW50X2RtYV9hZGRy
Owo+ID4gPj4+ICsKPiA+ID4+PiArIGlmIChkZXZpY2UpCj4gPiA+Pj4gKyAgICAgICAgIHZyaW5n
X2ZyZWVfcXVldWUodmRldiwgZXZlbnRfc2l6ZV9pbl9ieXRlcywgZGV2aWNlLCBkZXZpY2VfZXZl
bnRfZG1hX2FkZHIpOwo+ID4gPj4+ICsKPiA+ID4+PiArIGlmIChkcml2ZXIpCj4gPiA+Pj4gKyAg
ICAgICAgIHZyaW5nX2ZyZWVfcXVldWUodmRldiwgZXZlbnRfc2l6ZV9pbl9ieXRlcywgZHJpdmVy
LCBkcml2ZXJfZXZlbnRfZG1hX2FkZHIpOwo+ID4gPj4+ICsKPiA+ID4+PiArIGlmIChyaW5nKQo+
ID4gPj4+ICsgICAgICAgICB2cmluZ19mcmVlX3F1ZXVlKHZkZXYsIHJpbmdfc2l6ZV9pbl9ieXRl
cywgcmluZywgcmluZ19kbWFfYWRkcik7Cj4gPiA+Pj4gK30KPiA+ID4+PiArCj4gPiA+Pj4gK3N0
YXRpYyBpbnQgdnJpbmdfYWxsb2NfcXVldWVfcGFja2VkKHN0cnVjdCB2cmluZ19wYWNrZWQgKnZy
aW5nLAo+ID4gPj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9f
ZGV2aWNlICp2ZGV2LAo+ID4gPj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUzMiBu
dW0pCj4gPiA+Pj4gICAgewo+ID4gPj4+IC0gc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAqdnE7Cj4g
PiA+Pj4gICAgICAgICAgIHN0cnVjdCB2cmluZ19wYWNrZWRfZGVzYyAqcmluZzsKPiA+ID4+PiAg
ICAgICAgICAgc3RydWN0IHZyaW5nX3BhY2tlZF9kZXNjX2V2ZW50ICpkcml2ZXIsICpkZXZpY2U7
Cj4gPiA+Pj4gICAgICAgICAgIGRtYV9hZGRyX3QgcmluZ19kbWFfYWRkciwgZHJpdmVyX2V2ZW50
X2RtYV9hZGRyLCBkZXZpY2VfZXZlbnRfZG1hX2FkZHI7Cj4gPiA+Pj4gICAgICAgICAgIHNpemVf
dCByaW5nX3NpemVfaW5fYnl0ZXMsIGV2ZW50X3NpemVfaW5fYnl0ZXM7Cj4gPiA+Pj4KPiA+ID4+
PiArIG1lbXNldCh2cmluZywgMCwgc2l6ZW9mKCp2cmluZykpOwo+ID4gPj4+ICsKPiA+ID4+PiAg
ICAgICAgICAgcmluZ19zaXplX2luX2J5dGVzID0gbnVtICogc2l6ZW9mKHN0cnVjdCB2cmluZ19w
YWNrZWRfZGVzYyk7Cj4gPiA+Pj4KPiA+ID4+PiAgICAgICAgICAgcmluZyA9IHZyaW5nX2FsbG9j
X3F1ZXVlKHZkZXYsIHJpbmdfc2l6ZV9pbl9ieXRlcywKPiA+ID4+PiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICZyaW5nX2RtYV9hZGRyLAo+ID4gPj4+ICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgR0ZQX0tFUk5FTHxfX0dGUF9OT1dBUk58X19HRlBfWkVSTyk7
Cj4gPiA+Pj4gICAgICAgICAgIGlmICghcmluZykKPiA+ID4+PiAtICAgICAgICAgZ290byBlcnJf
cmluZzsKPiA+ID4+PiArICAgICAgICAgZ290byBlcnI7Cj4gPiA+Pj4gKwo+ID4gPj4+ICsgdnJp
bmctPm51bSA9IG51bTsKPiA+ID4+PiArIHZyaW5nLT5yaW5nID0gcmluZzsKPiA+ID4+PiArIHZy
aW5nLT5yaW5nX3NpemVfaW5fYnl0ZXMgPSByaW5nX3NpemVfaW5fYnl0ZXM7Cj4gPiA+Pj4gKyB2
cmluZy0+cmluZ19kbWFfYWRkciA9IHJpbmdfZG1hX2FkZHI7Cj4gPiA+Pj4KPiA+ID4+PiAgICAg
ICAgICAgZXZlbnRfc2l6ZV9pbl9ieXRlcyA9IHNpemVvZihzdHJ1Y3QgdnJpbmdfcGFja2VkX2Rl
c2NfZXZlbnQpOwo+ID4gPj4+ICsgdnJpbmctPmV2ZW50X3NpemVfaW5fYnl0ZXMgPSBldmVudF9z
aXplX2luX2J5dGVzOwo+ID4gPj4+Cj4gPiA+Pj4gICAgICAgICAgIGRyaXZlciA9IHZyaW5nX2Fs
bG9jX3F1ZXVlKHZkZXYsIGV2ZW50X3NpemVfaW5fYnl0ZXMsCj4gPiA+Pj4gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICZkcml2ZXJfZXZlbnRfZG1hX2FkZHIsCj4gPiA+Pj4g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdGUF9LRVJORUx8X19HRlBfTk9X
QVJOfF9fR0ZQX1pFUk8pOwo+ID4gPj4+ICAgICAgICAgICBpZiAoIWRyaXZlcikKPiA+ID4+PiAt
ICAgICAgICAgZ290byBlcnJfZHJpdmVyOwo+ID4gPj4+ICsgICAgICAgICBnb3RvIGVycjsKPiA+
ID4+PiArCj4gPiA+Pj4gKyB2cmluZy0+ZHJpdmVyID0gZHJpdmVyOwo+ID4gPj4+ICsgdnJpbmct
PmRyaXZlcl9ldmVudF9kbWFfYWRkciA9IGRyaXZlcl9ldmVudF9kbWFfYWRkcjsKPiA+ID4+Pgo+
ID4gPj4+ICAgICAgICAgICBkZXZpY2UgPSB2cmluZ19hbGxvY19xdWV1ZSh2ZGV2LCBldmVudF9z
aXplX2luX2J5dGVzLAo+ID4gPj4+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmZGV2aWNlX2V2ZW50X2RtYV9hZGRyLAo+ID4gPj4+ICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBHRlBfS0VSTkVMfF9fR0ZQX05PV0FSTnxfX0dGUF9aRVJPKTsKPiA+ID4+
PiAgICAgICAgICAgaWYgKCFkZXZpY2UpCj4gPiA+Pj4gLSAgICAgICAgIGdvdG8gZXJyX2Rldmlj
ZTsKPiA+ID4+PiArICAgICAgICAgZ290byBlcnI7Cj4gPiA+Pj4gKwo+ID4gPj4+ICsgdnJpbmct
PmRldmljZSA9IGRldmljZTsKPiA+ID4+PiArIHZyaW5nLT5kZXZpY2VfZXZlbnRfZG1hX2FkZHIg
PSBkZXZpY2VfZXZlbnRfZG1hX2FkZHI7Cj4gPiA+Pj4gKyByZXR1cm4gMDsKPiA+ID4+PiArCj4g
PiA+Pj4gK2VycjoKPiA+ID4+PiArIHZyaW5nX2ZyZWVfdnJpbmdfcGFja2VkKHZyaW5nLCB2ZGV2
KTsKPiA+ID4+PiArIHJldHVybiAtRU5PTUVNOwo+ID4gPj4+ICt9Cj4gPiA+Pj4gKwo+ID4gPj4+
ICtzdGF0aWMgc3RydWN0IHZpcnRxdWV1ZSAqdnJpbmdfY3JlYXRlX3ZpcnRxdWV1ZV9wYWNrZWQo
Cj4gPiA+Pj4gKyB1bnNpZ25lZCBpbnQgaW5kZXgsCj4gPiA+Pj4gKyB1bnNpZ25lZCBpbnQgbnVt
LAo+ID4gPj4+ICsgdW5zaWduZWQgaW50IHZyaW5nX2FsaWduLAo+ID4gPj4+ICsgc3RydWN0IHZp
cnRpb19kZXZpY2UgKnZkZXYsCj4gPiA+Pj4gKyBib29sIHdlYWtfYmFycmllcnMsCj4gPiA+Pj4g
KyBib29sIG1heV9yZWR1Y2VfbnVtLAo+ID4gPj4+ICsgYm9vbCBjb250ZXh0LAo+ID4gPj4+ICsg
Ym9vbCAoKm5vdGlmeSkoc3RydWN0IHZpcnRxdWV1ZSAqKSwKPiA+ID4+PiArIHZvaWQgKCpjYWxs
YmFjaykoc3RydWN0IHZpcnRxdWV1ZSAqKSwKPiA+ID4+PiArIGNvbnN0IGNoYXIgKm5hbWUpCj4g
PiA+Pj4gK3sKPiA+ID4+PiArIHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxOwo+ID4gPj4+ICsg
c3RydWN0IHZyaW5nX3BhY2tlZCB2cmluZzsKPiA+ID4+PiArCj4gPiA+Pj4gKyBpZiAodnJpbmdf
YWxsb2NfcXVldWVfcGFja2VkKCZ2cmluZywgdmRldiwgbnVtKSkKPiA+ID4+PiArICAgICAgICAg
Z290byBlcnJfdnE7Cj4gPiA+Pj4KPiA+ID4+PiAgICAgICAgICAgdnEgPSBrbWFsbG9jKHNpemVv
ZigqdnEpLCBHRlBfS0VSTkVMKTsKPiA+ID4+PiAgICAgICAgICAgaWYgKCF2cSkKPiA+ID4+PiBA
QCAtMTgwNSwxNyArMTg3MywxNyBAQCBzdGF0aWMgc3RydWN0IHZpcnRxdWV1ZSAqdnJpbmdfY3Jl
YXRlX3ZpcnRxdWV1ZV9wYWNrZWQoCj4gPiA+Pj4gICAgICAgICAgIGlmICh2aXJ0aW9faGFzX2Zl
YXR1cmUodmRldiwgVklSVElPX0ZfT1JERVJfUExBVEZPUk0pKQo+ID4gPj4+ICAgICAgICAgICAg
ICAgICAgIHZxLT53ZWFrX2JhcnJpZXJzID0gZmFsc2U7Cj4gPiA+Pj4KPiA+ID4+PiAtIHZxLT5w
YWNrZWQucmluZ19kbWFfYWRkciA9IHJpbmdfZG1hX2FkZHI7Cj4gPiA+Pj4gLSB2cS0+cGFja2Vk
LmRyaXZlcl9ldmVudF9kbWFfYWRkciA9IGRyaXZlcl9ldmVudF9kbWFfYWRkcjsKPiA+ID4+PiAt
IHZxLT5wYWNrZWQuZGV2aWNlX2V2ZW50X2RtYV9hZGRyID0gZGV2aWNlX2V2ZW50X2RtYV9hZGRy
Owo+ID4gPj4+ICsgdnEtPnBhY2tlZC5yaW5nX2RtYV9hZGRyID0gdnJpbmcucmluZ19kbWFfYWRk
cjsKPiA+ID4+PiArIHZxLT5wYWNrZWQuZHJpdmVyX2V2ZW50X2RtYV9hZGRyID0gdnJpbmcuZHJp
dmVyX2V2ZW50X2RtYV9hZGRyOwo+ID4gPj4+ICsgdnEtPnBhY2tlZC5kZXZpY2VfZXZlbnRfZG1h
X2FkZHIgPSB2cmluZy5kZXZpY2VfZXZlbnRfZG1hX2FkZHI7Cj4gPiA+Pj4KPiA+ID4+PiAtIHZx
LT5wYWNrZWQucmluZ19zaXplX2luX2J5dGVzID0gcmluZ19zaXplX2luX2J5dGVzOwo+ID4gPj4+
IC0gdnEtPnBhY2tlZC5ldmVudF9zaXplX2luX2J5dGVzID0gZXZlbnRfc2l6ZV9pbl9ieXRlczsK
PiA+ID4+PiArIHZxLT5wYWNrZWQucmluZ19zaXplX2luX2J5dGVzID0gdnJpbmcucmluZ19zaXpl
X2luX2J5dGVzOwo+ID4gPj4+ICsgdnEtPnBhY2tlZC5ldmVudF9zaXplX2luX2J5dGVzID0gdnJp
bmcuZXZlbnRfc2l6ZV9pbl9ieXRlczsKPiA+ID4+Pgo+ID4gPj4+ICAgICAgICAgICB2cS0+cGFj
a2VkLnZyaW5nLm51bSA9IG51bTsKPiA+ID4+PiAtIHZxLT5wYWNrZWQudnJpbmcuZGVzYyA9IHJp
bmc7Cj4gPiA+Pj4gLSB2cS0+cGFja2VkLnZyaW5nLmRyaXZlciA9IGRyaXZlcjsKPiA+ID4+PiAt
IHZxLT5wYWNrZWQudnJpbmcuZGV2aWNlID0gZGV2aWNlOwo+ID4gPj4+ICsgdnEtPnBhY2tlZC52
cmluZy5kZXNjID0gdnJpbmcucmluZzsKPiA+ID4+PiArIHZxLT5wYWNrZWQudnJpbmcuZHJpdmVy
ID0gdnJpbmcuZHJpdmVyOwo+ID4gPj4+ICsgdnEtPnBhY2tlZC52cmluZy5kZXZpY2UgPSB2cmlu
Zy5kZXZpY2U7Cj4gPiA+Pj4KPiA+ID4+PiAgICAgICAgICAgdnEtPnBhY2tlZC5uZXh0X2F2YWls
X2lkeCA9IDA7Cj4gPiA+Pj4gICAgICAgICAgIHZxLT5wYWNrZWQuYXZhaWxfd3JhcF9jb3VudGVy
ID0gMTsKPiA+ID4+PiBAQCAtMTg1NiwxMiArMTkyNCw3IEBAIHN0YXRpYyBzdHJ1Y3QgdmlydHF1
ZXVlICp2cmluZ19jcmVhdGVfdmlydHF1ZXVlX3BhY2tlZCgKPiA+ID4+PiAgICBlcnJfZGVzY19z
dGF0ZToKPiA+ID4+PiAgICAgICAgICAga2ZyZWUodnEpOwo+ID4gPj4+ICAgIGVycl92cToKPiA+
ID4+PiAtIHZyaW5nX2ZyZWVfcXVldWUodmRldiwgZXZlbnRfc2l6ZV9pbl9ieXRlcywgZGV2aWNl
LCBkZXZpY2VfZXZlbnRfZG1hX2FkZHIpOwo+ID4gPj4+IC1lcnJfZGV2aWNlOgo+ID4gPj4+IC0g
dnJpbmdfZnJlZV9xdWV1ZSh2ZGV2LCBldmVudF9zaXplX2luX2J5dGVzLCBkcml2ZXIsIGRyaXZl
cl9ldmVudF9kbWFfYWRkcik7Cj4gPiA+Pj4gLWVycl9kcml2ZXI6Cj4gPiA+Pj4gLSB2cmluZ19m
cmVlX3F1ZXVlKHZkZXYsIHJpbmdfc2l6ZV9pbl9ieXRlcywgcmluZywgcmluZ19kbWFfYWRkcik7
Cj4gPiA+Pj4gLWVycl9yaW5nOgo+ID4gPj4+ICsgdnJpbmdfZnJlZV92cmluZ19wYWNrZWQoJnZy
aW5nLCB2ZGV2KTsKPiA+ID4+PiAgICAgICAgICAgcmV0dXJuIE5VTEw7Cj4gPiA+Pj4gICAgfQo+
ID4gPj4+Cj4gPgo+CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGlu
dXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxt
YW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
