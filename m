Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp2.osuosl.org (smtp2.osuosl.org [IPv6:2605:bc80:3010::133])
	by mail.lfdr.de (Postfix) with ESMTPS id A4AA27BD998
	for <lists.virtualization@lfdr.de>; Mon,  9 Oct 2023 13:25:26 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp2.osuosl.org (Postfix) with ESMTP id 33E10414EC;
	Mon,  9 Oct 2023 11:25:25 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org 33E10414EC
Authentication-Results: smtp2.osuosl.org;
	dkim=fail reason="signature verification failed" (2048-bit key, unprotected) header.d=Nvidia.com header.i=@Nvidia.com header.a=rsa-sha256 header.s=selector2 header.b=OiP1unnF
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
	by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id D-ZD8ziPGcQs; Mon,  9 Oct 2023 11:25:24 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp2.osuosl.org (Postfix) with ESMTPS id A10734150D;
	Mon,  9 Oct 2023 11:25:23 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org A10734150D
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id E2DE9C0DD3;
	Mon,  9 Oct 2023 11:25:22 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 2D319C0032
 for <virtualization@lists.linux-foundation.org>;
 Mon,  9 Oct 2023 11:25:20 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id EFD8282017
 for <virtualization@lists.linux-foundation.org>;
 Mon,  9 Oct 2023 11:25:19 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org EFD8282017
Authentication-Results: smtp1.osuosl.org; dkim=pass (2048-bit key,
 unprotected) header.d=Nvidia.com header.i=@Nvidia.com header.a=rsa-sha256
 header.s=selector2 header.b=OiP1unnF
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id UpsifFmj8E4J
 for <virtualization@lists.linux-foundation.org>;
 Mon,  9 Oct 2023 11:25:18 +0000 (UTC)
Received: from NAM02-BN1-obe.outbound.protection.outlook.com
 (mail-bn1nam02on2060f.outbound.protection.outlook.com
 [IPv6:2a01:111:f400:7eb2::60f])
 by smtp1.osuosl.org (Postfix) with ESMTPS id 95CBF82016
 for <virtualization@lists.linux-foundation.org>;
 Mon,  9 Oct 2023 11:25:18 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 95CBF82016
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=iYb0bmiZCZWRv3iAcPVEflNhhGrwZ1OjGEbafYUYZGe1r5QPmUl7s1ieSejjlEx9A21iTTZ0FW4vvs32p+pX0pxdZ3VQHWa/y4+3+v16zEbbalWnLHyXDkzeIqd7FEBcrFLNGyiyt9LYMNms54bf977SXArkZeWxDzLDwbUa68Uj6esNrL0+dGcazZfjMZC9J9dHnf1br7GHlxqJCY9UWQWjdTfOfFuqC9+aKG53lQYchGEcFSsAUnZITON/M9Kq6TG9KYCuaB5zjSsThUkDorGegXx9EgjInLl6s00NRtzB6brcrLuytQwjb/sxYhyRzEVvhkaVnoakfmJA6XMzOw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=7jjiNTy8al6/zLsHEFtY10NWCOwo4c2oncU7C5mb/4Q=;
 b=Yvjvla3Jb8OsDg3bLGAklqiXxW9k0eK/Q37CRRJyiTwGk2ArSDBHq2IAvWpOrpxtVmmPFD4eEvlPNs2nSA+FSwK182sqKUilKKn2/QAgNe11Dpq6hp09R4E7BUY5nCbv6uoceGYg5kLYtyrrGx3Li4Cp4RACP7+zDbXxvyyHbEFtN9VV//5rPlnZ2dPfRyMuFfwlFuXbnGxIHVQvCYPLRRdZ3Cowf6RNmWTfl6CkUwirdVPHze/fwjVHTSrpCU+8wBq8Gn3yh1BwnUWUpnWUMFijEKXF0wI7gUlG/rGTA4g3cN7T4YDA/fZm8GZ9sLo/SW7mXqpvkK//RFCAit3z6g==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass (sender ip is
 216.228.117.161) smtp.rcpttodomain=redhat.com smtp.mailfrom=nvidia.com;
 dmarc=pass (p=reject sp=reject pct=100) action=none header.from=nvidia.com;
 dkim=none (message not signed); arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=Nvidia.com;
 s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=7jjiNTy8al6/zLsHEFtY10NWCOwo4c2oncU7C5mb/4Q=;
 b=OiP1unnFlgWkvBiyDlDeLDTLgXoejKcu+yxEyuKg5jjpPdqAQsQxsAguNE8UxUTkXqqEb5acBC+pdORadsT5+aqm0L4/bulka+dfcanqPy8N0HkgQWebPl3GLRswvoStAcd3b6DLn4EOsN1B9o14X6nkY2L+XXoW9K2x2+wR7KTqYRjOoN89kRmWjMYk45WzkWMRDHFSWF7CTQrjT4IA1pSOPjxAYOIkn7u0vFfERQUsYUKbeBy8vOBizdrMVB+hPN90oBVRXzJD9qWkD3kZykDgqx7yMLIAvJybqvRnrdsral8SZo7WxX76dstMtAuYb7iz6ctOV3DvcCnkfqFZOw==
Received: from MN2PR13CA0024.namprd13.prod.outlook.com (2603:10b6:208:160::37)
 by LV2PR12MB5920.namprd12.prod.outlook.com (2603:10b6:408:172::20)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.6838.41; Mon, 9 Oct
 2023 11:25:15 +0000
Received: from MN1PEPF0000ECD6.namprd02.prod.outlook.com
 (2603:10b6:208:160:cafe::7f) by MN2PR13CA0024.outlook.office365.com
 (2603:10b6:208:160::37) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.6886.21 via Frontend
 Transport; Mon, 9 Oct 2023 11:25:15 +0000
X-MS-Exchange-Authentication-Results: spf=pass (sender IP is 216.228.117.161)
 smtp.mailfrom=nvidia.com;
 dkim=none (message not signed)
 header.d=none;dmarc=pass action=none header.from=nvidia.com;
Received-SPF: Pass (protection.outlook.com: domain of nvidia.com designates
 216.228.117.161 as permitted sender) receiver=protection.outlook.com;
 client-ip=216.228.117.161; helo=mail.nvidia.com; pr=C
Received: from mail.nvidia.com (216.228.117.161) by
 MN1PEPF0000ECD6.mail.protection.outlook.com (10.167.242.135) with Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.6838.14 via Frontend Transport; Mon, 9 Oct 2023 11:25:15 +0000
Received: from rnnvmail203.nvidia.com (10.129.68.9) by mail.nvidia.com
 (10.129.200.67) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.2.986.41; Mon, 9 Oct 2023
 04:25:02 -0700
Received: from rnnvmail204.nvidia.com (10.129.68.6) by rnnvmail203.nvidia.com
 (10.129.68.9) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.2.986.41; Mon, 9 Oct 2023
 04:25:01 -0700
Received: from c-237-113-220-225.mtl.labs.mlnx (10.127.8.12) by
 mail.nvidia.com (10.129.68.6) with Microsoft SMTP Server id 15.2.986.41 via
 Frontend Transport; Mon, 9 Oct 2023 04:24:58 -0700
To: "Michael S . Tsirkin" <mst@redhat.com>, Jason Wang <jasowang@redhat.com>, 
 Eugenio Perez Martin <eperezma@redhat.com>, Si-Wei Liu
 <si-wei.liu@oracle.com>, Saeed Mahameed <saeedm@nvidia.com>, Leon Romanovsky
 <leon@kernel.org>, <virtualization@lists.linux-foundation.org>
Subject: [PATCH vhost v3 12/16] vdpa/mlx5: Improve mr update flow
Date: Mon, 9 Oct 2023 14:23:57 +0300
Message-ID: <20231009112401.1060447-13-dtatulea@nvidia.com>
X-Mailer: git-send-email 2.41.0
In-Reply-To: <20231009112401.1060447-1-dtatulea@nvidia.com>
References: <20231009112401.1060447-1-dtatulea@nvidia.com>
MIME-Version: 1.0
X-NV-OnPremToCloud: ExternallySecured
X-EOPAttributedMessage: 0
X-MS-PublicTrafficType: Email
X-MS-TrafficTypeDiagnostic: MN1PEPF0000ECD6:EE_|LV2PR12MB5920:EE_
X-MS-Office365-Filtering-Correlation-Id: 9d5f6010-9dfb-4f39-beb7-08dbc8ba693c
X-MS-Exchange-SenderADCheck: 1
X-MS-Exchange-AntiSpam-Relay: 0
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: l/ypnURB6iT7rw4XEPZ6fg+HgjfkVsC/D/Fcej266zdjTReOOtIWCN5MrlxzOzuwiORmzt4xubKTeGkNB5eC5yPO7Q86lNdEr9Kjvja+P6rFIFX3LTEbuqz4xs+OlU7rJ09vpQnF3qXUDv6BZPtSCRKXKTXJsurWkrAiHYWSWjudrJhbLNErIYVgxztatnfkNvrQ5jWpIgJgarDEPIx7MzzFzmidHXkqqBQ+Dg8cc5UpaHRmmNvz3pZmkaLyOMpn3psMxIKvWI6uD/WiCITOWkwnQKr/RDxwOv5osvlj2UZJSZKwtpPH4Z/QQL7nqHcZ4GvMa+wbQjc7wV5uB78Qc5c5QwxvwPqTG25baZALbhPlhN/VpQ315dUwu/WSF5eOo5k7WnoJkHGt7M56pwtmBl09na7bxobyorvJOXyWtTEmR0GZxmc5iA+0vSRZtSwmt3s5C0MR8U1ZkOR5dSRd3KP5oWnetH2ywIIHcvTMowwK0ZO9d+jXBPN7fI3X4385x9iE4y2tC3OsSkUFIIiCVOce4t4QyzTaVsRrk/GdPvEDKZoY22BYp/BVZ32WqVU8mryXQ11yrb6Lkrv2+7PebE43xFJUHBFFBNzvEjze7VjdW6/gkBlWO/Qnuo5y4e5eFULU1bA7Wv3197xwbrs1Hj6JOyEAgPZlhZJsUs3fPqSSU49vko1Pb9vC3kfJ7VxN/kMRpletiWeVwm8ZZwJqNcaMLrG4QZi9QvAceiMmY0Y=
X-Forefront-Antispam-Report: CIP:216.228.117.161; CTRY:US; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:mail.nvidia.com; PTR:dc6edge2.nvidia.com; CAT:NONE;
 SFS:(13230031)(4636009)(136003)(396003)(346002)(39860400002)(376002)(230922051799003)(186009)(451199024)(64100799003)(82310400011)(1800799009)(46966006)(36840700001)(356005)(86362001)(7636003)(36756003)(2906002)(41300700001)(15650500001)(8676002)(5660300002)(8936002)(40480700001)(478600001)(4326008)(1076003)(2616005)(83380400001)(70586007)(70206006)(316002)(82740400003)(110136005)(336012)(426003)(36860700001)(26005)(66574015)(54906003)(47076005)(334744004);
 DIR:OUT; SFP:1101; 
X-OriginatorOrg: Nvidia.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 09 Oct 2023 11:25:15.6086 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 9d5f6010-9dfb-4f39-beb7-08dbc8ba693c
X-MS-Exchange-CrossTenant-Id: 43083d15-7273-40c1-b7db-39efd9ccc17a
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=43083d15-7273-40c1-b7db-39efd9ccc17a; Ip=[216.228.117.161];
 Helo=[mail.nvidia.com]
X-MS-Exchange-CrossTenant-AuthSource: MN1PEPF0000ECD6.namprd02.prod.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Anonymous
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: LV2PR12MB5920
Cc: Xuan Zhuo <xuanzhuo@linux.alibaba.com>, kvm@vger.kernel.org,
 linux-kernel@vger.kernel.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
From: Dragos Tatulea via Virtualization
 <virtualization@lists.linux-foundation.org>
Reply-To: Dragos Tatulea <dtatulea@nvidia.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhlIGN1cnJlbnQgZmxvdyBmb3IgdXBkYXRpbmcgYW4gbXIgd29ya3MgZGlyZWN0bHkgb24gbXZk
ZXYtPm1yIHdoaWNoCm1ha2VzIGl0IGN1bWJlcnNvbWUgdG8gaGFuZGxlIG11bHRpcGxlIG5ldyBt
ciBzdHJ1Y3RzLgoKVGhpcyBwYXRjaCBtYWtlcyB0aGUgZmxvdyBtb3JlIHN0cmFpZ2h0Zm9yd2Fy
ZCBieSBoYXZpbmcKbWx4NV92ZHBhX2NyZWF0ZV9tciByZXR1cm4gYSBuZXcgbXIgd2hpY2ggd2ls
bCB1cGRhdGUgdGhlIG9sZCBtciAoaWYKYW55KS4gVGhlIG9sZCBtciB3aWxsIGJlIGRlbGV0ZWQg
YW5kIHVubGlua2VkIGZyb20gbXZkZXYuCgpUaGlzIGNoYW5nZSBwYXZlcyB0aGUgd2F5IGZvciBh
ZGRpbmcgbXJzIGZvciBkaWZmZXJlbnQgQVNJRHMuCgpUaGUgaW5pdGlhbGl6ZWQgYm9vbCBpcyBu
byBsb25nZXIgbmVlZGVkIGFzIG1yIGlzIG5vdyBhIHBvaW50ZXIgaW4gdGhlCm1seDVfdmRwYV9k
ZXYgc3RydWN0IHdoaWNoIHdpbGwgYmUgTlVMTCB3aGVuIG5vdCBpbml0aWFsaXplZC4KCkFja2Vk
LWJ5OiBFdWdlbmlvIFDDqXJleiA8ZXBlcmV6bWFAcmVkaGF0LmNvbT4KU2lnbmVkLW9mZi1ieTog
RHJhZ29zIFRhdHVsZWEgPGR0YXR1bGVhQG52aWRpYS5jb20+Ci0tLQogZHJpdmVycy92ZHBhL21s
eDUvY29yZS9tbHg1X3ZkcGEuaCB8IDE0ICsrKy0tCiBkcml2ZXJzL3ZkcGEvbWx4NS9jb3JlL21y
LmMgICAgICAgIHwgODcgKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL3Zk
cGEvbWx4NS9uZXQvbWx4NV92bmV0LmMgIHwgNDYgKysrKysrKystLS0tLS0tLQogMyBmaWxlcyBj
aGFuZ2VkLCA3NiBpbnNlcnRpb25zKCspLCA3MSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL3ZkcGEvbWx4NS9jb3JlL21seDVfdmRwYS5oIGIvZHJpdmVycy92ZHBhL21seDUvY29y
ZS9tbHg1X3ZkcGEuaAppbmRleCA5YzZhYzQyYzIxZTEuLmJiZTQzMzUxMDZiZCAxMDA2NDQKLS0t
IGEvZHJpdmVycy92ZHBhL21seDUvY29yZS9tbHg1X3ZkcGEuaAorKysgYi9kcml2ZXJzL3ZkcGEv
bWx4NS9jb3JlL21seDVfdmRwYS5oCkBAIC0zMSw4ICszMSw2IEBAIHN0cnVjdCBtbHg1X3ZkcGFf
bXIgewogCXN0cnVjdCBsaXN0X2hlYWQgaGVhZDsKIAl1bnNpZ25lZCBsb25nIG51bV9kaXJlY3Rz
OwogCXVuc2lnbmVkIGxvbmcgbnVtX2tsbXM7Ci0JLyogc3RhdGUgb2YgZHZxIG1yICovCi0JYm9v
bCBpbml0aWFsaXplZDsKIAogCWJvb2wgdXNlcl9tcjsKIH07CkBAIC05MSw3ICs4OSw3IEBAIHN0
cnVjdCBtbHg1X3ZkcGFfZGV2IHsKIAl1MTYgbWF4X2lkeDsKIAl1MzIgZ2VuZXJhdGlvbjsKIAot
CXN0cnVjdCBtbHg1X3ZkcGFfbXIgbXI7CisJc3RydWN0IG1seDVfdmRwYV9tciAqbXI7CiAJLyog
c2VyaWFsaXplIG1yIGFjY2VzcyAqLwogCXN0cnVjdCBtdXRleCBtcl9tdHg7CiAJc3RydWN0IG1s
eDVfY29udHJvbF92cSBjdnE7CkBAIC0xMTQsMTQgKzExMiwxNCBAQCB2b2lkIG1seDVfdmRwYV9m
cmVlX3Jlc291cmNlcyhzdHJ1Y3QgbWx4NV92ZHBhX2RldiAqbXZkZXYpOwogaW50IG1seDVfdmRw
YV9jcmVhdGVfbWtleShzdHJ1Y3QgbWx4NV92ZHBhX2RldiAqbXZkZXYsIHUzMiAqbWtleSwgdTMy
ICppbiwKIAkJCSAgaW50IGlubGVuKTsKIGludCBtbHg1X3ZkcGFfZGVzdHJveV9ta2V5KHN0cnVj
dCBtbHg1X3ZkcGFfZGV2ICptdmRldiwgdTMyIG1rZXkpOwotaW50IG1seDVfdmRwYV9oYW5kbGVf
c2V0X21hcChzdHJ1Y3QgbWx4NV92ZHBhX2RldiAqbXZkZXYsIHN0cnVjdCB2aG9zdF9pb3RsYiAq
aW90bGIsCi0JCQkgICAgIGJvb2wgKmNoYW5nZV9tYXAsIHVuc2lnbmVkIGludCBhc2lkKTsKLWlu
dCBtbHg1X3ZkcGFfY3JlYXRlX21yKHN0cnVjdCBtbHg1X3ZkcGFfZGV2ICptdmRldiwKLQkJCXN0
cnVjdCBtbHg1X3ZkcGFfbXIgKm1yLAotCQkJc3RydWN0IHZob3N0X2lvdGxiICppb3RsYik7Citz
dHJ1Y3QgbWx4NV92ZHBhX21yICptbHg1X3ZkcGFfY3JlYXRlX21yKHN0cnVjdCBtbHg1X3ZkcGFf
ZGV2ICptdmRldiwKKwkJCQkJIHN0cnVjdCB2aG9zdF9pb3RsYiAqaW90bGIpOwogdm9pZCBtbHg1
X3ZkcGFfZGVzdHJveV9tcl9yZXNvdXJjZXMoc3RydWN0IG1seDVfdmRwYV9kZXYgKm12ZGV2KTsK
IHZvaWQgbWx4NV92ZHBhX2Rlc3Ryb3lfbXIoc3RydWN0IG1seDVfdmRwYV9kZXYgKm12ZGV2LAog
CQkJICBzdHJ1Y3QgbWx4NV92ZHBhX21yICptcik7Cit2b2lkIG1seDVfdmRwYV91cGRhdGVfbXIo
c3RydWN0IG1seDVfdmRwYV9kZXYgKm12ZGV2LAorCQkJIHN0cnVjdCBtbHg1X3ZkcGFfbXIgKm1y
LAorCQkJIHVuc2lnbmVkIGludCBhc2lkKTsKIGludCBtbHg1X3ZkcGFfdXBkYXRlX2N2cV9pb3Rs
YihzdHJ1Y3QgbWx4NV92ZHBhX2RldiAqbXZkZXYsCiAJCQkJc3RydWN0IHZob3N0X2lvdGxiICpp
b3RsYiwKIAkJCQl1bnNpZ25lZCBpbnQgYXNpZCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZkcGEv
bWx4NS9jb3JlL21yLmMgYi9kcml2ZXJzL3ZkcGEvbWx4NS9jb3JlL21yLmMKaW5kZXggYWJkNmE2
ZmIxMjJmLi4wMGVmZjVhMDcxNTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmRwYS9tbHg1L2NvcmUv
bXIuYworKysgYi9kcml2ZXJzL3ZkcGEvbWx4NS9jb3JlL21yLmMKQEAgLTQ5NSwzMCArNDk1LDUx
IEBAIHN0YXRpYyB2b2lkIGRlc3Ryb3lfdXNlcl9tcihzdHJ1Y3QgbWx4NV92ZHBhX2RldiAqbXZk
ZXYsIHN0cnVjdCBtbHg1X3ZkcGFfbXIgKm1yCiAKIHN0YXRpYyB2b2lkIF9tbHg1X3ZkcGFfZGVz
dHJveV9tcihzdHJ1Y3QgbWx4NV92ZHBhX2RldiAqbXZkZXYsIHN0cnVjdCBtbHg1X3ZkcGFfbXIg
Km1yKQogewotCWlmICghbXItPmluaXRpYWxpemVkKQotCQlyZXR1cm47Ci0KIAlpZiAobXItPnVz
ZXJfbXIpCiAJCWRlc3Ryb3lfdXNlcl9tcihtdmRldiwgbXIpOwogCWVsc2UKIAkJZGVzdHJveV9k
bWFfbXIobXZkZXYsIG1yKTsKLQotCW1yLT5pbml0aWFsaXplZCA9IGZhbHNlOwogfQogCiB2b2lk
IG1seDVfdmRwYV9kZXN0cm95X21yKHN0cnVjdCBtbHg1X3ZkcGFfZGV2ICptdmRldiwKIAkJCSAg
c3RydWN0IG1seDVfdmRwYV9tciAqbXIpCiB7CisJaWYgKCFtcikKKwkJcmV0dXJuOworCiAJbXV0
ZXhfbG9jaygmbXZkZXYtPm1yX210eCk7CiAKIAlfbWx4NV92ZHBhX2Rlc3Ryb3lfbXIobXZkZXYs
IG1yKTsKIAorCWlmIChtdmRldi0+bXIgPT0gbXIpCisJCW12ZGV2LT5tciA9IE5VTEw7CisKKwlt
dXRleF91bmxvY2soJm12ZGV2LT5tcl9tdHgpOworCisJa2ZyZWUobXIpOworfQorCit2b2lkIG1s
eDVfdmRwYV91cGRhdGVfbXIoc3RydWN0IG1seDVfdmRwYV9kZXYgKm12ZGV2LAorCQkJIHN0cnVj
dCBtbHg1X3ZkcGFfbXIgKm5ld19tciwKKwkJCSB1bnNpZ25lZCBpbnQgYXNpZCkKK3sKKwlzdHJ1
Y3QgbWx4NV92ZHBhX21yICpvbGRfbXIgPSBtdmRldi0+bXI7CisKKwltdXRleF9sb2NrKCZtdmRl
di0+bXJfbXR4KTsKKworCW12ZGV2LT5tciA9IG5ld19tcjsKKwlpZiAob2xkX21yKSB7CisJCV9t
bHg1X3ZkcGFfZGVzdHJveV9tcihtdmRldiwgb2xkX21yKTsKKwkJa2ZyZWUob2xkX21yKTsKKwl9
CisKIAltdXRleF91bmxvY2soJm12ZGV2LT5tcl9tdHgpOworCiB9CiAKIHZvaWQgbWx4NV92ZHBh
X2Rlc3Ryb3lfbXJfcmVzb3VyY2VzKHN0cnVjdCBtbHg1X3ZkcGFfZGV2ICptdmRldikKIHsKLQlt
bHg1X3ZkcGFfZGVzdHJveV9tcihtdmRldiwgJm12ZGV2LT5tcik7CisJbWx4NV92ZHBhX2Rlc3Ry
b3lfbXIobXZkZXYsIG12ZGV2LT5tcik7CiAJcHJ1bmVfaW90bGIobXZkZXYpOwogfQogCkBAIC01
MjgsNTIgKzU0OSwzNiBAQCBzdGF0aWMgaW50IF9tbHg1X3ZkcGFfY3JlYXRlX21yKHN0cnVjdCBt
bHg1X3ZkcGFfZGV2ICptdmRldiwKIHsKIAlpbnQgZXJyOwogCi0JaWYgKG1yLT5pbml0aWFsaXpl
ZCkKLQkJcmV0dXJuIDA7Ci0KIAlpZiAoaW90bGIpCiAJCWVyciA9IGNyZWF0ZV91c2VyX21yKG12
ZGV2LCBtciwgaW90bGIpOwogCWVsc2UKIAkJZXJyID0gY3JlYXRlX2RtYV9tcihtdmRldiwgbXIp
OwogCi0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCW1yLT5pbml0aWFsaXplZCA9IHRydWU7
Ci0KLQlyZXR1cm4gMDsKKwlyZXR1cm4gZXJyOwogfQogCi1pbnQgbWx4NV92ZHBhX2NyZWF0ZV9t
cihzdHJ1Y3QgbWx4NV92ZHBhX2RldiAqbXZkZXYsCi0JCQlzdHJ1Y3QgbWx4NV92ZHBhX21yICpt
ciwKLQkJCXN0cnVjdCB2aG9zdF9pb3RsYiAqaW90bGIpCitzdHJ1Y3QgbWx4NV92ZHBhX21yICpt
bHg1X3ZkcGFfY3JlYXRlX21yKHN0cnVjdCBtbHg1X3ZkcGFfZGV2ICptdmRldiwKKwkJCQkJIHN0
cnVjdCB2aG9zdF9pb3RsYiAqaW90bGIpCiB7CisJc3RydWN0IG1seDVfdmRwYV9tciAqbXI7CiAJ
aW50IGVycjsKIAorCW1yID0ga3phbGxvYyhzaXplb2YoKm1yKSwgR0ZQX0tFUk5FTCk7CisJaWYg
KCFtcikKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKIAltdXRleF9sb2NrKCZtdmRldi0+
bXJfbXR4KTsKIAllcnIgPSBfbWx4NV92ZHBhX2NyZWF0ZV9tcihtdmRldiwgbXIsIGlvdGxiKTsK
IAltdXRleF91bmxvY2soJm12ZGV2LT5tcl9tdHgpOwogCi0JcmV0dXJuIGVycjsKLX0KLQotaW50
IG1seDVfdmRwYV9oYW5kbGVfc2V0X21hcChzdHJ1Y3QgbWx4NV92ZHBhX2RldiAqbXZkZXYsIHN0
cnVjdCB2aG9zdF9pb3RsYiAqaW90bGIsCi0JCQkgICAgIGJvb2wgKmNoYW5nZV9tYXAsIHVuc2ln
bmVkIGludCBhc2lkKQotewotCXN0cnVjdCBtbHg1X3ZkcGFfbXIgKm1yID0gJm12ZGV2LT5tcjsK
LQlpbnQgZXJyID0gMDsKKwlpZiAoZXJyKQorCQlnb3RvIG91dF9lcnI7CiAKLQkqY2hhbmdlX21h
cCA9IGZhbHNlOwotCW11dGV4X2xvY2soJm12ZGV2LT5tcl9tdHgpOwotCWlmIChtci0+aW5pdGlh
bGl6ZWQpIHsKLQkJbWx4NV92ZHBhX2luZm8obXZkZXYsICJtZW1vcnkgbWFwIHVwZGF0ZVxuIik7
Ci0JCSpjaGFuZ2VfbWFwID0gdHJ1ZTsKLQl9Ci0JaWYgKCEqY2hhbmdlX21hcCkKLQkJZXJyID0g
X21seDVfdmRwYV9jcmVhdGVfbXIobXZkZXYsIG1yLCBpb3RsYik7Ci0JbXV0ZXhfdW5sb2NrKCZt
dmRldi0+bXJfbXR4KTsKKwlyZXR1cm4gbXI7CiAKLQlyZXR1cm4gZXJyOworb3V0X2VycjoKKwlr
ZnJlZShtcik7CisJcmV0dXJuIEVSUl9QVFIoZXJyKTsKIH0KIAogaW50IG1seDVfdmRwYV91cGRh
dGVfY3ZxX2lvdGxiKHN0cnVjdCBtbHg1X3ZkcGFfZGV2ICptdmRldiwKQEAgLTU5NywxMSArNjAy
LDEzIEBAIGludCBtbHg1X3ZkcGFfdXBkYXRlX2N2cV9pb3RsYihzdHJ1Y3QgbWx4NV92ZHBhX2Rl
diAqbXZkZXYsCiAKIGludCBtbHg1X3ZkcGFfY3JlYXRlX2RtYV9tcihzdHJ1Y3QgbWx4NV92ZHBh
X2RldiAqbXZkZXYpCiB7Ci0JaW50IGVycjsKKwlzdHJ1Y3QgbWx4NV92ZHBhX21yICptcjsKIAot
CWVyciA9IG1seDVfdmRwYV9jcmVhdGVfbXIobXZkZXYsICZtdmRldi0+bXIsIE5VTEwpOwotCWlm
IChlcnIpCi0JCXJldHVybiBlcnI7CisJbXIgPSBtbHg1X3ZkcGFfY3JlYXRlX21yKG12ZGV2LCBO
VUxMKTsKKwlpZiAoSVNfRVJSKG1yKSkKKwkJcmV0dXJuIFBUUl9FUlIobXIpOworCisJbWx4NV92
ZHBhX3VwZGF0ZV9tcihtdmRldiwgbXIsIDApOwogCiAJcmV0dXJuIG1seDVfdmRwYV91cGRhdGVf
Y3ZxX2lvdGxiKG12ZGV2LCBOVUxMLCAwKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmRwYS9t
bHg1L25ldC9tbHg1X3ZuZXQuYyBiL2RyaXZlcnMvdmRwYS9tbHg1L25ldC9tbHg1X3ZuZXQuYwpp
bmRleCAyNTZmZGQ4MGMzMjEuLjRhODdmOTExOWZjYSAxMDA2NDQKLS0tIGEvZHJpdmVycy92ZHBh
L21seDUvbmV0L21seDVfdm5ldC5jCisrKyBiL2RyaXZlcnMvdmRwYS9tbHg1L25ldC9tbHg1X3Zu
ZXQuYwpAQCAtODczLDcgKzg3Myw3IEBAIHN0YXRpYyBpbnQgY3JlYXRlX3ZpcnRxdWV1ZShzdHJ1
Y3QgbWx4NV92ZHBhX25ldCAqbmRldiwgc3RydWN0IG1seDVfdmRwYV92aXJ0cXVlCiAJTUxYNV9T
RVQ2NCh2aXJ0aW9fcSwgdnFfY3R4LCBkZXNjX2FkZHIsIG12cS0+ZGVzY19hZGRyKTsKIAlNTFg1
X1NFVDY0KHZpcnRpb19xLCB2cV9jdHgsIHVzZWRfYWRkciwgbXZxLT5kZXZpY2VfYWRkcik7CiAJ
TUxYNV9TRVQ2NCh2aXJ0aW9fcSwgdnFfY3R4LCBhdmFpbGFibGVfYWRkciwgbXZxLT5kcml2ZXJf
YWRkcik7Ci0JTUxYNV9TRVQodmlydGlvX3EsIHZxX2N0eCwgdmlydGlvX3FfbWtleSwgbmRldi0+
bXZkZXYubXIubWtleSk7CisJTUxYNV9TRVQodmlydGlvX3EsIHZxX2N0eCwgdmlydGlvX3FfbWtl
eSwgbmRldi0+bXZkZXYubXItPm1rZXkpOwogCU1MWDVfU0VUKHZpcnRpb19xLCB2cV9jdHgsIHVt
ZW1fMV9pZCwgbXZxLT51bWVtMS5pZCk7CiAJTUxYNV9TRVQodmlydGlvX3EsIHZxX2N0eCwgdW1l
bV8xX3NpemUsIG12cS0+dW1lbTEuc2l6ZSk7CiAJTUxYNV9TRVQodmlydGlvX3EsIHZxX2N0eCwg
dW1lbV8yX2lkLCBtdnEtPnVtZW0yLmlkKTsKQEAgLTI2MzMsNyArMjYzMyw3IEBAIHN0YXRpYyB2
b2lkIHJlc3RvcmVfY2hhbm5lbHNfaW5mbyhzdHJ1Y3QgbWx4NV92ZHBhX25ldCAqbmRldikKIH0K
IAogc3RhdGljIGludCBtbHg1X3ZkcGFfY2hhbmdlX21hcChzdHJ1Y3QgbWx4NV92ZHBhX2RldiAq
bXZkZXYsCi0JCQkJc3RydWN0IHZob3N0X2lvdGxiICppb3RsYiwgdW5zaWduZWQgaW50IGFzaWQp
CisJCQkJc3RydWN0IG1seDVfdmRwYV9tciAqbmV3X21yLCB1bnNpZ25lZCBpbnQgYXNpZCkKIHsK
IAlzdHJ1Y3QgbWx4NV92ZHBhX25ldCAqbmRldiA9IHRvX21seDVfdmRwYV9uZGV2KG12ZGV2KTsK
IAlpbnQgZXJyOwpAQCAtMjY0MSwyNyArMjY0MSwxOCBAQCBzdGF0aWMgaW50IG1seDVfdmRwYV9j
aGFuZ2VfbWFwKHN0cnVjdCBtbHg1X3ZkcGFfZGV2ICptdmRldiwKIAlzdXNwZW5kX3ZxcyhuZGV2
KTsKIAllcnIgPSBzYXZlX2NoYW5uZWxzX2luZm8obmRldik7CiAJaWYgKGVycikKLQkJZ290byBl
cnJfbXI7CisJCXJldHVybiBlcnI7CiAKIAl0ZWFyZG93bl9kcml2ZXIobmRldik7Ci0JbWx4NV92
ZHBhX2Rlc3Ryb3lfbXIobXZkZXYsICZtdmRldi0+bXIpOwotCWVyciA9IG1seDVfdmRwYV9jcmVh
dGVfbXIobXZkZXYsICZtdmRldi0+bXIsIGlvdGxiKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9t
cjsKKworCW1seDVfdmRwYV91cGRhdGVfbXIobXZkZXYsIG5ld19tciwgYXNpZCk7CiAKIAlpZiAo
IShtdmRldi0+c3RhdHVzICYgVklSVElPX0NPTkZJR19TX0RSSVZFUl9PSykgfHwgbXZkZXYtPnN1
c3BlbmRlZCkKLQkJZ290byBlcnJfbXI7CisJCXJldHVybiAwOwogCiAJcmVzdG9yZV9jaGFubmVs
c19pbmZvKG5kZXYpOwogCWVyciA9IHNldHVwX2RyaXZlcihtdmRldik7Ci0JaWYgKGVycikKLQkJ
Z290byBlcnJfc2V0dXA7Ci0KLQlyZXR1cm4gMDsKIAotZXJyX3NldHVwOgotCW1seDVfdmRwYV9k
ZXN0cm95X21yKG12ZGV2LCAmbXZkZXYtPm1yKTsKLWVycl9tcjoKIAlyZXR1cm4gZXJyOwogfQog
CkBAIC0yODc1LDI2ICsyODY2LDM1IEBAIHN0YXRpYyB1MzIgbWx4NV92ZHBhX2dldF9nZW5lcmF0
aW9uKHN0cnVjdCB2ZHBhX2RldmljZSAqdmRldikKIHN0YXRpYyBpbnQgc2V0X21hcF9kYXRhKHN0
cnVjdCBtbHg1X3ZkcGFfZGV2ICptdmRldiwgc3RydWN0IHZob3N0X2lvdGxiICppb3RsYiwKIAkJ
CXVuc2lnbmVkIGludCBhc2lkKQogewotCWJvb2wgY2hhbmdlX21hcDsKKwlzdHJ1Y3QgbWx4NV92
ZHBhX21yICpuZXdfbXI7CiAJaW50IGVycjsKIAogCWlmIChtdmRldi0+Z3JvdXAyYXNpZFtNTFg1
X1ZEUEFfREFUQVZRX0dST1VQXSAhPSBhc2lkKQogCQlnb3RvIGVuZDsKIAotCWVyciA9IG1seDVf
dmRwYV9oYW5kbGVfc2V0X21hcChtdmRldiwgaW90bGIsICZjaGFuZ2VfbWFwLCBhc2lkKTsKLQlp
ZiAoZXJyKSB7Ci0JCW1seDVfdmRwYV93YXJuKG12ZGV2LCAic2V0IG1hcCBmYWlsZWQoJWQpXG4i
LCBlcnIpOworCW5ld19tciA9IG1seDVfdmRwYV9jcmVhdGVfbXIobXZkZXYsIGlvdGxiKTsKKwlp
ZiAoSVNfRVJSKG5ld19tcikpIHsKKwkJZXJyID0gUFRSX0VSUihuZXdfbXIpOworCQltbHg1X3Zk
cGFfd2FybihtdmRldiwgImNyZWF0ZSBtYXAgZmFpbGVkKCVkKVxuIiwgZXJyKTsKIAkJcmV0dXJu
IGVycjsKIAl9CiAKLQlpZiAoY2hhbmdlX21hcCkgewotCQllcnIgPSBtbHg1X3ZkcGFfY2hhbmdl
X21hcChtdmRldiwgaW90bGIsIGFzaWQpOwotCQlpZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKKwlp
ZiAoIW12ZGV2LT5tcikgeworCQltbHg1X3ZkcGFfdXBkYXRlX21yKG12ZGV2LCBuZXdfbXIsIGFz
aWQpOworCX0gZWxzZSB7CisJCWVyciA9IG1seDVfdmRwYV9jaGFuZ2VfbWFwKG12ZGV2LCBuZXdf
bXIsIGFzaWQpOworCQlpZiAoZXJyKSB7CisJCQltbHg1X3ZkcGFfd2FybihtdmRldiwgImNoYW5n
ZSBtYXAgZmFpbGVkKCVkKVxuIiwgZXJyKTsKKwkJCWdvdG8gb3V0X2VycjsKKwkJfQogCX0KIAog
ZW5kOgogCXJldHVybiBtbHg1X3ZkcGFfdXBkYXRlX2N2cV9pb3RsYihtdmRldiwgaW90bGIsIGFz
aWQpOworCitvdXRfZXJyOgorCW1seDVfdmRwYV9kZXN0cm95X21yKG12ZGV2LCBuZXdfbXIpOwor
CXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyBpbnQgbWx4NV92ZHBhX3NldF9tYXAoc3RydWN0IHZk
cGFfZGV2aWNlICp2ZGV2LCB1bnNpZ25lZCBpbnQgYXNpZCwKLS0gCjIuNDEuMAoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFp
bGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBz
Oi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0
aW9u
