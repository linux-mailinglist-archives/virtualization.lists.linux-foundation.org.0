Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
	by mail.lfdr.de (Postfix) with ESMTPS id 5B7A954AAD7
	for <lists.virtualization@lfdr.de>; Tue, 14 Jun 2022 09:45:40 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id 88FAF414CD;
	Tue, 14 Jun 2022 07:45:38 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id fgvhOWx2yxQP; Tue, 14 Jun 2022 07:45:37 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp4.osuosl.org (Postfix) with ESMTPS id A12AE414E4;
	Tue, 14 Jun 2022 07:45:36 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 070E7C0081;
	Tue, 14 Jun 2022 07:45:36 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 671DBC002D
 for <virtualization@lists.linux-foundation.org>;
 Tue, 14 Jun 2022 07:45:34 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id 553D8823DD
 for <virtualization@lists.linux-foundation.org>;
 Tue, 14 Jun 2022 07:45:34 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Authentication-Results: smtp1.osuosl.org (amavisd-new);
 dkim=pass (1024-bit key) header.d=redhat.com
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 9jxln4PloPGS
 for <virtualization@lists.linux-foundation.org>;
 Tue, 14 Jun 2022 07:45:33 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.133.124])
 by smtp1.osuosl.org (Postfix) with ESMTPS id 6519C81D5A
 for <virtualization@lists.linux-foundation.org>;
 Tue, 14 Jun 2022 07:45:33 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1655192732;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=orMFX7sAwj4N76FdyVTuQqp9a2204zsl+inQH7qNPHA=;
 b=MxxCjdVIhSM4IY/XCxfmuWbvmWRbxIFQS3uappsNHrQ1ML3mqzVUukamcKfJeCBqnx+V44
 62YvgfVqTCmzxJhBj4IF9LONeskPhgGC87TRd1CXUxMbssoWYMTYMDmQGfw5SRsdGUvBQh
 qD2DOMBcGBalB9eIi1Js4+dzNJ/RX4U=
Received: from mail-lf1-f69.google.com (mail-lf1-f69.google.com
 [209.85.167.69]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 us-mta-604-IlENiodtMxeoxW52BYsAHQ-1; Tue, 14 Jun 2022 03:45:31 -0400
X-MC-Unique: IlENiodtMxeoxW52BYsAHQ-1
Received: by mail-lf1-f69.google.com with SMTP id
 a29-20020a194f5d000000b004790a4ba4bdso4173073lfk.11
 for <virtualization@lists.linux-foundation.org>;
 Tue, 14 Jun 2022 00:45:30 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=orMFX7sAwj4N76FdyVTuQqp9a2204zsl+inQH7qNPHA=;
 b=z1LnGO6+Ww1Ffe+YcvJWaeJRaU99YXP4tQui2HTkz/O51eFCOdaZQGoI380Obm4p/X
 IlM2h8sZHC6KlBxFww9r2j07WaekTiak68ZAzXXun+4CeMzUlBsyHKe9752fD6lqFJaP
 IdWVYsgoVP1Gw2hVO+lF5qav4XIAmjS7fImzESQ2yB9xZjiM7amNsj9j0GdNgp80fpxQ
 mwXXxFMgZN4J2A9e8FnyIwM5biRJSbFtfJpHTTPCmeugigSpKfIQBm9ZPoZghaIetZXg
 oJ2Ihy+RH6UQPny4BnYw0AAEQ0BPlwpU0S4q/A9IQt6LtyowanAFvhp2dnxowccCDDTy
 pHcg==
X-Gm-Message-State: AJIora+a4hfO+M/qSt9dvNm5LIPX3LsC9WjC6NvYya0SqyRamiHkWRk7
 pZLve99mq6plT0rPOsExBZeALe8nOxShtfvFq7GGyIfhzw5tfR01cv0oT5+Xk4iKBApQqS5DqXa
 T1hYi9qrlYOfiKwLqbCjpQCdri1bZDV9Bs88LUpMwlutnElj//o6hHMlA1A==
X-Received: by 2002:a05:6512:13a5:b0:47d:c1d9:dea8 with SMTP id
 p37-20020a05651213a500b0047dc1d9dea8mr2275937lfa.442.1655192729453; 
 Tue, 14 Jun 2022 00:45:29 -0700 (PDT)
X-Google-Smtp-Source: AGRyM1sP4ThGHBh+rx6/j6YJRgbFZ9qwlO0cabekuZQwGQLLYfn8j+BSmsHNSnyW4hvIlIFh8tNwCghyemuRXTJjHn0=
X-Received: by 2002:a05:6512:13a5:b0:47d:c1d9:dea8 with SMTP id
 p37-20020a05651213a500b0047dc1d9dea8mr2275922lfa.442.1655192729190; Tue, 14
 Jun 2022 00:45:29 -0700 (PDT)
MIME-Version: 1.0
References: <20220613100433-mutt-send-email-mst@kernel.org>
 <20220614053737.82453-1-huangjie.albert@bytedance.com>
In-Reply-To: <20220614053737.82453-1-huangjie.albert@bytedance.com>
From: Jason Wang <jasowang@redhat.com>
Date: Tue, 14 Jun 2022 15:45:17 +0800
Message-ID: <CACGkMEsnvj3MR8oRu-M2D9gTD2sDUJSWkMdjdm6GPum_KUY47w@mail.gmail.com>
Subject: Re: [PATCH] virtio_ring : keep used_wrap_counter in vq->last_used_idx
To: Albert Huang <huangjie.albert@bytedance.com>
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=jasowang@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: linux-kernel <linux-kernel@vger.kernel.org>,
 virtualization <virtualization@lists.linux-foundation.org>,
 yuanzhu@bytedance.com, mst <mst@redhat.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVHVlLCBKdW4gMTQsIDIwMjIgYXQgMTozOCBQTSBBbGJlcnQgSHVhbmcKPGh1YW5namllLmFs
YmVydEBieXRlZGFuY2UuY29tPiB3cm90ZToKPgo+IEZyb206ICJodWFuZ2ppZS5hbGJlcnQiIDxo
dWFuZ2ppZS5hbGJlcnRAYnl0ZWRhbmNlLmNvbT4KPgo+IHRoZSB1c2VkX3dyYXBfY291bnRlciBh
bmQgdGhlIHZxLT5sYXN0X3VzZWRfaWR4IG1heSBnZXQKPiBvdXQgb2Ygc3luYyBpZiB0aGV5IGFy
ZSBzZXBhcmF0ZSBhc3NpZ25tZW5077yMYW5kIGludGVycnVwdAo+IG1pZ2h0IHVzZSBhbiBpbmNv
cnJlY3QgdmFsdWUgdG8gY2hlY2sgZm9yIHRoZSB1c2VkIGluZGV4Lgo+Cj4gZm9yIGV4YW1wbGU6
T09CIGFjY2Vzcwo+IGtzb2Z0aXJxZCBtYXkgY29uc3VtZSB0aGUgcGFja2V0IGFuZCBpdCB3aWxs
IGNhbGw6Cj4gdmlydG5ldF9wb2xsCj4gICAgICAgICAtLT52aXJ0bmV0X3JlY2VpdmUKPiAgICAg
ICAgICAgICAgICAgLS0+dmlydHF1ZXVlX2dldF9idWZfY3R4Cj4gICAgICAgICAgICAgICAgICAg
ICAgICAgLS0+dmlydHF1ZXVlX2dldF9idWZfY3R4X3BhY2tlZAo+IGFuZCBpbiB2aXJ0cXVldWVf
Z2V0X2J1Zl9jdHhfcGFja2VkOgo+Cj4gdnEtPmxhc3RfdXNlZF9pZHggKz0gdnEtPnBhY2tlZC5k
ZXNjX3N0YXRlW2lkXS5udW07Cj4gaWYgKHVubGlrZWx5KHZxLT5sYXN0X3VzZWRfaWR4ID49IHZx
LT5wYWNrZWQudnJpbmcubnVtKSkgewo+ICAgICAgICAgIHZxLT5sYXN0X3VzZWRfaWR4IC09IHZx
LT5wYWNrZWQudnJpbmcubnVtOwo+ICAgICAgICAgIHZxLT5wYWNrZWQudXNlZF93cmFwX2NvdW50
ZXIgXj0gMTsKPiB9Cj4KPiBpZiBhdCB0aGUgc2FtZSB0aW1lLCB0aGVyZSBjb21lcyBhIHZyaW5n
IGludGVycnVwdO+8jGluIHZyaW5nX2ludGVycnVwdDoKPiB3ZSB3aWxsIGNhbGw6Cj4gdnJpbmdf
aW50ZXJydXB0Cj4gICAgICAgICAtLT5tb3JlX3VzZWQKPiAgICAgICAgICAgICAgICAgLS0+bW9y
ZV91c2VkX3BhY2tlZAo+ICAgICAgICAgICAgICAgICAgICAgICAgIC0tPmlzX3VzZWRfZGVzY19w
YWNrZWQKPiBpbiBpc191c2VkX2Rlc2NfcGFja2VkLCB0aGUgbGFzdF91c2VkX2lkeCBtYXliZSA+
PSB2cS0+cGFja2VkLnZyaW5nLm51bS4KPiBzbyB0aGlzIGNvdWxkIGNhc2UgYSBtZW1vcnkgb3V0
IG9mIGJvdW5kcyBidWcuCj4KPiB0aGlzIHBhdGNoIGlzIHRvIGtlZXAgdGhlIHVzZWRfd3JhcF9j
b3VudGVyIGluIHZxLT5sYXN0X3VzZWRfaWR4Cj4gc28gd2UgY2FuIGdldCB0aGUgY29ycmVjdCB2
YWx1ZSB0byBjaGVjayBmb3IgdXNlZCBpbmRleCBpbiBpbnRlcnJ1cHQuCj4KPiBTaWduZWQtb2Zm
LWJ5OiBodWFuZ2ppZS5hbGJlcnQgPGh1YW5namllLmFsYmVydEBieXRlZGFuY2UuY29tPgo+IC0t
LQo+ICBkcml2ZXJzL3ZpcnRpby92aXJ0aW9fcmluZy5jICAgICB8IDYwICsrKysrKysrKysrKysr
KysrKy0tLS0tLS0tLS0tLS0tCj4gIGluY2x1ZGUvdWFwaS9saW51eC92aXJ0aW9fcmluZy5oIHwg
IDYgKysrKwo+ICAyIGZpbGVzIGNoYW5nZWQsIDQwIGluc2VydGlvbnMoKyksIDI2IGRlbGV0aW9u
cygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmlydGlvL3ZpcnRpb19yaW5nLmMgYi9kcml2
ZXJzL3ZpcnRpby92aXJ0aW9fcmluZy5jCj4gaW5kZXggMTNhNzM0OGNlZGZmLi4zNWMzNzUwZTg5
ZTEgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy92aXJ0aW8vdmlydGlvX3JpbmcuYwo+ICsrKyBiL2Ry
aXZlcnMvdmlydGlvL3ZpcnRpb19yaW5nLmMKPiBAQCAtMTExLDcgKzExMSwxMiBAQCBzdHJ1Y3Qg
dnJpbmdfdmlydHF1ZXVlIHsKPiAgICAgICAgIC8qIE51bWJlciB3ZSd2ZSBhZGRlZCBzaW5jZSBs
YXN0IHN5bmMuICovCj4gICAgICAgICB1bnNpZ25lZCBpbnQgbnVtX2FkZGVkOwo+Cj4gLSAgICAg
ICAvKiBMYXN0IHVzZWQgaW5kZXggd2UndmUgc2Vlbi4gKi8KPiArICAgICAgIC8qIExhc3QgdXNl
ZCBpbmRleCAgd2UndmUgc2Vlbi4KPiArICAgICAgICAqIGZvciBzcGxpdCByaW5nLCBpdCBqdXN0
IGNvbnRhaW5zIGxhc3QgdXNlZCBpbmRleAo+ICsgICAgICAgICogZm9yIHBhY2tlZCByaW5nLCBp
dCBub3Qgb25seSBjb250YWlucyBsYXN0IHVzZWQgaW5kZXgsIGJ1dCBhbHNvCj4gKyAgICAgICAg
KiB1c2VkX3dyYXBfY291bnRlciwgdGhlIFZSSU5HX1BBQ0tFRF9VU0VEX0lOREVYX0ZfV1JBUF9D
VFIgaXMKPiArICAgICAgICAqIHRoZSBiaXQgc2hpZnQgaW4gbGFzdF91c2VkX2lkeAo+ICsgICAg
ICAgICovCj4gICAgICAgICB1MTYgbGFzdF91c2VkX2lkeDsKPgo+ICAgICAgICAgLyogSGludCBm
b3IgZXZlbnQgaWR4OiBhbHJlYWR5IHRyaWdnZXJlZCBubyBuZWVkIHRvIGRpc2FibGUuICovCj4g
QEAgLTE1NCw5ICsxNTksNiBAQCBzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVlIHsKPiAgICAgICAgICAg
ICAgICAgICAgICAgICAvKiBEcml2ZXIgcmluZyB3cmFwIGNvdW50ZXIuICovCj4gICAgICAgICAg
ICAgICAgICAgICAgICAgYm9vbCBhdmFpbF93cmFwX2NvdW50ZXI7Cj4KPiAtICAgICAgICAgICAg
ICAgICAgICAgICAvKiBEZXZpY2UgcmluZyB3cmFwIGNvdW50ZXIuICovCj4gLSAgICAgICAgICAg
ICAgICAgICAgICAgYm9vbCB1c2VkX3dyYXBfY291bnRlcjsKPiAtCj4gICAgICAgICAgICAgICAg
ICAgICAgICAgLyogQXZhaWwgdXNlZCBmbGFncy4gKi8KPiAgICAgICAgICAgICAgICAgICAgICAg
ICB1MTYgYXZhaWxfdXNlZF9mbGFnczsKPgo+IEBAIC0xMzk3LDYgKzEzOTksOSBAQCBzdGF0aWMg
aW5saW5lIGJvb2wgaXNfdXNlZF9kZXNjX3BhY2tlZChjb25zdCBzdHJ1Y3QgdnJpbmdfdmlydHF1
ZXVlICp2cSwKPiAgICAgICAgIGJvb2wgYXZhaWwsIHVzZWQ7Cj4gICAgICAgICB1MTYgZmxhZ3M7
Cj4KPiArICAgICAgIGlmIChpZHggPj0gdnEtPnBhY2tlZC52cmluZy5udW0pCj4gKyAgICAgICAg
ICAgICAgIHJldHVybiBmYWxzZTsKCkkgd29uZGVyIGlmIHdlIGNhbiBhdm9pZCB0aGlzIHRyaWNr
LCBtb3JlIGJlbG93LgoKPiArCj4gICAgICAgICBmbGFncyA9IGxlMTZfdG9fY3B1KHZxLT5wYWNr
ZWQudnJpbmcuZGVzY1tpZHhdLmZsYWdzKTsKPiAgICAgICAgIGF2YWlsID0gISEoZmxhZ3MgJiAo
MSA8PCBWUklOR19QQUNLRURfREVTQ19GX0FWQUlMKSk7Cj4gICAgICAgICB1c2VkID0gISEoZmxh
Z3MgJiAoMSA8PCBWUklOR19QQUNLRURfREVTQ19GX1VTRUQpKTsKPiBAQCAtMTQwNiw4ICsxNDEx
LDEyIEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpc191c2VkX2Rlc2NfcGFja2VkKGNvbnN0IHN0cnVj
dCB2cmluZ192aXJ0cXVldWUgKnZxLAo+Cj4gIHN0YXRpYyBpbmxpbmUgYm9vbCBtb3JlX3VzZWRf
cGFja2VkKGNvbnN0IHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxKQo+ICB7Cj4gLSAgICAgICBy
ZXR1cm4gaXNfdXNlZF9kZXNjX3BhY2tlZCh2cSwgdnEtPmxhc3RfdXNlZF9pZHgsCj4gLSAgICAg
ICAgICAgICAgICAgICAgICAgdnEtPnBhY2tlZC51c2VkX3dyYXBfY291bnRlcik7Cj4gKyAgICAg
ICB1MTYgbGFzdF91c2VkOwo+ICsgICAgICAgYm9vbCB1c2VkX3dyYXBfY291bnRlcjsKPiArCj4g
KyAgICAgICBsYXN0X3VzZWQgPSB2cS0+bGFzdF91c2VkX2lkeCAmIH4oMSA8PCBWUklOR19QQUNL
RURfVVNFRF9JTkRFWF9GX1dSQVBfQ1RSKTsKPiArICAgICAgIHVzZWRfd3JhcF9jb3VudGVyID0g
ISEoKHZxLT5sYXN0X3VzZWRfaWR4KSA+PiBWUklOR19QQUNLRURfVVNFRF9JTkRFWF9GX1dSQVBf
Q1RSKTsKPiArICAgICAgIHJldHVybiBpc191c2VkX2Rlc2NfcGFja2VkKHZxLCBsYXN0X3VzZWQs
IHVzZWRfd3JhcF9jb3VudGVyKTsKPiAgfQo+Cj4gIHN0YXRpYyB2b2lkICp2aXJ0cXVldWVfZ2V0
X2J1Zl9jdHhfcGFja2VkKHN0cnVjdCB2aXJ0cXVldWUgKl92cSwKPiBAQCAtMTQxNiw2ICsxNDI1
LDcgQEAgc3RhdGljIHZvaWQgKnZpcnRxdWV1ZV9nZXRfYnVmX2N0eF9wYWNrZWQoc3RydWN0IHZp
cnRxdWV1ZSAqX3ZxLAo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVlICp2cSA9
IHRvX3Z2cShfdnEpOwo+ICAgICAgICAgdTE2IGxhc3RfdXNlZCwgaWQ7Cj4gKyAgICAgICBib29s
IHVzZWRfd3JhcF9jb3VudGVyOwo+ICAgICAgICAgdm9pZCAqcmV0Owo+Cj4gICAgICAgICBTVEFS
VF9VU0UodnEpOwo+IEBAIC0xNDM0LDcgKzE0NDQsOCBAQCBzdGF0aWMgdm9pZCAqdmlydHF1ZXVl
X2dldF9idWZfY3R4X3BhY2tlZChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEsCj4gICAgICAgICAvKiBP
bmx5IGdldCB1c2VkIGVsZW1lbnRzIGFmdGVyIHRoZXkgaGF2ZSBiZWVuIGV4cG9zZWQgYnkgaG9z
dC4gKi8KPiAgICAgICAgIHZpcnRpb19ybWIodnEtPndlYWtfYmFycmllcnMpOwo+Cj4gLSAgICAg
ICBsYXN0X3VzZWQgPSB2cS0+bGFzdF91c2VkX2lkeDsKPiArICAgICAgIHVzZWRfd3JhcF9jb3Vu
dGVyID0gISEoKHZxLT5sYXN0X3VzZWRfaWR4ID4+IFZSSU5HX1BBQ0tFRF9VU0VEX0lOREVYX0Zf
V1JBUF9DVFIpKTsKPiArICAgICAgIGxhc3RfdXNlZCA9ICh2cS0+bGFzdF91c2VkX2lkeCkgJiAo
figxIDw8IFZSSU5HX1BBQ0tFRF9VU0VEX0lOREVYX0ZfV1JBUF9DVFIpKTsKPiAgICAgICAgIGlk
ID0gbGUxNl90b19jcHUodnEtPnBhY2tlZC52cmluZy5kZXNjW2xhc3RfdXNlZF0uaWQpOwo+ICAg
ICAgICAgKmxlbiA9IGxlMzJfdG9fY3B1KHZxLT5wYWNrZWQudnJpbmcuZGVzY1tsYXN0X3VzZWRd
Lmxlbik7Cj4KPiBAQCAtMTQ1MSwxMiArMTQ2MiwxNSBAQCBzdGF0aWMgdm9pZCAqdmlydHF1ZXVl
X2dldF9idWZfY3R4X3BhY2tlZChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEsCj4gICAgICAgICByZXQg
PSB2cS0+cGFja2VkLmRlc2Nfc3RhdGVbaWRdLmRhdGE7Cj4gICAgICAgICBkZXRhY2hfYnVmX3Bh
Y2tlZCh2cSwgaWQsIGN0eCk7Cj4KPiAtICAgICAgIHZxLT5sYXN0X3VzZWRfaWR4ICs9IHZxLT5w
YWNrZWQuZGVzY19zdGF0ZVtpZF0ubnVtOwo+IC0gICAgICAgaWYgKHVubGlrZWx5KHZxLT5sYXN0
X3VzZWRfaWR4ID49IHZxLT5wYWNrZWQudnJpbmcubnVtKSkgewo+IC0gICAgICAgICAgICAgICB2
cS0+bGFzdF91c2VkX2lkeCAtPSB2cS0+cGFja2VkLnZyaW5nLm51bTsKPiAtICAgICAgICAgICAg
ICAgdnEtPnBhY2tlZC51c2VkX3dyYXBfY291bnRlciBePSAxOwo+ICsgICAgICAgbGFzdF91c2Vk
ICs9IHZxLT5wYWNrZWQuZGVzY19zdGF0ZVtpZF0ubnVtOwo+ICsgICAgICAgaWYgKHVubGlrZWx5
KGxhc3RfdXNlZCA+PSB2cS0+cGFja2VkLnZyaW5nLm51bSkpIHsKCkNhbiB3ZSB0d2VhayB0aGUg
bWF0aCBoZXJlIHRvIGF2b2lkIHRoZSBvdXQgb2YgYm91bmQgcmVzdWx0PwoKPiArICAgICAgICAg
ICAgICAgbGFzdF91c2VkIC09IHZxLT5wYWNrZWQudnJpbmcubnVtOwo+ICsgICAgICAgICAgICAg
ICB1c2VkX3dyYXBfY291bnRlciBePSAxOwo+ICAgICAgICAgfQo+Cj4gKyAgICAgICBsYXN0X3Vz
ZWQgPSAobGFzdF91c2VkIHwgKHVzZWRfd3JhcF9jb3VudGVyIDw8IFZSSU5HX1BBQ0tFRF9ERVND
X0ZfVVNFRCkpOwo+ICsgICAgICAgdnEtPmxhc3RfdXNlZF9pZHggPSBsYXN0X3VzZWQ7Cj4gKwo+
ICAgICAgICAgLyoKPiAgICAgICAgICAqIElmIHdlIGV4cGVjdCBhbiBpbnRlcnJ1cHQgZm9yIHRo
ZSBuZXh0IGVudHJ5LCB0ZWxsIGhvc3QKPiAgICAgICAgICAqIGJ5IHdyaXRpbmcgZXZlbnQgaW5k
ZXggYW5kIGZsdXNoIG91dCB0aGUgd3JpdGUgYmVmb3JlCj4gQEAgLTE0NjUsOSArMTQ3OSw3IEBA
IHN0YXRpYyB2b2lkICp2aXJ0cXVldWVfZ2V0X2J1Zl9jdHhfcGFja2VkKHN0cnVjdCB2aXJ0cXVl
dWUgKl92cSwKPiAgICAgICAgIGlmICh2cS0+cGFja2VkLmV2ZW50X2ZsYWdzX3NoYWRvdyA9PSBW
UklOR19QQUNLRURfRVZFTlRfRkxBR19ERVNDKQo+ICAgICAgICAgICAgICAgICB2aXJ0aW9fc3Rv
cmVfbWIodnEtPndlYWtfYmFycmllcnMsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmdnEtPnBhY2tlZC52cmluZy5kcml2ZXItPm9mZl93cmFwLAo+IC0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY3B1X3RvX2xlMTYodnEtPmxhc3RfdXNlZF9pZHggfAo+IC0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodnEtPnBhY2tlZC51c2VkX3dyYXBfY291
bnRlciA8PAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVlJJTkdf
UEFDS0VEX0VWRU5UX0ZfV1JBUF9DVFIpKSk7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBjcHVfdG9fbGUxNih2cS0+bGFzdF91c2VkX2lkeCkpOwo+Cj4gICAgICAgICBMQVNUX0FE
RF9USU1FX0lOVkFMSUQodnEpOwo+Cj4gQEAgLTE0OTksOSArMTUxMSw3IEBAIHN0YXRpYyB1bnNp
Z25lZCBpbnQgdmlydHF1ZXVlX2VuYWJsZV9jYl9wcmVwYXJlX3BhY2tlZChzdHJ1Y3QgdmlydHF1
ZXVlICpfdnEpCj4KPiAgICAgICAgIGlmICh2cS0+ZXZlbnQpIHsKPiAgICAgICAgICAgICAgICAg
dnEtPnBhY2tlZC52cmluZy5kcml2ZXItPm9mZl93cmFwID0KPiAtICAgICAgICAgICAgICAgICAg
ICAgICBjcHVfdG9fbGUxNih2cS0+bGFzdF91c2VkX2lkeCB8Cj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAodnEtPnBhY2tlZC51c2VkX3dyYXBfY291bnRlciA8PAo+IC0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIFZSSU5HX1BBQ0tFRF9FVkVOVF9GX1dSQVBfQ1RSKSk7
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgY3B1X3RvX2xlMTYodnEtPmxhc3RfdXNlZF9pZHgp
Owo+ICAgICAgICAgICAgICAgICAvKgo+ICAgICAgICAgICAgICAgICAgKiBXZSBuZWVkIHRvIHVw
ZGF0ZSBldmVudCBvZmZzZXQgYW5kIGV2ZW50IHdyYXAKPiAgICAgICAgICAgICAgICAgICogY291
bnRlciBmaXJzdCBiZWZvcmUgdXBkYXRpbmcgZXZlbnQgZmxhZ3MuCj4gQEAgLTE1MTgsOCArMTUy
OCw3IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgdmlydHF1ZXVlX2VuYWJsZV9jYl9wcmVwYXJlX3Bh
Y2tlZChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEpCj4gICAgICAgICB9Cj4KPiAgICAgICAgIEVORF9V
U0UodnEpOwo+IC0gICAgICAgcmV0dXJuIHZxLT5sYXN0X3VzZWRfaWR4IHwgKCh1MTYpdnEtPnBh
Y2tlZC51c2VkX3dyYXBfY291bnRlciA8PAo+IC0gICAgICAgICAgICAgICAgICAgICAgIFZSSU5H
X1BBQ0tFRF9FVkVOVF9GX1dSQVBfQ1RSKTsKPiArICAgICAgIHJldHVybiB2cS0+bGFzdF91c2Vk
X2lkeDsKPiAgfQo+Cj4gIHN0YXRpYyBib29sIHZpcnRxdWV1ZV9wb2xsX3BhY2tlZChzdHJ1Y3Qg
dmlydHF1ZXVlICpfdnEsIHUxNiBvZmZfd3JhcCkKPiBAQCAtMTU1MCw5ICsxNTU5LDkgQEAgc3Rh
dGljIGJvb2wgdmlydHF1ZXVlX2VuYWJsZV9jYl9kZWxheWVkX3BhY2tlZChzdHJ1Y3QgdmlydHF1
ZXVlICpfdnEpCj4gICAgICAgICBpZiAodnEtPmV2ZW50KSB7Cj4gICAgICAgICAgICAgICAgIC8q
IFRPRE86IHR1bmUgdGhpcyB0aHJlc2hvbGQgKi8KPiAgICAgICAgICAgICAgICAgYnVmcyA9ICh2
cS0+cGFja2VkLnZyaW5nLm51bSAtIHZxLT52cS5udW1fZnJlZSkgKiAzIC8gNDsKPiAtICAgICAg
ICAgICAgICAgd3JhcF9jb3VudGVyID0gdnEtPnBhY2tlZC51c2VkX3dyYXBfY291bnRlcjsKPiAr
ICAgICAgICAgICAgICAgd3JhcF9jb3VudGVyID0gISEodnEtPmxhc3RfdXNlZF9pZHggPj4gVlJJ
TkdfUEFDS0VEX1VTRURfSU5ERVhfRl9XUkFQX0NUUik7Cj4KPiAtICAgICAgICAgICAgICAgdXNl
ZF9pZHggPSB2cS0+bGFzdF91c2VkX2lkeCArIGJ1ZnM7Cj4gKyAgICAgICAgICAgICAgIHVzZWRf
aWR4ID0gKHZxLT5sYXN0X3VzZWRfaWR4ICYgfigxIDw8IFZSSU5HX1BBQ0tFRF9VU0VEX0lOREVY
X0ZfV1JBUF9DVFIpKSArIGJ1ZnM7Cj4gICAgICAgICAgICAgICAgIGlmICh1c2VkX2lkeCA+PSB2
cS0+cGFja2VkLnZyaW5nLm51bSkgewo+ICAgICAgICAgICAgICAgICAgICAgICAgIHVzZWRfaWR4
IC09IHZxLT5wYWNrZWQudnJpbmcubnVtOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIHdyYXBf
Y291bnRlciBePSAxOwo+IEBAIC0xNTgyLDkgKzE1OTEsOSBAQCBzdGF0aWMgYm9vbCB2aXJ0cXVl
dWVfZW5hYmxlX2NiX2RlbGF5ZWRfcGFja2VkKHN0cnVjdCB2aXJ0cXVldWUgKl92cSkKPiAgICAg
ICAgICAqLwo+ICAgICAgICAgdmlydGlvX21iKHZxLT53ZWFrX2JhcnJpZXJzKTsKPgo+IC0gICAg
ICAgaWYgKGlzX3VzZWRfZGVzY19wYWNrZWQodnEsCj4gLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB2cS0+bGFzdF91c2VkX2lkeCwKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHZxLT5wYWNrZWQudXNlZF93cmFwX2NvdW50ZXIpKSB7Cj4gKyAgICAgICB3cmFwX2NvdW50
ZXIgPSAhISh2cS0+bGFzdF91c2VkX2lkeCA+PiBWUklOR19QQUNLRURfVVNFRF9JTkRFWF9GX1dS
QVBfQ1RSKTsKPiArICAgICAgIHVzZWRfaWR4ID0gKHZxLT5sYXN0X3VzZWRfaWR4ICYgfigxIDw8
IFZSSU5HX1BBQ0tFRF9VU0VEX0lOREVYX0ZfV1JBUF9DVFIpKTsKPiArICAgICAgIGlmIChpc191
c2VkX2Rlc2NfcGFja2VkKHZxLCB1c2VkX2lkeCwgd3JhcF9jb3VudGVyKSkgewo+ICAgICAgICAg
ICAgICAgICBFTkRfVVNFKHZxKTsKPiAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwo+ICAg
ICAgICAgfQo+IEBAIC0xNjg5LDcgKzE2OTgsNyBAQCBzdGF0aWMgc3RydWN0IHZpcnRxdWV1ZSAq
dnJpbmdfY3JlYXRlX3ZpcnRxdWV1ZV9wYWNrZWQoCj4gICAgICAgICB2cS0+bm90aWZ5ID0gbm90
aWZ5Owo+ICAgICAgICAgdnEtPndlYWtfYmFycmllcnMgPSB3ZWFrX2JhcnJpZXJzOwo+ICAgICAg
ICAgdnEtPmJyb2tlbiA9IHRydWU7Cj4gLSAgICAgICB2cS0+bGFzdF91c2VkX2lkeCA9IDA7Cj4g
KyAgICAgICB2cS0+bGFzdF91c2VkX2lkeCA9IDAgfCAoMSA8PCBWUklOR19QQUNLRURfVVNFRF9J
TkRFWF9GX1dSQVBfQ1RSKTsKPiAgICAgICAgIHZxLT5ldmVudF90cmlnZ2VyZWQgPSBmYWxzZTsK
PiAgICAgICAgIHZxLT5udW1fYWRkZWQgPSAwOwo+ICAgICAgICAgdnEtPnBhY2tlZF9yaW5nID0g
dHJ1ZTsKPiBAQCAtMTcyMCw3ICsxNzI5LDYgQEAgc3RhdGljIHN0cnVjdCB2aXJ0cXVldWUgKnZy
aW5nX2NyZWF0ZV92aXJ0cXVldWVfcGFja2VkKAo+Cj4gICAgICAgICB2cS0+cGFja2VkLm5leHRf
YXZhaWxfaWR4ID0gMDsKPiAgICAgICAgIHZxLT5wYWNrZWQuYXZhaWxfd3JhcF9jb3VudGVyID0g
MTsKPiAtICAgICAgIHZxLT5wYWNrZWQudXNlZF93cmFwX2NvdW50ZXIgPSAxOwo+ICAgICAgICAg
dnEtPnBhY2tlZC5ldmVudF9mbGFnc19zaGFkb3cgPSAwOwo+ICAgICAgICAgdnEtPnBhY2tlZC5h
dmFpbF91c2VkX2ZsYWdzID0gMSA8PCBWUklOR19QQUNLRURfREVTQ19GX0FWQUlMOwo+Cj4gZGlm
ZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC92aXJ0aW9fcmluZy5oIGIvaW5jbHVkZS91YXBp
L2xpbnV4L3ZpcnRpb19yaW5nLmgKPiBpbmRleCA0NzZkM2U1YzBmZTcuLjk2YmNjNGQ1MmZjZSAx
MDA2NDQKPiAtLS0gYS9pbmNsdWRlL3VhcGkvbGludXgvdmlydGlvX3JpbmcuaAo+ICsrKyBiL2lu
Y2x1ZGUvdWFwaS9saW51eC92aXJ0aW9fcmluZy5oCj4gQEAgLTc3LDYgKzc3LDEyIEBACj4gICAq
Lwo+ICAjZGVmaW5lIFZSSU5HX1BBQ0tFRF9FVkVOVF9GX1dSQVBfQ1RSICAxNQo+Cj4gKwo+ICsv
Kgo+ICsgKiB1c2VkIHdyYXAgQ291bnRlciBiaXQgc2hpZnQgaW4gdnEtPmxhc3RfdXNlZF9pZHgg
Zm9yIHBhY2tlZCByaW5nCj4gKyAqLwo+ICsjZGVmaW5lIFZSSU5HX1BBQ0tFRF9VU0VEX0lOREVY
X0ZfV1JBUF9DVFIgIDE1CgpMZXQncyBzaW1wbHkgcmV1c2UgVlJJTkdfUEFDS0VEX0VWRU5UX0Zf
V1JBUF9DVFIgPwoKVGhhbmtzCgo+ICsKPiAgLyogV2Ugc3VwcG9ydCBpbmRpcmVjdCBidWZmZXIg
ZGVzY3JpcHRvcnMgKi8KPiAgI2RlZmluZSBWSVJUSU9fUklOR19GX0lORElSRUNUX0RFU0MgICAg
MjgKPgo+IC0tCj4gMi4zMS4xCj4KCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXphdGlvbkBs
aXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5v
cmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
