Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 5CEE41ECA3F
	for <lists.virtualization@lfdr.de>; Wed,  3 Jun 2020 09:14:15 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 1090C86A9E;
	Wed,  3 Jun 2020 07:14:14 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id duC-z0ngWaZ0; Wed,  3 Jun 2020 07:14:13 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id EFBD886A73;
	Wed,  3 Jun 2020 07:14:12 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id CD001C016E;
	Wed,  3 Jun 2020 07:14:12 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 051FBC016E
 for <virtualization@lists.linux-foundation.org>;
 Wed,  3 Jun 2020 07:14:11 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id DE6AA214E9
 for <virtualization@lists.linux-foundation.org>;
 Wed,  3 Jun 2020 07:14:10 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id wJD+Fxp31HZY
 for <virtualization@lists.linux-foundation.org>;
 Wed,  3 Jun 2020 07:14:08 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from us-smtp-1.mimecast.com (us-smtp-delivery-1.mimecast.com
 [207.211.31.120])
 by silver.osuosl.org (Postfix) with ESMTPS id 35428227C4
 for <virtualization@lists.linux-foundation.org>;
 Wed,  3 Jun 2020 07:14:08 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1591168446;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=7zaS8Jqb5QmbkmzzKzcW4uZAR6vkUApJKGPeFX/uXEU=;
 b=dvml/wtC5klK3Dmja17BFKLwTzRmSSREEbkKoAlD5RqWJkj0e6OOHM8XiaEPhLjAJrN9Y9
 M1T/TCKcFEV90brlXvj2vwH6PIdjmgpsJEzoaPGs13wzumMMD3St3o/u5DKpypq36w3/HP
 of8vuk6MF3b2XOABcPOdH3p86NrRlEI=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-365--IMoj9YpNxiydmzXBRoyBw-1; Wed, 03 Jun 2020 03:14:05 -0400
X-MC-Unique: -IMoj9YpNxiydmzXBRoyBw-1
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id F360D80B72D;
 Wed,  3 Jun 2020 07:14:03 +0000 (UTC)
Received: from [10.72.12.214] (ovpn-12-214.pek2.redhat.com [10.72.12.214])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 1EFC010013D7;
 Wed,  3 Jun 2020 07:13:57 +0000 (UTC)
Subject: Re: [PATCH RFC 01/13] vhost: option to fetch descriptors through an
 independent struct
To: "Michael S. Tsirkin" <mst@redhat.com>, linux-kernel@vger.kernel.org
References: <20200602130543.578420-1-mst@redhat.com>
 <20200602130543.578420-2-mst@redhat.com>
From: Jason Wang <jasowang@redhat.com>
Message-ID: <e35e5df9-7e36-227e-7981-232a62b06607@redhat.com>
Date: Wed, 3 Jun 2020 15:13:56 +0800
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.8.0
MIME-Version: 1.0
In-Reply-To: <20200602130543.578420-2-mst@redhat.com>
Content-Language: en-US
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
Cc: =?UTF-8?Q?Eugenio_P=c3=a9rez?= <eperezma@redhat.com>,
 netdev@vger.kernel.org, kvm@vger.kernel.org,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

Ck9uIDIwMjAvNi8yIOS4i+WNiDk6MDUsIE1pY2hhZWwgUy4gVHNpcmtpbiB3cm90ZToKPiBUaGUg
aWRlYSBpcyB0byBzdXBwb3J0IG11bHRpcGxlIHJpbmcgZm9ybWF0cyBieSBjb252ZXJ0aW5nCj4g
dG8gYSBmb3JtYXQtaW5kZXBlbmRlbnQgYXJyYXkgb2YgZGVzY3JpcHRvcnMuCj4KPiBUaGlzIGNv
c3RzIGV4dHJhIGN5Y2xlcywgYnV0IHdlIGdhaW4gaW4gYWJpbGl0eQo+IHRvIGZldGNoIGEgYmF0
Y2ggb2YgZGVzY3JpcHRvcnMgaW4gb25lIGdvLCB3aGljaAo+IGlzIGdvb2QgZm9yIGNvZGUgY2Fj
aGUgbG9jYWxpdHkuCj4KPiBXaGVuIHVzZWQsIHRoaXMgY2F1c2VzIGEgbWlub3IgcGVyZm9ybWFu
Y2UgZGVncmFkYXRpb24sCj4gaXQncyBiZWVuIGtlcHQgYXMgc2ltcGxlIGFzIHBvc3NpYmxlIGZv
ciBlYXNlIG9mIHJldmlldy4KPiBBIGZvbGxvdy11cCBwYXRjaCBnZXRzIHVzIGJhY2sgdGhlIHBl
cmZvcm1hbmNlIGJ5IGFkZGluZyBiYXRjaGluZy4KPgo+IFRvIHNpbXBsaWZ5IGJlbmNobWFya2lu
ZywgSSBrZXB0IHRoZSBvbGQgY29kZSBhcm91bmQgc28gb25lIGNhbiBzd2l0Y2gKPiBiYWNrIGFu
ZCBmb3J0aCBiZXR3ZWVuIG9sZCBhbmQgbmV3IGNvZGUuIFRoaXMgd2lsbCBnbyBhd2F5IGluIHRo
ZSBmaW5hbAo+IHN1Ym1pc3Npb24uCj4KPiBTaWduZWQtb2ZmLWJ5OiBNaWNoYWVsIFMuIFRzaXJr
aW4gPG1zdEByZWRoYXQuY29tPgo+IFNpZ25lZC1vZmYtYnk6IEV1Z2VuaW8gUMOpcmV6IDxlcGVy
ZXptYUByZWRoYXQuY29tPgo+IExpbms6IGh0dHBzOi8vbG9yZS5rZXJuZWwub3JnL3IvMjAyMDA0
MDExODMxMTguODMzNC0yLWVwZXJlem1hQHJlZGhhdC5jb20KPiBTaWduZWQtb2ZmLWJ5OiBNaWNo
YWVsIFMuIFRzaXJraW4gPG1zdEByZWRoYXQuY29tPgo+IC0tLQo+ICAgZHJpdmVycy92aG9zdC92
aG9zdC5jIHwgMjk3ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrLQo+
ICAgZHJpdmVycy92aG9zdC92aG9zdC5oIHwgIDE2ICsrKwo+ICAgMiBmaWxlcyBjaGFuZ2VkLCAz
MTIgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMv
dmhvc3Qvdmhvc3QuYyBiL2RyaXZlcnMvdmhvc3Qvdmhvc3QuYwo+IGluZGV4IDk2ZDk4NzFmYTBj
Yi4uMTA1ZmM5N2FmMmM4IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvdmhvc3Qvdmhvc3QuYwo+ICsr
KyBiL2RyaXZlcnMvdmhvc3Qvdmhvc3QuYwo+IEBAIC0yOTgsNiArMjk4LDcgQEAgc3RhdGljIHZv
aWQgdmhvc3RfdnFfcmVzZXQoc3RydWN0IHZob3N0X2RldiAqZGV2LAo+ICAgCQkJICAgc3RydWN0
IHZob3N0X3ZpcnRxdWV1ZSAqdnEpCj4gICB7Cj4gICAJdnEtPm51bSA9IDE7Cj4gKwl2cS0+bmRl
c2NzID0gMDsKPiAgIAl2cS0+ZGVzYyA9IE5VTEw7Cj4gICAJdnEtPmF2YWlsID0gTlVMTDsKPiAg
IAl2cS0+dXNlZCA9IE5VTEw7Cj4gQEAgLTM2OCw2ICszNjksOSBAQCBzdGF0aWMgaW50IHZob3N0
X3dvcmtlcih2b2lkICpkYXRhKQo+ICAgCj4gICBzdGF0aWMgdm9pZCB2aG9zdF92cV9mcmVlX2lv
dmVjcyhzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSkKPiAgIHsKPiArCWtmcmVlKHZxLT5kZXNj
cyk7Cj4gKwl2cS0+ZGVzY3MgPSBOVUxMOwo+ICsJdnEtPm1heF9kZXNjcyA9IDA7Cj4gICAJa2Zy
ZWUodnEtPmluZGlyZWN0KTsKPiAgIAl2cS0+aW5kaXJlY3QgPSBOVUxMOwo+ICAgCWtmcmVlKHZx
LT5sb2cpOwo+IEBAIC0zODQsNiArMzg4LDEwIEBAIHN0YXRpYyBsb25nIHZob3N0X2Rldl9hbGxv
Y19pb3ZlY3Moc3RydWN0IHZob3N0X2RldiAqZGV2KQo+ICAgCj4gICAJZm9yIChpID0gMDsgaSA8
IGRldi0+bnZxczsgKytpKSB7Cj4gICAJCXZxID0gZGV2LT52cXNbaV07Cj4gKwkJdnEtPm1heF9k
ZXNjcyA9IGRldi0+aW92X2xpbWl0Owo+ICsJCXZxLT5kZXNjcyA9IGttYWxsb2NfYXJyYXkodnEt
Pm1heF9kZXNjcywKPiArCQkJCQkgIHNpemVvZigqdnEtPmRlc2NzKSwKPiArCQkJCQkgIEdGUF9L
RVJORUwpOwo+ICAgCQl2cS0+aW5kaXJlY3QgPSBrbWFsbG9jX2FycmF5KFVJT19NQVhJT1YsCj4g
ICAJCQkJCSAgICAgc2l6ZW9mKCp2cS0+aW5kaXJlY3QpLAo+ICAgCQkJCQkgICAgIEdGUF9LRVJO
RUwpOwo+IEBAIC0zOTEsNyArMzk5LDcgQEAgc3RhdGljIGxvbmcgdmhvc3RfZGV2X2FsbG9jX2lv
dmVjcyhzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYpCj4gICAJCQkJCUdGUF9LRVJORUwpOwo+ICAgCQl2
cS0+aGVhZHMgPSBrbWFsbG9jX2FycmF5KGRldi0+aW92X2xpbWl0LCBzaXplb2YoKnZxLT5oZWFk
cyksCj4gICAJCQkJCSAgR0ZQX0tFUk5FTCk7Cj4gLQkJaWYgKCF2cS0+aW5kaXJlY3QgfHwgIXZx
LT5sb2cgfHwgIXZxLT5oZWFkcykKPiArCQlpZiAoIXZxLT5pbmRpcmVjdCB8fCAhdnEtPmxvZyB8
fCAhdnEtPmhlYWRzIHx8ICF2cS0+ZGVzY3MpCj4gICAJCQlnb3RvIGVycl9ub21lbTsKPiAgIAl9
Cj4gICAJcmV0dXJuIDA7Cj4gQEAgLTIyNzcsNiArMjI4NSwyOTMgQEAgaW50IHZob3N0X2dldF92
cV9kZXNjKHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxLAo+ICAgfQo+ICAgRVhQT1JUX1NZTUJP
TF9HUEwodmhvc3RfZ2V0X3ZxX2Rlc2MpOwo+ICAgCj4gK3N0YXRpYyBzdHJ1Y3Qgdmhvc3RfZGVz
YyAqcGVla19zcGxpdF9kZXNjKHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZxKQo+ICt7Cj4gKwlC
VUdfT04oIXZxLT5uZGVzY3MpOwo+ICsJcmV0dXJuICZ2cS0+ZGVzY3NbdnEtPm5kZXNjcyAtIDFd
Owo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCBwb3Bfc3BsaXRfZGVzYyhzdHJ1Y3Qgdmhvc3Rfdmly
dHF1ZXVlICp2cSkKPiArewo+ICsJQlVHX09OKCF2cS0+bmRlc2NzKTsKPiArCS0tdnEtPm5kZXNj
czsKPiArfQo+ICsKPiArI2RlZmluZSBWSE9TVF9ERVNDX0ZMQUdTIChWUklOR19ERVNDX0ZfSU5E
SVJFQ1QgfCBWUklOR19ERVNDX0ZfV1JJVEUgfCBcCj4gKwkJCSAgVlJJTkdfREVTQ19GX05FWFQp
Cj4gK3N0YXRpYyBpbnQgcHVzaF9zcGxpdF9kZXNjKHN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKnZx
LCBzdHJ1Y3QgdnJpbmdfZGVzYyAqZGVzYywgdTE2IGlkKQo+ICt7Cj4gKwlzdHJ1Y3Qgdmhvc3Rf
ZGVzYyAqaDsKPiArCj4gKwlpZiAodW5saWtlbHkodnEtPm5kZXNjcyA+PSB2cS0+bWF4X2Rlc2Nz
KSkKPiArCQlyZXR1cm4gLUVJTlZBTDsKPiArCWggPSAmdnEtPmRlc2NzW3ZxLT5uZGVzY3MrK107
Cj4gKwloLT5hZGRyID0gdmhvc3Q2NF90b19jcHUodnEsIGRlc2MtPmFkZHIpOwo+ICsJaC0+bGVu
ID0gdmhvc3QzMl90b19jcHUodnEsIGRlc2MtPmxlbik7Cj4gKwloLT5mbGFncyA9IHZob3N0MTZf
dG9fY3B1KHZxLCBkZXNjLT5mbGFncykgJiBWSE9TVF9ERVNDX0ZMQUdTOwo+ICsJaC0+aWQgPSBp
ZDsKPiArCj4gKwlyZXR1cm4gMDsKPiArfQo+ICsKPiArc3RhdGljIGludCBmZXRjaF9pbmRpcmVj
dF9kZXNjcyhzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSwKPiArCQkJCXN0cnVjdCB2aG9zdF9k
ZXNjICppbmRpcmVjdCwKPiArCQkJCXUxNiBoZWFkKQo+ICt7Cj4gKwlzdHJ1Y3QgdnJpbmdfZGVz
YyBkZXNjOwo+ICsJdW5zaWduZWQgaW50IGkgPSAwLCBjb3VudCwgZm91bmQgPSAwOwo+ICsJdTMy
IGxlbiA9IGluZGlyZWN0LT5sZW47Cj4gKwlzdHJ1Y3QgaW92X2l0ZXIgZnJvbTsKPiArCWludCBy
ZXQ7Cj4gKwo+ICsJLyogU2FuaXR5IGNoZWNrICovCj4gKwlpZiAodW5saWtlbHkobGVuICUgc2l6
ZW9mIGRlc2MpKSB7Cj4gKwkJdnFfZXJyKHZxLCAiSW52YWxpZCBsZW5ndGggaW4gaW5kaXJlY3Qg
ZGVzY3JpcHRvcjogIgo+ICsJCSAgICAgICAibGVuIDB4JWxseCBub3QgbXVsdGlwbGUgb2YgMHgl
enhcbiIsCj4gKwkJICAgICAgICh1bnNpZ25lZCBsb25nIGxvbmcpbGVuLAo+ICsJCSAgICAgICBz
aXplb2YgZGVzYyk7Cj4gKwkJcmV0dXJuIC1FSU5WQUw7Cj4gKwl9Cj4gKwo+ICsJcmV0ID0gdHJh
bnNsYXRlX2Rlc2ModnEsIGluZGlyZWN0LT5hZGRyLCBsZW4sIHZxLT5pbmRpcmVjdCwKPiArCQkJ
ICAgICBVSU9fTUFYSU9WLCBWSE9TVF9BQ0NFU1NfUk8pOwo+ICsJaWYgKHVubGlrZWx5KHJldCA8
IDApKSB7Cj4gKwkJaWYgKHJldCAhPSAtRUFHQUlOKQo+ICsJCQl2cV9lcnIodnEsICJUcmFuc2xh
dGlvbiBmYWlsdXJlICVkIGluIGluZGlyZWN0LlxuIiwgcmV0KTsKPiArCQlyZXR1cm4gcmV0Owo+
ICsJfQo+ICsJaW92X2l0ZXJfaW5pdCgmZnJvbSwgUkVBRCwgdnEtPmluZGlyZWN0LCByZXQsIGxl
bik7Cj4gKwo+ICsJLyogV2Ugd2lsbCB1c2UgdGhlIHJlc3VsdCBhcyBhbiBhZGRyZXNzIHRvIHJl
YWQgZnJvbSwgc28gbW9zdAo+ICsJICogYXJjaGl0ZWN0dXJlcyBvbmx5IG5lZWQgYSBjb21waWxl
ciBiYXJyaWVyIGhlcmUuICovCj4gKwlyZWFkX2JhcnJpZXJfZGVwZW5kcygpOwo+ICsKPiArCWNv
dW50ID0gbGVuIC8gc2l6ZW9mIGRlc2M7Cj4gKwkvKiBCdWZmZXJzIGFyZSBjaGFpbmVkIHZpYSBh
IDE2IGJpdCBuZXh0IGZpZWxkLCBzbwo+ICsJICogd2UgY2FuIGhhdmUgYXQgbW9zdCAyXjE2IG9m
IHRoZXNlLiAqLwo+ICsJaWYgKHVubGlrZWx5KGNvdW50ID4gVVNIUlRfTUFYICsgMSkpIHsKPiAr
CQl2cV9lcnIodnEsICJJbmRpcmVjdCBidWZmZXIgbGVuZ3RoIHRvbyBiaWc6ICVkXG4iLAo+ICsJ
CSAgICAgICBpbmRpcmVjdC0+bGVuKTsKPiArCQlyZXR1cm4gLUUyQklHOwo+ICsJfQo+ICsJaWYg
KHVubGlrZWx5KHZxLT5uZGVzY3MgKyBjb3VudCA+IHZxLT5tYXhfZGVzY3MpKSB7Cj4gKwkJdnFf
ZXJyKHZxLCAiVG9vIG1hbnkgaW5kaXJlY3QgKyBkaXJlY3QgZGVzY3M6ICVkICsgJWRcbiIsCj4g
KwkJICAgICAgIHZxLT5uZGVzY3MsIGluZGlyZWN0LT5sZW4pOwo+ICsJCXJldHVybiAtRTJCSUc7
Cj4gKwl9Cj4gKwo+ICsJZG8gewo+ICsJCWlmICh1bmxpa2VseSgrK2ZvdW5kID4gY291bnQpKSB7
Cj4gKwkJCXZxX2Vycih2cSwgIkxvb3AgZGV0ZWN0ZWQ6IGxhc3Qgb25lIGF0ICV1ICIKPiArCQkJ
ICAgICAgICJpbmRpcmVjdCBzaXplICV1XG4iLAo+ICsJCQkgICAgICAgaSwgY291bnQpOwo+ICsJ
CQlyZXR1cm4gLUVJTlZBTDsKPiArCQl9Cj4gKwkJaWYgKHVubGlrZWx5KCFjb3B5X2Zyb21faXRl
cl9mdWxsKCZkZXNjLCBzaXplb2YoZGVzYyksICZmcm9tKSkpIHsKPiArCQkJdnFfZXJyKHZxLCAi
RmFpbGVkIGluZGlyZWN0IGRlc2NyaXB0b3I6IGlkeCAlZCwgJXp4XG4iLAo+ICsJCQkgICAgICAg
aSwgKHNpemVfdClpbmRpcmVjdC0+YWRkciArIGkgKiBzaXplb2YgZGVzYyk7Cj4gKwkJCXJldHVy
biAtRUlOVkFMOwo+ICsJCX0KPiArCQlpZiAodW5saWtlbHkoZGVzYy5mbGFncyAmIGNwdV90b192
aG9zdDE2KHZxLCBWUklOR19ERVNDX0ZfSU5ESVJFQ1QpKSkgewo+ICsJCQl2cV9lcnIodnEsICJO
ZXN0ZWQgaW5kaXJlY3QgZGVzY3JpcHRvcjogaWR4ICVkLCAlenhcbiIsCj4gKwkJCSAgICAgICBp
LCAoc2l6ZV90KWluZGlyZWN0LT5hZGRyICsgaSAqIHNpemVvZiBkZXNjKTsKPiArCQkJcmV0dXJu
IC1FSU5WQUw7Cj4gKwkJfQo+ICsKPiArCQlwdXNoX3NwbGl0X2Rlc2ModnEsICZkZXNjLCBoZWFk
KTsKCgpUaGUgZXJyb3IgaXMgaWdub3JlZC4KCgo+ICsJfSB3aGlsZSAoKGkgPSBuZXh0X2Rlc2Mo
dnEsICZkZXNjKSkgIT0gLTEpOwo+ICsJcmV0dXJuIDA7Cj4gK30KPiArCj4gK3N0YXRpYyBpbnQg
ZmV0Y2hfZGVzY3Moc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEpCj4gK3sKPiArCXVuc2lnbmVk
IGludCBpLCBoZWFkLCBmb3VuZCA9IDA7Cj4gKwlzdHJ1Y3Qgdmhvc3RfZGVzYyAqbGFzdDsKPiAr
CXN0cnVjdCB2cmluZ19kZXNjIGRlc2M7Cj4gKwlfX3ZpcnRpbzE2IGF2YWlsX2lkeDsKPiArCV9f
dmlydGlvMTYgcmluZ19oZWFkOwo+ICsJdTE2IGxhc3RfYXZhaWxfaWR4Owo+ICsJaW50IHJldDsK
PiArCj4gKwkvKiBDaGVjayBpdCBpc24ndCBkb2luZyB2ZXJ5IHN0cmFuZ2UgdGhpbmdzIHdpdGgg
ZGVzY3JpcHRvciBudW1iZXJzLiAqLwo+ICsJbGFzdF9hdmFpbF9pZHggPSB2cS0+bGFzdF9hdmFp
bF9pZHg7Cj4gKwo+ICsJaWYgKHZxLT5hdmFpbF9pZHggPT0gdnEtPmxhc3RfYXZhaWxfaWR4KSB7
Cj4gKwkJaWYgKHVubGlrZWx5KHZob3N0X2dldF9hdmFpbF9pZHgodnEsICZhdmFpbF9pZHgpKSkg
ewo+ICsJCQl2cV9lcnIodnEsICJGYWlsZWQgdG8gYWNjZXNzIGF2YWlsIGlkeCBhdCAlcFxuIiwK
PiArCQkJCSZ2cS0+YXZhaWwtPmlkeCk7Cj4gKwkJCXJldHVybiAtRUZBVUxUOwo+ICsJCX0KPiAr
CQl2cS0+YXZhaWxfaWR4ID0gdmhvc3QxNl90b19jcHUodnEsIGF2YWlsX2lkeCk7Cj4gKwo+ICsJ
CWlmICh1bmxpa2VseSgodTE2KSh2cS0+YXZhaWxfaWR4IC0gbGFzdF9hdmFpbF9pZHgpID4gdnEt
Pm51bSkpIHsKPiArCQkJdnFfZXJyKHZxLCAiR3Vlc3QgbW92ZWQgdXNlZCBpbmRleCBmcm9tICV1
IHRvICV1IiwKPiArCQkJCWxhc3RfYXZhaWxfaWR4LCB2cS0+YXZhaWxfaWR4KTsKPiArCQkJcmV0
dXJuIC1FRkFVTFQ7Cj4gKwkJfQo+ICsKPiArCQkvKiBJZiB0aGVyZSdzIG5vdGhpbmcgbmV3IHNp
bmNlIGxhc3Qgd2UgbG9va2VkLCByZXR1cm4KPiArCQkgKiBpbnZhbGlkLgo+ICsJCSAqLwo+ICsJ
CWlmICh2cS0+YXZhaWxfaWR4ID09IGxhc3RfYXZhaWxfaWR4KQo+ICsJCQlyZXR1cm4gdnEtPm51
bTsKPiArCj4gKwkJLyogT25seSBnZXQgYXZhaWwgcmluZyBlbnRyaWVzIGFmdGVyIHRoZXkgaGF2
ZSBiZWVuCj4gKwkJICogZXhwb3NlZCBieSBndWVzdC4KPiArCQkgKi8KPiArCQlzbXBfcm1iKCk7
Cj4gKwl9Cj4gKwo+ICsJLyogR3JhYiB0aGUgbmV4dCBkZXNjcmlwdG9yIG51bWJlciB0aGV5J3Jl
IGFkdmVydGlzaW5nICovCj4gKwlpZiAodW5saWtlbHkodmhvc3RfZ2V0X2F2YWlsX2hlYWQodnEs
ICZyaW5nX2hlYWQsIGxhc3RfYXZhaWxfaWR4KSkpIHsKPiArCQl2cV9lcnIodnEsICJGYWlsZWQg
dG8gcmVhZCBoZWFkOiBpZHggJWQgYWRkcmVzcyAlcFxuIiwKPiArCQkgICAgICAgbGFzdF9hdmFp
bF9pZHgsCj4gKwkJICAgICAgICZ2cS0+YXZhaWwtPnJpbmdbbGFzdF9hdmFpbF9pZHggJSB2cS0+
bnVtXSk7Cj4gKwkJcmV0dXJuIC1FRkFVTFQ7Cj4gKwl9Cj4gKwo+ICsJaGVhZCA9IHZob3N0MTZf
dG9fY3B1KHZxLCByaW5nX2hlYWQpOwo+ICsKPiArCS8qIElmIHRoZWlyIG51bWJlciBpcyBzaWxs
eSwgdGhhdCdzIGFuIGVycm9yLiAqLwo+ICsJaWYgKHVubGlrZWx5KGhlYWQgPj0gdnEtPm51bSkp
IHsKPiArCQl2cV9lcnIodnEsICJHdWVzdCBzYXlzIGluZGV4ICV1ID4gJXUgaXMgYXZhaWxhYmxl
IiwKPiArCQkgICAgICAgaGVhZCwgdnEtPm51bSk7Cj4gKwkJcmV0dXJuIC1FSU5WQUw7Cj4gKwl9
Cj4gKwo+ICsJaSA9IGhlYWQ7Cj4gKwlkbyB7Cj4gKwkJaWYgKHVubGlrZWx5KGkgPj0gdnEtPm51
bSkpIHsKPiArCQkJdnFfZXJyKHZxLCAiRGVzYyBpbmRleCBpcyAldSA+ICV1LCBoZWFkID0gJXUi
LAo+ICsJCQkgICAgICAgaSwgdnEtPm51bSwgaGVhZCk7Cj4gKwkJCXJldHVybiAtRUlOVkFMOwo+
ICsJCX0KPiArCQlpZiAodW5saWtlbHkoKytmb3VuZCA+IHZxLT5udW0pKSB7Cj4gKwkJCXZxX2Vy
cih2cSwgIkxvb3AgZGV0ZWN0ZWQ6IGxhc3Qgb25lIGF0ICV1ICIKPiArCQkJICAgICAgICJ2cSBz
aXplICV1IGhlYWQgJXVcbiIsCj4gKwkJCSAgICAgICBpLCB2cS0+bnVtLCBoZWFkKTsKPiArCQkJ
cmV0dXJuIC1FSU5WQUw7Cj4gKwkJfQo+ICsJCXJldCA9IHZob3N0X2dldF9kZXNjKHZxLCAmZGVz
YywgaSk7Cj4gKwkJaWYgKHVubGlrZWx5KHJldCkpIHsKPiArCQkJdnFfZXJyKHZxLCAiRmFpbGVk
IHRvIGdldCBkZXNjcmlwdG9yOiBpZHggJWQgYWRkciAlcFxuIiwKPiArCQkJICAgICAgIGksIHZx
LT5kZXNjICsgaSk7Cj4gKwkJCXJldHVybiAtRUZBVUxUOwo+ICsJCX0KPiArCQlyZXQgPSBwdXNo
X3NwbGl0X2Rlc2ModnEsICZkZXNjLCBoZWFkKTsKPiArCQlpZiAodW5saWtlbHkocmV0KSkgewo+
ICsJCQl2cV9lcnIodnEsICJGYWlsZWQgdG8gc2F2ZSBkZXNjcmlwdG9yOiBpZHggJWRcbiIsIGkp
Owo+ICsJCQlyZXR1cm4gLUVJTlZBTDsKPiArCQl9Cj4gKwl9IHdoaWxlICgoaSA9IG5leHRfZGVz
Yyh2cSwgJmRlc2MpKSAhPSAtMSk7Cj4gKwo+ICsJbGFzdCA9IHBlZWtfc3BsaXRfZGVzYyh2cSk7
Cj4gKwlpZiAodW5saWtlbHkobGFzdC0+ZmxhZ3MgJiBWUklOR19ERVNDX0ZfSU5ESVJFQ1QpKSB7
Cj4gKwkJcG9wX3NwbGl0X2Rlc2ModnEpOwo+ICsJCXJldCA9IGZldGNoX2luZGlyZWN0X2Rlc2Nz
KHZxLCBsYXN0LCBoZWFkKTsKCgpOb3RlIHRoYXQgdGhpcyBtZWFucyB3ZSBkb24ndCBzdXBwb3J0
ZWQgY2hhaW5lZCBpbmRpcmVjdCBkZXNjcmlwdG9ycyAKd2hpY2ggY29tcGxpZXMgdGhlIHNwZWMg
YnV0IHdlIHN1cHBvcnQgdGhpcyBpbiB2aG9zdF9nZXRfdnFfZGVzYygpLgoKV2UgcHJvYmFibHkg
bmVlZCBlaXRoZXIgZmFpbCBlYXJseSBvciBqdXN0IHN1cHBvcnQgdGhhdC4KClRoYW5rcwoKCj4g
KwkJaWYgKHVubGlrZWx5KHJldCA8IDApKSB7Cj4gKwkJCWlmIChyZXQgIT0gLUVBR0FJTikKPiAr
CQkJCXZxX2Vycih2cSwgIkZhaWx1cmUgZGV0ZWN0ZWQgIgo+ICsJCQkJICAgICAgICJpbiBpbmRp
cmVjdCBkZXNjcmlwdG9yIGF0IGlkeCAlZFxuIiwgaGVhZCk7Cj4gKwkJCXJldHVybiByZXQ7Cj4g
KwkJfQo+ICsJfQo+ICsKPiArCS8qIEFzc3VtZSBub3RpZmljYXRpb25zIGZyb20gZ3Vlc3QgYXJl
IGRpc2FibGVkIGF0IHRoaXMgcG9pbnQsCj4gKwkgKiBpZiB0aGV5IGFyZW4ndCB3ZSB3b3VsZCBu
ZWVkIHRvIHVwZGF0ZSBhdmFpbF9ldmVudCBpbmRleC4gKi8KPiArCUJVR19PTighKHZxLT51c2Vk
X2ZsYWdzICYgVlJJTkdfVVNFRF9GX05PX05PVElGWSkpOwo+ICsKPiArCS8qIE9uIHN1Y2Nlc3Ms
IGluY3JlbWVudCBhdmFpbCBpbmRleC4gKi8KPiArCXZxLT5sYXN0X2F2YWlsX2lkeCsrOwo+ICsK
PiArCXJldHVybiAwOwo+ICt9Cj4gKwo+ICsvKiBUaGlzIGxvb2tzIGluIHRoZSB2aXJ0cXVldWUg
YW5kIGZvciB0aGUgZmlyc3QgYXZhaWxhYmxlIGJ1ZmZlciwgYW5kIGNvbnZlcnRzCj4gKyAqIGl0
IHRvIGFuIGlvdmVjIGZvciBjb252ZW5pZW50IGFjY2Vzcy4gIFNpbmNlIGRlc2NyaXB0b3JzIGNv
bnNpc3Qgb2Ygc29tZQo+ICsgKiBudW1iZXIgb2Ygb3V0cHV0IHRoZW4gc29tZSBudW1iZXIgb2Yg
aW5wdXQgZGVzY3JpcHRvcnMsIGl0J3MgYWN0dWFsbHkgdHdvCj4gKyAqIGlvdmVjcywgYnV0IHdl
IHBhY2sgdGhlbSBpbnRvIG9uZSBhbmQgbm90ZSBob3cgbWFueSBvZiBlYWNoIHRoZXJlIHdlcmUu
Cj4gKyAqCj4gKyAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgZGVzY3JpcHRvciBudW1iZXIg
Zm91bmQsIG9yIHZxLT5udW0gKHdoaWNoIGlzCj4gKyAqIG5ldmVyIGEgdmFsaWQgZGVzY3JpcHRv
ciBudW1iZXIpIGlmIG5vbmUgd2FzIGZvdW5kLiAgQSBuZWdhdGl2ZSBjb2RlIGlzCj4gKyAqIHJl
dHVybmVkIG9uIGVycm9yLiAqLwo+ICtpbnQgdmhvc3RfZ2V0X3ZxX2Rlc2NfYmF0Y2goc3RydWN0
IHZob3N0X3ZpcnRxdWV1ZSAqdnEsCj4gKwkJICAgICAgc3RydWN0IGlvdmVjIGlvdltdLCB1bnNp
Z25lZCBpbnQgaW92X3NpemUsCj4gKwkJICAgICAgdW5zaWduZWQgaW50ICpvdXRfbnVtLCB1bnNp
Z25lZCBpbnQgKmluX251bSwKPiArCQkgICAgICBzdHJ1Y3Qgdmhvc3RfbG9nICpsb2csIHVuc2ln
bmVkIGludCAqbG9nX251bSkKPiArewo+ICsJaW50IHJldCA9IGZldGNoX2Rlc2NzKHZxKTsKPiAr
CWludCBpOwo+ICsKPiArCWlmIChyZXQpCj4gKwkJcmV0dXJuIHJldDsKPiArCj4gKwkvKiBOb3cg
Y29udmVydCB0byBJT1YgKi8KPiArCS8qIFdoZW4gd2Ugc3RhcnQgdGhlcmUgYXJlIG5vbmUgb2Yg
ZWl0aGVyIGlucHV0IG5vciBvdXRwdXQuICovCj4gKwkqb3V0X251bSA9ICppbl9udW0gPSAwOwo+
ICsJaWYgKHVubGlrZWx5KGxvZykpCj4gKwkJKmxvZ19udW0gPSAwOwo+ICsKPiArCWZvciAoaSA9
IDA7IGkgPCB2cS0+bmRlc2NzOyArK2kpIHsKPiArCQl1bnNpZ25lZCBpb3ZfY291bnQgPSAqaW5f
bnVtICsgKm91dF9udW07Cj4gKwkJc3RydWN0IHZob3N0X2Rlc2MgKmRlc2MgPSAmdnEtPmRlc2Nz
W2ldOwo+ICsJCWludCBhY2Nlc3M7Cj4gKwo+ICsJCWlmIChkZXNjLT5mbGFncyAmIH5WSE9TVF9E
RVNDX0ZMQUdTKSB7Cj4gKwkJCXZxX2Vycih2cSwgIlVuZXhwZWN0ZWQgZmxhZ3M6IDB4JXggYXQg
ZGVzY3JpcHRvciBpZCAweCV4XG4iLAo+ICsJCQkgICAgICAgZGVzYy0+ZmxhZ3MsIGRlc2MtPmlk
KTsKPiArCQkJcmV0ID0gLUVJTlZBTDsKPiArCQkJZ290byBlcnI7Cj4gKwkJfQo+ICsJCWlmIChk
ZXNjLT5mbGFncyAmIFZSSU5HX0RFU0NfRl9XUklURSkKPiArCQkJYWNjZXNzID0gVkhPU1RfQUND
RVNTX1dPOwo+ICsJCWVsc2UKPiArCQkJYWNjZXNzID0gVkhPU1RfQUNDRVNTX1JPOwo+ICsJCXJl
dCA9IHRyYW5zbGF0ZV9kZXNjKHZxLCBkZXNjLT5hZGRyLAo+ICsJCQkJICAgICBkZXNjLT5sZW4s
IGlvdiArIGlvdl9jb3VudCwKPiArCQkJCSAgICAgaW92X3NpemUgLSBpb3ZfY291bnQsIGFjY2Vz
cyk7Cj4gKwkJaWYgKHVubGlrZWx5KHJldCA8IDApKSB7Cj4gKwkJCWlmIChyZXQgIT0gLUVBR0FJ
TikKPiArCQkJCXZxX2Vycih2cSwgIlRyYW5zbGF0aW9uIGZhaWx1cmUgJWQgZGVzY3JpcHRvciBp
ZHggJWRcbiIsCj4gKwkJCQkJcmV0LCBpKTsKPiArCQkJZ290byBlcnI7Cj4gKwkJfQo+ICsJCWlm
IChhY2Nlc3MgPT0gVkhPU1RfQUNDRVNTX1dPKSB7Cj4gKwkJCS8qIElmIHRoaXMgaXMgYW4gaW5w
dXQgZGVzY3JpcHRvciwKPiArCQkJICogaW5jcmVtZW50IHRoYXQgY291bnQuICovCj4gKwkJCSpp
bl9udW0gKz0gcmV0Owo+ICsJCQlpZiAodW5saWtlbHkobG9nICYmIHJldCkpIHsKPiArCQkJCWxv
Z1sqbG9nX251bV0uYWRkciA9IGRlc2MtPmFkZHI7Cj4gKwkJCQlsb2dbKmxvZ19udW1dLmxlbiA9
IGRlc2MtPmxlbjsKPiArCQkJCSsrKmxvZ19udW07Cj4gKwkJCX0KPiArCQl9IGVsc2Ugewo+ICsJ
CQkvKiBJZiBpdCdzIGFuIG91dHB1dCBkZXNjcmlwdG9yLCB0aGV5J3JlIGFsbCBzdXBwb3NlZAo+
ICsJCQkgKiB0byBjb21lIGJlZm9yZSBhbnkgaW5wdXQgZGVzY3JpcHRvcnMuICovCj4gKwkJCWlm
ICh1bmxpa2VseSgqaW5fbnVtKSkgewo+ICsJCQkJdnFfZXJyKHZxLCAiRGVzY3JpcHRvciBoYXMg
b3V0IGFmdGVyIGluOiAiCj4gKwkJCQkgICAgICAgImlkeCAlZFxuIiwgaSk7Cj4gKwkJCQlyZXQg
PSAtRUlOVkFMOwo+ICsJCQkJZ290byBlcnI7Cj4gKwkJCX0KPiArCQkJKm91dF9udW0gKz0gcmV0
Owo+ICsJCX0KPiArCj4gKwkJcmV0ID0gZGVzYy0+aWQ7Cj4gKwl9Cj4gKwo+ICsJdnEtPm5kZXNj
cyA9IDA7Cj4gKwo+ICsJcmV0dXJuIHJldDsKPiArCj4gK2VycjoKPiArCXZob3N0X2Rpc2NhcmRf
dnFfZGVzYyh2cSwgMSk7Cj4gKwl2cS0+bmRlc2NzID0gMDsKPiArCj4gKwlyZXR1cm4gcmV0Owo+
ICt9Cj4gK0VYUE9SVF9TWU1CT0xfR1BMKHZob3N0X2dldF92cV9kZXNjX2JhdGNoKTsKPiArCj4g
ICAvKiBSZXZlcnNlIHRoZSBlZmZlY3Qgb2Ygdmhvc3RfZ2V0X3ZxX2Rlc2MuIFVzZWZ1bCBmb3Ig
ZXJyb3IgaGFuZGxpbmcuICovCj4gICB2b2lkIHZob3N0X2Rpc2NhcmRfdnFfZGVzYyhzdHJ1Y3Qg
dmhvc3RfdmlydHF1ZXVlICp2cSwgaW50IG4pCj4gICB7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMv
dmhvc3Qvdmhvc3QuaCBiL2RyaXZlcnMvdmhvc3Qvdmhvc3QuaAo+IGluZGV4IDYwY2FiNGM3ODIy
OS4uMDk3NmEyODUzOTM1IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvdmhvc3Qvdmhvc3QuaAo+ICsr
KyBiL2RyaXZlcnMvdmhvc3Qvdmhvc3QuaAo+IEBAIC02MCw2ICs2MCwxMyBAQCBlbnVtIHZob3N0
X3VhZGRyX3R5cGUgewo+ICAgCVZIT1NUX05VTV9BRERSUyA9IDMsCj4gICB9Owo+ICAgCj4gK3N0
cnVjdCB2aG9zdF9kZXNjIHsKPiArCXU2NCBhZGRyOwo+ICsJdTMyIGxlbjsKPiArCXUxNiBmbGFn
czsgLyogVlJJTkdfREVTQ19GX1dSSVRFLCBWUklOR19ERVNDX0ZfTkVYVCAqLwo+ICsJdTE2IGlk
Owo+ICt9Owo+ICsKPiAgIC8qIFRoZSB2aXJ0cXVldWUgc3RydWN0dXJlIGRlc2NyaWJlcyBhIHF1
ZXVlIGF0dGFjaGVkIHRvIGEgZGV2aWNlLiAqLwo+ICAgc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSB7
Cj4gICAJc3RydWN0IHZob3N0X2RldiAqZGV2Owo+IEBAIC03MSw2ICs3OCwxMSBAQCBzdHJ1Y3Qg
dmhvc3RfdmlydHF1ZXVlIHsKPiAgIAl2cmluZ19hdmFpbF90IF9fdXNlciAqYXZhaWw7Cj4gICAJ
dnJpbmdfdXNlZF90IF9fdXNlciAqdXNlZDsKPiAgIAljb25zdCBzdHJ1Y3Qgdmhvc3RfaW90bGJf
bWFwICptZXRhX2lvdGxiW1ZIT1NUX05VTV9BRERSU107Cj4gKwo+ICsJc3RydWN0IHZob3N0X2Rl
c2MgKmRlc2NzOwo+ICsJaW50IG5kZXNjczsKPiArCWludCBtYXhfZGVzY3M7Cj4gKwo+ICAgCXN0
cnVjdCBmaWxlICpraWNrOwo+ICAgCXN0cnVjdCBldmVudGZkX2N0eCAqY2FsbF9jdHg7Cj4gICAJ
c3RydWN0IGV2ZW50ZmRfY3R4ICplcnJvcl9jdHg7Cj4gQEAgLTE3NSw2ICsxODcsMTAgQEAgbG9u
ZyB2aG9zdF92cmluZ19pb2N0bChzdHJ1Y3Qgdmhvc3RfZGV2ICpkLCB1bnNpZ25lZCBpbnQgaW9j
dGwsIHZvaWQgX191c2VyICphcmcKPiAgIGJvb2wgdmhvc3RfdnFfYWNjZXNzX29rKHN0cnVjdCB2
aG9zdF92aXJ0cXVldWUgKnZxKTsKPiAgIGJvb2wgdmhvc3RfbG9nX2FjY2Vzc19vayhzdHJ1Y3Qg
dmhvc3RfZGV2ICopOwo+ICAgCj4gK2ludCB2aG9zdF9nZXRfdnFfZGVzY19iYXRjaChzdHJ1Y3Qg
dmhvc3RfdmlydHF1ZXVlICosCj4gKwkJICAgICAgc3RydWN0IGlvdmVjIGlvdltdLCB1bnNpZ25l
ZCBpbnQgaW92X2NvdW50LAo+ICsJCSAgICAgIHVuc2lnbmVkIGludCAqb3V0X251bSwgdW5zaWdu
ZWQgaW50ICppbl9udW0sCj4gKwkJICAgICAgc3RydWN0IHZob3N0X2xvZyAqbG9nLCB1bnNpZ25l
ZCBpbnQgKmxvZ19udW0pOwo+ICAgaW50IHZob3N0X2dldF92cV9kZXNjKHN0cnVjdCB2aG9zdF92
aXJ0cXVldWUgKiwKPiAgIAkJICAgICAgc3RydWN0IGlvdmVjIGlvdltdLCB1bnNpZ25lZCBpbnQg
aW92X2NvdW50LAo+ICAgCQkgICAgICB1bnNpZ25lZCBpbnQgKm91dF9udW0sIHVuc2lnbmVkIGlu
dCAqaW5fbnVtLAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4
LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
