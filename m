Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id B4413155DF3
	for <lists.virtualization@lfdr.de>; Fri,  7 Feb 2020 19:26:05 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 5E70786A47;
	Fri,  7 Feb 2020 18:26:04 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id SAG6_57CDKr4; Fri,  7 Feb 2020 18:26:00 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 8262A86972;
	Fri,  7 Feb 2020 18:25:58 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 6CD15C013E;
	Fri,  7 Feb 2020 18:25:58 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 083C7C1D89
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:55 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by fraxinus.osuosl.org (Postfix) with ESMTP id DE50086935
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:54 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id b8DMR_Ktheg6
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:54 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by fraxinus.osuosl.org (Postfix) with ESMTPS id AE66586914
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:53 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 53C00305D359; Fri,  7 Feb 2020 20:16:41 +0200 (EET)
Received: from host.bbu.bitdefender.biz (unknown [195.210.4.22])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 3B2023052070;
 Fri,  7 Feb 2020 20:16:41 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [RFC PATCH v7 59/78] KVM: introspection: restore the state of #BP
 interception on unhook
Date: Fri,  7 Feb 2020 20:16:17 +0200
Message-Id: <20200207181636.1065-60-alazar@bitdefender.com>
In-Reply-To: <20200207181636.1065-1-alazar@bitdefender.com>
References: <20200207181636.1065-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <ncitu@bitdefender.com>,
 Sean Christopherson <sean.j.christopherson@intel.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTmljdciZb3IgQ8OuyJt1IDxuY2l0dUBiaXRkZWZlbmRlci5jb20+CgpUaGlzIGNvbW1p
dCBhbHNvIGVuc3VyZXMgdGhhdCBvbmx5IHRoZSB1c2Vyc3BhY2Ugb3IgdGhlIGludHJvc3BlY3Rp
b24KdG9vbCBjYW4gY29udHJvbCB0aGUgI0JQIGludGVyY2VwdGlvbiBleGNsdXNpdmVseSBhdCBv
bmUgdGltZS4KClNpZ25lZC1vZmYtYnk6IE5pY3XImW9yIEPDrsibdSA8bmNpdHVAYml0ZGVmZW5k
ZXIuY29tPgpTaWduZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRl
ci5jb20+Ci0tLQogYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaCAgIHwgIDMgKwogYXJj
aC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmggIHwgMjIgKysrKysrKwogYXJjaC94ODYva3Zt
L2t2bWkuYyAgICAgICAgICAgICAgIHwgOTkgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
LQogYXJjaC94ODYva3ZtL3g4Ni5jICAgICAgICAgICAgICAgIHwgIDUgKysKIHZpcnQva3ZtL2lu
dHJvc3BlY3Rpb24va3ZtaS5jICAgICB8IDI3ICsrKysrKysrLQogdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pX2ludC5oIHwgIDYgKy0KIDYgZmlsZXMgY2hhbmdlZCwgMTU3IGluc2VydGlvbnMo
KyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3Zt
X2hvc3QuaCBiL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmgKaW5kZXggOWNmNDVjYTcz
YWY1Li5mYmQ5ZWNjNDExNzcgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bV9o
b3N0LmgKKysrIGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaApAQCAtODE1LDYgKzgx
NSw5IEBAIHN0cnVjdCBrdm1fdmNwdV9hcmNoIHsKIAogCS8qICNQRiB0cmFuc2xhdGVkIGVycm9y
IGNvZGUgZnJvbSBFUFQvTlBUIGV4aXQgcmVhc29uICovCiAJdTY0IGVycm9yX2NvZGU7CisKKwkv
KiBDb250cm9sIHRoZSBpbnRlcmNlcHRpb24gZm9yIEtWTSBJbnRyb3NwZWN0aW9uICovCisJc3Ry
dWN0IGt2bWlfaW50ZXJjZXB0aW9uICprdm1pOwogfTsKIAogc3RydWN0IGt2bV9scGFnZV9pbmZv
IHsKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oIGIvYXJjaC94
ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmgKaW5kZXggMzYwYTU3ZGQ5MDE5Li5jOGI3OTM5MTVi
ODQgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCisrKyBiL2Fy
Y2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCkBAIC0yLDEwICsyLDMyIEBACiAjaWZuZGVm
IF9BU01fWDg2X0tWTUlfSE9TVF9ICiAjZGVmaW5lIF9BU01fWDg2X0tWTUlfSE9TVF9ICiAKK3N0
cnVjdCBrdm1pX21vbml0b3JfaW50ZXJjZXB0aW9uIHsKKwlib29sIGt2bWlfaW50ZXJjZXB0ZWQ7
CisJYm9vbCBrdm1faW50ZXJjZXB0ZWQ7CisJYm9vbCAoKm1vbml0b3JfZmN0KShzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsIGJvb2wgZW5hYmxlKTsKK307CisKK3N0cnVjdCBrdm1pX2ludGVyY2VwdGlv
biB7CisJYm9vbCByZXN0b3JlX2ludGVyY2VwdGlvbjsKKwlzdHJ1Y3Qga3ZtaV9tb25pdG9yX2lu
dGVyY2VwdGlvbiBicmVha3BvaW50OworfTsKKwogc3RydWN0IGt2bV92Y3B1X2FyY2hfaW50cm9z
cGVjdGlvbiB7CiB9OwogCiBzdHJ1Y3Qga3ZtX2FyY2hfaW50cm9zcGVjdGlvbiB7CiB9OwogCisj
aWZkZWYgQ09ORklHX0tWTV9JTlRST1NQRUNUSU9OCisKK2Jvb2wga3ZtaV9tb25pdG9yX2JwX2lu
dGVyY2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUzMiBkYmcpOworCisjZWxzZSAvKiBDT05G
SUdfS1ZNX0lOVFJPU1BFQ1RJT04gKi8KKworc3RhdGljIGlubGluZSBib29sIGt2bWlfbW9uaXRv
cl9icF9pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgZGJnKQorCXsgcmV0dXJu
IGZhbHNlOyB9CisKKyNlbmRpZiAvKiBDT05GSUdfS1ZNX0lOVFJPU1BFQ1RJT04gKi8KKwogI2Vu
ZGlmIC8qIF9BU01fWDg2X0tWTUlfSE9TVF9IICovCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0v
a3ZtaS5jIGIvYXJjaC94ODYva3ZtL2t2bWkuYwppbmRleCAyYzhjMDYyYTRiMTEuLjU0YWJhZjQx
NmZmMyAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL2t2bWkuYworKysgYi9hcmNoL3g4Ni9rdm0v
a3ZtaS5jCkBAIC0xOTMsMTggKzE5Myw3MSBAQCB2b2lkIGt2bWlfYXJjaF9oeXBlcmNhbGxfZXZl
bnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQogCX0KIH0KIAorLyoKKyAqIFJldHVybnMgdHJ1ZSBp
ZiBvbmUgc2lkZSAoa3ZtIG9yIGt2bWkpIHRyaWVzIHRvIGVuYWJsZS9kaXNhYmxlIHRoZSBicmVh
a3BvaW50CisgKiBpbnRlcmNlcHRpb24gd2hpbGUgdGhlIG90aGVyIHNpZGUgaXMgc3RpbGwgdHJh
Y2tpbmcgaXQuCisgKi8KK2Jvb2wga3ZtaV9tb25pdG9yX2JwX2ludGVyY2VwdChzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsIHUzMiBkYmcpCit7CisJdTMyIGJwX21hc2sgPSBLVk1fR1VFU1REQkdfRU5B
QkxFIHwgS1ZNX0dVRVNUREJHX1VTRV9TV19CUDsKKwlzdHJ1Y3Qga3ZtaV9pbnRlcmNlcHRpb24g
KmFyY2hfdmNwdWkgPSBSRUFEX09OQ0UodmNwdS0+YXJjaC5rdm1pKTsKKwlib29sIGVuYWJsZSA9
IGZhbHNlOworCisJaWYgKChkYmcgJiBicF9tYXNrKSA9PSBicF9tYXNrKQorCQllbmFibGUgPSB0
cnVlOworCisJcmV0dXJuIChhcmNoX3ZjcHVpICYmIGFyY2hfdmNwdWktPmJyZWFrcG9pbnQubW9u
aXRvcl9mY3QodmNwdSwgZW5hYmxlKSk7Cit9CitFWFBPUlRfU1lNQk9MKGt2bWlfbW9uaXRvcl9i
cF9pbnRlcmNlcHQpOworCitzdGF0aWMgYm9vbCBtb25pdG9yX2JwX2ZjdF9rdm1pKHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSwgYm9vbCBlbmFibGUpCit7CisJaWYgKGVuYWJsZSkgeworCQlpZiAoa3Zt
X3g4Nl9vcHMtPmJwX2ludGVyY2VwdGVkKHZjcHUpKQorCQkJcmV0dXJuIHRydWU7CisJfSBlbHNl
IGlmICghdmNwdS0+YXJjaC5rdm1pLT5icmVha3BvaW50Lmt2bWlfaW50ZXJjZXB0ZWQpCisJCXJl
dHVybiB0cnVlOworCisJdmNwdS0+YXJjaC5rdm1pLT5icmVha3BvaW50Lmt2bWlfaW50ZXJjZXB0
ZWQgPSBlbmFibGU7CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKK3N0YXRpYyBib29sIG1vbml0b3Jf
YnBfZmN0X2t2bShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGJvb2wgZW5hYmxlKQoreworCWlmIChl
bmFibGUpIHsKKwkJaWYgKGt2bV94ODZfb3BzLT5icF9pbnRlcmNlcHRlZCh2Y3B1KSkKKwkJCXJl
dHVybiB0cnVlOworCX0gZWxzZSBpZiAoIXZjcHUtPmFyY2gua3ZtaS0+YnJlYWtwb2ludC5rdm1f
aW50ZXJjZXB0ZWQpCisJCXJldHVybiB0cnVlOworCisJdmNwdS0+YXJjaC5rdm1pLT5icmVha3Bv
aW50Lmt2bV9pbnRlcmNlcHRlZCA9IGVuYWJsZTsKKworCXJldHVybiBmYWxzZTsKK30KKwogc3Rh
dGljIGludCBrdm1pX2NvbnRyb2xfYnBfaW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwg
Ym9vbCBlbmFibGUpCiB7CiAJc3RydWN0IGt2bV9ndWVzdF9kZWJ1ZyBkYmcgPSB7fTsKIAlpbnQg
ZXJyID0gMDsKIAorCXZjcHUtPmFyY2gua3ZtaS0+YnJlYWtwb2ludC5tb25pdG9yX2ZjdCA9IG1v
bml0b3JfYnBfZmN0X2t2bWk7CiAJaWYgKGVuYWJsZSkKIAkJZGJnLmNvbnRyb2wgPSBLVk1fR1VF
U1REQkdfRU5BQkxFIHwgS1ZNX0dVRVNUREJHX1VTRV9TV19CUDsKIAllcnIgPSBrdm1fYXJjaF92
Y3B1X3NldF9ndWVzdF9kZWJ1Zyh2Y3B1LCAmZGJnKTsKKwl2Y3B1LT5hcmNoLmt2bWktPmJyZWFr
cG9pbnQubW9uaXRvcl9mY3QgPSBtb25pdG9yX2JwX2ZjdF9rdm07CiAKIAlyZXR1cm4gZXJyOwog
fQogCitzdGF0aWMgdm9pZCBrdm1pX2FyY2hfZGlzYWJsZV9icF9pbnRlcmNlcHQoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1KQoreworCWt2bWlfY29udHJvbF9icF9pbnRlcmNlcHQodmNwdSwgZmFsc2Up
OworCisJdmNwdS0+YXJjaC5rdm1pLT5icmVha3BvaW50Lmt2bWlfaW50ZXJjZXB0ZWQgPSBmYWxz
ZTsKKwl2Y3B1LT5hcmNoLmt2bWktPmJyZWFrcG9pbnQua3ZtX2ludGVyY2VwdGVkID0gZmFsc2U7
Cit9CisKIGludCBrdm1pX2FyY2hfY21kX2NvbnRyb2xfaW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwKIAkJCQkgICAgdW5zaWduZWQgaW50IGV2ZW50X2lkLCBib29sIGVuYWJsZSkKIHsK
QEAgLTI0MSw2ICsyOTQsNTAgQEAgdm9pZCBrdm1pX2FyY2hfYnJlYWtwb2ludF9ldmVudChzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUsIHU2NCBndmEsIHU4IGluc25fbGVuKQogCX0KIH0KIAotdm9pZCBr
dm1pX2FyY2hfcmVzdG9yZV9pbnRlcmNlcHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQorYm9v
bCBrdm1pX2FyY2hfcmVzdG9yZV9pbnRlcmNlcHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQog
eworCXN0cnVjdCBrdm1pX2ludGVyY2VwdGlvbiAqYXJjaF92Y3B1aSA9IHZjcHUtPmFyY2gua3Zt
aTsKKworCWlmICghYXJjaF92Y3B1aSB8fCAhYXJjaF92Y3B1aS0+cmVzdG9yZV9pbnRlcmNlcHRp
b24pCisJCXJldHVybiBmYWxzZTsKKworCWt2bWlfYXJjaF9kaXNhYmxlX2JwX2ludGVyY2VwdCh2
Y3B1KTsKKworCXJldHVybiB0cnVlOworfQorCitib29sIGt2bWlfYXJjaF92Y3B1X2FsbG9jKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSkKK3sKKwlzdHJ1Y3Qga3ZtaV9pbnRlcmNlcHRpb24gKmFyY2hf
dmNwdWk7CisKKwlhcmNoX3ZjcHVpID0ga3phbGxvYyhzaXplb2YoKmFyY2hfdmNwdWkpLCBHRlBf
S0VSTkVMKTsKKwlpZiAoIWFyY2hfdmNwdWkpCisJCXJldHVybiBmYWxzZTsKKworCWFyY2hfdmNw
dWktPmJyZWFrcG9pbnQubW9uaXRvcl9mY3QgPSBtb25pdG9yX2JwX2ZjdF9rdm07CisKKwkvKiBw
YWlyIHdpdGgga3ZtaV9tb25pdG9yX2JwX2ludGVyY2VwdCgpICovCisJc21wX3dtYigpOworCVdS
SVRFX09OQ0UodmNwdS0+YXJjaC5rdm1pLCBhcmNoX3ZjcHVpKTsKKworCXJldHVybiB0cnVlOwor
fQorCit2b2lkIGt2bWlfYXJjaF92Y3B1X2ZyZWUoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KQorewor
CWtmcmVlKHZjcHUtPmFyY2gua3ZtaSk7CisJV1JJVEVfT05DRSh2Y3B1LT5hcmNoLmt2bWksIE5V
TEwpOworfQorCitib29sIGt2bWlfYXJjaF92Y3B1X2ludHJvc3BlY3RlZChzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUpCit7CisJcmV0dXJuICEhUkVBRF9PTkNFKHZjcHUtPmFyY2gua3ZtaSk7Cit9CisK
K3ZvaWQga3ZtaV9hcmNoX3JlcXVlc3RfcmVzdG9yZV9pbnRlcmNlcHRpb24oc3RydWN0IGt2bV92
Y3B1ICp2Y3B1KQoreworCXN0cnVjdCBrdm1pX2ludGVyY2VwdGlvbiAqYXJjaF92Y3B1aSA9IFJF
QURfT05DRSh2Y3B1LT5hcmNoLmt2bWkpOworCisJaWYgKGFyY2hfdmNwdWkpCisJCWFyY2hfdmNw
dWktPnJlc3RvcmVfaW50ZXJjZXB0aW9uID0gdHJ1ZTsKIH0KZGlmZiAtLWdpdCBhL2FyY2gveDg2
L2t2bS94ODYuYyBiL2FyY2gveDg2L2t2bS94ODYuYwppbmRleCBiNGE3ODA1Y2U5ZTQuLmEzYWZi
YmI3MTk5ZiAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL3g4Ni5jCisrKyBiL2FyY2gveDg2L2t2
bS94ODYuYwpAQCAtODk5Myw2ICs4OTkzLDExIEBAIGludCBrdm1fYXJjaF92Y3B1X3NldF9ndWVz
dF9kZWJ1ZyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQlrdm1fcXVldWVfZXhjZXB0aW9uKHZj
cHUsIEJQX1ZFQ1RPUik7CiAJfQogCisJaWYgKGt2bWlfbW9uaXRvcl9icF9pbnRlcmNlcHQodmNw
dSwgZGJnLT5jb250cm9sKSkgeworCQlyID0gLUVCVVNZOworCQlnb3RvIG91dDsKKwl9CisKIAkv
KgogCSAqIFJlYWQgcmZsYWdzIGFzIGxvbmcgYXMgcG90ZW50aWFsbHkgaW5qZWN0ZWQgdHJhY2Ug
ZmxhZ3MgYXJlIHN0aWxsCiAJICogZmlsdGVyZWQgb3V0LgpkaWZmIC0tZ2l0IGEvdmlydC9rdm0v
aW50cm9zcGVjdGlvbi9rdm1pLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwppbmRl
eCAxOWVhOTRkYzBlMWQuLmYzNjk4NTZmOTFiMSAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9z
cGVjdGlvbi9rdm1pLmMKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKQEAgLTEz
Nyw3ICsxMzcsNyBAQCBzdGF0aWMgYm9vbCBhbGxvY192Y3B1aShzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUpCiAKIAl2Y3B1LT5rdm1pID0gdmNwdWk7CiAKLQlyZXR1cm4gdHJ1ZTsKKwlyZXR1cm4ga3Zt
aV9hcmNoX3ZjcHVfYWxsb2ModmNwdSk7CiB9CiAKIHN0YXRpYyBpbnQgY3JlYXRlX3ZjcHVpKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSkKQEAgLTE2Niw2ICsxNjYsNyBAQCBzdGF0aWMgdm9pZCBmcmVl
X3ZjcHVpKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAlrZnJlZSh2Y3B1aSk7CiAJdmNwdS0+a3Zt
aSA9IE5VTEw7CiAKKwlrdm1pX2FyY2hfcmVxdWVzdF9yZXN0b3JlX2ludGVyY2VwdGlvbih2Y3B1
KTsKIAlrdm1pX21ha2VfcmVxdWVzdCh2Y3B1LCBmYWxzZSk7CiB9CiAKQEAgLTE4NCw2ICsxODUs
NyBAQCBzdGF0aWMgdm9pZCBmcmVlX2t2bWkoc3RydWN0IGt2bSAqa3ZtKQogdm9pZCBrdm1pX3Zj
cHVfdW5pbml0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIHsKIAlmcmVlX3ZjcHVpKHZjcHUpOwor
CWt2bWlfYXJjaF92Y3B1X2ZyZWUodmNwdSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3Qga3ZtX2ludHJv
c3BlY3Rpb24gKgpAQCAtMzI0LDYgKzMyNiwyMSBAQCBzdGF0aWMgaW50IGt2bWlfcmVjdl90aHJl
YWQodm9pZCAqYXJnKQogCXJldHVybiAwOwogfQogCitzdGF0aWMgYm9vbCByZWFkeV90b19ob29r
KHN0cnVjdCBrdm0gKmt2bSkKK3sKKwlzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHU7CisJaW50IGk7CisK
KwlpZiAoa3ZtLT5rdm1pKQorCQlyZXR1cm4gZmFsc2U7CisKKwlrdm1fZm9yX2VhY2hfdmNwdShp
LCB2Y3B1LCBrdm0pCisJCWlmIChrdm1pX2FyY2hfdmNwdV9pbnRyb3NwZWN0ZWQodmNwdSkpCisJ
CQlyZXR1cm4gZmFsc2U7CisKKwlyZXR1cm4gdHJ1ZTsKK30KKwogaW50IGt2bWlfaG9vayhzdHJ1
Y3Qga3ZtICprdm0sIGNvbnN0IHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9ob29rICpob29rKQog
ewogCXN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaTsKQEAgLTMzMSw3ICszNDgsNyBAQCBp
bnQga3ZtaV9ob29rKHN0cnVjdCBrdm0gKmt2bSwgY29uc3Qgc3RydWN0IGt2bV9pbnRyb3NwZWN0
aW9uX2hvb2sgKmhvb2spCiAKIAltdXRleF9sb2NrKCZrdm0tPmt2bWlfbG9jayk7CiAKLQlpZiAo
a3ZtLT5rdm1pKSB7CisJaWYgKCFyZWFkeV90b19ob29rKGt2bSkpIHsKIAkJZXJyID0gLUVFWElT
VDsKIAkJZ290byBvdXQ7CiAJfQpAQCAtNzkzLDcgKzgxMCwxMSBAQCB2b2lkIGt2bWlfaGFuZGxl
X3JlcXVlc3RzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAlrdm1pX3B1dCh2Y3B1LT5rdm0pOwog
CiBvdXQ6Ci0Ja3ZtaV9hcmNoX3Jlc3RvcmVfaW50ZXJjZXB0aW9uKHZjcHUpOworCWlmIChrdm1p
X2FyY2hfcmVzdG9yZV9pbnRlcmNlcHRpb24odmNwdSkpIHsKKwkJbXV0ZXhfbG9jaygmdmNwdS0+
a3ZtLT5rdm1pX2xvY2spOworCQlrdm1pX2FyY2hfdmNwdV9mcmVlKHZjcHUpOworCQltdXRleF91
bmxvY2soJnZjcHUtPmt2bS0+a3ZtaV9sb2NrKTsKKwl9CiB9CiAKIGludCBrdm1pX2NtZF92Y3B1
X3BhdXNlKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgYm9vbCB3YWl0KQpkaWZmIC0tZ2l0IGEvdmly
dC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pX2ludC5oCmluZGV4IDA2ZjJjNWI2ODU3YS4uMDY3OTJjMGJhNmU2IDEwMDY0NAotLS0gYS92
aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgKKysrIGIvdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pX2ludC5oCkBAIC05Niw3ICs5NiwxMSBAQCBpbnQga3ZtaV9jbWRfdmNwdV9zZXRf
cmVnaXN0ZXJzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAkJCQljb25zdCBzdHJ1Y3Qga3ZtX3Jl
Z3MgKnJlZ3MpOwogCiAvKiBhcmNoICovCi12b2lkIGt2bWlfYXJjaF9yZXN0b3JlX2ludGVyY2Vw
dGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOworYm9vbCBrdm1pX2FyY2hfdmNwdV9hbGxvYyhz
dHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOwordm9pZCBrdm1pX2FyY2hfdmNwdV9mcmVlKHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSk7Citib29sIGt2bWlfYXJjaF92Y3B1X2ludHJvc3BlY3RlZChzdHJ1Y3Qg
a3ZtX3ZjcHUgKnZjcHUpOworYm9vbCBrdm1pX2FyY2hfcmVzdG9yZV9pbnRlcmNlcHRpb24oc3Ry
dWN0IGt2bV92Y3B1ICp2Y3B1KTsKK3ZvaWQga3ZtaV9hcmNoX3JlcXVlc3RfcmVzdG9yZV9pbnRl
cmNlcHRpb24oc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsKIGludCBrdm1pX2FyY2hfY21kX3ZjcHVf
Z2V0X2luZm8oc3RydWN0IGt2bV92Y3B1ICp2Y3B1LAogCQkJCXN0cnVjdCBrdm1pX3ZjcHVfZ2V0
X2luZm9fcmVwbHkgKnJwbCk7CiB2b2lkIGt2bWlfYXJjaF9zZXR1cF9ldmVudChzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsIHN0cnVjdCBrdm1pX2V2ZW50ICpldik7Cl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApW
aXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxp
bnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
