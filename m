Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 5B7F32C3CEB
	for <lists.virtualization@lfdr.de>; Wed, 25 Nov 2020 10:52:10 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 0FD3886A98;
	Wed, 25 Nov 2020 09:52:09 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id JtoudrM0nF4L; Wed, 25 Nov 2020 09:52:08 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 4943986B1C;
	Wed, 25 Nov 2020 09:52:03 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 1FDC0C0052;
	Wed, 25 Nov 2020 09:52:03 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id A51A2C0052
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:51:58 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id 90C2E8747D
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:51:58 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id jjkq8PBYpYHv
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:51:57 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by hemlock.osuosl.org (Postfix) with ESMTPS id 8BCB78749D
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:51:56 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 1D257305D466; Wed, 25 Nov 2020 11:35:50 +0200 (EET)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id ECBDB3072785;
 Wed, 25 Nov 2020 11:35:49 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v10 45/81] KVM: introspection: handle vCPU introspection
 requests
Date: Wed, 25 Nov 2020 11:35:24 +0200
Message-Id: <20201125093600.2766-46-alazar@bitdefender.com>
In-Reply-To: <20201125093600.2766-1-alazar@bitdefender.com>
References: <20201125093600.2766-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Mircea=20C=C3=AErjaliu?= <mcirjaliu@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhlIHJlY2Vpdmlu
ZyB0aHJlYWQgZGlzcGF0Y2hlcyB0aGUgdkNQVSBpbnRyb3NwZWN0aW9uIGNvbW1hbmRzIGJ5CmFk
ZGluZyB0aGVtIHRvIHRoZSB2Q1BVJ3Mgam9icyBsaXN0IGFuZCBraWNraW5nIHRoZSB2Q1BVLiBC
ZWZvcmUKZW50ZXJpbmcgaW4gZ3Vlc3QsIHRoZSB2Q1BVIHRocmVhZCBjaGVja3MgdGhlIGludHJv
c3BlY3Rpb24gcmVxdWVzdAooS1ZNX1JFUV9JTlRST1NQRUNUSU9OKSBhbmQgcnVucyBpdHMgcXVl
dWVkIGpvYnMuCgpTaWduZWQtb2ZmLWJ5OiBNaWhhaSBEb27Im3UgPG1kb250dUBiaXRkZWZlbmRl
ci5jb20+CkNvLWRldmVsb3BlZC1ieTogTWlyY2VhIEPDrnJqYWxpdSA8bWNpcmphbGl1QGJpdGRl
ZmVuZGVyLmNvbT4KU2lnbmVkLW9mZi1ieTogTWlyY2VhIEPDrnJqYWxpdSA8bWNpcmphbGl1QGJp
dGRlZmVuZGVyLmNvbT4KQ28tZGV2ZWxvcGVkLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBi
aXRkZWZlbmRlci5jb20+ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJp
dGRlZmVuZGVyLmNvbT4KLS0tCiBhcmNoL3g4Ni9rdm0veDg2LmMgICAgICAgICAgICB8ICAzICsr
CiBpbmNsdWRlL2xpbnV4L2t2bV9ob3N0LmggICAgICB8ICAxICsKIGluY2x1ZGUvbGludXgva3Zt
aV9ob3N0LmggICAgIHwgIDQgKysKIHZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jIHwgNzMg
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIHZpcnQva3ZtL2t2bV9tYWluLmMg
ICAgICAgICAgIHwgIDIgKwogNSBmaWxlcyBjaGFuZ2VkLCA4MyBpbnNlcnRpb25zKCspCgpkaWZm
IC0tZ2l0IGEvYXJjaC94ODYva3ZtL3g4Ni5jIGIvYXJjaC94ODYva3ZtL3g4Ni5jCmluZGV4IGZj
ZjdlNjhjYjZjOC4uNGU5MWQ2Nzk0YjVlIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0veDg2LmMK
KysrIGIvYXJjaC94ODYva3ZtL3g4Ni5jCkBAIC05MTQ3LDYgKzkxNDcsOSBAQCBzdGF0aWMgaW50
IHZjcHVfcnVuKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAl2Y3B1LT5hcmNoLmwxdGZfZmx1c2hf
bDFkID0gdHJ1ZTsKIAogCWZvciAoOzspIHsKKwkJaWYgKGt2bV9jaGVja19yZXF1ZXN0KEtWTV9S
RVFfSU5UUk9TUEVDVElPTiwgdmNwdSkpCisJCQlrdm1pX2hhbmRsZV9yZXF1ZXN0cyh2Y3B1KTsK
KwogCQlpZiAoa3ZtX3ZjcHVfcnVubmluZyh2Y3B1KSkgewogCQkJciA9IHZjcHVfZW50ZXJfZ3Vl
c3QodmNwdSk7CiAJCX0gZWxzZSB7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2t2bV9ob3N0
LmggYi9pbmNsdWRlL2xpbnV4L2t2bV9ob3N0LmgKaW5kZXggNjAzNDdjM2EwZTk1Li40ZDAyZjY4
Mjc4MmEgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgva3ZtX2hvc3QuaAorKysgYi9pbmNsdWRl
L2xpbnV4L2t2bV9ob3N0LmgKQEAgLTE0Nyw2ICsxNDcsNyBAQCBzdGF0aWMgaW5saW5lIGJvb2wg
aXNfZXJyb3JfcGFnZShzdHJ1Y3QgcGFnZSAqcGFnZSkKICNkZWZpbmUgS1ZNX1JFUV9NTVVfUkVM
T0FEICAgICAgICAoMSB8IEtWTV9SRVFVRVNUX1dBSVQgfCBLVk1fUkVRVUVTVF9OT19XQUtFVVAp
CiAjZGVmaW5lIEtWTV9SRVFfUEVORElOR19USU1FUiAgICAgMgogI2RlZmluZSBLVk1fUkVRX1VO
SEFMVCAgICAgICAgICAgIDMKKyNkZWZpbmUgS1ZNX1JFUV9JTlRST1NQRUNUSU9OICAgICA0CiAj
ZGVmaW5lIEtWTV9SRVFVRVNUX0FSQ0hfQkFTRSAgICAgOAogCiAjZGVmaW5lIEtWTV9BUkNIX1JF
UV9GTEFHUyhuciwgZmxhZ3MpICh7IFwKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgva3ZtaV9o
b3N0LmggYi9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCmluZGV4IGIzODc0NDE5NTExZC4uNzM2
ZWRiNDAwYzA1IDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCisrKyBiL2lu
Y2x1ZGUvbGludXgva3ZtaV9ob3N0LmgKQEAgLTUzLDYgKzUzLDggQEAgaW50IGt2bWlfaW9jdGxf
ZXZlbnQoc3RydWN0IGt2bSAqa3ZtLAogCQkgICAgIGNvbnN0IHN0cnVjdCBrdm1faW50cm9zcGVj
dGlvbl9mZWF0dXJlICpmZWF0KTsKIGludCBrdm1pX2lvY3RsX3ByZXVuaG9vayhzdHJ1Y3Qga3Zt
ICprdm0pOwogCit2b2lkIGt2bWlfaGFuZGxlX3JlcXVlc3RzKHN0cnVjdCBrdm1fdmNwdSAqdmNw
dSk7CisKICNlbHNlCiAKIHN0YXRpYyBpbmxpbmUgaW50IGt2bWlfdmVyc2lvbih2b2lkKSB7IHJl
dHVybiAwOyB9CkBAIC02Miw2ICs2NCw4IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBrdm1pX2NyZWF0
ZV92bShzdHJ1Y3Qga3ZtICprdm0pIHsgfQogc3RhdGljIGlubGluZSB2b2lkIGt2bWlfZGVzdHJv
eV92bShzdHJ1Y3Qga3ZtICprdm0pIHsgfQogc3RhdGljIGlubGluZSB2b2lkIGt2bWlfdmNwdV91
bmluaXQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KSB7IH0KIAorc3RhdGljIGlubGluZSB2b2lkIGt2
bWlfaGFuZGxlX3JlcXVlc3RzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkgeyB9CisKICNlbmRpZiAv
KiBDT05GSUdfS1ZNX0lOVFJPU1BFQ1RJT04gKi8KIAogI2VuZGlmCmRpZmYgLS1naXQgYS92aXJ0
L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5j
CmluZGV4IGNkYjQxNzVhZWNmZi4uYjYwODc1MTc4MGZjIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9p
bnRyb3NwZWN0aW9uL2t2bWkuYworKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwpA
QCAtMTI0LDYgKzEyNCwxMiBAQCB2b2lkIGt2bWlfdW5pbml0KHZvaWQpCiAJa3ZtaV9jYWNoZV9k
ZXN0cm95KCk7CiB9CiAKK3N0YXRpYyB2b2lkIGt2bWlfbWFrZV9yZXF1ZXN0KHN0cnVjdCBrdm1f
dmNwdSAqdmNwdSkKK3sKKwlrdm1fbWFrZV9yZXF1ZXN0KEtWTV9SRVFfSU5UUk9TUEVDVElPTiwg
dmNwdSk7CisJa3ZtX3ZjcHVfa2ljayh2Y3B1KTsKK30KKwogc3RhdGljIGludCBfX2t2bWlfYWRk
X2pvYihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiAJCQkgIHZvaWQgKCpmY3QpKHN0cnVjdCBrdm1f
dmNwdSAqdmNwdSwgdm9pZCAqY3R4KSwKIAkJCSAgdm9pZCAqY3R4LCB2b2lkICgqZnJlZV9mY3Qp
KHZvaWQgKmN0eCkpCkBAIC0xNTUsNiArMTYxLDkgQEAgaW50IGt2bWlfYWRkX2pvYihzdHJ1Y3Qg
a3ZtX3ZjcHUgKnZjcHUsCiAKIAllcnIgPSBfX2t2bWlfYWRkX2pvYih2Y3B1LCBmY3QsIGN0eCwg
ZnJlZV9mY3QpOwogCisJaWYgKCFlcnIpCisJCWt2bWlfbWFrZV9yZXF1ZXN0KHZjcHUpOworCiAJ
cmV0dXJuIGVycjsKIH0KIApAQCAtMzIzLDYgKzMzMiwxNCBAQCBpbnQga3ZtaV9pb2N0bF91bmhv
b2soc3RydWN0IGt2bSAqa3ZtKQogCXJldHVybiAwOwogfQogCitzdHJ1Y3Qga3ZtX2ludHJvc3Bl
Y3Rpb24gKiBfX211c3RfY2hlY2sga3ZtaV9nZXQoc3RydWN0IGt2bSAqa3ZtKQoreworCWlmIChy
ZWZjb3VudF9pbmNfbm90X3plcm8oJmt2bS0+a3ZtaV9yZWYpKQorCQlyZXR1cm4ga3ZtLT5rdm1p
OworCisJcmV0dXJuIE5VTEw7Cit9CisKIHZvaWQga3ZtaV9wdXQoc3RydWN0IGt2bSAqa3ZtKQog
ewogCWlmIChyZWZjb3VudF9kZWNfYW5kX3Rlc3QoJmt2bS0+a3ZtaV9yZWYpKQpAQCAtMzQwLDYg
KzM1NywxOSBAQCBzdGF0aWMgaW50IF9fa3ZtaV9ob29rKHN0cnVjdCBrdm0gKmt2bSwKIAlyZXR1
cm4gMDsKIH0KIAorc3RhdGljIHZvaWQga3ZtaV9qb2JfcmVsZWFzZV92Y3B1KHN0cnVjdCBrdm1f
dmNwdSAqdmNwdSwgdm9pZCAqY3R4KQoreworfQorCitzdGF0aWMgdm9pZCBrdm1pX3JlbGVhc2Vf
dmNwdXMoc3RydWN0IGt2bSAqa3ZtKQoreworCXN0cnVjdCBrdm1fdmNwdSAqdmNwdTsKKwlpbnQg
aTsKKworCWt2bV9mb3JfZWFjaF92Y3B1KGksIHZjcHUsIGt2bSkKKwkJa3ZtaV9hZGRfam9iKHZj
cHUsIGt2bWlfam9iX3JlbGVhc2VfdmNwdSwgTlVMTCwgTlVMTCk7Cit9CisKIHN0YXRpYyBpbnQg
a3ZtaV9yZWN2X3RocmVhZCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9u
ICprdm1pID0gYXJnOwpAQCAtMzUwLDYgKzM4MCw4IEBAIHN0YXRpYyBpbnQga3ZtaV9yZWN2X3Ro
cmVhZCh2b2lkICphcmcpCiAJLyogU2lnbmFsIHVzZXJzcGFjZSBhbmQgcHJldmVudCB0aGUgdkNQ
VXMgZnJvbSBzZW5kaW5nIGV2ZW50cy4gKi8KIAlrdm1pX3NvY2tfc2h1dGRvd24oa3ZtaSk7CiAK
Kwlrdm1pX3JlbGVhc2VfdmNwdXMoa3ZtaS0+a3ZtKTsKKwogCWt2bWlfcHV0KGt2bWktPmt2bSk7
CiAJcmV0dXJuIDA7CiB9CkBAIC0zODEsNiArNDEzLDEwIEBAIGludCBrdm1pX2hvb2soc3RydWN0
IGt2bSAqa3ZtLCBjb25zdCBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25faG9vayAqaG9vaykKIAlp
bml0X2NvbXBsZXRpb24oJmt2bS0+a3ZtaV9jb21wbGV0ZSk7CiAKIAlyZWZjb3VudF9zZXQoJmt2
bS0+a3ZtaV9yZWYsIDEpOworCS8qCisJICogUGFpcmVkIHdpdGggcmVmY291bnRfaW5jX25vdF96
ZXJvKCkgZnJvbSBrdm1pX2dldCgpLgorCSAqLworCXNtcF93bWIoKTsKIAogCWt2bWktPnJlY3Yg
PSBrdGhyZWFkX3J1bihrdm1pX3JlY3ZfdGhyZWFkLCBrdm1pLCAia3ZtaS1yZWN2Iik7CiAJaWYg
KElTX0VSUihrdm1pLT5yZWN2KSkgewpAQCAtNjY5LDMgKzcwNSw0MCBAQCBpbnQga3ZtaV9jbWRf
d3JpdGVfcGh5c2ljYWwoc3RydWN0IGt2bSAqa3ZtLCB1NjQgZ3BhLCBzaXplX3Qgc2l6ZSwKIAog
CXJldHVybiBlYzsKIH0KKworc3RhdGljIHN0cnVjdCBrdm1pX2pvYiAqa3ZtaV9wdWxsX2pvYihz
dHJ1Y3Qga3ZtX3ZjcHVfaW50cm9zcGVjdGlvbiAqdmNwdWkpCit7CisJc3RydWN0IGt2bWlfam9i
ICpqb2IgPSBOVUxMOworCisJc3Bpbl9sb2NrKCZ2Y3B1aS0+am9iX2xvY2spOworCWpvYiA9IGxp
c3RfZmlyc3RfZW50cnlfb3JfbnVsbCgmdmNwdWktPmpvYl9saXN0LCB0eXBlb2YoKmpvYiksIGxp
bmspOworCWlmIChqb2IpCisJCWxpc3RfZGVsKCZqb2ItPmxpbmspOworCXNwaW5fdW5sb2NrKCZ2
Y3B1aS0+am9iX2xvY2spOworCisJcmV0dXJuIGpvYjsKK30KKwordm9pZCBrdm1pX3J1bl9qb2Jz
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKK3sKKwlzdHJ1Y3Qga3ZtX3ZjcHVfaW50cm9zcGVjdGlv
biAqdmNwdWkgPSBWQ1BVSSh2Y3B1KTsKKwlzdHJ1Y3Qga3ZtaV9qb2IgKmpvYjsKKworCXdoaWxl
ICgoam9iID0ga3ZtaV9wdWxsX2pvYih2Y3B1aSkpKSB7CisJCWpvYi0+ZmN0KHZjcHUsIGpvYi0+
Y3R4KTsKKwkJa3ZtaV9mcmVlX2pvYihqb2IpOworCX0KK30KKwordm9pZCBrdm1pX2hhbmRsZV9y
ZXF1ZXN0cyhzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCit7CisJc3RydWN0IGt2bV9pbnRyb3NwZWN0
aW9uICprdm1pOworCisJa3ZtaSA9IGt2bWlfZ2V0KHZjcHUtPmt2bSk7CisJaWYgKCFrdm1pKQor
CQlyZXR1cm47CisKKwlrdm1pX3J1bl9qb2JzKHZjcHUpOworCisJa3ZtaV9wdXQodmNwdS0+a3Zt
KTsKK30KZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2t2bV9tYWluLmMgYi92aXJ0L2t2bS9rdm1fbWFp
bi5jCmluZGV4IDU1MDE3YTNmNjI4My4uNjY3YjM1OGNlYjljIDEwMDY0NAotLS0gYS92aXJ0L2t2
bS9rdm1fbWFpbi5jCisrKyBiL3ZpcnQva3ZtL2t2bV9tYWluLmMKQEAgLTI3OTMsNiArMjc5Myw4
IEBAIHN0YXRpYyBpbnQga3ZtX3ZjcHVfY2hlY2tfYmxvY2soc3RydWN0IGt2bV92Y3B1ICp2Y3B1
KQogCQlnb3RvIG91dDsKIAlpZiAoc2lnbmFsX3BlbmRpbmcoY3VycmVudCkpCiAJCWdvdG8gb3V0
OworCWlmIChrdm1fdGVzdF9yZXF1ZXN0KEtWTV9SRVFfSU5UUk9TUEVDVElPTiwgdmNwdSkpCisJ
CWdvdG8gb3V0OwogCiAJcmV0ID0gMDsKIG91dDoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxp
emF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3Vu
ZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
