Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id 60C011978ED
	for <lists.virtualization@lfdr.de>; Mon, 30 Mar 2020 12:20:30 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by whitealder.osuosl.org (Postfix) with ESMTP id 1142887A8A;
	Mon, 30 Mar 2020 10:20:29 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id vgqImd38ccVm; Mon, 30 Mar 2020 10:20:19 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by whitealder.osuosl.org (Postfix) with ESMTP id 634CB87CAB;
	Mon, 30 Mar 2020 10:20:12 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 57EA8C1D87;
	Mon, 30 Mar 2020 10:20:12 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 7A9CDC07FF
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:56 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 6ACBD8793F
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:56 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 9gKCK741lIEW
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:53 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id 85D12879F8
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:52 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 96215305D3CC; Mon, 30 Mar 2020 13:13:00 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 69134305B7A1;
 Mon, 30 Mar 2020 13:13:00 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v8 70/81] KVM: introspection: add KVMI_EVENT_DESCRIPTOR
Date: Mon, 30 Mar 2020 13:12:57 +0300
Message-Id: <20200330101308.21702-71-alazar@bitdefender.com>
In-Reply-To: <20200330101308.21702-1-alazar@bitdefender.com>
References: <20200330101308.21702-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <ncitu@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTmljdciZb3IgQ8OuyJt1IDxuY2l0dUBiaXRkZWZlbmRlci5jb20+CgpUaGlzIGV2ZW50
IGlzIHNlbnQgd2hlbiBJRFRSLCBHRFRSLCBMRFRSIG9yIFRSIGFyZSBhY2Nlc3NlZC4KClRoZXNl
IGNvdWxkIGJlIHVzZWQgdG8gaW1wbGVtZW50IGEgdGlueSBhZ2VudCB3aGljaCBydW5zIGluIHRo
ZSBjb250ZXh0Cm9mIGFuIGludHJvc3BlY3RlZCBndWVzdCBhbmQgdXNlcyB2aXJ0dWFsaXplZCBl
eGNlcHRpb25zICgjVkUpIGFuZAphbHRlcm5hdGUgRVBUIHZpZXdzIChWTUZVTkMgIzApIHRvIGZp
bHRlciBjb252ZXJ0ZWQgVk1FWElUUy4gVGhlIGV2ZW50cwpvZiBpbnRlcmVzdGVkIHdpbGwgYmUg
c3VwcHJlc3NlZCAoYWZ0ZXIgc29tZSBhcHByb3ByaWF0ZSBndWVzdC1zaWRlCmhhbmRsaW5nKSB3
aGlsZSB0aGUgcmVzdCB3aWxsIGJlIHNlbnQgdG8gdGhlIGludHJvc3BlY3RvciB2aWEgYSBWTUNB
TEwuCgpTaWduZWQtb2ZmLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5jaXR1QGJpdGRlZmVuZGVyLmNv
bT4KQ28tZGV2ZWxvcGVkLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5j
b20+ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJpdGRlZmVuZGVyLmNv
bT4KLS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgICAgICAgICAgICAgfCA0
MSArKysrKysrKysrCiBhcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaCAgICAgICAgICAg
ICAgfCAgMyArCiBhcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaCAgICAgICAgICAgICAg
fCAxMSArKysKIGFyY2gveDg2L2t2bS9rdm1pLmMgICAgICAgICAgICAgICAgICAgICAgICAgICB8
IDc1ICsrKysrKysrKysrKysrKysrKysKIGFyY2gveDg2L2t2bS9zdm0uYyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB8IDMzICsrKysrKysrCiBhcmNoL3g4Ni9rdm0vdm14L3ZteC5jICAgICAg
ICAgICAgICAgICAgICAgICAgfCAyMyArKysrKysKIGluY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgg
ICAgICAgICAgICAgICAgICAgICB8ICAxICsKIC4uLi90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2
XzY0L2t2bWlfdGVzdC5jICB8IDc1ICsrKysrKysrKysrKysrKysrKysKIHZpcnQva3ZtL2ludHJv
c3BlY3Rpb24va3ZtaS5jICAgICAgICAgICAgICAgICB8ICAxICsKIDkgZmlsZXMgY2hhbmdlZCwg
MjYzIGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2
bWkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAppbmRleCA5ZDM3MDMwMjEz
YTYuLjZmNjU1MTIzMGUxMSAxMDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1p
LnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CkBAIC01NDgsNiArNTQ4
LDcgQEAgdGhlIGZvbGxvd2luZyBldmVudHM6OgogCiAJS1ZNSV9FVkVOVF9CUkVBS1BPSU5UCiAJ
S1ZNSV9FVkVOVF9DUgorCUtWTUlfRVZFTlRfREVTQ1JJUFRPUgogCUtWTUlfRVZFTlRfSFlQRVJD
QUxMCiAJS1ZNSV9FVkVOVF9YU0VUQlYKIApAQCAtNTcyLDYgKzU3Myw4IEBAIHRoZSAqS1ZNSV9W
TV9DT05UUk9MX0VWRU5UUyogY29tbWFuZC4KICogLUtWTV9FSU5WQUwgLSB0aGUgZXZlbnQgSUQg
aXMgdW5rbm93biAodXNlICpLVk1JX1ZNX0NIRUNLX0VWRU5UKiBmaXJzdCkKICogLUtWTV9FUEVS
TSAtIHRoZSBhY2Nlc3MgaXMgZGlzYWxsb3dlZCAodXNlICpLVk1JX1ZNX0NIRUNLX0VWRU5UKiBm
aXJzdCkKICogLUtWTV9FQUdBSU4gLSB0aGUgc2VsZWN0ZWQgdkNQVSBjYW4ndCBiZSBpbnRyb3Nw
ZWN0ZWQgeWV0CisqIC1LVk1fRU9QTk9UU1VQUCAtIHRoZSBldmVudCBjYW4ndCBiZSBpbnRlcmNl
cHRlZCBpbiB0aGUgY3VycmVudCBzZXR1cAorICAgICAgICAgICAgICAgICAgICAoZS5nLiBLVk1J
X0VWRU5UX0RFU0NSSVBUT1Igd2l0aCBBTUQpCiAqIC1LVk1fRUJVU1kgLSB0aGUgZXZlbnQgY2Fu
J3QgYmUgaW50ZXJjZXB0ZWQgcmlnaHQgbm93CiAgICAgICAgICAgICAgICAoZS5nLiBLVk1JX0VW
RU5UX0JSRUFLUE9JTlQgaWYgdGhlICNCUCBldmVudCBpcyBhbHJlYWR5IGludGVyY2VwdGVkCiAg
ICAgICAgICAgICAgICAgYnkgdXNlcnNwYWNlKQpAQCAtMTEwNywzICsxMTEwLDQxIEBAIHRvIGJl
IGNoYW5nZWQgYW5kIHRoZSBpbnRyb3NwZWN0aW9uIGhhcyBiZWVuIGVuYWJsZWQgZm9yIHRoaXMg
ZXZlbnQKIChzZWUgKktWTUlfVkNQVV9DT05UUk9MX0VWRU5UUyopLgogCiBgYGt2bWlfZXZlbnRg
YCBpcyBzZW50IHRvIHRoZSBpbnRyb3NwZWN0aW9uIHRvb2wuCisKKzguIEtWTUlfRVZFTlRfREVT
Q1JJUFRPUgorLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKKzpBcmNoaXRlY3R1cmU6IHg4Ngor
OlZlcnNpb25zOiA+PSAxCis6QWN0aW9uczogQ09OVElOVUUsIFJFVFJZLCBDUkFTSAorOlBhcmFt
ZXRlcnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV9ldmVudDsKKwlzdHJ1Y3Qga3ZtaV9ldmVudF9k
ZXNjcmlwdG9yIHsKKwkJX191OCBkZXNjcmlwdG9yOworCQlfX3U4IHdyaXRlOworCQlfX3U4IHBh
ZGRpbmdbNl07CisJfTsKKworOlJldHVybnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2hk
cjsKKwlzdHJ1Y3Qga3ZtaV9ldmVudF9yZXBseTsKKworVGhpcyBldmVudCBpcyBzZW50IHdoZW4g
YSBkZXNjcmlwdG9yIHRhYmxlIHJlZ2lzdGVyIGlzIGFjY2Vzc2VkIGFuZCB0aGUKK2ludHJvc3Bl
Y3Rpb24gaGFzIGJlZW4gZW5hYmxlZCBmb3IgdGhpcyBldmVudCAoc2VlICoqS1ZNSV9WQ1BVX0NP
TlRST0xfRVZFTlRTKiopLgorCitgYGt2bWlfZXZlbnRgYCBhbmQgYGBrdm1pX2V2ZW50X2Rlc2Ny
aXB0b3JgYCBhcmUgc2VudCB0byB0aGUgaW50cm9zcGVjdGlvbiB0b29sLgorCitgYGRlc2NyaXB0
b3JgYCBjYW4gYmUgb25lIG9mOjoKKworCUtWTUlfREVTQ19JRFRSCisJS1ZNSV9ERVNDX0dEVFIK
KwlLVk1JX0RFU0NfTERUUgorCUtWTUlfREVTQ19UUgorCitgYHdyaXRlYGAgaXMgMSBpZiB0aGUg
ZGVzY3JpcHRvciB3YXMgd3JpdHRlbiwgMCBvdGhlcndpc2UuCmRpZmYgLS1naXQgYS9hcmNoL3g4
Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaCBiL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9z
dC5oCmluZGV4IGIzZmE5NTAzNjJkYi4uNzYzMzUwMTAzMWQyIDEwMDY0NAotLS0gYS9hcmNoL3g4
Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaAorKysgYi9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1p
X2hvc3QuaApAQCAtMzEsNiArMzEsNyBAQCBib29sIGt2bWlfY3JfZXZlbnQoc3RydWN0IGt2bV92
Y3B1ICp2Y3B1LCB1bnNpZ25lZCBpbnQgY3IsCiBib29sIGt2bWlfY3IzX2ludGVyY2VwdGVkKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSk7CiBib29sIGt2bWlfbW9uaXRvcl9jcjN3X2ludGVyY2VwdChz
dHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGJvb2wgZW5hYmxlKTsKIHZvaWQga3ZtaV94c2V0YnZfZXZl
bnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsKK2Jvb2wga3ZtaV9kZXNjcmlwdG9yX2V2ZW50KHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTggZGVzY3JpcHRvciwgYm9vbCB3cml0ZSk7CiAKICNlbHNl
IC8qIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCkBAIC00Myw2ICs0NCw4IEBAIHN0YXRp
YyBpbmxpbmUgYm9vbCBrdm1pX2NyM19pbnRlcmNlcHRlZChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUp
IHsgcmV0dXJuIGZhbHNlOyB9CiBzdGF0aWMgaW5saW5lIGJvb2wga3ZtaV9tb25pdG9yX2NyM3df
aW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAkJCQkJCWJvb2wgZW5hYmxlKSB7IHJl
dHVybiBmYWxzZTsgfQogc3RhdGljIGlubGluZSB2b2lkIGt2bWlfeHNldGJ2X2V2ZW50KHN0cnVj
dCBrdm1fdmNwdSAqdmNwdSkgeyB9CitzdGF0aWMgaW5saW5lIGJvb2wga3ZtaV9kZXNjcmlwdG9y
X2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTggZGVzY3JpcHRvciwKKwkJCQkJIGJvb2wg
d3JpdGUpIHsgcmV0dXJuIHRydWU7IH0KIAogI2VuZGlmIC8qIENPTkZJR19LVk1fSU5UUk9TUEVD
VElPTiAqLwogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaCBi
L2FyY2gveDg2L2luY2x1ZGUvdWFwaS9hc20va3ZtaS5oCmluZGV4IGQ2MjJjODlhNGYyYy4uNjkx
YTUwMTIwMGIzIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaAor
KysgYi9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaApAQCAtMTEwLDQgKzExMCwxNSBA
QCBzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9tdHJyX3R5cGVfcmVwbHkgewogCV9fdTggcGFkZGluZ1s3
XTsKIH07CiAKKyNkZWZpbmUgS1ZNSV9ERVNDX0lEVFIgIDEKKyNkZWZpbmUgS1ZNSV9ERVNDX0dE
VFIgIDIKKyNkZWZpbmUgS1ZNSV9ERVNDX0xEVFIgIDMKKyNkZWZpbmUgS1ZNSV9ERVNDX1RSICAg
IDQKKworc3RydWN0IGt2bWlfZXZlbnRfZGVzY3JpcHRvciB7CisJX191OCBkZXNjcmlwdG9yOwor
CV9fdTggd3JpdGU7CisJX191OCBwYWRkaW5nWzZdOworfTsKKwogI2VuZGlmIC8qIF9VQVBJX0FT
TV9YODZfS1ZNSV9IICovCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaS5jIGIvYXJjaC94
ODYva3ZtL2t2bWkuYwppbmRleCAzZGU3ZTk4ZmE0MjYuLjA5M2ZmMGRhODhmZiAxMDA2NDQKLS0t
IGEvYXJjaC94ODYva3ZtL2t2bWkuYworKysgYi9hcmNoL3g4Ni9rdm0va3ZtaS5jCkBAIC0zNjAs
NiArMzYwLDIxIEBAIHN0YXRpYyB2b2lkIGt2bWlfYXJjaF9kaXNhYmxlX2NyM3dfaW50ZXJjZXB0
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAl2Y3B1LT5hcmNoLmt2bWktPmNyM3cua3ZtX2ludGVy
Y2VwdGVkID0gZmFsc2U7CiB9CiAKK3N0YXRpYyBpbnQga3ZtaV9jb250cm9sX2Rlc2NfaW50ZXJj
ZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgYm9vbCBlbmFibGUpCit7CisJaWYgKCFrdm1feDg2
X29wcy0+ZGVzY19jdHJsX3N1cHBvcnRlZCgpKQorCQlyZXR1cm4gLUtWTV9FT1BOT1RTVVBQOwor
CisJa3ZtX3g4Nl9vcHMtPmNvbnRyb2xfZGVzY19pbnRlcmNlcHQodmNwdSwgZW5hYmxlKTsKKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBrdm1pX2FyY2hfZGlzYWJsZV9kZXNjX2ludGVy
Y2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCit7CisJa3ZtaV9jb250cm9sX2Rlc2NfaW50ZXJj
ZXB0KHZjcHUsIGZhbHNlKTsKK30KKwogaW50IGt2bWlfYXJjaF9jbWRfY29udHJvbF9pbnRlcmNl
cHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LAogCQkJCSAgICB1bnNpZ25lZCBpbnQgZXZlbnRfaWQs
IGJvb2wgZW5hYmxlKQogewpAQCAtMzY5LDYgKzM4NCw5IEBAIGludCBrdm1pX2FyY2hfY21kX2Nv
bnRyb2xfaW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAljYXNlIEtWTUlfRVZFTlRf
QlJFQUtQT0lOVDoKIAkJZXJyID0ga3ZtaV9jb250cm9sX2JwX2ludGVyY2VwdCh2Y3B1LCBlbmFi
bGUpOwogCQlicmVhazsKKwljYXNlIEtWTUlfRVZFTlRfREVTQ1JJUFRPUjoKKwkJZXJyID0ga3Zt
aV9jb250cm9sX2Rlc2NfaW50ZXJjZXB0KHZjcHUsIGVuYWJsZSk7CisJCWJyZWFrOwogCWRlZmF1
bHQ6CiAJCWJyZWFrOwogCX0KQEAgLTQwNSw2ICs0MjMsNyBAQCBib29sIGt2bWlfYXJjaF9yZXN0
b3JlX2ludGVyY2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAKIAlrdm1pX2FyY2hfZGlz
YWJsZV9icF9pbnRlcmNlcHQodmNwdSk7CiAJa3ZtaV9hcmNoX2Rpc2FibGVfY3Izd19pbnRlcmNl
cHQodmNwdSk7CisJa3ZtaV9hcmNoX2Rpc2FibGVfZGVzY19pbnRlcmNlcHQodmNwdSk7CiAKIAly
ZXR1cm4gdHJ1ZTsKIH0KQEAgLTcyOSwzICs3NDgsNTkgQEAgaW50IGt2bWlfYXJjaF9jbWRfdmNw
dV9nZXRfbXRycl90eXBlKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTY0IGdwYSwgdTggKnR5cGUp
CiAKIAlyZXR1cm4gMDsKIH0KKworc3RhdGljIHUzMiBrdm1pX21zZ19zZW5kX2Rlc2NyaXB0b3Io
c3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1OCBkZXNjcmlwdG9yLAorCQkJCSAgICBib29sIHdyaXRl
KQoreworCXN0cnVjdCBrdm1pX2V2ZW50X2Rlc2NyaXB0b3IgZTsKKwlpbnQgZXJyLCBhY3Rpb247
CisKKwltZW1zZXQoJmUsIDAsIHNpemVvZihlKSk7CisJZS5kZXNjcmlwdG9yID0gZGVzY3JpcHRv
cjsKKwllLndyaXRlID0gd3JpdGUgPyAxIDogMDsKKworCWVyciA9IGt2bWlfc2VuZF9ldmVudCh2
Y3B1LCBLVk1JX0VWRU5UX0RFU0NSSVBUT1IsICZlLCBzaXplb2YoZSksCisJCQkgICAgICBOVUxM
LCAwLCAmYWN0aW9uKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gS1ZNSV9FVkVOVF9BQ1RJT05fQ09O
VElOVUU7CisKKwlyZXR1cm4gYWN0aW9uOworfQorCitzdGF0aWMgYm9vbCBfX2t2bWlfZGVzY3Jp
cHRvcl9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHU4IGRlc2NyaXB0b3IsCisJCQkJICAg
IGJvb2wgd3JpdGUpCit7CisJYm9vbCByZXQgPSBmYWxzZTsKKwl1MzIgYWN0aW9uOworCisJYWN0
aW9uID0ga3ZtaV9tc2dfc2VuZF9kZXNjcmlwdG9yKHZjcHUsIGRlc2NyaXB0b3IsIHdyaXRlKTsK
Kwlzd2l0Y2ggKGFjdGlvbikgeworCWNhc2UgS1ZNSV9FVkVOVF9BQ1RJT05fQ09OVElOVUU6CisJ
CXJldCA9IHRydWU7CisJCWJyZWFrOworCWNhc2UgS1ZNSV9FVkVOVF9BQ1RJT05fUkVUUlk6CisJ
CWJyZWFrOworCWRlZmF1bHQ6CisJCWt2bWlfaGFuZGxlX2NvbW1vbl9ldmVudF9hY3Rpb25zKHZj
cHUtPmt2bSwgYWN0aW9uLCAiREVTQyIpOworCX0KKworCXJldHVybiByZXQ7Cit9CisKK2Jvb2wg
a3ZtaV9kZXNjcmlwdG9yX2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTggZGVzY3JpcHRv
ciwgYm9vbCB3cml0ZSkKK3sKKwlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWk7CisJYm9v
bCByZXQgPSB0cnVlOworCisJa3ZtaSA9IGt2bWlfZ2V0KHZjcHUtPmt2bSk7CisJaWYgKCFrdm1p
KQorCQlyZXR1cm4gdHJ1ZTsKKworCWlmIChpc19ldmVudF9lbmFibGVkKHZjcHUsIEtWTUlfRVZF
TlRfREVTQ1JJUFRPUikpCisJCXJldCA9IF9fa3ZtaV9kZXNjcmlwdG9yX2V2ZW50KHZjcHUsIGRl
c2NyaXB0b3IsIHdyaXRlKTsKKworCWt2bWlfcHV0KHZjcHUtPmt2bSk7CisKKwlyZXR1cm4gcmV0
OworfQorRVhQT1JUX1NZTUJPTChrdm1pX2Rlc2NyaXB0b3JfZXZlbnQpOwpkaWZmIC0tZ2l0IGEv
YXJjaC94ODYva3ZtL3N2bS5jIGIvYXJjaC94ODYva3ZtL3N2bS5jCmluZGV4IDEwMjFmZjJmOWU1
Ny4uYjM3N2FjYzM0MTBjIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0vc3ZtLmMKKysrIGIvYXJj
aC94ODYva3ZtL3N2bS5jCkBAIC00ODU0LDYgKzQ4NTQsMzkgQEAgc3RhdGljIGludCBkZXNjcmlw
dG9yX2FjY2Vzc19pbnRlcmNlcHRpb24oc3RydWN0IHZjcHVfc3ZtICpzdm0pCiB7CiAJc3RydWN0
IGt2bV92Y3B1ICp2Y3B1ID0gJnN2bS0+dmNwdTsKIAorI2lmZGVmIENPTkZJR19LVk1fSU5UUk9T
UEVDVElPTgorCXN0cnVjdCB2bWNiX2NvbnRyb2xfYXJlYSAqYyA9ICZzdm0tPnZtY2ItPmNvbnRy
b2w7CisJYm9vbCBjb250OworCisJc3dpdGNoIChjLT5leGl0X2NvZGUpIHsKKwljYXNlIFNWTV9F
WElUX0lEVFJfUkVBRDoKKwljYXNlIFNWTV9FWElUX0lEVFJfV1JJVEU6CisJCWNvbnQgPSBrdm1p
X2Rlc2NyaXB0b3JfZXZlbnQodmNwdSwgS1ZNSV9ERVNDX0lEVFIsCisJCQkJICAgICAgYy0+ZXhp
dF9jb2RlID09IFNWTV9FWElUX0lEVFJfV1JJVEUpOworCQlicmVhazsKKwljYXNlIFNWTV9FWElU
X0dEVFJfUkVBRDoKKwljYXNlIFNWTV9FWElUX0dEVFJfV1JJVEU6CisJCWNvbnQgPSBrdm1pX2Rl
c2NyaXB0b3JfZXZlbnQodmNwdSwgS1ZNSV9ERVNDX0dEVFIsCisJCQkJICAgICAgYy0+ZXhpdF9j
b2RlID09IFNWTV9FWElUX0dEVFJfV1JJVEUpOworCQlicmVhazsKKwljYXNlIFNWTV9FWElUX0xE
VFJfUkVBRDoKKwljYXNlIFNWTV9FWElUX0xEVFJfV1JJVEU6CisJCWNvbnQgPSBrdm1pX2Rlc2Ny
aXB0b3JfZXZlbnQodmNwdSwgS1ZNSV9ERVNDX0xEVFIsCisJCQkJICAgICAgYy0+ZXhpdF9jb2Rl
ID09IFNWTV9FWElUX0xEVFJfV1JJVEUpOworCQlicmVhazsKKwljYXNlIFNWTV9FWElUX1RSX1JF
QUQ6CisJY2FzZSBTVk1fRVhJVF9UUl9XUklURToKKwkJY29udCA9IGt2bWlfZGVzY3JpcHRvcl9l
dmVudCh2Y3B1LCBLVk1JX0RFU0NfVFIsCisJCQkJICAgICAgYy0+ZXhpdF9jb2RlID09IFNWTV9F
WElUX1RSX1dSSVRFKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJY29udCA9IHRydWU7CisJCWJy
ZWFrOworCX0KKwlpZiAoIWNvbnQpCisJCXJldHVybiAxOworI2VuZGlmIC8qIENPTkZJR19LVk1f
SU5UUk9TUEVDVElPTiAqLworCiAJcmV0dXJuIGt2bV9lbXVsYXRlX2luc3RydWN0aW9uKHZjcHUs
IDApOwogfQogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jIGIvYXJjaC94ODYv
a3ZtL3ZteC92bXguYwppbmRleCBmNjE4MGVjZjE1YmEuLmM1NGMwMWUwODhiNiAxMDA2NDQKLS0t
IGEvYXJjaC94ODYva3ZtL3ZteC92bXguYworKysgYi9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jCkBA
IC00ODY2LDcgKzQ4NjYsMzAgQEAgc3RhdGljIGludCBoYW5kbGVfc2V0X2NyNChzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsIHVuc2lnbmVkIGxvbmcgdmFsKQogCiBzdGF0aWMgaW50IGhhbmRsZV9kZXNj
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIHsKKyNpZmRlZiBDT05GSUdfS1ZNX0lOVFJPU1BFQ1RJ
T04KKwlzdHJ1Y3QgdmNwdV92bXggKnZteCA9IHRvX3ZteCh2Y3B1KTsKKwl1MzIgZXhpdF9yZWFz
b24gPSB2bXgtPmV4aXRfcmVhc29uOworCXUzMiB2bXhfaW5zdHJ1Y3Rpb25faW5mbyA9IHZtY3Nf
cmVhZDMyKFZNWF9JTlNUUlVDVElPTl9JTkZPKTsKKwl1OCBzdG9yZSA9ICh2bXhfaW5zdHJ1Y3Rp
b25faW5mbyA+PiAyOSkgJiAweDE7CisJdTggZGVzY3JpcHRvciA9IDA7CisKKwlpZiAoZXhpdF9y
ZWFzb24gPT0gRVhJVF9SRUFTT05fR0RUUl9JRFRSKSB7CisJCWlmICgodm14X2luc3RydWN0aW9u
X2luZm8gPj4gMjgpICYgMHgxKQorCQkJZGVzY3JpcHRvciA9IEtWTUlfREVTQ19JRFRSOworCQll
bHNlCisJCQlkZXNjcmlwdG9yID0gS1ZNSV9ERVNDX0dEVFI7CisJfSBlbHNlIHsKKwkJaWYgKCh2
bXhfaW5zdHJ1Y3Rpb25faW5mbyA+PiAyOCkgJiAweDEpCisJCQlkZXNjcmlwdG9yID0gS1ZNSV9E
RVNDX1RSOworCQllbHNlCisJCQlkZXNjcmlwdG9yID0gS1ZNSV9ERVNDX0xEVFI7CisJfQorCisJ
aWYgKCFrdm1pX2Rlc2NyaXB0b3JfZXZlbnQodmNwdSwgZGVzY3JpcHRvciwgc3RvcmUpKQorCQly
ZXR1cm4gMTsKKyNlbHNlCiAJV0FSTl9PTighKHZjcHUtPmFyY2guY3I0ICYgWDg2X0NSNF9VTUlQ
KSk7CisjZW5kaWYgLyogQ09ORklHX0tWTV9JTlRST1NQRUNUSU9OICovCiAJcmV0dXJuIGt2bV9l
bXVsYXRlX2luc3RydWN0aW9uKHZjcHUsIDApOwogfQogCmRpZmYgLS1naXQgYS9pbmNsdWRlL3Vh
cGkvbGludXgva3ZtaS5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAppbmRleCAwODI3YmQ5
MDY5MWIuLjJjY2M0MDQ1MTM3ZiAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWku
aAorKysgYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCkBAIC01MCw2ICs1MCw3IEBAIGVudW0g
ewogCUtWTUlfRVZFTlRfQ1IgICAgICAgICA9IDQsCiAJS1ZNSV9FVkVOVF9UUkFQICAgICAgID0g
NSwKIAlLVk1JX0VWRU5UX1hTRVRCViAgICAgPSA2LAorCUtWTUlfRVZFTlRfREVTQ1JJUFRPUiA9
IDcsCiAKIAlLVk1JX05VTV9FVkVOVFMKIH07CmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3Nl
bGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMv
a3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYwppbmRleCBiOTg0YzM3MDRiYWYuLjRmMmRlMzA0YTZmOCAx
MDA2NDQKLS0tIGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3Qu
YworKysgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCkBA
IC01NSw2ICs1NSw3IEBAIGVudW0gewogCUdVRVNUX1RFU1RfTk9PUCA9IDAsCiAJR1VFU1RfVEVT
VF9CUCwKIAlHVUVTVF9URVNUX0NSLAorCUdVRVNUX1RFU1RfREVTQ1JJUFRPUiwKIAlHVUVTVF9U
RVNUX0hZUEVSQ0FMTCwKIAlHVUVTVF9URVNUX1hTRVRCViwKIH07CkBAIC04MCw2ICs4MSwxNCBA
QCBzdGF0aWMgdm9pZCBndWVzdF9jcl90ZXN0KHZvaWQpCiAJc2V0X2NyNChnZXRfY3I0KCkgfCBY
ODZfQ1I0X09TWFNBVkUpOwogfQogCitzdGF0aWMgdm9pZCBndWVzdF9kZXNjcmlwdG9yX3Rlc3Qo
dm9pZCkKK3sKKwl2b2lkICpwdHI7CisKKwlhc20gdm9sYXRpbGUoInNnZHQgJTAiIDo6ICJtIihw
dHIpKTsKKwlhc20gdm9sYXRpbGUoImxnZHQgJTAiIDo6ICJtIihwdHIpKTsKK30KKwogc3RhdGlj
IHZvaWQgZ3Vlc3RfaHlwZXJjYWxsX3Rlc3Qodm9pZCkKIHsKIAlhc20gdm9sYXRpbGUoIm1vdiAk
MzQsICVyYXgiKTsKQEAgLTEzOSw2ICsxNDgsOSBAQCBzdGF0aWMgdm9pZCBndWVzdF9jb2RlKHZv
aWQpCiAJCWNhc2UgR1VFU1RfVEVTVF9DUjoKIAkJCWd1ZXN0X2NyX3Rlc3QoKTsKIAkJCWJyZWFr
OworCQljYXNlIEdVRVNUX1RFU1RfREVTQ1JJUFRPUjoKKwkJCWd1ZXN0X2Rlc2NyaXB0b3JfdGVz
dCgpOworCQkJYnJlYWs7CiAJCWNhc2UgR1VFU1RfVEVTVF9IWVBFUkNBTEw6CiAJCQlndWVzdF9o
eXBlcmNhbGxfdGVzdCgpOwogCQkJYnJlYWs7CkBAIC0xMzYzLDYgKzEzNzUsNjggQEAgc3RhdGlj
IHZvaWQgdGVzdF9jbWRfdmNwdV9nZXRfbXRycl90eXBlKHN0cnVjdCBrdm1fdm0gKnZtKQogCURF
QlVHKCJtdHJyX3R5cGU6IGdwYSAweCVseCB0eXBlIDB4JXhcbiIsIHRlc3RfZ3BhLCBycGwudHlw
ZSk7CiB9CiAKK3N0YXRpYyB2b2lkIHRlc3RfZGVzY19yZWFkX2FjY2VzcyhfX3UxNiBldmVudF9p
ZCkKK3sKKwlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwlzdHJ1Y3QgeworCQlzdHJ1Y3Qga3Zt
aV9ldmVudCBjb21tb247CisJCXN0cnVjdCBrdm1pX2V2ZW50X2Rlc2NyaXB0b3IgZGVzYzsKKwl9
IGV2OworCXN0cnVjdCB2Y3B1X3JlcGx5IHJwbCA9IHt9OworCisJcmVjZWl2ZV9ldmVudCgmaGRy
LCAmZXYuY29tbW9uLCBzaXplb2YoZXYpLCBldmVudF9pZCk7CisKKwlERUJVRygiRGVzY3JpcHRv
ciBldmVudCAocmVhZCksIGRlc2NyaXB0b3IgJXUsIHdyaXRlICV1XG4iLAorCQlldi5kZXNjLmRl
c2NyaXB0b3IsIGV2LmRlc2Mud3JpdGUpOworCisJVEVTVF9BU1NFUlQoZXYuZGVzYy53cml0ZSA9
PSAwLAorCQkiUmVjZWl2ZWQgYSB3cml0ZSBkZXNjcmlwdG9yIGFjY2Vzc1xuIik7CisKKwlyZXBs
eV90b19ldmVudCgmaGRyLCAmZXYuY29tbW9uLCBLVk1JX0VWRU5UX0FDVElPTl9DT05USU5VRSwK
KwkJCSZycGwsIHNpemVvZihycGwpKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9kZXNjX3dyaXRl
X2FjY2VzcyhfX3UxNiBldmVudF9pZCkKK3sKKwlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwlz
dHJ1Y3QgeworCQlzdHJ1Y3Qga3ZtaV9ldmVudCBjb21tb247CisJCXN0cnVjdCBrdm1pX2V2ZW50
X2Rlc2NyaXB0b3IgZGVzYzsKKwl9IGV2OworCXN0cnVjdCB2Y3B1X3JlcGx5IHJwbCA9IHt9Owor
CisJcmVjZWl2ZV9ldmVudCgmaGRyLCAmZXYuY29tbW9uLCBzaXplb2YoZXYpLCBldmVudF9pZCk7
CisKKwlERUJVRygiRGVzY3JpcHRvciBldmVudCAod3JpdGUpLCBkZXNjcmlwdG9yICV1LCB3cml0
ZSAldVxuIiwKKwkJZXYuZGVzYy5kZXNjcmlwdG9yLCBldi5kZXNjLndyaXRlKTsKKworCVRFU1Rf
QVNTRVJUKGV2LmRlc2Mud3JpdGUgPT0gMSwKKwkJIlJlY2VpdmVkIGEgcmVhZCBkZXNjcmlwdG9y
IGFjY2Vzc1xuIik7CisKKwlyZXBseV90b19ldmVudCgmaGRyLCAmZXYuY29tbW9uLCBLVk1JX0VW
RU5UX0FDVElPTl9DT05USU5VRSwKKwkJCSZycGwsIHNpemVvZihycGwpKTsKK30KKworc3RhdGlj
IHZvaWQgdGVzdF9ldmVudF9kZXNjcmlwdG9yKHN0cnVjdCBrdm1fdm0gKnZtKQoreworCXN0cnVj
dCB2Y3B1X3dvcmtlcl9kYXRhIGRhdGEgPSB7CisJCS52bSA9IHZtLAorCQkudmNwdV9pZCA9IFZD
UFVfSUQsCisJCS50ZXN0X2lkID0gR1VFU1RfVEVTVF9ERVNDUklQVE9SLAorCX07CisJX191MTYg
ZXZlbnRfaWQgPSBLVk1JX0VWRU5UX0RFU0NSSVBUT1I7CisJcHRocmVhZF90IHZjcHVfdGhyZWFk
OworCisJZW5hYmxlX3ZjcHVfZXZlbnQodm0sIGV2ZW50X2lkKTsKKwl2Y3B1X3RocmVhZCA9IHN0
YXJ0X3ZjcHVfd29ya2VyKCZkYXRhKTsKKworCXRlc3RfZGVzY19yZWFkX2FjY2VzcyhldmVudF9p
ZCk7CisJdGVzdF9kZXNjX3dyaXRlX2FjY2VzcyhldmVudF9pZCk7CisKKwlzdG9wX3ZjcHVfd29y
a2VyKHZjcHVfdGhyZWFkLCAmZGF0YSk7CisJZGlzYWJsZV92Y3B1X2V2ZW50KHZtLCBldmVudF9p
ZCk7Cit9CisKIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2
bSkKIHsKIAlzcmFuZG9tKHRpbWUoMCkpOwpAQCAtMTM5MSw2ICsxNDY1LDcgQEAgc3RhdGljIHZv
aWQgdGVzdF9pbnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtKQogCXRlc3RfZXZlbnRfeHNl
dGJ2KHZtKTsKIAl0ZXN0X2NtZF92Y3B1X2dldF94c2F2ZSh2bSk7CiAJdGVzdF9jbWRfdmNwdV9n
ZXRfbXRycl90eXBlKHZtKTsKKwl0ZXN0X2V2ZW50X2Rlc2NyaXB0b3Iodm0pOwogCiAJdW5ob29r
X2ludHJvc3BlY3Rpb24odm0pOwogfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlv
bi9rdm1pLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwppbmRleCBkMzU4Njg2ZmNl
NzYuLmRiNzk3NDRlNWQyZiAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1p
LmMKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKQEAgLTgwLDYgKzgwLDcgQEAg
c3RhdGljIHZvaWQgc2V0dXBfa25vd25fZXZlbnRzKHZvaWQpCiAJYml0bWFwX3plcm8oS3ZtaV9r
bm93bl92Y3B1X2V2ZW50cywgS1ZNSV9OVU1fRVZFTlRTKTsKIAlzZXRfYml0KEtWTUlfRVZFTlRf
QlJFQUtQT0lOVCwgS3ZtaV9rbm93bl92Y3B1X2V2ZW50cyk7CiAJc2V0X2JpdChLVk1JX0VWRU5U
X0NSLCBLdm1pX2tub3duX3ZjcHVfZXZlbnRzKTsKKwlzZXRfYml0KEtWTUlfRVZFTlRfREVTQ1JJ
UFRPUiwgS3ZtaV9rbm93bl92Y3B1X2V2ZW50cyk7CiAJc2V0X2JpdChLVk1JX0VWRU5UX0hZUEVS
Q0FMTCwgS3ZtaV9rbm93bl92Y3B1X2V2ZW50cyk7CiAJc2V0X2JpdChLVk1JX0VWRU5UX1BBVVNF
X1ZDUFUsIEt2bWlfa25vd25fdmNwdV9ldmVudHMpOwogCXNldF9iaXQoS1ZNSV9FVkVOVF9UUkFQ
LCBLdm1pX2tub3duX3ZjcHVfZXZlbnRzKTsKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0
aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0
aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
