Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 9D16A2D1B66
	for <lists.virtualization@lfdr.de>; Mon,  7 Dec 2020 21:57:17 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 5B2C687106;
	Mon,  7 Dec 2020 20:57:16 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id gOwDXO_FHVa5; Mon,  7 Dec 2020 20:57:14 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id B1FEB872C2;
	Mon,  7 Dec 2020 20:57:01 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 98094C163C;
	Mon,  7 Dec 2020 20:57:01 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 318C1C163C
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:56:58 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id 201AE87499
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:56:58 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id uimX-n+Db0fo
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:56:56 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by hemlock.osuosl.org (Postfix) with ESMTPS id 6FCE787245
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:56:56 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 2A4BA30462E7; Mon,  7 Dec 2020 22:46:24 +0200 (EET)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 04FF03072784;
 Mon,  7 Dec 2020 22:46:24 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v11 68/81] KVM: introspection: add KVMI_VCPU_SET_XSAVE
Date: Mon,  7 Dec 2020 22:46:09 +0200
Message-Id: <20201207204622.15258-69-alazar@bitdefender.com>
In-Reply-To: <20201207204622.15258-1-alazar@bitdefender.com>
References: <20201207204622.15258-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>, virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhpcyBjYW4gYmUgdXNlZCBieSB0aGUgaW50cm9zcGVjdGlvbiB0b29sIHRvIGVtdWxhdGUgU1NF
IGluc3RydWN0aW9ucy4KClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJp
dGRlZmVuZGVyLmNvbT4KLS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgICAg
ICAgICAgICAgfCAyOCArKysrKysrKysrKysrKysrKysrCiBhcmNoL3g4Ni9pbmNsdWRlL3VhcGkv
YXNtL2t2bWkuaCAgICAgICAgICAgICAgfCAgNCArKysKIGFyY2gveDg2L2t2bS9rdm1pX21zZy5j
ICAgICAgICAgICAgICAgICAgICAgICB8IDIwICsrKysrKysrKysrKysKIGluY2x1ZGUvdWFwaS9s
aW51eC9rdm1pLmggICAgICAgICAgICAgICAgICAgICB8ICAxICsKIC4uLi90ZXN0aW5nL3NlbGZ0
ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jICB8IDI3ICsrKysrKysrKysrKysrLS0tLQogNSBm
aWxlcyBjaGFuZ2VkLCA3NCBpbnNlcnRpb25zKCspLCA2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QgYi9Eb2N1bWVudGF0aW9uL3ZpcnQv
a3ZtL2t2bWkucnN0CmluZGV4IDNiN2E2OGNjOGZhZi4uNzBkMWY5NmJjNGYwIDEwMDY0NAotLS0g
YS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CisrKyBiL0RvY3VtZW50YXRpb24vdmly
dC9rdm0va3ZtaS5yc3QKQEAgLTg1OSw2ICs4NTksMzQgQEAgUmV0dXJucyBhIGJ1ZmZlciBjb250
YWluaW5nIHRoZSBYU0FWRSBhcmVhLgogKiAtS1ZNX0VBR0FJTiAtIHRoZSBzZWxlY3RlZCB2Q1BV
IGNhbid0IGJlIGludHJvc3BlY3RlZCB5ZXQKICogLUtWTV9FTk9NRU0gLSB0aGVyZSBpcyBub3Qg
ZW5vdWdoIG1lbW9yeSB0byBhbGxvY2F0ZSB0aGUgcmVwbHkKIAorMjAuIEtWTUlfVkNQVV9TRVRf
WFNBVkUKKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKKzpBcmNoaXRlY3R1cmVzOiB4ODYKKzpW
ZXJzaW9uczogPj0gMQorOlBhcmFtZXRlcnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2hk
cjsKKwlzdHJ1Y3Qga3ZtaV92Y3B1X3NldF94c2F2ZSB7CisJCXN0cnVjdCBrdm1feHNhdmUgeHNh
dmU7CisJfTsKKworOlJldHVybnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV9lcnJvcl9jb2RlOwor
CitNb2RpZmllcyB0aGUgWFNBVkUgYXJlYS4KKworOkVycm9yczoKKworKiAtS1ZNX0VJTlZBTCAt
IHRoZSBzZWxlY3RlZCB2Q1BVIGlzIGludmFsaWQKKyogLUtWTV9FSU5WQUwgLSB0aGUgcGFkZGlu
ZyBpcyBub3QgemVybworKiAtS1ZNX0VBR0FJTiAtIHRoZSBzZWxlY3RlZCB2Q1BVIGNhbid0IGJl
IGludHJvc3BlY3RlZCB5ZXQKKwogRXZlbnRzCiA9PT09PT0KIApkaWZmIC0tZ2l0IGEvYXJjaC94
ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmggYi9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2
bWkuaAppbmRleCBjNmE0NjI1MmE2ODQuLjg5ZjNkYzkyNjljMSAxMDA2NDQKLS0tIGEvYXJjaC94
ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmgKKysrIGIvYXJjaC94ODYvaW5jbHVkZS91YXBpL2Fz
bS9rdm1pLmgKQEAgLTExNSw0ICsxMTUsOCBAQCBzdHJ1Y3Qga3ZtaV92Y3B1X2dldF94c2F2ZV9y
ZXBseSB7CiAJc3RydWN0IGt2bV94c2F2ZSB4c2F2ZTsKIH07CiAKK3N0cnVjdCBrdm1pX3ZjcHVf
c2V0X3hzYXZlIHsKKwlzdHJ1Y3Qga3ZtX3hzYXZlIHhzYXZlOworfTsKKwogI2VuZGlmIC8qIF9V
QVBJX0FTTV9YODZfS1ZNSV9IICovCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cu
YyBiL2FyY2gveDg2L2t2bS9rdm1pX21zZy5jCmluZGV4IGJlZmIxYzI4ODA0NS4uN2RmNzFiNWNk
NTBhIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYworKysgYi9hcmNoL3g4Ni9r
dm0va3ZtaV9tc2cuYwpAQCAtMjEzLDYgKzIxMywyNSBAQCBzdGF0aWMgaW50IGhhbmRsZV92Y3B1
X2dldF94c2F2ZShjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X21zZ19qb2IgKmpvYiwKIAlyZXR1cm4g
ZXJyOwogfQogCitzdGF0aWMgaW50IGhhbmRsZV92Y3B1X3NldF94c2F2ZShjb25zdCBzdHJ1Y3Qg
a3ZtaV92Y3B1X21zZ19qb2IgKmpvYiwKKwkJCQkgY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAq
bXNnLAorCQkJCSBjb25zdCB2b2lkICpyZXEpCit7CisJY29uc3Qgc3RydWN0IGt2bV94c2F2ZSAq
YXJlYSA9IHJlcTsKKwlzaXplX3QgY21kX3NpemU7CisJaW50IGVjID0gMDsKKworCWNtZF9zaXpl
ID0gc2l6ZW9mKHN0cnVjdCBrdm1pX3ZjcHVfaGRyKSArIHNpemVvZigqYXJlYSk7CisKKwlpZiAo
Y21kX3NpemUgPiBtc2ctPnNpemUpCisJCWVjID0gLUtWTV9FSU5WQUw7CisJZWxzZSBpZiAoa3Zt
X3ZjcHVfaW9jdGxfeDg2X3NldF94c2F2ZShqb2ItPnZjcHUsCisJCQkJCSAgICAgIChzdHJ1Y3Qg
a3ZtX3hzYXZlICopIGFyZWEpKQorCQllYyA9IC1LVk1fRUlOVkFMOworCisJcmV0dXJuIGt2bWlf
bXNnX3ZjcHVfcmVwbHkoam9iLCBtc2csIGVjLCBOVUxMLCAwKTsKK30KKwogc3RhdGljIGt2bWlf
dmNwdV9tc2dfam9iX2ZjdCBjb25zdCBtc2dfdmNwdVtdID0gewogCVtLVk1JX1ZDUFVfQ09OVFJP
TF9DUl0gICAgICAgPSBoYW5kbGVfdmNwdV9jb250cm9sX2NyLAogCVtLVk1JX1ZDUFVfR0VUX0NQ
VUlEXSAgICAgICAgPSBoYW5kbGVfdmNwdV9nZXRfY3B1aWQsCkBAIC0yMjIsNiArMjQxLDcgQEAg
c3RhdGljIGt2bWlfdmNwdV9tc2dfam9iX2ZjdCBjb25zdCBtc2dfdmNwdVtdID0gewogCVtLVk1J
X1ZDUFVfR0VUX1hTQVZFXSAgICAgICAgPSBoYW5kbGVfdmNwdV9nZXRfeHNhdmUsCiAJW0tWTUlf
VkNQVV9JTkpFQ1RfRVhDRVBUSU9OXSA9IGhhbmRsZV92Y3B1X2luamVjdF9leGNlcHRpb24sCiAJ
W0tWTUlfVkNQVV9TRVRfUkVHSVNURVJTXSAgICA9IGhhbmRsZV92Y3B1X3NldF9yZWdpc3RlcnMs
CisJW0tWTUlfVkNQVV9TRVRfWFNBVkVdICAgICAgICA9IGhhbmRsZV92Y3B1X3NldF94c2F2ZSwK
IH07CiAKIGt2bWlfdmNwdV9tc2dfam9iX2ZjdCBrdm1pX2FyY2hfdmNwdV9tc2dfaGFuZGxlcih1
MTYgaWQpCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oIGIvaW5jbHVkZS91
YXBpL2xpbnV4L2t2bWkuaAppbmRleCBlNDdjNGNlMGY4ZWQuLjNiYWY1Yzc4NDJiYiAxMDA2NDQK
LS0tIGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAorKysgYi9pbmNsdWRlL3VhcGkvbGludXgv
a3ZtaS5oCkBAIC00Niw2ICs0Niw3IEBAIGVudW0gewogCUtWTUlfVkNQVV9JTkpFQ1RfRVhDRVBU
SU9OID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoNyksCiAJS1ZNSV9WQ1BVX0dFVF9YQ1IgICAgICAg
ICAgPSBLVk1JX1ZDUFVfTUVTU0FHRV9JRCg4KSwKIAlLVk1JX1ZDUFVfR0VUX1hTQVZFICAgICAg
ICA9IEtWTUlfVkNQVV9NRVNTQUdFX0lEKDkpLAorCUtWTUlfVkNQVV9TRVRfWFNBVkUgICAgICAg
ID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoMTApLAogCiAJS1ZNSV9ORVhUX1ZDUFVfTUVTU0FHRQog
fTsKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90
ZXN0LmMgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCmlu
ZGV4IDI3N2IxMDYxNDEwYi4uNDVjMWYzMTMyYTNjIDEwMDY0NAotLS0gYS90b29scy90ZXN0aW5n
L3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCisrKyBiL3Rvb2xzL3Rlc3Rpbmcvc2Vs
ZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKQEAgLTE0NDgsMjEgKzE0NDgsMzUgQEAgc3Rh
dGljIHZvaWQgdGVzdF9jbWRfdmNwdV9nZXRfeGNyKHN0cnVjdCBrdm1fdm0gKnZtKQogCWNtZF92
Y3B1X2dldF94Y3Iodm0sIHhjcjEsICZ2YWx1ZSwgLUtWTV9FSU5WQUwpOwogfQogCi1zdGF0aWMg
dm9pZCBjbWRfdmNwdV9nZXRfeHNhdmUoc3RydWN0IGt2bV92bSAqdm0pCitzdGF0aWMgdm9pZCBj
bWRfdmNwdV9nZXRfeHNhdmUoc3RydWN0IGt2bV92bSAqdm0sIHN0cnVjdCBrdm1feHNhdmUgKnJw
bCkKIHsKIAlzdHJ1Y3QgewogCQlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKIAkJc3RydWN0IGt2
bWlfdmNwdV9oZHIgdmNwdV9oZHI7CiAJfSByZXEgPSB7fTsKLQlzdHJ1Y3Qga3ZtX3hzYXZlIHJw
bDsKIAogCXRlc3RfdmNwdTBfY29tbWFuZCh2bSwgS1ZNSV9WQ1BVX0dFVF9YU0FWRSwgJnJlcS5o
ZHIsIHNpemVvZihyZXEpLAotCQkJICAgJnJwbCwgc2l6ZW9mKHJwbCksIDApOworCQkJICAgcnBs
LCBzaXplb2YoKnJwbCksIDApOwogfQogCi1zdGF0aWMgdm9pZCB0ZXN0X2NtZF92Y3B1X2dldF94
c2F2ZShzdHJ1Y3Qga3ZtX3ZtICp2bSkKK3N0YXRpYyB2b2lkIGNtZF92Y3B1X3NldF94c2F2ZShz
dHJ1Y3Qga3ZtX3ZtICp2bSwgc3RydWN0IGt2bV94c2F2ZSAqcnBsKQoreworCXN0cnVjdCB7CisJ
CXN0cnVjdCBrdm1pX21zZ19oZHIgaGRyOworCQlzdHJ1Y3Qga3ZtaV92Y3B1X2hkciB2Y3B1X2hk
cjsKKwkJc3RydWN0IGt2bV94c2F2ZSB4c2F2ZTsKKwl9IHJlcSA9IHt9OworCisJbWVtY3B5KCZy
ZXEueHNhdmUsIHJwbCwgc2l6ZW9mKCpycGwpKTsKKworCXRlc3RfdmNwdTBfY29tbWFuZCh2bSwg
S1ZNSV9WQ1BVX1NFVF9YU0FWRSwgJnJlcS5oZHIsIHNpemVvZihyZXEpLAorCQkJICAgTlVMTCwg
MCwgMCk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfY21kX3ZjcHVfeHNhdmUoc3RydWN0IGt2bV92
bSAqdm0pCiB7CiAJc3RydWN0IGt2bV9jcHVpZF9lbnRyeTIgKmVudHJ5OworCXN0cnVjdCBrdm1f
eHNhdmUgeHNhdmU7CiAKIAllbnRyeSA9IGt2bV9nZXRfc3VwcG9ydGVkX2NwdWlkX2VudHJ5KDEp
OwogCWlmICghKGVudHJ5LT5lY3ggJiBYODZfRkVBVFVSRV9YU0FWRSkpIHsKQEAgLTE0NzAsNyAr
MTQ4NCw4IEBAIHN0YXRpYyB2b2lkIHRlc3RfY21kX3ZjcHVfZ2V0X3hzYXZlKHN0cnVjdCBrdm1f
dm0gKnZtKQogCQlyZXR1cm47CiAJfQogCi0JY21kX3ZjcHVfZ2V0X3hzYXZlKHZtKTsKKwljbWRf
dmNwdV9nZXRfeHNhdmUodm0sICZ4c2F2ZSk7CisJY21kX3ZjcHVfc2V0X3hzYXZlKHZtLCAmeHNh
dmUpOwogfQogCiBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAq
dm0pCkBAIC0xNTAxLDcgKzE1MTYsNyBAQCBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24o
c3RydWN0IGt2bV92bSAqdm0pCiAJdGVzdF9jbWRfdm1fZ2V0X21heF9nZm4oKTsKIAl0ZXN0X2V2
ZW50X3hzZXRidih2bSk7CiAJdGVzdF9jbWRfdmNwdV9nZXRfeGNyKHZtKTsKLQl0ZXN0X2NtZF92
Y3B1X2dldF94c2F2ZSh2bSk7CisJdGVzdF9jbWRfdmNwdV94c2F2ZSh2bSk7CiAKIAl1bmhvb2tf
aW50cm9zcGVjdGlvbih2bSk7CiB9Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXphdGlvbkBs
aXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5v
cmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
