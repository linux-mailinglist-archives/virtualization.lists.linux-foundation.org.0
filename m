Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id E60601978C9
	for <lists.virtualization@lfdr.de>; Mon, 30 Mar 2020 12:20:04 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 9EA4486A29;
	Mon, 30 Mar 2020 10:20:03 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Hg-EdBUL6mTA; Mon, 30 Mar 2020 10:20:00 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 575AD86A90;
	Mon, 30 Mar 2020 10:19:56 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 23268C1D7E;
	Mon, 30 Mar 2020 10:19:56 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 4BAA2C07FF
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:52 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 390C58757F
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:52 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id PU7PkKa6xbed
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:50 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id 5C79C87960
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:50 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 50547305FFA8; Mon, 30 Mar 2020 13:12:57 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 31A66305B7A2;
 Mon, 30 Mar 2020 13:12:57 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v8 53/81] KVM: introspection: add KVMI_VCPU_PAUSE
Date: Mon, 30 Mar 2020 13:12:40 +0300
Message-Id: <20200330101308.21702-54-alazar@bitdefender.com>
In-Reply-To: <20200330101308.21702-1-alazar@bitdefender.com>
References: <20200330101308.21702-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>, virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhpcyBpcyB0aGUgb25seSB2Q1BVIGNvbW1hbmQgaGFuZGxlZCBieSB0aGUgcmVjZWl2aW5nIHRo
cmVhZC4KSXQgaW5jcmVtZW50cyBhIHBhdXNlIHJlcXVlc3QgY291bnRlciBhbmQga2lja3MgdGhl
IHZDUFUgb3V0IG9mIGd1ZXN0LgoKU2lnbmVkLW9mZi1ieTogQWRhbGJlcnQgTGF6xINyIDxhbGF6
YXJAYml0ZGVmZW5kZXIuY29tPgotLS0KIERvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3Qg
ICAgICAgICAgICAgICB8IDY0ICsrKysrKysrKysrKysrKysrKy0KIGluY2x1ZGUvbGludXgva3Zt
aV9ob3N0LmggICAgICAgICAgICAgICAgICAgICB8ICAyICsKIGluY2x1ZGUvdWFwaS9saW51eC9r
dm1pLmggICAgICAgICAgICAgICAgICAgICB8IDExICsrKy0KIC4uLi90ZXN0aW5nL3NlbGZ0ZXN0
cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jICB8IDMxICsrKysrKysrKwogdmlydC9rdm0vaW50cm9z
cGVjdGlvbi9rdm1pLmMgICAgICAgICAgICAgICAgIHwgNjMgKysrKysrKysrKysrKysrKy0tCiB2
aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmggICAgICAgICAgICAgfCAgMSArCiB2aXJ0
L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMgICAgICAgICAgICAgfCA0NCArKysrKysrKysr
KysrCiA3IGZpbGVzIGNoYW5nZWQsIDIxMCBpbnNlcnRpb25zKCspLCA2IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QgYi9Eb2N1bWVudGF0
aW9uL3ZpcnQva3ZtL2t2bWkucnN0CmluZGV4IDE2NDM4ZTg2MzAwMy4uNjQyZTJmMTBhZGZkIDEw
MDY0NAotLS0gYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CisrKyBiL0RvY3VtZW50
YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKQEAgLTQ3OCwxMiArNDc4LDUxIEBAIFJldHVybnMgdGhl
IFRTQyBmcmVxdWVuY3kgKGluIEhaKSBmb3IgdGhlIHNwZWNpZmllZCB2Q1BVIGlmIGF2YWlsYWJs
ZQogKiAtS1ZNX0VJTlZBTCAtIHRoZSBzZWxlY3RlZCB2Q1BVIGlzIGludmFsaWQKICogLUtWTV9F
QUdBSU4gLSB0aGUgc2VsZWN0ZWQgdkNQVSBjYW4ndCBiZSBpbnRyb3NwZWN0ZWQgeWV0CiAKKzku
IEtWTUlfVkNQVV9QQVVTRQorLS0tLS0tLS0tLS0tLS0tLS0tCisKKzpBcmNoaXRlY3R1cmU6IGFs
bAorOlZlcnNpb25zOiA+PSAxCis6UGFyYW1ldGVyczoKKworOjoKKworCXN0cnVjdCBrdm1pX3Zj
cHVfaGRyOworCXN0cnVjdCBrdm1pX3ZjcHVfcGF1c2UgeworCQlfX3U4IHdhaXQ7CisJCV9fdTgg
cGFkZGluZzE7CisJCV9fdTE2IHBhZGRpbmcyOworCQlfX3UzMiBwYWRkaW5nMzsKKwl9OworCis6
UmV0dXJuczoKKworOjoKKworCXN0cnVjdCBrdm1pX2Vycm9yX2NvZGU7CisKK0tpY2tzIHRoZSB2
Q1BVIG91dCBvZiBndWVzdC4KKworSWYgYHdhaXRgIGlzIDEsIHRoZSBjb21tYW5kIHdpbGwgd2Fp
dCBmb3IgdkNQVSB0byBhY2tub3dsZWRnZSB0aGUgSVBJLgorCitUaGUgdkNQVSB3aWxsIGhhbmRs
ZSB0aGUgcGVuZGluZyBjb21tYW5kcy9ldmVudHMgYW5kIHNlbmQgdGhlCisqS1ZNSV9FVkVOVF9Q
QVVTRV9WQ1BVKiBldmVudCAob25lIGZvciBldmVyeSBzdWNjZXNzZnVsICpLVk1JX1ZDUFVfUEFV
U0UqCitjb21tYW5kKSBiZWZvcmUgcmV0dXJuaW5nIHRvIGd1ZXN0LgorCis6RXJyb3JzOgorCisq
IC1LVk1fRUlOVkFMIC0gdGhlIHBhZGRpbmcgaXMgbm90IHplcm8KKyogLUtWTV9FSU5WQUwgLSB0
aGUgc2VsZWN0ZWQgdkNQVSBpcyBpbnZhbGlkCisqIC1LVk1fRUFHQUlOIC0gdGhlIHNlbGVjdGVk
IHZDUFUgY2FuJ3QgYmUgaW50cm9zcGVjdGVkIHlldAorKiAtS1ZNX0VCVVNZICAtIHRoZSBzZWxl
Y3RlZCB2Q1BVIGhhcyB0b28gbWFueSBxdWV1ZWQgKktWTUlfRVZFTlRfUEFVU0VfVkNQVSogZXZl
bnRzCisqIC1LVk1fRVBFUk0gIC0gdGhlICpLVk1JX0VWRU5UX1BBVVNFX1ZDUFUqIGV2ZW50IGlz
IGRpc2FsbG93ZWQKKwogRXZlbnRzCiA9PT09PT0KIAogQWxsIGludHJvc3BlY3Rpb24gZXZlbnRz
IChWTSBvciB2Q1BVIHJlbGF0ZWQpIGFyZSBzZW50CiB1c2luZyB0aGUgKktWTUlfRVZFTlQqIG1l
c3NhZ2UgaWQuIE5vIGV2ZW50IHdpbGwgYmUgc2VudCB1bmxlc3MKLWl0IGlzIGV4cGxpY2l0bHkg
ZW5hYmxlZC4KK2l0IGlzIGV4cGxpY2l0bHkgZW5hYmxlZCBvciByZXF1ZXN0ZWQgKGVnLiAqS1ZN
SV9FVkVOVF9QQVVTRV9WQ1BVKikuCiAKIFRoZSAqS1ZNSV9FVkVOVF9VTkhPT0sqIGV2ZW50IGRv
ZXNuJ3QgaGF2ZSBhIHJlcGx5IGFuZCBzaGFyZSB0aGUga3ZtaV9ldmVudAogc3RydWN0dXJlLCBm
b3IgY29uc2lzdGVuY3kgd2l0aCB0aGUgdkNQVSBldmVudHMuCkBAIC01NDIsMyArNTgxLDI2IEBA
IHRoZSBndWVzdCAoc2VlICoqVW5ob29raW5nKiopIGFuZCB0aGUgaW50cm9zcGVjdGlvbiBoYXMg
YmVlbiBlbmFibGVkCiBmb3IgdGhpcyBldmVudCAoc2VlICoqS1ZNSV9WTV9DT05UUk9MX0VWRU5U
UyoqKS4gVGhlIGludHJvc3BlY3Rpb24gdG9vbAogaGFzIGEgY2hhbmNlIHRvIHVuaG9vayBhbmQg
Y2xvc2UgdGhlIEtWTUkgY2hhbm5lbCAoc2lnbmFsaW5nIHRoYXQgdGhlCiBvcGVyYXRpb24gY2Fu
IHByb2NlZWQpLgorCisyLiBLVk1JX0VWRU5UX1BBVVNFX1ZDUFUKKy0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLQorCis6QXJjaGl0ZWN0dXJlczogYWxsCis6VmVyc2lvbnM6ID49IDEKKzpBY3Rpb25z
OiBDT05USU5VRSwgQ1JBU0gKKzpQYXJhbWV0ZXJzOgorCis6OgorCisJc3RydWN0IGt2bWlfZXZl
bnQ7CisKKzpSZXR1cm5zOgorCis6OgorCisJc3RydWN0IGt2bWlfdmNwdV9oZHI7CisJc3RydWN0
IGt2bWlfZXZlbnRfcmVwbHk7CisKK1RoaXMgZXZlbnQgaXMgc2VudCBpbiByZXNwb25zZSB0byBh
ICpLVk1JX1ZDUFVfUEFVU0UqIGNvbW1hbmQuCitCZWNhdXNlIGl0IGhhcyBhIGxvdyBwcmlvcml0
eSwgaXQgd2lsbCBiZSBzZW50IGFmdGVyIGFueSBvdGhlciB2Q1BVCitpbnRyb3NwZWN0aW9uIGV2
ZW50IGFuZCB3aGVuIG5vIHZDUFUgaW50cm9zcGVjdGlvbiBjb21tYW5kIGlzIHF1ZXVlZC4KZGlm
ZiAtLWdpdCBhL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmggYi9pbmNsdWRlL2xpbnV4L2t2bWlf
aG9zdC5oCmluZGV4IDZhMGZiNDgxYjE5Mi4uOTg4OTI3YzI5YmY1IDEwMDY0NAotLS0gYS9pbmNs
dWRlL2xpbnV4L2t2bWlfaG9zdC5oCisrKyBiL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmgKQEAg
LTIzLDYgKzIzLDggQEAgc3RydWN0IGt2bV92Y3B1X2ludHJvc3BlY3Rpb24gewogCiAJc3RydWN0
IGxpc3RfaGVhZCBqb2JfbGlzdDsKIAlzcGlubG9ja190IGpvYl9sb2NrOworCisJYXRvbWljX3Qg
cGF1c2VfcmVxdWVzdHM7CiB9OwogCiBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gewpkaWZmIC0t
Z2l0IGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaCBiL2luY2x1ZGUvdWFwaS9saW51eC9rdm1p
LmgKaW5kZXggNGNkYWFkNjU2ZGU0Li4zODk1NGE1Mjk3ZGEgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUv
dWFwaS9saW51eC9rdm1pLmgKKysrIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaApAQCAtMjYs
MTIgKzI2LDE0IEBAIGVudW0gewogCUtWTUlfVk1fV1JJVEVfUEhZU0lDQUwgPSA4LAogCiAJS1ZN
SV9WQ1BVX0dFVF9JTkZPICAgICA9IDksCisJS1ZNSV9WQ1BVX1BBVVNFICAgICAgICA9IDEwLAog
CiAJS1ZNSV9OVU1fTUVTU0FHRVMKIH07CiAKIGVudW0gewotCUtWTUlfRVZFTlRfVU5IT09LID0g
MCwKKwlLVk1JX0VWRU5UX1VOSE9PSyAgICAgPSAwLAorCUtWTUlfRVZFTlRfUEFVU0VfVkNQVSA9
IDEsCiAKIAlLVk1JX05VTV9FVkVOVFMKIH07CkBAIC0xMDgsNiArMTEwLDEzIEBAIHN0cnVjdCBr
dm1pX3ZjcHVfaGRyIHsKIAlfX3UzMiBwYWRkaW5nMjsKIH07CiAKK3N0cnVjdCBrdm1pX3ZjcHVf
cGF1c2UgeworCV9fdTggd2FpdDsKKwlfX3U4IHBhZGRpbmcxOworCV9fdTE2IHBhZGRpbmcyOwor
CV9fdTMyIHBhZGRpbmczOworfTsKKwogc3RydWN0IGt2bWlfZXZlbnQgewogCV9fdTE2IHNpemU7
CiAJX191MTYgdmNwdTsKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94
ODZfNjQva3ZtaV90ZXN0LmMgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2
bWlfdGVzdC5jCmluZGV4IGM3NjViMWU1NzA3ZC4uYmM4NGQ0NzhmZjZiIDEwMDY0NAotLS0gYS90
b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCisrKyBiL3Rvb2xz
L3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKQEAgLTY1NSw2ICs2NTUs
MzYgQEAgc3RhdGljIHZvaWQgdGVzdF9jbWRfZ2V0X3ZjcHVfaW5mbyhzdHJ1Y3Qga3ZtX3ZtICp2
bSkKIAlERUJVRygidHNjX3NwZWVkOiAlbGx1IEhaXG4iLCBycGwudHNjX3NwZWVkKTsKIH0KIAor
c3RhdGljIGludCBjbWRfcGF1c2VfdmNwdShzdHJ1Y3Qga3ZtX3ZtICp2bSkKK3sKKwlzdHJ1Y3Qg
eworCQlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwkJc3RydWN0IGt2bWlfdmNwdV9oZHIgdmNw
dV9oZHI7CisJCXN0cnVjdCBrdm1pX3ZjcHVfcGF1c2UgY21kOworCX0gcmVxID0ge307CisJX191
MTYgdmNwdV9pbmRleCA9IDA7CisKKwlyZXEudmNwdV9oZHIudmNwdSA9IHZjcHVfaW5kZXg7CisK
KwlyZXR1cm4gZG9fY29tbWFuZChLVk1JX1ZDUFVfUEFVU0UsICZyZXEuaGRyLCBzaXplb2YocmVx
KSwKKwkJCSAgICAgTlVMTCwgMCk7Cit9CisKK3N0YXRpYyB2b2lkIHBhdXNlX3ZjcHUoc3RydWN0
IGt2bV92bSAqdm0pCit7CisJaW50IHI7CisKKwlyID0gY21kX3BhdXNlX3ZjcHUodm0pOworCVRF
U1RfQVNTRVJUKHIgPT0gMCwKKwkJIktWTUlfVkNQVV9QQVVTRSBmYWlsZWQsIGVycm9yICVkKCVz
KVxuIiwKKwkJLXIsIGt2bV9zdHJlcnJvcigtcikpOworfQorCitzdGF0aWMgdm9pZCB0ZXN0X3Bh
dXNlKHN0cnVjdCBrdm1fdm0gKnZtKQoreworCXBhdXNlX3ZjcHUodm0pOworfQorCiBzdGF0aWMg
dm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAqdm0pCiB7CiAJc3JhbmRvbSh0
aW1lKDApKTsKQEAgLTY3MCw2ICs3MDAsNyBAQCBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rp
b24oc3RydWN0IGt2bV92bSAqdm0pCiAJdGVzdF9jbWRfdm1fY29udHJvbF9ldmVudHMoKTsKIAl0
ZXN0X21lbW9yeV9hY2Nlc3Modm0pOwogCXRlc3RfY21kX2dldF92Y3B1X2luZm8odm0pOworCXRl
c3RfcGF1c2Uodm0pOwogCiAJdW5ob29rX2ludHJvc3BlY3Rpb24odm0pOwogfQpkaWZmIC0tZ2l0
IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9u
L2t2bWkuYwppbmRleCA2NWE3N2I4ZDI2MTYuLmM0ZGEyNjRhZDVhNiAxMDA2NDQKLS0tIGEvdmly
dC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pLmMKQEAgLTExLDYgKzExLDggQEAKIAogI2RlZmluZSBLVk1JX01TR19TSVpFX0FMTE9DIChz
aXplb2Yoc3RydWN0IGt2bWlfbXNnX2hkcikgKyBLVk1JX01TR19TSVpFKQogCisjZGVmaW5lIE1B
WF9QQVVTRV9SRVFVRVNUUyAxMDAxCisKIHN0YXRpYyBERUNMQVJFX0JJVE1BUChLdm1pX2Fsd2F5
c19hbGxvd2VkX2NvbW1hbmRzLCBLVk1JX05VTV9DT01NQU5EUyk7CiBERUNMQVJFX0JJVE1BUChL
dm1pX2tub3duX2V2ZW50cywgS1ZNSV9OVU1fRVZFTlRTKTsKIERFQ0xBUkVfQklUTUFQKEt2bWlf
a25vd25fdm1fZXZlbnRzLCBLVk1JX05VTV9FVkVOVFMpOwpAQCAtNjksNiArNzEsNyBAQCBzdGF0
aWMgdm9pZCBzZXR1cF9rbm93bl9ldmVudHModm9pZCkKIAlzZXRfYml0KEtWTUlfRVZFTlRfVU5I
T09LLCBLdm1pX2tub3duX3ZtX2V2ZW50cyk7CiAKIAliaXRtYXBfemVybyhLdm1pX2tub3duX3Zj
cHVfZXZlbnRzLCBLVk1JX05VTV9FVkVOVFMpOworCXNldF9iaXQoS1ZNSV9FVkVOVF9QQVVTRV9W
Q1BVLCBLdm1pX2tub3duX3ZjcHVfZXZlbnRzKTsKIAogCWJpdG1hcF9vcihLdm1pX2tub3duX2V2
ZW50cywgS3ZtaV9rbm93bl92bV9ldmVudHMsCiAJCSAgS3ZtaV9rbm93bl92Y3B1X2V2ZW50cywg
S1ZNSV9OVU1fRVZFTlRTKTsKQEAgLTg3LDEwICs5MCwxNCBAQCB2b2lkIGt2bWlfdW5pbml0KHZv
aWQpCiAJa3ZtaV9jYWNoZV9kZXN0cm95KCk7CiB9CiAKLXN0YXRpYyB2b2lkIGt2bWlfbWFrZV9y
ZXF1ZXN0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKK3N0YXRpYyB2b2lkIGt2bWlfbWFrZV9yZXF1
ZXN0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgYm9vbCB3YWl0KQogewogCWt2bV9tYWtlX3JlcXVl
c3QoS1ZNX1JFUV9JTlRST1NQRUNUSU9OLCB2Y3B1KTsKLQlrdm1fdmNwdV9raWNrKHZjcHUpOwor
CisJaWYgKHdhaXQpCisJCWt2bV92Y3B1X2tpY2tfYW5kX3dhaXQodmNwdSk7CisJZWxzZQorCQlr
dm1fdmNwdV9raWNrKHZjcHUpOwogfQogCiBzdGF0aWMgaW50IF9fa3ZtaV9hZGRfam9iKHN0cnVj
dCBrdm1fdmNwdSAqdmNwdSwKQEAgLTEyNSw3ICsxMzIsNyBAQCBpbnQga3ZtaV9hZGRfam9iKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAllcnIgPSBfX2t2bWlfYWRkX2pvYih2Y3B1LCBmY3QsIGN0
eCwgZnJlZV9mY3QpOwogCiAJaWYgKCFlcnIpCi0JCWt2bWlfbWFrZV9yZXF1ZXN0KHZjcHUpOwor
CQlrdm1pX21ha2VfcmVxdWVzdCh2Y3B1LCBmYWxzZSk7CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAt
MzA0LDYgKzMxMSwyMiBAQCBzdGF0aWMgaW50IF9fa3ZtaV9ob29rKHN0cnVjdCBrdm0gKmt2bSwK
IAlyZXR1cm4gMDsKIH0KIAorc3RhdGljIHZvaWQga3ZtaV9qb2JfcmVsZWFzZV92Y3B1KHN0cnVj
dCBrdm1fdmNwdSAqdmNwdSwgdm9pZCAqY3R4KQoreworCXN0cnVjdCBrdm1fdmNwdV9pbnRyb3Nw
ZWN0aW9uICp2Y3B1aSA9IFZDUFVJKHZjcHUpOworCisJYXRvbWljX3NldCgmdmNwdWktPnBhdXNl
X3JlcXVlc3RzLCAwKTsKK30KKworc3RhdGljIHZvaWQga3ZtaV9yZWxlYXNlX3ZjcHVzKHN0cnVj
dCBrdm0gKmt2bSkKK3sKKwlzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHU7CisJaW50IGk7CisKKwlrdm1f
Zm9yX2VhY2hfdmNwdShpLCB2Y3B1LCBrdm0pCisJCWt2bWlfYWRkX2pvYih2Y3B1LCBrdm1pX2pv
Yl9yZWxlYXNlX3ZjcHUsIE5VTEwsIE5VTEwpOworfQorCiBzdGF0aWMgaW50IGt2bWlfcmVjdl90
aHJlYWQodm9pZCAqYXJnKQogewogCXN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSA9IGFy
ZzsKQEAgLTMxNyw2ICszNDAsOCBAQCBzdGF0aWMgaW50IGt2bWlfcmVjdl90aHJlYWQodm9pZCAq
YXJnKQogCSAqLwogCWt2bWlfc29ja19zaHV0ZG93bihrdm1pKTsKIAorCWt2bWlfcmVsZWFzZV92
Y3B1cyhrdm1pLT5rdm0pOworCiAJa3ZtaV9wdXQoa3ZtaS0+a3ZtKTsKIAlyZXR1cm4gMDsKIH0K
QEAgLTY4MSwxNSArNzA2LDQ1IEBAIHZvaWQga3ZtaV9ydW5fam9icyhzdHJ1Y3Qga3ZtX3ZjcHUg
KnZjcHUpCiAJfQogfQogCitzdGF0aWMgdm9pZCBrdm1pX3ZjcHVfcGF1c2VfZXZlbnQoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1KQoreworCXN0cnVjdCBrdm1fdmNwdV9pbnRyb3NwZWN0aW9uICp2Y3B1
aSA9IFZDUFVJKHZjcHUpOworCisJYXRvbWljX2RlYygmdmNwdWktPnBhdXNlX3JlcXVlc3RzKTsK
KwkvKiB0byBiZSBpbXBsZW1lbnRlZCAqLworfQorCiB2b2lkIGt2bWlfaGFuZGxlX3JlcXVlc3Rz
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKIHsKKwlzdHJ1Y3Qga3ZtX3ZjcHVfaW50cm9zcGVjdGlv
biAqdmNwdWkgPSBWQ1BVSSh2Y3B1KTsKIAlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWk7
CiAKIAlrdm1pID0ga3ZtaV9nZXQodmNwdS0+a3ZtKTsKIAlpZiAoIWt2bWkpCiAJCXJldHVybjsK
IAotCWt2bWlfcnVuX2pvYnModmNwdSk7CisJZm9yICg7OykgeworCQlrdm1pX3J1bl9qb2JzKHZj
cHUpOworCisJCWlmIChhdG9taWNfcmVhZCgmdmNwdWktPnBhdXNlX3JlcXVlc3RzKSkKKwkJCWt2
bWlfdmNwdV9wYXVzZV9ldmVudCh2Y3B1KTsKKwkJZWxzZQorCQkJYnJlYWs7CisJfQogCiAJa3Zt
aV9wdXQodmNwdS0+a3ZtKTsKIH0KKworaW50IGt2bWlfY21kX3ZjcHVfcGF1c2Uoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1LCBib29sIHdhaXQpCit7CisJc3RydWN0IGt2bV92Y3B1X2ludHJvc3BlY3Rp
b24gKnZjcHVpID0gVkNQVUkodmNwdSk7CisKKwlpZiAoYXRvbWljX3JlYWQoJnZjcHVpLT5wYXVz
ZV9yZXF1ZXN0cykgPiBNQVhfUEFVU0VfUkVRVUVTVFMpCisJCXJldHVybiAtS1ZNX0VCVVNZOwor
CisJYXRvbWljX2luYygmdmNwdWktPnBhdXNlX3JlcXVlc3RzKTsKKworCWt2bWlfbWFrZV9yZXF1
ZXN0KHZjcHUsIHdhaXQpOworCisJcmV0dXJuIDA7Cit9CmRpZmYgLS1naXQgYS92aXJ0L2t2bS9p
bnRyb3NwZWN0aW9uL2t2bWlfaW50LmggYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50
LmgKaW5kZXggNGE3MWUzM2Q0NmVmLi5iZDk2OGU4MzdhNTQgMTAwNjQ0Ci0tLSBhL3ZpcnQva3Zt
L2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaAorKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2
bWlfaW50LmgKQEAgLTQ0LDYgKzQ0LDcgQEAgaW50IGt2bWlfY21kX3JlYWRfcGh5c2ljYWwoc3Ry
dWN0IGt2bSAqa3ZtLCB1NjQgZ3BhLCBzaXplX3Qgc2l6ZSwKIAkJCSAgIGNvbnN0IHN0cnVjdCBr
dm1pX21zZ19oZHIgKmN0eCk7CiBpbnQga3ZtaV9jbWRfd3JpdGVfcGh5c2ljYWwoc3RydWN0IGt2
bSAqa3ZtLCB1NjQgZ3BhLCBzaXplX3Qgc2l6ZSwKIAkJCSAgICBjb25zdCB2b2lkICpidWYpOwor
aW50IGt2bWlfY21kX3ZjcHVfcGF1c2Uoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29sIHdhaXQp
OwogCiAvKiBhcmNoICovCiBpbnQga3ZtaV9hcmNoX2NtZF92Y3B1X2dldF9pbmZvKHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSwKZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9t
c2cuYyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwppbmRleCA2MmRjNTAwNjBh
MWUuLjc3MmJhMWQ3ZDlkZiAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1p
X21zZy5jCisrKyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwpAQCAtMjgsNiAr
MjgsNyBAQCBzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgbXNnX0lEc1tdID0gewogCVtLVk1JX1ZN
X1JFQURfUEhZU0lDQUxdICA9ICJLVk1JX1ZNX1JFQURfUEhZU0lDQUwiLAogCVtLVk1JX1ZNX1dS
SVRFX1BIWVNJQ0FMXSA9ICJLVk1JX1ZNX1dSSVRFX1BIWVNJQ0FMIiwKIAlbS1ZNSV9WQ1BVX0dF
VF9JTkZPXSAgICAgPSAiS1ZNSV9WQ1BVX0dFVF9JTkZPIiwKKwlbS1ZNSV9WQ1BVX1BBVVNFXSAg
ICAgICAgPSAiS1ZNSV9WQ1BVX1BBVVNFIiwKIH07CiAKIHN0YXRpYyBjb25zdCBjaGFyICppZDJz
dHIodTE2IGlkKQpAQCAtMjk4LDYgKzI5OSw0OCBAQCBzdGF0aWMgaW50IGhhbmRsZV93cml0ZV9w
aHlzaWNhbChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksCiAJcmV0dXJuIGt2bWlfbXNn
X3ZtX3JlcGx5KGt2bWksIG1zZywgZWMsIE5VTEwsIDApOwogfQogCisvKgorICogVGhpcyB2Q1BV
IGNvbW1hbmQgaXMgaGFuZGxlZCBmcm9tIHRoZSByZWNlaXZpbmcgdGhyZWFkIGluc3RlYWQgb2YK
KyAqIHRoZSB2Q1BVIHRocmVhZCwgdG8gbWFrZSBpdCBlYXNpZXIgZm9yIHVzZXJzcGFjZSB0byBp
bXBsZW1lbnQgYSAncGF1c2UgVk0nCisgKiBjb21tYW5kIGJ5IHNlbmRpbmcgYSAncGF1c2UgdkNQ
VScgY29tbWFuZCAod2l0aCB3YWl0PTEpIGZvciBldmVyeSB2Q1BVLgorICogQnkgaGFuZGxpbmcg
dGhlIGNvbW1hbmQgaGVyZSwgdGhlIHVzZXJzcGFjZSBjYW4gY29uc2lkZXIgdGhhdCB0aGUgVk0K
KyAqIGlzIHN0b3BwZWQgKG5vIHZDUFUgcnVucyBndWVzdCBjb2RlKSBvbmNlIGl0IHJlY2VpdmVz
IHRoZSByZXBseQorICogZm9yIHRoZSBsYXN0ICdwYXVzZSB2Q1BVJyBjb21tYW5kLgorICovCitz
dGF0aWMgaW50IGhhbmRsZV9wYXVzZV92Y3B1KHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3Zt
aSwKKwkJCSAgICAgY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAqbXNnLAorCQkJICAgICBjb25z
dCB2b2lkICpfcmVxKQoreworCWNvbnN0IHN0cnVjdCBrdm1pX3ZjcHVfcGF1c2UgKnJlcSA9IF9y
ZXE7CisJY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9oZHIgKmNtZDsKKwlzdHJ1Y3Qga3ZtX3ZjcHUg
KnZjcHUgPSBOVUxMOworCWludCBlcnI7CisKKwljbWQgPSAoY29uc3Qgc3RydWN0IGt2bWlfdmNw
dV9oZHIgKikgKG1zZyArIDEpOworCisJaWYgKGludmFsaWRfdmNwdV9oZHIoY21kKSB8fCByZXEt
PndhaXQgPiAwKSB7CisJCWVyciA9IC1LVk1fRUlOVkFMOworCQlnb3RvIHJlcGx5OworCX0KKwor
CWlmIChyZXEtPnBhZGRpbmcxIHx8IHJlcS0+cGFkZGluZzIgfHwgcmVxLT5wYWRkaW5nMykgewor
CQllcnIgPSAtS1ZNX0VJTlZBTDsKKwkJZ290byByZXBseTsKKwl9CisKKwlpZiAoIWlzX2V2ZW50
X2FsbG93ZWQoa3ZtaSwgS1ZNSV9FVkVOVF9QQVVTRV9WQ1BVKSkgeworCQllcnIgPSAtS1ZNX0VQ
RVJNOworCQlnb3RvIHJlcGx5OworCX0KKworCWVyciA9IGt2bWlfZ2V0X3ZjcHUoa3ZtaSwgY21k
LT52Y3B1LCAmdmNwdSk7CisJaWYgKCFlcnIpCisJCWVyciA9IGt2bWlfY21kX3ZjcHVfcGF1c2Uo
dmNwdSwgcmVxLT53YWl0ID09IDEpOworCityZXBseToKKwlyZXR1cm4ga3ZtaV9tc2dfdm1fcmVw
bHkoa3ZtaSwgbXNnLCBlcnIsIE5VTEwsIDApOworfQorCiAvKgogICogVGhlc2UgY29tbWFuZHMg
YXJlIGV4ZWN1dGVkIGJ5IHRoZSByZWNlaXZpbmcgdGhyZWFkL3dvcmtlci4KICAqLwpAQCAtMzEw
LDYgKzM1Myw3IEBAIHN0YXRpYyBpbnQoKmNvbnN0IG1zZ192bVtdKShzdHJ1Y3Qga3ZtX2ludHJv
c3BlY3Rpb24gKiwKIAlbS1ZNSV9WTV9HRVRfSU5GT10gICAgICAgPSBoYW5kbGVfZ2V0X2luZm8s
CiAJW0tWTUlfVk1fUkVBRF9QSFlTSUNBTF0gID0gaGFuZGxlX3JlYWRfcGh5c2ljYWwsCiAJW0tW
TUlfVk1fV1JJVEVfUEhZU0lDQUxdID0gaGFuZGxlX3dyaXRlX3BoeXNpY2FsLAorCVtLVk1JX1ZD
UFVfUEFVU0VdICAgICAgICA9IGhhbmRsZV9wYXVzZV92Y3B1LAogfTsKIAogc3RhdGljIGJvb2wg
aXNfdm1fY29tbWFuZCh1MTYgaWQpCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXphdGlvbkBs
aXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5v
cmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
