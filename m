Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [IPv6:2605:bc80:3010::136])
	by mail.lfdr.de (Postfix) with ESMTPS id CD8CA6CB718
	for <lists.virtualization@lfdr.de>; Tue, 28 Mar 2023 08:26:32 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id 095AC6118A;
	Tue, 28 Mar 2023 06:26:31 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 095AC6118A
Authentication-Results: smtp3.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=b8rhUghI
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id CL593s5iEmGp; Tue, 28 Mar 2023 06:26:30 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [IPv6:2605:bc80:3010:104::8cd3:938])
	by smtp3.osuosl.org (Postfix) with ESMTPS id 8F38361160;
	Tue, 28 Mar 2023 06:26:29 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 8F38361160
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id D0182C007E;
	Tue, 28 Mar 2023 06:26:28 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 29AAFC002F
 for <virtualization@lists.linux-foundation.org>;
 Tue, 28 Mar 2023 06:26:27 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp3.osuosl.org (Postfix) with ESMTP id 047926118A
 for <virtualization@lists.linux-foundation.org>;
 Tue, 28 Mar 2023 06:26:27 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 047926118A
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
 by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id m5tL4LKdLiKk
 for <virtualization@lists.linux-foundation.org>;
 Tue, 28 Mar 2023 06:26:26 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 036D961160
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.129.124])
 by smtp3.osuosl.org (Postfix) with ESMTPS id 036D961160
 for <virtualization@lists.linux-foundation.org>;
 Tue, 28 Mar 2023 06:26:25 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1679984785;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=u4RDmSXEMQbcms8qasm8t+guQ0+Hg+ttFCwmMxFWYQ4=;
 b=b8rhUghIyyFrmJ3eLlHQlYkvj2n+6AOTe0ofDXz0P6DnaZNOBQVmATF9UuHRAfTXKI63W1
 iTqVMeK0SZozqxPO/gR/K7V58kBtWRKt5jvt3X7CuZejNXcAqGOUFdJE0rJr56LJ9aL6r3
 6q78zmjkZEuN6C8aYroQBz/cc8xuFvU=
Received: from mail-oo1-f70.google.com (mail-oo1-f70.google.com
 [209.85.161.70]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-121-Y1pxVan5Oyy-K2fjMW4Ubw-1; Tue, 28 Mar 2023 02:26:22 -0400
X-MC-Unique: Y1pxVan5Oyy-K2fjMW4Ubw-1
Received: by mail-oo1-f70.google.com with SMTP id
 t18-20020a4a7452000000b00525456d55f7so2707516ooe.14
 for <virtualization@lists.linux-foundation.org>;
 Mon, 27 Mar 2023 23:26:22 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112; t=1679984782;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=u4RDmSXEMQbcms8qasm8t+guQ0+Hg+ttFCwmMxFWYQ4=;
 b=vNupFCHJGax3SLB61Ev6nh6ZhdiHN2EJwT/NYFsC3XLbnxW/QdUPO7etTnIEUm8J6T
 ESPncBDf6+Zd+40xrxQQ0WGFfZnDTk2QLC8qIxYMz0GSHY9Epa/LU+oE8XQiUEVEXgAU
 FBKJqUAz9j9zHNyArGRCSmR3oBDfavUqSDChZSndd6GluuAlZXnFj0QYR8YD0NWeqsuE
 8SCSsfzcSvp6k7njbsrz+t5aPA326YwA2mNVKObNOXayVh9f0px70dtR1YMkWypvF413
 FenEvkqYu2HQai3xkMKnwm1l08A3UrcfomVYR2YOnMnuaGjDKNfQ3g1m3SLDUOKoCTrR
 8Hfw==
X-Gm-Message-State: AO0yUKWLfwsLdQT6Scvz+zIg9d4UbE5nlT6iPyAt2s/JqHtOB/YHqf2h
 nqpcqtSeqMI47NFOdN3dQJO/+J5TvuWBwoPP+VKEtHOfyNafiJdDHaZPAh2aAd8hNLEbi4lkQjW
 7Hwa4rQY4h0YJ+bQCCLm5KcDfJEvXHGAXBET3/J+Ez70cUWffBGcGk4h0Ag==
X-Received: by 2002:a05:6871:4983:b0:17e:e3b2:6d99 with SMTP id
 tx3-20020a056871498300b0017ee3b26d99mr4067545oab.9.1679984781922; 
 Mon, 27 Mar 2023 23:26:21 -0700 (PDT)
X-Google-Smtp-Source: AK7set+KRDYDBio9H5u2DQLaBU+REvRLxCJ88FKRGoAa+ASuDFeH45FJ/hkGzsCsRGnAn7wRUUJQ8V+dRqxsn9xuG/U=
X-Received: by 2002:a05:6871:4983:b0:17e:e3b2:6d99 with SMTP id
 tx3-20020a056871498300b0017ee3b26d99mr4067540oab.9.1679984781675; Mon, 27 Mar
 2023 23:26:21 -0700 (PDT)
MIME-Version: 1.0
References: <20230327040536.48338-1-xuanzhuo@linux.alibaba.com>
 <20230327040536.48338-2-xuanzhuo@linux.alibaba.com>
In-Reply-To: <20230327040536.48338-2-xuanzhuo@linux.alibaba.com>
From: Jason Wang <jasowang@redhat.com>
Date: Tue, 28 Mar 2023 14:26:10 +0800
Message-ID: <CACGkMEt+GfKyyFvose557F3wq0FSPKE8OOOAcsjM3K_SGfyGGw@mail.gmail.com>
Subject: Re: [PATCH vhost v6 01/11] virtio_ring: split: separate dma codes
To: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: "Michael S. Tsirkin" <mst@redhat.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gTW9uLCBNYXIgMjcsIDIwMjMgYXQgMTI6MDXigK9QTSBYdWFuIFpodW8gPHh1YW56aHVvQGxp
bnV4LmFsaWJhYmEuY29tPiB3cm90ZToKPgo+IERNQS1yZWxhdGVkIGxvZ2ljIGlzIHNlcGFyYXRl
ZCBmcm9tIHRoZSB2aXJ0cXVldWVfYWRkX3NwbGl0KCkgdG8KPiBvbmUgbmV3IGZ1bmN0aW9uLiBE
TUEgYWRkcmVzcyB3aWxsIGJlIHNhdmVkIGFzIHNnLT5kbWFfYWRkcmVzcyBpZgo+IHVzZV9kbWFf
YXBpIGlzIHRydWUsIHRoZW4gdmlydHF1ZXVlX2FkZF9zcGxpdCgpIHdpbGwgdXNlIGl0IGRpcmVj
dGx5Lgo+IFVubWFwIG9wZXJhdGlvbiB3aWxsIGJlIHNpbXBsZXIuCj4KPiBUaGUgcHVycG9zZSBv
ZiB0aGlzIGlzIHRvIGZhY2lsaXRhdGUgc3Vic2VxdWVudCBzdXBwb3J0IHRvIHJlY2VpdmUKPiBk
bWEgYWRkcmVzcyBtYXBwZWQgYnkgZHJpdmVycy4KPgo+IFNpZ25lZC1vZmYtYnk6IFh1YW4gWmh1
byA8eHVhbnpodW9AbGludXguYWxpYmFiYS5jb20+CgpBY2tlZC1ieTogSmFzb24gV2FuZyA8amFz
b3dhbmdAcmVkaGF0LmNvbT4KClRoYW5rcwoKPiAtLS0KPiAgZHJpdmVycy92aXJ0aW8vdmlydGlv
X3JpbmcuYyB8IDEyMiArKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLQo+ICAxIGZp
bGUgY2hhbmdlZCwgOTQgaW5zZXJ0aW9ucygrKSwgMjggZGVsZXRpb25zKC0pCj4KPiBkaWZmIC0t
Z2l0IGEvZHJpdmVycy92aXJ0aW8vdmlydGlvX3JpbmcuYyBiL2RyaXZlcnMvdmlydGlvL3ZpcnRp
b19yaW5nLmMKPiBpbmRleCA0MTE0NGI1MjQ2YTguLjJhYWZiN2RhNzkzZCAxMDA2NDQKPiAtLS0g
YS9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fcmluZy5jCj4gKysrIGIvZHJpdmVycy92aXJ0aW8vdmly
dGlvX3JpbmcuYwo+IEBAIC0zNzksNiArMzc5LDE0IEBAIHN0YXRpYyBkbWFfYWRkcl90IHZyaW5n
X21hcF9vbmVfc2coY29uc3Qgc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAqdnEsCj4gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbik7Cj4gIH0KPgo+ICtzdGF0aWMgZG1hX2FkZHJf
dCB2cmluZ19zZ19hZGRyZXNzKHN0cnVjdCBzY2F0dGVybGlzdCAqc2cpCj4gK3sKPiArICAgICAg
IGlmIChzZy0+ZG1hX2FkZHJlc3MpCj4gKyAgICAgICAgICAgICAgIHJldHVybiBzZy0+ZG1hX2Fk
ZHJlc3M7Cj4gKwo+ICsgICAgICAgcmV0dXJuIChkbWFfYWRkcl90KXNnX3BoeXMoc2cpOwo+ICt9
Cj4gKwo+ICBzdGF0aWMgZG1hX2FkZHJfdCB2cmluZ19tYXBfc2luZ2xlKGNvbnN0IHN0cnVjdCB2
cmluZ192aXJ0cXVldWUgKnZxLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dm9pZCAqY3B1X2FkZHIsIHNpemVfdCBzaXplLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyZWN0aW9uKQo+IEBAIC01MjAsNiAr
NTI4LDgwIEBAIHN0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50IHZpcnRxdWV1ZV9hZGRfZGVzY19z
cGxpdChzdHJ1Y3QgdmlydHF1ZXVlICp2cSwKPiAgICAgICAgIHJldHVybiBuZXh0Owo+ICB9Cj4K
PiArc3RhdGljIHZvaWQgdmlydHF1ZXVlX3VubWFwX3NncyhzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVl
ICp2cSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBzY2F0dGVybGlz
dCAqc2dzW10sCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQg
dG90YWxfc2csCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQg
b3V0X3NncywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBp
bl9zZ3MpCj4gK3sKPiArICAgICAgIHN0cnVjdCBzY2F0dGVybGlzdCAqc2c7Cj4gKyAgICAgICB1
bnNpZ25lZCBpbnQgbjsKPiArCj4gKyAgICAgICBpZiAoIXZxLT51c2VfZG1hX2FwaSkKPiArICAg
ICAgICAgICAgICAgcmV0dXJuOwo+ICsKPiArICAgICAgIGZvciAobiA9IDA7IG4gPCBvdXRfc2dz
OyBuKyspIHsKPiArICAgICAgICAgICAgICAgZm9yIChzZyA9IHNnc1tuXTsgc2c7IHNnID0gc2df
bmV4dChzZykpIHsKPiArICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNnLT5kbWFfYWRkcmVz
cykKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKPiArCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgZG1hX3VubWFwX3BhZ2UodnJpbmdfZG1hX2Rldih2cSksIHNnLT5k
bWFfYWRkcmVzcywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZy0+
bGVuZ3RoLCBETUFfVE9fREVWSUNFKTsKPiArICAgICAgICAgICAgICAgfQo+ICsgICAgICAgfQo+
ICsKPiArICAgICAgIGZvciAoOyBuIDwgKG91dF9zZ3MgKyBpbl9zZ3MpOyBuKyspIHsKPiArICAg
ICAgICAgICAgICAgZm9yIChzZyA9IHNnc1tuXTsgc2c7IHNnID0gc2dfbmV4dChzZykpIHsKPiAr
ICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNnLT5kbWFfYWRkcmVzcykKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKPiArCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgZG1hX3VubWFwX3BhZ2UodnJpbmdfZG1hX2Rldih2cSksIHNnLT5kbWFfYWRkcmVzcywKPiAr
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZy0+bGVuZ3RoLCBETUFfRlJP
TV9ERVZJQ0UpOwo+ICsgICAgICAgICAgICAgICB9Cj4gKyAgICAgICB9Cj4gK30KPiArCj4gK3N0
YXRpYyBpbnQgdmlydHF1ZXVlX21hcF9zZ3Moc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAqdnEsCj4g
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnc1tdLAo+
ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IHRvdGFsX3NnLAo+ICsg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IG91dF9zZ3MsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgaW5fc2dzKQo+ICt7Cj4gKyAgICAg
ICBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwo+ICsgICAgICAgdW5zaWduZWQgaW50IG47Cj4gKwo+
ICsgICAgICAgaWYgKCF2cS0+dXNlX2RtYV9hcGkpCj4gKyAgICAgICAgICAgICAgIHJldHVybiAw
Owo+ICsKPiArICAgICAgIGZvciAobiA9IDA7IG4gPCBvdXRfc2dzOyBuKyspIHsKPiArICAgICAg
ICAgICAgICAgZm9yIChzZyA9IHNnc1tuXTsgc2c7IHNnID0gc2dfbmV4dChzZykpIHsKPiArICAg
ICAgICAgICAgICAgICAgICAgICBkbWFfYWRkcl90IGFkZHIgPSB2cmluZ19tYXBfb25lX3NnKHZx
LCBzZywgRE1BX1RPX0RFVklDRSk7Cj4gKwo+ICsgICAgICAgICAgICAgICAgICAgICAgIGlmICh2
cmluZ19tYXBwaW5nX2Vycm9yKHZxLCBhZGRyKSkKPiArICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGdvdG8gZXJyOwo+ICsKPiArICAgICAgICAgICAgICAgICAgICAgICBzZy0+ZG1hX2Fk
ZHJlc3MgPSBhZGRyOwo+ICsgICAgICAgICAgICAgICB9Cj4gKyAgICAgICB9Cj4gKwo+ICsgICAg
ICAgZm9yICg7IG4gPCAob3V0X3NncyArIGluX3Nncyk7IG4rKykgewo+ICsgICAgICAgICAgICAg
ICBmb3IgKHNnID0gc2dzW25dOyBzZzsgc2cgPSBzZ19uZXh0KHNnKSkgewo+ICsgICAgICAgICAg
ICAgICAgICAgICAgIGRtYV9hZGRyX3QgYWRkciA9IHZyaW5nX21hcF9vbmVfc2codnEsIHNnLCBE
TUFfRlJPTV9ERVZJQ0UpOwo+ICsKPiArICAgICAgICAgICAgICAgICAgICAgICBpZiAodnJpbmdf
bWFwcGluZ19lcnJvcih2cSwgYWRkcikpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBnb3RvIGVycjsKPiArCj4gKyAgICAgICAgICAgICAgICAgICAgICAgc2ctPmRtYV9hZGRyZXNz
ID0gYWRkcjsKPiArICAgICAgICAgICAgICAgfQo+ICsgICAgICAgfQo+ICsKPiArICAgICAgIHJl
dHVybiAwOwo+ICsKPiArZXJyOgo+ICsgICAgICAgdmlydHF1ZXVlX3VubWFwX3Nncyh2cSwgc2dz
LCB0b3RhbF9zZywgb3V0X3NncywgaW5fc2dzKTsKPiArICAgICAgIHJldHVybiAtRU5PTUVNOwo+
ICt9Cj4gKwo+ICBzdGF0aWMgaW5saW5lIGludCB2aXJ0cXVldWVfYWRkX3NwbGl0KHN0cnVjdCB2
aXJ0cXVldWUgKl92cSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0
cnVjdCBzY2F0dGVybGlzdCAqc2dzW10sCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB1bnNpZ25lZCBpbnQgdG90YWxfc2csCj4gQEAgLTUzMiw5ICs2MTQsOSBAQCBzdGF0
aWMgaW5saW5lIGludCB2aXJ0cXVldWVfYWRkX3NwbGl0KHN0cnVjdCB2aXJ0cXVldWUgKl92cSwK
PiAgICAgICAgIHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxID0gdG9fdnZxKF92cSk7Cj4gICAg
ICAgICBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwo+ICAgICAgICAgc3RydWN0IHZyaW5nX2Rlc2Mg
KmRlc2M7Cj4gLSAgICAgICB1bnNpZ25lZCBpbnQgaSwgbiwgYXZhaWwsIGRlc2NzX3VzZWQsIHBy
ZXYsIGVycl9pZHg7Cj4gLSAgICAgICBpbnQgaGVhZDsKPiArICAgICAgIHVuc2lnbmVkIGludCBp
LCBuLCBhdmFpbCwgZGVzY3NfdXNlZCwgcHJldjsKPiAgICAgICAgIGJvb2wgaW5kaXJlY3Q7Cj4g
KyAgICAgICBpbnQgaGVhZDsKPgo+ICAgICAgICAgU1RBUlRfVVNFKHZxKTsKPgo+IEBAIC01ODYs
MzIgKzY2OCwzMCBAQCBzdGF0aWMgaW5saW5lIGludCB2aXJ0cXVldWVfYWRkX3NwbGl0KHN0cnVj
dCB2aXJ0cXVldWUgKl92cSwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9TUEM7Cj4gICAg
ICAgICB9Cj4KPiArICAgICAgIGlmICh2aXJ0cXVldWVfbWFwX3Nncyh2cSwgc2dzLCB0b3RhbF9z
Zywgb3V0X3NncywgaW5fc2dzKSkKPiArICAgICAgICAgICAgICAgZ290byBlcnJfbWFwOwo+ICsK
PiAgICAgICAgIGZvciAobiA9IDA7IG4gPCBvdXRfc2dzOyBuKyspIHsKPiAgICAgICAgICAgICAg
ICAgZm9yIChzZyA9IHNnc1tuXTsgc2c7IHNnID0gc2dfbmV4dChzZykpIHsKPiAtICAgICAgICAg
ICAgICAgICAgICAgICBkbWFfYWRkcl90IGFkZHIgPSB2cmluZ19tYXBfb25lX3NnKHZxLCBzZywg
RE1BX1RPX0RFVklDRSk7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZyaW5nX21hcHBp
bmdfZXJyb3IodnEsIGFkZHIpKQo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ290
byB1bm1hcF9yZWxlYXNlOwo+IC0KPiAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2ID0gaTsK
PiAgICAgICAgICAgICAgICAgICAgICAgICAvKiBOb3RlIHRoYXQgd2UgdHJ1c3QgaW5kaXJlY3Qg
ZGVzY3JpcHRvcgo+ICAgICAgICAgICAgICAgICAgICAgICAgICAqIHRhYmxlIHNpbmNlIGl0IHVz
ZSBzdHJlYW0gRE1BIG1hcHBpbmcuCj4gICAgICAgICAgICAgICAgICAgICAgICAgICovCj4gLSAg
ICAgICAgICAgICAgICAgICAgICAgaSA9IHZpcnRxdWV1ZV9hZGRfZGVzY19zcGxpdChfdnEsIGRl
c2MsIGksIGFkZHIsIHNnLT5sZW5ndGgsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgaSA9IHZp
cnRxdWV1ZV9hZGRfZGVzY19zcGxpdChfdnEsIGRlc2MsIGksCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2cmluZ19zZ19hZGRyZXNzKHNnKSwK
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNn
LT5sZW5ndGgsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBWUklOR19ERVNDX0ZfTkVYVCwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGluZGlyZWN0KTsKPiAgICAgICAgICAgICAgICAgfQo+
ICAgICAgICAgfQo+ICAgICAgICAgZm9yICg7IG4gPCAob3V0X3NncyArIGluX3Nncyk7IG4rKykg
ewo+ICAgICAgICAgICAgICAgICBmb3IgKHNnID0gc2dzW25dOyBzZzsgc2cgPSBzZ19uZXh0KHNn
KSkgewo+IC0gICAgICAgICAgICAgICAgICAgICAgIGRtYV9hZGRyX3QgYWRkciA9IHZyaW5nX21h
cF9vbmVfc2codnEsIHNnLCBETUFfRlJPTV9ERVZJQ0UpOwo+IC0gICAgICAgICAgICAgICAgICAg
ICAgIGlmICh2cmluZ19tYXBwaW5nX2Vycm9yKHZxLCBhZGRyKSkKPiAtICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGdvdG8gdW5tYXBfcmVsZWFzZTsKPiAtCj4gICAgICAgICAgICAgICAg
ICAgICAgICAgcHJldiA9IGk7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgLyogTm90ZSB0aGF0
IHdlIHRydXN0IGluZGlyZWN0IGRlc2NyaXB0b3IKPiAgICAgICAgICAgICAgICAgICAgICAgICAg
KiB0YWJsZSBzaW5jZSBpdCB1c2Ugc3RyZWFtIERNQSBtYXBwaW5nLgo+ICAgICAgICAgICAgICAg
ICAgICAgICAgICAqLwo+IC0gICAgICAgICAgICAgICAgICAgICAgIGkgPSB2aXJ0cXVldWVfYWRk
X2Rlc2Nfc3BsaXQoX3ZxLCBkZXNjLCBpLCBhZGRyLAo+ICsgICAgICAgICAgICAgICAgICAgICAg
IGkgPSB2aXJ0cXVldWVfYWRkX2Rlc2Nfc3BsaXQoX3ZxLCBkZXNjLCBpLAo+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnJpbmdfc2dfYWRkcmVz
cyhzZyksCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzZy0+bGVuZ3RoLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgVlJJTkdfREVTQ19GX05FWFQgfAo+ICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVlJJTkdfREVTQ19GX1dSSVRFLAo+IEBA
IC02NzksMjMgKzc1OSw5IEBAIHN0YXRpYyBpbmxpbmUgaW50IHZpcnRxdWV1ZV9hZGRfc3BsaXQo
c3RydWN0IHZpcnRxdWV1ZSAqX3ZxLAo+ICAgICAgICAgcmV0dXJuIDA7Cj4KPiAgdW5tYXBfcmVs
ZWFzZToKPiAtICAgICAgIGVycl9pZHggPSBpOwo+IC0KPiAtICAgICAgIGlmIChpbmRpcmVjdCkK
PiAtICAgICAgICAgICAgICAgaSA9IDA7Cj4gLSAgICAgICBlbHNlCj4gLSAgICAgICAgICAgICAg
IGkgPSBoZWFkOwo+IC0KPiAtICAgICAgIGZvciAobiA9IDA7IG4gPCB0b3RhbF9zZzsgbisrKSB7
Cj4gLSAgICAgICAgICAgICAgIGlmIChpID09IGVycl9pZHgpCj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgYnJlYWs7Cj4gLSAgICAgICAgICAgICAgIGlmIChpbmRpcmVjdCkgewo+IC0gICAgICAg
ICAgICAgICAgICAgICAgIHZyaW5nX3VubWFwX29uZV9zcGxpdF9pbmRpcmVjdCh2cSwgJmRlc2Nb
aV0pOwo+IC0gICAgICAgICAgICAgICAgICAgICAgIGkgPSB2aXJ0aW8xNl90b19jcHUoX3ZxLT52
ZGV2LCBkZXNjW2ldLm5leHQpOwo+IC0gICAgICAgICAgICAgICB9IGVsc2UKPiAtICAgICAgICAg
ICAgICAgICAgICAgICBpID0gdnJpbmdfdW5tYXBfb25lX3NwbGl0KHZxLCBpKTsKPiAtICAgICAg
IH0KPiArICAgICAgIHZpcnRxdWV1ZV91bm1hcF9zZ3ModnEsIHNncywgdG90YWxfc2csIG91dF9z
Z3MsIGluX3Nncyk7Cj4KPiArZXJyX21hcDoKPiAgICAgICAgIGlmIChpbmRpcmVjdCkKPiAgICAg
ICAgICAgICAgICAga2ZyZWUoZGVzYyk7Cj4KPiAtLQo+IDIuMzIuMC4zLmcwMTE5NWNmOWYKPgoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6
YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24u
b3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3Zp
cnR1YWxpemF0aW9u
