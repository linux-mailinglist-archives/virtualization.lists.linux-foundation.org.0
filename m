Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
	by mail.lfdr.de (Postfix) with ESMTPS id B282B7BF50D
	for <lists.virtualization@lfdr.de>; Tue, 10 Oct 2023 09:58:45 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp1.osuosl.org (Postfix) with ESMTP id BEABE81FAA;
	Tue, 10 Oct 2023 07:58:42 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org BEABE81FAA
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
	by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id W5l2U6orpAz7; Tue, 10 Oct 2023 07:58:41 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp1.osuosl.org (Postfix) with ESMTPS id CA3C781FA5;
	Tue, 10 Oct 2023 07:58:40 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org CA3C781FA5
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 00E97C0DD3;
	Tue, 10 Oct 2023 07:58:40 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [IPv6:2605:bc80:3010::133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id B4ADCC0032
 for <virtualization@lists.linux-foundation.org>;
 Tue, 10 Oct 2023 07:58:38 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id 83917405CB
 for <virtualization@lists.linux-foundation.org>;
 Tue, 10 Oct 2023 07:58:38 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org 83917405CB
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id OOHe35B5viKP
 for <virtualization@lists.linux-foundation.org>;
 Tue, 10 Oct 2023 07:58:37 +0000 (UTC)
Received: from out30-111.freemail.mail.aliyun.com
 (out30-111.freemail.mail.aliyun.com [115.124.30.111])
 by smtp2.osuosl.org (Postfix) with ESMTPS id 755A7401DF
 for <virtualization@lists.linux-foundation.org>;
 Tue, 10 Oct 2023 07:58:35 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org 755A7401DF
X-Alimail-AntiSpam: AC=PASS; BC=-1|-1; BR=01201311R201e4; CH=green; DM=||false|;
 DS=||; FP=0|-1|-1|-1|0|-1|-1|-1; HT=ay29a033018046056;
 MF=xuanzhuo@linux.alibaba.com; NM=1; PH=DS; RN=3; SR=0;
 TI=SMTPD_---0Vtrvnrp_1696924709; 
Received: from localhost(mailfrom:xuanzhuo@linux.alibaba.com
 fp:SMTPD_---0Vtrvnrp_1696924709) by smtp.aliyun-inc.com;
 Tue, 10 Oct 2023 15:58:30 +0800
Message-ID: <1696924540.7843366-1-xuanzhuo@linux.alibaba.com>
Subject: Re: [PATCH vhost v3 3/4] virtio_pci: add check for common cfg size
Date: Tue, 10 Oct 2023 15:55:40 +0800
From: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
To: Jason Wang <jasowang@redhat.com>
References: <20231010031120.81272-1-xuanzhuo@linux.alibaba.com>
 <20231010031120.81272-4-xuanzhuo@linux.alibaba.com>
 <CACGkMEtChiwWV7KPLTJ=GqxT24YJh7oXoE2JbpwWMPJE9053qA@mail.gmail.com>
In-Reply-To: <CACGkMEtChiwWV7KPLTJ=GqxT24YJh7oXoE2JbpwWMPJE9053qA@mail.gmail.com>
Cc: virtualization@lists.linux-foundation.org,
 "Michael S. Tsirkin" <mst@redhat.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVHVlLCAxMCBPY3QgMjAyMyAxNDo0MTozOSArMDgwMCwgSmFzb24gV2FuZyA8amFzb3dhbmdA
cmVkaGF0LmNvbT4gd3JvdGU6Cj4gT24gVHVlLCBPY3QgMTAsIDIwMjMgYXQgMTE6MTHigK9BTSBY
dWFuIFpodW8gPHh1YW56aHVvQGxpbnV4LmFsaWJhYmEuY29tPiB3cm90ZToKPiA+Cj4gPiBTb21l
IGJ1Z2d5IGRldmljZXMsIHRoZSBjb21tb24gY2ZnIHNpemUgbWF5IG5vdCBtYXRjaCB0aGUgZmVh
dHVyZXMuCj4gPgo+ID4gVGhpcyBwYXRjaCBjaGVja3MgdGhlIGNvbW1vbiBjZmcgc2l6ZSBmb3Ig
dGhlCj4gPiBmZWF0dXJlcyhWSVJUSU9fRl9OT1RJRl9DT05GSUdfREFUQSwgVklSVElPX0ZfUklO
R19SRVNFVCkuIFdoZW4gdGhlCj4gPiBjb21tb24gY2ZnIHNpemUgZG9lcyBub3QgbWF0Y2ggdGhl
IGNvcnJlc3BvbmRpbmcgZmVhdHVyZSwgd2UgZmFpbCB0aGUKPiA+IHByb2JlIGFuZCBwcmludCBl
cnJvciBtZXNzYWdlLgo+ID4KPiA+IFNpZ25lZC1vZmYtYnk6IFh1YW4gWmh1byA8eHVhbnpodW9A
bGludXguYWxpYmFiYS5jb20+Cj4gPiAtLS0KPiA+ICBkcml2ZXJzL3ZpcnRpby92aXJ0aW9fcGNp
X21vZGVybi5jICAgICB8IDM2ICsrKysrKysrKysrKysrKysrKysrKysrKysrCj4gPiAgZHJpdmVy
cy92aXJ0aW8vdmlydGlvX3BjaV9tb2Rlcm5fZGV2LmMgfCAgMiArLQo+ID4gIGluY2x1ZGUvbGlu
dXgvdmlydGlvX3BjaV9tb2Rlcm4uaCAgICAgIHwgIDEgKwo+ID4gIDMgZmlsZXMgY2hhbmdlZCwg
MzggaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQo+ID4KPiA+IGRpZmYgLS1naXQgYS9kcml2
ZXJzL3ZpcnRpby92aXJ0aW9fcGNpX21vZGVybi5jIGIvZHJpdmVycy92aXJ0aW8vdmlydGlvX3Bj
aV9tb2Rlcm4uYwo+ID4gaW5kZXggZDZiYjY4YmE4NGU1Li42YThmNWZmMDU2MzYgMTAwNjQ0Cj4g
PiAtLS0gYS9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fcGNpX21vZGVybi5jCj4gPiArKysgYi9kcml2
ZXJzL3ZpcnRpby92aXJ0aW9fcGNpX21vZGVybi5jCj4gPiBAQCAtMzksNiArMzksMzkgQEAgc3Rh
dGljIHZvaWQgdnBfdHJhbnNwb3J0X2ZlYXR1cmVzKHN0cnVjdCB2aXJ0aW9fZGV2aWNlICp2ZGV2
LCB1NjQgZmVhdHVyZXMpCj4gPiAgICAgICAgICAgICAgICAgX192aXJ0aW9fc2V0X2JpdCh2ZGV2
LCBWSVJUSU9fRl9SSU5HX1JFU0VUKTsKPiA+ICB9Cj4gPgo+ID4gK3N0YXRpYyBpbnQgX192cF9j
aGVja19jb21tb25fc2l6ZV9vbmVfZmVhdHVyZShzdHJ1Y3QgdmlydGlvX2RldmljZSAqdmRldiwg
dTMyIGZiaXQsCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHUzMiBvZmZzZXQsIGNvbnN0IGNoYXIgKmZuYW1lKQo+ID4gK3sKPiA+ICsgICAgICAgc3RydWN0
IHZpcnRpb19wY2lfZGV2aWNlICp2cF9kZXYgPSB0b192cF9kZXZpY2UodmRldik7Cj4gPiArCj4g
PiArICAgICAgIGlmICghX192aXJ0aW9fdGVzdF9iaXQodmRldiwgZmJpdCkpCj4gPiArICAgICAg
ICAgICAgICAgcmV0dXJuIDA7Cj4gPiArCj4gPiArICAgICAgIGlmIChsaWtlbHkodnBfZGV2LT5t
ZGV2LmNvbW1vbl9sZW4gPj0gb2Zmc2V0KSkKPiA+ICsgICAgICAgICAgICAgICByZXR1cm4gMDsK
PiA+ICsKPiA+ICsgICAgICAgZGV2X2VycigmdmRldi0+ZGV2LAo+ID4gKyAgICAgICAgICAgICAg
ICJ2aXJ0aW86IGNvbW1vbiBjZmcgc2l6ZSglbGQpIGRvZXMgbm90IG1hdGNoIHRoZSBmZWF0dXJl
ICVzXG4iLAo+ID4gKyAgICAgICAgICAgICAgIHZwX2Rldi0+bWRldi5jb21tb25fbGVuLCBmbmFt
ZSk7Cj4gPiArCj4gPiArICAgICAgIHJldHVybiAtRUlOVkFMOwo+ID4gK30KPiA+ICsKPiA+ICsj
ZGVmaW5lIHZwX2NoZWNrX2NvbW1vbl9zaXplX29uZV9mZWF0dXJlKHZkZXYsIGZiaXQsIGZpZWxk
KSBcCj4gPiArICAgICAgIF9fdnBfY2hlY2tfY29tbW9uX3NpemVfb25lX2ZlYXR1cmUodmRldiwg
ZmJpdCwgXAo+ID4gKyAgICAgICAgICAgICAgIG9mZnNldG9mZW5kKHN0cnVjdCB2aXJ0aW9fcGNp
X21vZGVybl9jb21tb25fY2ZnLCBmaWVsZCksICNmYml0KQo+ID4gKwo+ID4gK3N0YXRpYyBpbnQg
dnBfY2hlY2tfY29tbW9uX3NpemUoc3RydWN0IHZpcnRpb19kZXZpY2UgKnZkZXYpCj4gPiArewo+
ID4gKyAgICAgICBpZiAodnBfY2hlY2tfY29tbW9uX3NpemVfb25lX2ZlYXR1cmUodmRldiwgVklS
VElPX0ZfTk9USUZfQ09ORklHX0RBVEEsIHF1ZXVlX25vdGlmeV9kYXRhKSkKPiA+ICsgICAgICAg
ICAgICAgICByZXR1cm4gLUVJTlZBTDsKPiA+ICsKPiA+ICsgICAgICAgaWYgKHZwX2NoZWNrX2Nv
bW1vbl9zaXplX29uZV9mZWF0dXJlKHZkZXYsIFZJUlRJT19GX1JJTkdfUkVTRVQsIHF1ZXVlX3Jl
c2V0KSkKPiA+ICsgICAgICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsKPgo+IERvIHdlIG5lZWQg
dG8gYXQgbGVhc3QgY2hlY2sgdGhlIG9mZnNldCBvZiB0aGUgcXVldWVfZGV2aWNlIGFzIHdlbGwg
aGVyZT8KCgpOb3QgbmVlZC4KCgovKgogKiB2cF9tb2Rlcm5fbWFwX2NhcGFiaWxpdHkgLSBtYXAg
YSBwYXJ0IG9mIHZpcnRpbyBwY2kgY2FwYWJpbGl0eQogKiBAbWRldjogdGhlIG1vZGVybiB2aXJ0
aW8tcGNpIGRldmljZQogKiBAb2ZmOiBvZmZzZXQgb2YgdGhlIGNhcGFiaWxpdHkKICogQG1pbmxl
bjogbWluaW1hbCBsZW5ndGggb2YgdGhlIGNhcGFiaWxpdHkKICogQGFsaWduOiBhbGlnbiByZXF1
aXJlbWVudAogKiBAc3RhcnQ6IHN0YXJ0IGZyb20gdGhlIGNhcGFiaWxpdHkKICogQHNpemU6IG1h
cCBzaXplCiAqIEBsZW46IHRoZSBsZW5ndGggdGhhdCBpcyBhY3R1YWxseSBtYXBwZWQKICogQHBh
OiBwaHlzaWNhbCBhZGRyZXNzIG9mIHRoZSBjYXBhYmlsaXR5CiAqCiAqIFJldHVybnMgdGhlIGlv
IGFkZHJlc3Mgb2YgZm9yIHRoZSBwYXJ0IG9mIHRoZSBjYXBhYmlsaXR5CiAqLwpzdGF0aWMgdm9p
ZCBfX2lvbWVtICoKdnBfbW9kZXJuX21hcF9jYXBhYmlsaXR5KHN0cnVjdCB2aXJ0aW9fcGNpX21v
ZGVybl9kZXZpY2UgKm1kZXYsIGludCBvZmYsCgkJCSBzaXplX3QgbWlubGVuLCB1MzIgYWxpZ24s
IHUzMiBzdGFydCwgdTMyIHNpemUsCgkJCSBzaXplX3QgKmxlbiwgcmVzb3VyY2Vfc2l6ZV90ICpw
YSkKCgoKY2FsbGVyOgoJbWRldi0+Y29tbW9uID0gdnBfbW9kZXJuX21hcF9jYXBhYmlsaXR5KG1k
ZXYsIGNvbW1vbiwKCQkJCSAgICAgIHNpemVvZihzdHJ1Y3QgdmlydGlvX3BjaV9jb21tb25fY2Zn
KSwgNCwKCQkJCSAgICAgIDAsIHNpemVvZihzdHJ1Y3QgdmlydGlvX3BjaV9tb2Rlcm5fY29tbW9u
X2NmZyksCgkJCQkgICAgICAmbWRldi0+Y29tbW9uX2xlbiwgTlVMTCk7CgoKV2UgcGFzcyB0aGUg
c2l6ZW9mKHN0cnVjdCB2aXJ0aW9fcGNpX2NvbW1vbl9jZmcpIGFzIHRoZSBtaW5sZW4uCgpTbyB3
ZSBkbyBub3QgbmVlZCB0byBjaGVjayB0aGUgY29tbW9uIGNmZyBzaXplIGlzIHNtYWxsZXIgdGhl
bgpzaXplb2Yoc3RydWN0IHZpcnRpb19wY2lfY29tbW9uX2NmZykuCgpUaGFua3MuCgo+Cj4gVGhh
bmtzCj4KPiA+ICsKPiA+ICsgICAgICAgcmV0dXJuIDA7Cj4gPiArfQo+ID4gKwo+ID4gIC8qIHZp
cnRpbyBjb25maWctPmZpbmFsaXplX2ZlYXR1cmVzKCkgaW1wbGVtZW50YXRpb24gKi8KPiA+ICBz
dGF0aWMgaW50IHZwX2ZpbmFsaXplX2ZlYXR1cmVzKHN0cnVjdCB2aXJ0aW9fZGV2aWNlICp2ZGV2
KQo+ID4gIHsKPiA+IEBAIC01Nyw2ICs5MCw5IEBAIHN0YXRpYyBpbnQgdnBfZmluYWxpemVfZmVh
dHVyZXMoc3RydWN0IHZpcnRpb19kZXZpY2UgKnZkZXYpCj4gPiAgICAgICAgICAgICAgICAgcmV0
dXJuIC1FSU5WQUw7Cj4gPiAgICAgICAgIH0KPiA+Cj4gPiArICAgICAgIGlmICh2cF9jaGVja19j
b21tb25fc2l6ZSh2ZGV2KSkKPiA+ICsgICAgICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsKPiA+
ICsKPiA+ICAgICAgICAgdnBfbW9kZXJuX3NldF9mZWF0dXJlcygmdnBfZGV2LT5tZGV2LCB2ZGV2
LT5mZWF0dXJlcyk7Cj4gPgo+ID4gICAgICAgICByZXR1cm4gMDsKPiA+IGRpZmYgLS1naXQgYS9k
cml2ZXJzL3ZpcnRpby92aXJ0aW9fcGNpX21vZGVybl9kZXYuYyBiL2RyaXZlcnMvdmlydGlvL3Zp
cnRpb19wY2lfbW9kZXJuX2Rldi5jCj4gPiBpbmRleCA5Y2I2MDFlMTY2ODguLjMzZjMxOWRhMTU1
OCAxMDA2NDQKPiA+IC0tLSBhL2RyaXZlcnMvdmlydGlvL3ZpcnRpb19wY2lfbW9kZXJuX2Rldi5j
Cj4gPiArKysgYi9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fcGNpX21vZGVybl9kZXYuYwo+ID4gQEAg
LTI5Miw3ICsyOTIsNyBAQCBpbnQgdnBfbW9kZXJuX3Byb2JlKHN0cnVjdCB2aXJ0aW9fcGNpX21v
ZGVybl9kZXZpY2UgKm1kZXYpCj4gPiAgICAgICAgIG1kZXYtPmNvbW1vbiA9IHZwX21vZGVybl9t
YXBfY2FwYWJpbGl0eShtZGV2LCBjb21tb24sCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHNpemVvZihzdHJ1Y3QgdmlydGlvX3BjaV9jb21tb25fY2ZnKSwgNCwKPiA+
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwgc2l6ZW9mKHN0cnVjdCB2
aXJ0aW9fcGNpX21vZGVybl9jb21tb25fY2ZnKSwKPiA+IC0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgTlVMTCwgTlVMTCk7Cj4gPiArICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZtZGV2LT5jb21tb25fbGVuLCBOVUxMKTsKPiA+ICAgICAgICAgaWYgKCFt
ZGV2LT5jb21tb24pCj4gPiAgICAgICAgICAgICAgICAgZ290byBlcnJfbWFwX2NvbW1vbjsKPiA+
ICAgICAgICAgbWRldi0+aXNyID0gdnBfbW9kZXJuX21hcF9jYXBhYmlsaXR5KG1kZXYsIGlzciwg
c2l6ZW9mKHU4KSwgMSwKPiA+IGRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L3ZpcnRpb19wY2lf
bW9kZXJuLmggYi9pbmNsdWRlL2xpbnV4L3ZpcnRpb19wY2lfbW9kZXJuLmgKPiA+IGluZGV4IDA2
N2FjMWQ3ODliYy4uZWRmNjJiYWUwNDc0IDEwMDY0NAo+ID4gLS0tIGEvaW5jbHVkZS9saW51eC92
aXJ0aW9fcGNpX21vZGVybi5oCj4gPiArKysgYi9pbmNsdWRlL2xpbnV4L3ZpcnRpb19wY2lfbW9k
ZXJuLmgKPiA+IEBAIC0yOCw2ICsyOCw3IEBAIHN0cnVjdCB2aXJ0aW9fcGNpX21vZGVybl9kZXZp
Y2Ugewo+ID4gICAgICAgICAvKiBTbyB3ZSBjYW4gc2FuaXR5LWNoZWNrIGFjY2Vzc2VzLiAqLwo+
ID4gICAgICAgICBzaXplX3Qgbm90aWZ5X2xlbjsKPiA+ICAgICAgICAgc2l6ZV90IGRldmljZV9s
ZW47Cj4gPiArICAgICAgIHNpemVfdCBjb21tb25fbGVuOwo+ID4KPiA+ICAgICAgICAgLyogQ2Fw
YWJpbGl0eSBmb3Igd2hlbiB3ZSBuZWVkIHRvIG1hcCBub3RpZmljYXRpb25zIHBlci12cS4gKi8K
PiA+ICAgICAgICAgaW50IG5vdGlmeV9tYXBfY2FwOwo+ID4gLS0KPiA+IDIuMzIuMC4zLmcwMTE5
NWNmOWYKPiA+Cj4KPiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwo+IFZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdAo+IFZpcnR1YWxpemF0aW9uQGxpc3Rz
LmxpbnV4LWZvdW5kYXRpb24ub3JnCj4gaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3Jn
L21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24KX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1
YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhm
b3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
