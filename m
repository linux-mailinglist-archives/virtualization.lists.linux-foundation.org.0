Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 2C1C32C3C56
	for <lists.virtualization@lfdr.de>; Wed, 25 Nov 2020 10:42:13 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id CC8F686A59;
	Wed, 25 Nov 2020 09:42:11 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id oMDKgmMjbrJ7; Wed, 25 Nov 2020 09:42:02 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 0439886A0F;
	Wed, 25 Nov 2020 09:42:00 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id C453CC0052;
	Wed, 25 Nov 2020 09:41:59 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 57ACDC163C
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:41:55 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 5144486D65
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:41:55 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id LgmZ2ptv50Fl
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:41:53 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id 8903286D2C
 for <virtualization@lists.linux-foundation.org>;
 Wed, 25 Nov 2020 09:41:53 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 E6BA8305D3CA; Wed, 25 Nov 2020 11:35:52 +0200 (EET)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id C4A833072784;
 Wed, 25 Nov 2020 11:35:52 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v10 62/81] KVM: introspection: restore the state of CR3
 interception on unhook
Date: Wed, 25 Nov 2020 11:35:41 +0200
Message-Id: <20201125093600.2766-63-alazar@bitdefender.com>
In-Reply-To: <20201125093600.2766-1-alazar@bitdefender.com>
References: <20201125093600.2766-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <nicu.citu@icloud.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTmljdciZb3IgQ8OuyJt1IDxuaWN1LmNpdHVAaWNsb3VkLmNvbT4KClRoaXMgY29tbWl0
IGFsc28gZW5zdXJlcyB0aGF0IHRoZSBpbnRyb3NwZWN0aW9uIHRvb2wgYW5kIHRoZSB1c2Vyc3Bh
Y2UKZG8gbm90IGRpc2FibGUgZWFjaCBvdGhlciB0aGUgQ1IzLXdyaXRlIFZNLWV4aXQuCgpTaWdu
ZWQtb2ZmLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5pY3UuY2l0dUBpY2xvdWQuY29tPgpTaWduZWQt
b2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogYXJj
aC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmggfCAgNCArKwogYXJjaC94ODYva3ZtL2t2bWku
YyAgICAgICAgICAgICAgfCA2NyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLQogYXJj
aC94ODYva3ZtL2t2bWkuaCAgICAgICAgICAgICAgfCAgNCArLQogYXJjaC94ODYva3ZtL2t2bWlf
bXNnLmMgICAgICAgICAgfCAgNCArLQogYXJjaC94ODYva3ZtL3N2bS9zdm0uYyAgICAgICAgICAg
fCAgNSArKysKIGFyY2gveDg2L2t2bS92bXgvdm14LmMgICAgICAgICAgIHwgIDUgKysrCiA2IGZp
bGVzIGNoYW5nZWQsIDgxIGluc2VydGlvbnMoKyksIDggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmggYi9hcmNoL3g4Ni9pbmNsdWRlL2Fz
bS9rdm1pX2hvc3QuaAppbmRleCA3NjEzMDg4ZDBhZTIuLmVkYmVkZjAzMTQ2NyAxMDA2NDQKLS0t
IGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmgKKysrIGIvYXJjaC94ODYvaW5jbHVk
ZS9hc20va3ZtaV9ob3N0LmgKQEAgLTE2LDYgKzE2LDcgQEAgc3RydWN0IGt2bWlfaW50ZXJjZXB0
aW9uIHsKIAlib29sIGNsZWFudXA7CiAJYm9vbCByZXN0b3JlX2ludGVyY2VwdGlvbjsKIAlzdHJ1
Y3Qga3ZtaV9tb25pdG9yX2ludGVyY2VwdGlvbiBicmVha3BvaW50OworCXN0cnVjdCBrdm1pX21v
bml0b3JfaW50ZXJjZXB0aW9uIGNyM3c7CiB9OwogCiBzdHJ1Y3Qga3ZtX3ZjcHVfYXJjaF9pbnRy
b3NwZWN0aW9uIHsKQEAgLTM0LDYgKzM1LDcgQEAgYm9vbCBrdm1pX21vbml0b3JfYnBfaW50ZXJj
ZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTMyIGRiZyk7CiBib29sIGt2bWlfY3JfZXZlbnQo
c3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1bnNpZ25lZCBpbnQgY3IsCiAJCSAgIHVuc2lnbmVkIGxv
bmcgb2xkX3ZhbHVlLCB1bnNpZ25lZCBsb25nICpuZXdfdmFsdWUpOwogYm9vbCBrdm1pX2NyM19p
bnRlcmNlcHRlZChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpOworYm9vbCBrdm1pX21vbml0b3JfY3Iz
d19pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29sIGVuYWJsZSk7CiAKICNlbHNl
IC8qIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLwogCkBAIC00NCw2ICs0Niw4IEBAIHN0YXRp
YyBpbmxpbmUgYm9vbCBrdm1pX2NyX2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdW5zaWdu
ZWQgaW50IGNyLAogCQkJCSB1bnNpZ25lZCBsb25nICpuZXdfdmFsdWUpCiAJCQl7IHJldHVybiB0
cnVlOyB9CiBzdGF0aWMgaW5saW5lIGJvb2wga3ZtaV9jcjNfaW50ZXJjZXB0ZWQoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1KSB7IHJldHVybiBmYWxzZTsgfQorc3RhdGljIGlubGluZSBib29sIGt2bWlf
bW9uaXRvcl9jcjN3X2ludGVyY2VwdChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCisJCQkJCQlib29s
IGVuYWJsZSkgeyByZXR1cm4gZmFsc2U7IH0KIAogI2VuZGlmIC8qIENPTkZJR19LVk1fSU5UUk9T
UEVDVElPTiAqLwogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaS5jIGIvYXJjaC94ODYv
a3ZtL2t2bWkuYwppbmRleCAyYmI2YjRiYjkzMmIuLjhhZDM2OThlNTk4OCAxMDA2NDQKLS0tIGEv
YXJjaC94ODYva3ZtL2t2bWkuYworKysgYi9hcmNoL3g4Ni9rdm0va3ZtaS5jCkBAIC0yMzAsNiAr
MjMwLDU5IEBAIHN0YXRpYyB2b2lkIGt2bWlfYXJjaF9kaXNhYmxlX2JwX2ludGVyY2VwdChzdHJ1
Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJdmNwdS0+YXJjaC5rdm1pLT5icmVha3BvaW50Lmt2bV9pbnRl
cmNlcHRlZCA9IGZhbHNlOwogfQogCitzdGF0aWMgYm9vbCBtb25pdG9yX2NyM3dfZmN0X2t2bWko
c3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29sIGVuYWJsZSkKK3sKKwl2Y3B1LT5hcmNoLmt2bWkt
PmNyM3cua3ZtaV9pbnRlcmNlcHRlZCA9IGVuYWJsZTsKKworCWlmIChlbmFibGUpCisJCXZjcHUt
PmFyY2gua3ZtaS0+Y3Izdy5rdm1faW50ZXJjZXB0ZWQgPQorCQkJa3ZtX3g4Nl9vcHMuY3IzX3dy
aXRlX2ludGVyY2VwdGVkKHZjcHUpOworCWVsc2UgaWYgKHZjcHUtPmFyY2gua3ZtaS0+Y3Izdy5r
dm1faW50ZXJjZXB0ZWQpCisJCXJldHVybiB0cnVlOworCisJcmV0dXJuIGZhbHNlOworfQorCitz
dGF0aWMgYm9vbCBtb25pdG9yX2NyM3dfZmN0X2t2bShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGJv
b2wgZW5hYmxlKQoreworCWlmICghdmNwdS0+YXJjaC5rdm1pLT5jcjN3Lmt2bWlfaW50ZXJjZXB0
ZWQpCisJCXJldHVybiBmYWxzZTsKKworCXZjcHUtPmFyY2gua3ZtaS0+Y3Izdy5rdm1faW50ZXJj
ZXB0ZWQgPSBlbmFibGU7CisKKwlpZiAoIWVuYWJsZSkKKwkJcmV0dXJuIHRydWU7CisKKwlyZXR1
cm4gZmFsc2U7Cit9CisKKy8qCisgKiBSZXR1cm5zIHRydWUgaWYgb25lIHNpZGUgKGt2bSBvciBr
dm1pKSB0cmllcyB0byBkaXNhYmxlIHRoZSBDUjMgd3JpdGUKKyAqIGludGVyY2VwdGlvbiB3aGls
ZSB0aGUgb3RoZXIgc2lkZSBpcyBzdGlsbCB0cmFja2luZyBpdC4KKyAqLworYm9vbCBrdm1pX21v
bml0b3JfY3Izd19pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29sIGVuYWJsZSkK
K3sKKwlzdHJ1Y3Qga3ZtaV9pbnRlcmNlcHRpb24gKmFyY2hfdmNwdWkgPSBSRUFEX09OQ0UodmNw
dS0+YXJjaC5rdm1pKTsKKworCXJldHVybiAoYXJjaF92Y3B1aSAmJiBhcmNoX3ZjcHVpLT5jcjN3
Lm1vbml0b3JfZmN0KHZjcHUsIGVuYWJsZSkpOworfQorRVhQT1JUX1NZTUJPTChrdm1pX21vbml0
b3JfY3Izd19pbnRlcmNlcHQpOworCitzdGF0aWMgdm9pZCBrdm1pX2NvbnRyb2xfY3Izd19pbnRl
cmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBib29sIGVuYWJsZSkKK3sKKwl2Y3B1LT5hcmNo
Lmt2bWktPmNyM3cubW9uaXRvcl9mY3QgPSBtb25pdG9yX2NyM3dfZmN0X2t2bWk7CisJa3ZtX3g4
Nl9vcHMuY29udHJvbF9jcjNfaW50ZXJjZXB0KHZjcHUsIENSX1RZUEVfVywgZW5hYmxlKTsKKwl2
Y3B1LT5hcmNoLmt2bWktPmNyM3cubW9uaXRvcl9mY3QgPSBtb25pdG9yX2NyM3dfZmN0X2t2bTsK
K30KKworc3RhdGljIHZvaWQga3ZtaV9hcmNoX2Rpc2FibGVfY3Izd19pbnRlcmNlcHQoc3RydWN0
IGt2bV92Y3B1ICp2Y3B1KQoreworCWt2bWlfY29udHJvbF9jcjN3X2ludGVyY2VwdCh2Y3B1LCBm
YWxzZSk7CisKKwl2Y3B1LT5hcmNoLmt2bWktPmNyM3cua3ZtaV9pbnRlcmNlcHRlZCA9IGZhbHNl
OworCXZjcHUtPmFyY2gua3ZtaS0+Y3Izdy5rdm1faW50ZXJjZXB0ZWQgPSBmYWxzZTsKK30KKwog
aW50IGt2bWlfYXJjaF9jbWRfY29udHJvbF9pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1
LAogCQkJCSAgICB1bnNpZ25lZCBpbnQgZXZlbnRfaWQsIGJvb2wgZW5hYmxlKQogewpAQCAtMjY5
LDYgKzMyMiw3IEBAIHZvaWQga3ZtaV9hcmNoX2JyZWFrcG9pbnRfZXZlbnQoc3RydWN0IGt2bV92
Y3B1ICp2Y3B1LCB1NjQgZ3ZhLCB1OCBpbnNuX2xlbikKIHN0YXRpYyB2b2lkIGt2bWlfYXJjaF9y
ZXN0b3JlX2ludGVyY2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiB7CiAJa3ZtaV9hcmNo
X2Rpc2FibGVfYnBfaW50ZXJjZXB0KHZjcHUpOworCWt2bWlfYXJjaF9kaXNhYmxlX2NyM3dfaW50
ZXJjZXB0KHZjcHUpOwogfQogCiBib29sIGt2bWlfYXJjaF9jbGVhbl91cF9pbnRlcmNlcHRpb24o
c3RydWN0IGt2bV92Y3B1ICp2Y3B1KQpAQCAtMjkzLDggKzM0NywxMyBAQCBib29sIGt2bWlfYXJj
aF92Y3B1X2FsbG9jX2ludGVyY2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJCXJldHVy
biBmYWxzZTsKIAogCWFyY2hfdmNwdWktPmJyZWFrcG9pbnQubW9uaXRvcl9mY3QgPSBtb25pdG9y
X2JwX2ZjdF9rdm07CisJYXJjaF92Y3B1aS0+Y3Izdy5tb25pdG9yX2ZjdCA9IG1vbml0b3JfY3Iz
d19mY3Rfa3ZtOwogCi0JLyogcGFpciB3aXRoIGt2bWlfbW9uaXRvcl9icF9pbnRlcmNlcHQoKSAq
LworCS8qCisJICogcGFpcmVkIHdpdGg6CisJICogIC0ga3ZtaV9tb25pdG9yX2JwX2ludGVyY2Vw
dCgpCisJICogIC0ga3ZtaV9tb25pdG9yX2NyM3dfaW50ZXJjZXB0KCkKKwkgKi8KIAlzbXBfd21i
KCk7CiAJV1JJVEVfT05DRSh2Y3B1LT5hcmNoLmt2bWksIGFyY2hfdmNwdWkpOwogCkBAIC0zMjYs
NyArMzg1LDcgQEAgdm9pZCBrdm1pX2FyY2hfcmVxdWVzdF9pbnRlcmNlcHRpb25fY2xlYW51cChz
dHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCiBpbnQga3ZtaV9hcmNoX2NtZF92Y3B1X2NvbnRyb2xfY3Io
c3RydWN0IGt2bV92Y3B1ICp2Y3B1LCBpbnQgY3IsIGJvb2wgZW5hYmxlKQogewogCWlmIChjciA9
PSAzKQotCQlrdm1feDg2X29wcy5jb250cm9sX2NyM19pbnRlcmNlcHQodmNwdSwgQ1JfVFlQRV9X
LCBlbmFibGUpOworCQlrdm1pX2NvbnRyb2xfY3Izd19pbnRlcmNlcHQodmNwdSwgZW5hYmxlKTsK
IAogCWlmIChlbmFibGUpCiAJCXNldF9iaXQoY3IsIFZDUFVJKHZjcHUpLT5hcmNoLmNyX21hc2sp
OwpAQCAtMzQ2LDggKzQwNSw4IEBAIHN0YXRpYyBib29sIF9fa3ZtaV9jcl9ldmVudChzdHJ1Y3Qg
a3ZtX3ZjcHUgKnZjcHUsIHVuc2lnbmVkIGludCBjciwKIAlpZiAoIXRlc3RfYml0KGNyLCBWQ1BV
SSh2Y3B1KS0+YXJjaC5jcl9tYXNrKSkKIAkJcmV0dXJuIHRydWU7CiAKLQlhY3Rpb24gPSBrdm1p
X21zZ19zZW5kX2NyKHZjcHUsIGNyLCBvbGRfdmFsdWUsICpuZXdfdmFsdWUsCi0JCQkJICAmcmVw
bHlfdmFsdWUpOworCWFjdGlvbiA9IGt2bWlfbXNnX3NlbmRfdmNwdV9jcih2Y3B1LCBjciwgb2xk
X3ZhbHVlLCAqbmV3X3ZhbHVlLAorCQkJCSAgICAgICAmcmVwbHlfdmFsdWUpOwogCXN3aXRjaCAo
YWN0aW9uKSB7CiAJY2FzZSBLVk1JX0VWRU5UX0FDVElPTl9DT05USU5VRToKIAkJKm5ld192YWx1
ZSA9IHJlcGx5X3ZhbHVlOwpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL2t2bWkuaCBiL2FyY2gv
eDg2L2t2bS9rdm1pLmgKaW5kZXggNmY0YWFlYmI2N2Y5Li42YTQ0NDQyOGI4MzEgMTAwNjQ0Ci0t
LSBhL2FyY2gveDg2L2t2bS9rdm1pLmgKKysrIGIvYXJjaC94ODYva3ZtL2t2bWkuaApAQCAtOSw3
ICs5LDcgQEAgdm9pZCBrdm1pX2FyY2hfY21kX3ZjcHVfc2V0X3JlZ2lzdGVycyhzdHJ1Y3Qga3Zt
X3ZjcHUgKnZjcHUsCiAJCQkJICAgICAgY29uc3Qgc3RydWN0IGt2bV9yZWdzICpyZWdzKTsKIGlu
dCBrdm1pX2FyY2hfY21kX3ZjcHVfY29udHJvbF9jcihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGlu
dCBjciwgYm9vbCBlbmFibGUpOwogCi11MzIga3ZtaV9tc2dfc2VuZF9jcihzdHJ1Y3Qga3ZtX3Zj
cHUgKnZjcHUsIHUzMiBjciwgdTY0IG9sZF92YWx1ZSwKLQkJICAgICB1NjQgbmV3X3ZhbHVlLCB1
NjQgKnJldF92YWx1ZSk7Cit1MzIga3ZtaV9tc2dfc2VuZF92Y3B1X2NyKHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwgdTMyIGNyLCB1NjQgb2xkX3ZhbHVlLAorCQkJICB1NjQgbmV3X3ZhbHVlLCB1NjQg
KnJldF92YWx1ZSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL2t2bWlfbXNn
LmMgYi9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYwppbmRleCAxNjgyYmIyNzEwNWYuLjM0YWVkYjQ3
ODVlNCAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMKKysrIGIvYXJjaC94ODYv
a3ZtL2t2bWlfbXNnLmMKQEAgLTE2Myw4ICsxNjMsOCBAQCBrdm1pX3ZjcHVfbXNnX2pvYl9mY3Qg
a3ZtaV9hcmNoX3ZjcHVfbXNnX2hhbmRsZXIodTE2IGlkKQogCXJldHVybiBpZCA8IEFSUkFZX1NJ
WkUobXNnX3ZjcHUpID8gbXNnX3ZjcHVbaWRdIDogTlVMTDsKIH0KIAotdTMyIGt2bWlfbXNnX3Nl
bmRfY3Ioc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB1MzIgY3IsIHU2NCBvbGRfdmFsdWUsCi0JCSAg
ICAgdTY0IG5ld192YWx1ZSwgdTY0ICpyZXRfdmFsdWUpCit1MzIga3ZtaV9tc2dfc2VuZF92Y3B1
X2NyKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTMyIGNyLCB1NjQgb2xkX3ZhbHVlLAorCQkJICB1
NjQgbmV3X3ZhbHVlLCB1NjQgKnJldF92YWx1ZSkKIHsKIAlzdHJ1Y3Qga3ZtaV92Y3B1X2V2ZW50
X2NyIGU7CiAJc3RydWN0IGt2bWlfdmNwdV9ldmVudF9jcl9yZXBseSByOwpkaWZmIC0tZ2l0IGEv
YXJjaC94ODYva3ZtL3N2bS9zdm0uYyBiL2FyY2gveDg2L2t2bS9zdm0vc3ZtLmMKaW5kZXggYmFj
YTQ1NTIxMmY5Li5mM2VjNzllNmMzOWEgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2t2bS9zdm0vc3Zt
LmMKKysrIGIvYXJjaC94ODYva3ZtL3N2bS9zdm0uYwpAQCAtMTc4Nyw2ICsxNzg3LDExIEBAIHN0
YXRpYyB2b2lkIHN2bV9jb250cm9sX2NyM19pbnRlcmNlcHQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1
LCBpbnQgdHlwZSwKIHsKIAlzdHJ1Y3QgdmNwdV9zdm0gKnN2bSA9IHRvX3N2bSh2Y3B1KTsKIAor
I2lmZGVmIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTgorCWlmICgodHlwZSAmIENSX1RZUEVfVykg
JiYga3ZtaV9tb25pdG9yX2NyM3dfaW50ZXJjZXB0KHZjcHUsIGVuYWJsZSkpCisJCXR5cGUgJj0g
fkNSX1RZUEVfVzsKKyNlbmRpZiAvKiBDT05GSUdfS1ZNX0lOVFJPU1BFQ1RJT04gKi8KKwogCWlm
ICh0eXBlICYgQ1JfVFlQRV9SKQogCQllbmFibGUgPyBzdm1fc2V0X2ludGVyY2VwdChzdm0sIElO
VEVSQ0VQVF9DUjNfUkVBRCkgOgogCQkJIHN2bV9jbHJfaW50ZXJjZXB0KHN2bSwgSU5URVJDRVBU
X0NSM19SRUFEKTsKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2t2bS92bXgvdm14LmMgYi9hcmNoL3g4
Ni9rdm0vdm14L3ZteC5jCmluZGV4IDcyM2U3ODUyOTE0Ni4uODM3NDQ3NTQxNzEwIDEwMDY0NAot
LS0gYS9hcmNoL3g4Ni9rdm0vdm14L3ZteC5jCisrKyBiL2FyY2gveDg2L2t2bS92bXgvdm14LmMK
QEAgLTI5ODUsNiArMjk4NSwxMSBAQCBzdGF0aWMgdm9pZCB2bXhfY29udHJvbF9jcjNfaW50ZXJj
ZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgaW50IHR5cGUsCiAJc3RydWN0IHZjcHVfdm14ICp2
bXggPSB0b192bXgodmNwdSk7CiAJdTMyIGNyM19leGVjX2NvbnRyb2wgPSAwOwogCisjaWZkZWYg
Q09ORklHX0tWTV9JTlRST1NQRUNUSU9OCisJaWYgKCh0eXBlICYgQ1JfVFlQRV9XKSAmJiBrdm1p
X21vbml0b3JfY3Izd19pbnRlcmNlcHQodmNwdSwgZW5hYmxlKSkKKwkJdHlwZSAmPSB+Q1JfVFlQ
RV9XOworI2VuZGlmIC8qIENPTkZJR19LVk1fSU5UUk9TUEVDVElPTiAqLworCiAJaWYgKHR5cGUg
JiBDUl9UWVBFX1IpCiAJCWNyM19leGVjX2NvbnRyb2wgfD0gQ1BVX0JBU0VEX0NSM19TVE9SRV9F
WElUSU5HOwogCWlmICh0eXBlICYgQ1JfVFlQRV9XKQpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVh
bGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZv
dW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
