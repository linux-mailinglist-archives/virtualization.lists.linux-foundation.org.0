Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
	by mail.lfdr.de (Postfix) with ESMTPS id C45AA6AD792
	for <lists.virtualization@lfdr.de>; Tue,  7 Mar 2023 07:44:11 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id A8DC4416D8;
	Tue,  7 Mar 2023 06:44:09 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org A8DC4416D8
Authentication-Results: smtp4.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=ZR8jpiw/
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id V4Ajx8p_WMIj; Tue,  7 Mar 2023 06:44:08 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp4.osuosl.org (Postfix) with ESMTPS id 91EC0416D6;
	Tue,  7 Mar 2023 06:44:06 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org 91EC0416D6
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id DA8F3C0089;
	Tue,  7 Mar 2023 06:44:05 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id CFC7BC0032
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 06:44:04 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp3.osuosl.org (Postfix) with ESMTP id AB24460591
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 06:44:04 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org AB24460591
Authentication-Results: smtp3.osuosl.org;
 dkim=pass (1024-bit key) header.d=redhat.com header.i=@redhat.com
 header.a=rsa-sha256 header.s=mimecast20190719 header.b=ZR8jpiw/
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
 by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id iWnmRMUN3rev
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 06:44:03 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org A633261029
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.133.124])
 by smtp3.osuosl.org (Postfix) with ESMTPS id A633261029
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 06:44:03 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1678171442;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=OCwpnMRR4ybYuLwfoQRIuiWbb3Nf15lBeUjCZHSTuD8=;
 b=ZR8jpiw/eAW4JS8MYsRayEliF6C/13zOL+mb7lUpPG/PwLe9DCACsuLwy/5oKJy2o/VVfL
 31A44Cy8T6cs5Rp9MLH32QbGf+fZl8oRBVKyqW6uaQxguA20UYD123LDNOPp+sDc7Hunv1
 IZmB6c0Eyqz9LZiEJK+Q+Kmv34LO/fo=
Received: from mail-oa1-f71.google.com (mail-oa1-f71.google.com
 [209.85.160.71]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-654-2Un43OvuPqi-TJcLrtvHlw-1; Tue, 07 Mar 2023 01:44:01 -0500
X-MC-Unique: 2Un43OvuPqi-TJcLrtvHlw-1
Received: by mail-oa1-f71.google.com with SMTP id
 586e51a60fabf-1762b9bb80bso7789921fac.19
 for <virtualization@lists.linux-foundation.org>;
 Mon, 06 Mar 2023 22:44:01 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112; t=1678171440;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=OCwpnMRR4ybYuLwfoQRIuiWbb3Nf15lBeUjCZHSTuD8=;
 b=VPd49H8DKVShoIYL9Sn4wSlcb9LIpGY29grubET3RYCAX/6MZrELa7bIR6c4zPOCEh
 HHteHfoLlHAXdJ1MDv3FJls0nktZaNi6aoYLmRXVhyovDwVxAa0sHavQ/7cXha+ohNef
 zydKW+UgUwFaD2p+rjcLixbsN0y3Fc/WcZngZPc2mN0rCAJzT6DNBLdgOKcF+P8WXu1A
 4K9wmbWsVYO70hgH8fWsj+EdwYkKwn1gJMwRJwoMf1iJ+osCPGcPsoSUm0EBgBlkSr3a
 S3G8CpO+BwOutVT1b2A+y2Jug1OdUzMCD5AuhNKVgqkNxlpbc75Utt+MUdhRP1rac47e
 nfJw==
X-Gm-Message-State: AO0yUKWsw3YrcCoo0UJZSIWy12pxABhopkf/wTNUFwvWgTgKQbVAWhAK
 XDusbnC3GVWEG/S/5rqpRUruMF1XtUsJ/kN5nDZaBa6Y0t25ZI20xI53/02VxOme7qPu4lugQ93
 tkXWxy+Ot3EaQp28fhUOR5ZtMstrXTi3evqTP/kBtoLTzuVbMWBUnqysc4A==
X-Received: by 2002:a54:4612:0:b0:383:fad3:d19 with SMTP id
 p18-20020a544612000000b00383fad30d19mr4325872oip.9.1678171440555; 
 Mon, 06 Mar 2023 22:44:00 -0800 (PST)
X-Google-Smtp-Source: AK7set/8J+kab2+c8aBqr16jLSkj5hP103A6mO30rF05tITdNhsjRE/MqPdDDOawniZaJaEzKgX3hGw18ZBY4cXFiYM=
X-Received: by 2002:a54:4612:0:b0:383:fad3:d19 with SMTP id
 p18-20020a544612000000b00383fad30d19mr4325871oip.9.1678171440354; Mon, 06 Mar
 2023 22:44:00 -0800 (PST)
MIME-Version: 1.0
References: <20230302115908.1461-1-xuanzhuo@linux.alibaba.com>
 <20230302115908.1461-6-xuanzhuo@linux.alibaba.com>
In-Reply-To: <20230302115908.1461-6-xuanzhuo@linux.alibaba.com>
From: Jason Wang <jasowang@redhat.com>
Date: Tue, 7 Mar 2023 14:43:49 +0800
Message-ID: <CACGkMEuKotR=PXY_KvinLyZ0rK2eiL17u3TSP3XyR3G7kBBGqA@mail.gmail.com>
Subject: Re: [PATCH vhost v1 05/12] virtio_ring: packed: refactor
 virtqueue_add_packed() for premapped
To: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: "Michael S. Tsirkin" <mst@redhat.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVGh1LCBNYXIgMiwgMjAyMyBhdCA3OjU54oCvUE0gWHVhbiBaaHVvIDx4dWFuemh1b0BsaW51
eC5hbGliYWJhLmNvbT4gd3JvdGU6Cj4KPiBUaGlzIGNvbW1pdCBzcGxpdHMgdmlydHF1ZXVlX2Fk
ZF9wYWNrZWQoKSB0byB0d28gZnVuY3Rpb25zLiBUaGUgcHVycG9zZQo+IG9mIHN1Y2ggc3BsaXR0
aW5nIGlzIHRvIHNlcGFyYXRlIERNQSBvcGVyYXRpb25zLgo+Cj4gVGhlIGZpcnN0IGZ1bmN0aW9u
IGluY2x1ZGVzIGFsbCBjb2RlcyB0aGF0IG1heSBmYWlsIGJlZm9yZSB0aGUgRE1BCj4gb3BlcmF0
aW9uLiBUaGUgc3Vic2VxdWVudCBwYXJ0IGlzIHVzZWQgYXMgdGhlIHNlY29uZCBmdW5jdGlvbi4K
Pgo+IEluIHRoaXMgd2F5LCB3ZSBjYW4gcGVyZm9ybSBETUEgb3BlcmF0aW9ucyBpbiB0aGUgbWlk
ZGxlIG9mIHRoZSB0d28KPiBmdW5jdGlvbnMuIElmIHRoZSBmaXJzdCBmdW5jdGlvbiBmYWlscywg
d2UgZG8gbm90IG5lZWQgdG8gcGVyZm9ybSBETUEKPiBvcGVyYXRpb25zLiBJZiBpdCBpcyBwcmVt
YXBwZWQsIHdlIGNhbiBwYXNzIHRoZSBETUEgb3BlcmF0aW9uLgo+Cj4gU2lnbmVkLW9mZi1ieTog
WHVhbiBaaHVvIDx4dWFuemh1b0BsaW51eC5hbGliYWJhLmNvbT4KPiAtLS0KPiAgZHJpdmVycy92
aXJ0aW8vdmlydGlvX3JpbmcuYyB8IDEyMCArKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0t
LS0tLQo+ICAxIGZpbGUgY2hhbmdlZCwgODEgaW5zZXJ0aW9ucygrKSwgMzkgZGVsZXRpb25zKC0p
Cj4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy92aXJ0aW8vdmlydGlvX3JpbmcuYyBiL2RyaXZlcnMv
dmlydGlvL3ZpcnRpb19yaW5nLmMKPiBpbmRleCAxNzhlZGYxMTcxZTIuLjY3OTZjYmVlMDIwNyAx
MDA2NDQKPiAtLS0gYS9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fcmluZy5jCj4gKysrIGIvZHJpdmVy
cy92aXJ0aW8vdmlydGlvX3JpbmcuYwo+IEBAIC0xMzQ3LDcgKzEzNDcsNiBAQCBzdGF0aWMgaW50
IHZpcnRxdWV1ZV9hZGRfaW5kaXJlY3RfcGFja2VkKHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZx
LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50
IHRvdGFsX3NnLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5z
aWduZWQgaW50IG91dF9zZ3MsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1bnNpZ25lZCBpbnQgaW5fc2dzLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdm9pZCAqZGF0YSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0cnVjdCB2cmluZ19wYWNrZWRfZGVzYyAqZGVzYykKPiAgewo+ICAgICAgICAg
c3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKPiBAQCAtMTQyMiwxNCArMTQyMSwxMiBAQCBzdGF0aWMg
aW50IHZpcnRxdWV1ZV9hZGRfaW5kaXJlY3RfcGFja2VkKHN0cnVjdCB2cmluZ192aXJ0cXVldWUg
KnZxLAo+Cj4gICAgICAgICAvKiBTdG9yZSB0b2tlbiBhbmQgaW5kaXJlY3QgYnVmZmVyIHN0YXRl
LiAqLwo+ICAgICAgICAgdnEtPnBhY2tlZC5kZXNjX3N0YXRlW2lkXS5udW0gPSAxOwo+IC0gICAg
ICAgdnEtPnBhY2tlZC5kZXNjX3N0YXRlW2lkXS5kYXRhID0gZGF0YTsKPiAgICAgICAgIHZxLT5w
YWNrZWQuZGVzY19zdGF0ZVtpZF0uaW5kaXJfZGVzYyA9IGRlc2M7Cj4gICAgICAgICB2cS0+cGFj
a2VkLmRlc2Nfc3RhdGVbaWRdLmxhc3QgPSBpZDsKPgo+ICAgICAgICAgdnEtPm51bV9hZGRlZCAr
PSAxOwo+Cj4gICAgICAgICBwcl9kZWJ1ZygiQWRkZWQgYnVmZmVyIGhlYWQgJWkgdG8gJXBcbiIs
IGhlYWQsIHZxKTsKPiAtICAgICAgIEVORF9VU0UodnEpOwo+Cj4gICAgICAgICByZXR1cm4gMDsK
Pgo+IEBAIC0xNDQxLDc0ICsxNDM4LDc2IEBAIHN0YXRpYyBpbnQgdmlydHF1ZXVlX2FkZF9pbmRp
cmVjdF9wYWNrZWQoc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAqdnEsCj4KPiAgICAgICAgIGtmcmVl
KGRlc2MpOwo+Cj4gLSAgICAgICBFTkRfVVNFKHZxKTsKPiAgICAgICAgIHJldHVybiAtRU5PTUVN
Owo+ICB9Cj4KPiAtc3RhdGljIGlubGluZSBpbnQgdmlydHF1ZXVlX2FkZF9wYWNrZWQoc3RydWN0
IHZpcnRxdWV1ZSAqX3ZxLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCBzY2F0dGVybGlzdCAqc2dzW10sCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdW5zaWduZWQgaW50IHRvdGFsX3NnLAo+IC0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBvdXRfc2dzLAo+IC0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBpbl9zZ3MsCj4gLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGF0YSwKPiAtICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpjdHgsCj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZ2ZwX3QgZ2ZwKQo+ICtzdGF0aWMgaW5saW5lIHN0cnVjdCB2
cmluZ19wYWNrZWRfZGVzYyAqdmlydHF1ZXVlX2dldF9kZXNjX3BhY2tlZChzdHJ1Y3QgdnJpbmdf
dmlydHF1ZXVlICp2cSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgdG90YWxfc2csCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdm9pZCAqZGF0YSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpjdHgsCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2ZwX3QgZ2Zw
KQo+ICB7Cj4gLSAgICAgICBzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVlICp2cSA9IHRvX3Z2cShfdnEp
Owo+ICAgICAgICAgc3RydWN0IHZyaW5nX3BhY2tlZF9kZXNjICpkZXNjOwo+IC0gICAgICAgc3Ry
dWN0IHNjYXR0ZXJsaXN0ICpzZzsKPiAtICAgICAgIHVuc2lnbmVkIGludCBpLCBuLCBjLCBkZXNj
c191c2VkLCBlcnJfaWR4Owo+IC0gICAgICAgX19sZTE2IGhlYWRfZmxhZ3MsIGZsYWdzOwo+IC0g
ICAgICAgdTE2IGhlYWQsIGlkLCBwcmV2LCBjdXJyLCBhdmFpbF91c2VkX2ZsYWdzOwo+IC0gICAg
ICAgaW50IGVycjsKPiAtCj4gLSAgICAgICBTVEFSVF9VU0UodnEpOwo+ICsgICAgICAgdW5zaWdu
ZWQgaW50IGRlc2NzX3VzZWQ7Cj4KPiAgICAgICAgIEJVR19PTihkYXRhID09IE5VTEwpOwo+ICAg
ICAgICAgQlVHX09OKGN0eCAmJiB2cS0+aW5kaXJlY3QpOwo+Cj4gLSAgICAgICBpZiAodW5saWtl
bHkodnEtPmJyb2tlbikpIHsKPiAtICAgICAgICAgICAgICAgRU5EX1VTRSh2cSk7Cj4gLSAgICAg
ICAgICAgICAgIHJldHVybiAtRUlPOwo+IC0gICAgICAgfQo+ICsgICAgICAgaWYgKHVubGlrZWx5
KHZxLT5icm9rZW4pKQo+ICsgICAgICAgICAgICAgICByZXR1cm4gRVJSX1BUUigtRUlPKTsKPgo+
ICAgICAgICAgTEFTVF9BRERfVElNRV9VUERBVEUodnEpOwo+Cj4gICAgICAgICBCVUdfT04odG90
YWxfc2cgPT0gMCk7Cj4KPiArICAgICAgIGRlc2MgPSBOVUxMOwo+ICsKPiAgICAgICAgIGlmICh2
aXJ0cXVldWVfdXNlX2luZGlyZWN0KHZxLCB0b3RhbF9zZykpIHsKPiAgICAgICAgICAgICAgICAg
ZGVzYyA9IGFsbG9jX2luZGlyZWN0X3BhY2tlZCh0b3RhbF9zZywgZ2ZwKTsKPiAgICAgICAgICAg
ICAgICAgaWYgKGRlc2MpIHsKPiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5saWtlbHko
dnEtPnZxLm51bV9mcmVlIDwgMSkpIHsKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHByX2RlYnVnKCJDYW4ndCBhZGQgYnVmIGxlbiAxIC0gYXZhaWwgPSAwXG4iKTsKPiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGtmcmVlKGRlc2MpOwo+IC0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgRU5EX1VTRSh2cSk7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICByZXR1cm4gLUVOT1NQQzsKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJl
dHVybiBFUlJfUFRSKC1FTk9TUEMpOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIH0KPgo+IC0g
ICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aXJ0cXVldWVfYWRkX2luZGlyZWN0X3BhY2tl
ZCh2cSwgc2dzLCB0b3RhbF9zZywgb3V0X3NncywKPiAtICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fc2dzLCBkYXRhLCBkZXNjKTsK
PiArICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKPiAgICAgICAgICAgICAgICAg
fQo+Cj4gICAgICAgICAgICAgICAgIC8qIGZhbGwgYmFjayBvbiBkaXJlY3QgKi8KPiAgICAgICAg
IH0KPgo+IC0gICAgICAgaGVhZCA9IHZxLT5wYWNrZWQubmV4dF9hdmFpbF9pZHg7Cj4gLSAgICAg
ICBhdmFpbF91c2VkX2ZsYWdzID0gdnEtPnBhY2tlZC5hdmFpbF91c2VkX2ZsYWdzOwo+IC0KPiAg
ICAgICAgIFdBUk5fT05fT05DRSh0b3RhbF9zZyA+IHZxLT5wYWNrZWQudnJpbmcubnVtICYmICF2
cS0+aW5kaXJlY3QpOwo+Cj4gLSAgICAgICBkZXNjID0gdnEtPnBhY2tlZC52cmluZy5kZXNjOwo+
IC0gICAgICAgaSA9IGhlYWQ7Cj4gICAgICAgICBkZXNjc191c2VkID0gdG90YWxfc2c7Cj4KPiAg
ICAgICAgIGlmICh1bmxpa2VseSh2cS0+dnEubnVtX2ZyZWUgPCBkZXNjc191c2VkKSkgewo+ICAg
ICAgICAgICAgICAgICBwcl9kZWJ1ZygiQ2FuJ3QgYWRkIGJ1ZiBsZW4gJWkgLSBhdmFpbCA9ICVp
XG4iLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjc191c2VkLCB2cS0+dnEubnVtX2Zy
ZWUpOwo+IC0gICAgICAgICAgICAgICBFTkRfVVNFKHZxKTsKPiAtICAgICAgICAgICAgICAgcmV0
dXJuIC1FTk9TUEM7Cj4gKyAgICAgICAgICAgICAgIHJldHVybiBFUlJfUFRSKC1FTk9TUEMpOwo+
ICAgICAgICAgfQo+Cj4gKyAgICAgICByZXR1cm4gZGVzYzsKPiArfQo+ICsKPiArc3RhdGljIGlu
bGluZSBpbnQgdmlydHF1ZXVlX2FkZF92cmluZ19wYWNrZWQoc3RydWN0IHZyaW5nX3ZpcnRxdWV1
ZSAqdnEsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ry
dWN0IHNjYXR0ZXJsaXN0ICpzZ3NbXSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgdG90YWxfc2csCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IG91dF9zZ3MsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGluX3Nn
cykKPiArewo+ICsgICAgICAgc3RydWN0IHZyaW5nX3BhY2tlZF9kZXNjICpkZXNjOwo+ICsgICAg
ICAgc3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKPiArICAgICAgIHVuc2lnbmVkIGludCBpLCBuLCBj
LCBkZXNjc191c2VkLCBlcnJfaWR4Owo+ICsgICAgICAgX19sZTE2IGhlYWRfZmxhZ3MsIGZsYWdz
Owo+ICsgICAgICAgdTE2IGhlYWQsIGlkLCBwcmV2LCBjdXJyLCBhdmFpbF91c2VkX2ZsYWdzOwo+
ICsKPiArICAgICAgIGRlc2MgPSB2cS0+cGFja2VkLnZyaW5nLmRlc2M7Cj4gKyAgICAgICBoZWFk
ID0gdnEtPnBhY2tlZC5uZXh0X2F2YWlsX2lkeDsKPiArICAgICAgIGkgPSBoZWFkOwo+ICsgICAg
ICAgZGVzY3NfdXNlZCA9IHRvdGFsX3NnOwo+ICsgICAgICAgYXZhaWxfdXNlZF9mbGFncyA9IHZx
LT5wYWNrZWQuYXZhaWxfdXNlZF9mbGFnczsKPiArCj4gICAgICAgICBpZCA9IHZxLT5mcmVlX2hl
YWQ7Cj4gICAgICAgICBCVUdfT04oaWQgPT0gdnEtPnBhY2tlZC52cmluZy5udW0pOwo+Cj4gQEAg
LTE1NjMsOCArMTU2Miw2IEBAIHN0YXRpYyBpbmxpbmUgaW50IHZpcnRxdWV1ZV9hZGRfcGFja2Vk
KHN0cnVjdCB2aXJ0cXVldWUgKl92cSwKPgo+ICAgICAgICAgLyogU3RvcmUgdG9rZW4uICovCj4g
ICAgICAgICB2cS0+cGFja2VkLmRlc2Nfc3RhdGVbaWRdLm51bSA9IGRlc2NzX3VzZWQ7Cj4gLSAg
ICAgICB2cS0+cGFja2VkLmRlc2Nfc3RhdGVbaWRdLmRhdGEgPSBkYXRhOwo+IC0gICAgICAgdnEt
PnBhY2tlZC5kZXNjX3N0YXRlW2lkXS5pbmRpcl9kZXNjID0gY3R4Owo+ICAgICAgICAgdnEtPnBh
Y2tlZC5kZXNjX3N0YXRlW2lkXS5sYXN0ID0gcHJldjsKPgo+ICAgICAgICAgLyoKPiBAQCAtMTU3
Nyw3ICsxNTc0LDYgQEAgc3RhdGljIGlubGluZSBpbnQgdmlydHF1ZXVlX2FkZF9wYWNrZWQoc3Ry
dWN0IHZpcnRxdWV1ZSAqX3ZxLAo+ICAgICAgICAgdnEtPm51bV9hZGRlZCArPSBkZXNjc191c2Vk
Owo+Cj4gICAgICAgICBwcl9kZWJ1ZygiQWRkZWQgYnVmZmVyIGhlYWQgJWkgdG8gJXBcbiIsIGhl
YWQsIHZxKTsKPiAtICAgICAgIEVORF9VU0UodnEpOwo+Cj4gICAgICAgICByZXR1cm4gMDsKPgo+
IEBAIC0xNTk4LDEwICsxNTk0LDU2IEBAIHN0YXRpYyBpbmxpbmUgaW50IHZpcnRxdWV1ZV9hZGRf
cGFja2VkKHN0cnVjdCB2aXJ0cXVldWUgKl92cSwKPiAgICAgICAgICAgICAgICAgICAgICAgICBp
ID0gMDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgRU5EX1VTRSh2cSk7Cj4gICAgICAgICByZXR1
cm4gLUVJTzsKPiAgfQo+Cj4gK3N0YXRpYyBpbmxpbmUgaW50IHZpcnRxdWV1ZV9hZGRfcGFja2Vk
KHN0cnVjdCB2aXJ0cXVldWUgKl92cSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnc1tdLAo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCB0b3RhbF9zZywKPiArICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgb3V0X3NncywKPiArICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgaW5fc2dzLAo+ICsg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmRhdGEsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqY3R4LAo+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdmcF90IGdmcCkKPiArewo+ICsKPiArICAgICAg
IHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxID0gdG9fdnZxKF92cSk7Cj4gKyAgICAgICBzdHJ1
Y3QgdnJpbmdfcGFja2VkX2Rlc2MgKmRlc2M7Cj4gKyAgICAgICB1MTYgaWQ7Cj4gKyAgICAgICBp
bnQgZXJyOwo+ICsKPiArICAgICAgIFNUQVJUX1VTRSh2cSk7Cj4gKwo+ICsgICAgICAgLyogY2hl
Y2sgdnEgc3RhdGUgYW5kIHRyeSB0byBhbGxvYyBkZXNjIGZvciBpbmRpcmVjdC4gKi8KPiArICAg
ICAgIGRlc2MgPSB2aXJ0cXVldWVfZ2V0X2Rlc2NfcGFja2VkKHZxLCB0b3RhbF9zZywgZGF0YSwg
Y3R4LCBnZnApOwo+ICsgICAgICAgaWYgKElTX0VSUihkZXNjKSkgewo+ICsgICAgICAgICAgICAg
ICBlcnIgPSBQVFJfRVJSKGRlc2MpOwo+ICsgICAgICAgICAgICAgICBnb3RvIGVuZDsKPiArICAg
ICAgIH0KPiArCj4gKyAgICAgICBpZCA9IHZxLT5mcmVlX2hlYWQ7Cj4gKwo+ICsgICAgICAgaWYg
KGRlc2MpIHsKPiArICAgICAgICAgICAgICAgZXJyID0gdmlydHF1ZXVlX2FkZF9pbmRpcmVjdF9w
YWNrZWQodnEsIHNncywgdG90YWxfc2csIG91dF9zZ3MsIGluX3NncywgZGVzYyk7Cj4gKyAgICAg
ICAgICAgICAgIGlmIChlcnIpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgZ290byBlcnI7Cj4g
KyAgICAgICB9IGVsc2Ugewo+ICsgICAgICAgICAgICAgICB2aXJ0cXVldWVfYWRkX3ZyaW5nX3Bh
Y2tlZCh2cSwgc2dzLCB0b3RhbF9zZywgb3V0X3NncywgaW5fc2dzKTsKCldoaWxlIGF0IGl0LCBj
YW4gd2UgdW5pZnkgdGhlIGxvZ2ljIG9mIHZpcnRxdWV1ZV9hZGRfaW5kaXJlY3RfcGFja2VkKCkK
YW5kIHZpcnRxdWV1ZV9hZGRfdnJpbmdfcGFja2VkKCk/Cgo+ICsgICAgICAgICAgICAgICB2cS0+
cGFja2VkLmRlc2Nfc3RhdGVbaWRdLmluZGlyX2Rlc2MgPSBjdHg7Cj4gKyAgICAgICB9Cj4gKwo+
ICsgICAgICAgdnEtPnBhY2tlZC5kZXNjX3N0YXRlW2lkXS5kYXRhID0gZGF0YTsKPiArCj4gKyAg
ICAgICBnb3RvIGVuZDsKClNpbWlsYXIgdG8gc3BsaXQsIEknZCByYXRoZXIgZHVwbGljYXRlIHRo
ZSBFTkRfVVNFKCkgYW5kIHJldHVybi4KClRoYW5rcwoKCj4gKwo+ICtlcnI6Cj4gKyAgICAgICBr
ZnJlZShkZXNjKTsKPiArCj4gK2VuZDoKPiArICAgICAgIEVORF9VU0UodnEpOwo+ICsgICAgICAg
cmV0dXJuIGVycjsKPiArfQo+ICsKPiAgc3RhdGljIGJvb2wgdmlydHF1ZXVlX2tpY2tfcHJlcGFy
ZV9wYWNrZWQoc3RydWN0IHZpcnRxdWV1ZSAqX3ZxKQo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgdnJp
bmdfdmlydHF1ZXVlICp2cSA9IHRvX3Z2cShfdnEpOwo+IC0tCj4gMi4zMi4wLjMuZzAxMTk1Y2Y5
Zgo+CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0
dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRh
dGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGlu
Zm8vdmlydHVhbGl6YXRpb24=
