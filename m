Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from mail.linuxfoundation.org (mail.linuxfoundation.org [140.211.169.12])
	by mail.lfdr.de (Postfix) with ESMTPS id 692622DB4B
	for <lists.virtualization@lfdr.de>; Wed, 29 May 2019 13:00:59 +0200 (CEST)
Received: from mail.linux-foundation.org (localhost [127.0.0.1])
	by mail.linuxfoundation.org (Postfix) with ESMTP id 1D84424C8;
	Wed, 29 May 2019 11:00:54 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@mail.linuxfoundation.org
Received: from smtp1.linuxfoundation.org (smtp1.linux-foundation.org
	[172.17.192.35])
	by mail.linuxfoundation.org (Postfix) with ESMTPS id 622CF24C1
	for <virtualization@lists.linux-foundation.org>;
	Wed, 29 May 2019 10:58:38 +0000 (UTC)
X-Greylist: whitelisted by SQLgrey-1.7.6
Received: from mail-wm1-f68.google.com (mail-wm1-f68.google.com
	[209.85.128.68])
	by smtp1.linuxfoundation.org (Postfix) with ESMTPS id 293E0823
	for <virtualization@lists.linux-foundation.org>;
	Wed, 29 May 2019 10:58:37 +0000 (UTC)
Received: by mail-wm1-f68.google.com with SMTP id v19so4064211wmh.0
	for <virtualization@lists.linux-foundation.org>;
	Wed, 29 May 2019 03:58:37 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20161025;
	h=x-gm-message-state:date:from:to:cc:subject:message-id:references
	:mime-version:content-disposition:content-transfer-encoding
	:in-reply-to:user-agent;
	bh=4gM+INWJgv9FdjldlOiqfPQs/3KoKbaQl3oay9t+Fsc=;
	b=SBjSBNRBoviytxjinVjlKj5WKIYHz2cD/4nximqcZbtCILzF6AB05dQ9PDhfA3Natz
	rknAc8bR8qX9c7XoLmjJsW9MdpIckDftvq9wjZ8Z5GjGduyRt6w96R429rA1ZbJBksaf
	K+28Zx3hcq1C/6P1EngdVSb9EMFvaNOZbfq32DEj7APe3A1wbaHnyEbXekBDhPxCWWX0
	vv1PYWJ/3k860MHMhUHgmvRxfgokNrt2cXioRl5bvwpy3aWMV/fQC7xExdIl0gg3rWRq
	/5mXHYg1f86VxYju93lFcLVvvHR3L322AIEzeLoBkg3h/jnOiyxudivccujFd49RuhA1
	6oQw==
X-Gm-Message-State: APjAAAW7JTuUqYARdt+voQ7UvWUtq44TeM6Gla7Z3hCqes5JlvM4f9vQ
	PLAmDOV7BHLx549lRqP0HKg9vg==
X-Google-Smtp-Source: APXvYqx8DFltvKkXywu9P2M63vLL0b9huUgQDGKM0bNckHf+CE/QRL47FPbLHu0JlvqcBJyV8vRuLQ==
X-Received: by 2002:a1c:acc8:: with SMTP id v191mr6597928wme.177.1559127515682;
	Wed, 29 May 2019 03:58:35 -0700 (PDT)
Received: from steredhat (host253-229-dynamic.248-95-r.retail.telecomitalia.it.
	[95.248.229.253]) by smtp.gmail.com with ESMTPSA id
	j123sm9038134wmb.32.2019.05.29.03.58.34
	(version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
	Wed, 29 May 2019 03:58:34 -0700 (PDT)
Date: Wed, 29 May 2019 12:58:32 +0200
From: Stefano Garzarella <sgarzare@redhat.com>
To: Jason Wang <jasowang@redhat.com>
Subject: Re: [PATCH 3/4] vsock/virtio: fix flush of works during the .remove()
Message-ID: <20190529105832.oz3sagbne5teq3nt@steredhat>
References: <20190528105623.27983-1-sgarzare@redhat.com>
	<20190528105623.27983-4-sgarzare@redhat.com>
	<9ac9fc4b-5c39-2503-dfbb-660a7bdcfbfd@redhat.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <9ac9fc4b-5c39-2503-dfbb-660a7bdcfbfd@redhat.com>
User-Agent: NeoMutt/20180716
X-Spam-Status: No, score=-1.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_NONE
	autolearn=ham version=3.3.1
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	smtp1.linux-foundation.org
Cc: kvm@vger.kernel.org, "Michael S . Tsirkin" <mst@redhat.com>,
	netdev@vger.kernel.org, linux-kernel@vger.kernel.org,
	virtualization@lists.linux-foundation.org,
	Stefan Hajnoczi <stefanha@redhat.com>,
	"David S. Miller" <davem@davemloft.net>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.12
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: virtualization-bounces@lists.linux-foundation.org
Errors-To: virtualization-bounces@lists.linux-foundation.org

T24gV2VkLCBNYXkgMjksIDIwMTkgYXQgMTE6MjI6NDBBTSArMDgwMCwgSmFzb24gV2FuZyB3cm90
ZToKPiAKPiBPbiAyMDE5LzUvMjgg5LiL5Y2INjo1NiwgU3RlZmFubyBHYXJ6YXJlbGxhIHdyb3Rl
Ogo+ID4gV2UgZmx1c2ggYWxsIHBlbmRpbmcgd29ya3MgYmVmb3JlIHRvIGNhbGwgdmRldi0+Y29u
ZmlnLT5yZXNldCh2ZGV2KSwKPiA+IGJ1dCBvdGhlciB3b3JrcyBjYW4gYmUgcXVldWVkIGJlZm9y
ZSB0aGUgdmRldi0+Y29uZmlnLT5kZWxfdnFzKHZkZXYpLAo+ID4gc28gd2UgYWRkIGFub3RoZXIg
Zmx1c2ggYWZ0ZXIgaXQsIHRvIGF2b2lkIHVzZSBhZnRlciBmcmVlLgo+ID4gCj4gPiBTdWdnZXN0
ZWQtYnk6IE1pY2hhZWwgUy4gVHNpcmtpbiA8bXN0QHJlZGhhdC5jb20+Cj4gPiBTaWduZWQtb2Zm
LWJ5OiBTdGVmYW5vIEdhcnphcmVsbGEgPHNnYXJ6YXJlQHJlZGhhdC5jb20+Cj4gPiAtLS0KPiA+
ICAgbmV0L3Ztd192c29jay92aXJ0aW9fdHJhbnNwb3J0LmMgfCAyMyArKysrKysrKysrKysrKysr
Ky0tLS0tLQo+ID4gICAxIGZpbGUgY2hhbmdlZCwgMTcgaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlv
bnMoLSkKPiA+IAo+ID4gZGlmZiAtLWdpdCBhL25ldC92bXdfdnNvY2svdmlydGlvX3RyYW5zcG9y
dC5jIGIvbmV0L3Ztd192c29jay92aXJ0aW9fdHJhbnNwb3J0LmMKPiA+IGluZGV4IGU2OTRkZjEw
YWI2MS4uYWQwOTNjZTk2NjkzIDEwMDY0NAo+ID4gLS0tIGEvbmV0L3Ztd192c29jay92aXJ0aW9f
dHJhbnNwb3J0LmMKPiA+ICsrKyBiL25ldC92bXdfdnNvY2svdmlydGlvX3RyYW5zcG9ydC5jCj4g
PiBAQCAtNjYwLDYgKzY2MCwxNSBAQCBzdGF0aWMgaW50IHZpcnRpb192c29ja19wcm9iZShzdHJ1
Y3QgdmlydGlvX2RldmljZSAqdmRldikKPiA+ICAgCXJldHVybiByZXQ7Cj4gPiAgIH0KPiA+ICtz
dGF0aWMgdm9pZCB2aXJ0aW9fdnNvY2tfZmx1c2hfd29ya3Moc3RydWN0IHZpcnRpb192c29jayAq
dnNvY2spCj4gPiArewo+ID4gKwlmbHVzaF93b3JrKCZ2c29jay0+bG9vcGJhY2tfd29yayk7Cj4g
PiArCWZsdXNoX3dvcmsoJnZzb2NrLT5yeF93b3JrKTsKPiA+ICsJZmx1c2hfd29yaygmdnNvY2st
PnR4X3dvcmspOwo+ID4gKwlmbHVzaF93b3JrKCZ2c29jay0+ZXZlbnRfd29yayk7Cj4gPiArCWZs
dXNoX3dvcmsoJnZzb2NrLT5zZW5kX3BrdF93b3JrKTsKPiA+ICt9Cj4gPiArCj4gPiAgIHN0YXRp
YyB2b2lkIHZpcnRpb192c29ja19yZW1vdmUoc3RydWN0IHZpcnRpb19kZXZpY2UgKnZkZXYpCj4g
PiAgIHsKPiA+ICAgCXN0cnVjdCB2aXJ0aW9fdnNvY2sgKnZzb2NrID0gdmRldi0+cHJpdjsKPiA+
IEBAIC02NjgsMTIgKzY3Nyw2IEBAIHN0YXRpYyB2b2lkIHZpcnRpb192c29ja19yZW1vdmUoc3Ry
dWN0IHZpcnRpb19kZXZpY2UgKnZkZXYpCj4gPiAgIAltdXRleF9sb2NrKCZ0aGVfdmlydGlvX3Zz
b2NrX211dGV4KTsKPiA+ICAgCXRoZV92aXJ0aW9fdnNvY2sgPSBOVUxMOwo+ID4gLQlmbHVzaF93
b3JrKCZ2c29jay0+bG9vcGJhY2tfd29yayk7Cj4gPiAtCWZsdXNoX3dvcmsoJnZzb2NrLT5yeF93
b3JrKTsKPiA+IC0JZmx1c2hfd29yaygmdnNvY2stPnR4X3dvcmspOwo+ID4gLQlmbHVzaF93b3Jr
KCZ2c29jay0+ZXZlbnRfd29yayk7Cj4gPiAtCWZsdXNoX3dvcmsoJnZzb2NrLT5zZW5kX3BrdF93
b3JrKTsKPiA+IC0KPiA+ICAgCS8qIFJlc2V0IGFsbCBjb25uZWN0ZWQgc29ja2V0cyB3aGVuIHRo
ZSBkZXZpY2UgZGlzYXBwZWFyICovCj4gPiAgIAl2c29ja19mb3JfZWFjaF9jb25uZWN0ZWRfc29j
a2V0KHZpcnRpb192c29ja19yZXNldF9zb2NrKTsKPiA+IEBAIC02OTAsNiArNjkzLDkgQEAgc3Rh
dGljIHZvaWQgdmlydGlvX3Zzb2NrX3JlbW92ZShzdHJ1Y3QgdmlydGlvX2RldmljZSAqdmRldikK
PiA+ICAgCXZzb2NrLT5ldmVudF9ydW4gPSBmYWxzZTsKPiA+ICAgCW11dGV4X3VubG9jaygmdnNv
Y2stPmV2ZW50X2xvY2spOwo+ID4gKwkvKiBGbHVzaCBhbGwgcGVuZGluZyB3b3JrcyAqLwo+ID4g
Kwl2aXJ0aW9fdnNvY2tfZmx1c2hfd29ya3ModnNvY2spOwo+ID4gKwo+ID4gICAJLyogRmx1c2gg
YWxsIGRldmljZSB3cml0ZXMgYW5kIGludGVycnVwdHMsIGRldmljZSB3aWxsIG5vdCB1c2UgYW55
Cj4gPiAgIAkgKiBtb3JlIGJ1ZmZlcnMuCj4gPiAgIAkgKi8KPiA+IEBAIC03MjYsNiArNzMyLDEx
IEBAIHN0YXRpYyB2b2lkIHZpcnRpb192c29ja19yZW1vdmUoc3RydWN0IHZpcnRpb19kZXZpY2Ug
KnZkZXYpCj4gPiAgIAkvKiBEZWxldGUgdmlydHF1ZXVlcyBhbmQgZmx1c2ggb3V0c3RhbmRpbmcg
Y2FsbGJhY2tzIGlmIGFueSAqLwo+ID4gICAJdmRldi0+Y29uZmlnLT5kZWxfdnFzKHZkZXYpOwo+
ID4gKwkvKiBPdGhlciB3b3JrcyBjYW4gYmUgcXVldWVkIGJlZm9yZSAnY29uZmlnLT5kZWxfdnFz
KCknLCBzbyB3ZSBmbHVzaAo+ID4gKwkgKiBhbGwgd29ya3MgYmVmb3JlIHRvIGZyZWUgdGhlIHZz
b2NrIG9iamVjdCB0byBhdm9pZCB1c2UgYWZ0ZXIgZnJlZS4KPiA+ICsJICovCj4gPiArCXZpcnRp
b192c29ja19mbHVzaF93b3Jrcyh2c29jayk7Cj4gCj4gCj4gU29tZSBxdWVzdGlvbnMgYWZ0ZXIg
YSBxdWljayBnbGFuY2U6Cj4gCj4gMSkgSXQgbG9va3MgdG8gbWUgdGhhdCB0aGUgd29yayBjb3Vs
ZCBiZSBxdWV1ZWQgZnJvbSB0aGUgcGF0aCBvZgo+IHZzb2NrX3RyYW5zcG9ydF9jYW5jZWxfcGt0
KCkgLiBJcyB0aGF0IHN5bmNocm9uaXplZCBoZXJlPwo+CgpCb3RoIHZpcnRpb190cmFuc3BvcnRf
c2VuZF9wa3QoKSBhbmQgdnNvY2tfdHJhbnNwb3J0X2NhbmNlbF9wa3QoKSBjYW4KcXVldWUgd29y
ayBmcm9tIHRoZSB1cHBlciBsYXllciAoc29ja2V0KS4KClNldHRpbmcgdGhlX3ZpcnRpb192c29j
ayB0byBOVUxMLCBzaG91bGQgc3luY2hyb25pemUsIGJ1dCBhZnRlciBhIGNhcmVmdWwgbG9vawph
IHJhcmUgaXNzdWUgY291bGQgaGFwcGVuOgp3ZSBhcmUgc2V0dGluZyB0aGVfdmlydGlvX3Zzb2Nr
IHRvIE5VTEwgYXQgdGhlIHN0YXJ0IG9mIC5yZW1vdmUoKSBhbmQgd2UKYXJlIGZyZWVpbmcgdGhl
IG9iamVjdCBwb2ludGVkIGJ5IGl0IGF0IHRoZSBlbmQgb2YgLnJlbW92ZSgpLCBzbwp2aXJ0aW9f
dHJhbnNwb3J0X3NlbmRfcGt0KCkgb3IgdnNvY2tfdHJhbnNwb3J0X2NhbmNlbF9wa3QoKSBtYXkg
c3RpbGwgYmUKcnVubmluZywgYWNjZXNzaW5nIHRoZSBvYmplY3QgdGhhdCB3ZSBhcmUgZnJlZWQu
CgpTaG91bGQgSSB1c2Ugc29tZXRoaW5nIGxpa2UgUkNVIHRvIHByZXZlbnQgdGhpcyBpc3N1ZT8K
CiAgICB2aXJ0aW9fdHJhbnNwb3J0X3NlbmRfcGt0KCkgYW5kIHZzb2NrX3RyYW5zcG9ydF9jYW5j
ZWxfcGt0KCkKICAgIHsKICAgICAgICByY3VfcmVhZF9sb2NrKCk7CiAgICAgICAgdnNvY2sgPSBy
Y3VfZGVyZWZlcmVuY2UodGhlX3ZpcnRpb192c29ja19tdXRleCk7CiAgICAgICAgLi4uCiAgICAg
ICAgcmN1X3JlYWRfdW5sb2NrKCk7CiAgICB9CgogICAgdmlydGlvX3Zzb2NrX3JlbW92ZSgpCiAg
ICB7CiAgICAgICAgcmN1X2Fzc2lnbl9wb2ludGVyKHRoZV92aXJ0aW9fdnNvY2tfbXV0ZXgsIE5V
TEwpOwogICAgICAgIHN5bmNocm9uaXplX3JjdSgpOwoKICAgICAgICAuLi4KCiAgICAgICAgZnJl
ZSh2c29jayk7CiAgICB9CgpDb3VsZCB0aGVyZSBiZSBhIGJldHRlciBhcHByb2FjaD8KCgo+IDIp
IElmIHdlIGRlY2lkZSB0byBmbHVzaCBhZnRlciBkZXZfdnFzKCksIGlzIHR4X3J1bi9yeF9ydW4v
ZXZlbnRfcnVuIHN0aWxsCj4gbmVlZGVkPyBJdCBsb29rcyB0byBtZSB3ZSd2ZSBhbHJlYWR5IGRv
bmUgZXhjZXB0IHRoYXQgd2UgbmVlZCBmbHVzaCByeF93b3JrCj4gaW4gdGhlIGVuZCBzaW5jZSBz
ZW5kX3BrdF93b3JrIGNhbiByZXF1ZXVlIHJ4X3dvcmsuCgpUaGUgbWFpbiByZWFzb24gb2YgdHhf
cnVuL3J4X3J1bi9ldmVudF9ydW4gaXMgdG8gcHJldmVudCB0aGF0IGEgd29ya2VyCmZ1bmN0aW9u
IGlzIHJ1bm5pbmcgd2hpbGUgd2UgYXJlIGNhbGxpbmcgY29uZmlnLT5yZXNldCgpLgoKRS5nLiBp
ZiBhbiBpbnRlcnJ1cHQgY29tZXMgYmV0d2VlbiB2aXJ0aW9fdnNvY2tfZmx1c2hfd29ya3MoKSBh
bmQKY29uZmlnLT5yZXNldCgpLCBpdCBjYW4gcXVldWUgbmV3IHdvcmtzIHRoYXQgY2FuIGFjY2Vz
cyB0aGUgZGV2aWNlIHdoaWxlCndlIGFyZSBpbiBjb25maWctPnJlc2V0KCkuCgpJTUhPIHRoZXkg
YXJlIHN0aWxsIG5lZWRlZC4KCldoYXQgZG8geW91IHRoaW5rPwoKClRoYW5rcyBmb3IgeW91ciBx
dWVzdGlvbnMsClN0ZWZhbm8KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3Rz
LmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
