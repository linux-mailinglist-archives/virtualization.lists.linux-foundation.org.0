Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id AED151E77B2
	for <lists.virtualization@lfdr.de>; Fri, 29 May 2020 10:04:11 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 5C9528934A;
	Fri, 29 May 2020 08:04:10 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id SLQ0t46nE6uw; Fri, 29 May 2020 08:04:09 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 158F08934B;
	Fri, 29 May 2020 08:04:09 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id F145AC016F;
	Fri, 29 May 2020 08:04:08 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 9C01BC016F
 for <virtualization@lists.linux-foundation.org>;
 Fri, 29 May 2020 08:04:07 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 96AFE85078
 for <virtualization@lists.linux-foundation.org>;
 Fri, 29 May 2020 08:04:07 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id NKqoWaNv0oLy
 for <virtualization@lists.linux-foundation.org>;
 Fri, 29 May 2020 08:04:06 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from us-smtp-delivery-1.mimecast.com (us-smtp-1.mimecast.com
 [207.211.31.81])
 by whitealder.osuosl.org (Postfix) with ESMTPS id D078C883AD
 for <virtualization@lists.linux-foundation.org>;
 Fri, 29 May 2020 08:04:05 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1590739444;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=4n31HvUsSFkIbDDQwLElleJUWe581hw1vDZ+++YCvBE=;
 b=IBboptKc5PqBGUowOLY4PChOdttXL2IPBjRtLTCQzex3W3Xq8ehjPWpmv7W7NNXE/3OaZ1
 iqJSl4iSChEoXh9uuX7tzx+kQULkPZcxRv6n5ndii+lE/nAD0SGvmxmHQiOIi77n6+vBGZ
 tS+k3mFO6RC++H9X3VhbtUWInbeF0f4=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-459-6RhjyjSWNCKcbd2dPWROcw-1; Fri, 29 May 2020 04:04:00 -0400
X-MC-Unique: 6RhjyjSWNCKcbd2dPWROcw-1
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 991B680183C;
 Fri, 29 May 2020 08:03:58 +0000 (UTC)
Received: from jason-ThinkPad-X1-Carbon-6th.redhat.com
 (ovpn-13-231.pek2.redhat.com [10.72.13.231])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 15C1E99DE6;
 Fri, 29 May 2020 08:03:47 +0000 (UTC)
From: Jason Wang <jasowang@redhat.com>
To: mst@redhat.com,
	jasowang@redhat.com
Subject: [PATCH 5/6] vdpa: introduce virtio pci driver
Date: Fri, 29 May 2020 16:03:02 +0800
Message-Id: <20200529080303.15449-6-jasowang@redhat.com>
In-Reply-To: <20200529080303.15449-1-jasowang@redhat.com>
References: <20200529080303.15449-1-jasowang@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
Cc: shahafs@mellanox.com, lulu@redhat.com, kvm@vger.kernel.org,
 saugatm@xilinx.com, netdev@vger.kernel.org, mhabets@solarflare.com,
 vmireyno@marvell.com, linux-kernel@vger.kernel.org, gdawar@xilinx.com,
 virtualization@lists.linux-foundation.org, eperezma@redhat.com,
 hanand@xilinx.com, zhangweining@ruijie.com.cn, eli@mellanox.com,
 lingshan.zhu@intel.com, rob.miller@broadcom.com
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhpcyBwYXRjaCBpbnRyb2R1Y2UgYSB2RFBBIGRyaXZlciBmb3IgdmlydGlvLXBjaSBkZXZpY2Uu
IEl0IGJyaWRnZXMKdGhlIHZpcnRpby1wY2kgY29udHJvbCBjb21tYW5kIHRvIHRoZSB2RFBBIGJ1
cy4gVGhpcyB3aWxsIGJlIHVzZWQgZm9yCmRldmVsb3BpbmcgbmV3IGZlYXR1cmVzIGZvciBib3Ro
IHNvZnR3YXJlIHZEUEEgZnJhbWV3b3JrIGFuZCBoYXJkd2FyZQp2RFBBIGZlYXR1cmUuCgpDb21w
YXJlZCB0byB2ZHBhX3NpbSwgaXQgaGFzIHNldmVyYWwgYWR2YW50YWdlczoKCi0gaXQncyBhIHJl
YWwgZGV2aWNlIGRyaXZlciB3aGljaCBhbGxvdyB1cyB0byBwbGF5IHdpdGggcmVhbCBoYXJkd2Fy
ZQogIGZlYXR1cmVzCi0gdHlwZSBpbmRlcGVuZGVudCBpbnN0ZWFkIG9mIG5ldHdvcmtpbmcgc3Bl
Y2lmaWMKCk5vdGUgdGhhdCBzaW5jZSB2aXJ0aW8gc3BlY2lmaWNhdGlvbiBkb2VzIG5vdCBzdXBw
b3J0IGdldC9yZXN0b3JlCnZpcnRxdWV1ZSBzdGF0ZS4gU28gd2UgY2FuIG5vdCB1c2UgdGhpcyBk
cml2ZXIgZm9yIFZNLiBUaGlzIGNhbiBiZQphZGRyZXNzZWQgYnkgZXh0ZW5kaW5nIHRoZSB2aXJ0
aW8gc3BlY2lmaWNhdGlvbi4KClNpZ25lZC1vZmYtYnk6IEphc29uIFdhbmcgPGphc293YW5nQHJl
ZGhhdC5jb20+Ci0tLQogZHJpdmVycy92ZHBhL0tjb25maWcgICAgICAgICAgIHwgICA2ICsKIGRy
aXZlcnMvdmRwYS9NYWtlZmlsZSAgICAgICAgICB8ICAgMSArCiBkcml2ZXJzL3ZkcGEvdnBfdmRw
YS9NYWtlZmlsZSAgfCAgIDIgKwogZHJpdmVycy92ZHBhL3ZwX3ZkcGEvdnBfdmRwYS5jIHwgNTgz
ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCA1OTIg
aW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvdmRwYS92cF92ZHBhL01h
a2VmaWxlCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy92ZHBhL3ZwX3ZkcGEvdnBfdmRwYS5j
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy92ZHBhL0tjb25maWcgYi9kcml2ZXJzL3ZkcGEvS2NvbmZp
ZwppbmRleCBlODE0MDA2NWM4YTUuLjNmMWJmOGI2NzIzZCAxMDA2NDQKLS0tIGEvZHJpdmVycy92
ZHBhL0tjb25maWcKKysrIGIvZHJpdmVycy92ZHBhL0tjb25maWcKQEAgLTI4LDQgKzI4LDEwIEBA
IGNvbmZpZyBJRkNWRgogCSAgVG8gY29tcGlsZSB0aGlzIGRyaXZlciBhcyBhIG1vZHVsZSwgY2hv
b3NlIE0gaGVyZTogdGhlIG1vZHVsZSB3aWxsCiAJICBiZSBjYWxsZWQgaWZjdmYuCiAKK2NvbmZp
ZyBWUF9WRFBBCisJdHJpc3RhdGUgIlZpcnRpbyBQQ0kgYnJpZGdlIHZEUEEgZHJpdmVyIgorCWRl
cGVuZHMgb24gUENJX01TSQorCWhlbHAKKwkgIFRoaXMga2VybmVsIG1vZHVsZSB0aGF0IGJyaWRn
ZXMgdmlydGlvIFBDSSBkZXZpY2UgdG8gdkRQQSBidXMuCisKIGVuZGlmICMgVkRQQQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy92ZHBhL01ha2VmaWxlIGIvZHJpdmVycy92ZHBhL01ha2VmaWxlCmluZGV4
IDhiYmI2ODZjYTdhMi4uMzdkMDBmNDliM2JmIDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZkcGEvTWFr
ZWZpbGUKKysrIGIvZHJpdmVycy92ZHBhL01ha2VmaWxlCkBAIC0yLDMgKzIsNCBAQAogb2JqLSQo
Q09ORklHX1ZEUEEpICs9IHZkcGEubwogb2JqLSQoQ09ORklHX1ZEUEFfU0lNKSArPSB2ZHBhX3Np
bS8KIG9iai0kKENPTkZJR19JRkNWRikgICAgKz0gaWZjdmYvCitvYmotJChDT05GSUdfVlBfVkRQ
QSkgICAgKz0gdnBfdmRwYS8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmRwYS92cF92ZHBhL01ha2Vm
aWxlIGIvZHJpdmVycy92ZHBhL3ZwX3ZkcGEvTWFrZWZpbGUKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
aW5kZXggMDAwMDAwMDAwMDAwLi4yMzEwODhkM2FmN2QKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2
ZXJzL3ZkcGEvdnBfdmRwYS9NYWtlZmlsZQpAQCAtMCwwICsxLDIgQEAKKyMgU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IEdQTC0yLjAKK29iai0kKENPTkZJR19WUF9WRFBBKSArPSB2cF92ZHBhLm8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmRwYS92cF92ZHBhL3ZwX3ZkcGEuYyBiL2RyaXZlcnMvdmRw
YS92cF92ZHBhL3ZwX3ZkcGEuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAw
MDAuLmU1OWMzMTBlMjE1NgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvdmRwYS92cF92ZHBh
L3ZwX3ZkcGEuYwpAQCAtMCwwICsxLDU4MyBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IEdQTC0yLjAtb25seQorLyoKKyAqIHZEUEEgYnJpZGdlIGRyaXZlciBmb3IgbW9kZXJuIHZpcnRp
by1wY2kgZGV2aWNlCisgKgorICogQ29weXJpZ2h0IChjKSAyMDIwLCBSZWQgSGF0IEluYy4gQWxs
IHJpZ2h0cyByZXNlcnZlZC4KKyAqIEF1dGhvcjogSmFzb24gV2FuZyA8amFzb3dhbmdAcmVkaGF0
LmNvbT4KKyAqCisgKiBCYXNlZCBvbiB2aXJ0aW9fcGNpX21vZGVybi5jLgorICovCisKKyNpbmNs
dWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNs
dWRlIDxsaW51eC9wY2kuaD4KKyNpbmNsdWRlIDxsaW51eC92ZHBhLmg+CisjaW5jbHVkZSA8bGlu
dXgvdmlydGlvLmg+CisjaW5jbHVkZSA8bGludXgvdmlydGlvX2NvbmZpZy5oPgorI2luY2x1ZGUg
PGxpbnV4L3ZpcnRpb19yaW5nLmg+CisjaW5jbHVkZSA8bGludXgvdmlydGlvX3BjaS5oPgorCisv
KiBUQkQ6IHJlYWQgZnJvbSBjb25maWcgc3BhY2UgKi8KKyNkZWZpbmUgVlBfVkRQQV9NQVhfUVVF
VUUgMgorI2RlZmluZSBWUF9WRFBBX0RSSVZFUl9OQU1FICJ2cF92ZHBhIgorCisjZGVmaW5lIFZQ
X1ZEUEFfRkVBVFVSRVMgXAorCSAoMVVMTCA8PCBWSVJUSU9fRl9BTllfTEFZT1VUKQkJCXwgXAor
CSAoMVVMTCA8PCBWSVJUSU9fRl9WRVJTSU9OXzEpCQkJfCBcCisJICgxVUxMIDw8IFZJUlRJT19G
X09SREVSX1BMQVRGT1JNKQkJfCBcCisJICgxVUxMIDw8IFZJUlRJT19GX0lPTU1VX1BMQVRGT1JN
KQorCitzdHJ1Y3QgdnBfdnJpbmcgeworCXZvaWQgX19pb21lbSAqbm90aWZ5OworCWNoYXIgbXNp
eF9uYW1lWzI1Nl07CisJc3RydWN0IHZkcGFfY2FsbGJhY2sgY2I7CisJaW50IGlycTsKK307CisK
K3N0cnVjdCB2cF92ZHBhIHsKKwlzdHJ1Y3QgdmRwYV9kZXZpY2UgdmRwYTsKKwlzdHJ1Y3QgcGNp
X2RldiAqcGRldjsKKworCXN0cnVjdCB2aXJ0aW9fZGV2aWNlX2lkIGlkOworCisJc3RydWN0IHZw
X3ZyaW5nIHZyaW5nW1ZQX1ZEUEFfTUFYX1FVRVVFXTsKKworCS8qIFRoZSBJTyBtYXBwaW5nIGZv
ciB0aGUgUENJIGNvbmZpZyBzcGFjZSAqLworCXZvaWQgX19pb21lbSAqIGNvbnN0ICpiYXNlOwor
CXN0cnVjdCB2aXJ0aW9fcGNpX2NvbW1vbl9jZmcgX19pb21lbSAqY29tbW9uOworCXZvaWQgX19p
b21lbSAqZGV2aWNlOworCS8qIEJhc2Ugb2YgdnEgbm90aWZpY2F0aW9ucyAqLworCXZvaWQgX19p
b21lbSAqbm90aWZ5OworCisJLyogTXVsdGlwbGllciBmb3IgcXVldWVfbm90aWZ5X29mZi4gKi8K
Kwl1MzIgbm90aWZ5X29mZl9tdWx0aXBsaWVyOworCisJaW50IG1vZGVybl9iYXJzOworCWludCB2
ZWN0b3JzOworfTsKKworc3RhdGljIHN0cnVjdCB2cF92ZHBhICp2ZHBhX3RvX3ZwKHN0cnVjdCB2
ZHBhX2RldmljZSAqdmRwYSkKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKHZkcGEsIHN0cnVjdCB2
cF92ZHBhLCB2ZHBhKTsKK30KKworLyoKKyAqIFR5cGUtc2FmZSB3cmFwcGVycyBmb3IgaW8gYWNj
ZXNzZXMuCisgKiBVc2UgdGhlc2UgdG8gZW5mb3JjZSBhdCBjb21waWxlIHRpbWUgdGhlIGZvbGxv
d2luZyBzcGVjIHJlcXVpcmVtZW50OgorICoKKyAqIFRoZSBkcml2ZXIgTVVTVCBhY2Nlc3MgZWFj
aCBmaWVsZCB1c2luZyB0aGUg4oCcbmF0dXJhbOKAnSBhY2Nlc3MKKyAqIG1ldGhvZCwgaS5lLiAz
Mi1iaXQgYWNjZXNzZXMgZm9yIDMyLWJpdCBmaWVsZHMsIDE2LWJpdCBhY2Nlc3NlcworICogZm9y
IDE2LWJpdCBmaWVsZHMgYW5kIDgtYml0IGFjY2Vzc2VzIGZvciA4LWJpdCBmaWVsZHMuCisgKi8K
K3N0YXRpYyBpbmxpbmUgdTggdnBfaW9yZWFkOCh1OCBfX2lvbWVtICphZGRyKQoreworCXJldHVy
biBpb3JlYWQ4KGFkZHIpOworfQorc3RhdGljIGlubGluZSB1MTYgdnBfaW9yZWFkMTYgKF9fbGUx
NiBfX2lvbWVtICphZGRyKQoreworCXJldHVybiBpb3JlYWQxNihhZGRyKTsKK30KKworc3RhdGlj
IGlubGluZSB1MzIgdnBfaW9yZWFkMzIoX19sZTMyIF9faW9tZW0gKmFkZHIpCit7CisJcmV0dXJu
IGlvcmVhZDMyKGFkZHIpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgdnBfaW93cml0ZTgodTgg
dmFsdWUsIHU4IF9faW9tZW0gKmFkZHIpCit7CisJaW93cml0ZTgodmFsdWUsIGFkZHIpOworfQor
CitzdGF0aWMgaW5saW5lIHZvaWQgdnBfaW93cml0ZTE2KHUxNiB2YWx1ZSwgX19sZTE2IF9faW9t
ZW0gKmFkZHIpCit7CisJaW93cml0ZTE2KHZhbHVlLCBhZGRyKTsKK30KKworc3RhdGljIGlubGlu
ZSB2b2lkIHZwX2lvd3JpdGUzMih1MzIgdmFsdWUsIF9fbGUzMiBfX2lvbWVtICphZGRyKQorewor
CWlvd3JpdGUzMih2YWx1ZSwgYWRkcik7Cit9CisKK3N0YXRpYyB2b2lkIHZwX2lvd3JpdGU2NF90
d29wYXJ0KHU2NCB2YWwsCisJCQkJIF9fbGUzMiBfX2lvbWVtICpsbywgX19sZTMyIF9faW9tZW0g
KmhpKQoreworCXZwX2lvd3JpdGUzMigodTMyKXZhbCwgbG8pOworCXZwX2lvd3JpdGUzMih2YWwg
Pj4gMzIsIGhpKTsKK30KKworc3RhdGljIGludCBmaW5kX2NhcGFiaWxpdHkoc3RydWN0IHBjaV9k
ZXYgKmRldiwgdTggY2ZnX3R5cGUsCisJCQkgICB1MzIgaW9yZXNvdXJjZV90eXBlcywgaW50ICpi
YXJzKQoreworCWludCBwb3M7CisKKwlmb3IgKHBvcyA9IHBjaV9maW5kX2NhcGFiaWxpdHkoZGV2
LCBQQ0lfQ0FQX0lEX1ZORFIpOworCSAgICAgcG9zID4gMDsKKwkgICAgIHBvcyA9IHBjaV9maW5k
X25leHRfY2FwYWJpbGl0eShkZXYsIHBvcywgUENJX0NBUF9JRF9WTkRSKSkgeworCQl1OCB0eXBl
LCBiYXI7CisJCXBjaV9yZWFkX2NvbmZpZ19ieXRlKGRldiwgcG9zICsgb2Zmc2V0b2Yoc3RydWN0
IHZpcnRpb19wY2lfY2FwLAorCQkJCQkJCSBjZmdfdHlwZSksCisJCQkJICAgICAmdHlwZSk7CisJ
CXBjaV9yZWFkX2NvbmZpZ19ieXRlKGRldiwgcG9zICsgb2Zmc2V0b2Yoc3RydWN0IHZpcnRpb19w
Y2lfY2FwLAorCQkJCQkJCSBiYXIpLAorCQkJCSAgICAgJmJhcik7CisKKwkJLyogSWdub3JlIHN0
cnVjdHVyZXMgd2l0aCByZXNlcnZlZCBCQVIgdmFsdWVzICovCisJCWlmIChiYXIgPiAweDUpCisJ
CQljb250aW51ZTsKKworCQlpZiAodHlwZSA9PSBjZmdfdHlwZSkgeworCQkJaWYgKHBjaV9yZXNv
dXJjZV9sZW4oZGV2LCBiYXIpICYmCisJCQkgICAgcGNpX3Jlc291cmNlX2ZsYWdzKGRldiwgYmFy
KSAmIGlvcmVzb3VyY2VfdHlwZXMpIHsKKwkJCQkqYmFycyB8PSAoMSA8PCBiYXIpOworCQkJCXJl
dHVybiBwb3M7CisJCQl9CisJCX0KKwl9CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIF9f
aW9tZW0gKm1hcF9jYXBhYmlsaXR5KHN0cnVjdCB2cF92ZHBhICp2cF92ZHBhLCBpbnQgb2ZmKQor
eworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gdnBfdmRwYS0+cGRldjsKKwl1MzIgb2Zmc2V0Owor
CXU4IGJhcjsKKworCXBjaV9yZWFkX2NvbmZpZ19ieXRlKHBkZXYsCisJCQkgICAgIG9mZiArIG9m
ZnNldG9mKHN0cnVjdCB2aXJ0aW9fcGNpX2NhcCwgYmFyKSwKKwkJCSAgICAgJmJhcik7CisJcGNp
X3JlYWRfY29uZmlnX2R3b3JkKHBkZXYsCisJCQkgICAgICBvZmYgKyBvZmZzZXRvZihzdHJ1Y3Qg
dmlydGlvX3BjaV9jYXAsIG9mZnNldCksCisJCQkgICAgICAmb2Zmc2V0KTsKKworCXJldHVybiB2
cF92ZHBhLT5iYXNlW2Jhcl0gKyBvZmZzZXQ7Cit9CisKK3N0YXRpYyB1NjQgdnBfdmRwYV9nZXRf
ZmVhdHVyZXMoc3RydWN0IHZkcGFfZGV2aWNlICp2ZHBhKQoreworCXN0cnVjdCB2cF92ZHBhICp2
cF92ZHBhID0gdmRwYV90b192cCh2ZHBhKTsKKwl1NjQgZmVhdHVyZXM7CisKKwl2cF9pb3dyaXRl
MzIoMCwgJnZwX3ZkcGEtPmNvbW1vbi0+ZGV2aWNlX2ZlYXR1cmVfc2VsZWN0KTsKKwlmZWF0dXJl
cyA9IHZwX2lvcmVhZDMyKCZ2cF92ZHBhLT5jb21tb24tPmRldmljZV9mZWF0dXJlKTsKKwl2cF9p
b3dyaXRlMzIoMSwgJnZwX3ZkcGEtPmNvbW1vbi0+ZGV2aWNlX2ZlYXR1cmVfc2VsZWN0KTsKKwlm
ZWF0dXJlcyB8PSAoKHU2NCl2cF9pb3JlYWQzMigmdnBfdmRwYS0+Y29tbW9uLT5kZXZpY2VfZmVh
dHVyZSkgPDwgMzIpOworCWZlYXR1cmVzICY9IFZQX1ZEUEFfRkVBVFVSRVM7CisKKwlyZXR1cm4g
ZmVhdHVyZXM7Cit9CisKK3N0YXRpYyBpbnQgdnBfdmRwYV9zZXRfZmVhdHVyZXMoc3RydWN0IHZk
cGFfZGV2aWNlICp2ZHBhLCB1NjQgZmVhdHVyZXMpCit7CisJc3RydWN0IHZwX3ZkcGEgKnZwX3Zk
cGEgPSB2ZHBhX3RvX3ZwKHZkcGEpOworCisJdnBfaW93cml0ZTMyKDAsICZ2cF92ZHBhLT5jb21t
b24tPmd1ZXN0X2ZlYXR1cmVfc2VsZWN0KTsKKwl2cF9pb3dyaXRlMzIoKHUzMilmZWF0dXJlcywg
JnZwX3ZkcGEtPmNvbW1vbi0+Z3Vlc3RfZmVhdHVyZSk7CisJdnBfaW93cml0ZTMyKDEsICZ2cF92
ZHBhLT5jb21tb24tPmd1ZXN0X2ZlYXR1cmVfc2VsZWN0KTsKKwl2cF9pb3dyaXRlMzIoZmVhdHVy
ZXMgPj4gMzIsICZ2cF92ZHBhLT5jb21tb24tPmd1ZXN0X2ZlYXR1cmUpOworCisJcmV0dXJuIDA7
Cit9CisKK3N0YXRpYyB1OCB2cF92ZHBhX2dldF9zdGF0dXMoc3RydWN0IHZkcGFfZGV2aWNlICp2
ZHBhKQoreworCXN0cnVjdCB2cF92ZHBhICp2cF92ZHBhID0gdmRwYV90b192cCh2ZHBhKTsKKwor
CXJldHVybiB2cF9pb3JlYWQ4KCZ2cF92ZHBhLT5jb21tb24tPmRldmljZV9zdGF0dXMpOworfQor
CitzdGF0aWMgdm9pZCB2cF92ZHBhX2ZyZWVfaXJxKHN0cnVjdCB2cF92ZHBhICp2cF92ZHBhKQor
eworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gdnBfdmRwYS0+cGRldjsKKwlpbnQgaTsKKworCWZv
ciAoaSA9IDA7IGkgPCBWUF9WRFBBX01BWF9RVUVVRTsgaSsrKSB7CisJCWlmICh2cF92ZHBhLT52
cmluZ1tpXS5pcnEgIT0gLTEpIHsKKwkJCXZwX2lvd3JpdGUxNihpLCAmdnBfdmRwYS0+Y29tbW9u
LT5xdWV1ZV9zZWxlY3QpOworCQkJdnBfaW93cml0ZTE2KFZJUlRJT19NU0lfTk9fVkVDVE9SLAor
CQkJCSAgICAgJnZwX3ZkcGEtPmNvbW1vbi0+cXVldWVfbXNpeF92ZWN0b3IpOworCQkJZGV2bV9m
cmVlX2lycSgmcGRldi0+ZGV2LCB2cF92ZHBhLT52cmluZ1tpXS5pcnEsCisJCQkJICAgICAgJnZw
X3ZkcGEtPnZyaW5nW2ldKTsKKwkJCXZwX3ZkcGEtPnZyaW5nW2ldLmlycSA9IC0xOworCQl9CisJ
fQorCisJaWYgKHZwX3ZkcGEtPnZlY3RvcnMpIHsKKwkJcGNpX2ZyZWVfaXJxX3ZlY3RvcnMocGRl
dik7CisJCXZwX3ZkcGEtPnZlY3RvcnMgPSAwOworCX0KK30KKworc3RhdGljIGlycXJldHVybl90
IHZwX3ZkcGFfaW50cl9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgdnBf
dnJpbmcgKnZyaW5nID0gYXJnOworCisJaWYgKHZyaW5nLT5jYi5jYWxsYmFjaykKKwkJcmV0dXJu
IHZyaW5nLT5jYi5jYWxsYmFjayh2cmluZy0+Y2IucHJpdmF0ZSk7CisKKwlyZXR1cm4gSVJRX0hB
TkRMRUQ7Cit9CisKK3N0YXRpYyBpbnQgdnBfdmRwYV9yZXF1ZXN0X2lycShzdHJ1Y3QgdnBfdmRw
YSAqdnBfdmRwYSkKK3sKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IHZwX3ZkcGEtPnBkZXY7CisJ
aW50IGksIHJldCwgaXJxOworCisJcmV0ID0gcGNpX2FsbG9jX2lycV92ZWN0b3JzKHBkZXYsIFZQ
X1ZEUEFfTUFYX1FVRVVFLAorCQkJCSAgICBWUF9WRFBBX01BWF9RVUVVRSwgUENJX0lSUV9NU0lY
KTsKKwlpZiAocmV0ICE9IFZQX1ZEUEFfTUFYX1FVRVVFKSB7CisJCWRldl9lcnIoJnBkZXYtPmRl
diwgInZwX3ZkcGE6IGZhaWwgdG8gYWxsb2NhdGUgaXJxIHZlY3RvcnNcbiIpOworCQlyZXR1cm4g
cmV0OworCX0KKworCXZwX3ZkcGEtPnZlY3RvcnMgPSBWUF9WRFBBX01BWF9RVUVVRTsKKworCWZv
ciAoaSA9IDA7IGkgPCBWUF9WRFBBX01BWF9RVUVVRTsgaSsrKSB7CisJCXNucHJpbnRmKHZwX3Zk
cGEtPnZyaW5nW2ldLm1zaXhfbmFtZSwgMjU2LAorCQkJInZwLXZkcGFbJXNdLSVkXG4iLCBwY2lf
bmFtZShwZGV2KSwgaSk7CisJCWlycSA9IHBjaV9pcnFfdmVjdG9yKHBkZXYsIGkpOworCQlyZXQg
PSBkZXZtX3JlcXVlc3RfaXJxKCZwZGV2LT5kZXYsIGlycSwKKwkJCQkgICAgICAgdnBfdmRwYV9p
bnRyX2hhbmRsZXIsCisJCQkJICAgICAgIDAsIHZwX3ZkcGEtPnZyaW5nW2ldLm1zaXhfbmFtZSwK
KwkJCQkgICAgICAgJnZwX3ZkcGEtPnZyaW5nW2ldKTsKKwkJaWYgKHJldCkgeworCQkJZGV2X2Vy
cigmcGRldi0+ZGV2LCAidnBfdmRwYTogZmFpbCB0byByZXF1ZXN0IGlycSBmb3IgdnEgJWRcbiIs
IGkpOworCQkJZ290byBlcnI7CisJCX0KKwkJdnBfaW93cml0ZTE2KGksICZ2cF92ZHBhLT5jb21t
b24tPnF1ZXVlX3NlbGVjdCk7CisJCXZwX2lvd3JpdGUxNihpLCAmdnBfdmRwYS0+Y29tbW9uLT5x
dWV1ZV9tc2l4X3ZlY3Rvcik7CisJCXZwX3ZkcGEtPnZyaW5nW2ldLmlycSA9IGlycTsKKwl9CisK
KwlyZXR1cm4gMDsKK2VycjoKKwl2cF92ZHBhX2ZyZWVfaXJxKHZwX3ZkcGEpOworCXJldHVybiBy
ZXQ7Cit9CisKK3N0YXRpYyB2b2lkIHZwX3ZkcGFfc2V0X3N0YXR1cyhzdHJ1Y3QgdmRwYV9kZXZp
Y2UgKnZkcGEsIHU4IHN0YXR1cykKK3sKKwlzdHJ1Y3QgdnBfdmRwYSAqdnBfdmRwYSA9IHZkcGFf
dG9fdnAodmRwYSk7CisJdTggcyA9IHZwX3ZkcGFfZ2V0X3N0YXR1cyh2ZHBhKTsKKworCWlmIChz
dGF0dXMgJiBWSVJUSU9fQ09ORklHX1NfRFJJVkVSX09LICYmCisJICAgICEocyAmIFZJUlRJT19D
T05GSUdfU19EUklWRVJfT0spKSB7CisJCXZwX3ZkcGFfcmVxdWVzdF9pcnEodnBfdmRwYSk7CisJ
fQorCisJdnBfaW93cml0ZTgoc3RhdHVzLCAmdnBfdmRwYS0+Y29tbW9uLT5kZXZpY2Vfc3RhdHVz
KTsKKworCWlmICghKHN0YXR1cyAmIFZJUlRJT19DT05GSUdfU19EUklWRVJfT0spICYmCisJICAg
IChzICYgVklSVElPX0NPTkZJR19TX0RSSVZFUl9PSykpCisJCXZwX3ZkcGFfZnJlZV9pcnEodnBf
dmRwYSk7Cit9CisKK3N0YXRpYyB1MTYgdnBfdmRwYV9nZXRfdnFfbnVtX21heChzdHJ1Y3QgdmRw
YV9kZXZpY2UgKnZkcGEpCit7CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3RvX3Zw
KHZkcGEpOworCisJcmV0dXJuIHZwX2lvcmVhZDE2KCZ2cF92ZHBhLT5jb21tb24tPnF1ZXVlX3Np
emUpOworfQorCitzdGF0aWMgdTY0IHZwX3ZkcGFfZ2V0X3ZxX3N0YXRlKHN0cnVjdCB2ZHBhX2Rl
dmljZSAqdmRwYSwgdTE2IHFpZCkKK3sKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCB2cF92
ZHBhX3NldF92cV9zdGF0ZShzdHJ1Y3QgdmRwYV9kZXZpY2UgKnZkcGEsIHUxNiBxaWQsCisJCQkJ
dTY0IG51bSkKK3sKKwkvKiBOb3RlIHRoYXQgdGhpcyBpcyBub3Qgc3VwcG9ydGVkIGJ5IHZpcnRp
byBzcGVjaWZpY2F0aW9uLCBzbworCSAqIHdlIHJldHVybiAtRU5PVFNVUFAgaGVyZS4gVGhpcyBt
ZWFucyB3ZSBjYW4ndCBzdXBwb3J0IGxpdmUKKwkgKiBtaWdyYXRpb24sIHZob3N0IGRldmljZSBz
dGFydC9zdG9wLgorCSAqLworCisJcmV0dXJuIC1FTk9UU1VQUDsKK30KKworc3RhdGljIHZvaWQg
dnBfdmRwYV9zZXRfdnFfY2Ioc3RydWN0IHZkcGFfZGV2aWNlICp2ZHBhLCB1MTYgcWlkLAorCQkJ
ICAgICAgc3RydWN0IHZkcGFfY2FsbGJhY2sgKmNiKQoreworCXN0cnVjdCB2cF92ZHBhICp2cF92
ZHBhID0gdmRwYV90b192cCh2ZHBhKTsKKworCXZwX3ZkcGEtPnZyaW5nW3FpZF0uY2IgPSAqY2I7
Cit9CisKK3N0YXRpYyB2b2lkIHZwX3ZkcGFfc2V0X3ZxX3JlYWR5KHN0cnVjdCB2ZHBhX2Rldmlj
ZSAqdmRwYSwKKwkJCQkgdTE2IHFpZCwgYm9vbCByZWFkeSkKK3sKKwlzdHJ1Y3QgdnBfdmRwYSAq
dnBfdmRwYSA9IHZkcGFfdG9fdnAodmRwYSk7CisKKwl2cF9pb3dyaXRlMTYocWlkLCAmdnBfdmRw
YS0+Y29tbW9uLT5xdWV1ZV9zZWxlY3QpOworCXZwX2lvd3JpdGUxNihyZWFkeSwgJnZwX3ZkcGEt
PmNvbW1vbi0+cXVldWVfZW5hYmxlKTsKK30KKworc3RhdGljIGJvb2wgdnBfdmRwYV9nZXRfdnFf
cmVhZHkoc3RydWN0IHZkcGFfZGV2aWNlICp2ZHBhLCB1MTYgcWlkKQoreworCXN0cnVjdCB2cF92
ZHBhICp2cF92ZHBhID0gdmRwYV90b192cCh2ZHBhKTsKKworCXZwX2lvd3JpdGUxNihxaWQsICZ2
cF92ZHBhLT5jb21tb24tPnF1ZXVlX3NlbGVjdCk7CisKKwlyZXR1cm4gdnBfaW9yZWFkMTYoJnZw
X3ZkcGEtPmNvbW1vbi0+cXVldWVfZW5hYmxlKTsKK30KKworc3RhdGljIHZvaWQgdnBfdmRwYV9z
ZXRfdnFfbnVtKHN0cnVjdCB2ZHBhX2RldmljZSAqdmRwYSwgdTE2IHFpZCwKKwkJCSAgICAgICB1
MzIgbnVtKQoreworCXN0cnVjdCB2cF92ZHBhICp2cF92ZHBhID0gdmRwYV90b192cCh2ZHBhKTsK
KworCXZwX2lvd3JpdGUxNihudW0sICZ2cF92ZHBhLT5jb21tb24tPnF1ZXVlX3NpemUpOworfQor
CitzdGF0aWMgaW50IHZwX3ZkcGFfc2V0X3ZxX2FkZHJlc3Moc3RydWN0IHZkcGFfZGV2aWNlICp2
ZHBhLCB1MTYgcWlkLAorCQkJCSAgdTY0IGRlc2NfYXJlYSwgdTY0IGRyaXZlcl9hcmVhLAorCQkJ
CSAgdTY0IGRldmljZV9hcmVhKQoreworCXN0cnVjdCB2cF92ZHBhICp2cF92ZHBhID0gdmRwYV90
b192cCh2ZHBhKTsKKwlzdHJ1Y3QgdmlydGlvX3BjaV9jb21tb25fY2ZnIF9faW9tZW0gKmNmZyA9
IHZwX3ZkcGEtPmNvbW1vbjsKKworCXZwX2lvd3JpdGUxNihxaWQsICZjZmctPnF1ZXVlX3NlbGVj
dCk7CisJdnBfaW93cml0ZTY0X3R3b3BhcnQoZGVzY19hcmVhLAorCQkJICAgICAmY2ZnLT5xdWV1
ZV9kZXNjX2xvLCAmY2ZnLT5xdWV1ZV9kZXNjX2hpKTsKKwl2cF9pb3dyaXRlNjRfdHdvcGFydChk
cml2ZXJfYXJlYSwKKwkJCSAgICAgJmNmZy0+cXVldWVfYXZhaWxfbG8sICZjZmctPnF1ZXVlX2F2
YWlsX2hpKTsKKwl2cF9pb3dyaXRlNjRfdHdvcGFydChkZXZpY2VfYXJlYSwKKwkJCSAgICAgJmNm
Zy0+cXVldWVfdXNlZF9sbywgJmNmZy0+cXVldWVfdXNlZF9oaSk7CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIHZvaWQgdnBfdmRwYV9raWNrX3ZxKHN0cnVjdCB2ZHBhX2RldmljZSAqdmRwYSwg
dTE2IHFpZCkKK3sKKwlzdHJ1Y3QgdnBfdmRwYSAqdnBfdmRwYSA9IHZkcGFfdG9fdnAodmRwYSk7
CisKKwl2cF9pb3dyaXRlMTYocWlkLCB2cF92ZHBhLT52cmluZ1txaWRdLm5vdGlmeSk7Cit9CisK
K3N0YXRpYyB1MzIgdnBfdmRwYV9nZXRfZ2VuZXJhdGlvbihzdHJ1Y3QgdmRwYV9kZXZpY2UgKnZk
cGEpCit7CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3RvX3ZwKHZkcGEpOworCisJ
cmV0dXJuIHZwX2lvcmVhZDgoJnZwX3ZkcGEtPmNvbW1vbi0+Y29uZmlnX2dlbmVyYXRpb24pOwor
fQorCitzdGF0aWMgdTMyIHZwX3ZkcGFfZ2V0X2RldmljZV9pZChzdHJ1Y3QgdmRwYV9kZXZpY2Ug
KnZkcGEpCit7CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3RvX3ZwKHZkcGEpOwor
CisJcmV0dXJuIHZwX3ZkcGEtPmlkLmRldmljZTsKK30KKworc3RhdGljIHUzMiB2cF92ZHBhX2dl
dF92ZW5kb3JfaWQoc3RydWN0IHZkcGFfZGV2aWNlICp2ZHBhKQoreworCXN0cnVjdCB2cF92ZHBh
ICp2cF92ZHBhID0gdmRwYV90b192cCh2ZHBhKTsKKworCXJldHVybiB2cF92ZHBhLT5pZC52ZW5k
b3I7Cit9CisKK3N0YXRpYyB1MzIgdnBfdmRwYV9nZXRfdnFfYWxpZ24oc3RydWN0IHZkcGFfZGV2
aWNlICp2ZHBhKQoreworCXJldHVybiBQQUdFX1NJWkU7Cit9CisKK3N0YXRpYyB2b2lkIHZwX3Zk
cGFfZ2V0X2NvbmZpZyhzdHJ1Y3QgdmRwYV9kZXZpY2UgKnZkcGEsCisJCQkgICAgICAgdW5zaWdu
ZWQgaW50IG9mZnNldCwKKwkJCSAgICAgICB2b2lkICpidWYsIHVuc2lnbmVkIGludCBsZW4pCit7
CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3RvX3ZwKHZkcGEpOworCXU4IG9sZCwg
bmV3OworCXU4ICpwOworCWludCBpOworCisJZG8geworCQlvbGQgPSB2cF9pb3JlYWQ4KCZ2cF92
ZHBhLT5jb21tb24tPmNvbmZpZ19nZW5lcmF0aW9uKTsKKwkJcCA9IGJ1ZjsKKwkJZm9yIChpID0g
MDsgaSA8IGxlbjsgaSsrKQorCQkJKnArKyA9IHZwX2lvcmVhZDgodnBfdmRwYS0+ZGV2aWNlICsg
b2Zmc2V0ICsgaSk7CisKKwkJbmV3ID0gdnBfaW9yZWFkOCgmdnBfdmRwYS0+Y29tbW9uLT5jb25m
aWdfZ2VuZXJhdGlvbik7CisJfSB3aGlsZSAob2xkICE9IG5ldyk7Cit9CisKK3N0YXRpYyB2b2lk
IHZwX3ZkcGFfc2V0X2NvbmZpZyhzdHJ1Y3QgdmRwYV9kZXZpY2UgKnZkcGEsCisJCQkgICAgICAg
dW5zaWduZWQgaW50IG9mZnNldCwgY29uc3Qgdm9pZCAqYnVmLAorCQkJICAgICAgIHVuc2lnbmVk
IGludCBsZW4pCit7CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3RvX3ZwKHZkcGEp
OworCWNvbnN0IHU4ICpwID0gYnVmOworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IGxlbjsg
aSsrKQorCQl2cF9pb3dyaXRlOCgqcCsrLCB2cF92ZHBhLT5kZXZpY2UgKyBvZmZzZXQgKyBpKTsK
K30KKworc3RhdGljIHZvaWQgdnBfdmRwYV9zZXRfY29uZmlnX2NiKHN0cnVjdCB2ZHBhX2Rldmlj
ZSAqdmRwYSwKKwkJCQkgIHN0cnVjdCB2ZHBhX2NhbGxiYWNrICpjYikKK3sKKwkvKiBXZSBkb24n
dCBzdXBwb3J0IGNvbmZpZyBpbnRlcnJ1cHQgKi8KK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCB2
ZHBhX2NvbmZpZ19vcHMgdnBfdmRwYV9vcHMgPSB7CisJLmdldF9mZWF0dXJlcwk9IHZwX3ZkcGFf
Z2V0X2ZlYXR1cmVzLAorCS5zZXRfZmVhdHVyZXMJPSB2cF92ZHBhX3NldF9mZWF0dXJlcywKKwku
Z2V0X3N0YXR1cwk9IHZwX3ZkcGFfZ2V0X3N0YXR1cywKKwkuc2V0X3N0YXR1cwk9IHZwX3ZkcGFf
c2V0X3N0YXR1cywKKwkuZ2V0X3ZxX251bV9tYXgJPSB2cF92ZHBhX2dldF92cV9udW1fbWF4LAor
CS5nZXRfdnFfc3RhdGUJPSB2cF92ZHBhX2dldF92cV9zdGF0ZSwKKwkuc2V0X3ZxX3N0YXRlCT0g
dnBfdmRwYV9zZXRfdnFfc3RhdGUsCisJLnNldF92cV9jYgk9IHZwX3ZkcGFfc2V0X3ZxX2NiLAor
CS5zZXRfdnFfcmVhZHkJPSB2cF92ZHBhX3NldF92cV9yZWFkeSwKKwkuZ2V0X3ZxX3JlYWR5CT0g
dnBfdmRwYV9nZXRfdnFfcmVhZHksCisJLnNldF92cV9udW0JPSB2cF92ZHBhX3NldF92cV9udW0s
CisJLnNldF92cV9hZGRyZXNzCT0gdnBfdmRwYV9zZXRfdnFfYWRkcmVzcywKKwkua2lja192cQk9
IHZwX3ZkcGFfa2lja192cSwKKwkuZ2V0X2dlbmVyYXRpb24JPSB2cF92ZHBhX2dldF9nZW5lcmF0
aW9uLAorCS5nZXRfZGV2aWNlX2lkCT0gdnBfdmRwYV9nZXRfZGV2aWNlX2lkLAorCS5nZXRfdmVu
ZG9yX2lkCT0gdnBfdmRwYV9nZXRfdmVuZG9yX2lkLAorCS5nZXRfdnFfYWxpZ24JPSB2cF92ZHBh
X2dldF92cV9hbGlnbiwKKwkuZ2V0X2NvbmZpZwk9IHZwX3ZkcGFfZ2V0X2NvbmZpZywKKwkuc2V0
X2NvbmZpZwk9IHZwX3ZkcGFfc2V0X2NvbmZpZywKKwkuc2V0X2NvbmZpZ19jYiAgPSB2cF92ZHBh
X3NldF9jb25maWdfY2IsCit9OworCitzdGF0aWMgaW50IHZwX3ZkcGFfcHJvYmUoc3RydWN0IHBj
aV9kZXYgKnBkZXYsIGNvbnN0IHN0cnVjdCBwY2lfZGV2aWNlX2lkICppZCkKK3sKKwlzdHJ1Y3Qg
ZGV2aWNlICpkZXYgPSAmcGRldi0+ZGV2OworCXN0cnVjdCB2cF92ZHBhICp2cF92ZHBhOworCWlu
dCBjb21tb24sIG5vdGlmeSwgZGV2aWNlLCByZXQsIGk7CisJc3RydWN0IHZpcnRpb19kZXZpY2Vf
aWQgdmlydGlvX2lkOworCXUxNiBub3RpZnlfb2ZmOworCisJLyogV2Ugb25seSBvd24gZGV2aWNl
cyA+PSAweDEwMDAgYW5kIDw9IDB4MTA3ZjogbGVhdmUgdGhlIHJlc3QuICovCisJaWYgKHBkZXYt
PmRldmljZSA8IDB4MTAwMCB8fCBwZGV2LT5kZXZpY2UgPiAweDEwN2YpCisJCXJldHVybiAtRU5P
REVWOworCisJaWYgKHBkZXYtPmRldmljZSA8IDB4MTA0MCkgeworCQkvKiBUcmFuc2l0aW9uYWwg
ZGV2aWNlczogdXNlIHRoZSBQQ0kgc3Vic3lzdGVtIGRldmljZSBpZCBhcworCQkgKiB2aXJ0aW8g
ZGV2aWNlIGlkLCBzYW1lIGFzIGxlZ2FjeSBkcml2ZXIgYWx3YXlzIGRpZC4KKwkJICovCisJCXZp
cnRpb19pZC5kZXZpY2UgPSBwZGV2LT5zdWJzeXN0ZW1fZGV2aWNlOworCX0gZWxzZSB7CisJCS8q
IE1vZGVybiBkZXZpY2VzOiBzaW1wbHkgdXNlIFBDSSBkZXZpY2UgaWQsIGJ1dCBzdGFydCBmcm9t
IDB4MTA0MC4gKi8KKwkJdmlydGlvX2lkLmRldmljZSA9IHBkZXYtPmRldmljZSAtIDB4MTA0MDsK
Kwl9CisJdmlydGlvX2lkLnZlbmRvciA9IHBkZXYtPnN1YnN5c3RlbV92ZW5kb3I7CisKKwlyZXQg
PSBwY2ltX2VuYWJsZV9kZXZpY2UocGRldik7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKGRldiwg
InZwX3ZkcGE6IEZhaWwgdG8gZW5hYmxlIFBDSSBkZXZpY2VcbiIpOworCQlyZXR1cm4gcmV0Owor
CX0KKworCXZwX3ZkcGEgPSB2ZHBhX2FsbG9jX2RldmljZShzdHJ1Y3QgdnBfdmRwYSwgdmRwYSwK
KwkJCQkgICAgZGV2LCAmdnBfdmRwYV9vcHMpOworCWlmICh2cF92ZHBhID09IE5VTEwpIHsKKwkJ
ZGV2X2VycihkZXYsICJ2cF92ZHBhOiBGYWlsZWQgdG8gYWxsb2NhdGUgdkRQQSBzdHJ1Y3R1cmVc
biIpOworCQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwlwY2lfc2V0X21hc3RlcihwZGV2KTsKKwlw
Y2lfc2V0X2RydmRhdGEocGRldiwgdnBfdmRwYSk7CisKKwl2cF92ZHBhLT5wZGV2ID0gcGRldjsK
Kwl2cF92ZHBhLT52ZHBhLmRtYV9kZXYgPSAmcGRldi0+ZGV2OworCisJY29tbW9uID0gZmluZF9j
YXBhYmlsaXR5KHBkZXYsIFZJUlRJT19QQ0lfQ0FQX0NPTU1PTl9DRkcsCisJCQkJIElPUkVTT1VS
Q0VfSU8gfCBJT1JFU09VUkNFX01FTSwKKwkJCQkgJnZwX3ZkcGEtPm1vZGVybl9iYXJzKTsKKwlp
ZiAoIWNvbW1vbikgeworCQlkZXZfZXJyKCZwZGV2LT5kZXYsCisJCQkidnBfdmRwYTogbGVnYWN5
IGRldmljZSBpcyBub3Qgc3VwcG9ydGVkXG4iKTsKKwkJcmV0ID0gLUVOT0RFVjsKKwkJZ290byBl
cnI7CisJfQorCisJbm90aWZ5ID0gZmluZF9jYXBhYmlsaXR5KHBkZXYsIFZJUlRJT19QQ0lfQ0FQ
X05PVElGWV9DRkcsCisJCQkJIElPUkVTT1VSQ0VfSU8gfCBJT1JFU09VUkNFX01FTSwKKwkJCQkg
JnZwX3ZkcGEtPm1vZGVybl9iYXJzKTsKKwlpZiAoIW5vdGlmeSkgeworCQlkZXZfZXJyKCZwZGV2
LT5kZXYsCisJCQkidnBfdmRwYTogbWlzc2luZyBub3RpZmljYXRpb24gY2FwYWJpbGl0aWVzXG4i
KTsKKwkJcmV0ID0gLUVJTlZBTDsKKwkJZ290byBlcnI7CisJfQorCisJZGV2aWNlID0gZmluZF9j
YXBhYmlsaXR5KHBkZXYsIFZJUlRJT19QQ0lfQ0FQX0RFVklDRV9DRkcsCisJCQkJIElPUkVTT1VS
Q0VfSU8gfCBJT1JFU09VUkNFX01FTSwKKwkJCQkgJnZwX3ZkcGEtPm1vZGVybl9iYXJzKTsKKwlp
ZiAoIWRldmljZSkgeworCQlkZXZfZXJyKCZwZGV2LT5kZXYsCisJCQkidnBfdmRwYTogbWlzc2lu
ZyBkZXZpY2UgY2FwYWJpbGl0aWVzXG4iKTsKKwkJcmV0ID0gLUVJTlZBTDsKKwkJZ290byBlcnI7
CisJfQorCisJcmV0ID0gcGNpbV9pb21hcF9yZWdpb25zKHBkZXYsIHZwX3ZkcGEtPm1vZGVybl9i
YXJzLAorCQkJCSBWUF9WRFBBX0RSSVZFUl9OQU1FKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycjsK
KworCXZwX3ZkcGEtPmJhc2UgPSBwY2ltX2lvbWFwX3RhYmxlKHBkZXYpOworCisJcmV0ID0gZG1h
X3NldF9tYXNrX2FuZF9jb2hlcmVudCgmcGRldi0+ZGV2LCBETUFfQklUX01BU0soNjQpKTsKKwlp
ZiAocmV0KQorCQlyZXQgPSBkbWFfc2V0X21hc2tfYW5kX2NvaGVyZW50KCZwZGV2LT5kZXYsCisJ
CQkJCQlETUFfQklUX01BU0soMzIpKTsKKwlpZiAocmV0KQorCQlkZXZfd2FybigmcGRldi0+ZGV2
LCAiRmFpbGVkIHRvIGVuYWJsZSA2NC1iaXQgb3IgMzItYml0IERNQS4gIFRyeWluZyB0byBjb250
aW51ZSwgYnV0IHRoaXMgbWlnaHQgbm90IHdvcmsuXG4iKTsKKworCXZwX3ZkcGEtPmRldmljZSA9
IG1hcF9jYXBhYmlsaXR5KHZwX3ZkcGEsIGRldmljZSk7CisJdnBfdmRwYS0+bm90aWZ5ID0gbWFw
X2NhcGFiaWxpdHkodnBfdmRwYSwgbm90aWZ5KTsKKwl2cF92ZHBhLT5jb21tb24gPSBtYXBfY2Fw
YWJpbGl0eSh2cF92ZHBhLCBjb21tb24pOworCXZwX3ZkcGEtPmlkID0gdmlydGlvX2lkOworCisJ
cmV0ID0gdmRwYV9yZWdpc3Rlcl9kZXZpY2UoJnZwX3ZkcGEtPnZkcGEpOworCWlmIChyZXQpIHsK
KwkJZGV2X2VycigmcGRldi0+ZGV2LCAiRmFpbGVkIHRvIHJlZ2lzdGVyIHRvIHZkcGEgYnVzXG4i
KTsKKwkJZ290byBlcnI7CisJfQorCisJcGNpX3JlYWRfY29uZmlnX2R3b3JkKHBkZXYsIG5vdGlm
eSArIHNpemVvZihzdHJ1Y3QgdmlydGlvX3BjaV9jYXApLAorCQkJICAgICAgJnZwX3ZkcGEtPm5v
dGlmeV9vZmZfbXVsdGlwbGllcik7CisKKwlmb3IgKGkgPSAwOyBpIDwgVlBfVkRQQV9NQVhfUVVF
VUU7IGkrKykgeworCQl2cF9pb3dyaXRlMTYoaSwgJnZwX3ZkcGEtPmNvbW1vbi0+cXVldWVfc2Vs
ZWN0KTsKKwkJbm90aWZ5X29mZiA9IHZwX2lvcmVhZDE2KCZ2cF92ZHBhLT5jb21tb24tPnF1ZXVl
X25vdGlmeV9vZmYpOworCQl2cF92ZHBhLT52cmluZ1tpXS5pcnEgPSAtMTsKKwkJdnBfdmRwYS0+
dnJpbmdbaV0ubm90aWZ5ID0gdnBfdmRwYS0+bm90aWZ5ICsKKwkJCW5vdGlmeV9vZmYgKiB2cF92
ZHBhLT5ub3RpZnlfb2ZmX211bHRpcGxpZXI7CisJfQorCisJcmV0dXJuIDA7CisKK2VycjoKKwlw
dXRfZGV2aWNlKCZ2cF92ZHBhLT52ZHBhLmRldik7CisJcmV0dXJuIHJldDsKK30KKworc3RhdGlj
IHZvaWQgdnBfdmRwYV9yZW1vdmUoc3RydWN0IHBjaV9kZXYgKnBkZXYpCit7CisJc3RydWN0IHZw
X3ZkcGEgKnZwX3ZkcGEgPSBwY2lfZ2V0X2RydmRhdGEocGRldik7CisKKwl2ZHBhX3VucmVnaXN0
ZXJfZGV2aWNlKCZ2cF92ZHBhLT52ZHBhKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBwY2lf
ZGV2aWNlX2lkIHZwX3ZkcGFfaWRfdGFibGVbXSA9IHsKKwl7IFBDSV9ERVZJQ0UoUENJX1ZFTkRP
Ul9JRF9SRURIQVRfUVVNUkFORVQsIFBDSV9BTllfSUQpIH0sCisJeyAwIH0KK307CisKK01PRFVM
RV9ERVZJQ0VfVEFCTEUocGNpLCB2cF92ZHBhX2lkX3RhYmxlKTsKKworc3RhdGljIHN0cnVjdCBw
Y2lfZHJpdmVyIHZwX3ZkcGFfZHJpdmVyID0geworCS5uYW1lCQk9ICJ2cC12ZHBhIiwKKwkuaWRf
dGFibGUJPSB2cF92ZHBhX2lkX3RhYmxlLAorCS5wcm9iZQkJPSB2cF92ZHBhX3Byb2JlLAorCS5y
ZW1vdmUJCT0gdnBfdmRwYV9yZW1vdmUsCit9OworCittb2R1bGVfcGNpX2RyaXZlcih2cF92ZHBh
X2RyaXZlcik7CisKK01PRFVMRV9BVVRIT1IoIkphc29uIFdhbmcgPGphc293YW5nQHJlZGhhdC5j
b20+Iik7CitNT0RVTEVfREVTQ1JJUFRJT04oInZwLXZkcGEiKTsKK01PRFVMRV9MSUNFTlNFKCJH
UEwiKTsKK01PRFVMRV9WRVJTSU9OKCIxIik7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlz
dApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3Rz
LmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
