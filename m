Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from mail.linuxfoundation.org (mail.linuxfoundation.org [140.211.169.12])
	by mail.lfdr.de (Postfix) with ESMTPS id 99641BFDBA
	for <lists.virtualization@lfdr.de>; Fri, 27 Sep 2019 05:46:30 +0200 (CEST)
Received: from mail.linux-foundation.org (localhost [127.0.0.1])
	by mail.linuxfoundation.org (Postfix) with ESMTP id 1D68CF3C;
	Fri, 27 Sep 2019 03:46:24 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@mail.linuxfoundation.org
Received: from smtp1.linuxfoundation.org (smtp1.linux-foundation.org
	[172.17.192.35])
	by mail.linuxfoundation.org (Postfix) with ESMTPS id F1F68E47
	for <virtualization@lists.linux-foundation.org>;
	Fri, 27 Sep 2019 03:46:22 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
	by smtp1.linuxfoundation.org (Postfix) with ESMTPS id DC21F8A
	for <virtualization@lists.linux-foundation.org>;
	Fri, 27 Sep 2019 03:46:21 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
	[10.5.11.16])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mx1.redhat.com (Postfix) with ESMTPS id E3C1712A2;
	Fri, 27 Sep 2019 03:46:20 +0000 (UTC)
Received: from [10.72.12.160] (ovpn-12-160.pek2.redhat.com [10.72.12.160])
	by smtp.corp.redhat.com (Postfix) with ESMTP id 05D7F5C21F;
	Fri, 27 Sep 2019 03:46:08 +0000 (UTC)
Subject: Re: [PATCH] vhost: introduce mdev based hardware backend
To: Tiwei Bie <tiwei.bie@intel.com>, mst@redhat.com,
	alex.williamson@redhat.com, maxime.coquelin@redhat.com
References: <20190926045427.4973-1-tiwei.bie@intel.com>
From: Jason Wang <jasowang@redhat.com>
Message-ID: <1b4b8891-8c14-1c85-1d6a-2eed1c90bcde@redhat.com>
Date: Fri, 27 Sep 2019 11:46:06 +0800
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
	Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190926045427.4973-1-tiwei.bie@intel.com>
Content-Language: en-US
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
	(mx1.redhat.com [10.5.110.29]);
	Fri, 27 Sep 2019 03:46:21 +0000 (UTC)
X-Spam-Status: No, score=-6.9 required=5.0 tests=BAYES_00,RCVD_IN_DNSWL_HI
	autolearn=ham version=3.3.1
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on
	smtp1.linux-foundation.org
Cc: kvm@vger.kernel.org, netdev@vger.kernel.org, linux-kernel@vger.kernel.org,
	virtualization@lists.linux-foundation.org,
	zhihong.wang@intel.com, lingshan.zhu@intel.com
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.12
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>,
	<mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Sender: virtualization-bounces@lists.linux-foundation.org
Errors-To: virtualization-bounces@lists.linux-foundation.org

Ck9uIDIwMTkvOS8yNiDkuIvljYgxMjo1NCwgVGl3ZWkgQmllIHdyb3RlOgo+IFRoaXMgcGF0Y2gg
aW50cm9kdWNlcyBhIG1kZXYgYmFzZWQgaGFyZHdhcmUgdmhvc3QgYmFja2VuZC4KPiBUaGlzIGJh
Y2tlbmQgaXMgYnVpbHQgb24gdG9wIG9mIHRoZSBzYW1lIGFic3RyYWN0aW9uIHVzZWQKPiBpbiB2
aXJ0aW8tbWRldiBhbmQgcHJvdmlkZXMgYSBnZW5lcmljIHZob3N0IGludGVyZmFjZSBmb3IKPiB1
c2Vyc3BhY2UgdG8gYWNjZWxlcmF0ZSB0aGUgdmlydGlvIGRldmljZXMgaW4gZ3Vlc3QuCj4KPiBU
aGlzIGJhY2tlbmQgaXMgaW1wbGVtZW50ZWQgYXMgYSBtZGV2IGRldmljZSBkcml2ZXIgb24gdG9w
Cj4gb2YgdGhlIHNhbWUgbWRldiBkZXZpY2Ugb3BzIHVzZWQgaW4gdmlydGlvLW1kZXYgYnV0IHVz
aW5nCj4gYSBkaWZmZXJlbnQgbWRldiBjbGFzcyBpZCwgYW5kIGl0IHdpbGwgcmVnaXN0ZXIgdGhl
IGRldmljZQo+IGFzIGEgVkZJTyBkZXZpY2UgZm9yIHVzZXJzcGFjZSB0byB1c2UuIFVzZXJzcGFj
ZSBjYW4gc2V0dXAKPiB0aGUgSU9NTVUgd2l0aCB0aGUgZXhpc3RpbmcgVkZJTyBjb250YWluZXIv
Z3JvdXAgQVBJcyBhbmQKPiB0aGVuIGdldCB0aGUgZGV2aWNlIGZkIHdpdGggdGhlIGRldmljZSBu
YW1lLiBBZnRlciBnZXR0aW5nCj4gdGhlIGRldmljZSBmZCBvZiB0aGlzIGRldmljZSwgdXNlcnNw
YWNlIGNhbiB1c2Ugdmhvc3QgaW9jdGxzCj4gdG8gc2V0dXAgdGhlIGJhY2tlbmQuCj4KPiBTaWdu
ZWQtb2ZmLWJ5OiBUaXdlaSBCaWUgPHRpd2VpLmJpZUBpbnRlbC5jb20+Cj4gLS0tCj4gVGhpcyBw
YXRjaCBkZXBlbmRzIG9uIGJlbG93IHNlcmllczoKPiBodHRwczovL2xrbWwub3JnL2xrbWwvMjAx
OS85LzI0LzM1NwoKCkxvb2tzIHByZXR0eSBuaWNlLCBjb21tZW50cyBpbmxpbmUuCgoKPgo+IFJG
QyB2NCAtPiB2MToKPiAtIEltcGxlbWVudCB2aG9zdC1tZGV2IGFzIGEgbWRldiBkZXZpY2UgZHJp
dmVyIGRpcmVjdGx5IGFuZAo+ICAgIGNvbm5lY3QgaXQgdG8gVkZJTyBjb250YWluZXIvZ3JvdXAu
IChKYXNvbik7Cj4gLSBQYXNzIHJpbmcgYWRkcmVzc2VzIGFzIEdQQXMvSU9WQXMgaW4gdmhvc3Qt
bWRldiB0byBhdm9pZAo+ICAgIG1lYW5pbmdsZXNzIEhWQS0+R1BBIHRyYW5zbGF0aW9ucyAoSmFz
b24pOwo+Cj4gUkZDIHYzIC0+IFJGQyB2NDoKPiAtIEJ1aWxkIHZob3N0LW1kZXYgb24gdG9wIG9m
IHRoZSBzYW1lIGFic3RyYWN0aW9uIHVzZWQgYnkKPiAgICB2aXJ0aW8tbWRldiAoSmFzb24pOwo+
IC0gSW50cm9kdWNlIHZob3N0IGZkIGFuZCBwYXNzIFZGSU8gZmQgdmlhIFNFVF9CQUNLRU5EIGlv
Y3RsIChNU1QpOwo+Cj4gUkZDIHYyIC0+IFJGQyB2MzoKPiAtIFJldXNlIHZob3N0J3MgaW9jdGxz
IGluc3RlYWQgb2YgaW52ZW50aW5nIGEgVkZJTyByZWdpb25zL2lycXMKPiAgICBiYXNlZCB2aG9z
dCBwcm90b2NvbCBvbiB0b3Agb2YgdmZpby1tZGV2IChKYXNvbik7Cj4KPiBSRkMgdjEgLT4gUkZD
IHYyOgo+IC0gSW50cm9kdWNlIGEgbmV3IFZGSU8gZGV2aWNlIHR5cGUgdG8gYnVpbGQgYSB2aG9z
dCBwcm90b2NvbAo+ICAgIG9uIHRvcCBvZiB2ZmlvLW1kZXY7Cj4KPiAgIGRyaXZlcnMvdmhvc3Qv
S2NvbmZpZyAgICAgIHwgICA5ICsKPiAgIGRyaXZlcnMvdmhvc3QvTWFrZWZpbGUgICAgIHwgICAz
ICsKPiAgIGRyaXZlcnMvdmhvc3QvbWRldi5jICAgICAgIHwgMzgxICsrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysKPiAgIGluY2x1ZGUvdWFwaS9saW51eC92aG9zdC5oIHwgICA4
ICsKPiAgIDQgZmlsZXMgY2hhbmdlZCwgNDAxIGluc2VydGlvbnMoKykKPiAgIGNyZWF0ZSBtb2Rl
IDEwMDY0NCBkcml2ZXJzL3Zob3N0L21kZXYuYwo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmhv
c3QvS2NvbmZpZyBiL2RyaXZlcnMvdmhvc3QvS2NvbmZpZwo+IGluZGV4IDNkMDNjY2JkMWFkYy4u
ZGVjZjBiZThlZmU5IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvdmhvc3QvS2NvbmZpZwo+ICsrKyBi
L2RyaXZlcnMvdmhvc3QvS2NvbmZpZwo+IEBAIC0zNCw2ICszNCwxNSBAQCBjb25maWcgVkhPU1Rf
VlNPQ0sKPiAgIAlUbyBjb21waWxlIHRoaXMgZHJpdmVyIGFzIGEgbW9kdWxlLCBjaG9vc2UgTSBo
ZXJlOiB0aGUgbW9kdWxlIHdpbGwgYmUgY2FsbGVkCj4gICAJdmhvc3RfdnNvY2suCj4gICAKPiAr
Y29uZmlnIFZIT1NUX01ERVYKPiArCXRyaXN0YXRlICJWaG9zdCBkcml2ZXIgZm9yIE1lZGlhdGVk
IGRldmljZXMiCj4gKwlkZXBlbmRzIG9uIEVWRU5URkQgJiYgVkZJTyAmJiBWRklPX01ERVYKPiAr
CXNlbGVjdCBWSE9TVAo+ICsJZGVmYXVsdCBuCj4gKwktLS1oZWxwLS0tCj4gKwlTYXkgTSBoZXJl
IHRvIGVuYWJsZSB0aGUgdmhvc3RfbWRldiBtb2R1bGUgZm9yIHVzZSB3aXRoCj4gKwl0aGUgbWVk
aWF0ZWQgZGV2aWNlIGJhc2VkIGhhcmR3YXJlIHZob3N0IGFjY2VsZXJhdG9ycwo+ICsKPiAgIGNv
bmZpZyBWSE9TVAo+ICAgCXRyaXN0YXRlCj4gICAJLS0taGVscC0tLQo+IGRpZmYgLS1naXQgYS9k
cml2ZXJzL3Zob3N0L01ha2VmaWxlIGIvZHJpdmVycy92aG9zdC9NYWtlZmlsZQo+IGluZGV4IDZj
NmRmMjRmNzcwYy4uYWQ5YzBmOGM2ZDhjIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvdmhvc3QvTWFr
ZWZpbGUKPiArKysgYi9kcml2ZXJzL3Zob3N0L01ha2VmaWxlCj4gQEAgLTEwLDQgKzEwLDcgQEAg
dmhvc3RfdnNvY2steSA6PSB2c29jay5vCj4gICAKPiAgIG9iai0kKENPTkZJR19WSE9TVF9SSU5H
KSArPSB2cmluZ2gubwo+ICAgCj4gK29iai0kKENPTkZJR19WSE9TVF9NREVWKSArPSB2aG9zdF9t
ZGV2Lm8KPiArdmhvc3RfbWRldi15IDo9IG1kZXYubwo+ICsKPiAgIG9iai0kKENPTkZJR19WSE9T
VCkJKz0gdmhvc3Qubwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL3Zob3N0L21kZXYuYyBiL2RyaXZl
cnMvdmhvc3QvbWRldi5jCj4gbmV3IGZpbGUgbW9kZSAxMDA2NDQKPiBpbmRleCAwMDAwMDAwMDAw
MDAuLjFjMTJhMjViODZhMgo+IC0tLSAvZGV2L251bGwKPiArKysgYi9kcml2ZXJzL3Zob3N0L21k
ZXYuYwo+IEBAIC0wLDAgKzEsMzgxIEBACj4gKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBH
UEwtMi4wCj4gKy8qCj4gKyAqIENvcHlyaWdodCAoQykgMjAxOC0yMDE5IEludGVsIENvcnBvcmF0
aW9uLgo+ICsgKi8KPiArCj4gKyNpbmNsdWRlIDxsaW51eC9jb21wYXQuaD4KPiArI2luY2x1ZGUg
PGxpbnV4L2tlcm5lbC5oPgo+ICsjaW5jbHVkZSA8bGludXgvbWlzY2RldmljZS5oPgo+ICsjaW5j
bHVkZSA8bGludXgvbWRldi5oPgo+ICsjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+Cj4gKyNpbmNs
dWRlIDxsaW51eC92ZmlvLmg+Cj4gKyNpbmNsdWRlIDxsaW51eC92aG9zdC5oPgo+ICsjaW5jbHVk
ZSA8bGludXgvdmlydGlvX21kZXYuaD4KPiArCj4gKyNpbmNsdWRlICJ2aG9zdC5oIgo+ICsKPiAr
c3RydWN0IHZob3N0X21kZXYgewo+ICsJLyogVGhlIGxvY2sgaXMgdG8gcHJvdGVjdCB0aGlzIHN0
cnVjdHVyZS4gKi8KPiArCXN0cnVjdCBtdXRleCBtdXRleDsKPiArCXN0cnVjdCB2aG9zdF9kZXYg
ZGV2Owo+ICsJc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnFzOwo+ICsJaW50IG52cXM7Cj4gKwl1
NjQgc3RhdGU7Cj4gKwl1NjQgZmVhdHVyZXM7Cj4gKwl1NjQgYWNrZWRfZmVhdHVyZXM7Cj4gKwli
b29sIG9wZW5lZDsKPiArCXN0cnVjdCBtZGV2X2RldmljZSAqbWRldjsKPiArfTsKPiArCj4gK3N0
YXRpYyB1OCBtZGV2X2dldF9zdGF0dXMoc3RydWN0IG1kZXZfZGV2aWNlICptZGV2KQo+ICt7Cj4g
Kwljb25zdCBzdHJ1Y3QgdmlydGlvX21kZXZfZGV2aWNlX29wcyAqb3BzID0gbWRldl9nZXRfZGV2
X29wcyhtZGV2KTsKPiArCj4gKwlyZXR1cm4gb3BzLT5nZXRfc3RhdHVzKG1kZXYpOwo+ICt9Cj4g
Kwo+ICtzdGF0aWMgdm9pZCBtZGV2X3NldF9zdGF0dXMoc3RydWN0IG1kZXZfZGV2aWNlICptZGV2
LCB1OCBzdGF0dXMpCj4gK3sKPiArCWNvbnN0IHN0cnVjdCB2aXJ0aW9fbWRldl9kZXZpY2Vfb3Bz
ICpvcHMgPSBtZGV2X2dldF9kZXZfb3BzKG1kZXYpOwo+ICsKPiArCXJldHVybiBvcHMtPnNldF9z
dGF0dXMobWRldiwgc3RhdHVzKTsKPiArfQo+ICsKPiArc3RhdGljIHZvaWQgbWRldl9hZGRfc3Rh
dHVzKHN0cnVjdCBtZGV2X2RldmljZSAqbWRldiwgdTggc3RhdHVzKQo+ICt7Cj4gKwlzdGF0dXMg
fD0gbWRldl9nZXRfc3RhdHVzKG1kZXYpOwo+ICsJbWRldl9zZXRfc3RhdHVzKG1kZXYsIHN0YXR1
cyk7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIG1kZXZfcmVzZXQoc3RydWN0IG1kZXZfZGV2aWNl
ICptZGV2KQo+ICt7Cj4gKwltZGV2X3NldF9zdGF0dXMobWRldiwgMCk7Cj4gK30KPiArCj4gK3N0
YXRpYyB2b2lkIGhhbmRsZV92cV9raWNrKHN0cnVjdCB2aG9zdF93b3JrICp3b3JrKQo+ICt7Cj4g
KwlzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3Qg
dmhvc3RfdmlydHF1ZXVlLAo+ICsJCQkJCQkgIHBvbGwud29yayk7Cj4gKwlzdHJ1Y3Qgdmhvc3Rf
bWRldiAqbSA9IGNvbnRhaW5lcl9vZih2cS0+ZGV2LCBzdHJ1Y3Qgdmhvc3RfbWRldiwgZGV2KTsK
PiArCWNvbnN0IHN0cnVjdCB2aXJ0aW9fbWRldl9kZXZpY2Vfb3BzICpvcHMgPSBtZGV2X2dldF9k
ZXZfb3BzKG0tPm1kZXYpOwo+ICsKPiArCW9wcy0+a2lja192cShtLT5tZGV2LCB2cSAtIG0tPnZx
cyk7Cj4gK30KPiArCj4gK3N0YXRpYyBpcnFyZXR1cm5fdCB2aG9zdF9tZGV2X3ZpcnRxdWV1ZV9j
Yih2b2lkICpwcml2YXRlKQo+ICt7Cj4gKwlzdHJ1Y3Qgdmhvc3RfdmlydHF1ZXVlICp2cSA9IHBy
aXZhdGU7Cj4gKwlzdHJ1Y3QgZXZlbnRmZF9jdHggKmNhbGxfY3R4ID0gdnEtPmNhbGxfY3R4Owo+
ICsKPiArCWlmIChjYWxsX2N0eCkKPiArCQlldmVudGZkX3NpZ25hbChjYWxsX2N0eCwgMSk7Cj4g
KwlyZXR1cm4gSVJRX0hBTkRMRUQ7Cj4gK30KPiArCj4gK3N0YXRpYyBsb25nIHZob3N0X21kZXZf
cmVzZXQoc3RydWN0IHZob3N0X21kZXYgKm0pCj4gK3sKPiArCXN0cnVjdCBtZGV2X2RldmljZSAq
bWRldiA9IG0tPm1kZXY7Cj4gKwo+ICsJbWRldl9yZXNldChtZGV2KTsKPiArCW1kZXZfYWRkX3N0
YXR1cyhtZGV2LCBWSVJUSU9fQ09ORklHX1NfQUNLTk9XTEVER0UpOwo+ICsJbWRldl9hZGRfc3Rh
dHVzKG1kZXYsIFZJUlRJT19DT05GSUdfU19EUklWRVIpOwo+ICsJcmV0dXJuIDA7Cj4gK30KPiAr
Cj4gK3N0YXRpYyBsb25nIHZob3N0X21kZXZfc3RhcnQoc3RydWN0IHZob3N0X21kZXYgKm0pCj4g
K3sKPiArCXN0cnVjdCBtZGV2X2RldmljZSAqbWRldiA9IG0tPm1kZXY7Cj4gKwljb25zdCBzdHJ1
Y3QgdmlydGlvX21kZXZfZGV2aWNlX29wcyAqb3BzID0gbWRldl9nZXRfZGV2X29wcyhtZGV2KTsK
PiArCXN0cnVjdCB2aXJ0aW9fbWRldl9jYWxsYmFjayBjYjsKPiArCXN0cnVjdCB2aG9zdF92aXJ0
cXVldWUgKnZxOwo+ICsJaW50IGlkeDsKPiArCj4gKwlvcHMtPnNldF9mZWF0dXJlcyhtZGV2LCBt
LT5hY2tlZF9mZWF0dXJlcyk7Cj4gKwo+ICsJbWRldl9hZGRfc3RhdHVzKG1kZXYsIFZJUlRJT19D
T05GSUdfU19GRUFUVVJFU19PSyk7Cj4gKwlpZiAoIShtZGV2X2dldF9zdGF0dXMobWRldikgJiBW
SVJUSU9fQ09ORklHX1NfRkVBVFVSRVNfT0spKQo+ICsJCWdvdG8gcmVzZXQ7Cj4gKwo+ICsJZm9y
IChpZHggPSAwOyBpZHggPCBtLT5udnFzOyBpZHgrKykgewo+ICsJCXZxID0gJm0tPnZxc1tpZHhd
Owo+ICsKPiArCQlpZiAoIXZxLT5kZXNjIHx8ICF2cS0+YXZhaWwgfHwgIXZxLT51c2VkKQo+ICsJ
CQlicmVhazsKPiArCj4gKwkJaWYgKG9wcy0+c2V0X3ZxX3N0YXRlKG1kZXYsIGlkeCwgdnEtPmxh
c3RfYXZhaWxfaWR4KSkKPiArCQkJZ290byByZXNldDsKCgpJZiB3ZSBkbyBzZXRfdnFfc3RhdGUo
KSBpbiBTRVRfVlJJTkdfQkFTRSwgd2Ugd29uJ3QgbmVlZCB0aGlzIHN0ZXAgaGVyZS4KCgo+ICsK
PiArCQkvKgo+ICsJCSAqIEluIHZob3N0LW1kZXYsIHVzZXJzcGFjZSBzaG91bGQgcGFzcyByaW5n
IGFkZHJlc3Nlcwo+ICsJCSAqIGluIGd1ZXN0IHBoeXNpY2FsIGFkZHJlc3NlcyB3aGVuIElPTU1V
IGlzIGRpc2FibGVkIG9yCj4gKwkJICogSU9WQXMgd2hlbiBJT01NVSBpcyBlbmFibGVkLgo+ICsJ
CSAqLwoKCkEgcXVlc3Rpb24gaGVyZSwgY29uc2lkZXIgd2UncmUgdXNpbmcgbm9pb21tdSBtb2Rl
LiBJZiBndWVzdCBwaHlzaWNhbCAKYWRkcmVzcyBpcyBwYXNzZWQgaGVyZSwgaG93IGNhbiBhIGRl
dmljZSB1c2UgdGhhdD8KCkkgYmVsaWV2ZSB5b3UgbWVhbnQgImhvc3QgcGh5c2ljYWwgYWRkcmVz
cyIgaGVyZT8gQW5kIGl0IGFsc28gaGF2ZSB0aGUgCmltcGxpY2F0aW9uIHRoYXQgdGhlIEhQQSBz
aG91bGQgYmUgY29udGludW91cyAoZS5nIHVzaW5nIGh1Z2V0bGJmcykuCgpUaGFua3MKCgo+ICsJ
CWlmIChvcHMtPnNldF92cV9hZGRyZXNzKG1kZXYsIGlkeCwgKHU2NCl2cS0+ZGVzYywKPiArCQkJ
CQkodTY0KXZxLT5hdmFpbCwgKHU2NCl2cS0+dXNlZCkpCj4gKwkJCWdvdG8gcmVzZXQ7Cj4gKwo+
ICsJCW9wcy0+c2V0X3ZxX251bShtZGV2LCBpZHgsIHZxLT5udW0pOwo+ICsKPiArCQljYi5jYWxs
YmFjayA9IHZob3N0X21kZXZfdmlydHF1ZXVlX2NiOwo+ICsJCWNiLnByaXZhdGUgPSB2cTsKPiAr
CQlvcHMtPnNldF92cV9jYihtZGV2LCBpZHgsICZjYik7Cj4gKwo+ICsJCW9wcy0+c2V0X3ZxX3Jl
YWR5KG1kZXYsIGlkeCwgMSk7Cj4gKwl9Cj4gKwo+ICsJbWRldl9hZGRfc3RhdHVzKG1kZXYsIFZJ
UlRJT19DT05GSUdfU19EUklWRVJfT0spOwo+ICsJaWYgKG1kZXZfZ2V0X3N0YXR1cyhtZGV2KSAm
IFZJUlRJT19DT05GSUdfU19ORUVEU19SRVNFVCkKPiArCQlnb3RvIHJlc2V0Owo+ICsJcmV0dXJu
IDA7Cj4gKwo+ICtyZXNldDoKPiArCXZob3N0X21kZXZfcmVzZXQobSk7Cj4gKwlyZXR1cm4gLUVO
T0RFVjsKPiArfQo+ICsKPiArc3RhdGljIGxvbmcgdmhvc3Rfc2V0X3N0YXRlKHN0cnVjdCB2aG9z
dF9tZGV2ICptLCB1NjQgX191c2VyICpzdGF0ZXApCj4gK3sKPiArCXU2NCBzdGF0ZTsKPiArCWxv
bmcgcjsKPiArCj4gKwlpZiAoY29weV9mcm9tX3VzZXIoJnN0YXRlLCBzdGF0ZXAsIHNpemVvZihz
dGF0ZSkpKQo+ICsJCXJldHVybiAtRUZBVUxUOwo+ICsKPiArCWlmIChzdGF0ZSA+PSBWSE9TVF9N
REVWX1NfTUFYKQo+ICsJCXJldHVybiAtRUlOVkFMOwo+ICsKPiArCWlmIChtLT5zdGF0ZSA9PSBz
dGF0ZSkKPiArCQlyZXR1cm4gMDsKPiArCj4gKwltLT5zdGF0ZSA9IHN0YXRlOwo+ICsKPiArCXN3
aXRjaCAobS0+c3RhdGUpIHsKPiArCWNhc2UgVkhPU1RfTURFVl9TX1JVTk5JTkc6Cj4gKwkJciA9
IHZob3N0X21kZXZfc3RhcnQobSk7Cj4gKwkJYnJlYWs7Cj4gKwljYXNlIFZIT1NUX01ERVZfU19T
VE9QUEVEOgo+ICsJCXIgPSB2aG9zdF9tZGV2X3Jlc2V0KG0pOwo+ICsJCWJyZWFrOwo+ICsJZGVm
YXVsdDoKPiArCQlyID0gLUVJTlZBTDsKPiArCQlicmVhazsKPiArCX0KPiArCj4gKwlyZXR1cm4g
cjsKPiArfQo+ICsKPiArc3RhdGljIGxvbmcgdmhvc3RfZ2V0X2ZlYXR1cmVzKHN0cnVjdCB2aG9z
dF9tZGV2ICptLCB1NjQgX191c2VyICpmZWF0dXJlcCkKPiArewo+ICsJaWYgKGNvcHlfdG9fdXNl
cihmZWF0dXJlcCwgJm0tPmZlYXR1cmVzLCBzaXplb2YobS0+ZmVhdHVyZXMpKSkKPiArCQlyZXR1
cm4gLUVGQVVMVDsKPiArCXJldHVybiAwOwo+ICt9Cj4gKwo+ICtzdGF0aWMgbG9uZyB2aG9zdF9z
ZXRfZmVhdHVyZXMoc3RydWN0IHZob3N0X21kZXYgKm0sIHU2NCBfX3VzZXIgKmZlYXR1cmVwKQo+
ICt7Cj4gKwl1NjQgZmVhdHVyZXM7Cj4gKwo+ICsJaWYgKGNvcHlfZnJvbV91c2VyKCZmZWF0dXJl
cywgZmVhdHVyZXAsIHNpemVvZihmZWF0dXJlcykpKQo+ICsJCXJldHVybiAtRUZBVUxUOwo+ICsK
PiArCWlmIChmZWF0dXJlcyAmIH5tLT5mZWF0dXJlcykKPiArCQlyZXR1cm4gLUVJTlZBTDsKPiAr
Cj4gKwltLT5hY2tlZF9mZWF0dXJlcyA9IGZlYXR1cmVzOwo+ICsKPiArCXJldHVybiAwOwo+ICt9
Cj4gKwo+ICtzdGF0aWMgbG9uZyB2aG9zdF9nZXRfdnJpbmdfYmFzZShzdHJ1Y3Qgdmhvc3RfbWRl
diAqbSwgdm9pZCBfX3VzZXIgKmFyZ3ApCj4gK3sKPiArCWNvbnN0IHN0cnVjdCB2aXJ0aW9fbWRl
dl9kZXZpY2Vfb3BzICpvcHMgPSBtZGV2X2dldF9kZXZfb3BzKG0tPm1kZXYpOwo+ICsJc3RydWN0
IHZob3N0X3ZpcnRxdWV1ZSAqdnE7Cj4gKwl1MzIgaWR4Owo+ICsJbG9uZyByOwo+ICsKPiArCXIg
PSBnZXRfdXNlcihpZHgsICh1MzIgX191c2VyICopYXJncCk7Cj4gKwlpZiAociA8IDApCj4gKwkJ
cmV0dXJuIHI7Cj4gKwlpZiAoaWR4ID49IG0tPm52cXMpCj4gKwkJcmV0dXJuIC1FTk9CVUZTOwo+
ICsKPiArCXZxID0gJm0tPnZxc1tpZHhdOwo+ICsJdnEtPmxhc3RfYXZhaWxfaWR4ID0gb3BzLT5n
ZXRfdnFfc3RhdGUobS0+bWRldiwgaWR4KTsKPiArCj4gKwlyZXR1cm4gdmhvc3RfdnJpbmdfaW9j
dGwoJm0tPmRldiwgVkhPU1RfR0VUX1ZSSU5HX0JBU0UsIGFyZ3ApOwo+ICt9Cj4gKwo+ICtzdGF0
aWMgaW50IHZob3N0X21kZXZfb3Blbih2b2lkICpkZXZpY2VfZGF0YSkKPiArewo+ICsJc3RydWN0
IHZob3N0X21kZXYgKm0gPSBkZXZpY2VfZGF0YTsKPiArCXN0cnVjdCB2aG9zdF9kZXYgKmRldjsK
PiArCXN0cnVjdCB2aG9zdF92aXJ0cXVldWUgKip2cXM7Cj4gKwlpbnQgbnZxcywgaSwgcjsKPiAr
Cj4gKwlpZiAoIXRyeV9tb2R1bGVfZ2V0KFRISVNfTU9EVUxFKSkKPiArCQlyZXR1cm4gLUVOT0RF
VjsKPiArCj4gKwltdXRleF9sb2NrKCZtLT5tdXRleCk7Cj4gKwo+ICsJaWYgKG0tPm9wZW5lZCkg
ewo+ICsJCXIgPSAtRUJVU1k7Cj4gKwkJZ290byBlcnI7Cj4gKwl9Cj4gKwo+ICsJbnZxcyA9IG0t
Pm52cXM7Cj4gKwl2aG9zdF9tZGV2X3Jlc2V0KG0pOwo+ICsKPiArCW1lbXNldCgmbS0+ZGV2LCAw
LCBzaXplb2YobS0+ZGV2KSk7Cj4gKwltZW1zZXQobS0+dnFzLCAwLCBudnFzICogc2l6ZW9mKHN0
cnVjdCB2aG9zdF92aXJ0cXVldWUpKTsKPiArCj4gKwl2cXMgPSBrbWFsbG9jX2FycmF5KG52cXMs
IHNpemVvZigqdnFzKSwgR0ZQX0tFUk5FTCk7Cj4gKwlpZiAoIXZxcykgewo+ICsJCXIgPSAtRU5P
TUVNOwo+ICsJCWdvdG8gZXJyOwo+ICsJfQo+ICsKPiArCWRldiA9ICZtLT5kZXY7Cj4gKwlmb3Ig
KGkgPSAwOyBpIDwgbnZxczsgaSsrKSB7Cj4gKwkJdnFzW2ldID0gJm0tPnZxc1tpXTsKPiArCQl2
cXNbaV0tPmhhbmRsZV9raWNrID0gaGFuZGxlX3ZxX2tpY2s7Cj4gKwl9Cj4gKwl2aG9zdF9kZXZf
aW5pdChkZXYsIHZxcywgbnZxcywgMCwgMCwgMCk7Cj4gKwltLT5vcGVuZWQgPSB0cnVlOwo+ICsJ
bXV0ZXhfdW5sb2NrKCZtLT5tdXRleCk7Cj4gKwo+ICsJcmV0dXJuIDA7Cj4gKwo+ICtlcnI6Cj4g
KwltdXRleF91bmxvY2soJm0tPm11dGV4KTsKPiArCW1vZHVsZV9wdXQoVEhJU19NT0RVTEUpOwo+
ICsJcmV0dXJuIHI7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHZob3N0X21kZXZfcmVsZWFzZSh2
b2lkICpkZXZpY2VfZGF0YSkKPiArewo+ICsJc3RydWN0IHZob3N0X21kZXYgKm0gPSBkZXZpY2Vf
ZGF0YTsKPiArCj4gKwltdXRleF9sb2NrKCZtLT5tdXRleCk7Cj4gKwl2aG9zdF9tZGV2X3Jlc2V0
KG0pOwo+ICsJdmhvc3RfZGV2X3N0b3AoJm0tPmRldik7Cj4gKwl2aG9zdF9kZXZfY2xlYW51cCgm
bS0+ZGV2KTsKPiArCj4gKwlrZnJlZShtLT5kZXYudnFzKTsKPiArCW0tPm9wZW5lZCA9IGZhbHNl
Owo+ICsJbXV0ZXhfdW5sb2NrKCZtLT5tdXRleCk7Cj4gKwltb2R1bGVfcHV0KFRISVNfTU9EVUxF
KTsKPiArfQo+ICsKPiArc3RhdGljIGxvbmcgdmhvc3RfbWRldl91bmxvY2tlZF9pb2N0bCh2b2lk
ICpkZXZpY2VfZGF0YSwKPiArCQkJCSAgICAgIHVuc2lnbmVkIGludCBjbWQsIHVuc2lnbmVkIGxv
bmcgYXJnKQo+ICt7Cj4gKwlzdHJ1Y3Qgdmhvc3RfbWRldiAqbSA9IGRldmljZV9kYXRhOwo+ICsJ
dm9pZCBfX3VzZXIgKmFyZ3AgPSAodm9pZCBfX3VzZXIgKilhcmc7Cj4gKwlsb25nIHI7Cj4gKwo+
ICsJbXV0ZXhfbG9jaygmbS0+bXV0ZXgpOwo+ICsKPiArCXN3aXRjaCAoY21kKSB7Cj4gKwljYXNl
IFZIT1NUX01ERVZfU0VUX1NUQVRFOgo+ICsJCXIgPSB2aG9zdF9zZXRfc3RhdGUobSwgYXJncCk7
Cj4gKwkJYnJlYWs7Cj4gKwljYXNlIFZIT1NUX0dFVF9GRUFUVVJFUzoKPiArCQlyID0gdmhvc3Rf
Z2V0X2ZlYXR1cmVzKG0sIGFyZ3ApOwo+ICsJCWJyZWFrOwo+ICsJY2FzZSBWSE9TVF9TRVRfRkVB
VFVSRVM6Cj4gKwkJciA9IHZob3N0X3NldF9mZWF0dXJlcyhtLCBhcmdwKTsKPiArCQlicmVhazsK
PiArCWNhc2UgVkhPU1RfR0VUX1ZSSU5HX0JBU0U6Cj4gKwkJciA9IHZob3N0X2dldF92cmluZ19i
YXNlKG0sIGFyZ3ApOwo+ICsJCWJyZWFrOwoKCkRvZXMgaXQgbWVhbiB0aGUgU0VUX1ZSSU5HX0JB
U0UgbWF5IG9ubHkgdGFrZSBhZmZlY3QgYWZ0ZXIgClZIT1NUX01FVl9TRVRfU1RBVEU/CgoKPiAr
CWRlZmF1bHQ6Cj4gKwkJciA9IHZob3N0X2Rldl9pb2N0bCgmbS0+ZGV2LCBjbWQsIGFyZ3ApOwo+
ICsJCWlmIChyID09IC1FTk9JT0NUTENNRCkKPiArCQkJciA9IHZob3N0X3ZyaW5nX2lvY3RsKCZt
LT5kZXYsIGNtZCwgYXJncCk7Cj4gKwl9Cj4gKwo+ICsJbXV0ZXhfdW5sb2NrKCZtLT5tdXRleCk7
Cj4gKwlyZXR1cm4gcjsKPiArfQo+ICsKPiArc3RhdGljIGNvbnN0IHN0cnVjdCB2ZmlvX2Rldmlj
ZV9vcHMgdmZpb192aG9zdF9tZGV2X2Rldl9vcHMgPSB7Cj4gKwkubmFtZQkJPSAidmZpby12aG9z
dC1tZGV2IiwKPiArCS5vcGVuCQk9IHZob3N0X21kZXZfb3BlbiwKPiArCS5yZWxlYXNlCT0gdmhv
c3RfbWRldl9yZWxlYXNlLAo+ICsJLmlvY3RsCQk9IHZob3N0X21kZXZfdW5sb2NrZWRfaW9jdGws
Cj4gK307Cj4gKwo+ICtzdGF0aWMgaW50IHZob3N0X21kZXZfcHJvYmUoc3RydWN0IGRldmljZSAq
ZGV2KQo+ICt7Cj4gKwlzdHJ1Y3QgbWRldl9kZXZpY2UgKm1kZXYgPSBtZGV2X2Zyb21fZGV2KGRl
dik7Cj4gKwljb25zdCBzdHJ1Y3QgdmlydGlvX21kZXZfZGV2aWNlX29wcyAqb3BzID0gbWRldl9n
ZXRfZGV2X29wcyhtZGV2KTsKPiArCXN0cnVjdCB2aG9zdF9tZGV2ICptOwo+ICsJaW50IG52cXMs
IHI7Cj4gKwo+ICsJbSA9IGt6YWxsb2Moc2l6ZW9mKCptKSwgR0ZQX0tFUk5FTCB8IF9fR0ZQX1JF
VFJZX01BWUZBSUwpOwo+ICsJaWYgKCFtKQo+ICsJCXJldHVybiAtRU5PTUVNOwo+ICsKPiArCW11
dGV4X2luaXQoJm0tPm11dGV4KTsKPiArCj4gKwludnFzID0gb3BzLT5nZXRfcXVldWVfbWF4KG1k
ZXYpOwo+ICsJbS0+bnZxcyA9IG52cXM7CgoKVGhlIG5hbWUgY291bGQgYmUgY29uZnVzaW5nLCBn
ZXRfcXVldWVfbWF4KCkgaXMgdG8gZ2V0IHRoZSBtYXhpbXVtIApudW1iZXIgb2YgZW50cmllcyBm
b3IgYSB2aXJ0cXVldWUgc3VwcG9ydGVkIGJ5IHRoaXMgZGV2aWNlLgoKSXQgbG9va3MgdG8gbWUg
dGhhdCB3ZSBuZWVkIGFub3RoZXIgQVBJIHRvIHF1ZXJ5IHRoZSBtYXhpbXVtIG51bWJlciBvZiAK
dmlydHF1ZXVlcyBzdXBwb3J0ZWQgYnkgdGhlIGRldmljZS4KClRoYW5rcwoKCj4gKwo+ICsJbS0+
dnFzID0ga21hbGxvY19hcnJheShudnFzLCBzaXplb2Yoc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSks
Cj4gKwkJCSAgICAgICBHRlBfS0VSTkVMKTsKPiArCWlmICghbS0+dnFzKSB7Cj4gKwkJciA9IC1F
Tk9NRU07Cj4gKwkJZ290byBlcnI7Cj4gKwl9Cj4gKwo+ICsJciA9IHZmaW9fYWRkX2dyb3VwX2Rl
dihkZXYsICZ2ZmlvX3Zob3N0X21kZXZfZGV2X29wcywgbSk7Cj4gKwlpZiAocikKPiArCQlnb3Rv
IGVycjsKPiArCj4gKwltLT5mZWF0dXJlcyA9IG9wcy0+Z2V0X2ZlYXR1cmVzKG1kZXYpOwo+ICsJ
bS0+bWRldiA9IG1kZXY7Cj4gKwlyZXR1cm4gMDsKPiArCj4gK2VycjoKPiArCWtmcmVlKG0tPnZx
cyk7Cj4gKwlrZnJlZShtKTsKPiArCXJldHVybiByOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCB2
aG9zdF9tZGV2X3JlbW92ZShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gK3sKPiArCXN0cnVjdCB2aG9z
dF9tZGV2ICptOwo+ICsKPiArCW0gPSB2ZmlvX2RlbF9ncm91cF9kZXYoZGV2KTsKPiArCW11dGV4
X2Rlc3Ryb3koJm0tPm11dGV4KTsKPiArCWtmcmVlKG0tPnZxcyk7Cj4gKwlrZnJlZShtKTsKPiAr
fQo+ICsKPiArc3RhdGljIHN0cnVjdCBtZGV2X2NsYXNzX2lkIGlkX3RhYmxlW10gPSB7Cj4gKwl7
IE1ERVZfSURfVkhPU1QgfSwKPiArCXsgMCB9LAo+ICt9Owo+ICsKPiArc3RhdGljIHN0cnVjdCBt
ZGV2X2RyaXZlciB2aG9zdF9tZGV2X2RyaXZlciA9IHsKPiArCS5uYW1lCT0gInZob3N0X21kZXYi
LAo+ICsJLnByb2JlCT0gdmhvc3RfbWRldl9wcm9iZSwKPiArCS5yZW1vdmUJPSB2aG9zdF9tZGV2
X3JlbW92ZSwKPiArCS5pZF90YWJsZSA9IGlkX3RhYmxlLAo+ICt9Owo+ICsKPiArc3RhdGljIGlu
dCBfX2luaXQgdmhvc3RfbWRldl9pbml0KHZvaWQpCj4gK3sKPiArCXJldHVybiBtZGV2X3JlZ2lz
dGVyX2RyaXZlcigmdmhvc3RfbWRldl9kcml2ZXIsIFRISVNfTU9EVUxFKTsKPiArfQo+ICttb2R1
bGVfaW5pdCh2aG9zdF9tZGV2X2luaXQpOwo+ICsKPiArc3RhdGljIHZvaWQgX19leGl0IHZob3N0
X21kZXZfZXhpdCh2b2lkKQo+ICt7Cj4gKwltZGV2X3VucmVnaXN0ZXJfZHJpdmVyKCZ2aG9zdF9t
ZGV2X2RyaXZlcik7Cj4gK30KPiArbW9kdWxlX2V4aXQodmhvc3RfbWRldl9leGl0KTsKPiArCj4g
K01PRFVMRV9WRVJTSU9OKCIwLjAuMSIpOwo+ICtNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7Cj4g
K01PRFVMRV9ERVNDUklQVElPTigiTWVkaWF0ZWQgZGV2aWNlIGJhc2VkIGFjY2VsZXJhdG9yIGZv
ciB2aXJ0aW8iKTsKPiBkaWZmIC0tZ2l0IGEvaW5jbHVkZS91YXBpL2xpbnV4L3Zob3N0LmggYi9p
bmNsdWRlL3VhcGkvbGludXgvdmhvc3QuaAo+IGluZGV4IDQwZDAyOGVlZDY0NS4uNWFmYmMyZjA4
ZmEzIDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvdWFwaS9saW51eC92aG9zdC5oCj4gKysrIGIvaW5j
bHVkZS91YXBpL2xpbnV4L3Zob3N0LmgKPiBAQCAtMTE2LDQgKzExNiwxMiBAQAo+ICAgI2RlZmlu
ZSBWSE9TVF9WU09DS19TRVRfR1VFU1RfQ0lECV9JT1coVkhPU1RfVklSVElPLCAweDYwLCBfX3U2
NCkKPiAgICNkZWZpbmUgVkhPU1RfVlNPQ0tfU0VUX1JVTk5JTkcJCV9JT1coVkhPU1RfVklSVElP
LCAweDYxLCBpbnQpCj4gICAKPiArLyogVkhPU1RfTURFViBzcGVjaWZpYyBkZWZpbmVzICovCj4g
Kwo+ICsjZGVmaW5lIFZIT1NUX01ERVZfU0VUX1NUQVRFCV9JT1coVkhPU1RfVklSVElPLCAweDcw
LCBfX3U2NCkKPiArCj4gKyNkZWZpbmUgVkhPU1RfTURFVl9TX1NUT1BQRUQJMAo+ICsjZGVmaW5l
IFZIT1NUX01ERVZfU19SVU5OSU5HCTEKPiArI2RlZmluZSBWSE9TVF9NREVWX1NfTUFYCTIKPiAr
Cj4gICAjZW5kaWYKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4
LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
