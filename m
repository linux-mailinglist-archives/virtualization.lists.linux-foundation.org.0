Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 63E471978BD
	for <lists.virtualization@lfdr.de>; Mon, 30 Mar 2020 12:19:58 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 1519886A1D;
	Mon, 30 Mar 2020 10:19:57 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id r19CHq18IwAJ; Mon, 30 Mar 2020 10:19:53 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 56B7286A2D;
	Mon, 30 Mar 2020 10:19:53 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 4E57BC1D7E;
	Mon, 30 Mar 2020 10:19:53 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id CB931C07FF
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:49 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id BE3088757F
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:49 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 4mlEe23hfaIN
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:48 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id 4D2098793D
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:48 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 0899C305FFA6; Mon, 30 Mar 2020 13:12:57 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id D6237305B7A1;
 Mon, 30 Mar 2020 13:12:56 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v8 51/81] KVM: introspection: handle vCPU commands
Date: Mon, 30 Mar 2020 13:12:38 +0300
Message-Id: <20200330101308.21702-52-alazar@bitdefender.com>
In-Reply-To: <20200330101308.21702-1-alazar@bitdefender.com>
References: <20200330101308.21702-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <ncitu@bitdefender.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKQmFzZWQgb24gdGhl
IGNvbW1vbiBzdHJ1Y3R1cmUgKGt2bWlfdmNwdV9oZHIpIHVzZWQgZm9yIGFsbCB2Q1BVIGNvbW1h
bmRzLAp0aGUgcmVjZWl2aW5nIHRocmVhZCB2YWxpZGF0ZXMgYW5kIGRpc3BhdGNoZXMgdGhlIG1l
c3NhZ2UgdG8gdGhlIHByb3Blcgp2Q1BVIChhZGRpbmcgdGhlIGhhbmRsaW5nIGZ1bmN0aW9uIHRv
IGl0cyBqb2JzIGxpc3QpLgoKU2lnbmVkLW9mZi1ieTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0
ZGVmZW5kZXIuY29tPgpDby1kZXZlbG9wZWQtYnk6IE5pY3XImW9yIEPDrsibdSA8bmNpdHVAYml0
ZGVmZW5kZXIuY29tPgpTaWduZWQtb2ZmLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5jaXR1QGJpdGRl
ZmVuZGVyLmNvbT4KQ28tZGV2ZWxvcGVkLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRk
ZWZlbmRlci5jb20+ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJpdGRl
ZmVuZGVyLmNvbT4KLS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgfCAgIDgg
KysKIGluY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggICAgICAgICB8ICAgNiArKwogdmlydC9rdm0v
aW50cm9zcGVjdGlvbi9rdm1pX2ludC5oIHwgICAzICsKIHZpcnQva3ZtL2ludHJvc3BlY3Rpb24v
a3ZtaV9tc2cuYyB8IDE2OSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0KIDQgZmlsZXMg
Y2hhbmdlZCwgMTg0IGluc2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
RG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCBiL0RvY3VtZW50YXRpb24vdmlydC9rdm0v
a3ZtaS5yc3QKaW5kZXggNzQ4ZDc4NmQxYzA4Li4yNzFhZWQyMWY2MzQgMTAwNjQ0Ci0tLSBhL0Rv
Y3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKKysrIGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2
bS9rdm1pLnJzdApAQCAtMjMyLDYgKzIzMiwxNCBAQCBUaGUgZm9sbG93aW5nIEMgc3RydWN0dXJl
cyBhcmUgbWVhbnQgdG8gYmUgdXNlZCBkaXJlY3RseSB3aGVuIGNvbW11bmljYXRpbmcKIG92ZXIg
dGhlIHdpcmUuIFRoZSBwZWVyIHRoYXQgZGV0ZWN0cyBhbnkgc2l6ZSBtaXNtYXRjaCBzaG91bGQg
c2ltcGx5IGNsb3NlCiB0aGUgY29ubmVjdGlvbiBhbmQgcmVwb3J0IHRoZSBlcnJvci4KIAorVGhl
IHZDUFUgY29tbWFuZHMgc3RhcnQgd2l0aDo6CisKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2hkciB7CisJ
CV9fdTE2IHZjcHU7CisJCV9fdTE2IHBhZGRpbmcxOworCQlfX3UzMiBwYWRkaW5nMjsKKwl9CisK
IDEuIEtWTUlfR0VUX1ZFUlNJT04KIC0tLS0tLS0tLS0tLS0tLS0tLS0KIApkaWZmIC0tZ2l0IGEv
aW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaCBiL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgKaW5k
ZXggMzM1ZTNkODc5ZGY5Li40YTc1YmMyOGQ3ZTAgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdWFwaS9s
aW51eC9rdm1pLmgKKysrIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaApAQCAtMTAwLDYgKzEw
MCwxMiBAQCBzdHJ1Y3Qga3ZtaV92bV93cml0ZV9waHlzaWNhbCB7CiAJX191OCAgZGF0YVswXTsK
IH07CiAKK3N0cnVjdCBrdm1pX3ZjcHVfaGRyIHsKKwlfX3UxNiB2Y3B1OworCV9fdTE2IHBhZGRp
bmcxOworCV9fdTMyIHBhZGRpbmcyOworfTsKKwogc3RydWN0IGt2bWlfZXZlbnQgewogCV9fdTE2
IHNpemU7CiAJX191MTYgdmNwdTsKZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24v
a3ZtaV9pbnQuaCBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaAppbmRleCA1ZDQw
ZDg3MmU0OTMuLjU1NTAwYjg5Mzk4YiAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlv
bi9rdm1pX2ludC5oCisrKyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaApAQCAt
MzIsNiArMzIsOSBAQCBpbnQga3ZtaV9tc2dfc2VuZF91bmhvb2soc3RydWN0IGt2bV9pbnRyb3Nw
ZWN0aW9uICprdm1pKTsKIC8qIGt2bWkuYyAqLwogdm9pZCAqa3ZtaV9tc2dfYWxsb2Modm9pZCk7
CiB2b2lkIGt2bWlfbXNnX2ZyZWUodm9pZCAqYWRkcik7CitpbnQga3ZtaV9hZGRfam9iKHN0cnVj
dCBrdm1fdmNwdSAqdmNwdSwKKwkJIHZvaWQgKCpmY3QpKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwg
dm9pZCAqY3R4KSwKKwkJIHZvaWQgKmN0eCwgdm9pZCAoKmZyZWVfZmN0KSh2b2lkICpjdHgpKTsK
IGludCBrdm1pX2NtZF92bV9jb250cm9sX2V2ZW50cyhzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24g
Kmt2bWksCiAJCQkJdW5zaWduZWQgaW50IGV2ZW50X2lkLCBib29sIGVuYWJsZSk7CiBpbnQga3Zt
aV9jbWRfcmVhZF9waHlzaWNhbChzdHJ1Y3Qga3ZtICprdm0sIHU2NCBncGEsIHNpemVfdCBzaXpl
LApkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jIGIvdmlydC9r
dm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCmluZGV4IDFmYWY3MDk0NTEyMy4uNTdlMDgyYzNi
YjQzIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMKKysrIGIv
dmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCkBAIC05LDYgKzksMzAgQEAKICNpbmNs
dWRlICJrdm1pX2ludC5oIgogCiBzdGF0aWMgYm9vbCBpc192bV9jb21tYW5kKHUxNiBpZCk7Citz
dGF0aWMgYm9vbCBpc192Y3B1X2NvbW1hbmQodTE2IGlkKTsKKworc3RydWN0IGt2bWlfdmNwdV9j
bWRfam9iIHsKKwlzdHJ1Y3QgeworCQlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwkJc3RydWN0
IGt2bWlfdmNwdV9oZHIgY21kOworCX0gKm1zZzsKKwlzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHU7Cit9
OworCitzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgbXNnX0lEc1tdID0geworCVtLVk1JX0dFVF9W
RVJTSU9OXSAgICAgICA9ICJLVk1JX0dFVF9WRVJTSU9OIiwKKwlbS1ZNSV9WTV9DSEVDS19DT01N
QU5EXSAgPSAiS1ZNSV9WTV9DSEVDS19DT01NQU5EIiwKKwlbS1ZNSV9WTV9DSEVDS19FVkVOVF0g
ICAgPSAiS1ZNSV9WTV9DSEVDS19FVkVOVCIsCisJW0tWTUlfVk1fQ09OVFJPTF9FVkVOVFNdID0g
IktWTUlfVk1fQ09OVFJPTF9FVkVOVFMiLAorCVtLVk1JX1ZNX0dFVF9JTkZPXSAgICAgICA9ICJL
Vk1JX1ZNX0dFVF9JTkZPIiwKKwlbS1ZNSV9WTV9SRUFEX1BIWVNJQ0FMXSAgPSAiS1ZNSV9WTV9S
RUFEX1BIWVNJQ0FMIiwKKwlbS1ZNSV9WTV9XUklURV9QSFlTSUNBTF0gPSAiS1ZNSV9WTV9XUklU
RV9QSFlTSUNBTCIsCit9OworCitzdGF0aWMgY29uc3QgY2hhciAqaWQyc3RyKHUxNiBpZCkKK3sK
KwlyZXR1cm4gaWQgPCBBUlJBWV9TSVpFKG1zZ19JRHMpID8gbXNnX0lEc1tpZF0gOiAidW5rbm93
biI7Cit9CiAKIGJvb2wga3ZtaV9zb2NrX2dldChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2
bWksIGludCBmZCkKIHsKQEAgLTEwNSw2ICsxMjksMjggQEAgc3RhdGljIGJvb2wgaXNfY29tbWFu
ZF9hbGxvd2VkKHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSwgdTE2IGlkKQogCXJldHVy
biBpZCA8IEtWTUlfTlVNX0NPTU1BTkRTICYmIHRlc3RfYml0KGlkLCBrdm1pLT5jbWRfYWxsb3df
bWFzayk7CiB9CiAKK3N0YXRpYyBib29sIGludmFsaWRfdmNwdV9oZHIoY29uc3Qgc3RydWN0IGt2
bWlfdmNwdV9oZHIgKmhkcikKK3sKKwlyZXR1cm4gaGRyLT5wYWRkaW5nMSB8fCBoZHItPnBhZGRp
bmcyOworfQorCitzdGF0aWMgaW50IGt2bWlfZ2V0X3ZjcHUoc3RydWN0IGt2bV9pbnRyb3NwZWN0
aW9uICprdm1pLCB1bnNpZ25lZCBpbnQgdmNwdV9pZHgsCisJCQkgc3RydWN0IGt2bV92Y3B1ICoq
ZGVzdCkKK3sKKwlzdHJ1Y3Qga3ZtICprdm0gPSBrdm1pLT5rdm07CisJc3RydWN0IGt2bV92Y3B1
ICp2Y3B1OworCisJaWYgKHZjcHVfaWR4ID49IGF0b21pY19yZWFkKCZrdm0tPm9ubGluZV92Y3B1
cykpCisJCXJldHVybiAtS1ZNX0VJTlZBTDsKKworCXZjcHUgPSBrdm1fZ2V0X3ZjcHUoa3ZtLCB2
Y3B1X2lkeCk7CisJaWYgKCF2Y3B1KQorCQlyZXR1cm4gLUtWTV9FSU5WQUw7CisKKwkqZGVzdCA9
IHZjcHU7CisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQgaGFuZGxlX2dldF92ZXJzaW9uKHN0
cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBrdm1p
X21zZ19oZHIgKm1zZywgY29uc3Qgdm9pZCAqcmVxKQogewpAQCAtMTI1LDcgKzE3MSw3IEBAIHN0
YXRpYyBpbnQgaGFuZGxlX2NoZWNrX2NvbW1hbmQoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICpr
dm1pLAogCiAJaWYgKHJlcS0+cGFkZGluZzEgfHwgcmVxLT5wYWRkaW5nMikKIAkJZWMgPSAtS1ZN
X0VJTlZBTDsKLQllbHNlIGlmICghaXNfdm1fY29tbWFuZChyZXEtPmlkKSkKKwllbHNlIGlmICgh
aXNfdm1fY29tbWFuZChyZXEtPmlkKSAmJiAhaXNfdmNwdV9jb21tYW5kKHJlcS0+aWQpKQogCQll
YyA9IC1LVk1fRU5PRU5UOwogCWVsc2UgaWYgKCFpc19jb21tYW5kX2FsbG93ZWQoa3ZtaSwgcmVx
LT5pZCkpCiAJCWVjID0gLUtWTV9FUEVSTTsKQEAgLTI2MSw2ICszMDcsNjAgQEAgc3RhdGljIGJv
b2wgaXNfdm1fY29tbWFuZCh1MTYgaWQpCiAJcmV0dXJuIGlkIDwgQVJSQVlfU0laRShtc2dfdm0p
ICYmICEhbXNnX3ZtW2lkXTsKIH0KIAorLyoKKyAqIFRoZXNlIGNvbW1hbmRzIGFyZSBleGVjdXRl
ZCBmcm9tIHRoZSB2Q1BVIHRocmVhZC4gVGhlIHJlY2VpdmluZyB0aHJlYWQKKyAqIHBhc3NlcyB0
aGUgbWVzc2FnZXMgdXNpbmcgYSBuZXdseSBhbGxvY2F0ZWQgJ3N0cnVjdCBrdm1pX3ZjcHVfY21k
X2pvYicKKyAqIGFuZCBzaWduYWxzIHRoZSB2Q1BVIHRvIGhhbmRsZSB0aGUgY29tbWFuZCAod2hp
Y2ggaW5jbHVkZXMKKyAqIHNlbmRpbmcgYmFjayB0aGUgcmVwbHkpLgorICovCitzdGF0aWMgaW50
KCpjb25zdCBtc2dfdmNwdVtdKShjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X2NtZF9qb2IgKiwKKwkJ
CSAgICAgIGNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKiwgY29uc3Qgdm9pZCAqKSA9IHsKK307
CisKK3N0YXRpYyBib29sIGlzX3ZjcHVfY29tbWFuZCh1MTYgaWQpCit7CisJcmV0dXJuIGlkIDwg
QVJSQVlfU0laRShtc2dfdmNwdSkgJiYgISFtc2dfdmNwdVtpZF07Cit9CisKK3N0YXRpYyB2b2lk
IGt2bWlfam9iX3ZjcHVfY21kKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdm9pZCAqY3R4KQorewor
CXN0cnVjdCBrdm1pX3ZjcHVfY21kX2pvYiAqam9iID0gY3R4OworCXNpemVfdCBpZCA9IGpvYi0+
bXNnLT5oZHIuaWQ7CisJaW50IGVycjsKKworCWpvYi0+dmNwdSA9IHZjcHU7CisKKwllcnIgPSBt
c2dfdmNwdVtpZF0oam9iLCAmam9iLT5tc2ctPmhkciwgam9iLT5tc2cgKyAxKTsKKworCWlmIChl
cnIpIHsKKwkJc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pID0gS1ZNSSh2Y3B1LT5rdm0p
OworCisJCWt2bWlfZXJyKGt2bWksICIlczogbXNnIGlkICV6dSAoJXMpIHNpemUgJXUgZXJyICVk
XG4iLAorCQkJIF9fZnVuY19fLCBpZCwgaWQyc3RyKGlkKSwgam9iLT5tc2ctPmhkci5zaXplLCBl
cnIpOworCQlrdm1pX3NvY2tfc2h1dGRvd24oa3ZtaSk7CisJfQorfQorCitzdGF0aWMgdm9pZCBr
dm1pX2ZyZWVfY3R4KHZvaWQgKl9jdHgpCit7CisJY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9jbWRf
am9iICpjdHggPSBfY3R4OworCisJa3ZtaV9tc2dfZnJlZShjdHgtPm1zZyk7CisJa2ZyZWUoY3R4
KTsKK30KKworc3RhdGljIGludCBrdm1pX21zZ19xdWV1ZV90b192Y3B1KHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwKKwkJCQkgIGNvbnN0IHN0cnVjdCBrdm1pX3ZjcHVfY21kX2pvYiAqY21kKQorewor
CXJldHVybiBrdm1pX2FkZF9qb2IodmNwdSwga3ZtaV9qb2JfdmNwdV9jbWQsICh2b2lkICopY21k
LAorCQkJICAgIGt2bWlfZnJlZV9jdHgpOworfQorCitzdGF0aWMgYm9vbCBpc192Y3B1X21lc3Nh
Z2UodTE2IGlkKQoreworCXJldHVybiBpc192Y3B1X2NvbW1hbmQoaWQpOworfQorCiBzdGF0aWMg
c3RydWN0IGt2bWlfbXNnX2hkciAqa3ZtaV9tc2dfcmVjdihzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rp
b24gKmt2bWkpCiB7CiAJc3RydWN0IGt2bWlfbXNnX2hkciAqbXNnOwpAQCAtMzA4LDkgKzQwOCw2
OCBAQCBzdGF0aWMgaW50IGt2bWlfbXNnX3ZtX3JlcGx5X2VjKHN0cnVjdCBrdm1faW50cm9zcGVj
dGlvbiAqa3ZtaSwKIAlyZXR1cm4ga3ZtaV9tc2dfdm1fcmVwbHkoa3ZtaSwgbXNnLCBlYywgTlVM
TCwgMCk7CiB9CiAKK3N0YXRpYyBib29sIHZjcHVfY2FuX2hhbmRsZV9jb21tYW5kcyhzdHJ1Y3Qg
a3ZtX3ZjcHUgKnZjcHUpCit7CisJcmV0dXJuIHZjcHUtPmFyY2gubXBfc3RhdGUgIT0gS1ZNX01Q
X1NUQVRFX1VOSU5JVElBTElaRUQ7Cit9CisKK3N0YXRpYyBib29sIGt2bWlfZ2V0X3ZjcHVfaWZf
cmVhZHkoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJCSAgIHVuc2lnbmVkIGlu
dCB2Y3B1X2lkeCwKKwkJCQkgICBzdHJ1Y3Qga3ZtX3ZjcHUgKip2Y3B1KQoreworCWludCBlcnI7
CisKKwllcnIgPSBrdm1pX2dldF92Y3B1KGt2bWksIHZjcHVfaWR4LCB2Y3B1KTsKKworCXJldHVy
biAhZXJyICYmIHZjcHVfY2FuX2hhbmRsZV9jb21tYW5kcygqdmNwdSk7Cit9CisKK3N0YXRpYyBp
bnQga3ZtaV92YWxpZGF0ZV92Y3B1X2NtZChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWks
CisJCQkJICBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICptc2csCisJCQkJICBzdHJ1Y3Qga3ZtX3ZjcHUg
Kip2Y3B1KQoreworCXN0cnVjdCBrdm1pX3ZjcHVfaGRyICpjbWQgPSAoc3RydWN0IGt2bWlfdmNw
dV9oZHIgKikobXNnICsgMSk7CisJdW5zaWduZWQgaW50IHZjcHVfaWR4ID0gY21kLT52Y3B1Owor
CisJaWYgKGludmFsaWRfdmNwdV9oZHIoY21kKSkKKwkJcmV0dXJuIC1LVk1fRUlOVkFMOworCisJ
aWYgKCFrdm1pX2dldF92Y3B1X2lmX3JlYWR5KGt2bWksIHZjcHVfaWR4LCB2Y3B1KSkKKwkJcmV0
dXJuIC1LVk1fRUFHQUlOOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQga3ZtaV9tc2df
ZGlzcGF0Y2hfdmNwdV9jbWQoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJCSAg
ICAgIHN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZywKKwkJCQkgICAgICBib29sICpxdWV1ZWQpCit7
CisJc3RydWN0IGt2bWlfdmNwdV9jbWRfam9iICpqb2JfY21kOworCXN0cnVjdCBrdm1fdmNwdSAq
dmNwdSA9IE5VTEw7CisJaW50IGVyciwgZWM7CisKKwllYyA9IGt2bWlfdmFsaWRhdGVfdmNwdV9j
bWQoa3ZtaSwgbXNnLCAmdmNwdSk7CisJaWYgKGVjKQorCQlyZXR1cm4ga3ZtaV9tc2dfdm1fcmVw
bHlfZWMoa3ZtaSwgbXNnLCBlYyk7CisKKwlqb2JfY21kID0ga3phbGxvYyhzaXplb2YoKmpvYl9j
bWQpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWpvYl9jbWQpCisJCXJldHVybiAtS1ZNX0VOT01FTTsK
KworCWpvYl9jbWQtPm1zZyA9ICh2b2lkICopbXNnOworCisJZXJyID0ga3ZtaV9tc2dfcXVldWVf
dG9fdmNwdSh2Y3B1LCBqb2JfY21kKTsKKwlpZiAoZXJyKQorCQlrZnJlZShqb2JfY21kKTsKKwor
CSpxdWV1ZWQgPSBlcnIgPT0gMDsKKwlyZXR1cm4gZXJyOworfQorCiBib29sIGt2bWlfbXNnX3By
b2Nlc3Moc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pKQogewogCXN0cnVjdCBrdm1pX21z
Z19oZHIgKm1zZzsKKwlib29sIHF1ZXVlZCA9IGZhbHNlOwogCWludCBlcnIgPSAtMTsKIAogCW1z
ZyA9IGt2bWlfbXNnX3JlY3Yoa3ZtaSk7CkBAIC0zMjIsMTEgKzQ4MSwxNyBAQCBib29sIGt2bWlf
bXNnX3Byb2Nlc3Moc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pKQogCQkJZXJyID0ga3Zt
aV9tc2dfZGlzcGF0Y2hfdm1fY21kKGt2bWksIG1zZyk7CiAJCWVsc2UKIAkJCWVyciA9IGt2bWlf
bXNnX3ZtX3JlcGx5X2VjKGt2bWksIG1zZywgLUtWTV9FUEVSTSk7CisJfSBlbHNlIGlmIChpc192
Y3B1X21lc3NhZ2UobXNnLT5pZCkpIHsKKwkJaWYgKGlzX21lc3NhZ2VfYWxsb3dlZChrdm1pLCBt
c2ctPmlkKSkKKwkJCWVyciA9IGt2bWlfbXNnX2Rpc3BhdGNoX3ZjcHVfY21kKGt2bWksIG1zZywg
JnF1ZXVlZCk7CisJCWVsc2UKKwkJCWVyciA9IGt2bWlfbXNnX3ZtX3JlcGx5X2VjKGt2bWksIG1z
ZywgLUtWTV9FUEVSTSk7CiAJfSBlbHNlIHsKIAkJZXJyID0ga3ZtaV9tc2dfdm1fcmVwbHlfZWMo
a3ZtaSwgbXNnLCAtS1ZNX0VOT1NZUyk7CiAJfQogCi0Ja3ZtaV9tc2dfZnJlZShtc2cpOworCWlm
ICghcXVldWVkKQorCQlrdm1pX21zZ19mcmVlKG1zZyk7CiBvdXQ6CiAJcmV0dXJuIGVyciA9PSAw
OwogfQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0
dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRh
dGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGlu
Zm8vdmlydHVhbGl6YXRpb24=
