Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
	by mail.lfdr.de (Postfix) with ESMTPS id 2E084424536
	for <lists.virtualization@lfdr.de>; Wed,  6 Oct 2021 19:50:52 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id AD09A406FF;
	Wed,  6 Oct 2021 17:50:50 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id UcIASQkJaTa9; Wed,  6 Oct 2021 17:50:49 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [IPv6:2605:bc80:3010:104::8cd3:938])
	by smtp4.osuosl.org (Postfix) with ESMTPS id 4BAA5406F2;
	Wed,  6 Oct 2021 17:50:49 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id EF343C0023;
	Wed,  6 Oct 2021 17:50:47 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 07C08C000D
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:45 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id D466C407D0
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:43 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id yZRBPeDP8mYP
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:42 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.8.0
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by smtp2.osuosl.org (Postfix) with ESMTPS id 7D84D407DF
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:42 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 D4A5E30827B2; Wed,  6 Oct 2021 20:31:20 +0300 (EEST)
Received: from localhost (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id B827C300F73A;
 Wed,  6 Oct 2021 20:31:20 +0300 (EEST)
X-Is-Junk-Enabled: fGZTSsP0qEJE2AIKtlSuFiRRwg9xyHmJ
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v12 64/77] KVM: introspection: add KVMI_VCPU_SET_XSAVE
Date: Wed,  6 Oct 2021 20:31:00 +0300
Message-Id: <20211006173113.26445-65-alazar@bitdefender.com>
In-Reply-To: <20211006173113.26445-1-alazar@bitdefender.com>
References: <20211006173113.26445-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: Tamas K Lengyel <tamas@tklengyel.com>, Wanpeng Li <wanpengli@tencent.com>,
 Sean Christopherson <seanjc@google.com>, Joerg Roedel <joro@8bytes.org>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Mathieu Tarral <mathieu.tarral@protonmail.com>,
 Paolo Bonzini <pbonzini@redhat.com>, Jim Mattson <jmattson@google.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhpcyBjYW4gYmUgdXNlZCBieSB0aGUgaW50cm9zcGVjdGlvbiB0b29sIHRvIGVtdWxhdGUgU1NF
IGluc3RydWN0aW9ucy4KClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJp
dGRlZmVuZGVyLmNvbT4KLS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgICAg
ICAgICAgICAgfCAyOCArKysrKysrKysrKysrKysrKysrCiBhcmNoL3g4Ni9pbmNsdWRlL3VhcGkv
YXNtL2t2bWkuaCAgICAgICAgICAgICAgfCAgNCArKysKIGFyY2gveDg2L2t2bS9rdm1pX21zZy5j
ICAgICAgICAgICAgICAgICAgICAgICB8IDIwICsrKysrKysrKysrKysKIGluY2x1ZGUvdWFwaS9s
aW51eC9rdm1pLmggICAgICAgICAgICAgICAgICAgICB8ICAxICsKIC4uLi90ZXN0aW5nL3NlbGZ0
ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jICB8IDI3ICsrKysrKysrKysrKysrLS0tLQogNSBm
aWxlcyBjaGFuZ2VkLCA3NCBpbnNlcnRpb25zKCspLCA2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QgYi9Eb2N1bWVudGF0aW9uL3ZpcnQv
a3ZtL2t2bWkucnN0CmluZGV4IDhmMmYxMDVhNTI3Zi4uZWVkY2FlMzkwMGM1IDEwMDY0NAotLS0g
YS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CisrKyBiL0RvY3VtZW50YXRpb24vdmly
dC9rdm0va3ZtaS5yc3QKQEAgLTg0MCw2ICs4NDAsMzQgQEAgUmV0dXJucyBhIGJ1ZmZlciBjb250
YWluaW5nIHRoZSBYU0FWRSBhcmVhLgogKiAtS1ZNX0VBR0FJTiAtIHRoZSBzZWxlY3RlZCB2Q1BV
IGNhbid0IGJlIGludHJvc3BlY3RlZCB5ZXQKICogLUtWTV9FTk9NRU0gLSB0aGVyZSBpcyBub3Qg
ZW5vdWdoIG1lbW9yeSB0byBhbGxvY2F0ZSB0aGUgcmVwbHkKIAorMTkuIEtWTUlfVkNQVV9TRVRf
WFNBVkUKKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKKzpBcmNoaXRlY3R1cmVzOiB4ODYKKzpW
ZXJzaW9uczogPj0gMQorOlBhcmFtZXRlcnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2hk
cjsKKwlzdHJ1Y3Qga3ZtaV92Y3B1X3NldF94c2F2ZSB7CisJCXN0cnVjdCBrdm1feHNhdmUgeHNh
dmU7CisJfTsKKworOlJldHVybnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV9lcnJvcl9jb2RlOwor
CitNb2RpZmllcyB0aGUgWFNBVkUgYXJlYS4KKworOkVycm9yczoKKworKiAtS1ZNX0VJTlZBTCAt
IHRoZSBzZWxlY3RlZCB2Q1BVIGlzIGludmFsaWQKKyogLUtWTV9FSU5WQUwgLSB0aGUgcGFkZGlu
ZyBpcyBub3QgemVybworKiAtS1ZNX0VBR0FJTiAtIHRoZSBzZWxlY3RlZCB2Q1BVIGNhbid0IGJl
IGludHJvc3BlY3RlZCB5ZXQKKwogRXZlbnRzCiA9PT09PT0KIApkaWZmIC0tZ2l0IGEvYXJjaC94
ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmggYi9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2
bWkuaAppbmRleCBjNmE0NjI1MmE2ODQuLjg5ZjNkYzkyNjljMSAxMDA2NDQKLS0tIGEvYXJjaC94
ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmgKKysrIGIvYXJjaC94ODYvaW5jbHVkZS91YXBpL2Fz
bS9rdm1pLmgKQEAgLTExNSw0ICsxMTUsOCBAQCBzdHJ1Y3Qga3ZtaV92Y3B1X2dldF94c2F2ZV9y
ZXBseSB7CiAJc3RydWN0IGt2bV94c2F2ZSB4c2F2ZTsKIH07CiAKK3N0cnVjdCBrdm1pX3ZjcHVf
c2V0X3hzYXZlIHsKKwlzdHJ1Y3Qga3ZtX3hzYXZlIHhzYXZlOworfTsKKwogI2VuZGlmIC8qIF9V
QVBJX0FTTV9YODZfS1ZNSV9IICovCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cu
YyBiL2FyY2gveDg2L2t2bS9rdm1pX21zZy5jCmluZGV4IDkwZTE5MjQ0MDQ0YS4uZWNhZDE4ODJj
ZGQ4IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYworKysgYi9hcmNoL3g4Ni9r
dm0va3ZtaV9tc2cuYwpAQCAtMjEzLDYgKzIxMywyNSBAQCBzdGF0aWMgaW50IGhhbmRsZV92Y3B1
X2dldF94c2F2ZShjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X21zZ19qb2IgKmpvYiwKIAlyZXR1cm4g
ZXJyOwogfQogCitzdGF0aWMgaW50IGhhbmRsZV92Y3B1X3NldF94c2F2ZShjb25zdCBzdHJ1Y3Qg
a3ZtaV92Y3B1X21zZ19qb2IgKmpvYiwKKwkJCQkgY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAq
bXNnLAorCQkJCSBjb25zdCB2b2lkICpyZXEpCit7CisJY29uc3Qgc3RydWN0IGt2bV94c2F2ZSAq
YXJlYSA9IHJlcTsKKwlzaXplX3QgY21kX3NpemU7CisJaW50IGVjID0gMDsKKworCWNtZF9zaXpl
ID0gc2l6ZW9mKHN0cnVjdCBrdm1pX3ZjcHVfaGRyKSArIHNpemVvZigqYXJlYSk7CisKKwlpZiAo
Y21kX3NpemUgPiBtc2ctPnNpemUpCisJCWVjID0gLUtWTV9FSU5WQUw7CisJZWxzZSBpZiAoa3Zt
X3ZjcHVfaW9jdGxfeDg2X3NldF94c2F2ZShqb2ItPnZjcHUsCisJCQkJCSAgICAgIChzdHJ1Y3Qg
a3ZtX3hzYXZlICopIGFyZWEpKQorCQllYyA9IC1LVk1fRUlOVkFMOworCisJcmV0dXJuIGt2bWlf
bXNnX3ZjcHVfcmVwbHkoam9iLCBtc2csIGVjLCBOVUxMLCAwKTsKK30KKwogc3RhdGljIGNvbnN0
IGt2bWlfdmNwdV9tc2dfam9iX2ZjdCBtc2dfdmNwdVtdID0gewogCVtLVk1JX1ZDUFVfQ09OVFJP
TF9DUl0gICAgICAgPSBoYW5kbGVfdmNwdV9jb250cm9sX2NyLAogCVtLVk1JX1ZDUFVfR0VUX0NQ
VUlEXSAgICAgICAgPSBoYW5kbGVfdmNwdV9nZXRfY3B1aWQsCkBAIC0yMjIsNiArMjQxLDcgQEAg
c3RhdGljIGNvbnN0IGt2bWlfdmNwdV9tc2dfam9iX2ZjdCBtc2dfdmNwdVtdID0gewogCVtLVk1J
X1ZDUFVfR0VUX1hTQVZFXSAgICAgICAgPSBoYW5kbGVfdmNwdV9nZXRfeHNhdmUsCiAJW0tWTUlf
VkNQVV9JTkpFQ1RfRVhDRVBUSU9OXSA9IGhhbmRsZV92Y3B1X2luamVjdF9leGNlcHRpb24sCiAJ
W0tWTUlfVkNQVV9TRVRfUkVHSVNURVJTXSAgICA9IGhhbmRsZV92Y3B1X3NldF9yZWdpc3RlcnMs
CisJW0tWTUlfVkNQVV9TRVRfWFNBVkVdICAgICAgICA9IGhhbmRsZV92Y3B1X3NldF94c2F2ZSwK
IH07CiAKIGt2bWlfdmNwdV9tc2dfam9iX2ZjdCBrdm1pX2FyY2hfdmNwdV9tc2dfaGFuZGxlcih1
MTYgaWQpCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oIGIvaW5jbHVkZS91
YXBpL2xpbnV4L2t2bWkuaAppbmRleCBiOTk3NjNlNTgwZTQuLjQ2NzFlMGUzY2I0NSAxMDA2NDQK
LS0tIGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAorKysgYi9pbmNsdWRlL3VhcGkvbGludXgv
a3ZtaS5oCkBAIC00NSw2ICs0NSw3IEBAIGVudW0gewogCUtWTUlfVkNQVV9JTkpFQ1RfRVhDRVBU
SU9OID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoNyksCiAJS1ZNSV9WQ1BVX0dFVF9YQ1IgICAgICAg
ICAgPSBLVk1JX1ZDUFVfTUVTU0FHRV9JRCg4KSwKIAlLVk1JX1ZDUFVfR0VUX1hTQVZFICAgICAg
ICA9IEtWTUlfVkNQVV9NRVNTQUdFX0lEKDkpLAorCUtWTUlfVkNQVV9TRVRfWFNBVkUgICAgICAg
ID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoMTApLAogCiAJS1ZNSV9ORVhUX1ZDUFVfTUVTU0FHRQog
fTsKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90
ZXN0LmMgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCmlu
ZGV4IGE5YWIwZTk3MzM0MC4uYWRhYzBlZGRkYzUwIDEwMDY0NAotLS0gYS90b29scy90ZXN0aW5n
L3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCisrKyBiL3Rvb2xzL3Rlc3Rpbmcvc2Vs
ZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKQEAgLTE0MzcsMjEgKzE0MzcsMzUgQEAgc3Rh
dGljIHZvaWQgdGVzdF9jbWRfdmNwdV9nZXRfeGNyKHN0cnVjdCBrdm1fdm0gKnZtKQogCWNtZF92
Y3B1X2dldF94Y3Iodm0sIHhjcjEsICZ2YWx1ZSwgLUtWTV9FSU5WQUwpOwogfQogCi1zdGF0aWMg
dm9pZCBjbWRfdmNwdV9nZXRfeHNhdmUoc3RydWN0IGt2bV92bSAqdm0pCitzdGF0aWMgdm9pZCBj
bWRfdmNwdV9nZXRfeHNhdmUoc3RydWN0IGt2bV92bSAqdm0sIHN0cnVjdCBrdm1feHNhdmUgKnJw
bCkKIHsKIAlzdHJ1Y3QgewogCQlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKIAkJc3RydWN0IGt2
bWlfdmNwdV9oZHIgdmNwdV9oZHI7CiAJfSByZXEgPSB7fTsKLQlzdHJ1Y3Qga3ZtX3hzYXZlIHJw
bDsKIAogCXRlc3RfdmNwdTBfY29tbWFuZCh2bSwgS1ZNSV9WQ1BVX0dFVF9YU0FWRSwgJnJlcS5o
ZHIsIHNpemVvZihyZXEpLAotCQkJICAgJnJwbCwgc2l6ZW9mKHJwbCksIDApOworCQkJICAgcnBs
LCBzaXplb2YoKnJwbCksIDApOworfQorCitzdGF0aWMgdm9pZCBjbWRfdmNwdV9zZXRfeHNhdmUo
c3RydWN0IGt2bV92bSAqdm0sIHN0cnVjdCBrdm1feHNhdmUgKnJwbCkKK3sKKwlzdHJ1Y3Qgewor
CQlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwkJc3RydWN0IGt2bWlfdmNwdV9oZHIgdmNwdV9o
ZHI7CisJCXN0cnVjdCBrdm1feHNhdmUgeHNhdmU7CisJfSByZXEgPSB7fTsKKworCW1lbWNweSgm
cmVxLnhzYXZlLCBycGwsIHNpemVvZigqcnBsKSk7CisKKwl0ZXN0X3ZjcHUwX2NvbW1hbmQodm0s
IEtWTUlfVkNQVV9TRVRfWFNBVkUsICZyZXEuaGRyLCBzaXplb2YocmVxKSwKKwkJCSAgIE5VTEws
IDAsIDApOwogfQogCi1zdGF0aWMgdm9pZCB0ZXN0X2NtZF92Y3B1X2dldF94c2F2ZShzdHJ1Y3Qg
a3ZtX3ZtICp2bSkKK3N0YXRpYyB2b2lkIHRlc3RfY21kX3ZjcHVfeHNhdmUoc3RydWN0IGt2bV92
bSAqdm0pCiB7CiAJc3RydWN0IGt2bV9jcHVpZF9lbnRyeTIgKmVudHJ5OworCXN0cnVjdCBrdm1f
eHNhdmUgeHNhdmU7CiAKIAllbnRyeSA9IGt2bV9nZXRfc3VwcG9ydGVkX2NwdWlkX2VudHJ5KDEp
OwogCWlmICghKGVudHJ5LT5lY3ggJiBYODZfRkVBVFVSRV9YU0FWRSkpIHsKQEAgLTE0NTksNyAr
MTQ3Myw4IEBAIHN0YXRpYyB2b2lkIHRlc3RfY21kX3ZjcHVfZ2V0X3hzYXZlKHN0cnVjdCBrdm1f
dm0gKnZtKQogCQlyZXR1cm47CiAJfQogCi0JY21kX3ZjcHVfZ2V0X3hzYXZlKHZtKTsKKwljbWRf
dmNwdV9nZXRfeHNhdmUodm0sICZ4c2F2ZSk7CisJY21kX3ZjcHVfc2V0X3hzYXZlKHZtLCAmeHNh
dmUpOwogfQogCiBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAq
dm0pCkBAIC0xNDg5LDcgKzE1MDQsNyBAQCBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24o
c3RydWN0IGt2bV92bSAqdm0pCiAJdGVzdF9jbWRfdmNwdV9pbmplY3RfZXhjZXB0aW9uKHZtKTsK
IAl0ZXN0X2V2ZW50X3hzZXRidih2bSk7CiAJdGVzdF9jbWRfdmNwdV9nZXRfeGNyKHZtKTsKLQl0
ZXN0X2NtZF92Y3B1X2dldF94c2F2ZSh2bSk7CisJdGVzdF9jbWRfdmNwdV94c2F2ZSh2bSk7CiAK
IAl1bmhvb2tfaW50cm9zcGVjdGlvbih2bSk7CiB9Cl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFs
aXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91
bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
