Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
	by mail.lfdr.de (Postfix) with ESMTPS id 23278714572
	for <lists.virtualization@lfdr.de>; Mon, 29 May 2023 09:28:20 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id 0A38360EFA;
	Mon, 29 May 2023 07:28:18 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 0A38360EFA
Authentication-Results: smtp3.osuosl.org;
	dkim=fail reason="signature verification failed" (2048-bit key) header.d=gmail.com header.i=@gmail.com header.a=rsa-sha256 header.s=20221208 header.b=ZsQGiE+/
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Yi4Br30MtEys; Mon, 29 May 2023 07:28:16 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp3.osuosl.org (Postfix) with ESMTPS id 4C27E611F6;
	Mon, 29 May 2023 07:28:16 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 4C27E611F6
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 9928FC0089;
	Mon, 29 May 2023 07:28:15 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [IPv6:2605:bc80:3010::133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id E221DC002A
 for <virtualization@lists.linux-foundation.org>;
 Mon, 29 May 2023 07:28:13 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id B6AAF417B3
 for <virtualization@lists.linux-foundation.org>;
 Mon, 29 May 2023 07:28:13 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org B6AAF417B3
Authentication-Results: smtp2.osuosl.org;
 dkim=pass (2048-bit key) header.d=gmail.com header.i=@gmail.com
 header.a=rsa-sha256 header.s=20221208 header.b=ZsQGiE+/
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id H5vr0Ms9PdvY
 for <virtualization@lists.linux-foundation.org>;
 Mon, 29 May 2023 07:28:12 +0000 (UTC)
X-Greylist: whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org D5A674032C
Received: from mail-lj1-x22f.google.com (mail-lj1-x22f.google.com
 [IPv6:2a00:1450:4864:20::22f])
 by smtp2.osuosl.org (Postfix) with ESMTPS id D5A674032C
 for <virtualization@lists.linux-foundation.org>;
 Mon, 29 May 2023 07:28:11 +0000 (UTC)
Received: by mail-lj1-x22f.google.com with SMTP id
 38308e7fff4ca-2af31dc49f9so31845521fa.0
 for <virtualization@lists.linux-foundation.org>;
 Mon, 29 May 2023 00:28:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20221208; t=1685345289; x=1687937289;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:from:to:cc:subject:date
 :message-id:reply-to;
 bh=pDIUn7szt3oUTg98VtlKJJ/lmLURgK8HSXpwwAsfwfA=;
 b=ZsQGiE+/1L86OHLaExPLPJbNfQ2WkWZlqM0vcDzojVn2YZdFmcjUupDL3cag7u2kl2
 tw55/4qR0/FU4IIZKeTAYOTp9/79A8Pu6y9O2f307RhvILsNDpx+6jfVR29LfvTb11L0
 5CAaqvM/0lC9zd++rTsWmAiFUpI+oS1mfetSyoBKYZsvoOtJijfa6zYR9WQiCf2t40IE
 yZn9UuJVJr2uVFdWpcrE+LyPy4CbPg3pjeNwTn/DAPQ3BVn6lfkaquSZa3DH/Tb5Vbc7
 bcmalu6EhoCgN05Kjw8q/PDb6DLYhU6fYDtNz5IzfPeRRxQ9MUVNgQxAbHCLoicytyEm
 OG7Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20221208; t=1685345289; x=1687937289;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=pDIUn7szt3oUTg98VtlKJJ/lmLURgK8HSXpwwAsfwfA=;
 b=FeIqPWjaTfVX8+kwhcUhg6T9P8u2jJpQlzi9qkB1ji68J5MLnXRv6/S/oegpTXbWi1
 is38sTJIGCMVOCC4hN3Wchslc8ETitn293LfsqNb+6TFfdOqSbBBFIXPh8sEQHnebe7s
 yQrKFZTo0onhCsU7lJKj0eEf6cYrD1i/FwPQlpcN+fb0bFXarKVPhPEazzICPsS/ykXm
 15JQ5kRImMz4+gWhrf1SrgeEPuMYzIdHpikBr3rUztGKk23lPawlFBBLyBAX6tAcb1B3
 h0pIxsZi2P26OCIwKY6PpBEL9jdxnv3H8jQvIu8w/W27ta+HiJr7ZbiLJmyD3LtNVSU0
 3t6A==
X-Gm-Message-State: AC+VfDyJ8ksahO0RKd6rZzbJ+Zis+OSj+nlOwS7p1aV9Qaj61v5sqSqI
 CF0rEsyGGkMWdlgL/c86QMj/UqN2K+8UeClU6Sg=
X-Google-Smtp-Source: ACHHUZ5eHnGX4jlJbVYocQ1wcF0Q0p/x6g/4e92h9IQ7LtTCzJSK06938TVpX9CvbDsb0SMhRlTwffEW04YjaPb80gY=
X-Received: by 2002:a2e:7a03:0:b0:2af:164c:fe2 with SMTP id
 v3-20020a2e7a03000000b002af164c0fe2mr3695743ljc.5.1685345289069; Mon, 29 May
 2023 00:28:09 -0700 (PDT)
MIME-Version: 1.0
References: <20230526054621.18371-1-liangchen.linux@gmail.com>
 <20230526054621.18371-2-liangchen.linux@gmail.com>
 <20230528021708-mutt-send-email-mst@kernel.org>
In-Reply-To: <20230528021708-mutt-send-email-mst@kernel.org>
From: Liang Chen <liangchen.linux@gmail.com>
Date: Mon, 29 May 2023 15:27:56 +0800
Message-ID: <CAKhg4tKzW6akbKLvg1UFpey+Lkiic3hBWh87jyg-a8ASchPvMA@mail.gmail.com>
Subject: Re: [PATCH net-next 2/5] virtio_net: Add page_pool support to improve
 performance
To: "Michael S. Tsirkin" <mst@redhat.com>
Cc: xuanzhuo@linux.alibaba.com, netdev@vger.kernel.org,
 linux-kernel@vger.kernel.org, alexander.duyck@gmail.com,
 virtualization@lists.linux-foundation.org, edumazet@google.com,
 kuba@kernel.org, pabeni@redhat.com, davem@davemloft.net
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gU3VuLCBNYXkgMjgsIDIwMjMgYXQgMjoyMOKAr1BNIE1pY2hhZWwgUy4gVHNpcmtpbiA8bXN0
QHJlZGhhdC5jb20+IHdyb3RlOgo+Cj4gT24gRnJpLCBNYXkgMjYsIDIwMjMgYXQgMDE6NDY6MThQ
TSArMDgwMCwgTGlhbmcgQ2hlbiB3cm90ZToKPiA+IFRoZSBpbXBsZW1lbnRhdGlvbiBhdCB0aGUg
bW9tZW50IHVzZXMgb25lIHBhZ2UgcGVyIHBhY2tldCBpbiBib3RoIHRoZQo+ID4gbm9ybWFsIGFu
ZCBYRFAgcGF0aC4gSW4gYWRkaXRpb24sIGludHJvZHVjaW5nIGEgbW9kdWxlIHBhcmFtZXRlciB0
byBlbmFibGUKPiA+IG9yIGRpc2FibGUgdGhlIHVzYWdlIG9mIHBhZ2UgcG9vbCAoZGlzYWJsZWQg
YnkgZGVmYXVsdCkuCj4gPgo+ID4gSW4gc2luZ2xlLWNvcmUgdm0gdGVzdGluZyBlbnZpcm9ubWVu
dHMsIGl0IGdpdmVzIGEgbW9kZXN0IHBlcmZvcm1hbmNlIGdhaW4KPiA+IGluIHRoZSBub3JtYWwg
cGF0aC4KPiA+ICAgVXBzdHJlYW0gY29kZWJhc2U6IDQ3LjUgR2JpdHMvc2VjCj4gPiAgIFVwc3Ry
ZWFtIGNvZGViYXNlICsgcGFnZV9wb29sIHN1cHBvcnQ6IDUwLjIgR2JpdHMvc2VjCj4gPgo+ID4g
SW4gbXVsdGktY29yZSB2bSB0ZXN0aW5nIGVudmlyb25tZW50cywgVGhlIG1vc3Qgc2lnbmlmaWNh
bnQgcGVyZm9ybWFuY2UKPiA+IGdhaW4gaXMgb2JzZXJ2ZWQgaW4gWERQIGNwdW1hcDoKPiA+ICAg
VXBzdHJlYW0gY29kZWJhc2U6IDEuMzggR2JpdHMvc2VjCj4gPiAgIFVwc3RyZWFtIGNvZGViYXNl
ICsgcGFnZV9wb29sIHN1cHBvcnQ6IDkuNzQgR2JpdHMvc2VjCj4gPgo+ID4gV2l0aCB0aGlzIGZv
dW5kYXRpb24sIHdlIGNhbiBmdXJ0aGVyIGludGVncmF0ZSBwYWdlIHBvb2wgZnJhZ21lbnRhdGlv
biBhbmQKPiA+IERNQSBtYXAvdW5tYXAgc3VwcG9ydC4KPiA+Cj4gPiBTaWduZWQtb2ZmLWJ5OiBM
aWFuZyBDaGVuIDxsaWFuZ2NoZW4ubGludXhAZ21haWwuY29tPgo+Cj4gV2h5IG9mZiBieSBkZWZh
dWx0Pwo+IEkgYW0gZ3Vlc3NpbmcgaXQgc29tZXRpbWVzIGhhcyBwZXJmb3JtYW5jZSBjb3N0cyB0
b28/Cj4KPgo+IFdoYXQgaGFwcGVucyBpZiB3ZSB1c2UgcGFnZSBwb29sIGZvciBiaWcgbW9kZSB0
b28/Cj4gVGhlIGxlc3MgbW9kZXMgd2UgaGF2ZSB0aGUgYmV0dGVyLi4uCj4KPgoKU3VyZSwgbm93
IEkgYmVsaWV2ZSBpdCBtYWtlcyBzZW5zZSB0byBlbmFibGUgaXQgYnkgZGVmYXVsdC4gV2hlbiB0
aGUKcGFja2V0IHNpemUgaXMgdmVyeSBzbWFsbCwgaXQgcmVkdWNlcyB0aGUgbGlrZWxpaG9vZCBv
ZiBza2IKY29hbGVzY2luZy4gQnV0IHN1Y2ggY2FzZXMgYXJlIHJhcmUuClRoZSB1c2FnZSBvZiBw
YWdlIHBvb2wgZm9yIGJpZyBtb2RlIGlzIGJlaW5nIGV2YWx1YXRlZCBub3cuIFRoYW5rcyEKCj4g
PiAtLS0KPiA+ICBkcml2ZXJzL25ldC92aXJ0aW9fbmV0LmMgfCAxODggKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrLS0tLS0tLS0tCj4gPiAgMSBmaWxlIGNoYW5nZWQsIDE0NiBpbnNlcnRp
b25zKCspLCA0MiBkZWxldGlvbnMoLSkKPiA+Cj4gPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9uZXQv
dmlydGlvX25ldC5jIGIvZHJpdmVycy9uZXQvdmlydGlvX25ldC5jCj4gPiBpbmRleCBjNWRjYTBk
OTJlNjQuLjk5YzBjYTBjMTc4MSAxMDA2NDQKPiA+IC0tLSBhL2RyaXZlcnMvbmV0L3ZpcnRpb19u
ZXQuYwo+ID4gKysrIGIvZHJpdmVycy9uZXQvdmlydGlvX25ldC5jCj4gPiBAQCAtMzEsNiArMzEs
OSBAQCBtb2R1bGVfcGFyYW0oY3N1bSwgYm9vbCwgMDQ0NCk7Cj4gPiAgbW9kdWxlX3BhcmFtKGdz
bywgYm9vbCwgMDQ0NCk7Cj4gPiAgbW9kdWxlX3BhcmFtKG5hcGlfdHgsIGJvb2wsIDA2NDQpOwo+
ID4KPiA+ICtzdGF0aWMgYm9vbCBwYWdlX3Bvb2xfZW5hYmxlZDsKPiA+ICttb2R1bGVfcGFyYW0o
cGFnZV9wb29sX2VuYWJsZWQsIGJvb2wsIDA0MDApOwo+ID4gKwo+ID4gIC8qIEZJWE1FOiBNVFUg
aW4gY29uZmlnLiAqLwo+ID4gICNkZWZpbmUgR09PRF9QQUNLRVRfTEVOIChFVEhfSExFTiArIFZM
QU5fSExFTiArIEVUSF9EQVRBX0xFTikKPiA+ICAjZGVmaW5lIEdPT0RfQ09QWV9MRU4gICAgICAg
IDEyOAo+ID4gQEAgLTE1OSw2ICsxNjIsOSBAQCBzdHJ1Y3QgcmVjZWl2ZV9xdWV1ZSB7Cj4gPiAg
ICAgICAvKiBDaGFpbiBwYWdlcyBieSB0aGUgcHJpdmF0ZSBwdHIuICovCj4gPiAgICAgICBzdHJ1
Y3QgcGFnZSAqcGFnZXM7Cj4gPgo+ID4gKyAgICAgLyogUGFnZSBwb29sICovCj4gPiArICAgICBz
dHJ1Y3QgcGFnZV9wb29sICpwYWdlX3Bvb2w7Cj4gPiArCj4gPiAgICAgICAvKiBBdmVyYWdlIHBh
Y2tldCBsZW5ndGggZm9yIG1lcmdlYWJsZSByZWNlaXZlIGJ1ZmZlcnMuICovCj4gPiAgICAgICBz
dHJ1Y3QgZXdtYV9wa3RfbGVuIG1yZ19hdmdfcGt0X2xlbjsKPiA+Cj4gPiBAQCAtNDU5LDYgKzQ2
NSwxNCBAQCBzdGF0aWMgc3RydWN0IHNrX2J1ZmYgKnZpcnRuZXRfYnVpbGRfc2tiKHZvaWQgKmJ1
ZiwgdW5zaWduZWQgaW50IGJ1ZmxlbiwKPiA+ICAgICAgIHJldHVybiBza2I7Cj4gPiAgfQo+ID4K
PiA+ICtzdGF0aWMgdm9pZCB2aXJ0bmV0X3B1dF9wYWdlKHN0cnVjdCByZWNlaXZlX3F1ZXVlICpy
cSwgc3RydWN0IHBhZ2UgKnBhZ2UpCj4gPiArewo+ID4gKyAgICAgaWYgKHJxLT5wYWdlX3Bvb2wp
Cj4gPiArICAgICAgICAgICAgIHBhZ2VfcG9vbF9wdXRfZnVsbF9wYWdlKHJxLT5wYWdlX3Bvb2ws
IHBhZ2UsIHRydWUpOwo+ID4gKyAgICAgZWxzZQo+ID4gKyAgICAgICAgICAgICBwdXRfcGFnZShw
YWdlKTsKPiA+ICt9Cj4gPiArCj4gPiAgLyogQ2FsbGVkIGZyb20gYm90dG9tIGhhbGYgY29udGV4
dCAqLwo+ID4gIHN0YXRpYyBzdHJ1Y3Qgc2tfYnVmZiAqcGFnZV90b19za2Ioc3RydWN0IHZpcnRu
ZXRfaW5mbyAqdmksCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
cmVjZWl2ZV9xdWV1ZSAqcnEsCj4gPiBAQCAtNTU1LDcgKzU2OSw3IEBAIHN0YXRpYyBzdHJ1Y3Qg
c2tfYnVmZiAqcGFnZV90b19za2Ioc3RydWN0IHZpcnRuZXRfaW5mbyAqdmksCj4gPiAgICAgICBo
ZHIgPSBza2Jfdm5ldF9oZHIoc2tiKTsKPiA+ICAgICAgIG1lbWNweShoZHIsIGhkcl9wLCBoZHJf
bGVuKTsKPiA+ICAgICAgIGlmIChwYWdlX3RvX2ZyZWUpCj4gPiAtICAgICAgICAgICAgIHB1dF9w
YWdlKHBhZ2VfdG9fZnJlZSk7Cj4gPiArICAgICAgICAgICAgIHZpcnRuZXRfcHV0X3BhZ2UocnEs
IHBhZ2VfdG9fZnJlZSk7Cj4gPgo+ID4gICAgICAgcmV0dXJuIHNrYjsKPiA+ICB9Cj4gPiBAQCAt
ODAyLDcgKzgxNiw3IEBAIHN0YXRpYyBpbnQgdmlydG5ldF94ZHBfeG1pdChzdHJ1Y3QgbmV0X2Rl
dmljZSAqZGV2LAo+ID4gICAgICAgcmV0dXJuIHJldDsKPiA+ICB9Cj4gPgo+ID4gLXN0YXRpYyB2
b2lkIHB1dF94ZHBfZnJhZ3Moc3RydWN0IHhkcF9idWZmICp4ZHApCj4gPiArc3RhdGljIHZvaWQg
cHV0X3hkcF9mcmFncyhzdHJ1Y3QgeGRwX2J1ZmYgKnhkcCwgc3RydWN0IHJlY2VpdmVfcXVldWUg
KnJxKQo+ID4gIHsKPiA+ICAgICAgIHN0cnVjdCBza2Jfc2hhcmVkX2luZm8gKnNoaW5mbzsKPiA+
ICAgICAgIHN0cnVjdCBwYWdlICp4ZHBfcGFnZTsKPiA+IEBAIC04MTIsNyArODI2LDcgQEAgc3Rh
dGljIHZvaWQgcHV0X3hkcF9mcmFncyhzdHJ1Y3QgeGRwX2J1ZmYgKnhkcCkKPiA+ICAgICAgICAg
ICAgICAgc2hpbmZvID0geGRwX2dldF9zaGFyZWRfaW5mb19mcm9tX2J1ZmYoeGRwKTsKPiA+ICAg
ICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNoaW5mby0+bnJfZnJhZ3M7IGkrKykgewo+ID4g
ICAgICAgICAgICAgICAgICAgICAgIHhkcF9wYWdlID0gc2tiX2ZyYWdfcGFnZSgmc2hpbmZvLT5m
cmFnc1tpXSk7Cj4gPiAtICAgICAgICAgICAgICAgICAgICAgcHV0X3BhZ2UoeGRwX3BhZ2UpOwo+
ID4gKyAgICAgICAgICAgICAgICAgICAgIHZpcnRuZXRfcHV0X3BhZ2UocnEsIHhkcF9wYWdlKTsK
PiA+ICAgICAgICAgICAgICAgfQo+ID4gICAgICAgfQo+ID4gIH0KPiA+IEBAIC05MDMsNyArOTE3
LDExIEBAIHN0YXRpYyBzdHJ1Y3QgcGFnZSAqeGRwX2xpbmVhcml6ZV9wYWdlKHN0cnVjdCByZWNl
aXZlX3F1ZXVlICpycSwKPiA+ICAgICAgIGlmIChwYWdlX29mZiArICpsZW4gKyB0YWlscm9vbSA+
IFBBR0VfU0laRSkKPiA+ICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7Cj4gPgo+ID4gLSAgICAg
cGFnZSA9IGFsbG9jX3BhZ2UoR0ZQX0FUT01JQyk7Cj4gPiArICAgICBpZiAocnEtPnBhZ2VfcG9v
bCkKPiA+ICsgICAgICAgICAgICAgcGFnZSA9IHBhZ2VfcG9vbF9kZXZfYWxsb2NfcGFnZXMocnEt
PnBhZ2VfcG9vbCk7Cj4gPiArICAgICBlbHNlCj4gPiArICAgICAgICAgICAgIHBhZ2UgPSBhbGxv
Y19wYWdlKEdGUF9BVE9NSUMpOwo+ID4gKwo+ID4gICAgICAgaWYgKCFwYWdlKQo+ID4gICAgICAg
ICAgICAgICByZXR1cm4gTlVMTDsKPiA+Cj4gPiBAQCAtOTI2LDIxICs5NDQsMjQgQEAgc3RhdGlj
IHN0cnVjdCBwYWdlICp4ZHBfbGluZWFyaXplX3BhZ2Uoc3RydWN0IHJlY2VpdmVfcXVldWUgKnJx
LAo+ID4gICAgICAgICAgICAgICAgKiBpcyBzZW5kaW5nIHBhY2tldCBsYXJnZXIgdGhhbiB0aGUg
TVRVLgo+ID4gICAgICAgICAgICAgICAgKi8KPiA+ICAgICAgICAgICAgICAgaWYgKChwYWdlX29m
ZiArIGJ1ZmxlbiArIHRhaWxyb29tKSA+IFBBR0VfU0laRSkgewo+ID4gLSAgICAgICAgICAgICAg
ICAgICAgIHB1dF9wYWdlKHApOwo+ID4gKyAgICAgICAgICAgICAgICAgICAgIHZpcnRuZXRfcHV0
X3BhZ2UocnEsIHApOwo+ID4gICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZXJyX2J1ZjsKPiA+
ICAgICAgICAgICAgICAgfQo+ID4KPiA+ICAgICAgICAgICAgICAgbWVtY3B5KHBhZ2VfYWRkcmVz
cyhwYWdlKSArIHBhZ2Vfb2ZmLAo+ID4gICAgICAgICAgICAgICAgICAgICAgcGFnZV9hZGRyZXNz
KHApICsgb2ZmLCBidWZsZW4pOwo+ID4gICAgICAgICAgICAgICBwYWdlX29mZiArPSBidWZsZW47
Cj4gPiAtICAgICAgICAgICAgIHB1dF9wYWdlKHApOwo+ID4gKyAgICAgICAgICAgICB2aXJ0bmV0
X3B1dF9wYWdlKHJxLCBwKTsKPiA+ICAgICAgIH0KPiA+Cj4gPiAgICAgICAvKiBIZWFkcm9vbSBk
b2VzIG5vdCBjb250cmlidXRlIHRvIHBhY2tldCBsZW5ndGggKi8KPiA+ICAgICAgICpsZW4gPSBw
YWdlX29mZiAtIFZJUlRJT19YRFBfSEVBRFJPT007Cj4gPiAgICAgICByZXR1cm4gcGFnZTsKPiA+
ICBlcnJfYnVmOgo+ID4gLSAgICAgX19mcmVlX3BhZ2VzKHBhZ2UsIDApOwo+ID4gKyAgICAgaWYg
KHJxLT5wYWdlX3Bvb2wpCj4gPiArICAgICAgICAgICAgIHBhZ2VfcG9vbF9wdXRfZnVsbF9wYWdl
KHJxLT5wYWdlX3Bvb2wsIHBhZ2UsIHRydWUpOwo+ID4gKyAgICAgZWxzZQo+ID4gKyAgICAgICAg
ICAgICBfX2ZyZWVfcGFnZXMocGFnZSwgMCk7Cj4gPiAgICAgICByZXR1cm4gTlVMTDsKPiA+ICB9
Cj4gPgo+ID4gQEAgLTExNDQsNyArMTE2NSw3IEBAIHN0YXRpYyB2b2lkIG1lcmdlYWJsZV9idWZf
ZnJlZShzdHJ1Y3QgcmVjZWl2ZV9xdWV1ZSAqcnEsIGludCBudW1fYnVmLAo+ID4gICAgICAgICAg
ICAgICB9Cj4gPiAgICAgICAgICAgICAgIHN0YXRzLT5ieXRlcyArPSBsZW47Cj4gPiAgICAgICAg
ICAgICAgIHBhZ2UgPSB2aXJ0X3RvX2hlYWRfcGFnZShidWYpOwo+ID4gLSAgICAgICAgICAgICBw
dXRfcGFnZShwYWdlKTsKPiA+ICsgICAgICAgICAgICAgdmlydG5ldF9wdXRfcGFnZShycSwgcGFn
ZSk7Cj4gPiAgICAgICB9Cj4gPiAgfQo+ID4KPiA+IEBAIC0xMjY0LDcgKzEyODUsNyBAQCBzdGF0
aWMgaW50IHZpcnRuZXRfYnVpbGRfeGRwX2J1ZmZfbXJnKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYs
Cj4gPiAgICAgICAgICAgICAgIGN1cl9mcmFnX3NpemUgPSB0cnVlc2l6ZTsKPiA+ICAgICAgICAg
ICAgICAgeGRwX2ZyYWdzX3RydWVzeiArPSBjdXJfZnJhZ19zaXplOwo+ID4gICAgICAgICAgICAg
ICBpZiAodW5saWtlbHkobGVuID4gdHJ1ZXNpemUgLSByb29tIHx8IGN1cl9mcmFnX3NpemUgPiBQ
QUdFX1NJWkUpKSB7Cj4gPiAtICAgICAgICAgICAgICAgICAgICAgcHV0X3BhZ2UocGFnZSk7Cj4g
PiArICAgICAgICAgICAgICAgICAgICAgdmlydG5ldF9wdXRfcGFnZShycSwgcGFnZSk7Cj4gPiAg
ICAgICAgICAgICAgICAgICAgICAgcHJfZGVidWcoIiVzOiByeCBlcnJvcjogbGVuICV1IGV4Y2Vl
ZHMgdHJ1ZXNpemUgJWx1XG4iLAo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRl
di0+bmFtZSwgbGVuLCAodW5zaWduZWQgbG9uZykodHJ1ZXNpemUgLSByb29tKSk7Cj4gPiAgICAg
ICAgICAgICAgICAgICAgICAgZGV2LT5zdGF0cy5yeF9sZW5ndGhfZXJyb3JzKys7Cj4gPiBAQCAt
MTI4Myw3ICsxMzA0LDcgQEAgc3RhdGljIGludCB2aXJ0bmV0X2J1aWxkX3hkcF9idWZmX21yZyhz
dHJ1Y3QgbmV0X2RldmljZSAqZGV2LAo+ID4gICAgICAgcmV0dXJuIDA7Cj4gPgo+ID4gIGVycjoK
PiA+IC0gICAgIHB1dF94ZHBfZnJhZ3MoeGRwKTsKPiA+ICsgICAgIHB1dF94ZHBfZnJhZ3MoeGRw
LCBycSk7Cj4gPiAgICAgICByZXR1cm4gLUVJTlZBTDsKPiA+ICB9Cj4gPgo+ID4gQEAgLTEzNDQs
NyArMTM2NSwxMCBAQCBzdGF0aWMgdm9pZCAqbWVyZ2VhYmxlX3hkcF9nZXRfYnVmKHN0cnVjdCB2
aXJ0bmV0X2luZm8gKnZpLAo+ID4gICAgICAgICAgICAgICBpZiAoKmxlbiArIHhkcF9yb29tID4g
UEFHRV9TSVpFKQo+ID4gICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwo+ID4KPiA+
IC0gICAgICAgICAgICAgeGRwX3BhZ2UgPSBhbGxvY19wYWdlKEdGUF9BVE9NSUMpOwo+ID4gKyAg
ICAgICAgICAgICBpZiAocnEtPnBhZ2VfcG9vbCkKPiA+ICsgICAgICAgICAgICAgICAgICAgICB4
ZHBfcGFnZSA9IHBhZ2VfcG9vbF9kZXZfYWxsb2NfcGFnZXMocnEtPnBhZ2VfcG9vbCk7Cj4gPiAr
ICAgICAgICAgICAgIGVsc2UKPiA+ICsgICAgICAgICAgICAgICAgICAgICB4ZHBfcGFnZSA9IGFs
bG9jX3BhZ2UoR0ZQX0FUT01JQyk7Cj4gPiAgICAgICAgICAgICAgIGlmICgheGRwX3BhZ2UpCj4g
PiAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7Cj4gPgo+ID4gQEAgLTEzNTQsNyAr
MTM3OCw3IEBAIHN0YXRpYyB2b2lkICptZXJnZWFibGVfeGRwX2dldF9idWYoc3RydWN0IHZpcnRu
ZXRfaW5mbyAqdmksCj4gPgo+ID4gICAgICAgKmZyYW1lX3N6ID0gUEFHRV9TSVpFOwo+ID4KPiA+
IC0gICAgIHB1dF9wYWdlKCpwYWdlKTsKPiA+ICsgICAgIHZpcnRuZXRfcHV0X3BhZ2UocnEsICpw
YWdlKTsKPiA+Cj4gPiAgICAgICAqcGFnZSA9IHhkcF9wYWdlOwo+ID4KPiA+IEBAIC0xNDAwLDYg
KzE0MjQsOCBAQCBzdGF0aWMgc3RydWN0IHNrX2J1ZmYgKnJlY2VpdmVfbWVyZ2VhYmxlX3hkcChz
dHJ1Y3QgbmV0X2RldmljZSAqZGV2LAo+ID4gICAgICAgICAgICAgICBoZWFkX3NrYiA9IGJ1aWxk
X3NrYl9mcm9tX3hkcF9idWZmKGRldiwgdmksICZ4ZHAsIHhkcF9mcmFnc190cnVlc3opOwo+ID4g
ICAgICAgICAgICAgICBpZiAodW5saWtlbHkoIWhlYWRfc2tiKSkKPiA+ICAgICAgICAgICAgICAg
ICAgICAgICBicmVhazsKPiA+ICsgICAgICAgICAgICAgaWYgKHJxLT5wYWdlX3Bvb2wpCj4gPiAr
ICAgICAgICAgICAgICAgICAgICAgc2tiX21hcmtfZm9yX3JlY3ljbGUoaGVhZF9za2IpOwo+ID4g
ICAgICAgICAgICAgICByZXR1cm4gaGVhZF9za2I7Cj4gPgo+ID4gICAgICAgY2FzZSBYRFBfVFg6
Cj4gPiBAQCAtMTQxMCwxMCArMTQzNiwxMCBAQCBzdGF0aWMgc3RydWN0IHNrX2J1ZmYgKnJlY2Vp
dmVfbWVyZ2VhYmxlX3hkcChzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LAo+ID4gICAgICAgICAgICAg
ICBicmVhazsKPiA+ICAgICAgIH0KPiA+Cj4gPiAtICAgICBwdXRfeGRwX2ZyYWdzKCZ4ZHApOwo+
ID4gKyAgICAgcHV0X3hkcF9mcmFncygmeGRwLCBycSk7Cj4gPgo+ID4gIGVycl94ZHA6Cj4gPiAt
ICAgICBwdXRfcGFnZShwYWdlKTsKPiA+ICsgICAgIHZpcnRuZXRfcHV0X3BhZ2UocnEsIHBhZ2Up
Owo+ID4gICAgICAgbWVyZ2VhYmxlX2J1Zl9mcmVlKHJxLCBudW1fYnVmLCBkZXYsIHN0YXRzKTsK
PiA+Cj4gPiAgICAgICBzdGF0cy0+eGRwX2Ryb3BzKys7Cj4gPiBAQCAtMTQ2Nyw2ICsxNDkzLDkg
QEAgc3RhdGljIHN0cnVjdCBza19idWZmICpyZWNlaXZlX21lcmdlYWJsZShzdHJ1Y3QgbmV0X2Rl
dmljZSAqZGV2LAo+ID4gICAgICAgaGVhZF9za2IgPSBwYWdlX3RvX3NrYih2aSwgcnEsIHBhZ2Us
IG9mZnNldCwgbGVuLCB0cnVlc2l6ZSwgaGVhZHJvb20pOwo+ID4gICAgICAgY3Vycl9za2IgPSBo
ZWFkX3NrYjsKPiA+Cj4gPiArICAgICBpZiAocnEtPnBhZ2VfcG9vbCkKPiA+ICsgICAgICAgICAg
ICAgc2tiX21hcmtfZm9yX3JlY3ljbGUoY3Vycl9za2IpOwo+ID4gKwo+ID4gICAgICAgaWYgKHVu
bGlrZWx5KCFjdXJyX3NrYikpCj4gPiAgICAgICAgICAgICAgIGdvdG8gZXJyX3NrYjsKPiA+ICAg
ICAgIHdoaWxlICgtLW51bV9idWYpIHsKPiA+IEBAIC0xNTA5LDYgKzE1MzgsOCBAQCBzdGF0aWMg
c3RydWN0IHNrX2J1ZmYgKnJlY2VpdmVfbWVyZ2VhYmxlKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYs
Cj4gPiAgICAgICAgICAgICAgICAgICAgICAgY3Vycl9za2IgPSBuc2tiOwo+ID4gICAgICAgICAg
ICAgICAgICAgICAgIGhlYWRfc2tiLT50cnVlc2l6ZSArPSBuc2tiLT50cnVlc2l6ZTsKPiA+ICAg
ICAgICAgICAgICAgICAgICAgICBudW1fc2tiX2ZyYWdzID0gMDsKPiA+ICsgICAgICAgICAgICAg
ICAgICAgICBpZiAocnEtPnBhZ2VfcG9vbCkKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHNrYl9tYXJrX2Zvcl9yZWN5Y2xlKGN1cnJfc2tiKTsKPiA+ICAgICAgICAgICAgICAgfQo+
ID4gICAgICAgICAgICAgICBpZiAoY3Vycl9za2IgIT0gaGVhZF9za2IpIHsKPiA+ICAgICAgICAg
ICAgICAgICAgICAgICBoZWFkX3NrYi0+ZGF0YV9sZW4gKz0gbGVuOwo+ID4gQEAgLTE1MTcsNyAr
MTU0OCw3IEBAIHN0YXRpYyBzdHJ1Y3Qgc2tfYnVmZiAqcmVjZWl2ZV9tZXJnZWFibGUoc3RydWN0
IG5ldF9kZXZpY2UgKmRldiwKPiA+ICAgICAgICAgICAgICAgfQo+ID4gICAgICAgICAgICAgICBv
ZmZzZXQgPSBidWYgLSBwYWdlX2FkZHJlc3MocGFnZSk7Cj4gPiAgICAgICAgICAgICAgIGlmIChz
a2JfY2FuX2NvYWxlc2NlKGN1cnJfc2tiLCBudW1fc2tiX2ZyYWdzLCBwYWdlLCBvZmZzZXQpKSB7
Cj4gPiAtICAgICAgICAgICAgICAgICAgICAgcHV0X3BhZ2UocGFnZSk7Cj4gPiArICAgICAgICAg
ICAgICAgICAgICAgdmlydG5ldF9wdXRfcGFnZShycSwgcGFnZSk7Cj4gPiAgICAgICAgICAgICAg
ICAgICAgICAgc2tiX2NvYWxlc2NlX3J4X2ZyYWcoY3Vycl9za2IsIG51bV9za2JfZnJhZ3MgLSAx
LAo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiwgdHJ1
ZXNpemUpOwo+ID4gICAgICAgICAgICAgICB9IGVsc2Ugewo+ID4gQEAgLTE1MzAsNyArMTU2MSw3
IEBAIHN0YXRpYyBzdHJ1Y3Qgc2tfYnVmZiAqcmVjZWl2ZV9tZXJnZWFibGUoc3RydWN0IG5ldF9k
ZXZpY2UgKmRldiwKPiA+ICAgICAgIHJldHVybiBoZWFkX3NrYjsKPiA+Cj4gPiAgZXJyX3NrYjoK
PiA+IC0gICAgIHB1dF9wYWdlKHBhZ2UpOwo+ID4gKyAgICAgdmlydG5ldF9wdXRfcGFnZShycSwg
cGFnZSk7Cj4gPiAgICAgICBtZXJnZWFibGVfYnVmX2ZyZWUocnEsIG51bV9idWYsIGRldiwgc3Rh
dHMpOwo+ID4KPiA+ICBlcnJfYnVmOgo+ID4gQEAgLTE3MzcsMzEgKzE3NjgsNDAgQEAgc3RhdGlj
IGludCBhZGRfcmVjdmJ1Zl9tZXJnZWFibGUoc3RydWN0IHZpcnRuZXRfaW5mbyAqdmksCj4gPiAg
ICAgICAgKiBkaXNhYmxlZCBHU08gZm9yIFhEUCwgaXQgd29uJ3QgYmUgYSBiaWcgaXNzdWUuCj4g
PiAgICAgICAgKi8KPiA+ICAgICAgIGxlbiA9IGdldF9tZXJnZWFibGVfYnVmX2xlbihycSwgJnJx
LT5tcmdfYXZnX3BrdF9sZW4sIHJvb20pOwo+ID4gLSAgICAgaWYgKHVubGlrZWx5KCFza2JfcGFn
ZV9mcmFnX3JlZmlsbChsZW4gKyByb29tLCBhbGxvY19mcmFnLCBnZnApKSkKPiA+IC0gICAgICAg
ICAgICAgcmV0dXJuIC1FTk9NRU07Cj4gPiArICAgICBpZiAocnEtPnBhZ2VfcG9vbCkgewo+ID4g
KyAgICAgICAgICAgICBzdHJ1Y3QgcGFnZSAqcGFnZTsKPiA+Cj4gPiAtICAgICBidWYgPSAoY2hh
ciAqKXBhZ2VfYWRkcmVzcyhhbGxvY19mcmFnLT5wYWdlKSArIGFsbG9jX2ZyYWctPm9mZnNldDsK
PiA+IC0gICAgIGJ1ZiArPSBoZWFkcm9vbTsgLyogYWR2YW5jZSBhZGRyZXNzIGxlYXZpbmcgaG9s
ZSBhdCBmcm9udCBvZiBwa3QgKi8KPiA+IC0gICAgIGdldF9wYWdlKGFsbG9jX2ZyYWctPnBhZ2Up
Owo+ID4gLSAgICAgYWxsb2NfZnJhZy0+b2Zmc2V0ICs9IGxlbiArIHJvb207Cj4gPiAtICAgICBo
b2xlID0gYWxsb2NfZnJhZy0+c2l6ZSAtIGFsbG9jX2ZyYWctPm9mZnNldDsKPiA+IC0gICAgIGlm
IChob2xlIDwgbGVuICsgcm9vbSkgewo+ID4gLSAgICAgICAgICAgICAvKiBUbyBhdm9pZCBpbnRl
cm5hbCBmcmFnbWVudGF0aW9uLCBpZiB0aGVyZSBpcyB2ZXJ5IGxpa2VseSBub3QKPiA+IC0gICAg
ICAgICAgICAgICogZW5vdWdoIHNwYWNlIGZvciBhbm90aGVyIGJ1ZmZlciwgYWRkIHRoZSByZW1h
aW5pbmcgc3BhY2UgdG8KPiA+IC0gICAgICAgICAgICAgICogdGhlIGN1cnJlbnQgYnVmZmVyLgo+
ID4gLSAgICAgICAgICAgICAgKiBYRFAgY29yZSBhc3N1bWVzIHRoYXQgZnJhbWVfc2l6ZSBvZiB4
ZHBfYnVmZiBhbmQgdGhlIGxlbmd0aAo+ID4gLSAgICAgICAgICAgICAgKiBvZiB0aGUgZnJhZyBh
cmUgUEFHRV9TSVpFLCBzbyB3ZSBkaXNhYmxlIHRoZSBob2xlIG1lY2hhbmlzbS4KPiA+IC0gICAg
ICAgICAgICAgICovCj4gPiAtICAgICAgICAgICAgIGlmICghaGVhZHJvb20pCj4gPiAtICAgICAg
ICAgICAgICAgICAgICAgbGVuICs9IGhvbGU7Cj4gPiAtICAgICAgICAgICAgIGFsbG9jX2ZyYWct
Pm9mZnNldCArPSBob2xlOwo+ID4gLSAgICAgfQo+ID4gKyAgICAgICAgICAgICBwYWdlID0gcGFn
ZV9wb29sX2Rldl9hbGxvY19wYWdlcyhycS0+cGFnZV9wb29sKTsKPiA+ICsgICAgICAgICAgICAg
aWYgKHVubGlrZWx5KCFwYWdlKSkKPiA+ICsgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLUVO
T01FTTsKPiA+ICsgICAgICAgICAgICAgYnVmID0gKGNoYXIgKilwYWdlX2FkZHJlc3MocGFnZSk7
Cj4gPiArICAgICAgICAgICAgIGJ1ZiArPSBoZWFkcm9vbTsgLyogYWR2YW5jZSBhZGRyZXNzIGxl
YXZpbmcgaG9sZSBhdCBmcm9udCBvZiBwa3QgKi8KPiA+ICsgICAgIH0gZWxzZSB7Cj4gPiArICAg
ICAgICAgICAgIGlmICh1bmxpa2VseSghc2tiX3BhZ2VfZnJhZ19yZWZpbGwobGVuICsgcm9vbSwg
YWxsb2NfZnJhZywgZ2ZwKSkpCj4gPiArICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9N
RU07Cj4gPgo+ID4gKyAgICAgICAgICAgICBidWYgPSAoY2hhciAqKXBhZ2VfYWRkcmVzcyhhbGxv
Y19mcmFnLT5wYWdlKSArIGFsbG9jX2ZyYWctPm9mZnNldDsKPiA+ICsgICAgICAgICAgICAgYnVm
ICs9IGhlYWRyb29tOyAvKiBhZHZhbmNlIGFkZHJlc3MgbGVhdmluZyBob2xlIGF0IGZyb250IG9m
IHBrdCAqLwo+ID4gKyAgICAgICAgICAgICBnZXRfcGFnZShhbGxvY19mcmFnLT5wYWdlKTsKPiA+
ICsgICAgICAgICAgICAgYWxsb2NfZnJhZy0+b2Zmc2V0ICs9IGxlbiArIHJvb207Cj4gPiArICAg
ICAgICAgICAgIGhvbGUgPSBhbGxvY19mcmFnLT5zaXplIC0gYWxsb2NfZnJhZy0+b2Zmc2V0Owo+
ID4gKyAgICAgICAgICAgICBpZiAoaG9sZSA8IGxlbiArIHJvb20pIHsKPiA+ICsgICAgICAgICAg
ICAgICAgICAgICAvKiBUbyBhdm9pZCBpbnRlcm5hbCBmcmFnbWVudGF0aW9uLCBpZiB0aGVyZSBp
cyB2ZXJ5IGxpa2VseSBub3QKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgKiBlbm91Z2ggc3Bh
Y2UgZm9yIGFub3RoZXIgYnVmZmVyLCBhZGQgdGhlIHJlbWFpbmluZyBzcGFjZSB0bwo+ID4gKyAg
ICAgICAgICAgICAgICAgICAgICAqIHRoZSBjdXJyZW50IGJ1ZmZlci4KPiA+ICsgICAgICAgICAg
ICAgICAgICAgICAgKiBYRFAgY29yZSBhc3N1bWVzIHRoYXQgZnJhbWVfc2l6ZSBvZiB4ZHBfYnVm
ZiBhbmQgdGhlIGxlbmd0aAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAqIG9mIHRoZSBmcmFn
IGFyZSBQQUdFX1NJWkUsIHNvIHdlIGRpc2FibGUgdGhlIGhvbGUgbWVjaGFuaXNtLgo+ID4gKyAg
ICAgICAgICAgICAgICAgICAgICAqLwo+ID4gKyAgICAgICAgICAgICAgICAgICAgIGlmICghaGVh
ZHJvb20pCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4gKz0gaG9sZTsKPiA+
ICsgICAgICAgICAgICAgICAgICAgICBhbGxvY19mcmFnLT5vZmZzZXQgKz0gaG9sZTsKPiA+ICsg
ICAgICAgICAgICAgfQo+ID4gKyAgICAgfQo+ID4gICAgICAgc2dfaW5pdF9vbmUocnEtPnNnLCBi
dWYsIGxlbik7Cj4gPiAgICAgICBjdHggPSBtZXJnZWFibGVfbGVuX3RvX2N0eChsZW4gKyByb29t
LCBoZWFkcm9vbSk7Cj4gPiAgICAgICBlcnIgPSB2aXJ0cXVldWVfYWRkX2luYnVmX2N0eChycS0+
dnEsIHJxLT5zZywgMSwgYnVmLCBjdHgsIGdmcCk7Cj4gPiAgICAgICBpZiAoZXJyIDwgMCkKPiA+
IC0gICAgICAgICAgICAgcHV0X3BhZ2UodmlydF90b19oZWFkX3BhZ2UoYnVmKSk7Cj4gPiArICAg
ICAgICAgICAgIHZpcnRuZXRfcHV0X3BhZ2UocnEsIHZpcnRfdG9faGVhZF9wYWdlKGJ1ZikpOwo+
ID4KPiA+ICAgICAgIHJldHVybiBlcnI7Cj4gPiAgfQo+ID4gQEAgLTE5OTQsOCArMjAzNCwxNSBA
QCBzdGF0aWMgaW50IHZpcnRuZXRfZW5hYmxlX3F1ZXVlX3BhaXIoc3RydWN0IHZpcnRuZXRfaW5m
byAqdmksIGludCBxcF9pbmRleCkKPiA+ICAgICAgIGlmIChlcnIgPCAwKQo+ID4gICAgICAgICAg
ICAgICByZXR1cm4gZXJyOwo+ID4KPiA+IC0gICAgIGVyciA9IHhkcF9yeHFfaW5mb19yZWdfbWVt
X21vZGVsKCZ2aS0+cnFbcXBfaW5kZXhdLnhkcF9yeHEsCj4gPiAtICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBNRU1fVFlQRV9QQUdFX1NIQVJFRCwgTlVMTCk7Cj4gPiArICAg
ICBpZiAodmktPnJxW3FwX2luZGV4XS5wYWdlX3Bvb2wpCj4gPiArICAgICAgICAgICAgIGVyciA9
IHhkcF9yeHFfaW5mb19yZWdfbWVtX21vZGVsKCZ2aS0+cnFbcXBfaW5kZXhdLnhkcF9yeHEsCj4g
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1FTV9UWVBF
X1BBR0VfUE9PTCwKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdmktPnJxW3FwX2luZGV4XS5wYWdlX3Bvb2wpOwo+ID4gKyAgICAgZWxzZQo+ID4gKyAg
ICAgICAgICAgICBlcnIgPSB4ZHBfcnhxX2luZm9fcmVnX21lbV9tb2RlbCgmdmktPnJxW3FwX2lu
ZGV4XS54ZHBfcnhxLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBNRU1fVFlQRV9QQUdFX1NIQVJFRCwKPiA+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCk7Cj4gPiArCj4gPiAgICAgICBpZiAoZXJyIDwg
MCkKPiA+ICAgICAgICAgICAgICAgZ290byBlcnJfeGRwX3JlZ19tZW1fbW9kZWw7Cj4gPgo+ID4g
QEAgLTI5NTEsNiArMjk5OCw3IEBAIHN0YXRpYyB2b2lkIHZpcnRuZXRfZ2V0X3N0cmluZ3Moc3Ry
dWN0IG5ldF9kZXZpY2UgKmRldiwgdTMyIHN0cmluZ3NldCwgdTggKmRhdGEpCj4gPiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBldGh0b29sX3NwcmludGYoJnAsICJ0eF9xdWV1ZV8ldV8l
cyIsIGksCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dmlydG5ldF9zcV9zdGF0c19kZXNjW2pdLmRlc2MpOwo+ID4gICAgICAgICAgICAgICB9Cj4gPiAr
ICAgICAgICAgICAgIHBhZ2VfcG9vbF9ldGh0b29sX3N0YXRzX2dldF9zdHJpbmdzKHApOwo+ID4g
ICAgICAgICAgICAgICBicmVhazsKPiA+ICAgICAgIH0KPiA+ICB9Cj4gPiBAQCAtMjk2MiwxMiAr
MzAxMCwzMCBAQCBzdGF0aWMgaW50IHZpcnRuZXRfZ2V0X3NzZXRfY291bnQoc3RydWN0IG5ldF9k
ZXZpY2UgKmRldiwgaW50IHNzZXQpCj4gPiAgICAgICBzd2l0Y2ggKHNzZXQpIHsKPiA+ICAgICAg
IGNhc2UgRVRIX1NTX1NUQVRTOgo+ID4gICAgICAgICAgICAgICByZXR1cm4gdmktPmN1cnJfcXVl
dWVfcGFpcnMgKiAoVklSVE5FVF9SUV9TVEFUU19MRU4gKwo+ID4gLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgVklSVE5FVF9TUV9TVEFUU19MRU4pOwo+ID4gKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVklSVE5FVF9TUV9TVEFU
U19MRU4gKwo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IChwYWdlX3Bvb2xfZW5hYmxlZCAmJiB2aS0+bWVyZ2VhYmxlX3J4X2J1ZnMgPwo+ID4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlX3Bvb2xfZXRodG9v
bF9zdGF0c19nZXRfY291bnQoKSA6IDApKTsKPiA+ICAgICAgIGRlZmF1bHQ6Cj4gPiAgICAgICAg
ICAgICAgIHJldHVybiAtRU9QTk9UU1VQUDsKPiA+ICAgICAgIH0KPiA+ICB9Cj4gPgo+ID4gK3N0
YXRpYyB2b2lkIHZpcnRuZXRfZ2V0X3BhZ2VfcG9vbF9zdGF0cyhzdHJ1Y3QgbmV0X2RldmljZSAq
ZGV2LCB1NjQgKmRhdGEpCj4gPiArewo+ID4gKyNpZmRlZiBDT05GSUdfUEFHRV9QT09MX1NUQVRT
Cj4gPiArICAgICBzdHJ1Y3QgdmlydG5ldF9pbmZvICp2aSA9IG5ldGRldl9wcml2KGRldik7Cj4g
PiArICAgICBzdHJ1Y3QgcGFnZV9wb29sX3N0YXRzIHBwX3N0YXRzID0ge307Cj4gPiArICAgICBp
bnQgaTsKPiA+ICsKPiA+ICsgICAgIGZvciAoaSA9IDA7IGkgPCB2aS0+Y3Vycl9xdWV1ZV9wYWly
czsgaSsrKSB7Cj4gPiArICAgICAgICAgICAgIGlmICghdmktPnJxW2ldLnBhZ2VfcG9vbCkKPiA+
ICsgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKPiA+ICsgICAgICAgICAgICAgcGFnZV9w
b29sX2dldF9zdGF0cyh2aS0+cnFbaV0ucGFnZV9wb29sLCAmcHBfc3RhdHMpOwo+ID4gKyAgICAg
fQo+ID4gKyAgICAgcGFnZV9wb29sX2V0aHRvb2xfc3RhdHNfZ2V0KGRhdGEsICZwcF9zdGF0cyk7
Cj4gPiArI2VuZGlmIC8qIENPTkZJR19QQUdFX1BPT0xfU1RBVFMgKi8KPiA+ICt9Cj4gPiArCj4g
PiAgc3RhdGljIHZvaWQgdmlydG5ldF9nZXRfZXRodG9vbF9zdGF0cyhzdHJ1Y3QgbmV0X2Rldmlj
ZSAqZGV2LAo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGV0
aHRvb2xfc3RhdHMgKnN0YXRzLCB1NjQgKmRhdGEpCj4gPiAgewo+ID4gQEAgLTMwMDMsNiArMzA2
OSw4IEBAIHN0YXRpYyB2b2lkIHZpcnRuZXRfZ2V0X2V0aHRvb2xfc3RhdHMoc3RydWN0IG5ldF9k
ZXZpY2UgKmRldiwKPiA+ICAgICAgICAgICAgICAgfSB3aGlsZSAodTY0X3N0YXRzX2ZldGNoX3Jl
dHJ5KCZzcS0+c3RhdHMuc3luY3AsIHN0YXJ0KSk7Cj4gPiAgICAgICAgICAgICAgIGlkeCArPSBW
SVJUTkVUX1NRX1NUQVRTX0xFTjsKPiA+ICAgICAgIH0KPiA+ICsKPiA+ICsgICAgIHZpcnRuZXRf
Z2V0X3BhZ2VfcG9vbF9zdGF0cyhkZXYsICZkYXRhW2lkeF0pOwo+ID4gIH0KPiA+Cj4gPiAgc3Rh
dGljIHZvaWQgdmlydG5ldF9nZXRfY2hhbm5lbHMoc3RydWN0IG5ldF9kZXZpY2UgKmRldiwKPiA+
IEBAIC0zNjIzLDYgKzM2OTEsOCBAQCBzdGF0aWMgdm9pZCB2aXJ0bmV0X2ZyZWVfcXVldWVzKHN0
cnVjdCB2aXJ0bmV0X2luZm8gKnZpKQo+ID4gICAgICAgZm9yIChpID0gMDsgaSA8IHZpLT5tYXhf
cXVldWVfcGFpcnM7IGkrKykgewo+ID4gICAgICAgICAgICAgICBfX25ldGlmX25hcGlfZGVsKCZ2
aS0+cnFbaV0ubmFwaSk7Cj4gPiAgICAgICAgICAgICAgIF9fbmV0aWZfbmFwaV9kZWwoJnZpLT5z
cVtpXS5uYXBpKTsKPiA+ICsgICAgICAgICAgICAgaWYgKHZpLT5ycVtpXS5wYWdlX3Bvb2wpCj4g
PiArICAgICAgICAgICAgICAgICAgICAgcGFnZV9wb29sX2Rlc3Ryb3kodmktPnJxW2ldLnBhZ2Vf
cG9vbCk7Cj4gPiAgICAgICB9Cj4gPgo+ID4gICAgICAgLyogV2UgY2FsbGVkIF9fbmV0aWZfbmFw
aV9kZWwoKSwKPiA+IEBAIC0zNjc5LDEyICszNzQ5LDE5IEBAIHN0YXRpYyB2b2lkIHZpcnRuZXRf
cnFfZnJlZV91bnVzZWRfYnVmKHN0cnVjdCB2aXJ0cXVldWUgKnZxLCB2b2lkICpidWYpCj4gPiAg
ICAgICBzdHJ1Y3QgdmlydG5ldF9pbmZvICp2aSA9IHZxLT52ZGV2LT5wcml2Owo+ID4gICAgICAg
aW50IGkgPSB2cTJyeHEodnEpOwo+ID4KPiA+IC0gICAgIGlmICh2aS0+bWVyZ2VhYmxlX3J4X2J1
ZnMpCj4gPiAtICAgICAgICAgICAgIHB1dF9wYWdlKHZpcnRfdG9faGVhZF9wYWdlKGJ1ZikpOwo+
ID4gLSAgICAgZWxzZSBpZiAodmktPmJpZ19wYWNrZXRzKQo+ID4gKyAgICAgaWYgKHZpLT5tZXJn
ZWFibGVfcnhfYnVmcykgewo+ID4gKyAgICAgICAgICAgICBpZiAodmktPnJxW2ldLnBhZ2VfcG9v
bCkgewo+ID4gKyAgICAgICAgICAgICAgICAgICAgIHBhZ2VfcG9vbF9wdXRfZnVsbF9wYWdlKHZp
LT5ycVtpXS5wYWdlX3Bvb2wsCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdmlydF90b19oZWFkX3BhZ2UoYnVmKSwKPiA+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlKTsKPiA+ICsgICAgICAgICAgICAgfSBl
bHNlIHsKPiA+ICsgICAgICAgICAgICAgICAgICAgICBwdXRfcGFnZSh2aXJ0X3RvX2hlYWRfcGFn
ZShidWYpKTsKPiA+ICsgICAgICAgICAgICAgfQo+ID4gKyAgICAgfSBlbHNlIGlmICh2aS0+Ymln
X3BhY2tldHMpIHsKPiA+ICAgICAgICAgICAgICAgZ2l2ZV9wYWdlcygmdmktPnJxW2ldLCBidWYp
Owo+ID4gLSAgICAgZWxzZQo+ID4gKyAgICAgfSBlbHNlIHsKPiA+ICAgICAgICAgICAgICAgcHV0
X3BhZ2UodmlydF90b19oZWFkX3BhZ2UoYnVmKSk7Cj4gPiArICAgICB9Cj4gPiAgfQo+ID4KPiA+
ICBzdGF0aWMgdm9pZCBmcmVlX3VudXNlZF9idWZzKHN0cnVjdCB2aXJ0bmV0X2luZm8gKnZpKQo+
ID4gQEAgLTM3MTgsNiArMzc5NSwyNiBAQCBzdGF0aWMgdm9pZCB2aXJ0bmV0X2RlbF92cXMoc3Ry
dWN0IHZpcnRuZXRfaW5mbyAqdmkpCj4gPiAgICAgICB2aXJ0bmV0X2ZyZWVfcXVldWVzKHZpKTsK
PiA+ICB9Cj4gPgo+ID4gK3N0YXRpYyB2b2lkIHZpcnRuZXRfYWxsb2NfcGFnZV9wb29sKHN0cnVj
dCByZWNlaXZlX3F1ZXVlICpycSkKPiA+ICt7Cj4gPiArICAgICBzdHJ1Y3QgdmlydGlvX2Rldmlj
ZSAqdmRldiA9IHJxLT52cS0+dmRldjsKPiA+ICsKPiA+ICsgICAgIHN0cnVjdCBwYWdlX3Bvb2xf
cGFyYW1zIHBwX3BhcmFtcyA9IHsKPiA+ICsgICAgICAgICAgICAgLm9yZGVyID0gMCwKPiA+ICsg
ICAgICAgICAgICAgLnBvb2xfc2l6ZSA9IHJxLT52cS0+bnVtX21heCwKPiA+ICsgICAgICAgICAg
ICAgLm5pZCA9IGRldl90b19ub2RlKHZkZXYtPmRldi5wYXJlbnQpLAo+ID4gKyAgICAgICAgICAg
ICAuZGV2ID0gdmRldi0+ZGV2LnBhcmVudCwKPiA+ICsgICAgICAgICAgICAgLm9mZnNldCA9IDAs
Cj4gPiArICAgICB9Owo+ID4gKwo+ID4gKyAgICAgcnEtPnBhZ2VfcG9vbCA9IHBhZ2VfcG9vbF9j
cmVhdGUoJnBwX3BhcmFtcyk7Cj4gPiArICAgICBpZiAoSVNfRVJSKHJxLT5wYWdlX3Bvb2wpKSB7
Cj4gPiArICAgICAgICAgICAgIGRldl93YXJuKCZ2ZGV2LT5kZXYsICJwYWdlIHBvb2wgY3JlYXRp
b24gZmFpbGVkOiAlbGRcbiIsCj4gPiArICAgICAgICAgICAgICAgICAgICAgIFBUUl9FUlIocnEt
PnBhZ2VfcG9vbCkpOwo+ID4gKyAgICAgICAgICAgICBycS0+cGFnZV9wb29sID0gTlVMTDsKPiA+
ICsgICAgIH0KPiA+ICt9Cj4gPiArCj4gPiAgLyogSG93IGxhcmdlIHNob3VsZCBhIHNpbmdsZSBi
dWZmZXIgYmUgc28gYSBxdWV1ZSBmdWxsIG9mIHRoZXNlIGNhbiBmaXQgYXQKPiA+ICAgKiBsZWFz
dCBvbmUgZnVsbCBwYWNrZXQ/Cj4gPiAgICogTG9naWMgYmVsb3cgYXNzdW1lcyB0aGUgbWVyZ2Vh
YmxlIGJ1ZmZlciBoZWFkZXIgaXMgdXNlZC4KPiA+IEBAIC0zODAxLDYgKzM4OTgsMTMgQEAgc3Rh
dGljIGludCB2aXJ0bmV0X2ZpbmRfdnFzKHN0cnVjdCB2aXJ0bmV0X2luZm8gKnZpKQo+ID4gICAg
ICAgICAgICAgICB2aS0+cnFbaV0udnEgPSB2cXNbcnhxMnZxKGkpXTsKPiA+ICAgICAgICAgICAg
ICAgdmktPnJxW2ldLm1pbl9idWZfbGVuID0gbWVyZ2VhYmxlX21pbl9idWZfbGVuKHZpLCB2aS0+
cnFbaV0udnEpOwo+ID4gICAgICAgICAgICAgICB2aS0+c3FbaV0udnEgPSB2cXNbdHhxMnZxKGkp
XTsKPiA+ICsKPiA+ICsgICAgICAgICAgICAgaWYgKHBhZ2VfcG9vbF9lbmFibGVkICYmIHZpLT5t
ZXJnZWFibGVfcnhfYnVmcykKPiA+ICsgICAgICAgICAgICAgICAgICAgICB2aXJ0bmV0X2FsbG9j
X3BhZ2VfcG9vbCgmdmktPnJxW2ldKTsKPiA+ICsgICAgICAgICAgICAgZWxzZQo+ID4gKyAgICAg
ICAgICAgICAgICAgICAgIGRldl93YXJuKCZ2aS0+dmRldi0+ZGV2LAo+ID4gKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICJwYWdlIHBvb2wgb25seSBzdXBwb3J0IG1lcmdlYWJsZSBtb2Rl
XG4iKTsKPiA+ICsKPiA+ICAgICAgIH0KPiA+Cj4gPiAgICAgICAvKiBydW4gaGVyZTogcmV0ID09
IDAuICovCj4gPiAtLQo+ID4gMi4zMS4xCj4KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0
aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0
aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
