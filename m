Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
	by mail.lfdr.de (Postfix) with ESMTPS id 8BF4442449D
	for <lists.virtualization@lfdr.de>; Wed,  6 Oct 2021 19:40:53 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp4.osuosl.org (Postfix) with ESMTP id BFADF408D9;
	Wed,  6 Oct 2021 17:40:51 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
	by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id jELDoPm9wy2g; Wed,  6 Oct 2021 17:40:50 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp4.osuosl.org (Postfix) with ESMTPS id EAA6C408E1;
	Wed,  6 Oct 2021 17:40:49 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id CD5F8C0025;
	Wed,  6 Oct 2021 17:40:48 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 1A869C001D
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:45 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id 4CFD8407DC
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:44 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 4VxCuFJHFkDz
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:42 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.8.0
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by smtp2.osuosl.org (Postfix) with ESMTPS id 819C8407D0
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:42 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 0DA3E307CAFE; Wed,  6 Oct 2021 20:31:12 +0300 (EEST)
Received: from localhost (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id E274F3064495;
 Wed,  6 Oct 2021 20:31:11 +0300 (EEST)
X-Is-Junk-Enabled: fGZTSsP0qEJE2AIKtlSuFiRRwg9xyHmJ
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v12 44/77] KVM: introspection: add KVMI_VCPU_GET_INFO
Date: Wed,  6 Oct 2021 20:30:40 +0300
Message-Id: <20211006173113.26445-45-alazar@bitdefender.com>
In-Reply-To: <20211006173113.26445-1-alazar@bitdefender.com>
References: <20211006173113.26445-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: Tamas K Lengyel <tamas@tklengyel.com>, Wanpeng Li <wanpengli@tencent.com>,
 Sean Christopherson <seanjc@google.com>, Joerg Roedel <joro@8bytes.org>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Mathieu Tarral <mathieu.tarral@protonmail.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 Jim Mattson <jmattson@google.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhpcyBjb21tYW5k
IHJldHVybnMgdGhlIFRTQyBmcmVxdWVuY3kgKGluIEhaKSBmb3IgdGhlIHNwZWNpZmllZAp2Q1BV
IGlmIGF2YWlsYWJsZSAob3RoZXJ3aXNlIGl0IHJldHVybnMgemVybykuCgpTaWduZWQtb2ZmLWJ5
OiBNaWhhaSBEb27Im3UgPG1kb250dUBiaXRkZWZlbmRlci5jb20+CkNvLWRldmVsb3BlZC1ieTog
QWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgpTaWduZWQtb2ZmLWJ5OiBB
ZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogRG9jdW1lbnRhdGlv
bi92aXJ0L2t2bS9rdm1pLnJzdCAgICAgICAgICAgICAgIHwgIDI5ICsrKysKIGFyY2gveDg2L2lu
Y2x1ZGUvYXNtL2t2bWlfaG9zdC5oICAgICAgICAgICAgICB8ICAgMiArCiBhcmNoL3g4Ni9pbmNs
dWRlL3VhcGkvYXNtL2t2bWkuaCAgICAgICAgICAgICAgfCAgMTMgKysKIGFyY2gveDg2L2t2bS9r
dm1pX21zZy5jICAgICAgICAgICAgICAgICAgICAgICB8ICAxNCArKwogaW5jbHVkZS91YXBpL2xp
bnV4L2t2bWkuaCAgICAgICAgICAgICAgICAgICAgIHwgICAyICsKIC4uLi90ZXN0aW5nL3NlbGZ0
ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jICB8IDE1MyArKysrKysrKysrKysrKysrKy0KIHZp
cnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCAgICAgICAgICAgICB8ICAgMyArCiB2aXJ0
L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMgICAgICAgICAgICAgfCAgIDkgKysKIDggZmls
ZXMgY2hhbmdlZCwgMjIzIGluc2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9k
ZSAxMDA2NDQgYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmgKCmRpZmYgLS1naXQgYS9E
b2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9r
dm1pLnJzdAppbmRleCA3OTE1MmY0N2IzMGYuLjJmNDFmY2U3OWQ5NSAxMDA2NDQKLS0tIGEvRG9j
dW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3Zt
L2t2bWkucnN0CkBAIC00NDEsNiArNDQxLDM1IEBAIG9uZSBwYWdlIChvZmZzZXQgKyBzaXplIDw9
IFBBR0VfU0laRSkuCiAqIC1LVk1fRUlOVkFMIC0gdGhlIHNwZWNpZmllZCBncGEvc2l6ZSBwYWly
IGlzIGludmFsaWQKICogLUtWTV9FSU5WQUwgLSB0aGUgcGFkZGluZyBpcyBub3QgemVybwogCis4
LiBLVk1JX1ZDUFVfR0VUX0lORk8KKy0tLS0tLS0tLS0tLS0tLS0tLS0tLQorCis6QXJjaGl0ZWN0
dXJlczogeDg2Cis6VmVyc2lvbnM6ID49IDEKKzpQYXJhbWV0ZXJzOgorCis6OgorCisJc3RydWN0
IGt2bWlfdmNwdV9oZHI7CisKKzpSZXR1cm5zOgorCis6OgorCisJc3RydWN0IGt2bWlfZXJyb3Jf
Y29kZTsKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9pbmZvX3JlcGx5IHsKKwkJX191NjQgdHNjX3Nw
ZWVkOworCX07CisKK1JldHVybnMgdGhlIFRTQyBmcmVxdWVuY3kgKGluIEhaKSBmb3IgdGhlIHNw
ZWNpZmllZCB2Q1BVIGlmIGF2YWlsYWJsZQorKG90aGVyd2lzZSBpdCByZXR1cm5zIHplcm8pLgor
Cis6RXJyb3JzOgorCisqIC1LVk1fRUlOVkFMIC0gdGhlIHBhZGRpbmcgaXMgbm90IHplcm8KKyog
LUtWTV9FSU5WQUwgLSB0aGUgc2VsZWN0ZWQgdkNQVSBpcyBpbnZhbGlkCisqIC1LVk1fRUFHQUlO
IC0gdGhlIHNlbGVjdGVkIHZDUFUgY2FuJ3QgYmUgaW50cm9zcGVjdGVkIHlldAorCiBFdmVudHMK
ID09PT09PQogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaCBi
L2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCmluZGV4IDM2MGE1N2RkOTAxOS4uMDVh
ZGUzYTE2YjI0IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaAor
KysgYi9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaApAQCAtMiw2ICsyLDggQEAKICNp
Zm5kZWYgX0FTTV9YODZfS1ZNSV9IT1NUX0gKICNkZWZpbmUgX0FTTV9YODZfS1ZNSV9IT1NUX0gK
IAorI2luY2x1ZGUgPGFzbS9rdm1pLmg+CisKIHN0cnVjdCBrdm1fdmNwdV9hcmNoX2ludHJvc3Bl
Y3Rpb24gewogfTsKIApkaWZmIC0tZ2l0IGEvYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1p
LmggYi9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaApuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLjJiNjE5MmUxYTlhNAotLS0gL2Rldi9udWxsCisrKyBiL2Fy
Y2gveDg2L2luY2x1ZGUvdWFwaS9hc20va3ZtaS5oCkBAIC0wLDAgKzEsMTMgQEAKKy8qIFNQRFgt
TGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wIFdJVEggTGludXgtc3lzY2FsbC1ub3RlICovCisj
aWZuZGVmIF9VQVBJX0FTTV9YODZfS1ZNSV9ICisjZGVmaW5lIF9VQVBJX0FTTV9YODZfS1ZNSV9I
CisKKy8qCisgKiBLVk0gaW50cm9zcGVjdGlvbiAtIHg4NiBzcGVjaWZpYyBzdHJ1Y3R1cmVzIGFu
ZCBkZWZpbml0aW9ucworICovCisKK3N0cnVjdCBrdm1pX3ZjcHVfZ2V0X2luZm9fcmVwbHkgewor
CV9fdTY0IHRzY19zcGVlZDsKK307CisKKyNlbmRpZiAvKiBfVUFQSV9BU01fWDg2X0tWTUlfSCAq
LwpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMgYi9hcmNoL3g4Ni9rdm0va3Zt
aV9tc2cuYwppbmRleCAwYTZlZGZlMTZmMTcuLjBkODNjNDdmMzc1OCAxMDA2NDQKLS0tIGEvYXJj
aC94ODYva3ZtL2t2bWlfbXNnLmMKKysrIGIvYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMKQEAgLTgs
NyArOCwyMSBAQAogCiAjaW5jbHVkZSAiLi4vLi4vLi4vdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pX2ludC5oIgogCitzdGF0aWMgaW50IGhhbmRsZV92Y3B1X2dldF9pbmZvKGNvbnN0IHN0cnVj
dCBrdm1pX3ZjcHVfbXNnX2pvYiAqam9iLAorCQkJCWNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIg
Km1zZywKKwkJCQljb25zdCB2b2lkICpyZXEpCit7CisJc3RydWN0IGt2bWlfdmNwdV9nZXRfaW5m
b19yZXBseSBycGw7CisKKwltZW1zZXQoJnJwbCwgMCwgc2l6ZW9mKHJwbCkpOworCWlmIChrdm1f
aGFzX3RzY19jb250cm9sKQorCQlycGwudHNjX3NwZWVkID0gMTAwMHVsICogam9iLT52Y3B1LT5h
cmNoLnZpcnR1YWxfdHNjX2toejsKKworCXJldHVybiBrdm1pX21zZ192Y3B1X3JlcGx5KGpvYiwg
bXNnLCAwLCAmcnBsLCBzaXplb2YocnBsKSk7Cit9CisKIHN0YXRpYyBjb25zdCBrdm1pX3ZjcHVf
bXNnX2pvYl9mY3QgbXNnX3ZjcHVbXSA9IHsKKwlbS1ZNSV9WQ1BVX0dFVF9JTkZPXSA9IGhhbmRs
ZV92Y3B1X2dldF9pbmZvLAogfTsKIAoga3ZtaV92Y3B1X21zZ19qb2JfZmN0IGt2bWlfYXJjaF92
Y3B1X21zZ19oYW5kbGVyKHUxNiBpZCkKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9r
dm1pLmggYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCmluZGV4IDdiYTFjODc1OGFiYS4uZGE3
NjY0MjcyMzFlIDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2lu
Y2x1ZGUvdWFwaS9saW51eC9rdm1pLmgKQEAgLTMxLDYgKzMxLDggQEAgZW51bSB7CiB9OwogCiBl
bnVtIHsKKwlLVk1JX1ZDUFVfR0VUX0lORk8gPSBLVk1JX1ZDUFVfTUVTU0FHRV9JRCgxKSwKKwog
CUtWTUlfTkVYVF9WQ1BVX01FU1NBR0UKIH07CiAKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcv
c2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0
cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCmluZGV4IDI4ZGQ2NDE0YTdlOC4uMzM3ZjI5NWQ2OWZm
IDEwMDY0NAotLS0gYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVz
dC5jCisrKyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMK
QEAgLTksNiArOSw3IEBACiAjaW5jbHVkZSA8c3lzL3R5cGVzLmg+CiAjaW5jbHVkZSA8c3lzL3Nv
Y2tldC5oPgogI2luY2x1ZGUgPHRpbWUuaD4KKyNpbmNsdWRlIDxwdGhyZWFkLmg+CiAKICNpbmNs
dWRlICJ0ZXN0X3V0aWwuaCIKIApAQCAtMTgsNiArMTksNyBAQAogCiAjaW5jbHVkZSAibGludXgv
a3ZtX3BhcmEuaCIKICNpbmNsdWRlICJsaW51eC9rdm1pLmgiCisjaW5jbHVkZSAiYXNtL2t2bWku
aCIKIAogI2RlZmluZSBWQ1BVX0lEIDEKIApAQCAtMjUsMTIgKzI3LDQ5IEBAIHN0YXRpYyBpbnQg
c29ja2V0X3BhaXJbMl07CiAjZGVmaW5lIEt2bV9zb2NrZXQgICAgICAgc29ja2V0X3BhaXJbMF0K
ICNkZWZpbmUgVXNlcnNwYWNlX3NvY2tldCBzb2NrZXRfcGFpclsxXQogCitzdGF0aWMgaW50IHRl
c3RfaWQ7CiBzdGF0aWMgdm1fdmFkZHJfdCB0ZXN0X2d2YTsKIHN0YXRpYyB2b2lkICp0ZXN0X2h2
YTsKIHN0YXRpYyB2bV9wYWRkcl90IHRlc3RfZ3BhOwogCiBzdGF0aWMgaW50IHBhZ2Vfc2l6ZTsK
IAorc3RydWN0IHZjcHVfd29ya2VyX2RhdGEgeworCXN0cnVjdCBrdm1fdm0gKnZtOworCWludCB2
Y3B1X2lkOworCWludCB0ZXN0X2lkOworfTsKKworZW51bSB7CisJR1VFU1RfVEVTVF9OT09QID0g
MCwKK307CisKKyNkZWZpbmUgR1VFU1RfUkVRVUVTVF9URVNUKCkgICAgIEdVRVNUX1NZTkMoMCkK
KyNkZWZpbmUgR1VFU1RfU0lHTkFMX1RFU1RfRE9ORSgpIEdVRVNUX1NZTkMoMSkKKworI2RlZmlu
ZSBIT1NUX1NFTkRfVEVTVCh1YykgICAgICAgKHVjLmNtZCA9PSBVQ0FMTF9TWU5DICYmIHVjLmFy
Z3NbMV0gPT0gMCkKKyNkZWZpbmUgSE9TVF9URVNUX0RPTkUodWMpICAgICAgICh1Yy5jbWQgPT0g
VUNBTExfU1lOQyAmJiB1Yy5hcmdzWzFdID09IDEpCisKK3N0YXRpYyBwdGhyZWFkX3Qgc3RhcnRf
dmNwdV93b3JrZXIoc3RydWN0IHZjcHVfd29ya2VyX2RhdGEgKmRhdGEpOworc3RhdGljIHZvaWQg
d2FpdF92Y3B1X3dvcmtlcihwdGhyZWFkX3QgdmNwdV90aHJlYWQpOworCitzdGF0aWMgaW50IGd1
ZXN0X3Rlc3RfaWQodm9pZCkKK3sKKwlHVUVTVF9SRVFVRVNUX1RFU1QoKTsKKwlyZXR1cm4gUkVB
RF9PTkNFKHRlc3RfaWQpOworfQorCitzdGF0aWMgdm9pZCBndWVzdF9jb2RlKHZvaWQpCit7CisJ
d2hpbGUgKHRydWUpIHsKKwkJc3dpdGNoIChndWVzdF90ZXN0X2lkKCkpIHsKKwkJY2FzZSBHVUVT
VF9URVNUX05PT1A6CisJCQlicmVhazsKKwkJfQorCQlHVUVTVF9TSUdOQUxfVEVTVF9ET05FKCk7
CisJfQorfQorCiB2b2lkIHNldHVwX3NvY2tldCh2b2lkKQogewogCWludCByOwpAQCAtMTA0LDE5
ICsxNDMsMjMgQEAgc3RhdGljIHZvaWQgYWxsb3dfY29tbWFuZChzdHJ1Y3Qga3ZtX3ZtICp2bSwg
X19zMzIgaWQpCiAKIHN0YXRpYyB2b2lkIGhvb2tfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3Zt
ICp2bSkKIHsKKwlzdHJ1Y3QgdmNwdV93b3JrZXJfZGF0YSBkYXRhID0gey52bSA9IHZtLCAudmNw
dV9pZCA9IFZDUFVfSUQgfTsKIAlfX3UzMiBhbGxvdyA9IDEsIGRpc2FsbG93ID0gMCwgYWxsb3df
aW52YWwgPSAyOworCXB0aHJlYWRfdCB2Y3B1X3RocmVhZDsKIAlfX3MzMiBhbGxfSURzID0gLTE7
CiAKIAlzZXRfY29tbWFuZF9wZXJtKHZtLCBhbGxfSURzLCBhbGxvdywgRUZBVUxUKTsKIAlzZXRf
ZXZlbnRfcGVybSh2bSwgYWxsX0lEcywgYWxsb3csIEVGQVVMVCk7CiAKLQkvKiBkb19ob29rX2lv
Y3RsKHZtLCAtMSwgRUlOVkFMKTsgKi8KKwlkb19ob29rX2lvY3RsKHZtLCAtMSwgRUlOVkFMKTsK
IAogCS8qCiAJICogVGhlIGxhc3QgY2FsbCBmYWlsZWQgInRvbyBsYXRlIi4KIAkgKiBXZSBoYXZl
IHRvIGxldCB0aGUgdkNQVSBydW4gYW5kIGNsZWFuIHVwIGl0cyBzdHJ1Y3R1cmVzLAogCSAqIG90
aGVyd2lzZSB0aGUgbmV4dCBjYWxsIHdpbGwgZmFpbCB3aXRoIEVFWElTVC4KIAkgKi8KKwl2Y3B1
X3RocmVhZCA9IHN0YXJ0X3ZjcHVfd29ya2VyKCZkYXRhKTsKKwl3YWl0X3ZjcHVfd29ya2VyKHZj
cHVfdGhyZWFkKTsKIAogCWRvX2hvb2tfaW9jdGwodm0sIEt2bV9zb2NrZXQsIDApOwogCWRvX2hv
b2tfaW9jdGwodm0sIEt2bV9zb2NrZXQsIEVFWElTVCk7CkBAIC01MzcsNiArNTgwLDExMSBAQCBz
dGF0aWMgdm9pZCB0ZXN0X21lbW9yeV9hY2Nlc3Moc3RydWN0IGt2bV92bSAqdm0pCiAJcmVhZF9p
bnZhbGlkX2d1ZXN0X3BhZ2Uodm0pOwogfQogCitzdGF0aWMgdm9pZCAqdmNwdV93b3JrZXIodm9p
ZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgdmNwdV93b3JrZXJfZGF0YSAqY3R4ID0gZGF0YTsKKwlzdHJ1
Y3Qga3ZtX3J1biAqcnVuOworCisJcnVuID0gdmNwdV9zdGF0ZShjdHgtPnZtLCBjdHgtPnZjcHVf
aWQpOworCisJd2hpbGUgKHRydWUpIHsKKwkJc3RydWN0IHVjYWxsIHVjOworCisJCXZjcHVfcnVu
KGN0eC0+dm0sIGN0eC0+dmNwdV9pZCk7CisKKwkJVEVTVF9BU1NFUlQocnVuLT5leGl0X3JlYXNv
biA9PSBLVk1fRVhJVF9JTywKKwkJCSJ2Y3B1X3J1bigpIGZhaWxlZCwgdGVzdF9pZCAlZCwgZXhp
dCByZWFzb24gJXUgKCVzKVxuIiwKKwkJCWN0eC0+dGVzdF9pZCwgcnVuLT5leGl0X3JlYXNvbiwK
KwkJCWV4aXRfcmVhc29uX3N0cihydW4tPmV4aXRfcmVhc29uKSk7CisKKwkJVEVTVF9BU1NFUlQo
Z2V0X3VjYWxsKGN0eC0+dm0sIGN0eC0+dmNwdV9pZCwgJnVjKSwKKwkJCSJObyBndWVzdCByZXF1
ZXN0XG4iKTsKKworCQlpZiAoSE9TVF9TRU5EX1RFU1QodWMpKSB7CisJCQl0ZXN0X2lkID0gUkVB
RF9PTkNFKGN0eC0+dGVzdF9pZCk7CisJCQlzeW5jX2dsb2JhbF90b19ndWVzdChjdHgtPnZtLCB0
ZXN0X2lkKTsKKwkJfSBlbHNlIGlmIChIT1NUX1RFU1RfRE9ORSh1YykpIHsKKwkJCWJyZWFrOwor
CQl9CisJfQorCisJcmV0dXJuIE5VTEw7Cit9CisKK3N0YXRpYyBwdGhyZWFkX3Qgc3RhcnRfdmNw
dV93b3JrZXIoc3RydWN0IHZjcHVfd29ya2VyX2RhdGEgKmRhdGEpCit7CisJcHRocmVhZF90IHRo
cmVhZF9pZDsKKworCXB0aHJlYWRfY3JlYXRlKCZ0aHJlYWRfaWQsIE5VTEwsIHZjcHVfd29ya2Vy
LCBkYXRhKTsKKworCXJldHVybiB0aHJlYWRfaWQ7Cit9CisKK3N0YXRpYyB2b2lkIHdhaXRfdmNw
dV93b3JrZXIocHRocmVhZF90IHZjcHVfdGhyZWFkKQoreworCXB0aHJlYWRfam9pbih2Y3B1X3Ro
cmVhZCwgTlVMTCk7Cit9CisKK3N0YXRpYyBpbnQgZG9fdmNwdV9jb21tYW5kKHN0cnVjdCBrdm1f
dm0gKnZtLCBpbnQgY21kX2lkLAorCQkJICAgc3RydWN0IGt2bWlfbXNnX2hkciAqcmVxLCBzaXpl
X3QgcmVxX3NpemUsCisJCQkgICB2b2lkICpycGwsIHNpemVfdCBycGxfc2l6ZSkKK3sKKwlzdHJ1
Y3QgdmNwdV93b3JrZXJfZGF0YSBkYXRhID0gey52bSA9IHZtLCAudmNwdV9pZCA9IFZDUFVfSUQg
fTsKKwlwdGhyZWFkX3QgdmNwdV90aHJlYWQ7CisJaW50IHI7CisKKwl2Y3B1X3RocmVhZCA9IHN0
YXJ0X3ZjcHVfd29ya2VyKCZkYXRhKTsKKworCXIgPSBkb19jb21tYW5kKGNtZF9pZCwgcmVxLCBy
ZXFfc2l6ZSwgcnBsLCBycGxfc2l6ZSk7CisKKwl3YWl0X3ZjcHVfd29ya2VyKHZjcHVfdGhyZWFk
KTsKKwlyZXR1cm4gcjsKK30KKworc3RhdGljIGludCBkb192Y3B1MF9jb21tYW5kKHN0cnVjdCBr
dm1fdm0gKnZtLCBpbnQgY21kX2lkLAorCQkJICAgIHN0cnVjdCBrdm1pX21zZ19oZHIgKnJlcSwg
c2l6ZV90IHJlcV9zaXplLAorCQkJICAgIHZvaWQgKnJwbCwgc2l6ZV90IHJwbF9zaXplKQorewor
CXN0cnVjdCBrdm1pX3ZjcHVfaGRyICp2Y3B1X2hkciA9IChzdHJ1Y3Qga3ZtaV92Y3B1X2hkciAq
KShyZXEgKyAxKTsKKworCXZjcHVfaGRyLT52Y3B1ID0gMDsKKworCXJldHVybiBkb192Y3B1X2Nv
bW1hbmQodm0sIGNtZF9pZCwgcmVxLCByZXFfc2l6ZSwgcnBsLCBycGxfc2l6ZSk7Cit9CisKK3N0
YXRpYyB2b2lkIHRlc3RfdmNwdTBfY29tbWFuZChzdHJ1Y3Qga3ZtX3ZtICp2bSwgaW50IGNtZF9p
ZCwKKwkJCSAgICAgICBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICpyZXEsIHNpemVfdCByZXFfc2l6ZSwK
KwkJCSAgICAgICB2b2lkICpycGwsIHNpemVfdCBycGxfc2l6ZSwKKwkJCSAgICAgICBpbnQgZXhw
ZWN0ZWRfZXJyKQoreworCWludCByOworCisJciA9IGRvX3ZjcHUwX2NvbW1hbmQodm0sIGNtZF9p
ZCwgcmVxLCByZXFfc2l6ZSwgcnBsLCBycGxfc2l6ZSk7CisJVEVTVF9BU1NFUlQociA9PSBleHBl
Y3RlZF9lcnIsCisJCSJDb21tYW5kICVkIGZhaWxlZCwgZXJyb3IgJWQgKCVzKSBpbnN0ZWFkIG9m
ICVkICglcylcbiIsCisJCWNtZF9pZCwgLXIsIGt2bV9zdHJlcnJvcigtciksCisJCWV4cGVjdGVk
X2Vyciwga3ZtX3N0cmVycm9yKGV4cGVjdGVkX2VycikpOworfQorCitzdGF0aWMgdm9pZCB0ZXN0
X2NtZF92Y3B1X2dldF9pbmZvKHN0cnVjdCBrdm1fdm0gKnZtKQoreworCXN0cnVjdCB7CisJCXN0
cnVjdCBrdm1pX21zZ19oZHIgaGRyOworCQlzdHJ1Y3Qga3ZtaV92Y3B1X2hkciB2Y3B1X2hkcjsK
Kwl9IHJlcSA9IHt9OworCXN0cnVjdCBrdm1pX3ZjcHVfZ2V0X2luZm9fcmVwbHkgcnBsOworCWlu
dCBjbWRfaWQgPSBLVk1JX1ZDUFVfR0VUX0lORk87CisKKwl0ZXN0X3ZjcHUwX2NvbW1hbmQodm0s
IGNtZF9pZCwgJnJlcS5oZHIsIHNpemVvZihyZXEpLAorCQkJICAgJnJwbCwgc2l6ZW9mKHJwbCks
IDApOworCisJcHJfZGVidWcoInRzY19zcGVlZDogJWxsdSBIWlxuIiwgcnBsLnRzY19zcGVlZCk7
CisKKwlyZXEudmNwdV9oZHIudmNwdSA9IDk5OworCXRlc3Rfdm1fY29tbWFuZChjbWRfaWQsICZy
ZXEuaGRyLCBzaXplb2YocmVxKSwKKwkJCSZycGwsIHNpemVvZihycGwpLCAtS1ZNX0VJTlZBTCk7
Cit9CisKIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkK
IHsKIAlzcmFuZG9tKHRpbWUoMCkpOwpAQCAtNTUxLDYgKzY5OSw3IEBAIHN0YXRpYyB2b2lkIHRl
c3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIAl0ZXN0X2V2ZW50X3VuaG9vayh2
bSk7CiAJdGVzdF9jbWRfdm1fY29udHJvbF9ldmVudHModm0pOwogCXRlc3RfbWVtb3J5X2FjY2Vz
cyh2bSk7CisJdGVzdF9jbWRfdmNwdV9nZXRfaW5mbyh2bSk7CiAKIAl1bmhvb2tfaW50cm9zcGVj
dGlvbih2bSk7CiB9CkBAIC01NzMsNyArNzIyLDcgQEAgaW50IG1haW4oaW50IGFyZ2MsIGNoYXIg
KmFyZ3ZbXSkKIAkJZXhpdChLU0ZUX1NLSVApOwogCX0KIAotCXZtID0gdm1fY3JlYXRlX2RlZmF1
bHQoVkNQVV9JRCwgMCwgTlVMTCk7CisJdm0gPSB2bV9jcmVhdGVfZGVmYXVsdChWQ1BVX0lELCAw
LCBndWVzdF9jb2RlKTsKIAl2Y3B1X3NldF9jcHVpZCh2bSwgVkNQVV9JRCwga3ZtX2dldF9zdXBw
b3J0ZWRfY3B1aWQoKSk7CiAKIAlwYWdlX3NpemUgPSBnZXRwYWdlc2l6ZSgpOwpkaWZmIC0tZ2l0
IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oIGIvdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pX2ludC5oCmluZGV4IGMzZTRkYTdlN2YyMC4uMTI2ZTcyMjAxNTE4IDEwMDY0NAot
LS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgKKysrIGIvdmlydC9rdm0vaW50
cm9zcGVjdGlvbi9rdm1pX2ludC5oCkBAIC0zMiw2ICszMiw5IEBAIHZvaWQga3ZtaV9zb2NrX3No
dXRkb3duKHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSk7CiB2b2lkIGt2bWlfc29ja19w
dXQoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pKTsKIGJvb2wga3ZtaV9tc2dfcHJvY2Vz
cyhzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWkpOwogaW50IGt2bWlfbXNnX3NlbmRfdW5o
b29rKHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSk7CitpbnQga3ZtaV9tc2dfdmNwdV9y
ZXBseShjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X21zZ19qb2IgKmpvYiwKKwkJCWNvbnN0IHN0cnVj
dCBrdm1pX21zZ19oZHIgKm1zZywgaW50IGVyciwKKwkJCWNvbnN0IHZvaWQgKnJwbCwgc2l6ZV90
IHJwbF9zaXplKTsKIAogLyoga3ZtaS5jICovCiB2b2lkICprdm1pX21zZ19hbGxvYyh2b2lkKTsK
ZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYyBiL3ZpcnQva3Zt
L2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwppbmRleCA4MmUyYjQ5YTk2MGUuLjRjYjE5ZjA2OWRl
MiAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCisrKyBiL3Zp
cnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwpAQCAtMTA1LDYgKzEwNSwxNSBAQCBzdGF0
aWMgaW50IGt2bWlfbXNnX3ZtX3JlcGx5KHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSwK
IAlyZXR1cm4ga3ZtaV9tc2dfcmVwbHkoa3ZtaSwgbXNnLCBlcnIsIHJwbCwgcnBsX3NpemUpOwog
fQogCitpbnQga3ZtaV9tc2dfdmNwdV9yZXBseShjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X21zZ19q
b2IgKmpvYiwKKwkJCWNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZywgaW50IGVyciwKKwkJ
CWNvbnN0IHZvaWQgKnJwbCwgc2l6ZV90IHJwbF9zaXplKQoreworCXN0cnVjdCBrdm1faW50cm9z
cGVjdGlvbiAqa3ZtaSA9IEtWTUkoam9iLT52Y3B1LT5rdm0pOworCisJcmV0dXJuIGt2bWlfbXNn
X3JlcGx5KGt2bWksIG1zZywgZXJyLCBycGwsIHJwbF9zaXplKTsKK30KKwogc3RhdGljIHN0cnVj
dCBrdm1fdmNwdSAqa3ZtaV9nZXRfdmNwdShzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWks
CiAJCQkJICAgICAgdW5zaWduZWQgaW50IHZjcHVfaWR4KQogewpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QK
VmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5s
aW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
