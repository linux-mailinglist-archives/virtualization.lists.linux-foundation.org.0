Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [IPv6:2605:bc80:3010::136])
	by mail.lfdr.de (Postfix) with ESMTPS id 7664E73F89C
	for <lists.virtualization@lfdr.de>; Tue, 27 Jun 2023 11:21:48 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id DC3FD60F11;
	Tue, 27 Jun 2023 09:21:46 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org DC3FD60F11
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id oZBWLQS6D-Mx; Tue, 27 Jun 2023 09:21:45 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp3.osuosl.org (Postfix) with ESMTPS id 4F76960EA0;
	Tue, 27 Jun 2023 09:21:45 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 4F76960EA0
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 820B4C0DD4;
	Tue, 27 Jun 2023 09:21:44 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id D480CC0037
 for <virtualization@lists.linux-foundation.org>;
 Tue, 27 Jun 2023 09:21:42 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id AFEB181B7B
 for <virtualization@lists.linux-foundation.org>;
 Tue, 27 Jun 2023 09:21:42 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org AFEB181B7B
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Q4Wgn3Yz7vjS
 for <virtualization@lists.linux-foundation.org>;
 Tue, 27 Jun 2023 09:21:41 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 9D06B81A2B
Received: from out30-112.freemail.mail.aliyun.com
 (out30-112.freemail.mail.aliyun.com [115.124.30.112])
 by smtp1.osuosl.org (Postfix) with ESMTPS id 9D06B81A2B
 for <virtualization@lists.linux-foundation.org>;
 Tue, 27 Jun 2023 09:21:40 +0000 (UTC)
X-Alimail-AntiSpam: AC=PASS; BC=-1|-1; BR=01201311R201e4; CH=green; DM=||false|;
 DS=||; FP=0|-1|-1|-1|0|-1|-1|-1; HT=ay29a033018046051;
 MF=xuanzhuo@linux.alibaba.com; NM=1; PH=DS; RN=13; SR=0;
 TI=SMTPD_---0Vm5G9bd_1687857694; 
Received: from localhost(mailfrom:xuanzhuo@linux.alibaba.com
 fp:SMTPD_---0Vm5G9bd_1687857694) by smtp.aliyun-inc.com;
 Tue, 27 Jun 2023 17:21:35 +0800
Message-ID: <1687857679.82929-7-xuanzhuo@linux.alibaba.com>
Subject: Re: [PATCH vhost v10 05/10] virtio_ring: split-detach: support return
 dma info to driver
Date: Tue, 27 Jun 2023 17:21:19 +0800
From: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
To: Jason Wang <jasowang@redhat.com>
References: <20230602092206.50108-1-xuanzhuo@linux.alibaba.com>
 <20230602092206.50108-6-xuanzhuo@linux.alibaba.com>
 <CACGkMEvynjFgmt5Q9ime1-Zf6P5LXYYXg4e4iVpAEtmSV7d0pQ@mail.gmail.com>
In-Reply-To: <CACGkMEvynjFgmt5Q9ime1-Zf6P5LXYYXg4e4iVpAEtmSV7d0pQ@mail.gmail.com>
Cc: Jesper Dangaard Brouer <hawk@kernel.org>,
 Daniel Borkmann <daniel@iogearbox.net>, "Michael S. Tsirkin" <mst@redhat.com>,
 netdev@vger.kernel.org, John Fastabend <john.fastabend@gmail.com>,
 Alexei Starovoitov <ast@kernel.org>, virtualization@lists.linux-foundation.org,
 Eric Dumazet <edumazet@google.com>, Jakub Kicinski <kuba@kernel.org>,
 bpf@vger.kernel.org, Paolo Abeni <pabeni@redhat.com>,
 "David S. Miller" <davem@davemloft.net>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVHVlLCAyNyBKdW4gMjAyMyAxNjowMzozMSArMDgwMCwgSmFzb24gV2FuZyA8amFzb3dhbmdA
cmVkaGF0LmNvbT4gd3JvdGU6Cj4gT24gRnJpLCBKdW4gMiwgMjAyMyBhdCA1OjIy4oCvUE0gWHVh
biBaaHVvIDx4dWFuemh1b0BsaW51eC5hbGliYWJhLmNvbT4gd3JvdGU6Cj4gPgo+ID4gVW5kZXIg
dGhlIHByZW1hcHBlZCBtb2RlLCB0aGUgZHJpdmVyIG5lZWRzIHRvIHVubWFwIHRoZSBETUEgYWRk
cmVzcwo+ID4gYWZ0ZXIgcmVjZWl2aW5nIHRoZSBidWZmZXIuIFRoZSB2aXJ0aW8gY29yZSByZWNv
cmRzIHRoZSBETUEgYWRkcmVzcywKPiA+IHNvIHRoZSBkcml2ZXIgbmVlZHMgYSB3YXkgdG8gZ2V0
IHRoZSBkbWEgaW5mbyBmcm9tIHRoZSB2aXJ0aW8gY29yZS4KPgo+IEEgc2Vjb25kIHRob3VnaHQs
IGNhbiB3ZSBzaW1wbHkgb2ZmbG9hZCB0aGUgdHJhY2tpbmcgdG8gdGhlIGRyaXZlcgo+IGl0c2Vs
Zj8gVGhpcyBsb29rcyB0aGUgd2F5IG1hbnkgb3RoZXIgbW9kZXJuIE5JQyBkcml2ZXJzIGRpZC4K
Pgo+IEluIHByZSBtYXBwZWQgbW9kZSwgdGhlIERNQSBhZGRyZXNzIGlzIGluIGZhY3QgdG9sZCBi
eSB0aGUgZHJpdmVyCj4gaXRzZWxmIHNvIGl0IHNob3VsZCBoYXZlIHN1ZmZpY2llbnQga25vd2xl
ZGdlLiBBbmQgaW4gc29tZSBjYXNlcywgdGhlCj4gZHJpdmVyIHdhbnRzIHRvIG9wdGltaXplL21l
cmdlL2RlbGF5IHRoZSB1bmFtcHBpbmcgc28gdGhlIERNQQo+IGFkZHJlc3NlcyByZXR1cm5lZCBi
eSB0aGUgdmlydGlvIGNvcmUgYXJlIG5vdCBldmVuIGludGVyZXN0ZWQgaW4gdGhvc2UKPiBjYXNl
cy4KCldpbGwgZml4LgoKVGhhbmtzLgoKCj4KPiBUaGFua3MKPgo+Cj4KPiA+Cj4gPiBBIHN0cmFp
Z2h0Zm9yd2FyZCBhcHByb2FjaCBpcyB0byBwYXNzIGFuIGFycmF5IHRvIHRoZSB2aXJ0aW8gY29y
ZSB3aGVuCj4gPiBjYWxsaW5nIHZpcnRxdWV1ZV9nZXRfYnVmKCkuIEhvd2V2ZXIsIGl0IGlzIG5v
dCBmZWFzaWJsZSB3aGVuIHRoZXJlIGFyZQo+ID4gbXVsdGlwbGUgRE1BIGFkZHJlc3NlcyBpbiB0
aGUgZGVzY3JpcHRvciBjaGFpbiwgYW5kIHRoZSBhcnJheSBzaXplIGlzCj4gPiB1bmtub3duLgo+
ID4KPiA+IFRvIHNvbHZlIHRoaXMgcHJvYmxlbSwgYSBoZWxwZXIgYmUgaW50cm9kdWNlZC4gQWZ0
ZXIgY2FsbGluZwo+ID4gdmlydHF1ZXVlX2dldF9idWYoKSwgdGhlIGRyaXZlciBjYW4gY2FsbCB0
aGUgaGVscGVyIHRvCj4gPiByZXRyaWV2ZSBhIGRtYSBpbmZvLiBJZiB0aGUgaGVscGVyIGZ1bmN0
aW9uIHJldHVybnMgLUVBR0FJTiwgaXQgbWVhbnMKPiA+IHRoYXQgdGhlcmUgYXJlIG1vcmUgRE1B
IGFkZHJlc3NlcyB0byBiZSBwcm9jZXNzZWQsIGFuZCB0aGUgZHJpdmVyIHNob3VsZAo+ID4gY2Fs
bCB0aGUgaGVscGVyIGZ1bmN0aW9uIGFnYWluLiBUbyBrZWVwIHRyYWNrIG9mIHRoZSBjdXJyZW50
IHBvc2l0aW9uIGluCj4gPiB0aGUgY2hhaW4sIGEgY3Vyc29yIG11c3QgYmUgcGFzc2VkIHRvIHRo
ZSBoZWxwZXIgZnVuY3Rpb24sIHdoaWNoIGlzCj4gPiBpbml0aWFsaXplZCBieSB2aXJ0cXVldWVf
Z2V0X2J1ZigpLgo+ID4KPiA+IFNvbWUgcHJvY2Vzc2VzIGFyZSBkb25lIGluc2lkZSB0aGlzIGhl
bHBlciwgc28gdGhpcyBoZWxwZXIgTVVTVCBiZQo+ID4gY2FsbGVkIHVuZGVyIHRoZSBwcmVtYXBw
ZWQgbW9kZS4KPiA+Cj4gPiBTaWduZWQtb2ZmLWJ5OiBYdWFuIFpodW8gPHh1YW56aHVvQGxpbnV4
LmFsaWJhYmEuY29tPgo+ID4gLS0tCj4gPiAgZHJpdmVycy92aXJ0aW8vdmlydGlvX3JpbmcuYyB8
IDExOCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLQo+ID4gIGluY2x1ZGUvbGlu
dXgvdmlydGlvLmggICAgICAgfCAgMTEgKysrKwo+ID4gIDIgZmlsZXMgY2hhbmdlZCwgMTE5IGlu
c2VydGlvbnMoKyksIDEwIGRlbGV0aW9ucygtKQo+ID4KPiA+IGRpZmYgLS1naXQgYS9kcml2ZXJz
L3ZpcnRpby92aXJ0aW9fcmluZy5jIGIvZHJpdmVycy92aXJ0aW8vdmlydGlvX3JpbmcuYwo+ID4g
aW5kZXggZGMxMDlmYmMwNWE1Li5jZGM0MzQ5ZjYwNjYgMTAwNjQ0Cj4gPiAtLS0gYS9kcml2ZXJz
L3ZpcnRpby92aXJ0aW9fcmluZy5jCj4gPiArKysgYi9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fcmlu
Zy5jCj4gPiBAQCAtNzU0LDggKzc1NCw5NSBAQCBzdGF0aWMgYm9vbCB2aXJ0cXVldWVfa2lja19w
cmVwYXJlX3NwbGl0KHN0cnVjdCB2aXJ0cXVldWUgKl92cSkKPiA+ICAgICAgICAgcmV0dXJuIG5l
ZWRzX2tpY2s7Cj4gPiAgfQo+ID4KPiA+IC1zdGF0aWMgdm9pZCBkZXRhY2hfYnVmX3NwbGl0KHN0
cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxLCB1bnNpZ25lZCBpbnQgaGVhZCwKPiA+IC0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdm9pZCAqKmN0eCkKPiA+ICtzdGF0aWMgdm9pZCBkZXRhY2hf
Y3Vyc29yX2luaXRfc3BsaXQoc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAqdnEsCj4gPiArICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZpcnRxdWV1ZV9kZXRhY2hfY3Vy
c29yICpjdXJzb3IsIHUxNiBoZWFkKQo+ID4gK3sKPiA+ICsgICAgICAgc3RydWN0IHZyaW5nX2Rl
c2NfZXh0cmEgKmV4dHJhOwo+ID4gKwo+ID4gKyAgICAgICBleHRyYSA9ICZ2cS0+c3BsaXQuZGVz
Y19leHRyYVtoZWFkXTsKPiA+ICsKPiA+ICsgICAgICAgLyogQ2xlYXIgZGF0YSBwdHIuICovCj4g
PiArICAgICAgIHZxLT5zcGxpdC5kZXNjX3N0YXRlW2hlYWRdLmRhdGEgPSBOVUxMOwo+ID4gKwo+
ID4gKyAgICAgICBjdXJzb3ItPmhlYWQgPSBoZWFkOwo+ID4gKyAgICAgICBjdXJzb3ItPmRvbmUg
PSAwOwo+ID4gKwo+ID4gKyAgICAgICBpZiAoZXh0cmEtPmZsYWdzICYgVlJJTkdfREVTQ19GX0lO
RElSRUNUKSB7Cj4gPiArICAgICAgICAgICAgICAgY3Vyc29yLT5udW0gPSBleHRyYS0+bGVuIC8g
c2l6ZW9mKHN0cnVjdCB2cmluZ19kZXNjKTsKPiA+ICsgICAgICAgICAgICAgICBjdXJzb3ItPmlu
ZGlyZWN0ID0gdHJ1ZTsKPiA+ICsgICAgICAgICAgICAgICBjdXJzb3ItPnBvcyA9IDA7Cj4gPiAr
Cj4gPiArICAgICAgICAgICAgICAgdnJpbmdfdW5tYXBfb25lX3NwbGl0KHZxLCBoZWFkKTsKPiA+
ICsKPiA+ICsgICAgICAgICAgICAgICBleHRyYS0+bmV4dCA9IHZxLT5mcmVlX2hlYWQ7Cj4gPiAr
Cj4gPiArICAgICAgICAgICAgICAgdnEtPmZyZWVfaGVhZCA9IGhlYWQ7Cj4gPiArCj4gPiArICAg
ICAgICAgICAgICAgLyogUGx1cyBmaW5hbCBkZXNjcmlwdG9yICovCj4gPiArICAgICAgICAgICAg
ICAgdnEtPnZxLm51bV9mcmVlKys7Cj4gPiArCj4gPiArICAgICAgIH0gZWxzZSB7Cj4gPiArICAg
ICAgICAgICAgICAgY3Vyc29yLT5pbmRpcmVjdCA9IGZhbHNlOwo+ID4gKyAgICAgICAgICAgICAg
IGN1cnNvci0+cG9zID0gaGVhZDsKPiA+ICsgICAgICAgfQo+ID4gK30KPiA+ICsKPiA+ICtzdGF0
aWMgaW50IHZpcnRxdWV1ZV9kZXRhY2hfc3BsaXQoc3RydWN0IHZpcnRxdWV1ZSAqX3ZxLCBzdHJ1
Y3QgdmlydHF1ZXVlX2RldGFjaF9jdXJzb3IgKmN1cnNvciwKPiA+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBkbWFfYWRkcl90ICphZGRyLCB1MzIgKmxlbiwgZW51bSBkbWFfZGF0
YV9kaXJlY3Rpb24gKmRpcikKPiA+ICt7Cj4gPiArICAgICAgIHN0cnVjdCB2cmluZ192aXJ0cXVl
dWUgKnZxID0gdG9fdnZxKF92cSk7Cj4gPiArICAgICAgIF9fdmlydGlvMTYgbmV4dGZsYWcgPSBj
cHVfdG9fdmlydGlvMTYodnEtPnZxLnZkZXYsIFZSSU5HX0RFU0NfRl9ORVhUKTsKPiA+ICsgICAg
ICAgaW50IHJjID0gLUVBR0FJTjsKPiA+ICsKPiA+ICsgICAgICAgaWYgKHVubGlrZWx5KGN1cnNv
ci0+ZG9uZSkpCj4gPiArICAgICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7Cj4gPiArCj4gPiAr
ICAgICAgIGlmICghY3Vyc29yLT5pbmRpcmVjdCkgewo+ID4gKyAgICAgICAgICAgICAgIHN0cnVj
dCB2cmluZ19kZXNjX2V4dHJhICpleHRyYTsKPiA+ICsgICAgICAgICAgICAgICB1bnNpZ25lZCBp
bnQgaTsKPiA+ICsKPiA+ICsgICAgICAgICAgICAgICBpID0gY3Vyc29yLT5wb3M7Cj4gPiArCj4g
PiArICAgICAgICAgICAgICAgZXh0cmEgPSAmdnEtPnNwbGl0LmRlc2NfZXh0cmFbaV07Cj4gPiAr
Cj4gPiArICAgICAgICAgICAgICAgaWYgKHZxLT5zcGxpdC52cmluZy5kZXNjW2ldLmZsYWdzICYg
bmV4dGZsYWcpIHsKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci0+cG9zID0gZXh0
cmEtPm5leHQ7Cj4gPiArICAgICAgICAgICAgICAgfSBlbHNlIHsKPiA+ICsgICAgICAgICAgICAg
ICAgICAgICAgIGV4dHJhLT5uZXh0ID0gdnEtPmZyZWVfaGVhZDsKPiA+ICsgICAgICAgICAgICAg
ICAgICAgICAgIHZxLT5mcmVlX2hlYWQgPSBjdXJzb3ItPmhlYWQ7Cj4gPiArICAgICAgICAgICAg
ICAgICAgICAgICBjdXJzb3ItPmRvbmUgPSB0cnVlOwo+ID4gKyAgICAgICAgICAgICAgICAgICAg
ICAgcmMgPSAwOwo+ID4gKyAgICAgICAgICAgICAgIH0KPiA+ICsKPiA+ICsgICAgICAgICAgICAg
ICAqYWRkciA9IGV4dHJhLT5hZGRyOwo+ID4gKyAgICAgICAgICAgICAgICpsZW4gPSBleHRyYS0+
bGVuOwo+ID4gKyAgICAgICAgICAgICAgICpkaXIgPSAoZXh0cmEtPmZsYWdzICYgVlJJTkdfREVT
Q19GX1dSSVRFKSA/IERNQV9GUk9NX0RFVklDRSA6IERNQV9UT19ERVZJQ0U7Cj4gPiArCj4gPiAr
ICAgICAgICAgICAgICAgdnEtPnZxLm51bV9mcmVlKys7Cj4gPiArCj4gPiArICAgICAgIH0gZWxz
ZSB7Cj4gPiArICAgICAgICAgICAgICAgc3RydWN0IHZyaW5nX2Rlc2MgKmluZGlyX2Rlc2MsICpk
ZXNjOwo+ID4gKyAgICAgICAgICAgICAgIHUxNiBmbGFnczsKPiA+ICsKPiA+ICsgICAgICAgICAg
ICAgICBpbmRpcl9kZXNjID0gdnEtPnNwbGl0LmRlc2Nfc3RhdGVbY3Vyc29yLT5oZWFkXS5pbmRp
cl9kZXNjOwo+ID4gKyAgICAgICAgICAgICAgIGRlc2MgPSAmaW5kaXJfZGVzY1tjdXJzb3ItPnBv
c107Cj4gPiArCj4gPiArICAgICAgICAgICAgICAgZmxhZ3MgPSB2aXJ0aW8xNl90b19jcHUodnEt
PnZxLnZkZXYsIGRlc2MtPmZsYWdzKTsKPiA+ICsgICAgICAgICAgICAgICAqYWRkciA9IHZpcnRp
bzY0X3RvX2NwdSh2cS0+dnEudmRldiwgZGVzYy0+YWRkcik7Cj4gPiArICAgICAgICAgICAgICAg
KmxlbiA9IHZpcnRpbzMyX3RvX2NwdSh2cS0+dnEudmRldiwgZGVzYy0+bGVuKTsKPiA+ICsgICAg
ICAgICAgICAgICAqZGlyID0gKGZsYWdzICYgVlJJTkdfREVTQ19GX1dSSVRFKSA/IERNQV9GUk9N
X0RFVklDRSA6IERNQV9UT19ERVZJQ0U7Cj4gPiArCj4gPiArICAgICAgICAgICAgICAgaWYgKCsr
Y3Vyc29yLT5wb3MgPT0gY3Vyc29yLT5udW0pIHsKPiA+ICsgICAgICAgICAgICAgICAgICAgICAg
IGtmcmVlKGluZGlyX2Rlc2MpOwo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLT5k
b25lID0gdHJ1ZTsKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwo+ID4gKyAg
ICAgICAgICAgICAgIH0KPiA+ICsgICAgICAgfQo+ID4gKwo+ID4gKyAgICAgICByZXR1cm4gcmM7
Cj4gPiArfQo+ID4gKwo+ID4gK3N0YXRpYyB2b2lkIGRldGFjaF9idWZfc3BsaXQoc3RydWN0IHZy
aW5nX3ZpcnRxdWV1ZSAqdnEsIHVuc2lnbmVkIGludCBoZWFkKQo+ID4gIHsKPiA+ICAgICAgICAg
dW5zaWduZWQgaW50IGksIGo7Cj4gPiAgICAgICAgIF9fdmlydGlvMTYgbmV4dGZsYWcgPSBjcHVf
dG9fdmlydGlvMTYodnEtPnZxLnZkZXYsIFZSSU5HX0RFU0NfRl9ORVhUKTsKPiA+IEBAIC03OTks
OCArODg2LDYgQEAgc3RhdGljIHZvaWQgZGV0YWNoX2J1Zl9zcGxpdChzdHJ1Y3QgdnJpbmdfdmly
dHF1ZXVlICp2cSwgdW5zaWduZWQgaW50IGhlYWQsCj4gPgo+ID4gICAgICAgICAgICAgICAgIGtm
cmVlKGluZGlyX2Rlc2MpOwo+ID4gICAgICAgICAgICAgICAgIHZxLT5zcGxpdC5kZXNjX3N0YXRl
W2hlYWRdLmluZGlyX2Rlc2MgPSBOVUxMOwo+ID4gLSAgICAgICB9IGVsc2UgaWYgKGN0eCkgewo+
ID4gLSAgICAgICAgICAgICAgICpjdHggPSB2cS0+c3BsaXQuZGVzY19zdGF0ZVtoZWFkXS5pbmRp
cl9kZXNjOwo+ID4gICAgICAgICB9Cj4gPiAgfQo+ID4KPiA+IEBAIC04MTIsNyArODk3LDggQEAg
c3RhdGljIGJvb2wgbW9yZV91c2VkX3NwbGl0KGNvbnN0IHN0cnVjdCB2cmluZ192aXJ0cXVldWUg
KnZxKQo+ID4KPiA+ICBzdGF0aWMgdm9pZCAqdmlydHF1ZXVlX2dldF9idWZfY3R4X3NwbGl0KHN0
cnVjdCB2aXJ0cXVldWUgKl92cSwKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdW5zaWduZWQgaW50ICpsZW4sCj4gPiAtICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHZvaWQgKipjdHgpCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHZvaWQgKipjdHgsCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0cXVldWVfZGV0YWNoX2N1cnNvciAqY3Vyc29yKQo+
ID4gIHsKPiA+ICAgICAgICAgc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAqdnEgPSB0b192dnEoX3Zx
KTsKPiA+ICAgICAgICAgdm9pZCAqcmV0Owo+ID4gQEAgLTg1Miw3ICs5MzgsMTUgQEAgc3RhdGlj
IHZvaWQgKnZpcnRxdWV1ZV9nZXRfYnVmX2N0eF9zcGxpdChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEs
Cj4gPgo+ID4gICAgICAgICAvKiBkZXRhY2hfYnVmX3NwbGl0IGNsZWFycyBkYXRhLCBzbyBncmFi
IGl0IG5vdy4gKi8KPiA+ICAgICAgICAgcmV0ID0gdnEtPnNwbGl0LmRlc2Nfc3RhdGVbaV0uZGF0
YTsKPiA+IC0gICAgICAgZGV0YWNoX2J1Zl9zcGxpdCh2cSwgaSwgY3R4KTsKPiA+ICsKPiA+ICsg
ICAgICAgaWYgKCF2cS0+aW5kaXJlY3QgJiYgY3R4KQo+ID4gKyAgICAgICAgICAgICAgICpjdHgg
PSB2cS0+c3BsaXQuZGVzY19zdGF0ZVtpXS5pbmRpcl9kZXNjOwo+ID4gKwo+ID4gKyAgICAgICBp
ZiAodnEtPnByZW1hcHBlZCkKPiA+ICsgICAgICAgICAgICAgICBkZXRhY2hfY3Vyc29yX2luaXRf
c3BsaXQodnEsIGN1cnNvciwgaSk7Cj4gPiArICAgICAgIGVsc2UKPiA+ICsgICAgICAgICAgICAg
ICBkZXRhY2hfYnVmX3NwbGl0KHZxLCBpKTsKPiA+ICsKPiA+ICAgICAgICAgdnEtPmxhc3RfdXNl
ZF9pZHgrKzsKPiA+ICAgICAgICAgLyogSWYgd2UgZXhwZWN0IGFuIGludGVycnVwdCBmb3IgdGhl
IG5leHQgZW50cnksIHRlbGwgaG9zdAo+ID4gICAgICAgICAgKiBieSB3cml0aW5nIGV2ZW50IGlu
ZGV4IGFuZCBmbHVzaCBvdXQgdGhlIHdyaXRlIGJlZm9yZQo+ID4gQEAgLTk2MSw3ICsxMDU1LDgg
QEAgc3RhdGljIGJvb2wgdmlydHF1ZXVlX2VuYWJsZV9jYl9kZWxheWVkX3NwbGl0KHN0cnVjdCB2
aXJ0cXVldWUgKl92cSkKPiA+ICAgICAgICAgcmV0dXJuIHRydWU7Cj4gPiAgfQo+ID4KPiA+IC1z
dGF0aWMgdm9pZCAqdmlydHF1ZXVlX2RldGFjaF91bnVzZWRfYnVmX3NwbGl0KHN0cnVjdCB2aXJ0
cXVldWUgKl92cSkKPiA+ICtzdGF0aWMgdm9pZCAqdmlydHF1ZXVlX2RldGFjaF91bnVzZWRfYnVm
X3NwbGl0KHN0cnVjdCB2aXJ0cXVldWUgKl92cSwKPiA+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZpcnRxdWV1ZV9kZXRhY2hfY3Vyc29yICpj
dXJzb3IpCj4gPiAgewo+ID4gICAgICAgICBzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVlICp2cSA9IHRv
X3Z2cShfdnEpOwo+ID4gICAgICAgICB1bnNpZ25lZCBpbnQgaTsKPiA+IEBAIC05NzQsNyArMTA2
OSwxMCBAQCBzdGF0aWMgdm9pZCAqdmlydHF1ZXVlX2RldGFjaF91bnVzZWRfYnVmX3NwbGl0KHN0
cnVjdCB2aXJ0cXVldWUgKl92cSkKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl
Owo+ID4gICAgICAgICAgICAgICAgIC8qIGRldGFjaF9idWZfc3BsaXQgY2xlYXJzIGRhdGEsIHNv
IGdyYWIgaXQgbm93LiAqLwo+ID4gICAgICAgICAgICAgICAgIGJ1ZiA9IHZxLT5zcGxpdC5kZXNj
X3N0YXRlW2ldLmRhdGE7Cj4gPiAtICAgICAgICAgICAgICAgZGV0YWNoX2J1Zl9zcGxpdCh2cSwg
aSwgTlVMTCk7Cj4gPiArICAgICAgICAgICAgICAgaWYgKHZxLT5wcmVtYXBwZWQpCj4gPiArICAg
ICAgICAgICAgICAgICAgICAgICBkZXRhY2hfY3Vyc29yX2luaXRfc3BsaXQodnEsIGN1cnNvciwg
aSk7Cj4gPiArICAgICAgICAgICAgICAgZWxzZQo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAg
ZGV0YWNoX2J1Zl9zcGxpdCh2cSwgaSk7Cj4gPiAgICAgICAgICAgICAgICAgdnEtPnNwbGl0LmF2
YWlsX2lkeF9zaGFkb3ctLTsKPiA+ICAgICAgICAgICAgICAgICB2cS0+c3BsaXQudnJpbmcuYXZh
aWwtPmlkeCA9IGNwdV90b192aXJ0aW8xNihfdnEtPnZkZXYsCj4gPiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHZxLT5zcGxpdC5hdmFpbF9pZHhfc2hhZG93KTsKPiA+IEBAIC0yMzYx
LDcgKzI0NTksNyBAQCB2b2lkICp2aXJ0cXVldWVfZ2V0X2J1Zl9jdHgoc3RydWN0IHZpcnRxdWV1
ZSAqX3ZxLCB1bnNpZ25lZCBpbnQgKmxlbiwKPiA+ICAgICAgICAgc3RydWN0IHZyaW5nX3ZpcnRx
dWV1ZSAqdnEgPSB0b192dnEoX3ZxKTsKPiA+Cj4gPiAgICAgICAgIHJldHVybiB2cS0+cGFja2Vk
X3JpbmcgPyB2aXJ0cXVldWVfZ2V0X2J1Zl9jdHhfcGFja2VkKF92cSwgbGVuLCBjdHgpIDoKPiA+
IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpcnRxdWV1ZV9nZXRfYnVmX2N0eF9z
cGxpdChfdnEsIGxlbiwgY3R4KTsKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZpcnRxdWV1ZV9nZXRfYnVmX2N0eF9zcGxpdChfdnEsIGxlbiwgY3R4LCBOVUxMKTsKPiA+ICB9
Cj4gPiAgRVhQT1JUX1NZTUJPTF9HUEwodmlydHF1ZXVlX2dldF9idWZfY3R4KTsKPiA+Cj4gPiBA
QCAtMjQ5Myw3ICsyNTkxLDcgQEAgdm9pZCAqdmlydHF1ZXVlX2RldGFjaF91bnVzZWRfYnVmKHN0
cnVjdCB2aXJ0cXVldWUgKl92cSkKPiA+ICAgICAgICAgc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAq
dnEgPSB0b192dnEoX3ZxKTsKPiA+Cj4gPiAgICAgICAgIHJldHVybiB2cS0+cGFja2VkX3Jpbmcg
PyB2aXJ0cXVldWVfZGV0YWNoX3VudXNlZF9idWZfcGFja2VkKF92cSkgOgo+ID4gLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdmlydHF1ZXVlX2RldGFjaF91bnVzZWRfYnVmX3NwbGl0
KF92cSk7Cj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ0cXVldWVfZGV0
YWNoX3VudXNlZF9idWZfc3BsaXQoX3ZxLCBOVUxMKTsKPiA+ICB9Cj4gPiAgRVhQT1JUX1NZTUJP
TF9HUEwodmlydHF1ZXVlX2RldGFjaF91bnVzZWRfYnVmKTsKPiA+Cj4gPiBkaWZmIC0tZ2l0IGEv
aW5jbHVkZS9saW51eC92aXJ0aW8uaCBiL2luY2x1ZGUvbGludXgvdmlydGlvLmgKPiA+IGluZGV4
IDFmYzBlMTAyM2JkNC4uZWI0YTRlNDMyOWFhIDEwMDY0NAo+ID4gLS0tIGEvaW5jbHVkZS9saW51
eC92aXJ0aW8uaAo+ID4gKysrIGIvaW5jbHVkZS9saW51eC92aXJ0aW8uaAo+ID4gQEAgLTM4LDYg
KzM4LDE3IEBAIHN0cnVjdCB2aXJ0cXVldWUgewo+ID4gICAgICAgICB2b2lkICpwcml2Owo+ID4g
IH07Cj4gPgo+ID4gK3N0cnVjdCB2aXJ0cXVldWVfZGV0YWNoX2N1cnNvciB7Cj4gPiArICAgICAg
IHVuc2lnbmVkIGluZGlyZWN0OjE7Cj4gPiArICAgICAgIHVuc2lnbmVkIGRvbmU6MTsKPiA+ICsg
ICAgICAgdW5zaWduZWQgaG9sZToxNDsKPiA+ICsKPiA+ICsgICAgICAgLyogZm9yIHNwbGl0IGhl
YWQgKi8KPiA+ICsgICAgICAgdW5zaWduZWQgaGVhZDoxNjsKPiA+ICsgICAgICAgdW5zaWduZWQg
bnVtOjE2Owo+ID4gKyAgICAgICB1bnNpZ25lZCBwb3M6MTY7Cj4gPiArfTsKPiA+ICsKPiA+ICBp
bnQgdmlydHF1ZXVlX2FkZF9vdXRidWYoc3RydWN0IHZpcnRxdWV1ZSAqdnEsCj4gPiAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3RydWN0IHNjYXR0ZXJsaXN0IHNnW10sIHVuc2lnbmVkIGludCBu
dW0sCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGF0YSwKPiA+IC0tCj4gPiAy
LjMyLjAuMy5nMDExOTVjZjlmCj4gPgo+Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXphdGlv
bkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlv
bi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
