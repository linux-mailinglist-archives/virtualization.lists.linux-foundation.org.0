Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 4D5F3303A30
	for <lists.virtualization@lfdr.de>; Tue, 26 Jan 2021 11:27:56 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id D4F3E85535;
	Tue, 26 Jan 2021 10:27:54 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 2FqPDMHE7pkW; Tue, 26 Jan 2021 10:27:52 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 843F18506E;
	Tue, 26 Jan 2021 10:27:52 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 77546C0FA7;
	Tue, 26 Jan 2021 10:27:52 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id EC37CC013A
 for <virtualization@lists.linux-foundation.org>;
 Tue, 26 Jan 2021 10:27:50 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id D8AFD8676F
 for <virtualization@lists.linux-foundation.org>;
 Tue, 26 Jan 2021 10:27:50 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id cI2zWp8VxPQB
 for <virtualization@lists.linux-foundation.org>;
 Tue, 26 Jan 2021 10:27:47 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by whitealder.osuosl.org (Postfix) with ESMTPS id 9DF89866B6
 for <virtualization@lists.linux-foundation.org>;
 Tue, 26 Jan 2021 10:27:47 +0000 (UTC)
IronPort-SDR: CIVks/1WsugLdecl4rPWUNh4YZpQzMGJAyn2vRXJEmPgPWW9I4WNJ7zUqH8YkssdHkrvFKUdXh
 g1URbVz3k3Bg==
X-IronPort-AV: E=McAfee;i="6000,8403,9875"; a="166979422"
X-IronPort-AV: E=Sophos;i="5.79,375,1602572400"; d="scan'208";a="166979422"
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by orsmga101.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 26 Jan 2021 02:27:47 -0800
IronPort-SDR: DMD1ZTYVrVb/n3bzft6YT1+09k+831e6zsgWdQeFLHslhypFabpceIDIl9Sb3GLzyAHSU3tMHy
 F9DzfZeDmC0Q==
X-IronPort-AV: E=Sophos;i="5.79,375,1602572400"; d="scan'208";a="504487456"
Received: from vkasired-desk2.fm.intel.com ([10.105.128.127])
 by orsmga004-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 26 Jan 2021 02:27:47 -0800
From: Vivek Kasireddy <vivek.kasireddy@intel.com>
To: virtualization@lists.linux-foundation.org
Subject: [RFC v2 2/3] virtio: Introduce Vdmabuf driver
Date: Tue, 26 Jan 2021 02:17:34 -0800
Message-Id: <20210126101735.1304158-3-vivek.kasireddy@intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20210126101735.1304158-1-vivek.kasireddy@intel.com>
References: <20210126101735.1304158-1-vivek.kasireddy@intel.com>
MIME-Version: 1.0
Cc: daniel.vetter@intel.com, dongwon.kim@intel.com, daniel.vetter@ffwll.ch
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhpcyBkcml2ZXIgInRyYW5zZmVycyIgYSBkbWFidWYgY3JlYXRlZCBvbiB0aGUgR3Vlc3QgdG8g
dGhlIEhvc3QuCkEgY29tbW9uIHVzZS1jYXNlIGZvciBzdWNoIGEgdHJhbnNmZXIgaW5jbHVkZXMg
c2hhcmluZyB0aGUgc2Nhbm91dApidWZmZXIgY3JlYXRlZCBieSBhIGRpc3BsYXkgc2VydmVyIG9y
IGEgY29tcG9zaXRvciBydW5uaW5nIGluIHRoZQpHdWVzdCB3aXRoIFFlbXUgVUkgLS0gcnVubmlu
ZyBvbiB0aGUgSG9zdC4KClRoZSAidHJhbnNmZXIiIGlzIGFjY29tcGxpc2hlZCBieSBzaGFyaW5n
IHRoZSBQRk5zIG9mIGFsbCB0aGUgcGFnZXMKYXNzb2NpYXRlZCB3aXRoIHRoZSBkbWFidWYgYW5k
IGhhdmluZyBhIG5ldyBkbWFidWYgY3JlYXRlZCBvbiB0aGUKSG9zdCB0aGF0IGlzIGJhY2tlZCB1
cCBieSB0aGUgcGFnZXMgbWFwcGVkIGZyb20gdGhlIEd1ZXN0LgoKU2lnbmVkLW9mZi1ieTogRG9u
Z3dvbiBLaW0gPGRvbmd3b24ua2ltQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogVml2ZWsgS2Fz
aXJlZGR5IDx2aXZlay5rYXNpcmVkZHlAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvdmlydGlvL0tj
b25maWcgICAgICAgICAgICAgIHwgICA4ICsKIGRyaXZlcnMvdmlydGlvL01ha2VmaWxlICAgICAg
ICAgICAgIHwgICAxICsKIGRyaXZlcnMvdmlydGlvL3ZpcnRpb192ZG1hYnVmLmMgICAgIHwgOTg2
ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGluY2x1ZGUvbGludXgvdmlydGlvX3ZkbWFi
dWYuaCAgICAgIHwgMjcyICsrKysrKysrCiBpbmNsdWRlL3VhcGkvbGludXgvdmlydGlvX2lkcy5o
ICAgICB8ICAgMSArCiBpbmNsdWRlL3VhcGkvbGludXgvdmlydGlvX3ZkbWFidWYuaCB8ICA5OSAr
KysKIDYgZmlsZXMgY2hhbmdlZCwgMTM2NyBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2
NDQgZHJpdmVycy92aXJ0aW8vdmlydGlvX3ZkbWFidWYuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGlu
Y2x1ZGUvbGludXgvdmlydGlvX3ZkbWFidWYuaAogY3JlYXRlIG1vZGUgMTAwNjQ0IGluY2x1ZGUv
dWFwaS9saW51eC92aXJ0aW9fdmRtYWJ1Zi5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy92aXJ0aW8v
S2NvbmZpZyBiL2RyaXZlcnMvdmlydGlvL0tjb25maWcKaW5kZXggN2I0MTEzMGQzZjM1Li5lNTYz
YzEyZjcxMWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmlydGlvL0tjb25maWcKKysrIGIvZHJpdmVy
cy92aXJ0aW8vS2NvbmZpZwpAQCAtMTM5LDQgKzEzOSwxMiBAQCBjb25maWcgVklSVElPX0RNQV9T
SEFSRURfQlVGRkVSCiAJIFRoaXMgb3B0aW9uIGFkZHMgYSBmbGF2b3Igb2YgZG1hIGJ1ZmZlcnMg
dGhhdCBhcmUgYmFja2VkIGJ5CiAJIHZpcnRpbyByZXNvdXJjZXMuCiAKK2NvbmZpZyBWSVJUSU9f
VkRNQUJVRgorCWJvb2wgIkVuYWJsZXMgVmRtYWJ1ZiBkcml2ZXIgaW4gZ3Vlc3Qgb3MiCisJZGVm
YXVsdCBuCisJZGVwZW5kcyBvbiBWSVJUSU8KKwloZWxwCisJIFRoaXMgZHJpdmVyIHByb3ZpZGVz
IGEgd2F5IHRvIHNoYXJlIHRoZSBkbWFidWZzIGNyZWF0ZWQgaW4KKwkgdGhlIEd1ZXN0IHdpdGgg
dGhlIEhvc3QuCisKIGVuZGlmICMgVklSVElPX01FTlUKZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmly
dGlvL01ha2VmaWxlIGIvZHJpdmVycy92aXJ0aW8vTWFrZWZpbGUKaW5kZXggNTkxZTZmNzJhYTU0
Li5iNGJiMDczODAwOWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmlydGlvL01ha2VmaWxlCisrKyBi
L2RyaXZlcnMvdmlydGlvL01ha2VmaWxlCkBAIC05LDMgKzksNCBAQCBvYmotJChDT05GSUdfVklS
VElPX0lOUFVUKSArPSB2aXJ0aW9faW5wdXQubwogb2JqLSQoQ09ORklHX1ZJUlRJT19WRFBBKSAr
PSB2aXJ0aW9fdmRwYS5vCiBvYmotJChDT05GSUdfVklSVElPX01FTSkgKz0gdmlydGlvX21lbS5v
CiBvYmotJChDT05GSUdfVklSVElPX0RNQV9TSEFSRURfQlVGRkVSKSArPSB2aXJ0aW9fZG1hX2J1
Zi5vCitvYmotJChDT05GSUdfVklSVElPX1ZETUFCVUYpICs9IHZpcnRpb192ZG1hYnVmLm8KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvdmlydGlvL3ZpcnRpb192ZG1hYnVmLmMgYi9kcml2ZXJzL3ZpcnRp
by92aXJ0aW9fdmRtYWJ1Zi5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAw
MC4uMGI0MGVhNGZkNmYxCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy92aXJ0aW8vdmlydGlv
X3ZkbWFidWYuYwpAQCAtMCwwICsxLDk4NiBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IChNSVQgT1IgR1BMLTIuMCkKKworLyoKKyAqIENvcHlyaWdodCDCqSAyMDIxIEludGVsIENvcnBv
cmF0aW9uCisgKgorICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFy
Z2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKKyAqIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBh
bmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksCisgKiB0
byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0
aG91dCBsaW1pdGF0aW9uCisgKiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJn
ZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKKyAqIGFuZC9vciBzZWxsIGNvcGll
cyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQorICog
U29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcg
Y29uZGl0aW9uczoKKyAqCisgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBw
ZXJtaXNzaW9uIG5vdGljZSAoaW5jbHVkaW5nIHRoZSBuZXh0CisgKiBwYXJhZ3JhcGgpIHNoYWxs
IGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhl
CisgKiBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwg
V0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgorICogSU1QTElFRCwgSU5D
TFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJ
VFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VN
RU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwKKyAqIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xE
RVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCisgKiBMSUFCSUxJ
VFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwg
QVJJU0lORworICogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdB
UkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUworICogSU4gVEhFIFNPRlRXQVJFLgorICoK
KyAqIEF1dGhvcnM6CisgKiAgICBEb25nd29uIEtpbSA8ZG9uZ3dvbi5raW1AaW50ZWwuY29tPgor
ICogICAgTWF0ZXVzeiBQb2xyb2xhIDxtYXRldXN6LnBvbHJvbGFAZ21haWwuY29tPgorICogICAg
Vml2ZWsgS2FzaXJlZGR5IDx2aXZlay5rYXNpcmVkZHlAaW50ZWwuY29tPgorICoKKyAqLworCisj
aW5jbHVkZSA8bGludXgvaW5pdC5oPgorI2luY2x1ZGUgPGxpbnV4L2tlcm5lbC5oPgorI2luY2x1
ZGUgPGxpbnV4L2Vycm5vLmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8
bGludXgvZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvdWFjY2Vzcy5oPgorI2luY2x1ZGUgPGxp
bnV4L21pc2NkZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9kZWxheS5oPgorI2luY2x1ZGUgPGxp
bnV4L3JhbmRvbS5oPgorI2luY2x1ZGUgPGxpbnV4L3BvbGwuaD4KKyNpbmNsdWRlIDxsaW51eC9z
cGlubG9jay5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KKyNpbmNsdWRlIDxsaW51eC92
aXJ0aW8uaD4KKyNpbmNsdWRlIDxsaW51eC92aXJ0aW9faWRzLmg+CisjaW5jbHVkZSA8bGludXgv
dmlydGlvX2NvbmZpZy5oPgorI2luY2x1ZGUgPGxpbnV4L3ZpcnRpb192ZG1hYnVmLmg+CisKKyNk
ZWZpbmUgVklSVElPX1ZETUFCVUZfTUFYX0lEIElOVF9NQVgKKyNkZWZpbmUgUkVGU19QRVJfUEFH
RSAoUEFHRV9TSVpFL3NpemVvZihsb25nKSkKKyNkZWZpbmUgTkVXX0JVRl9JRF9HRU4odm1pZCwg
Y250KSAoKCh2bWlkICYgMHhGRkZGRkZGRikgPDwgMzIpIHwgXAorCQkJCSAgICAoKGNudCkgJiAw
eEZGRkZGRkZGKSkKKworLyogb25lIGdsb2JhbCBkcnYgb2JqZWN0ICovCitzdGF0aWMgc3RydWN0
IHZpcnRpb192ZG1hYnVmX2luZm8gKmRydl9pbmZvOworCitzdHJ1Y3QgdmlydGlvX3ZkbWFidWYg
eworCS8qIHZpcnRpbyBkZXZpY2Ugc3RydWN0dXJlICovCisJc3RydWN0IHZpcnRpb19kZXZpY2Ug
KnZkZXY7CisKKwkvKiB2aXJ0dWFsIHF1ZXVlIGFycmF5ICovCisJc3RydWN0IHZpcnRxdWV1ZSAq
dnE7CisKKwkvKiBJRCBvZiBndWVzdCBPUyAqLworCXU2NCB2bWlkOworCisJLyogc3BpbiBsb2Nr
IHRoYXQgbmVlZHMgdG8gYmUgYWNxdWlyZWQgYmVmb3JlIGFjY2Vzc2luZworCSAqIHZpcnR1YWwg
cXVldWUKKwkgKi8KKwlzcGlubG9ja190IHZxX2xvY2s7CisJc3RydWN0IG11dGV4IHJ4X2xvY2s7
CisKKwkvKiB3b3JrcXVldWUgKi8KKwlzdHJ1Y3Qgd29ya3F1ZXVlX3N0cnVjdCAqd3E7CisJc3Ry
dWN0IHdvcmtfc3RydWN0IHJ4X3dvcms7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmX2V2ZW50X3F1
ZXVlICpldnE7Cit9OworCitzdGF0aWMgdmlydGlvX3ZkbWFidWZfYnVmX2lkX3QgZ2V0X2J1Zl9p
ZChzdHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYpCit7CisJdmlydGlvX3ZkbWFidWZfYnVm
X2lkX3QgYnVmX2lkID0gezAsIHswLCAwfSB9OworCXN0YXRpYyBpbnQgY291bnQgPSAwOworCisJ
Y291bnQgPSBjb3VudCA8IFZJUlRJT19WRE1BQlVGX01BWF9JRCA/IGNvdW50ICsgMSA6IDA7CisJ
YnVmX2lkLmlkID0gTkVXX0JVRl9JRF9HRU4odmRtYWJ1Zi0+dm1pZCwgY291bnQpOworCisJLyog
cmFuZG9tIGRhdGEgZW1iZWRkZWQgaW4gdGhlIGlkIGZvciBzZWN1cml0eSAqLworCWdldF9yYW5k
b21fYnl0ZXMoJmJ1Zl9pZC5ybmdfa2V5WzBdLCA4KTsKKworCXJldHVybiBidWZfaWQ7Cit9CisK
Ky8qIHNoYXJpbmcgcGFnZXMgZm9yIG9yaWdpbmFsIERNQUJVRiB3aXRoIEhvc3QgKi8KK3N0YXRp
YyBzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfc2hhcmVkX3BhZ2VzCisqdmlydGlvX3ZkbWFidWZfc2hh
cmVfYnVmKHN0cnVjdCBwYWdlICoqcGFnZXMsIGludCBuZW50cywKKwkJCSAgaW50IGZpcnN0X29m
c3QsIGludCBsYXN0X2xlbikKK3sKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfc2hhcmVkX3BhZ2Vz
ICpwYWdlc19pbmZvOworCWludCBpOworCWludCBuX2wycmVmcyA9IG5lbnRzL1JFRlNfUEVSX1BB
R0UgKworCQkgICAgICAgKChuZW50cyAlIFJFRlNfUEVSX1BBR0UpID8gMSA6IDApOworCisJcGFn
ZXNfaW5mbyA9IGt2Y2FsbG9jKDEsIHNpemVvZigqcGFnZXNfaW5mbyksIEdGUF9LRVJORUwpOwor
CWlmICghcGFnZXNfaW5mbykKKwkJcmV0dXJuIE5VTEw7CisKKwlwYWdlc19pbmZvLT5wYWdlcyA9
IHBhZ2VzOworCXBhZ2VzX2luZm8tPm5lbnRzID0gbmVudHM7CisJcGFnZXNfaW5mby0+Zmlyc3Rf
b2ZzdCA9IGZpcnN0X29mc3Q7CisJcGFnZXNfaW5mby0+bGFzdF9sZW4gPSBsYXN0X2xlbjsKKwlw
YWdlc19pbmZvLT5sM3JlZnMgPSAoZ3BhX3QgKilfX2dldF9mcmVlX3BhZ2UoR0ZQX0tFUk5FTCk7
CisKKwlpZiAoIXBhZ2VzX2luZm8tPmwzcmVmcykgeworCQlrdmZyZWUocGFnZXNfaW5mbyk7CisJ
CXJldHVybiBOVUxMOworCX0KKworCXBhZ2VzX2luZm8tPmwycmVmcyA9IChncGFfdCAqKilfX2dl
dF9mcmVlX3BhZ2VzKEdGUF9LRVJORUwsCisJCQkJCWdldF9vcmRlcihuX2wycmVmcyAqIFBBR0Vf
U0laRSkpOworCisJaWYgKCFwYWdlc19pbmZvLT5sMnJlZnMpIHsKKwkJZnJlZV9wYWdlKChncGFf
dClwYWdlc19pbmZvLT5sM3JlZnMpOworCQlrdmZyZWUocGFnZXNfaW5mbyk7CisJCXJldHVybiBO
VUxMOworCX0KKworCS8qIFNoYXJlIHBoeXNpY2FsIGFkZHJlc3Mgb2YgcGFnZXMgKi8KKwlmb3Ig
KGkgPSAwOyBpIDwgbmVudHM7IGkrKykKKwkJcGFnZXNfaW5mby0+bDJyZWZzW2ldID0gKGdwYV90
ICopcGFnZV90b19waHlzKHBhZ2VzW2ldKTsKKworCWZvciAoaSA9IDA7IGkgPCBuX2wycmVmczsg
aSsrKQorCQlwYWdlc19pbmZvLT5sM3JlZnNbaV0gPQorCQkJdmlydF90b19waHlzKCh2b2lkICop
cGFnZXNfaW5mby0+bDJyZWZzICsKKwkJCQkgICAgIGkgKiBQQUdFX1NJWkUpOworCisJcGFnZXNf
aW5mby0+cmVmID0gKGdwYV90KXZpcnRfdG9fcGh5cyhwYWdlc19pbmZvLT5sM3JlZnMpOworCisJ
cmV0dXJuIHBhZ2VzX2luZm87Cit9CisKKy8qIHN0b3Agc2hhcmluZyBwYWdlcyAqLworc3RhdGlj
IHZvaWQKK3ZpcnRpb192ZG1hYnVmX2ZyZWVfYnVmKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9zaGFy
ZWRfcGFnZXMgKnBhZ2VzX2luZm8pCit7CisJaW50IG5fbDJyZWZzID0gKHBhZ2VzX2luZm8tPm5l
bnRzL1JFRlNfUEVSX1BBR0UgKworCQkgICAgICAgKChwYWdlc19pbmZvLT5uZW50cyAlIFJFRlNf
UEVSX1BBR0UpID8gMSA6IDApKTsKKworCWZyZWVfcGFnZXMoKGdwYV90KXBhZ2VzX2luZm8tPmwy
cmVmcywgZ2V0X29yZGVyKG5fbDJyZWZzICogUEFHRV9TSVpFKSk7CisJZnJlZV9wYWdlKChncGFf
dClwYWdlc19pbmZvLT5sM3JlZnMpOworCisJa3ZmcmVlKHBhZ2VzX2luZm8pOworfQorCitzdGF0
aWMgaW50IHNlbmRfbXNnX3RvX2hvc3QoZW51bSB2aXJ0aW9fdmRtYWJ1Zl9jbWQgY21kLCBpbnQg
Km9wKQoreworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1ZiAqdmRtYWJ1ZiA9IGRydl9pbmZvLT5wcml2
OworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9tc2cgKm1zZzsKKwlzdHJ1Y3Qgc2NhdHRlcmxpc3Qg
c2c7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKwlpbnQgaSwgdHhfc2l6ZSwgcmV0ID0gMDsKKwor
CXN3aXRjaCAoY21kKSB7CisJY2FzZSBWSVJUSU9fVkRNQUJVRl9DTURfTkVFRF9WTUlEOgorCQlt
c2cgPSBrdmNhbGxvYygxLCBzaXplb2Yoc3RydWN0IHZpcnRpb192ZG1hYnVmX21zZyksCisJCQkg
ICAgICAgR0ZQX0tFUk5FTCk7CisJCWlmICghbXNnKQorCQkJcmV0dXJuIC1FTk9NRU07CisKKwkJ
aWYgKG9wKQorCQkJZm9yIChpID0gMDsgaSA8IDQ7IGkrKykKKwkJCQltc2ctPm9wW2ldID0gb3Bb
aV07CisKKwkJdHhfc2l6ZSA9IHNpemVvZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfbXNnKTsKKwkJ
YnJlYWs7CisKKwljYXNlIFZJUlRJT19WRE1BQlVGX0NNRF9FWFBPUlQ6CisJCW1zZyA9IGt2Y2Fs
bG9jKDEsIHNpemVvZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfbXNnKSwKKwkJCSAgICAgICBHRlBf
S0VSTkVMKTsKKwkJaWYgKCFtc2cpCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQltZW1jcHkoJm1z
Zy0+b3BbMF0sICZvcFswXSwgOSAqIHNpemVvZihpbnQpICsgb3BbOV0pOworCQl0eF9zaXplID0g
c2l6ZW9mKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9tc2cpOworCQlicmVhazsKKworCWRlZmF1bHQ6
CisJCS8qIG5vIGNvbW1hbmQgZm91bmQgKi8KKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJbXNn
LT5jbWQgPSBjbWQ7CisJc2dfaW5pdF9vbmUoJnNnLCBtc2csIHR4X3NpemUpOworCisJc3Bpbl9s
b2NrX2lycXNhdmUoJnZkbWFidWYtPnZxX2xvY2ssIGZsYWdzKTsKKworCXJldCA9IHZpcnRxdWV1
ZV9hZGRfaW5idWYodmRtYWJ1Zi0+dnEsICZzZywgMSwgbXNnLCBHRlBfS0VSTkVMKTsKKwlpZiAo
cmV0KQorCQlnb3RvIGVycjsJCisKKwlpZiAoIXZpcnRxdWV1ZV9raWNrKHZkbWFidWYtPnZxKSkK
KwkJcmV0ID0gLUVJTlZBTDsKK2VycjoKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ2ZG1hYnVm
LT52cV9sb2NrLCBmbGFncyk7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IGFkZF9l
dmVudF9idWZfcmVsKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYgKmJ1Zl9pbmZvKQoreworCXN0
cnVjdCB2aXJ0aW9fdmRtYWJ1ZiAqdmRtYWJ1ZiA9IGRydl9pbmZvLT5wcml2OworCXN0cnVjdCB2
aXJ0aW9fdmRtYWJ1Zl9ldmVudCAqZV9vbGRlc3QsICplX25ldzsKKwlzdHJ1Y3QgdmlydGlvX3Zk
bWFidWZfZXZlbnRfcXVldWUgKmVxID0gdmRtYWJ1Zi0+ZXZxOworCXVuc2lnbmVkIGxvbmcgaXJx
ZmxhZ3M7CisKKwllX25ldyA9IGt2emFsbG9jKHNpemVvZigqZV9uZXcpLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIWVfbmV3KQorCQlyZXR1cm4gLUVOT01FTTsKKworCWVfbmV3LT5lX2RhdGEuaGRyLmJ1
Zl9pZCA9IGJ1Zl9pbmZvLT5idWZfaWQ7CisJZV9uZXctPmVfZGF0YS5kYXRhID0gKHZvaWQgKili
dWZfaW5mby0+cHJpdjsKKwllX25ldy0+ZV9kYXRhLmhkci5zaXplID0gYnVmX2luZm8tPnN6X3By
aXY7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZXEtPmVfbG9jaywgaXJxZmxhZ3MpOworCisJLyog
Y2hlY2sgY3VycmVudCBudW1iZXIgb2YgZXZlbnRzIGFuZCBpZiBpdCBoaXRzIHRoZSBtYXggbnVt
ICgzMikKKwkgKiB0aGVuIHJlbW92ZSB0aGUgb2xkZXN0IGV2ZW50IGluIHRoZSBsaXN0CisJICov
CisJaWYgKGVxLT5wZW5kaW5nID4gMzEpIHsKKwkJZV9vbGRlc3QgPSBsaXN0X2ZpcnN0X2VudHJ5
KCZlcS0+ZV9saXN0LAorCQkJCQkgICAgc3RydWN0IHZpcnRpb192ZG1hYnVmX2V2ZW50LCBsaW5r
KTsKKwkJbGlzdF9kZWwoJmVfb2xkZXN0LT5saW5rKTsKKwkJZXEtPnBlbmRpbmctLTsKKwkJa3Zm
cmVlKGVfb2xkZXN0KTsKKwl9CisKKwlsaXN0X2FkZF90YWlsKCZlX25ldy0+bGluaywgJmVxLT5l
X2xpc3QpOworCisJZXEtPnBlbmRpbmcrKzsKKworCXdha2VfdXBfaW50ZXJydXB0aWJsZSgmZXEt
PmVfd2FpdCk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZXEtPmVfbG9jaywgaXJxZmxhZ3Mp
OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIHZpcnRpb192ZG1hYnVmX2NsZWFyX2J1
ZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfYnVmICpleHApCit7CisJLyogU3RhcnQgY2xlYW51cCBv
ZiBidWZmZXIgaW4gcmV2ZXJzZSBvcmRlciB0byBleHBvcnRpbmcgKi8KKwl2aXJ0aW9fdmRtYWJ1
Zl9mcmVlX2J1ZihleHAtPnBhZ2VzX2luZm8pOworCisJZG1hX2J1Zl91bm1hcF9hdHRhY2htZW50
KGV4cC0+YXR0YWNoLCBleHAtPnNndCwKKwkJCQkgRE1BX0JJRElSRUNUSU9OQUwpOworCisJaWYg
KGV4cC0+ZG1hX2J1ZikgeworCQlkbWFfYnVmX2RldGFjaChleHAtPmRtYV9idWYsIGV4cC0+YXR0
YWNoKTsKKwkJLyogY2xvc2UgY29ubmVjdGlvbiB0byBkbWEtYnVmIGNvbXBsZXRlbHkgKi8KKwkJ
ZG1hX2J1Zl9wdXQoZXhwLT5kbWFfYnVmKTsKKwkJZXhwLT5kbWFfYnVmID0gTlVMTDsKKwl9Cit9
CisKK3N0YXRpYyBpbnQgcmVtb3ZlX2J1ZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYs
CisJCSAgICAgIHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYgKmV4cCkKK3sKKwlpbnQgcmV0Owor
CisJcmV0ID0gYWRkX2V2ZW50X2J1Zl9yZWwoZXhwKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OworCisJdmlydGlvX3ZkbWFidWZfY2xlYXJfYnVmKGV4cCk7CisKKwlyZXQgPSB2aXJ0aW9fdmRt
YWJ1Zl9kZWxfYnVmKGRydl9pbmZvLCAmZXhwLT5idWZfaWQpOworCWlmIChyZXQpCisJCXJldHVy
biByZXQ7CisKKwlpZiAoZXhwLT5zel9wcml2ID4gMCAmJiAhZXhwLT5wcml2KQorCQlrdmZyZWUo
ZXhwLT5wcml2KTsKKworCWt2ZnJlZShleHApOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50
IHBhcnNlX21zZ19mcm9tX2hvc3Qoc3RydWN0IHZpcnRpb192ZG1hYnVmICp2ZG1hYnVmLAorCQkg
ICAgIAkgICAgICAgc3RydWN0IHZpcnRpb192ZG1hYnVmX21zZyAqbXNnKQoreworCXN0cnVjdCB2
aXJ0aW9fdmRtYWJ1Zl9idWYgKmV4cDsKKwl2aXJ0aW9fdmRtYWJ1Zl9idWZfaWRfdCBidWZfaWQ7
CisJaW50IHJldDsKKworCS8qIGVtcHR5IG1lc3NhZ2Ugbm90IGFsbG93ZWQgYW5kIGlnbm9yZWQg
Ki8KKwlpZiAoIW1zZy0+Y21kKSB7CisJCWRldl9lcnIoZHJ2X2luZm8tPmRldiwgImVtcHR5IGNt
ZFxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCW1lbWNweSgmYnVmX2lkLCBtc2ctPm9w
LCBzaXplb2YoYnVmX2lkKSk7CisKKwlleHAgPSB2aXJ0aW9fdmRtYWJ1Zl9maW5kX2J1ZihkcnZf
aW5mbywgJmJ1Zl9pZCk7CisJaWYgKCFleHApIHsKKwkJZGV2X2VycihkcnZfaW5mby0+ZGV2LCAi
Y2FuJ3QgZmluZCBidWZmZXJcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlzd2l0Y2gg
KG1zZy0+Y21kKSB7CisJY2FzZSBWSVJUSU9fVkRNQUJVRl9DTURfRE1BQlVGX1JFTDoKKwkJcmV0
ID0gcmVtb3ZlX2J1Zih2ZG1hYnVmLCBleHApOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsK
KworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIHZvaWQgdmlydGlvX3ZkbWFidWZfcnhfd29yayhzdHJ1Y3Qgd29ya19z
dHJ1Y3QgKndvcmspCit7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmICp2ZG1hYnVmID0gZHJ2X2lu
Zm8tPnByaXY7CisJc3RydWN0IHZpcnRxdWV1ZSAqdnEgPSB2ZG1hYnVmLT52cTsKKwlzdHJ1Y3Qg
dmlydGlvX3ZkbWFidWZfbXNnICptc2c7CisJaW50IHN6OworCisJbXV0ZXhfbG9jaygmdmRtYWJ1
Zi0+cnhfbG9jayk7CisKKwlkbyB7CisJCXZpcnRxdWV1ZV9kaXNhYmxlX2NiKHZxKTsKKwkJbXNn
ID0gdmlydHF1ZXVlX2dldF9idWYodnEsICZzeik7CisJCWlmICghbXNnKQorCQkJYnJlYWs7CisK
KwkJLyogdmFsaWQgc2l6ZSAqLworCQlpZiAoc3ogPT0gc2l6ZW9mKHN0cnVjdCB2aXJ0aW9fdmRt
YWJ1Zl9tc2cpKSB7CisJCQlpZiAobXNnLT5jbWQgPT0gVklSVElPX1ZETUFCVUZfQ01EX05FRURf
Vk1JRCkgeworCQkJCXZkbWFidWYtPnZtaWQgPSBtc2ctPm9wWzBdOworCQkJfSBlbHNlIHsKKwkJ
CQlpZiAocGFyc2VfbXNnX2Zyb21faG9zdCh2ZG1hYnVmLCBtc2cpKQorCQkJCQlkZXZfZXJyKGRy
dl9pbmZvLT5kZXYsCisJCQkJCQkibXNnIHBhcnNlIGVycm9yXG4iKTsKKwkJCX0KKwkJfSBlbHNl
IHsKKwkJCWRldl9lcnIoZHJ2X2luZm8tPmRldiwKKwkJCQkicmVjZWl2ZWQgbWFsZm9ybWVkIG1l
c3NhZ2VcbiIpOworCQl9CisJfSB3aGlsZSAoIXZpcnRxdWV1ZV9lbmFibGVfY2IodnEpKTsKKwor
CW11dGV4X3VubG9jaygmdmRtYWJ1Zi0+cnhfbG9jayk7Cit9CisKK3N0YXRpYyB2b2lkIHJ4X2V2
ZW50KHN0cnVjdCB2aXJ0cXVldWUgKnZxKQoreworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1ZiAqdmRt
YWJ1ZiA9IGRydl9pbmZvLT5wcml2OworCisJcXVldWVfd29yayh2ZG1hYnVmLT53cSwgJnZkbWFi
dWYtPnJ4X3dvcmspOworfQorCitzdGF0aWMgaW50IHJlbW92ZV9hbGxfYnVmcyhzdHJ1Y3Qgdmly
dGlvX3ZkbWFidWYgKnZkbWFidWYpCit7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmX2J1ZiAqZm91
bmQ7CisJc3RydWN0IGhsaXN0X25vZGUgKnRtcDsKKwlpbnQgYmt0OworCWludCByZXQ7CisKKwlo
YXNoX2Zvcl9lYWNoX3NhZmUoZHJ2X2luZm8tPmJ1Zl9saXN0LCBia3QsIHRtcCwgZm91bmQsIG5v
ZGUpIHsKKwkJcmV0ID0gcmVtb3ZlX2J1Zih2ZG1hYnVmLCBmb3VuZCk7CisJCWlmIChyZXQpCisJ
CQlyZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHZpcnRpb192
ZG1hYnVmX29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbHApCit7CisJ
aWYgKCFkcnZfaW5mbykgeworCQlwcl9lcnIoInZpcnRpbyB2ZG1hYnVmIGRyaXZlciBpcyBub3Qg
cmVhZHlcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlmaWxwLT5wcml2YXRlX2RhdGEg
PSBkcnZfaW5mby0+cHJpdjsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHZpcnRpb192
ZG1hYnVmX3JlbGVhc2Uoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbHApCit7
CisJcmV0dXJuIDA7Cit9CisKKy8qIE5vdGlmeSBIb3N0IGFib3V0IHRoZSBuZXcgdmRtYWJ1ZiAq
Lworc3RhdGljIGludCBleHBvcnRfbm90aWZ5KHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYgKmV4
cCwgc3RydWN0IHBhZ2UgKipwYWdlcykKK3sKKwlpbnQgKm9wOworCWludCByZXQ7CisKKwlvcCA9
IGt2Y2FsbG9jKDEsIHNpemVvZihpbnQpICogNjUsIEdGUF9LRVJORUwpOworCWlmICghb3ApCisJ
CXJldHVybiAtRU5PTUVNOworCisJbWVtY3B5KG9wLCAmZXhwLT5idWZfaWQsIHNpemVvZihleHAt
PmJ1Zl9pZCkpOworCisJLyogaWYgbmV3IHBhZ2VzIGFyZSB0byBiZSBzaGFyZWQgKi8KKwlpZiAo
cGFnZXMpIHsKKwkJb3BbNF0gPSBleHAtPnBhZ2VzX2luZm8tPm5lbnRzOworCQlvcFs1XSA9IGV4
cC0+cGFnZXNfaW5mby0+Zmlyc3Rfb2ZzdDsKKwkJb3BbNl0gPSBleHAtPnBhZ2VzX2luZm8tPmxh
c3RfbGVuOworCisJCW1lbWNweSgmb3BbN10sICZleHAtPnBhZ2VzX2luZm8tPnJlZiwgc2l6ZW9m
KGdwYV90KSk7CisJfQorCisJb3BbOV0gPSBleHAtPnN6X3ByaXY7CisKKwkvKiBkcml2ZXIvYXBw
bGljYXRpb24gc3BlY2lmaWMgcHJpdmF0ZSBpbmZvICovCisJbWVtY3B5KCZvcFsxMF0sIGV4cC0+
cHJpdiwgb3BbOV0pOworCisJcmV0ID0gc2VuZF9tc2dfdG9faG9zdChWSVJUSU9fVkRNQUJVRl9D
TURfRVhQT1JULCBvcCk7CisKKwlrdmZyZWUob3ApOworCXJldHVybiByZXQ7Cit9CisKKy8qIHJl
dHVybiB0b3RhbCBudW1iZXIgb2YgcGFnZXMgcmVmZXJlbmNlZCBieSBhIHNndAorICogZm9yIHBy
ZS1jYWxjdWxhdGlvbiBvZiAjIG9mIHBhZ2VzIGJlaGluZCBhIGdpdmVuIHNndAorICovCitzdGF0
aWMgaW50IG51bV9wZ3Moc3RydWN0IHNnX3RhYmxlICpzZ3QpCit7CisJc3RydWN0IHNjYXR0ZXJs
aXN0ICpzZ2w7CisJaW50IGxlbiwgaTsKKwkvKiBhdCBsZWFzdCBvbmUgcGFnZSAqLworCWludCBu
X3BncyA9IDE7CisKKwlzZ2wgPSBzZ3QtPnNnbDsKKworCWxlbiA9IHNnbC0+bGVuZ3RoIC0gUEFH
RV9TSVpFICsgc2dsLT5vZmZzZXQ7CisKKwkvKiByb3VuZC11cCAqLworCW5fcGdzICs9ICgobGVu
ICsgUEFHRV9TSVpFIC0gMSkvUEFHRV9TSVpFKTsKKworCWZvciAoaSA9IDE7IGkgPCBzZ3QtPm5l
bnRzOyBpKyspIHsKKwkJc2dsID0gc2dfbmV4dChzZ2wpOworCisJCS8qIHJvdW5kLXVwICovCisJ
CW5fcGdzICs9ICgoc2dsLT5sZW5ndGggKyBQQUdFX1NJWkUgLSAxKSAvCisJCQkgIFBBR0VfU0la
RSk7IC8qIHJvdW5kLXVwICovCisJfQorCisJcmV0dXJuIG5fcGdzOworfQorCisvKiBleHRyYWN0
IHBhZ2VzIHJlZmVyZW5jZWQgYnkgc2d0ICovCitzdGF0aWMgc3RydWN0IHBhZ2UgKipleHRyX3Bn
cyhzdHJ1Y3Qgc2dfdGFibGUgKnNndCwgaW50ICpuZW50cywgaW50ICpsYXN0X2xlbikKK3sKKwlz
dHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnbDsKKwlzdHJ1Y3QgcGFnZSAqKnBhZ2VzOworCXN0cnVjdCBw
YWdlICoqdGVtcF9wZ3M7CisJaW50IGksIGo7CisJaW50IGxlbjsKKworCSpuZW50cyA9IG51bV9w
Z3Moc2d0KTsKKwlwYWdlcyA9CWt2bWFsbG9jX2FycmF5KCpuZW50cywgc2l6ZW9mKHN0cnVjdCBw
YWdlICopLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXBhZ2VzKQorCQlyZXR1cm4gTlVMTDsKKworCXNn
bCA9IHNndC0+c2dsOworCisJdGVtcF9wZ3MgPSBwYWdlczsKKwkqdGVtcF9wZ3MrKyA9IHNnX3Bh
Z2Uoc2dsKTsKKwlsZW4gPSBzZ2wtPmxlbmd0aCAtIFBBR0VfU0laRSArIHNnbC0+b2Zmc2V0Owor
CisJaSA9IDE7CisJd2hpbGUgKGxlbiA+IDApIHsKKwkJKnRlbXBfcGdzKysgPSBudGhfcGFnZShz
Z19wYWdlKHNnbCksIGkrKyk7CisJCWxlbiAtPSBQQUdFX1NJWkU7CisJfQorCisJZm9yIChpID0g
MTsgaSA8IHNndC0+bmVudHM7IGkrKykgeworCQlzZ2wgPSBzZ19uZXh0KHNnbCk7CisJCSp0ZW1w
X3BncysrID0gc2dfcGFnZShzZ2wpOworCQlsZW4gPSBzZ2wtPmxlbmd0aCAtIFBBR0VfU0laRTsK
KwkJaiA9IDE7CisKKwkJd2hpbGUgKGxlbiA+IDApIHsKKwkJCSp0ZW1wX3BncysrID0gbnRoX3Bh
Z2Uoc2dfcGFnZShzZ2wpLCBqKyspOworCQkJbGVuIC09IFBBR0VfU0laRTsKKwkJfQorCX0KKwor
CSpsYXN0X2xlbiA9IGxlbiArIFBBR0VfU0laRTsKKworCXJldHVybiBwYWdlczsKK30KKworLyog
aW9jdGwgLSBleHBvcnRpbmcgbmV3IHZkbWFidWYKKyAqCisgKgkgaW50IGRtYWJ1Zl9mZCAtIEZp
bGUgaGFuZGxlIG9mIG9yaWdpbmFsIERNQUJVRgorICoJIHZpcnRpb192ZG1hYnVmX2J1Zl9pZF90
IGJ1Zl9pZCAtIHJldHVybmVkIHZkbWFidWYgSUQKKyAqCSBpbnQgc3pfcHJpdiAtIHNpemUgb2Yg
cHJpdmF0ZSBkYXRhIGZyb20gdXNlcnNwYWNlCisgKgkgY2hhciAqcHJpdiAtIGJ1ZmZlciBvZiB1
c2VyIHByaXZhdGUgZGF0YQorICoKKyAqLworc3RhdGljIGludCBleHBvcnRfaW9jdGwoc3RydWN0
IGZpbGUgKmZpbHAsIHZvaWQgKmRhdGEpCit7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmICp2ZG1h
YnVmID0gZHJ2X2luZm8tPnByaXY7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmX2V4cG9ydCAqYXR0
ciA9IGRhdGE7CisJc3RydWN0IGRtYV9idWYgKmRtYWJ1ZjsKKwlzdHJ1Y3QgZG1hX2J1Zl9hdHRh
Y2htZW50ICphdHRhY2g7CisJc3RydWN0IHNnX3RhYmxlICpzZ3Q7CisJc3RydWN0IHZpcnRpb192
ZG1hYnVmX2J1ZiAqZXhwOworCXN0cnVjdCBwYWdlICoqcGFnZXM7CisJaW50IG5lbnRzLCBsYXN0
X2xlbjsKKwl2aXJ0aW9fdmRtYWJ1Zl9idWZfaWRfdCBidWZfaWQ7CisJaW50IHJldCA9IDA7CisK
KwlpZiAodmRtYWJ1Zi0+dm1pZCA8PSAwKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWRtYWJ1ZiA9
IGRtYV9idWZfZ2V0KGF0dHItPmZkKTsKKwlpZiAoSVNfRVJSKGRtYWJ1ZikpCisJCXJldHVybiBQ
VFJfRVJSKGRtYWJ1Zik7CisKKwltdXRleF9sb2NrKCZkcnZfaW5mby0+Z19tdXRleCk7CisKKwli
dWZfaWQgPSBnZXRfYnVmX2lkKHZkbWFidWYpOworCisJYXR0YWNoID0gZG1hX2J1Zl9hdHRhY2go
ZG1hYnVmLCBkcnZfaW5mby0+ZGV2KTsKKwlpZiAoSVNfRVJSKGF0dGFjaCkpIHsKKwkJcmV0ID0g
UFRSX0VSUihhdHRhY2gpOworCQlnb3RvIGZhaWxfYXR0YWNoOworCX0KKworCXNndCA9IGRtYV9i
dWZfbWFwX2F0dGFjaG1lbnQoYXR0YWNoLCBETUFfQklESVJFQ1RJT05BTCk7CisJaWYgKElTX0VS
UihzZ3QpKSB7CisJCXJldCA9IFBUUl9FUlIoc2d0KTsKKwkJZ290byBmYWlsX21hcF9hdHRhY2ht
ZW50OworCX0KKworCS8qIGFsbG9jYXRlIGEgbmV3IGV4cCAqLworCWV4cCA9IGt2Y2FsbG9jKDEs
IHNpemVvZigqZXhwKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFleHApIHsKKwkJcmV0ID0gLUVOT01F
TTsKKwkJZ290byBmYWlsX3NndF9pbmZvX2NyZWF0aW9uOworCX0KKworCS8qIHBvc3NpYmxlIHRy
dW5jYXRpb24gKi8KKwlpZiAoYXR0ci0+c3pfcHJpdiA+IE1BWF9TSVpFX1BSSVZfREFUQSkKKwkJ
ZXhwLT5zel9wcml2ID0gTUFYX1NJWkVfUFJJVl9EQVRBOworCWVsc2UKKwkJZXhwLT5zel9wcml2
ID0gYXR0ci0+c3pfcHJpdjsKKworCS8qIGNyZWF0aW5nIGJ1ZmZlciBmb3IgcHJpdmF0ZSBkYXRh
ICovCisJaWYgKGV4cC0+c3pfcHJpdiAhPSAwKSB7CisJCWV4cC0+cHJpdiA9IGt2Y2FsbG9jKDEs
IGV4cC0+c3pfcHJpdiwgR0ZQX0tFUk5FTCk7CisJCWlmICghZXhwLT5wcml2KSB7CisJCQlyZXQg
PSAtRU5PTUVNOworCQkJZ290byBmYWlsX3ByaXZfY3JlYXRpb247CisJCX0KKwl9CisKKwlleHAt
PmJ1Zl9pZCA9IGJ1Zl9pZDsKKwlleHAtPmF0dGFjaCA9IGF0dGFjaDsKKwlleHAtPnNndCA9IHNn
dDsKKwlleHAtPmRtYV9idWYgPSBkbWFidWY7CisJZXhwLT52YWxpZCA9IDE7CisKKwlpZiAoZXhw
LT5zel9wcml2KSB7CisJCS8qIGNvcHkgcHJpdmF0ZSBkYXRhIHRvIHNndF9pbmZvICovCisJCXJl
dCA9IGNvcHlfZnJvbV91c2VyKGV4cC0+cHJpdiwgYXR0ci0+cHJpdiwgZXhwLT5zel9wcml2KTsK
KwkJaWYgKHJldCkgeworCQkJcmV0ID0gLUVJTlZBTDsKKwkJCWdvdG8gZmFpbF9leHA7CisJCX0K
Kwl9CisKKwlwYWdlcyA9IGV4dHJfcGdzKHNndCwgJm5lbnRzLCAmbGFzdF9sZW4pOworCWlmIChw
YWdlcyA9PSBOVUxMKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZmFpbF9leHA7CisJfQor
CisJZXhwLT5wYWdlc19pbmZvID0gdmlydGlvX3ZkbWFidWZfc2hhcmVfYnVmKHBhZ2VzLCBuZW50
cywKKwkJCQkJCSAgIHNndC0+c2dsLT5vZmZzZXQsCisJCQkJCSAJICAgbGFzdF9sZW4pOworCWlm
ICghZXhwLT5wYWdlc19pbmZvKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZmFpbF9jcmVh
dGVfcGFnZXNfaW5mbzsKKwl9CisKKwlhdHRyLT5idWZfaWQgPSBleHAtPmJ1Zl9pZDsKKwlyZXQg
PSBleHBvcnRfbm90aWZ5KGV4cCwgcGFnZXMpOworCWlmIChyZXQgPCAwKQorCQlnb3RvIGZhaWxf
c2VuZF9yZXF1ZXN0OworCisJLyogbm93IHJlZ2lzdGVyIGl0IHRvIHRoZSBleHBvcnQgbGlzdCAq
LworCXZpcnRpb192ZG1hYnVmX2FkZF9idWYoZHJ2X2luZm8sIGV4cCk7CisKKwlleHAtPmZpbHAg
PSBmaWxwOworCisJbXV0ZXhfdW5sb2NrKCZkcnZfaW5mby0+Z19tdXRleCk7CisKKwlyZXR1cm4g
cmV0OworCisvKiBDbGVhbi11cCBpZiBlcnJvciBvY2N1cnMgKi8KK2ZhaWxfc2VuZF9yZXF1ZXN0
OgorCXZpcnRpb192ZG1hYnVmX2ZyZWVfYnVmKGV4cC0+cGFnZXNfaW5mbyk7CisKK2ZhaWxfY3Jl
YXRlX3BhZ2VzX2luZm86CisJa3ZmcmVlKHBhZ2VzKTsKKworZmFpbF9leHA6CisJa3ZmcmVlKGV4
cC0+cHJpdik7CisKK2ZhaWxfcHJpdl9jcmVhdGlvbjoKKwlrdmZyZWUoZXhwKTsKKworZmFpbF9z
Z3RfaW5mb19jcmVhdGlvbjoKKwlkbWFfYnVmX3VubWFwX2F0dGFjaG1lbnQoYXR0YWNoLCBzZ3Qs
CisJCQkJIERNQV9CSURJUkVDVElPTkFMKTsKKworZmFpbF9tYXBfYXR0YWNobWVudDoKKwlkbWFf
YnVmX2RldGFjaChkbWFidWYsIGF0dGFjaCk7CisKK2ZhaWxfYXR0YWNoOgorCWRtYV9idWZfcHV0
KGRtYWJ1Zik7CisKKwltdXRleF91bmxvY2soJmRydl9pbmZvLT5nX211dGV4KTsKKworCXJldHVy
biByZXQ7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfaW9jdGxfZGVz
YyB2aXJ0aW9fdmRtYWJ1Zl9pb2N0bHNbXSA9IHsKKwlWSVJUSU9fVkRNQUJVRl9JT0NUTF9ERUYo
VklSVElPX1ZETUFCVUZfSU9DVExfRVhQT1JULCBleHBvcnRfaW9jdGwsIDApLAorfTsKKworc3Rh
dGljIGxvbmcgdmlydGlvX3ZkbWFidWZfaW9jdGwoc3RydWN0IGZpbGUgKmZpbHAsIHVuc2lnbmVk
IGludCBjbWQsCisJCSAgICAgICAJCSB1bnNpZ25lZCBsb25nIHBhcmFtKQoreworCWNvbnN0IHN0
cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9pb2N0bF9kZXNjICppb2N0bCA9IE5VTEw7CisJdW5zaWduZWQg
aW50IG5yID0gX0lPQ19OUihjbWQpOworCWludCByZXQ7CisJdmlydGlvX3ZkbWFidWZfaW9jdGxf
dCBmdW5jOworCWNoYXIgKmtkYXRhOworCisJaWYgKG5yID49IEFSUkFZX1NJWkUodmlydGlvX3Zk
bWFidWZfaW9jdGxzKSkgeworCQlkZXZfZXJyKGRydl9pbmZvLT5kZXYsICJpbnZhbGlkIGlvY3Rs
XG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaW9jdGwgPSAmdmlydGlvX3ZkbWFidWZf
aW9jdGxzW25yXTsKKworCWZ1bmMgPSBpb2N0bC0+ZnVuYzsKKworCWlmICh1bmxpa2VseSghZnVu
YykpIHsKKwkJZGV2X2VycihkcnZfaW5mby0+ZGV2LCAibm8gZnVuY3Rpb25cbiIpOworCQlyZXR1
cm4gLUVJTlZBTDsKKwl9CisKKwlrZGF0YSA9IGt2bWFsbG9jKF9JT0NfU0laRShjbWQpLCBHRlBf
S0VSTkVMKTsKKwlpZiAoIWtkYXRhKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWlmIChjb3B5X2Zy
b21fdXNlcihrZGF0YSwgKHZvaWQgX191c2VyICopcGFyYW0sCisJCQkgICBfSU9DX1NJWkUoY21k
KSkgIT0gMCkgeworCQlkZXZfZXJyKGRydl9pbmZvLT5kZXYsCisJCQkiZmFpbGVkIHRvIGNvcHkg
ZnJvbSB1c2VyIGFyZ3VtZW50c1xuIik7CisJCXJldCA9IC1FRkFVTFQ7CisJCWdvdG8gaW9jdGxf
ZXJyb3I7CisJfQorCisJcmV0ID0gZnVuYyhmaWxwLCBrZGF0YSk7CisKKwlpZiAoY29weV90b191
c2VyKCh2b2lkIF9fdXNlciAqKXBhcmFtLCBrZGF0YSwKKwkJCSBfSU9DX1NJWkUoY21kKSkgIT0g
MCkgeworCQlkZXZfZXJyKGRydl9pbmZvLT5kZXYsCisJCQkiZmFpbGVkIHRvIGNvcHkgdG8gdXNl
ciBhcmd1bWVudHNcbiIpOworCQlyZXQgPSAtRUZBVUxUOworCQlnb3RvIGlvY3RsX2Vycm9yOwor
CX0KKworaW9jdGxfZXJyb3I6CisJa3ZmcmVlKGtkYXRhKTsKKwlyZXR1cm4gcmV0OworfQorCitz
dGF0aWMgdW5zaWduZWQgaW50IHZpcnRpb192ZG1hYnVmX2V2ZW50X3BvbGwoc3RydWN0IGZpbGUg
KmZpbHAsCisJCQkgICAgCSAgICAJICAgICAgc3RydWN0IHBvbGxfdGFibGVfc3RydWN0ICp3YWl0
KQoreworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1ZiAqdmRtYWJ1ZiA9IGZpbHAtPnByaXZhdGVfZGF0
YTsKKworCXBvbGxfd2FpdChmaWxwLCAmdmRtYWJ1Zi0+ZXZxLT5lX3dhaXQsIHdhaXQpOworCisJ
aWYgKCFsaXN0X2VtcHR5KCZ2ZG1hYnVmLT5ldnEtPmVfbGlzdCkpCisJCXJldHVybiBQT0xMSU4g
fCBQT0xMUkROT1JNOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzc2l6ZV90IHZpcnRpb192
ZG1hYnVmX2V2ZW50X3JlYWQoc3RydWN0IGZpbGUgKmZpbHAsIGNoYXIgX191c2VyICpidWYsCisJ
CQkgICAgICAgCQkgc2l6ZV90IGNudCwgbG9mZl90ICpvZnN0KQoreworCXN0cnVjdCB2aXJ0aW9f
dmRtYWJ1ZiAqdmRtYWJ1ZiA9IGZpbHAtPnByaXZhdGVfZGF0YTsKKwlpbnQgcmV0OworCisJLyog
bWFrZSBzdXJlIHVzZXIgYnVmZmVyIGNhbiBiZSB3cml0dGVuICovCisJaWYgKCFhY2Nlc3Nfb2so
YnVmLCBzaXplb2YgKCpidWYpKSkgeworCQlkZXZfZXJyKGRydl9pbmZvLT5kZXYsICJ1c2VyIGJ1
ZmZlciBjYW4ndCBiZSB3cml0dGVuLlxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCXJl
dCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmdmRtYWJ1Zi0+ZXZxLT5lX3JlYWRsb2NrKTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJZm9yICg7OykgeworCQlzdHJ1Y3QgdmlydGlv
X3ZkbWFidWZfZXZlbnQgKmUgPSBOVUxMOworCisJCXNwaW5fbG9ja19pcnEoJnZkbWFidWYtPmV2
cS0+ZV9sb2NrKTsKKwkJaWYgKCFsaXN0X2VtcHR5KCZ2ZG1hYnVmLT5ldnEtPmVfbGlzdCkpIHsK
KwkJCWUgPSBsaXN0X2ZpcnN0X2VudHJ5KCZ2ZG1hYnVmLT5ldnEtPmVfbGlzdCwKKwkJCQkJICAg
ICBzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfZXZlbnQsIGxpbmspOworCQkJbGlzdF9kZWwoJmUtPmxp
bmspOworCQl9CisJCXNwaW5fdW5sb2NrX2lycSgmdmRtYWJ1Zi0+ZXZxLT5lX2xvY2spOworCisJ
CWlmICghZSkgeworCQkJaWYgKHJldCkKKwkJCQlicmVhazsKKworCQkJaWYgKGZpbHAtPmZfZmxh
Z3MgJiBPX05PTkJMT0NLKSB7CisJCQkJcmV0ID0gLUVBR0FJTjsKKwkJCQlicmVhazsKKwkJCX0K
KworCQkJbXV0ZXhfdW5sb2NrKCZ2ZG1hYnVmLT5ldnEtPmVfcmVhZGxvY2spOworCQkJcmV0ID0g
d2FpdF9ldmVudF9pbnRlcnJ1cHRpYmxlKHZkbWFidWYtPmV2cS0+ZV93YWl0LAorCQkJCQkhbGlz
dF9lbXB0eSgmdmRtYWJ1Zi0+ZXZxLT5lX2xpc3QpKTsKKworCQkJaWYgKHJldCA9PSAwKQorCQkJ
CXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgKKwkJCQkJCSZ2ZG1hYnVmLT5ldnEtPmVf
cmVhZGxvY2spOworCisJCQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisJCX0gZWxzZSB7CisJ
CQl1bnNpZ25lZCBpbnQgbGVuID0gKHNpemVvZihlLT5lX2RhdGEuaGRyKSArCisJCQkJCSAgICBl
LT5lX2RhdGEuaGRyLnNpemUpOworCisJCQlpZiAobGVuID4gY250IC0gcmV0KSB7CitwdXRfYmFj
a19ldmVudDoKKwkJCQlzcGluX2xvY2tfaXJxKCZ2ZG1hYnVmLT5ldnEtPmVfbG9jayk7CisJCQkJ
bGlzdF9hZGQoJmUtPmxpbmssICZ2ZG1hYnVmLT5ldnEtPmVfbGlzdCk7CisJCQkJc3Bpbl91bmxv
Y2tfaXJxKCZ2ZG1hYnVmLT5ldnEtPmVfbG9jayk7CisJCQkJYnJlYWs7CisJCQl9CisKKwkJCWlm
IChjb3B5X3RvX3VzZXIoYnVmICsgcmV0LCAmZS0+ZV9kYXRhLmhkciwKKwkJCQkJIHNpemVvZihl
LT5lX2RhdGEuaGRyKSkpIHsKKwkJCQlpZiAocmV0ID09IDApCisJCQkJCXJldCA9IC1FRkFVTFQ7
CisKKwkJCQlnb3RvIHB1dF9iYWNrX2V2ZW50OworCQkJfQorCisJCQlyZXQgKz0gc2l6ZW9mKGUt
PmVfZGF0YS5oZHIpOworCisJCQlpZiAoY29weV90b191c2VyKGJ1ZiArIHJldCwgZS0+ZV9kYXRh
LmRhdGEsCisJCQkJCSBlLT5lX2RhdGEuaGRyLnNpemUpKSB7CisJCQkJLyogZXJyb3Igd2hpbGUg
Y29weWluZyB2b2lkICpkYXRhICovCisKKwkJCQlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfZV9oZHIg
ZHVtbXlfaGRyID0gezB9OworCisJCQkJcmV0IC09IHNpemVvZihlLT5lX2RhdGEuaGRyKTsKKwor
CQkJCS8qIG51bGxpZnlpbmcgaGRyIG9mIHRoZSBldmVudCBpbiB1c2VyIGJ1ZmZlciAqLworCQkJ
CWlmIChjb3B5X3RvX3VzZXIoYnVmICsgcmV0LCAmZHVtbXlfaGRyLAorCQkJCQkJIHNpemVvZihk
dW1teV9oZHIpKSkKKwkJCQkJZGV2X2VycihkcnZfaW5mby0+ZGV2LAorCQkJCQkgICAiZmFpbCB0
byBudWxsaWZ5IGludmFsaWQgaGRyXG4iKTsKKworCQkJCXJldCA9IC1FRkFVTFQ7CisKKwkJCQln
b3RvIHB1dF9iYWNrX2V2ZW50OworCQkJfQorCisJCQlyZXQgKz0gZS0+ZV9kYXRhLmhkci5zaXpl
OworCQkJdmRtYWJ1Zi0+ZXZxLT5wZW5kaW5nLS07CisJCQlrdmZyZWUoZSk7CisJCX0KKwl9CisK
KwltdXRleF91bmxvY2soJnZkbWFidWYtPmV2cS0+ZV9yZWFkbG9jayk7CisKKwlyZXR1cm4gcmV0
OworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyB2aXJ0aW9fdmRtYWJ1
Zl9mb3BzID0geworCS5vd25lciA9IFRISVNfTU9EVUxFLAorCS5vcGVuID0gdmlydGlvX3ZkbWFi
dWZfb3BlbiwKKwkucmVsZWFzZSA9IHZpcnRpb192ZG1hYnVmX3JlbGVhc2UsCisJLnJlYWQgPSB2
aXJ0aW9fdmRtYWJ1Zl9ldmVudF9yZWFkLAorCS5wb2xsID0gdmlydGlvX3ZkbWFidWZfZXZlbnRf
cG9sbCwKKwkudW5sb2NrZWRfaW9jdGwgPSB2aXJ0aW9fdmRtYWJ1Zl9pb2N0bCwKK307CisKK3N0
YXRpYyBzdHJ1Y3QgbWlzY2RldmljZSB2aXJ0aW9fdmRtYWJ1Zl9taXNjZGV2ID0geworCS5taW5v
ciA9IE1JU0NfRFlOQU1JQ19NSU5PUiwKKwkubmFtZSA9ICJ2aXJ0aW8tdmRtYWJ1ZiIsCisJLmZv
cHMgPSAmdmlydGlvX3ZkbWFidWZfZm9wcywKK307CisKK3N0YXRpYyBpbnQgdmlydGlvX3ZkbWFi
dWZfdmRldl9wcm9iZShzdHJ1Y3QgdmlydGlvX2RldmljZSAqdmRldikKK3sKKwl2cV9jYWxsYmFj
a190ICpjYltdID0ge3J4X2V2ZW50fTsKKwlzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IG5hbWVb
XSA9IHsidmlydGlvX3ZkbWFidWZfdmlydHF1ZXVlIn07CisJc3RydWN0IHZpcnRpb192ZG1hYnVm
ICp2ZG1hYnVmOworCWludCByZXQgPSAwOworCisJaWYgKCFkcnZfaW5mbykKKwkJcmV0dXJuIC1F
SU5WQUw7CisKKwl2ZG1hYnVmID0gZHJ2X2luZm8tPnByaXY7CisKKwlpZiAoIXZkbWFidWYpCisJ
CXJldHVybiAtRUlOVkFMOworCisJdmRtYWJ1Zi0+dmRldiA9IHZkZXY7CisJdmRldi0+cHJpdiA9
IHZkbWFidWY7CisKKwkvKiBpbml0aWFsaXplIHNwaW5sb2NrIGZvciBzeW5jaHJvbml6aW5nIHZp
cnRxdWV1ZSBhY2Nlc3NlcyAqLworCXNwaW5fbG9ja19pbml0KCZ2ZG1hYnVmLT52cV9sb2NrKTsK
KworCXJldCA9IHZpcnRpb19maW5kX3Zxcyh2ZG1hYnVmLT52ZGV2LCAxLCAmdmRtYWJ1Zi0+dnEs
IGNiLAorCQkJICAgICAgbmFtZSwgTlVMTCk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKGRydl9p
bmZvLT5kZXYsICJDYW5ub3QgZmluZCBhbnkgdnFzXG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisK
KwlJTklUX1dPUksoJnZkbWFidWYtPnJ4X3dvcmssIHZpcnRpb192ZG1hYnVmX3J4X3dvcmspOwor
CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgdmlydGlvX3ZkbWFidWZfdmRldl9yZW1v
dmUoc3RydWN0IHZpcnRpb19kZXZpY2UgKnZkZXYpCit7CisJc3RydWN0IHZpcnRpb192ZG1hYnVm
ICp2ZG1hYnVmOworCisJaWYgKCFkcnZfaW5mbykKKwkJcmV0dXJuOworCisJdmRtYWJ1ZiA9IGRy
dl9pbmZvLT5wcml2OworCWZsdXNoX3dvcmsoJnZkbWFidWYtPnJ4X3dvcmspOworCisJdmRldi0+
Y29uZmlnLT5yZXNldCh2ZGV2KTsKKwl2ZGV2LT5jb25maWctPmRlbF92cXModmRldik7Cit9CisK
K3N0YXRpYyB2b2lkIHZpcnRpb192ZG1hYnVmX3ZkZXZfc2NhbihzdHJ1Y3QgdmlydGlvX2Rldmlj
ZSAqdmRldikKK3sKKwlpbnQgcmV0OworCisJLyogU2VuZCBWSVJUSU9fVkRNQUJVRl9DTURfTkVF
RF9WTUlEIHJlcXVlc3QgdG8ga25vdyB2bWlkCisJICovCisJcmV0ID0gc2VuZF9tc2dfdG9faG9z
dChWSVJUSU9fVkRNQUJVRl9DTURfTkVFRF9WTUlELCAwKTsKKwlpZiAocmV0IDwgMCkKKwkJZGV2
X2VycihkcnZfaW5mby0+ZGV2LCAiZmFpbCB0byByZWNlaXZlIHZtaWRcbiIpOworCisJcmV0dXJu
OworfQorCitzdGF0aWMgc3RydWN0IHZpcnRpb19kZXZpY2VfaWQgaWRfdGFibGVbXSA9IHsKKwl7
IFZJUlRJT19JRF9WRE1BQlVGLCBWSVJUSU9fREVWX0FOWV9JRCB9LAorCXsgMCB9LAorfTsKKwor
c3RhdGljIHN0cnVjdCB2aXJ0aW9fZHJpdmVyIHZpcnRpb192ZG1hYnVmX3ZkZXZfZHJ2ID0gewor
CS5kcml2ZXIubmFtZSA9ICBLQlVJTERfTU9ETkFNRSwKKwkuZHJpdmVyLm93bmVyID0gVEhJU19N
T0RVTEUsCisJLmlkX3RhYmxlID0gICAgIGlkX3RhYmxlLAorCS5wcm9iZSA9ICAgICAgICB2aXJ0
aW9fdmRtYWJ1Zl92ZGV2X3Byb2JlLAorCS5yZW1vdmUgPSAgICAgICB2aXJ0aW9fdmRtYWJ1Zl92
ZGV2X3JlbW92ZSwKKwkuc2NhbiA9ICAgICAgICAgdmlydGlvX3ZkbWFidWZfdmRldl9zY2FuLAor
fTsKKworc3RhdGljIGludCBfX2luaXQgdmlydGlvX3ZkbWFidWZfaW5pdCh2b2lkKQoreworCXN0
cnVjdCB2aXJ0aW9fdmRtYWJ1ZiAqdmRtYWJ1ZjsKKwlpbnQgcmV0ID0gMDsKKworCWRydl9pbmZv
ID0gTlVMTDsKKworCXJldCA9IG1pc2NfcmVnaXN0ZXIoJnZpcnRpb192ZG1hYnVmX21pc2NkZXYp
OworCWlmIChyZXQpIHsKKwkJcHJfZXJyKCJ2aXJ0aW8tdmRtYWJ1ZiBtaXNjIGRyaXZlciBjYW4n
dCBiZSByZWdpc3RlcmVkXG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlkbWFfY29lcmNlX21h
c2tfYW5kX2NvaGVyZW50KHZpcnRpb192ZG1hYnVmX21pc2NkZXYudGhpc19kZXZpY2UsCisJCQkJ
ICAgICBETUFfQklUX01BU0soNjQpKTsKKworCWRydl9pbmZvID0ga3ZjYWxsb2MoMSwgc2l6ZW9m
KCpkcnZfaW5mbyksIEdGUF9LRVJORUwpOworCWlmICghZHJ2X2luZm8pIHsKKwkJbWlzY19kZXJl
Z2lzdGVyKCZ2aXJ0aW9fdmRtYWJ1Zl9taXNjZGV2KTsKKwkJcmV0dXJuIC1FTk9NRU07CisJfQor
CisJdmRtYWJ1ZiA9IGt2Y2FsbG9jKDEsIHNpemVvZigqdmRtYWJ1ZiksIEdGUF9LRVJORUwpOwor
CWlmICghdmRtYWJ1ZikgeworCQlrdmZyZWUoZHJ2X2luZm8pOworCQltaXNjX2RlcmVnaXN0ZXIo
JnZpcnRpb192ZG1hYnVmX21pc2NkZXYpOworCQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwl2ZG1h
YnVmLT5ldnEgPSBrdmNhbGxvYygxLCBzaXplb2YoKih2ZG1hYnVmLT5ldnEpKSwgR0ZQX0tFUk5F
TCk7CisJaWYgKCF2ZG1hYnVmLT5ldnEpIHsKKwkJa3ZmcmVlKGRydl9pbmZvKTsKKwkJa3ZmcmVl
KHZkbWFidWYpOworCQltaXNjX2RlcmVnaXN0ZXIoJnZpcnRpb192ZG1hYnVmX21pc2NkZXYpOwor
CQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwlkcnZfaW5mby0+cHJpdiA9ICh2b2lkICopdmRtYWJ1
ZjsKKwlkcnZfaW5mby0+ZGV2ID0gdmlydGlvX3ZkbWFidWZfbWlzY2Rldi50aGlzX2RldmljZTsK
KworCW11dGV4X2luaXQoJmRydl9pbmZvLT5nX211dGV4KTsKKworCW11dGV4X2luaXQoJnZkbWFi
dWYtPmV2cS0+ZV9yZWFkbG9jayk7CisJc3Bpbl9sb2NrX2luaXQoJnZkbWFidWYtPmV2cS0+ZV9s
b2NrKTsKKworCUlOSVRfTElTVF9IRUFEKCZ2ZG1hYnVmLT5ldnEtPmVfbGlzdCk7CisJaW5pdF93
YWl0cXVldWVfaGVhZCgmdmRtYWJ1Zi0+ZXZxLT5lX3dhaXQpOworCWhhc2hfaW5pdChkcnZfaW5m
by0+YnVmX2xpc3QpOworCisJdmRtYWJ1Zi0+ZXZxLT5wZW5kaW5nID0gMDsKKwl2ZG1hYnVmLT53
cSA9IGNyZWF0ZV93b3JrcXVldWUoInZpcnRpb192ZG1hYnVmX3dxIik7CisKKwlyZXQgPSByZWdp
c3Rlcl92aXJ0aW9fZHJpdmVyKCZ2aXJ0aW9fdmRtYWJ1Zl92ZGV2X2Rydik7CisJaWYgKHJldCkg
eworCQlkZXZfZXJyKGRydl9pbmZvLT5kZXYsICJ2ZG1hYnVmIGRyaXZlciBjYW4ndCBiZSByZWdp
c3RlcmVkXG4iKTsKKwkJbWlzY19kZXJlZ2lzdGVyKCZ2aXJ0aW9fdmRtYWJ1Zl9taXNjZGV2KTsK
KwkJa3ZmcmVlKHZkbWFidWYpOworCQlrdmZyZWUoZHJ2X2luZm8pOworCQlyZXR1cm4gLUVGQVVM
VDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgX19leGl0IHZpcnRpb192ZG1h
YnVmX2RlaW5pdCh2b2lkKQoreworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1ZiAqdmRtYWJ1ZiA9IGRy
dl9pbmZvLT5wcml2OworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9ldmVudCAqZSwgKmV0OworCXVu
c2lnbmVkIGxvbmcgaXJxZmxhZ3M7CisKKwltaXNjX2RlcmVnaXN0ZXIoJnZpcnRpb192ZG1hYnVm
X21pc2NkZXYpOworCXVucmVnaXN0ZXJfdmlydGlvX2RyaXZlcigmdmlydGlvX3ZkbWFidWZfdmRl
dl9kcnYpOworCisJaWYgKHZkbWFidWYtPndxKQorCQlkZXN0cm95X3dvcmtxdWV1ZSh2ZG1hYnVm
LT53cSk7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmdmRtYWJ1Zi0+ZXZxLT5lX2xvY2ssIGlycWZs
YWdzKTsKKworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShlLCBldCwgJnZkbWFidWYtPmV2cS0+
ZV9saXN0LAorCQkJCSBsaW5rKSB7CisJCWxpc3RfZGVsKCZlLT5saW5rKTsKKwkJa3ZmcmVlKGUp
OworCQl2ZG1hYnVmLT5ldnEtPnBlbmRpbmctLTsKKwl9CisKKwlzcGluX3VubG9ja19pcnFyZXN0
b3JlKCZ2ZG1hYnVmLT5ldnEtPmVfbG9jaywgaXJxZmxhZ3MpOworCisJLyogZnJlZWluZyBhbGwg
ZXhwb3J0ZWQgYnVmZmVycyAqLworCXJlbW92ZV9hbGxfYnVmcyh2ZG1hYnVmKTsKKworCWt2ZnJl
ZSh2ZG1hYnVmLT5ldnEpOworCWt2ZnJlZSh2ZG1hYnVmKTsKKwlrdmZyZWUoZHJ2X2luZm8pOwor
fQorCittb2R1bGVfaW5pdCh2aXJ0aW9fdmRtYWJ1Zl9pbml0KTsKK21vZHVsZV9leGl0KHZpcnRp
b192ZG1hYnVmX2RlaW5pdCk7CisKK01PRFVMRV9ERVZJQ0VfVEFCTEUodmlydGlvLCB2aXJ0aW9f
dmRtYWJ1Zl9pZF90YWJsZSk7CitNT0RVTEVfREVTQ1JJUFRJT04oIlZpcnRpbyBWZG1hYnVmIGZy
b250ZW5kIGRyaXZlciIpOworTU9EVUxFX0xJQ0VOU0UoIkdQTCBhbmQgYWRkaXRpb25hbCByaWdo
dHMiKTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvdmlydGlvX3ZkbWFidWYuaCBiL2luY2x1
ZGUvbGludXgvdmlydGlvX3ZkbWFidWYuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAw
MDAwMDAwMDAuLjhiMGY4NTg1ZjQ4NAotLS0gL2Rldi9udWxsCisrKyBiL2luY2x1ZGUvbGludXgv
dmlydGlvX3ZkbWFidWYuaApAQCAtMCwwICsxLDI3MiBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IChNSVQgT1IgR1BMLTIuMCkgKi8KKworLyoKKyAqIENvcHlyaWdodCDCqSAyMDIxIElu
dGVsIENvcnBvcmF0aW9uCisgKgorICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJl
ZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKKyAqIGNvcHkgb2YgdGhpcyBz
b2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJl
IiksCisgKiB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNs
dWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uCisgKiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9k
aWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKKyAqIGFuZC9vciBz
ZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9t
IHRoZQorICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBm
b2xsb3dpbmcgY29uZGl0aW9uczoKKyAqCisgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBh
bmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSAoaW5jbHVkaW5nIHRoZSBuZXh0CisgKiBwYXJhZ3Jh
cGgpIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlv
bnMgb2YgdGhlCisgKiBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQg
IkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgorICogSU1Q
TElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJD
SEFOVEFCSUxJVFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9O
SU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwKKyAqIFRIRSBBVVRIT1JTIE9SIENPUFlS
SUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCisg
KiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9U
SEVSV0lTRSwgQVJJU0lORworICogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBU
SEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUworICogSU4gVEhFIFNPRlRX
QVJFLgorICoKKyAqLworCisjaWZuZGVmIF9MSU5VWF9WSVJUSU9fVkRNQUJVRl9IIAorI2RlZmlu
ZSBfTElOVVhfVklSVElPX1ZETUFCVUZfSCAKKworI2luY2x1ZGUgPHVhcGkvbGludXgvdmlydGlv
X3ZkbWFidWYuaD4KKyNpbmNsdWRlIDxsaW51eC9oYXNodGFibGUuaD4KKyNpbmNsdWRlIDxsaW51
eC9rdm1fdHlwZXMuaD4KKworc3RydWN0IHZpcnRpb192ZG1hYnVmX3NoYXJlZF9wYWdlcyB7CisJ
LyogY3Jvc3MtVk0gcmVmIGFkZHIgZm9yIHRoZSBidWZmZXIgKi8KKwlncGFfdCByZWY7CisKKwkv
KiBwYWdlIGFycmF5ICovCisJc3RydWN0IHBhZ2UgKipwYWdlczsKKwlncGFfdCAqKmwycmVmczsK
KwlncGFfdCAqbDNyZWZzOworCisJLyogZGF0YSBvZmZzZXQgaW4gdGhlIGZpcnN0IHBhZ2UKKwkg
KiBhbmQgZGF0YSBsZW5ndGggaW4gdGhlIGxhc3QgcGFnZQorCSAqLworCWludCBmaXJzdF9vZnN0
OworCWludCBsYXN0X2xlbjsKKworCS8qIG51bWJlciBvZiBzaGFyZWQgcGFnZXMgKi8KKwlpbnQg
bmVudHM7Cit9OworCitzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfYnVmIHsKKwl2aXJ0aW9fdmRtYWJ1
Zl9idWZfaWRfdCBidWZfaWQ7CisKKwlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2g7
CisJc3RydWN0IGRtYV9idWYgKmRtYV9idWY7CisJc3RydWN0IHNnX3RhYmxlICpzZ3Q7CisJc3Ry
dWN0IHZpcnRpb192ZG1hYnVmX3NoYXJlZF9wYWdlcyAqcGFnZXNfaW5mbzsKKwlpbnQgdm1pZDsK
KworCS8qIHZhbGlkaXR5IG9mIHRoZSBidWZmZXIgKi8KKwlib29sIHZhbGlkOworCisJLyogc2V0
IGlmIHRoZSBidWZmZXIgaXMgaW1wb3J0ZWQgdmlhIGltcG9ydF9pb2N0bCAqLworCWJvb2wgaW1w
b3J0ZWQ7CisKKwkvKiBzaXplIG9mIHByaXZhdGUgKi8KKwlzaXplX3Qgc3pfcHJpdjsKKwkvKiBw
cml2YXRlIGRhdGEgYXNzb2NpYXRlZCB3aXRoIHRoZSBleHBvcnRlZCBidWZmZXIgKi8KKwl2b2lk
ICpwcml2OworCisJc3RydWN0IGZpbGUgKmZpbHA7CisJc3RydWN0IGhsaXN0X25vZGUgbm9kZTsK
K307CisKK3N0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9ldmVudCB7CisJc3RydWN0IHZpcnRpb192ZG1h
YnVmX2VfZGF0YSBlX2RhdGE7CisJc3RydWN0IGxpc3RfaGVhZCBsaW5rOworfTsKKworc3RydWN0
IHZpcnRpb192ZG1hYnVmX2V2ZW50X3F1ZXVlIHsKKwl3YWl0X3F1ZXVlX2hlYWRfdCBlX3dhaXQ7
CisJc3RydWN0IGxpc3RfaGVhZCBlX2xpc3Q7CisKKwlzcGlubG9ja190IGVfbG9jazsKKwlzdHJ1
Y3QgbXV0ZXggZV9yZWFkbG9jazsKKworCS8qICMgb2YgcGVuZGluZyBldmVudHMgKi8KKwlpbnQg
cGVuZGluZzsKK307CisKKy8qIGRyaXZlciBpbmZvcm1hdGlvbiAqLworc3RydWN0IHZpcnRpb192
ZG1hYnVmX2luZm8geworCXN0cnVjdCBkZXZpY2UgKmRldjsKKworCXN0cnVjdCBsaXN0X2hlYWQg
aGVhZF92ZG1hYnVmX2xpc3Q7CisJc3RydWN0IGxpc3RfaGVhZCBrdm1faW5zdGFuY2VzOworCisJ
REVDTEFSRV9IQVNIVEFCTEUoYnVmX2xpc3QsIDcpOworCisJdm9pZCAqcHJpdjsKKwlzdHJ1Y3Qg
bXV0ZXggZ19tdXRleDsKKwlzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sga3ZtX25vdGlmaWVyOworfTsK
KworLyogSU9DVEwgZGVmaW5pdGlvbnMKKyAqLwordHlwZWRlZiBpbnQgKCp2aXJ0aW9fdmRtYWJ1
Zl9pb2N0bF90KShzdHJ1Y3QgZmlsZSAqZmlscCwgdm9pZCAqZGF0YSk7CisKK3N0cnVjdCB2aXJ0
aW9fdmRtYWJ1Zl9pb2N0bF9kZXNjIHsKKwl1bnNpZ25lZCBpbnQgY21kOworCWludCBmbGFnczsK
Kwl2aXJ0aW9fdmRtYWJ1Zl9pb2N0bF90IGZ1bmM7CisJY29uc3QgY2hhciAqbmFtZTsKK307CisK
KyNkZWZpbmUgVklSVElPX1ZETUFCVUZfSU9DVExfREVGKGlvY3RsLCBfZnVuYywgX2ZsYWdzKQlc
CisJW19JT0NfTlIoaW9jdGwpXSA9IHsJCQlcCisJCQkuY21kID0gaW9jdGwsCQlcCisJCQkuZnVu
YyA9IF9mdW5jLAkJXAorCQkJLmZsYWdzID0gX2ZsYWdzLAlcCisJCQkubmFtZSA9ICNpb2N0bAkJ
XAorfQorCisjZGVmaW5lIFZJUlRJT19WRE1BQlVGX1ZNSUQoYnVmX2lkKSAoKCgoYnVmX2lkKS5p
ZCkgPj4gMzIpICYgMHhGRkZGRkZGRikKKworLyogTWVzc2FnZXMgYmV0d2VlbiBIb3N0IGFuZCBH
dWVzdCAqLworCisvKiBMaXN0IG9mIGNvbW1hbmRzIGZyb20gR3Vlc3QgdG8gSG9zdDoKKyAqCisg
KiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KKyAqIEEuIE5FRURfVk1JRAorICoKKyAqICBndWVzdCBhc2tzIHRoZSBob3N0
IHRvIHByb3ZpZGUgaXRzIHZtaWQKKyAqCisgKiByZXE6CisgKgorICogY21kOiBWSVJUSU9fVkRN
QUJVRl9ORUVEX1ZNSUQKKyAqCisgKiBhY2s6CisgKgorICogY21kOiBzYW1lIGFzIHJlcQorICog
b3BbMF0gOiB2bWlkIG9mIGd1ZXN0CisgKgorICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisgKiBCLiBFWFBPUlQKKyAq
CisgKiAgZXhwb3J0IGRtYWJ1ZiB0byBob3N0CisgKgorICogcmVxOgorICoKKyAqIGNtZDogVklS
VElPX1ZETUFCVUZfQ01EX0VYUE9SVAorICogb3Awfm9wMyA6IEhETUFCVUYgSUQKKyAqIG9wNCA6
IG51bWJlciBvZiBwYWdlcyB0byBiZSBzaGFyZWQKKyAqIG9wNSA6IG9mZnNldCBvZiBkYXRhIGlu
IHRoZSBmaXJzdCBwYWdlCisgKiBvcDYgOiBsZW5ndGggb2YgZGF0YSBpbiB0aGUgbGFzdCBwYWdl
CisgKiBvcDcgOiB1cHBlciAzMiBiaXQgb2YgdG9wLWxldmVsIHJlZiBvZiBzaGFyZWQgYnVmCisg
KiBvcDggOiBsb3dlciAzMiBiaXQgb2YgdG9wLWxldmVsIHJlZiBvZiBzaGFyZWQgYnVmCisgKiBv
cDkgOiBzaXplIG9mIHByaXZhdGUgZGF0YQorICogb3AxMCB+IG9wNjQ6IFVzZXIgcHJpdmF0ZSBk
YXRlIGFzc29jaWF0ZWQgd2l0aCB0aGUgYnVmZmVyCisgKgkgICAgICAgIChlLmcuIGdyYXBoaWMg
YnVmZmVyJ3MgbWV0YSBpbmZvKQorICoKKyAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorICoKKyAqIExpc3Qgb2YgY29t
bWFuZHMgZnJvbSBIb3N0IHRvIEd1ZXN0CisgKgorICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisgKiBBLiBSRUxFQVNF
CisgKgorICogIG5vdGlmeWluZyBndWVzdCB0aGF0IHRoZSBzaGFyZWQgYnVmZmVyIGlzIHJlbGVh
c2VkIGJ5IGFuIGltcG9ydGVyCisgKgorICogcmVxOgorICoKKyAqIGNtZDogVklSVElPX1ZETUFC
VUZfQ01EX0RNQUJVRl9SRUwKKyAqIG9wMH5vcDMgOiBWRE1BQlVGIElECisgKgorICogLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tCisgKi8KKworLyogbXNnIHN0cnVjdHVyZXMgKi8KK3N0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9t
c2cgeworCXVuc2lnbmVkIGludCByZXFfaWQ7CisJdW5zaWduZWQgaW50IHN0YXQ7CisJdW5zaWdu
ZWQgaW50IGNtZDsKKwl1bnNpZ25lZCBpbnQgb3BbNjRdOworfTsKKworc3RydWN0IHZpcnRpb192
ZG1hYnVmX3R4bXNnIHsKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfbXNnIG1zZzsKKwl2b2lkIF9f
dXNlciAqbXNnX3B0cjsKKwlpbnQgaGVhZDsKK307CisKK2VudW0gdmlydGlvX3ZkbWFidWZfY21k
IHsKKwlWSVJUSU9fVkRNQUJVRl9DTURfTkVFRF9WTUlELAorCVZJUlRJT19WRE1BQlVGX0NNRF9F
WFBPUlQgPSAweDEwLAorCVZJUlRJT19WRE1BQlVGX0NNRF9ETUFCVUZfUkVMCit9OworCitlbnVt
IHZpcnRpb192ZG1hYnVmX29wcyB7CisJVklSVElPX1ZETUFCVUZfSERNQUJVRl9JRF9JRCA9IDAs
CisJVklSVElPX1ZETUFCVUZfSERNQUJVRl9JRF9STkdfS0VZMCwKKwlWSVJUSU9fVkRNQUJVRl9I
RE1BQlVGX0lEX1JOR19LRVkxLAorCVZJUlRJT19WRE1BQlVGX05VTV9QQUdFU19TSEFSRUQgPSA0
LAorCVZJUlRJT19WRE1BQlVGX0ZJUlNUX1BBR0VfREFUQV9PRkZTRVQsCisJVklSVElPX1ZETUFC
VUZfTEFTVF9QQUdFX0RBVEFfTEVOR1RILAorCVZJUlRJT19WRE1BQlVGX1JFRl9BRERSX1VQUEVS
XzMyQklULAorCVZJUlRJT19WRE1BQlVGX1JFRl9BRERSX0xPV0VSXzMyQklULAorCVZJUlRJT19W
RE1BQlVGX1BSSVZBVEVfREFUQV9TSVpFLAorCVZJUlRJT19WRE1BQlVGX1BSSVZBVEVfREFUQV9T
VEFSVAorfTsKKworLyogYWRkaW5nIGV4cG9ydGVkL2ltcG9ydGVkIHZkbWFidWYgaW5mbyB0byBo
YXNoICovCitzdGF0aWMgaW5saW5lIGludAordmlydGlvX3ZkbWFidWZfYWRkX2J1ZihzdHJ1Y3Qg
dmlydGlvX3ZkbWFidWZfaW5mbyAqaW5mbywKKyAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IHZpcnRpb192ZG1hYnVmX2J1ZiAqbmV3KQoreworCWhhc2hfYWRkKGluZm8tPmJ1Zl9saXN0LCAm
bmV3LT5ub2RlLCBuZXctPmJ1Zl9pZC5pZCk7CisJcmV0dXJuIDA7Cit9CisKKy8qIGNvbXBhcmlu
ZyB0d28gdmRtYWJ1ZiBJRHMgKi8KK3N0YXRpYyBpbmxpbmUgYm9vbAoraXNfc2FtZV9idWYodmly
dGlvX3ZkbWFidWZfYnVmX2lkX3QgYSwKKyAgICAgICAgICAgIHZpcnRpb192ZG1hYnVmX2J1Zl9p
ZF90IGIpCit7CisJaW50IGk7CisKKwlpZiAoYS5pZCAhPSBiLmlkKQorCQlyZXR1cm4gMTsKKwor
CS8qIGNvbXBhcmUga2V5cyAqLworCWZvciAoaSA9IDA7IGkgPCAyOyBpKyspIHsKKwkJaWYgKGEu
cm5nX2tleVtpXSAhPSBiLnJuZ19rZXlbaV0pCisJCQlyZXR1cm4gZmFsc2U7CisJfQorCisJcmV0
dXJuIHRydWU7Cit9CisKKy8qIGZpbmQgYnVmIGZvciBnaXZlbiB2ZG1hYnVmIElEICovCitzdGF0
aWMgaW5saW5lIHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYKKyp2aXJ0aW9fdmRtYWJ1Zl9maW5k
X2J1ZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfaW5mbyAqaW5mbywKKwkJCSB2aXJ0aW9fdmRtYWJ1
Zl9idWZfaWRfdCAqYnVmX2lkKQoreworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYgKmZvdW5k
OworCisJaGFzaF9mb3JfZWFjaF9wb3NzaWJsZShpbmZvLT5idWZfbGlzdCwgZm91bmQsIG5vZGUs
IGJ1Zl9pZC0+aWQpCisJCWlmIChpc19zYW1lX2J1Zihmb3VuZC0+YnVmX2lkLCAqYnVmX2lkKSkK
KwkJCXJldHVybiBmb3VuZDsKKworCXJldHVybiBOVUxMOworfQorCisvKiBkZWxldGUgYnVmIGZy
b20gaGFzaCAqLworc3RhdGljIGlubGluZSBpbnQKK3ZpcnRpb192ZG1hYnVmX2RlbF9idWYoc3Ry
dWN0IHZpcnRpb192ZG1hYnVmX2luZm8gKmluZm8sCisgICAgICAgICAgICAgICAgICAgICAgIHZp
cnRpb192ZG1hYnVmX2J1Zl9pZF90ICpidWZfaWQpCit7CisJc3RydWN0IHZpcnRpb192ZG1hYnVm
X2J1ZiAqZm91bmQ7CisKKwlmb3VuZCA9IHZpcnRpb192ZG1hYnVmX2ZpbmRfYnVmKGluZm8sIGJ1
Zl9pZCk7CisJaWYgKCFmb3VuZCkKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwloYXNoX2RlbCgmZm91
bmQtPm5vZGUpOworCisJcmV0dXJuIDA7Cit9CisKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvaW5jbHVk
ZS91YXBpL2xpbnV4L3ZpcnRpb19pZHMuaCBiL2luY2x1ZGUvdWFwaS9saW51eC92aXJ0aW9faWRz
LmgKaW5kZXggYmMxYzA2MjFmNWVkLi5mMWVhMWMyZjVjYmYgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUv
dWFwaS9saW51eC92aXJ0aW9faWRzLmgKKysrIGIvaW5jbHVkZS91YXBpL2xpbnV4L3ZpcnRpb19p
ZHMuaApAQCAtNTQsNSArNTQsNiBAQAogI2RlZmluZSBWSVJUSU9fSURfRlMJCQkyNiAvKiB2aXJ0
aW8gZmlsZXN5c3RlbSAqLwogI2RlZmluZSBWSVJUSU9fSURfUE1FTQkJCTI3IC8qIHZpcnRpbyBw
bWVtICovCiAjZGVmaW5lIFZJUlRJT19JRF9NQUM4MDIxMV9IV1NJTQkyOSAvKiB2aXJ0aW8gbWFj
ODAyMTEtaHdzaW0gKi8KKyNkZWZpbmUgVklSVElPX0lEX1ZETUFCVUYgICAgICAgICAgCTMwIC8q
IHZpcnRpbyB2ZG1hYnVmICovCiAKICNlbmRpZiAvKiBfTElOVVhfVklSVElPX0lEU19IICovCmRp
ZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgvdmlydGlvX3ZkbWFidWYuaCBiL2luY2x1ZGUv
dWFwaS9saW51eC92aXJ0aW9fdmRtYWJ1Zi5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAw
MDAwMDAwMDAwMC4uN2JkZGFhMDRkZGQ2Ci0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS91YXBp
L2xpbnV4L3ZpcnRpb192ZG1hYnVmLmgKQEAgLTAsMCArMSw5OSBAQAorLy8gU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IChNSVQgT1IgR1BMLTIuMCkKKworLyoKKyAqIENvcHlyaWdodCDCqSAyMDIx
IEludGVsIENvcnBvcmF0aW9uCisgKgorICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwg
ZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKKyAqIGNvcHkgb2YgdGhp
cyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3
YXJlIiksCisgKiB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBp
bmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uCisgKiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwg
bW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKKyAqIGFuZC9v
ciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3
aG9tIHRoZQorICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRo
ZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKyAqCisgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGlj
ZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSAoaW5jbHVkaW5nIHRoZSBuZXh0CisgKiBwYXJh
Z3JhcGgpIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9y
dGlvbnMgb2YgdGhlCisgKiBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklE
RUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgorICog
SU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBN
RVJDSEFOVEFCSUxJVFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQg
Tk9OSU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwKKyAqIFRIRSBBVVRIT1JTIE9SIENP
UFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVS
CisgKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9S
IE9USEVSV0lTRSwgQVJJU0lORworICogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lU
SCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUworICogSU4gVEhFIFNP
RlRXQVJFLgorICoKKyAqLworCisjaWZuZGVmIF9VQVBJX0xJTlVYX1ZJUlRJT19WRE1BQlVGX0gK
KyNkZWZpbmUgX1VBUElfTElOVVhfVklSVElPX1ZETUFCVUZfSAorCisjZGVmaW5lIE1BWF9TSVpF
X1BSSVZfREFUQSAxOTIKKwordHlwZWRlZiBzdHJ1Y3QgeworCV9fdTY0IGlkOworCS8qIDhCIGxv
bmcgUmFuZG9tIG51bWJlciAqLworCWludCBybmdfa2V5WzJdOworfSB2aXJ0aW9fdmRtYWJ1Zl9i
dWZfaWRfdDsKKworc3RydWN0IHZpcnRpb192ZG1hYnVmX2VfaGRyIHsKKwkvKiBidWZfaWQgb2Yg
bmV3IGJ1ZiAqLworCXZpcnRpb192ZG1hYnVmX2J1Zl9pZF90IGJ1Zl9pZDsKKwkvKiBzaXplIG9m
IHByaXZhdGUgZGF0YSAqLworCWludCBzaXplOworfTsKKworc3RydWN0IHZpcnRpb192ZG1hYnVm
X2VfZGF0YSB7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmX2VfaGRyIGhkcjsKKwkvKiBwdHIgdG8g
cHJpdmF0ZSBkYXRhICovCisJdm9pZCBfX3VzZXIgKmRhdGE7Cit9OworCisjZGVmaW5lIFZJUlRJ
T19WRE1BQlVGX0lPQ1RMX0lNUE9SVCBcCitfSU9DKF9JT0NfTk9ORSwgJ0cnLCAyLCBzaXplb2Yo
c3RydWN0IHZpcnRpb192ZG1hYnVmX2ltcG9ydCkpCisjZGVmaW5lIFZJUlRJT19WRE1BQlVGX0lP
Q1RMX1JFTEVBU0UgXAorX0lPQyhfSU9DX05PTkUsICdHJywgMywgc2l6ZW9mKHN0cnVjdCB2aXJ0
aW9fdmRtYWJ1Zl9pbXBvcnQpKQorc3RydWN0IHZpcnRpb192ZG1hYnVmX2ltcG9ydCB7CisJLyog
SU4gcGFyYW1ldGVycyAqLworCS8qIGFoZGIgYnVmIGlkIHRvIGJlIGltcG9ydGVkICovCisJdmly
dGlvX3ZkbWFidWZfYnVmX2lkX3QgYnVmX2lkOworCS8qIGZsYWdzICovCisJaW50IGZsYWdzOwor
CS8qIE9VVCBwYXJhbWV0ZXJzICovCisJLyogZXhwb3J0ZWQgZG1hIGJ1ZiBmZCAqLworCWludCBm
ZDsKK307CisKKyNkZWZpbmUgVklSVElPX1ZETUFCVUZfSU9DVExfRVhQT1JUIFwKK19JT0MoX0lP
Q19OT05FLCAnRycsIDQsIHNpemVvZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfZXhwb3J0KSkKK3N0
cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9leHBvcnQgeworCS8qIElOIHBhcmFtZXRlcnMgKi8KKwkvKiBE
TUEgYnVmIGZkIHRvIGJlIGV4cG9ydGVkICovCisJaW50IGZkOworCS8qIGV4cG9ydGVkIGRtYSBi
dWYgaWQgKi8KKwl2aXJ0aW9fdmRtYWJ1Zl9idWZfaWRfdCBidWZfaWQ7CisJaW50IHN6X3ByaXY7
CisJY2hhciAqcHJpdjsKK307CisKKyNkZWZpbmUgVklSVElPX1ZETUFCVUZfSU9DVExfUVVFUlkg
XAorX0lPQyhfSU9DX05PTkUsICdHJywgNSwgc2l6ZW9mKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9x
dWVyeSkpCitzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfcXVlcnkgeworCS8qIGluIHBhcmFtZXRlcnMg
Ki8KKwkvKiBpZCBvZiBidWYgdG8gYmUgcXVlcmllZCAqLworCXZpcnRpb192ZG1hYnVmX2J1Zl9p
ZF90IGJ1Zl9pZDsKKwkvKiBpdGVtIHRvIGJlIHF1ZXJpZWQgKi8KKwlpbnQgaXRlbTsKKwkvKiBP
VVQgcGFyYW1ldGVycyAqLworCS8qIFZhbHVlIG9mIHF1ZXJpZWQgaXRlbSAqLworCXVuc2lnbmVk
IGxvbmcgaW5mbzsKK307CisKKy8qIERNQUJVRiBxdWVyeSAqLworZW51bSB2aXJ0aW9fdmRtYWJ1
Zl9xdWVyeV9jbWQgeworCVZJUlRJT19WRE1BQlVGX1FVRVJZX1NJWkUgPSAweDEwLAorCVZJUlRJ
T19WRE1BQlVGX1FVRVJZX0JVU1ksCisJVklSVElPX1ZETUFCVUZfUVVFUllfUFJJVl9JTkZPX1NJ
WkUsCisJVklSVElPX1ZETUFCVUZfUVVFUllfUFJJVl9JTkZPLAorfTsKKworI2VuZGlmCi0tIAoy
LjI2LjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZp
cnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3Vu
ZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0
aW5mby92aXJ0dWFsaXphdGlvbg==

