Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [IPv6:2605:bc80:3010::136])
	by mail.lfdr.de (Postfix) with ESMTPS id 1DE2233FDA0
	for <lists.virtualization@lfdr.de>; Thu, 18 Mar 2021 04:14:46 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id 5BCEE606BF;
	Thu, 18 Mar 2021 03:14:44 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id vKB6AX6r4tE9; Thu, 18 Mar 2021 03:14:42 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp3.osuosl.org (Postfix) with ESMTP id 5BEF86F65A;
	Thu, 18 Mar 2021 03:14:42 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id ED742C0001;
	Thu, 18 Mar 2021 03:14:41 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 78B15C0001
 for <virtualization@lists.linux-foundation.org>;
 Thu, 18 Mar 2021 03:14:40 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id 669A28408F
 for <virtualization@lists.linux-foundation.org>;
 Thu, 18 Mar 2021 03:14:40 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Authentication-Results: smtp1.osuosl.org (amavisd-new);
 dkim=pass (1024-bit key) header.d=redhat.com
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id WbYS5o3LneZo
 for <virtualization@lists.linux-foundation.org>;
 Thu, 18 Mar 2021 03:14:38 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [63.128.21.124])
 by smtp1.osuosl.org (Postfix) with ESMTPS id B00AF8405E
 for <virtualization@lists.linux-foundation.org>;
 Thu, 18 Mar 2021 03:14:38 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1616037277;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=sx0zH+SIbXssbItc4vN0KbY0ePIHDD/w3aBy2U8ZTX4=;
 b=Z3+vk97q6GnZ0sHCgeiC8K+4hZJXI343+JaxYdwLrZdnBZPCITI+PGTLJhIw0f4vC/G2Uz
 +Qu5uxWAViNH4qk3/FxL/dVA/FAderfsph439KD74jeuoV49i2NcBOPdllKwcI7rAeGWwQ
 amXbwppbBL0RU/CBxG/MLzE1lL5WxQg=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-362-DpmgXdGXPLag2Qj83nRAKQ-1; Wed, 17 Mar 2021 23:14:33 -0400
X-MC-Unique: DpmgXdGXPLag2Qj83nRAKQ-1
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 3D8DE5B362;
 Thu, 18 Mar 2021 03:14:32 +0000 (UTC)
Received: from wangxiaodeMacBook-Air.local (ovpn-13-131.pek2.redhat.com
 [10.72.13.131])
 by smtp.corp.redhat.com (Postfix) with ESMTP id D71AB5C5E0;
 Thu, 18 Mar 2021 03:14:23 +0000 (UTC)
Subject: Re: [RFC v2 11/13] vhost: Shadow virtqueue buffers forwarding
To: Eugenio Perez Martin <eperezma@redhat.com>
References: <20210315194842.277740-1-eperezma@redhat.com>
 <20210315194842.277740-12-eperezma@redhat.com>
 <5fcc5f81-88f7-1c00-c4a6-6ba5ad21ac8b@redhat.com>
 <CAJaqyWftTU3R7mpZVU8PPmTYEg8aYki4AgMafFB6vkOJAv5NFw@mail.gmail.com>
 <38fb8605-e7dc-de4d-dd0f-defc922a453e@redhat.com>
 <CAJaqyWfz9NbTBNXgpq_KreY66KzciiuxmQJshURkKB5AJd-ohg@mail.gmail.com>
From: Jason Wang <jasowang@redhat.com>
Message-ID: <4c76fc1c-08e3-9706-6439-4b93cbadbf0f@redhat.com>
Date: Thu, 18 Mar 2021 11:14:22 +0800
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:78.0)
 Gecko/20100101 Thunderbird/78.8.1
MIME-Version: 1.0
In-Reply-To: <CAJaqyWfz9NbTBNXgpq_KreY66KzciiuxmQJshURkKB5AJd-ohg@mail.gmail.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=jasowang@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: Rob Miller <rob.miller@broadcom.com>, Parav Pandit <parav@mellanox.com>,
 Guru Prasad <guru.prasad@broadcom.com>, "Michael S. Tsirkin" <mst@redhat.com>,
 qemu-level <qemu-devel@nongnu.org>, Harpreet Singh Anand <hanand@xilinx.com>,
 Xiao W Wang <xiao.w.wang@intel.com>, Eli Cohen <eli@mellanox.com>,
 virtualization@lists.linux-foundation.org, Michael Lilja <ml@napatech.com>,
 Jim Harford <jim.harford@broadcom.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

CuWcqCAyMDIxLzMvMTcg5LiL5Y2IMTA6MzgsIEV1Z2VuaW8gUGVyZXogTWFydGluIOWGmemBkzoK
PiBPbiBXZWQsIE1hciAxNywgMjAyMSBhdCAzOjUxIEFNIEphc29uIFdhbmcgPGphc293YW5nQHJl
ZGhhdC5jb20+IHdyb3RlOgo+Pgo+PiDlnKggMjAyMS8zLzE3IOS4iuWNiDEyOjA1LCBFdWdlbmlv
IFBlcmV6IE1hcnRpbiDlhpnpgZM6Cj4+PiBPbiBUdWUsIE1hciAxNiwgMjAyMSBhdCA5OjE1IEFN
IEphc29uIFdhbmcgPGphc293YW5nQHJlZGhhdC5jb20+IHdyb3RlOgo+Pj4+IOWcqCAyMDIxLzMv
MTYg5LiK5Y2IMzo0OCwgRXVnZW5pbyBQw6lyZXog5YaZ6YGTOgo+Pj4+PiBJbml0aWFsIHZlcnNp
b24gb2Ygc2hhZG93IHZpcnRxdWV1ZSB0aGF0IGFjdHVhbGx5IGZvcndhcmQgYnVmZmVycy4KPj4+
Pj4KPj4+Pj4gSXQgcmV1c2VzIHRoZSBWaXJ0UXVldWUgY29kZSBmb3IgdGhlIGRldmljZSBwYXJ0
LiBUaGUgZHJpdmVyIHBhcnQgaXMKPj4+Pj4gYmFzZWQgb24gTGludXgncyB2aXJ0aW9fcmluZyBk
cml2ZXIsIGJ1dCB3aXRoIHN0cmlwcGVkIGZ1bmN0aW9uYWxpdHkKPj4+Pj4gYW5kIG9wdGltaXph
dGlvbnMgc28gaXQncyBlYXNpZXIgdG8gcmV2aWV3Lgo+Pj4+Pgo+Pj4+PiBUaGVzZSB3aWxsIGJl
IGFkZGVkIGluIGxhdGVyIGNvbW1pdHMuCj4+Pj4+Cj4+Pj4+IFNpZ25lZC1vZmYtYnk6IEV1Z2Vu
aW8gUMOpcmV6IDxlcGVyZXptYUByZWRoYXQuY29tPgo+Pj4+PiAtLS0KPj4+Pj4gICAgIGh3L3Zp
cnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmMgfCAyMTIgKysrKysrKysrKysrKysrKysrKysr
KysrKysrLS0KPj4+Pj4gICAgIGh3L3ZpcnRpby92aG9zdC5jICAgICAgICAgICAgICAgICAgfCAx
MTMgKysrKysrKysrKysrKystCj4+Pj4+ICAgICAyIGZpbGVzIGNoYW5nZWQsIDMxMiBpbnNlcnRp
b25zKCspLCAxMyBkZWxldGlvbnMoLSkKPj4+Pj4KPj4+Pj4gZGlmZiAtLWdpdCBhL2h3L3ZpcnRp
by92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmMgYi9ody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRx
dWV1ZS5jCj4+Pj4+IGluZGV4IDE0NjBkMWQ1ZDEuLjY4ZWQwZjI3NDAgMTAwNjQ0Cj4+Pj4+IC0t
LSBhL2h3L3ZpcnRpby92aG9zdC1zaGFkb3ctdmlydHF1ZXVlLmMKPj4+Pj4gKysrIGIvaHcvdmly
dGlvL3Zob3N0LXNoYWRvdy12aXJ0cXVldWUuYwo+Pj4+PiBAQCAtOSw2ICs5LDcgQEAKPj4+Pj4K
Pj4+Pj4gICAgICNpbmNsdWRlICJody92aXJ0aW8vdmhvc3Qtc2hhZG93LXZpcnRxdWV1ZS5oIgo+
Pj4+PiAgICAgI2luY2x1ZGUgImh3L3ZpcnRpby92aG9zdC5oIgo+Pj4+PiArI2luY2x1ZGUgImh3
L3ZpcnRpby92aXJ0aW8tYWNjZXNzLmgiCj4+Pj4+Cj4+Pj4+ICAgICAjaW5jbHVkZSAic3RhbmRh
cmQtaGVhZGVycy9saW51eC92aG9zdF90eXBlcy5oIgo+Pj4+Pgo+Pj4+PiBAQCAtNTUsMTEgKzU2
LDk2IEBAIHR5cGVkZWYgc3RydWN0IFZob3N0U2hhZG93VmlydHF1ZXVlIHsKPj4+Pj4gICAgICAg
ICAvKiBWaXJ0aW8gZGV2aWNlICovCj4+Pj4+ICAgICAgICAgVmlydElPRGV2aWNlICp2ZGV2Owo+
Pj4+Pgo+Pj4+PiArICAgIC8qIE1hcCBmb3IgcmV0dXJuaW5nIGd1ZXN0J3MgZGVzY3JpcHRvcnMg
Ki8KPj4+Pj4gKyAgICBWaXJ0UXVldWVFbGVtZW50ICoqcmluZ19pZF9tYXBzOwo+Pj4+PiArCj4+
Pj4+ICsgICAgLyogTmV4dCBoZWFkIHRvIGV4cG9zZSB0byBkZXZpY2UgKi8KPj4+Pj4gKyAgICB1
aW50MTZfdCBhdmFpbF9pZHhfc2hhZG93Owo+Pj4+PiArCj4+Pj4+ICsgICAgLyogTmV4dCBmcmVl
IGRlc2NyaXB0b3IgKi8KPj4+Pj4gKyAgICB1aW50MTZfdCBmcmVlX2hlYWQ7Cj4+Pj4+ICsKPj4+
Pj4gKyAgICAvKiBMYXN0IHNlZW4gdXNlZCBpZHggKi8KPj4+Pj4gKyAgICB1aW50MTZfdCBzaGFk
b3dfdXNlZF9pZHg7Cj4+Pj4+ICsKPj4+Pj4gKyAgICAvKiBOZXh0IGhlYWQgdG8gY29uc3VtZSBm
cm9tIGRldmljZSAqLwo+Pj4+PiArICAgIHVpbnQxNl90IHVzZWRfaWR4Owo+Pj4+PiArCj4+Pj4+
ICAgICAgICAgLyogRGVzY3JpcHRvcnMgY29waWVkIGZyb20gZ3Vlc3QgKi8KPj4+Pj4gICAgICAg
ICB2cmluZ19kZXNjX3QgZGVzY3NbXTsKPj4+Pj4gICAgIH0gVmhvc3RTaGFkb3dWaXJ0cXVldWU7
Cj4+Pj4+Cj4+Pj4+IC0vKiBGb3J3YXJkIGd1ZXN0IG5vdGlmaWNhdGlvbnMgKi8KPj4+Pj4gK3N0
YXRpYyB2b2lkIHZob3N0X3ZyaW5nX3dyaXRlX2Rlc2NzKFZob3N0U2hhZG93VmlydHF1ZXVlICpz
dnEsCj4+Pj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJ1
Y3QgaW92ZWMgKmlvdmVjLAo+Pj4+PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc2l6ZV90IG51bSwgYm9vbCBtb3JlX2Rlc2NzLCBib29sIHdyaXRlKQo+Pj4+PiArewo+Pj4+
PiArICAgIHVpbnQxNl90IGkgPSBzdnEtPmZyZWVfaGVhZCwgbGFzdCA9IHN2cS0+ZnJlZV9oZWFk
Owo+Pj4+PiArICAgIHVuc2lnbmVkIG47Cj4+Pj4+ICsgICAgdWludDE2X3QgZmxhZ3MgPSB3cml0
ZSA/IHZpcnRpb190c3dhcDE2KHN2cS0+dmRldiwgVlJJTkdfREVTQ19GX1dSSVRFKSA6IDA7Cj4+
Pj4+ICsgICAgdnJpbmdfZGVzY190ICpkZXNjcyA9IHN2cS0+dnJpbmcuZGVzYzsKPj4+Pj4gKwo+
Pj4+PiArICAgIGlmIChudW0gPT0gMCkgewo+Pj4+PiArICAgICAgICByZXR1cm47Cj4+Pj4+ICsg
ICAgfQo+Pj4+PiArCj4+Pj4+ICsgICAgZm9yIChuID0gMDsgbiA8IG51bTsgbisrKSB7Cj4+Pj4+
ICsgICAgICAgIGlmIChtb3JlX2Rlc2NzIHx8IChuICsgMSA8IG51bSkpIHsKPj4+Pj4gKyAgICAg
ICAgICAgIGRlc2NzW2ldLmZsYWdzID0gZmxhZ3MgfCB2aXJ0aW9fdHN3YXAxNihzdnEtPnZkZXYs
Cj4+Pj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgVlJJTkdfREVTQ19GX05FWFQpOwo+Pj4+PiArICAgICAgICB9IGVsc2Ugewo+Pj4+PiArICAg
ICAgICAgICAgZGVzY3NbaV0uZmxhZ3MgPSBmbGFnczsKPj4+Pj4gKyAgICAgICAgfQo+Pj4+PiAr
ICAgICAgICBkZXNjc1tpXS5hZGRyID0gdmlydGlvX3Rzd2FwNjQoc3ZxLT52ZGV2LCAoaHdhZGRy
KWlvdmVjW25dLmlvdl9iYXNlKTsKPj4+PiBTbyB1bnNpbmcgdmlydGlvX3Rzd2FwKCkgaXMgcHJv
YmFibHkgbm90IGNvcnJlY3Qgc2luY2Ugd2UncmUgdGFsa2luZwo+Pj4+IHdpdGggdmhvc3QgYmFj
a2VuZHMgd2hpY2ggaGFzIGl0cyBvd24gZW5kaW5lc3MuCj4+Pj4KPj4+IEkgd2FzIHRyeWluZyB0
byBleHBvc2UgdGhlIGJ1ZmZlciB3aXRoIHRoZSBzYW1lIGVuZGlhbm5lc3MgYXMgdGhlCj4+PiBk
cml2ZXIgb3JpZ2luYWxseSBvZmZlcmVkLCBzbyBpZiBndWVzdC0+cWVtdSByZXF1aXJlcyBhIGJz
d2FwLCBJIHRoaW5rCj4+PiBpdCB3aWxsIGFsd2F5cyByZXF1aXJlIGEgYnN3YXAgYWdhaW4gdG8g
ZXhwb3NlIHRvIHRoZSBkZXZpY2UgYWdhaW4uCj4+Cj4+IFNvIGFzc3VtZXMgdmhvc3QtdkRQQSBh
bHdheXMgcHJvdmlkZSBhIG5vbi10cmFuc2l0aW9uYWwgZGV2aWNlWzFdLgo+Pgo+PiBUaGVuIGlm
IFFlbXUgcHJlc2VudCBhIHRyYW5zaXRpb25hbCBkZXZpY2UsIHdlIG5lZWQgdG8gZG8gdGhlIGVu
ZGlhbgo+PiBjb252ZXJzaW9uIHdoZW4gbmVjZXNzYXJ5LCBpZiBRZW11IHByZXNlbnQgYSBub24t
dHJhbnNpdGlvbmFsIGRldmljZSwgd2UKPj4gZG9uJ3QgbmVlZCB0byBkbyB0aGF0LCBndWVzdCBk
cml2ZXIgd2lsbCBkbyB0aGF0IGZvciB1cy4KPj4KPj4gQnV0IGl0IGxvb2tzIHRvIG1lIHRoZSB2
aXJ0aW9fdHN3YXAoKSBjYW4ndCBiZSB1c2VkIGZvciB0aGlzIHNpbmNlIGl0Ogo+Pgo+PiBzdGF0
aWMgaW5saW5lIGJvb2wgdmlydGlvX2FjY2Vzc19pc19iaWdfZW5kaWFuKFZpcnRJT0RldmljZSAq
dmRldikKPj4gewo+PiAjaWYgZGVmaW5lZChMRUdBQ1lfVklSVElPX0lTX0JJRU5ESUFOKQo+PiAg
ICAgICByZXR1cm4gdmlydGlvX2lzX2JpZ19lbmRpYW4odmRldik7Cj4+ICNlbGlmIGRlZmluZWQo
VEFSR0VUX1dPUkRTX0JJR0VORElBTikKPj4gICAgICAgaWYgKHZpcnRpb192ZGV2X2hhc19mZWF0
dXJlKHZkZXYsIFZJUlRJT19GX1ZFUlNJT05fMSkpIHsKPj4gICAgICAgICAgIC8qIERldmljZXMg
Y29uZm9ybWluZyB0byBWSVJUSU8gMS4wIG9yIGxhdGVyIGFyZSBhbHdheXMgTEUuICovCj4+ICAg
ICAgICAgICByZXR1cm4gZmFsc2U7Cj4+ICAgICAgIH0KPj4gICAgICAgcmV0dXJuIHRydWU7Cj4+
ICNlbHNlCj4+ICAgICAgIHJldHVybiBmYWxzZTsKPj4gI2VuZGlmCj4+IH0KPj4KPj4gU28gaWYg
d2UgcHJlc2VudCBhIGxlZ2FjeSBkZXZpY2Ugb24gdG9wIG9mIGEgbm9uLXRyYW5zaXRpYW9ubCB2
RFBBCj4+IGRldmljZS4gVGhlIFZJUklUSU9fRl9WRVJTSU9OXzEgY2hlY2sgaXMgd3JvbmcuCj4+
Cj4+Cj4+Pj4gRm9yIHZob3N0LXZEUEEsIHdlIGNhbiBhc3N1bWUgdGhhdCBpdCdzIGEgMS4wIGRl
dmljZS4KPj4+IElzbid0IGl0IG5lZWRlZCBpZiB0aGUgaG9zdCBpcyBiaWcgZW5kaWFuPwo+Pgo+
PiBbMV0KPj4KPj4gU28gbm9uLXRyYW5zaXRpb25hbCBkZXZpY2UgYWx3YXlzIGFzc3VtZSBsaXR0
bGUgZW5kaWFuLgo+Pgo+PiBGb3Igdmhvc3QtdkRQQSwgd2UgZG9uJ3Qgd2FudCB0byBwcmVzZW50
IHRyYW5zaXRpb25hbCBkZXZpY2Ugd2hpY2ggbWF5Cj4+IGVuZCB1cCB3aXRoIGEgbG90IG9mIGJ1
cmRlbnMuCj4+Cj4+IEkgc3VzcGVjdCB0aGUgbGVnYWN5IGRyaXZlciBwbHVzdCB2aG9zdCB2RFBB
IGFscmVhZHkgYnJlYWssIHNvIEkgcGxhbiB0bwo+PiBtYW5kYXRlIFZFUlNJT05fMSBmb3IgYWxs
IHZEUEEgZGV2aWNlcy4KPj4KPiBSaWdodC4gSSB0aGluayBpdCdzIHRoZSBiZXN0IHRoZW4uCj4K
PiBIb3dldmVyLCB0aGVuIHdlIHdpbGwgbmVlZCBhIHNpbWlsYXIgbWV0aG9kIHRvIGFsd2F5cyBl
eHBvc2UKPiBhZGRyZXNzL2xlbmd0aCBhcyBsaXR0bGUgZW5kaWFuLCBpc24ndCBpdD8KCgpZZXMu
CgoKPgo+Pj4+PiArICAgICAgICBkZXNjc1tpXS5sZW4gPSB2aXJ0aW9fdHN3YXAzMihzdnEtPnZk
ZXYsIGlvdmVjW25dLmlvdl9sZW4pOwo+Pj4+PiArCj4+Pj4+ICsgICAgICAgIGxhc3QgPSBpOwo+
Pj4+PiArICAgICAgICBpID0gdmlydGlvX3Rzd2FwMTYoc3ZxLT52ZGV2LCBkZXNjc1tpXS5uZXh0
KTsKPj4+Pj4gKyAgICB9Cj4+Pj4+ICsKPj4+Pj4gKyAgICBzdnEtPmZyZWVfaGVhZCA9IHZpcnRp
b190c3dhcDE2KHN2cS0+dmRldiwgZGVzY3NbbGFzdF0ubmV4dCk7Cj4+Pj4+ICt9Cj4+Pj4+ICsK
Pj4+Pj4gK3N0YXRpYyB1bnNpZ25lZCB2aG9zdF9zaGFkb3dfdnFfYWRkX3NwbGl0KFZob3N0U2hh
ZG93VmlydHF1ZXVlICpzdnEsCj4+Pj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBWaXJ0UXVldWVFbGVtZW50ICplbGVtKQo+Pj4+PiArewo+Pj4+PiArICAgIGlu
dCBoZWFkOwo+Pj4+PiArICAgIHVuc2lnbmVkIGF2YWlsX2lkeDsKPj4+Pj4gKyAgICB2cmluZ19h
dmFpbF90ICphdmFpbCA9IHN2cS0+dnJpbmcuYXZhaWw7Cj4+Pj4+ICsKPj4+Pj4gKyAgICBoZWFk
ID0gc3ZxLT5mcmVlX2hlYWQ7Cj4+Pj4+ICsKPj4+Pj4gKyAgICAvKiBXZSBuZWVkIHNvbWUgZGVz
Y3JpcHRvcnMgaGVyZSAqLwo+Pj4+PiArICAgIGFzc2VydChlbGVtLT5vdXRfbnVtIHx8IGVsZW0t
PmluX251bSk7Cj4+Pj4+ICsKPj4+Pj4gKyAgICB2aG9zdF92cmluZ193cml0ZV9kZXNjcyhzdnEs
IGVsZW0tPm91dF9zZywgZWxlbS0+b3V0X251bSwKPj4+Pj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBlbGVtLT5pbl9udW0gPiAwLCBmYWxzZSk7Cj4+Pj4+ICsgICAgdmhvc3RfdnJpbmdf
d3JpdGVfZGVzY3Moc3ZxLCBlbGVtLT5pbl9zZywgZWxlbS0+aW5fbnVtLCBmYWxzZSwgdHJ1ZSk7
Cj4+Pj4+ICsKPj4+Pj4gKyAgICAvKgo+Pj4+PiArICAgICAqIFB1dCBlbnRyeSBpbiBhdmFpbGFi
bGUgYXJyYXkgKGJ1dCBkb24ndCB1cGRhdGUgYXZhaWwtPmlkeCB1bnRpbCB0aGV5Cj4+Pj4+ICsg
ICAgICogZG8gc3luYykuCj4+Pj4+ICsgICAgICovCj4+Pj4+ICsgICAgYXZhaWxfaWR4ID0gc3Zx
LT5hdmFpbF9pZHhfc2hhZG93ICYgKHN2cS0+dnJpbmcubnVtIC0gMSk7Cj4+Pj4+ICsgICAgYXZh
aWwtPnJpbmdbYXZhaWxfaWR4XSA9IHZpcnRpb190c3dhcDE2KHN2cS0+dmRldiwgaGVhZCk7Cj4+
Pj4+ICsgICAgc3ZxLT5hdmFpbF9pZHhfc2hhZG93Kys7Cj4+Pj4+ICsKPj4+Pj4gKyAgICAvKiBF
eHBvc2UgZGVzY3JpcHRvcnMgdG8gZGV2aWNlICovCj4+Pj4+ICsgICAgc21wX3dtYigpOwo+Pj4+
PiArICAgIGF2YWlsLT5pZHggPSB2aXJ0aW9fdHN3YXAxNihzdnEtPnZkZXYsIHN2cS0+YXZhaWxf
aWR4X3NoYWRvdyk7Cj4+Pj4+ICsKPj4+Pj4gKyAgICByZXR1cm4gaGVhZDsKPj4+Pj4gKwo+Pj4+
PiArfQo+Pj4+PiArCj4+Pj4+ICtzdGF0aWMgdm9pZCB2aG9zdF9zaGFkb3dfdnFfYWRkKFZob3N0
U2hhZG93VmlydHF1ZXVlICpzdnEsCj4+Pj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFZpcnRRdWV1ZUVsZW1lbnQgKmVsZW0pCj4+Pj4+ICt7Cj4+Pj4+ICsgICAgdW5zaWduZWQg
cWVtdV9oZWFkID0gdmhvc3Rfc2hhZG93X3ZxX2FkZF9zcGxpdChzdnEsIGVsZW0pOwo+Pj4+PiAr
Cj4+Pj4+ICsgICAgc3ZxLT5yaW5nX2lkX21hcHNbcWVtdV9oZWFkXSA9IGVsZW07Cj4+Pj4+ICt9
Cj4+Pj4+ICsKPj4+Pj4gKy8qIEhhbmRsZSBndWVzdC0+ZGV2aWNlIG5vdGlmaWNhdGlvbnMgKi8K
Pj4+Pj4gICAgIHN0YXRpYyB2b2lkIHZob3N0X2hhbmRsZV9ndWVzdF9raWNrKEV2ZW50Tm90aWZp
ZXIgKm4pCj4+Pj4+ICAgICB7Cj4+Pj4+ICAgICAgICAgVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2
cSA9IGNvbnRhaW5lcl9vZihuLCBWaG9zdFNoYWRvd1ZpcnRxdWV1ZSwKPj4+Pj4gQEAgLTY5LDcg
KzE1NSw3MiBAQCBzdGF0aWMgdm9pZCB2aG9zdF9oYW5kbGVfZ3Vlc3Rfa2ljayhFdmVudE5vdGlm
aWVyICpuKQo+Pj4+PiAgICAgICAgICAgICByZXR1cm47Cj4+Pj4+ICAgICAgICAgfQo+Pj4+Pgo+
Pj4+PiAtICAgIGV2ZW50X25vdGlmaWVyX3NldCgmc3ZxLT5raWNrX25vdGlmaWVyKTsKPj4+Pj4g
KyAgICAvKiBNYWtlIGF2YWlsYWJsZSBhcyBtYW55IGJ1ZmZlcnMgYXMgcG9zc2libGUgKi8KPj4+
Pj4gKyAgICBkbyB7Cj4+Pj4+ICsgICAgICAgIGlmICh2aXJ0aW9fcXVldWVfZ2V0X25vdGlmaWNh
dGlvbihzdnEtPnZxKSkgewo+Pj4+PiArICAgICAgICAgICAgLyogTm8gbW9yZSBub3RpZmljYXRp
b25zIHVudGlsIHByb2Nlc3MgYWxsIGF2YWlsYWJsZSAqLwo+Pj4+PiArICAgICAgICAgICAgdmly
dGlvX3F1ZXVlX3NldF9ub3RpZmljYXRpb24oc3ZxLT52cSwgZmFsc2UpOwo+Pj4+PiArICAgICAg
ICB9Cj4+Pj4+ICsKPj4+Pj4gKyAgICAgICAgd2hpbGUgKHRydWUpIHsKPj4+Pj4gKyAgICAgICAg
ICAgIFZpcnRRdWV1ZUVsZW1lbnQgKmVsZW07Cj4+Pj4+ICsgICAgICAgICAgICBpZiAodmlydGlv
X3F1ZXVlX2Z1bGwoc3ZxLT52cSkpIHsKPj4+Pj4gKyAgICAgICAgICAgICAgICBicmVhazsKPj4+
PiBTbyB3ZSd2ZSBkaXNhYmxlZCBndWVzdCBub3RpZmljYXRpb24uIElmIGJ1ZmZlciBoYXMgYmVl
biBjb25zdW1lZCwgd2UKPj4+PiBuZWVkIHRvIHJldHJ5IHRoZSBoYW5kbGVfZ3Vlc3Rfa2ljayBo
ZXJlLiBCdXQgSSBkaWRuJ3QgZmluZCB0aGUgY29kZT8KPj4+Pgo+Pj4gVGhpcyBjb2RlIGZvbGxv
d3MgdGhlIHBhdHRlcm4gb2YgdmlydGlvX2Jsa19oYW5kbGVfdnE6IHdlIGp1bXAgb3V0IG9mCj4+
PiB0aGUgaW5uZXIgd2hpbGUsIGFuZCB3ZSByZS1lbmFibGUgdGhlIG5vdGlmaWNhdGlvbnMuIEFm
dGVyIHRoYXQsIHdlCj4+PiBjaGVjayBmb3IgdXBkYXRlcyBvbiBndWVzdCBhdmFpbF9pZHguCj4+
Cj4+IE9rLCBidXQgdGhpcyB3aWxsIGVuZCB1cCB3aXRoIGEgbG90IG9mIHVubmVjZXNzYXJ5IGtp
Y2tzIHdpdGhvdXQgZXZlbnQKPj4gaW5kZXguCj4+Cj4gSSBjYW4gbW92ZSB0aGUga2ljayBvdXQg
b2YgdGhlIGlubmVyIGxvb3AsIGJ1dCB0aGF0IGNvdWxkIGFkZCBsYXRlbmN5LgoKClNvIEkgdGhp
bmsgdGhlIHJpZ2h0IHdheSBpcyB0byBkaXNhYmxlIHRoZSBub3RpZmljYXRpb24gdW50aWwgc29t
ZSAKYnVmZmVycyBhcmUgY29uc3VtZWQgYnkgdXNlZCByaW5nLgoKCj4KPj4+Pj4gKyAgICAgICAg
ICAgIH0KPj4+Pj4gKwo+Pj4+PiArICAgICAgICAgICAgZWxlbSA9IHZpcnRxdWV1ZV9wb3Aoc3Zx
LT52cSwgc2l6ZW9mKCplbGVtKSk7Cj4+Pj4+ICsgICAgICAgICAgICBpZiAoIWVsZW0pIHsKPj4+
Pj4gKyAgICAgICAgICAgICAgICBicmVhazsKPj4+Pj4gKyAgICAgICAgICAgIH0KPj4+Pj4gKwo+
Pj4+PiArICAgICAgICAgICAgdmhvc3Rfc2hhZG93X3ZxX2FkZChzdnEsIGVsZW0pOwo+Pj4+PiAr
ICAgICAgICAgICAgZXZlbnRfbm90aWZpZXJfc2V0KCZzdnEtPmtpY2tfbm90aWZpZXIpOwo+Pj4+
PiArICAgICAgICB9Cj4+Pj4+ICsKPj4+Pj4gKyAgICAgICAgdmlydGlvX3F1ZXVlX3NldF9ub3Rp
ZmljYXRpb24oc3ZxLT52cSwgdHJ1ZSk7Cj4+Pj4+ICsgICAgfSB3aGlsZSAoIXZpcnRpb19xdWV1
ZV9lbXB0eShzdnEtPnZxKSk7Cj4+Pj4+ICt9Cj4+Pj4+ICsKPj4+Pj4gK3N0YXRpYyBib29sIHZo
b3N0X3NoYWRvd192cV9tb3JlX3VzZWQoVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSkKPj4+Pj4g
K3sKPj4+Pj4gKyAgICBpZiAoc3ZxLT51c2VkX2lkeCAhPSBzdnEtPnNoYWRvd191c2VkX2lkeCkg
ewo+Pj4+PiArICAgICAgICByZXR1cm4gdHJ1ZTsKPj4+Pj4gKyAgICB9Cj4+Pj4+ICsKPj4+Pj4g
KyAgICAvKiBHZXQgdXNlZCBpZHggbXVzdCBub3QgYmUgcmVvcmRlcmVkICovCj4+Pj4+ICsgICAg
c21wX3JtYigpOwo+Pj4+PiArICAgIHN2cS0+c2hhZG93X3VzZWRfaWR4ID0gdmlydGlvX3Rzd2Fw
MTYoc3ZxLT52ZGV2LCBzdnEtPnZyaW5nLnVzZWQtPmlkeCk7Cj4+Pj4+ICsKPj4+Pj4gKyAgICBy
ZXR1cm4gc3ZxLT51c2VkX2lkeCAhPSBzdnEtPnNoYWRvd191c2VkX2lkeDsKPj4+Pj4gK30KPj4+
Pj4gKwo+Pj4+PiArc3RhdGljIFZpcnRRdWV1ZUVsZW1lbnQgKnZob3N0X3NoYWRvd192cV9nZXRf
YnVmKFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEpCj4+Pj4+ICt7Cj4+Pj4+ICsgICAgdnJpbmdf
ZGVzY190ICpkZXNjcyA9IHN2cS0+dnJpbmcuZGVzYzsKPj4+Pj4gKyAgICBjb25zdCB2cmluZ191
c2VkX3QgKnVzZWQgPSBzdnEtPnZyaW5nLnVzZWQ7Cj4+Pj4+ICsgICAgdnJpbmdfdXNlZF9lbGVt
X3QgdXNlZF9lbGVtOwo+Pj4+PiArICAgIHVpbnQxNl90IGxhc3RfdXNlZDsKPj4+Pj4gKwo+Pj4+
PiArICAgIGlmICghdmhvc3Rfc2hhZG93X3ZxX21vcmVfdXNlZChzdnEpKSB7Cj4+Pj4+ICsgICAg
ICAgIHJldHVybiBOVUxMOwo+Pj4+PiArICAgIH0KPj4+Pj4gKwo+Pj4+PiArICAgIGxhc3RfdXNl
ZCA9IHN2cS0+dXNlZF9pZHggJiAoc3ZxLT52cmluZy5udW0gLSAxKTsKPj4+Pj4gKyAgICB1c2Vk
X2VsZW0uaWQgPSB2aXJ0aW9fdHN3YXAzMihzdnEtPnZkZXYsIHVzZWQtPnJpbmdbbGFzdF91c2Vk
XS5pZCk7Cj4+Pj4+ICsgICAgdXNlZF9lbGVtLmxlbiA9IHZpcnRpb190c3dhcDMyKHN2cS0+dmRl
diwgdXNlZC0+cmluZ1tsYXN0X3VzZWRdLmxlbik7Cj4+Pj4+ICsKPj4+Pj4gKyAgICBpZiAodW5s
aWtlbHkodXNlZF9lbGVtLmlkID49IHN2cS0+dnJpbmcubnVtKSkgewo+Pj4+PiArICAgICAgICBl
cnJvcl9yZXBvcnQoIkRldmljZSAlcyBzYXlzIGluZGV4ICV1IGlzIGF2YWlsYWJsZSIsIHN2cS0+
dmRldi0+bmFtZSwKPj4+Pj4gKyAgICAgICAgICAgICAgICAgICAgIHVzZWRfZWxlbS5pZCk7Cj4+
Pj4+ICsgICAgICAgIHJldHVybiBOVUxMOwo+Pj4+PiArICAgIH0KPj4+Pj4gKwo+Pj4+PiArICAg
IGRlc2NzW3VzZWRfZWxlbS5pZF0ubmV4dCA9IHN2cS0+ZnJlZV9oZWFkOwo+Pj4+PiArICAgIHN2
cS0+ZnJlZV9oZWFkID0gdXNlZF9lbGVtLmlkOwo+Pj4+PiArCj4+Pj4+ICsgICAgc3ZxLT51c2Vk
X2lkeCsrOwo+Pj4+PiArICAgIHN2cS0+cmluZ19pZF9tYXBzW3VzZWRfZWxlbS5pZF0tPmxlbiA9
IHVzZWRfZWxlbS5sZW47Cj4+Pj4+ICsgICAgcmV0dXJuIGdfc3RlYWxfcG9pbnRlcigmc3ZxLT5y
aW5nX2lkX21hcHNbdXNlZF9lbGVtLmlkXSk7Cj4+Pj4+ICAgICB9Cj4+Pj4+Cj4+Pj4+ICAgICAv
KiBGb3J3YXJkIHZob3N0IG5vdGlmaWNhdGlvbnMgKi8KPj4+Pj4gQEAgLTc4LDYgKzIyOSw3IEBA
IHN0YXRpYyB2b2lkIHZob3N0X3NoYWRvd192cV9oYW5kbGVfY2FsbF9ub190ZXN0KEV2ZW50Tm90
aWZpZXIgKm4pCj4+Pj4+ICAgICAgICAgVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2cSA9IGNvbnRh
aW5lcl9vZihuLCBWaG9zdFNoYWRvd1ZpcnRxdWV1ZSwKPj4+Pj4gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxfbm90aWZpZXIpOwo+Pj4+PiAgICAg
ICAgIEV2ZW50Tm90aWZpZXIgKm1hc2tlZF9ub3RpZmllcjsKPj4+Pj4gKyAgICBWaXJ0UXVldWUg
KnZxID0gc3ZxLT52cTsKPj4+Pj4KPj4+Pj4gICAgICAgICAvKiBTaWduYWwgc3RhcnQgb2YgdXNp
bmcgbWFza2VkIG5vdGlmaWVyICovCj4+Pj4+ICAgICAgICAgcWVtdV9ldmVudF9yZXNldCgmc3Zx
LT5tYXNrZWRfbm90aWZpZXIuaXNfZnJlZSk7Cj4+Pj4+IEBAIC04NiwxNCArMjM4LDI5IEBAIHN0
YXRpYyB2b2lkIHZob3N0X3NoYWRvd192cV9oYW5kbGVfY2FsbF9ub190ZXN0KEV2ZW50Tm90aWZp
ZXIgKm4pCj4+Pj4+ICAgICAgICAgICAgIHFlbXVfZXZlbnRfc2V0KCZzdnEtPm1hc2tlZF9ub3Rp
Zmllci5pc19mcmVlKTsKPj4+Pj4gICAgICAgICB9Cj4+Pj4+Cj4+Pj4+IC0gICAgaWYgKCFtYXNr
ZWRfbm90aWZpZXIpIHsKPj4+Pj4gLSAgICAgICAgdW5zaWduZWQgbiA9IHZpcnRpb19nZXRfcXVl
dWVfaW5kZXgoc3ZxLT52cSk7Cj4+Pj4+IC0gICAgICAgIHZpcnRpb19xdWV1ZV9pbnZhbGlkYXRl
X3NpZ25hbGxlZF91c2VkKHN2cS0+dmRldiwgbik7Cj4+Pj4+IC0gICAgICAgIHZpcnRpb19ub3Rp
ZnlfaXJxZmQoc3ZxLT52ZGV2LCBzdnEtPnZxKTsKPj4+Pj4gLSAgICB9IGVsc2UgaWYgKCFzdnEt
Pm1hc2tlZF9ub3RpZmllci5zaWduYWxlZCkgewo+Pj4+PiAtICAgICAgICBzdnEtPm1hc2tlZF9u
b3RpZmllci5zaWduYWxlZCA9IHRydWU7Cj4+Pj4+IC0gICAgICAgIGV2ZW50X25vdGlmaWVyX3Nl
dChzdnEtPm1hc2tlZF9ub3RpZmllci5uKTsKPj4+Pj4gLSAgICB9Cj4+Pj4+ICsgICAgLyogTWFr
ZSBhcyBtYW55IGJ1ZmZlcnMgYXMgcG9zc2libGUgdXNlZC4gKi8KPj4+Pj4gKyAgICBkbyB7Cj4+
Pj4+ICsgICAgICAgIHVuc2lnbmVkIGkgPSAwOwo+Pj4+PiArCj4+Pj4+ICsgICAgICAgIC8qIFRP
RE86IFVzZSBWUklOR19BVkFJTF9GX05PX0lOVEVSUlVQVCAqLwo+Pj4+PiArICAgICAgICB3aGls
ZSAodHJ1ZSkgewo+Pj4+PiArICAgICAgICAgICAgZ19hdXRvZnJlZSBWaXJ0UXVldWVFbGVtZW50
ICplbGVtID0gdmhvc3Rfc2hhZG93X3ZxX2dldF9idWYoc3ZxKTsKPj4+Pj4gKyAgICAgICAgICAg
IGlmICghZWxlbSkgewo+Pj4+PiArICAgICAgICAgICAgICAgIGJyZWFrOwo+Pj4+PiArICAgICAg
ICAgICAgfQo+Pj4+PiArCj4+Pj4+ICsgICAgICAgICAgICBhc3NlcnQoaSA8IHN2cS0+dnJpbmcu
bnVtKTsKPj4+Pj4gKyAgICAgICAgICAgIHZpcnRxdWV1ZV9maWxsKHZxLCBlbGVtLCBlbGVtLT5s
ZW4sIGkrKyk7Cj4+Pj4+ICsgICAgICAgIH0KPj4+Pj4gKwo+Pj4+PiArICAgICAgICB2aXJ0cXVl
dWVfZmx1c2godnEsIGkpOwo+Pj4+PiArICAgICAgICBpZiAoIW1hc2tlZF9ub3RpZmllcikgewo+
Pj4+PiArICAgICAgICAgICAgdmlydGlvX25vdGlmeV9pcnFmZChzdnEtPnZkZXYsIHN2cS0+dnEp
Owo+Pj4+PiArICAgICAgICB9IGVsc2UgaWYgKCFzdnEtPm1hc2tlZF9ub3RpZmllci5zaWduYWxl
ZCkgewo+Pj4+PiArICAgICAgICAgICAgc3ZxLT5tYXNrZWRfbm90aWZpZXIuc2lnbmFsZWQgPSB0
cnVlOwo+Pj4+PiArICAgICAgICAgICAgZXZlbnRfbm90aWZpZXJfc2V0KHN2cS0+bWFza2VkX25v
dGlmaWVyLm4pOwo+Pj4+PiArICAgICAgICB9Cj4+Pj4+ICsgICAgfSB3aGlsZSAodmhvc3Rfc2hh
ZG93X3ZxX21vcmVfdXNlZChzdnEpKTsKPj4+Pj4KPj4+Pj4gICAgICAgICBpZiAobWFza2VkX25v
dGlmaWVyKSB7Cj4+Pj4+ICAgICAgICAgICAgIC8qIFNpZ25hbCBub3QgdXNpbmcgaXQgYW55bW9y
ZSAqLwo+Pj4+PiBAQCAtMTAzLDcgKzI3MCw2IEBAIHN0YXRpYyB2b2lkIHZob3N0X3NoYWRvd192
cV9oYW5kbGVfY2FsbF9ub190ZXN0KEV2ZW50Tm90aWZpZXIgKm4pCj4+Pj4+Cj4+Pj4+ICAgICBz
dGF0aWMgdm9pZCB2aG9zdF9zaGFkb3dfdnFfaGFuZGxlX2NhbGwoRXZlbnROb3RpZmllciAqbikK
Pj4+Pj4gICAgIHsKPj4+Pj4gLQo+Pj4+PiAgICAgICAgIGlmIChsaWtlbHkoZXZlbnRfbm90aWZp
ZXJfdGVzdF9hbmRfY2xlYXIobikpKSB7Cj4+Pj4+ICAgICAgICAgICAgIHZob3N0X3NoYWRvd192
cV9oYW5kbGVfY2FsbF9ub190ZXN0KG4pOwo+Pj4+PiAgICAgICAgIH0KPj4+Pj4gQEAgLTI1NCw3
ICs0MjAsMTEgQEAgdm9pZCB2aG9zdF9zaGFkb3dfdnFfc3RvcChzdHJ1Y3Qgdmhvc3RfZGV2ICpk
ZXYsCj4+Pj4+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGlkeCwKPj4+
Pj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmhvc3RTaGFkb3dWaXJ0cXVldWUgKnN2
cSkKPj4+Pj4gICAgIHsKPj4+Pj4gKyAgICBpbnQgaTsKPj4+Pj4gICAgICAgICBpbnQgciA9IHZo
b3N0X3NoYWRvd192cV9yZXN0b3JlX3ZkZXZfaG9zdF9ub3RpZmllcihkZXYsIGlkeCwgc3ZxKTsK
Pj4+Pj4gKwo+Pj4+PiArICAgIGFzc2VydCghZGV2LT5zaGFkb3dfdnFzX2VuYWJsZWQpOwo+Pj4+
PiArCj4+Pj4+ICAgICAgICAgaWYgKHVubGlrZWx5KHIgPCAwKSkgewo+Pj4+PiAgICAgICAgICAg
ICBlcnJvcl9yZXBvcnQoIkNvdWxkbid0IHJlc3RvcmUgdnEga2ljayBmZDogJXMiLCBzdHJlcnJv
cigtcikpOwo+Pj4+PiAgICAgICAgIH0KPj4+Pj4gQEAgLTI3Miw2ICs0NDIsMTggQEAgdm9pZCB2
aG9zdF9zaGFkb3dfdnFfc3RvcChzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYsCj4+Pj4+ICAgICAgICAg
LyogUmVzdG9yZSB2aG9zdCBjYWxsICovCj4+Pj4+ICAgICAgICAgdmhvc3RfdmlydHF1ZXVlX21h
c2soZGV2LCBkZXYtPnZkZXYsIGRldi0+dnFfaW5kZXggKyBpZHgsCj4+Pj4+ICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZGV2LT52cXNbaWR4XS5ub3RpZmllcl9pc19tYXNrZWQpOwo+Pj4+
PiArCj4+Pj4+ICsKPj4+Pj4gKyAgICBmb3IgKGkgPSAwOyBpIDwgc3ZxLT52cmluZy5udW07ICsr
aSkgewo+Pj4+PiArICAgICAgICBnX2F1dG9mcmVlIFZpcnRRdWV1ZUVsZW1lbnQgKmVsZW0gPSBz
dnEtPnJpbmdfaWRfbWFwc1tpXTsKPj4+Pj4gKyAgICAgICAgLyoKPj4+Pj4gKyAgICAgICAgICog
QWx0aG91Z2ggdGhlIGRvYyBzYXlzIHdlIG11c3QgdW5wb3AgaW4gb3JkZXIsIGl0J3Mgb2sgdG8g
dW5wb3AKPj4+Pj4gKyAgICAgICAgICogZXZlcnl0aGluZy4KPj4+Pj4gKyAgICAgICAgICovCj4+
Pj4+ICsgICAgICAgIGlmIChlbGVtKSB7Cj4+Pj4+ICsgICAgICAgICAgICB2aXJ0cXVldWVfdW5w
b3Aoc3ZxLT52cSwgZWxlbSwgZWxlbS0+bGVuKTsKPj4+PiBTaG91bGRuJ3Qgd2UgbmVlZCB0byB3
YWl0IHVudGlsIGFsbCBwZW5kaW5nIHJlcXVlc3RzIHRvIGJlIGRyYWluZWQ/IE9yCj4+Pj4gd2Ug
bWF5IGVuZCB1cCBkdXBsaWNhdGVkIHJlcXVlc3RzPwo+Pj4+Cj4+PiBEbyB5b3UgbWVhbiBwZW5k
aW5nIGFzIGluLWZsaWdodC9wcm9jZXNzaW5nIGluIHRoZSBkZXZpY2U/IFRoZSBkZXZpY2UKPj4+
IG11c3QgYmUgcGF1c2VkIGF0IHRoaXMgcG9pbnQuCj4+Cj4+IE9rLiBJIHNlZSB0aGVyZSdzIGEg
dmhvc3Rfc2V0X3ZyaW5nX2VuYWJsZShkZXYsIGZhbHNlKSBpbgo+PiB2aG9zdF9zd19saXZlX21p
Z3JhdGlvbl9zdGFydCgpLgo+Pgo+Pgo+Pj4gQ3VycmVudGx5IHRoZXJlIGlzIG5vIGFzc2VydGlv
biBmb3IKPj4+IHRoaXMsIG1heWJlIHdlIGNhbiB0cmFjayB0aGUgZGV2aWNlIHN0YXR1cyBmb3Ig
aXQuCj4+Pgo+Pj4gRm9yIHRoZSBxdWV1ZSBoYW5kbGVycyB0byBiZSBydW5uaW5nIGF0IHRoaXMg
cG9pbnQsIHRoZSBtYWluIGV2ZW50Cj4+PiBsb29wIHNob3VsZCBzZXJpYWxpemUgUU1QIGFuZCBo
YW5kbGVycyBhcyBmYXIgYXMgSSBrbm93IChhbmQgdGhleQo+Pj4gd291bGQgbWFrZSBhbGwgc3Rh
dGUgaW5jb25zaXN0ZW50IGlmIHRoZSBkZXZpY2Ugc3RvcHMgc3VkZGVubHkpLiBJdAo+Pj4gd291
bGQgbmVlZCB0byBiZSBzeW5jaHJvbml6ZWQgaWYgdGhlIGhhbmRsZXJzIHJ1biBpbiB0aGVpciBv
d24gQUlPCj4+PiBjb250ZXh0LiBUaGF0IHdvdWxkIGJlIG5pY2UgdG8gaGF2ZSBidXQgaXQncyBu
b3QgaW5jbHVkZWQgaGVyZS4KPj4KPj4gVGhhdCdzIHdoeSBJIHN1Z2dlc3QgdG8ganVzdCBkcm9w
IHRoZSBRTVAgc3R1ZmZzIGFuZCB1c2UgY2xpIHBhcmFtZXRlcnMKPj4gdG8gZW5hYmxlIHNoYWRv
dyB2aXJ0cXVldWUuIFRoaW5ncyB3b3VsZCBiZSBncmVhdGx5IHNpbXBsaWZpZWQgSSBndWVzcy4K
Pj4KPiBJIGNhbiBzZW5kIGEgc2VyaWVzIHdpdGhvdXQgaXQsIGJ1dCBTVlEgd2lsbCBuZWVkIHRv
IGJlIGFibGUgdG8ga2ljawo+IGluIGR5bmFtaWNhbGx5IHNvb25lciBvciBsYXRlciBpZiB3ZSB3
YW50IHRvIHVzZSBpdCBmb3IgbGl2ZQo+IG1pZ3JhdGlvbi4KCgpJJ20gbm90IHN1cmUgSSBnZXQg
dGhlIGlzc3VlIGhlcmUuIE15IHVuZGVyc3RuYWRpbmcgaXMgZXZlcnloaW5nIHdpbGwgYmUgCnBy
b2Nlc3NlZCBpbiB0aGUgc2FtZSBhaW8gY29udGV4dC4KClRoYW5rcwoKCj4KPj4gVGhhbmtzCj4+
Cj4+Cj4+Pj4gVGhhbmtzCj4+Pj4KPj4+Pgo+Pj4+PiArICAgICAgICB9Cj4+Pj4+ICsgICAgfQo+
Pj4+PiAgICAgfQo+Pj4+Pgo+Pj4+PiAgICAgLyoKPj4+Pj4gQEAgLTI4NCw3ICs0NjYsNyBAQCBW
aG9zdFNoYWRvd1ZpcnRxdWV1ZSAqdmhvc3Rfc2hhZG93X3ZxX25ldyhzdHJ1Y3Qgdmhvc3RfZGV2
ICpkZXYsIGludCBpZHgpCj4+Pj4+ICAgICAgICAgdW5zaWduZWQgbnVtID0gdmlydGlvX3F1ZXVl
X2dldF9udW0oZGV2LT52ZGV2LCB2cV9pZHgpOwo+Pj4+PiAgICAgICAgIHNpemVfdCByaW5nX3Np
emUgPSB2cmluZ19zaXplKG51bSwgVlJJTkdfREVTQ19BTElHTl9TSVpFKTsKPj4+Pj4gICAgICAg
ICBnX2F1dG9mcmVlIFZob3N0U2hhZG93VmlydHF1ZXVlICpzdnEgPSBnX21hbGxvYzAoc2l6ZW9m
KCpzdnEpICsgcmluZ19zaXplKTsKPj4+Pj4gLSAgICBpbnQgcjsKPj4+Pj4gKyAgICBpbnQgciwg
aTsKPj4+Pj4KPj4+Pj4gICAgICAgICByID0gZXZlbnRfbm90aWZpZXJfaW5pdCgmc3ZxLT5raWNr
X25vdGlmaWVyLCAwKTsKPj4+Pj4gICAgICAgICBpZiAociAhPSAwKSB7Cj4+Pj4+IEBAIC0zMDMs
NiArNDg1LDExIEBAIFZob3N0U2hhZG93VmlydHF1ZXVlICp2aG9zdF9zaGFkb3dfdnFfbmV3KHN0
cnVjdCB2aG9zdF9kZXYgKmRldiwgaW50IGlkeCkKPj4+Pj4gICAgICAgICB2cmluZ19pbml0KCZz
dnEtPnZyaW5nLCBudW0sIHN2cS0+ZGVzY3MsIFZSSU5HX0RFU0NfQUxJR05fU0laRSk7Cj4+Pj4+
ICAgICAgICAgc3ZxLT52cSA9IHZpcnRpb19nZXRfcXVldWUoZGV2LT52ZGV2LCB2cV9pZHgpOwo+
Pj4+PiAgICAgICAgIHN2cS0+dmRldiA9IGRldi0+dmRldjsKPj4+Pj4gKyAgICBmb3IgKGkgPSAw
OyBpIDwgbnVtIC0gMTsgaSsrKSB7Cj4+Pj4+ICsgICAgICAgIHN2cS0+ZGVzY3NbaV0ubmV4dCA9
IHZpcnRpb190c3dhcDE2KGRldi0+dmRldiwgaSArIDEpOwo+Pj4+PiArICAgIH0KPj4+Pj4gKwo+
Pj4+PiArICAgIHN2cS0+cmluZ19pZF9tYXBzID0gZ19uZXcwKFZpcnRRdWV1ZUVsZW1lbnQgKiwg
bnVtKTsKPj4+Pj4gICAgICAgICBldmVudF9ub3RpZmllcl9zZXRfaGFuZGxlcigmc3ZxLT5jYWxs
X25vdGlmaWVyLAo+Pj4+PiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZob3N0
X3NoYWRvd192cV9oYW5kbGVfY2FsbCk7Cj4+Pj4+ICAgICAgICAgcWVtdV9ldmVudF9pbml0KCZz
dnEtPm1hc2tlZF9ub3RpZmllci5pc19mcmVlLCB0cnVlKTsKPj4+Pj4gQEAgLTMyNCw1ICs1MTEs
NiBAQCB2b2lkIHZob3N0X3NoYWRvd192cV9mcmVlKFZob3N0U2hhZG93VmlydHF1ZXVlICp2cSkK
Pj4+Pj4gICAgICAgICBldmVudF9ub3RpZmllcl9jbGVhbnVwKCZ2cS0+a2lja19ub3RpZmllcik7
Cj4+Pj4+ICAgICAgICAgZXZlbnRfbm90aWZpZXJfc2V0X2hhbmRsZXIoJnZxLT5jYWxsX25vdGlm
aWVyLCBOVUxMKTsKPj4+Pj4gICAgICAgICBldmVudF9ub3RpZmllcl9jbGVhbnVwKCZ2cS0+Y2Fs
bF9ub3RpZmllcik7Cj4+Pj4+ICsgICAgZ19mcmVlKHZxLT5yaW5nX2lkX21hcHMpOwo+Pj4+PiAg
ICAgICAgIGdfZnJlZSh2cSk7Cj4+Pj4+ICAgICB9Cj4+Pj4+IGRpZmYgLS1naXQgYS9ody92aXJ0
aW8vdmhvc3QuYyBiL2h3L3ZpcnRpby92aG9zdC5jCj4+Pj4+IGluZGV4IGVhYjNlMzM0ZjIuLmEz
NzM5OTliYzQgMTAwNjQ0Cj4+Pj4+IC0tLSBhL2h3L3ZpcnRpby92aG9zdC5jCj4+Pj4+ICsrKyBi
L2h3L3ZpcnRpby92aG9zdC5jCj4+Pj4+IEBAIC0xMDIxLDYgKzEwMjEsMTkgQEAgaW50IHZob3N0
X2RldmljZV9pb3RsYl9taXNzKHN0cnVjdCB2aG9zdF9kZXYgKmRldiwgdWludDY0X3QgaW92YSwg
aW50IHdyaXRlKQo+Pj4+Pgo+Pj4+PiAgICAgICAgIHRyYWNlX3Zob3N0X2lvdGxiX21pc3MoZGV2
LCAxKTsKPj4+Pj4KPj4+Pj4gKyAgICBpZiAocWF0b21pY19sb2FkX2FjcXVpcmUoJmRldi0+c2hh
ZG93X3Zxc19lbmFibGVkKSkgewo+Pj4+PiArICAgICAgICB1YWRkciA9IGlvdmE7Cj4+Pj4+ICsg
ICAgICAgIGxlbiA9IDQwOTY7Cj4+Pj4+ICsgICAgICAgIHJldCA9IHZob3N0X2JhY2tlbmRfdXBk
YXRlX2RldmljZV9pb3RsYihkZXYsIGlvdmEsIHVhZGRyLCBsZW4sCj4+Pj4+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJT01NVV9SVyk7Cj4+Pj4+ICsg
ICAgICAgIGlmIChyZXQpIHsKPj4+Pj4gKyAgICAgICAgICAgIHRyYWNlX3Zob3N0X2lvdGxiX21p
c3MoZGV2LCAyKTsKPj4+Pj4gKyAgICAgICAgICAgIGVycm9yX3JlcG9ydCgiRmFpbCB0byB1cGRh
dGUgZGV2aWNlIGlvdGxiIik7Cj4+Pj4+ICsgICAgICAgIH0KPj4+Pj4gKwo+Pj4+PiArICAgICAg
ICByZXR1cm4gcmV0Owo+Pj4+PiArICAgIH0KPj4+Pj4gKwo+Pj4+PiAgICAgICAgIGlvdGxiID0g
YWRkcmVzc19zcGFjZV9nZXRfaW90bGJfZW50cnkoZGV2LT52ZGV2LT5kbWFfYXMsCj4+Pj4+ICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpb3ZhLCB3cml0ZSwK
Pj4+Pj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1FTVRY
QVRUUlNfVU5TUEVDSUZJRUQpOwo+Pj4+PiBAQCAtMTIyNyw4ICsxMjQwLDI4IEBAIHN0YXRpYyBp
bnQgdmhvc3Rfc3dfbGl2ZV9taWdyYXRpb25fc3RvcChzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYpCj4+
Pj4+ICAgICAgICAgLyogQ2FuIGJlIHJlYWQgYnkgdmhvc3RfdmlydHF1ZXVlX21hc2ssIGZyb20g
dm0gZXhpdCAqLwo+Pj4+PiAgICAgICAgIHFhdG9taWNfc3RvcmVfcmVsZWFzZSgmZGV2LT5zaGFk
b3dfdnFzX2VuYWJsZWQsIGZhbHNlKTsKPj4+Pj4KPj4+Pj4gKyAgICBkZXYtPnZob3N0X29wcy0+
dmhvc3Rfc2V0X3ZyaW5nX2VuYWJsZShkZXYsIGZhbHNlKTsKPj4+Pj4gKyAgICBpZiAodmhvc3Rf
YmFja2VuZF9pbnZhbGlkYXRlX2RldmljZV9pb3RsYihkZXYsIDAsIC0xVUxMKSkgewo+Pj4+PiAr
ICAgICAgICBlcnJvcl9yZXBvcnQoIkZhaWwgdG8gaW52YWxpZGF0ZSBkZXZpY2UgaW90bGIiKTsK
Pj4+Pj4gKyAgICB9Cj4+Pj4+ICsKPj4+Pj4gICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8IGRl
di0+bnZxczsgKytpZHgpIHsKPj4+Pj4gKyAgICAgICAgLyoKPj4+Pj4gKyAgICAgICAgICogVXBk
YXRlIHVzZWQgcmluZyBpbmZvcm1hdGlvbiBmb3IgSU9UTEIgdG8gd29yayBjb3JyZWN0bHksCj4+
Pj4+ICsgICAgICAgICAqIHZob3N0LWtlcm5lbCBjb2RlIHJlcXVpcmVzIGZvciB0aGlzLgo+Pj4+
PiArICAgICAgICAgKi8KPj4+Pj4gKyAgICAgICAgc3RydWN0IHZob3N0X3ZpcnRxdWV1ZSAqdnEg
PSBkZXYtPnZxcyArIGlkeDsKPj4+Pj4gKyAgICAgICAgdmhvc3RfZGV2aWNlX2lvdGxiX21pc3Mo
ZGV2LCB2cS0+dXNlZF9waHlzLCB0cnVlKTsKPj4+Pj4gKwo+Pj4+PiAgICAgICAgICAgICB2aG9z
dF9zaGFkb3dfdnFfc3RvcChkZXYsIGlkeCwgZGV2LT5zaGFkb3dfdnFzW2lkeF0pOwo+Pj4+PiAr
ICAgICAgICB2aG9zdF92aXJ0cXVldWVfc3RhcnQoZGV2LCBkZXYtPnZkZXYsICZkZXYtPnZxc1tp
ZHhdLAo+Pj4+PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2LT52cV9pbmRleCAr
IGlkeCk7Cj4+Pj4+ICsgICAgfQo+Pj4+PiArCj4+Pj4+ICsgICAgLyogRW5hYmxlIGd1ZXN0J3Mg
dnEgdnJpbmcgKi8KPj4+Pj4gKyAgICBkZXYtPnZob3N0X29wcy0+dmhvc3Rfc2V0X3ZyaW5nX2Vu
YWJsZShkZXYsIHRydWUpOwo+Pj4+PiArCj4+Pj4+ICsgICAgZm9yIChpZHggPSAwOyBpZHggPCBk
ZXYtPm52cXM7ICsraWR4KSB7Cj4+Pj4+ICAgICAgICAgICAgIHZob3N0X3NoYWRvd192cV9mcmVl
KGRldi0+c2hhZG93X3Zxc1tpZHhdKTsKPj4+Pj4gICAgICAgICB9Cj4+Pj4+Cj4+Pj4+IEBAIC0x
MjM3LDYgKzEyNzAsNTkgQEAgc3RhdGljIGludCB2aG9zdF9zd19saXZlX21pZ3JhdGlvbl9zdG9w
KHN0cnVjdCB2aG9zdF9kZXYgKmRldikKPj4+Pj4gICAgICAgICByZXR1cm4gMDsKPj4+Pj4gICAg
IH0KPj4+Pj4KPj4+Pj4gKy8qCj4+Pj4+ICsgKiBTdGFydCBzaGFkb3cgdmlydHF1ZXVlIGluIGEg
Z2l2ZW4gcXVldWUuCj4+Pj4+ICsgKiBJbiBmYWlsdXJlIGNhc2UsIHRoaXMgZnVuY3Rpb24gbGVh
dmVzIHF1ZXVlIHdvcmtpbmcgYXMgcmVndWxhciB2aG9zdCBtb2RlLgo+Pj4+PiArICovCj4+Pj4+
ICtzdGF0aWMgYm9vbCB2aG9zdF9zd19saXZlX21pZ3JhdGlvbl9zdGFydF92cShzdHJ1Y3Qgdmhv
c3RfZGV2ICpkZXYsCj4+Pj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB1bnNpZ25lZCBpZHgpCj4+Pj4+ICt7Cj4+Pj4+ICsgICAgc3RydWN0IHZob3N0X3Zy
aW5nX2FkZHIgYWRkciA9IHsKPj4+Pj4gKyAgICAgICAgLmluZGV4ID0gaWR4LAo+Pj4+PiArICAg
IH07Cj4+Pj4+ICsgICAgc3RydWN0IHZob3N0X3ZyaW5nX3N0YXRlIHMgPSB7Cj4+Pj4+ICsgICAg
ICAgIC5pbmRleCA9IGlkeCwKPj4+Pj4gKyAgICB9Owo+Pj4+PiArICAgIGludCByOwo+Pj4+PiAr
ICAgIGJvb2wgb2s7Cj4+Pj4+ICsKPj4+Pj4gKyAgICB2aG9zdF92aXJ0cXVldWVfc3RvcChkZXYs
IGRldi0+dmRldiwgJmRldi0+dnFzW2lkeF0sIGRldi0+dnFfaW5kZXggKyBpZHgpOwo+Pj4+PiAr
ICAgIG9rID0gdmhvc3Rfc2hhZG93X3ZxX3N0YXJ0KGRldiwgaWR4LCBkZXYtPnNoYWRvd192cXNb
aWR4XSk7Cj4+Pj4+ICsgICAgaWYgKHVubGlrZWx5KCFvaykpIHsKPj4+Pj4gKyAgICAgICAgcmV0
dXJuIGZhbHNlOwo+Pj4+PiArICAgIH0KPj4+Pj4gKwo+Pj4+PiArICAgIC8qIEZyb20gdGhpcyBw
b2ludCwgdmhvc3RfdmlydHF1ZXVlX3N0YXJ0IGNhbiByZXNldCB0aGVzZSBjaGFuZ2VzICovCj4+
Pj4+ICsgICAgdmhvc3Rfc2hhZG93X3ZxX2dldF92cmluZ19hZGRyKGRldi0+c2hhZG93X3Zxc1tp
ZHhdLCAmYWRkcik7Cj4+Pj4+ICsgICAgciA9IGRldi0+dmhvc3Rfb3BzLT52aG9zdF9zZXRfdnJp
bmdfYWRkcihkZXYsICZhZGRyKTsKPj4+Pj4gKyAgICBpZiAodW5saWtlbHkociAhPSAwKSkgewo+
Pj4+PiArICAgICAgICBWSE9TVF9PUFNfREVCVUcoInZob3N0X3NldF92cmluZ19hZGRyIGZvciBz
aGFkb3cgdnEgZmFpbGVkIik7Cj4+Pj4+ICsgICAgICAgIGdvdG8gZXJyOwo+Pj4+PiArICAgIH0K
Pj4+Pj4gKwo+Pj4+PiArICAgIHIgPSBkZXYtPnZob3N0X29wcy0+dmhvc3Rfc2V0X3ZyaW5nX2Jh
c2UoZGV2LCAmcyk7Cj4+Pj4+ICsgICAgaWYgKHVubGlrZWx5KHIgIT0gMCkpIHsKPj4+Pj4gKyAg
ICAgICAgVkhPU1RfT1BTX0RFQlVHKCJ2aG9zdF9zZXRfdnJpbmdfYmFzZSBmb3Igc2hhZG93IHZx
IGZhaWxlZCIpOwo+Pj4+PiArICAgICAgICBnb3RvIGVycjsKPj4+Pj4gKyAgICB9Cj4+Pj4+ICsK
Pj4+Pj4gKyAgICAvKgo+Pj4+PiArICAgICAqIFVwZGF0ZSB1c2VkIHJpbmcgaW5mb3JtYXRpb24g
Zm9yIElPVExCIHRvIHdvcmsgY29ycmVjdGx5LAo+Pj4+PiArICAgICAqIHZob3N0LWtlcm5lbCBj
b2RlIHJlcXVpcmVzIGZvciB0aGlzLgo+Pj4+PiArICAgICAqLwo+Pj4+PiArICAgIHIgPSB2aG9z
dF9kZXZpY2VfaW90bGJfbWlzcyhkZXYsIGFkZHIudXNlZF91c2VyX2FkZHIsIHRydWUpOwo+Pj4+
PiArICAgIGlmICh1bmxpa2VseShyICE9IDApKSB7Cj4+Pj4+ICsgICAgICAgIC8qIERlYnVnIG1l
c3NhZ2UgYWxyZWFkeSBwcmludGVkICovCj4+Pj4+ICsgICAgICAgIGdvdG8gZXJyOwo+Pj4+PiAr
ICAgIH0KPj4+Pj4gKwo+Pj4+PiArICAgIHJldHVybiB0cnVlOwo+Pj4+PiArCj4+Pj4+ICtlcnI6
Cj4+Pj4+ICsgICAgdmhvc3RfdmlydHF1ZXVlX3N0YXJ0KGRldiwgZGV2LT52ZGV2LCAmZGV2LT52
cXNbaWR4XSwgZGV2LT52cV9pbmRleCArIGlkeCk7Cj4+Pj4+ICsgICAgcmV0dXJuIGZhbHNlOwo+
Pj4+PiArfQo+Pj4+PiArCj4+Pj4+ICAgICBzdGF0aWMgaW50IHZob3N0X3N3X2xpdmVfbWlncmF0
aW9uX3N0YXJ0KHN0cnVjdCB2aG9zdF9kZXYgKmRldikKPj4+Pj4gICAgIHsKPj4+Pj4gICAgICAg
ICBpbnQgaWR4LCBzdG9wX2lkeDsKPj4+Pj4gQEAgLTEyNDksMjQgKzEzMzUsMzUgQEAgc3RhdGlj
IGludCB2aG9zdF9zd19saXZlX21pZ3JhdGlvbl9zdGFydChzdHJ1Y3Qgdmhvc3RfZGV2ICpkZXYp
Cj4+Pj4+ICAgICAgICAgICAgIH0KPj4+Pj4gICAgICAgICB9Cj4+Pj4+Cj4+Pj4+ICsgICAgZGV2
LT52aG9zdF9vcHMtPnZob3N0X3NldF92cmluZ19lbmFibGUoZGV2LCBmYWxzZSk7Cj4+Pj4+ICsg
ICAgaWYgKHZob3N0X2JhY2tlbmRfaW52YWxpZGF0ZV9kZXZpY2VfaW90bGIoZGV2LCAwLCAtMVVM
TCkpIHsKPj4+Pj4gKyAgICAgICAgZXJyb3JfcmVwb3J0KCJGYWlsIHRvIGludmFsaWRhdGUgZGV2
aWNlIGlvdGxiIik7Cj4+Pj4+ICsgICAgfQo+Pj4+PiArCj4+Pj4+ICAgICAgICAgLyogQ2FuIGJl
IHJlYWQgYnkgdmhvc3RfdmlydHF1ZXVlX21hc2ssIGZyb20gdm0gZXhpdCAqLwo+Pj4+PiAgICAg
ICAgIHFhdG9taWNfc3RvcmVfcmVsZWFzZSgmZGV2LT5zaGFkb3dfdnFzX2VuYWJsZWQsIHRydWUp
Owo+Pj4+PiAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDwgZGV2LT5udnFzOyArK2lkeCkgewo+
Pj4+PiAtICAgICAgICBib29sIG9rID0gdmhvc3Rfc2hhZG93X3ZxX3N0YXJ0KGRldiwgaWR4LCBk
ZXYtPnNoYWRvd192cXNbaWR4XSk7Cj4+Pj4+ICsgICAgICAgIGJvb2wgb2sgPSB2aG9zdF9zd19s
aXZlX21pZ3JhdGlvbl9zdGFydF92cShkZXYsIGlkeCk7Cj4+Pj4+ICAgICAgICAgICAgIGlmICh1
bmxpa2VseSghb2spKSB7Cj4+Pj4+ICAgICAgICAgICAgICAgICBnb3RvIGVycl9zdGFydDsKPj4+
Pj4gICAgICAgICAgICAgfQo+Pj4+PiAgICAgICAgIH0KPj4+Pj4KPj4+Pj4gKyAgICAvKiBFbmFi
bGUgc2hhZG93IHZxIHZyaW5nICovCj4+Pj4+ICsgICAgZGV2LT52aG9zdF9vcHMtPnZob3N0X3Nl
dF92cmluZ19lbmFibGUoZGV2LCB0cnVlKTsKPj4+Pj4gICAgICAgICByZXR1cm4gMDsKPj4+Pj4K
Pj4+Pj4gICAgIGVycl9zdGFydDoKPj4+Pj4gICAgICAgICBxYXRvbWljX3N0b3JlX3JlbGVhc2Uo
JmRldi0+c2hhZG93X3Zxc19lbmFibGVkLCBmYWxzZSk7Cj4+Pj4+ICAgICAgICAgZm9yIChzdG9w
X2lkeCA9IDA7IHN0b3BfaWR4IDwgaWR4OyBzdG9wX2lkeCsrKSB7Cj4+Pj4+ICAgICAgICAgICAg
IHZob3N0X3NoYWRvd192cV9zdG9wKGRldiwgaWR4LCBkZXYtPnNoYWRvd192cXNbc3RvcF9pZHhd
KTsKPj4+Pj4gKyAgICAgICAgdmhvc3RfdmlydHF1ZXVlX3N0YXJ0KGRldiwgZGV2LT52ZGV2LCAm
ZGV2LT52cXNbaWR4XSwKPj4+Pj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldi0+
dnFfaW5kZXggKyBzdG9wX2lkeCk7Cj4+Pj4+ICAgICAgICAgfQo+Pj4+Pgo+Pj4+PiAgICAgZXJy
X25ldzoKPj4+Pj4gKyAgICAvKiBFbmFibGUgZ3Vlc3QncyB2cmluZyAqLwo+Pj4+PiArICAgIGRl
di0+dmhvc3Rfb3BzLT52aG9zdF9zZXRfdnJpbmdfZW5hYmxlKGRldiwgdHJ1ZSk7Cj4+Pj4+ICAg
ICAgICAgZm9yIChpZHggPSAwOyBpZHggPCBkZXYtPm52cXM7ICsraWR4KSB7Cj4+Pj4+ICAgICAg
ICAgICAgIHZob3N0X3NoYWRvd192cV9mcmVlKGRldi0+c2hhZG93X3Zxc1tpZHhdKTsKPj4+Pj4g
ICAgICAgICB9Cj4+Pj4+IEBAIC0xOTcwLDYgKzIwNjcsMjAgQEAgdm9pZCBxbXBfeF92aG9zdF9l
bmFibGVfc2hhZG93X3ZxKGNvbnN0IGNoYXIgKm5hbWUsIGJvb2wgZW5hYmxlLCBFcnJvciAqKmVy
cnApCj4+Pj4+Cj4+Pj4+ICAgICAgICAgICAgIGlmICghaGRldi0+c3RhcnRlZCkgewo+Pj4+PiAg
ICAgICAgICAgICAgICAgZXJyX2NhdXNlID0gIkRldmljZSBpcyBub3Qgc3RhcnRlZCI7Cj4+Pj4+
ICsgICAgICAgIH0gZWxzZSBpZiAoIXZob3N0X2Rldl9oYXNfaW9tbXUoaGRldikpIHsKPj4+Pj4g
KyAgICAgICAgICAgIGVycl9jYXVzZSA9ICJEb2VzIG5vdCBzdXBwb3J0IGlvbW11IjsKPj4+Pj4g
KyAgICAgICAgfSBlbHNlIGlmIChoZGV2LT5hY2tlZF9mZWF0dXJlcyAmIEJJVF9VTEwoVklSVElP
X0ZfUklOR19QQUNLRUQpKSB7Cj4+Pj4+ICsgICAgICAgICAgICBlcnJfY2F1c2UgPSAiSXMgcGFj
a2VkIjsKPj4+Pj4gKyAgICAgICAgfSBlbHNlIGlmIChoZGV2LT5hY2tlZF9mZWF0dXJlcyAmIEJJ
VF9VTEwoVklSVElPX1JJTkdfRl9FVkVOVF9JRFgpKSB7Cj4+Pj4+ICsgICAgICAgICAgICBlcnJf
Y2F1c2UgPSAiSGF2ZSBldmVudCBpZHgiOwo+Pj4+PiArICAgICAgICB9IGVsc2UgaWYgKGhkZXYt
PmFja2VkX2ZlYXR1cmVzICYKPj4+Pj4gKyAgICAgICAgICAgICAgICAgICBCSVRfVUxMKFZJUlRJ
T19SSU5HX0ZfSU5ESVJFQ1RfREVTQykpIHsKPj4+Pj4gKyAgICAgICAgICAgIGVycl9jYXVzZSA9
ICJTdXBwb3J0cyBpbmRpcmVjdCBkZXNjcmlwdG9ycyI7Cj4+Pj4+ICsgICAgICAgIH0gZWxzZSBp
ZiAoIWhkZXYtPnZob3N0X29wcy0+dmhvc3Rfc2V0X3ZyaW5nX2VuYWJsZSkgewo+Pj4+PiArICAg
ICAgICAgICAgZXJyX2NhdXNlID0gIkNhbm5vdCBwYXVzZSBkZXZpY2UiOwo+Pj4+PiArICAgICAg
ICB9Cj4+Pj4+ICsKPj4+Pj4gKyAgICAgICAgaWYgKGVycl9jYXVzZSkgewo+Pj4+PiAgICAgICAg
ICAgICAgICAgZ290byBlcnI7Cj4+Pj4+ICAgICAgICAgICAgIH0KPj4+Pj4KCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxp
bmcgbGlzdApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczov
L2xpc3RzLmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlv
bg==
