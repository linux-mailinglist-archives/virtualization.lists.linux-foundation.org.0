Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 02159197892
	for <lists.virtualization@lfdr.de>; Mon, 30 Mar 2020 12:13:21 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id A555F869D7;
	Mon, 30 Mar 2020 10:13:19 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id kLR0JNQfOEXc; Mon, 30 Mar 2020 10:13:17 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id A390D869B8;
	Mon, 30 Mar 2020 10:13:17 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 93E5EC07FF;
	Mon, 30 Mar 2020 10:13:17 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id C1E7AC1AE8
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:13:12 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id A5BF9230F3
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:13:12 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id UcefhrO-79E3
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:12:57 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by silver.osuosl.org (Postfix) with ESMTPS id 9D4552306F
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:12:56 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 1BCEC3064498; Mon, 30 Mar 2020 13:12:55 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 0380D305B7A3;
 Mon, 30 Mar 2020 13:12:55 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v8 41/81] KVM: introspection: add the read/dispatch message
 function
Date: Mon, 30 Mar 2020 13:12:28 +0300
Message-Id: <20200330101308.21702-42-alazar@bitdefender.com>
In-Reply-To: <20200330101308.21702-1-alazar@bitdefender.com>
References: <20200330101308.21702-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>, virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

QmFzZWQgb24gdGhlIGNvbW1vbiBoZWFkZXIgKHN0cnVjdCBrdm1pX21zZ19oZHIpLCB0aGUgcmVj
ZWl2aW5nIHRocmVhZAp3aWxsIHJlYWQvdmFsaWRhdGUgYWxsIG1lc3NhZ2VzLCBleGVjdXRlIHRo
ZSBWTSBpbnRyb3NwZWN0aW9uIGNvbW1hbmRzCihlZy4gS1ZNSV9WTV9HRVRfSU5GTykgYW5kIGRp
c3BhdGNoIHRoZSB2Q1BVIGludHJvc3BlY3Rpb24gY29tbWFuZHMKKGVnLiBLVk1JX1ZDUFVfR0VU
X1JFR0lTVEVSUykgYW5kIHRoZSByZXBsaWVzIHRvIHZDUFUgZXZlbnRzLgoKVGhlIHZDUFUgdGhy
ZWFkcyB3aWxsIHJlcGx5IHRvIHZDUFUgaW50cm9zcGVjdGlvbiBjb21tYW5kcyB3aXRob3V0IHRo
ZQpoZWxwIG9mIHRoZSByZWNlaXZpbmcgdGhyZWFkLgoKVGhpcyB0aHJlYWQgd2lsbCBlbmQgd2hl
biB0aGUgc29ja2V0IGlzIGNsb3NlZCAoYnkgdXNlcnNwYWNlIG9yIHRoZQppbnRyb3NwZWN0aW9u
IHRvb2wpIG9yIG9uIHRoZSBmaXJzdCBBUEkgZXJyb3IgKGVnLiB3cm9uZyBtZXNzYWdlIHNpemUp
LgoKU2lnbmVkLW9mZi1ieTogQWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29t
PgotLS0KIERvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QgICAgICAgICAgICAgICB8ICA4
NiArKysrKysrKysrCiBpbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oICAgICAgICAgICAgICAgICAg
ICAgfCAgMjIgKysrCiAuLi4vdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3Qu
YyAgfCAgOTggKysrKysrKysrKysrCiB2aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYyAgICAg
ICAgICAgICAgICAgfCAgMzggKysrKy0KIHZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQu
aCAgICAgICAgICAgICB8ICAgNCArCiB2aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMg
ICAgICAgICAgICAgfCAxNDkgKysrKysrKysrKysrKysrKystCiA2IGZpbGVzIGNoYW5nZWQsIDM5
NSBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRp
b24vdmlydC9rdm0va3ZtaS5yc3QgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0Cmlu
ZGV4IDJlZTM3YzAzNTg1YS4uZWZkZTRiNzcxNTg2IDEwMDY0NAotLS0gYS9Eb2N1bWVudGF0aW9u
L3ZpcnQva3ZtL2t2bWkucnN0CisrKyBiL0RvY3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QK
QEAgLTY1LDYgKzY1LDg1IEBAIHVzZWQgb24gdGhhdCBndWVzdC4gT2J2aW91c2x5LCB3aGV0aGVy
IHRoZSBndWVzdCBjYW4gcmVhbGx5IGNvbnRpbnVlCiBub3JtYWwgZXhlY3V0aW9uIGRlcGVuZHMg
b24gd2hldGhlciB0aGUgaW50cm9zcGVjdGlvbiB0b29sIGhhcyBtYWRlIGFueQogbW9kaWZpY2F0
aW9ucyB0aGF0IHJlcXVpcmUgYW4gYWN0aXZlIEtWTUkgY2hhbm5lbC4KIAorQWxsIG1lc3NhZ2Vz
IChjb21tYW5kcyBvciBldmVudHMpIGhhdmUgYSBjb21tb24gaGVhZGVyOjoKKworCXN0cnVjdCBr
dm1pX21zZ19oZHIgeworCQlfX3UxNiBpZDsKKwkJX191MTYgc2l6ZTsKKwkJX191MzIgc2VxOwor
CX07CisKK1RoZSByZXBsaWVzIGhhdmUgdGhlIHNhbWUgaGVhZGVyLCB3aXRoIHRoZSBzZXF1ZW5j
ZSBudW1iZXIgKGBgc2VxYGApCithbmQgbWVzc2FnZSBpZCAoYGBpZGBgKSBtYXRjaGluZyB0aGUg
Y29tbWFuZC9ldmVudC4KKworQWZ0ZXIgYGBrdm1pX21zZ19oZHJgYCwgYGBpZGBgIHNwZWNpZmlj
IGRhdGEgb2YgYGBzaXplYGAgYnl0ZXMgd2lsbAorZm9sbG93LgorCitUaGUgbWVzc2FnZSBoZWFk
ZXIgYW5kIGl0cyBkYXRhIG11c3QgYmUgc2VudCB3aXRoIG9uZSBgYHNlbmRtc2coKWBgIGNhbGwK
K3RvIHRoZSBzb2NrZXQuIFRoaXMgc2ltcGxpZmllcyB0aGUgcmVjZWl2ZXIgbG9vcCBhbmQgYXZv
aWRzCit0aGUgcmVjb25zdHJ1Y3Rpb24gb2YgbWVzc2FnZXMgb24gdGhlIG90aGVyIHNpZGUuCisK
K1RoZSB3aXJlIHByb3RvY29sIHVzZXMgdGhlIGhvc3QgbmF0aXZlIGJ5dGUtb3JkZXIuIFRoZSBp
bnRyb3NwZWN0aW9uIHRvb2wKK211c3QgY2hlY2sgdGhpcyBkdXJpbmcgdGhlIGhhbmRzaGFrZSBh
bmQgZG8gdGhlIG5lY2Vzc2FyeSBjb252ZXJzaW9uLgorCitBIGNvbW1hbmQgcmVwbHkgYmVnaW5z
IHdpdGg6OgorCisJc3RydWN0IGt2bWlfZXJyb3JfY29kZSB7CisJCV9fczMyIGVycjsKKwkJX191
MzIgcGFkZGluZzsKKwl9CisKK2ZvbGxvd2VkIGJ5IHRoZSBjb21tYW5kIHNwZWNpZmljIGRhdGEg
aWYgdGhlIGVycm9yIGNvZGUgYGBlcnJgYCBpcyB6ZXJvLgorCitUaGUgZXJyb3IgY29kZSAtS1ZN
X0VOT1NZUyBpcyByZXR1cm5lZCBmb3IgdW5zdXBwb3J0ZWQgY29tbWFuZHMuCisKK1RoZSBlcnJv
ciBjb2RlIC1LVk1fRVBFUk0gaXMgcmV0dXJuZWQgZm9yIGRpc2FsbG93ZWQgY29tbWFuZHMgKHNl
ZSAqKkhvb2tpbmcqKikuCisKK1RoZSBlcnJvciBjb2RlIGlzIHJlbGF0ZWQgdG8gdGhlIG1lc3Nh
Z2UgcHJvY2Vzc2luZywgaW5jbHVkaW5nIHVuc3VwcG9ydGVkCitjb21tYW5kcy4gRm9yIGFsbCB0
aGUgb3RoZXIgZXJyb3JzIChpbmNvbXBsZXRlIG1lc3NhZ2VzLCB3cm9uZyBzZXF1ZW5jZQorbnVt
YmVycywgc29ja2V0IGVycm9ycyBldGMuKSB0aGUgc29ja2V0IHdpbGwgYmUgY2xvc2VkLiBUaGUg
ZGV2aWNlCittYW5hZ2VyIHNob3VsZCByZWNvbm5lY3QuCisKK1doaWxlIGFsbCBjb21tYW5kcyB3
aWxsIGhhdmUgYSByZXBseSBhcyBzb29uIGFzIHBvc3NpYmxlLCB0aGUgcmVwbGllcwordG8gZXZl
bnRzIHdpbGwgcHJvYmFibHkgYmUgZGVsYXllZCB1bnRpbCBhIHNldCBvZiAobmV3KSBjb21tYW5k
cyB3aWxsCitjb21wbGV0ZTo6CisKKyAgIEhvc3Qga2VybmVsICAgICAgICAgICAgICAgVG9vbAor
ICAgLS0tLS0tLS0tLS0gICAgICAgICAgICAgICAtLS0tCisgICBldmVudCAxIC0+CisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIDwtIGNvbW1hbmQgMQorICAgY29tbWFuZCAxIHJlcGx5IC0+
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwtIGNvbW1hbmQgMgorICAgY29tbWFuZCAy
IHJlcGx5IC0+CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwtIGV2ZW50IDEgcmVwbHkK
KworSWYgYm90aCBlbmRzIHNlbmQgYSBtZXNzYWdlIGF0IHRoZSBzYW1lIHRpbWU6OgorCisgICBI
b3N0IGtlcm5lbCAgICAgICAgICAgICAgIFRvb2wKKyAgIC0tLS0tLS0tLS0tICAgICAgICAgICAg
ICAgLS0tLQorICAgZXZlbnQgWCAtPiAgICAgICAgICAgICAgICA8LSBjb21tYW5kIFgKKwordGhl
IGhvc3Qga2VybmVsIHdpbGwgcmVwbHkgdG8gJ2NvbW1hbmQgWCcsIHJlZ2FyZGxlc3Mgb2YgdGhl
IHJlY2VpdmUgdGltZQorKGJlZm9yZSBvciBhZnRlciB0aGUgJ2V2ZW50IFgnIHdhcyBzZW50KS4K
KworQXMgaXQgY2FuIGJlIHNlZW4gYmVsb3csIHRoZSB3aXJlIHByb3RvY29sIHNwZWNpZmllcyBv
Y2Nhc2lvbmFsIHBhZGRpbmcuIFRoaXMKK2lzIHRvIHBlcm1pdCB3b3JraW5nIHdpdGggdGhlIGRh
dGEgYnkgZGlyZWN0bHkgdXNpbmcgQyBzdHJ1Y3R1cmVzIG9yIHRvIHJvdW5kCit0aGUgc3RydWN0
dXJlIHNpemUgdG8gYSBtdWx0aXBsZSBvZiA4IGJ5dGVzICg2NGJpdCkgdG8gaW1wcm92ZSB0aGUg
Y29weQorb3BlcmF0aW9ucyB0aGF0IGhhcHBlbiBkdXJpbmcgYGByZWN2bXNnKClgYCBvciBgYHNl
bmRtc2coKWBgLiBUaGUgbWVtYmVycworc2hvdWxkIGhhdmUgdGhlIG5hdGl2ZSBhbGlnbm1lbnQg
b2YgdGhlIGhvc3QgKDQgYnl0ZXMgb24geDg2KS4gQWxsIHBhZGRpbmcKK211c3QgYmUgaW5pdGlh
bGl6ZWQgd2l0aCB6ZXJvIG90aGVyd2lzZSB0aGUgcmVzcGVjdGl2ZSBjb21tYW5kcyB3aWxsIGZh
aWwKK3dpdGggLUtWTV9FSU5WQUwuCisKK1RvIGRlc2NyaWJlIHRoZSBjb21tYW5kcy9ldmVudHMs
IHdlIHJldXNlIHNvbWUgY29udmVudGlvbnMgZnJvbSBhcGkudHh0OgorCisgIC0gQXJjaGl0ZWN0
dXJlczogd2hpY2ggaW5zdHJ1Y3Rpb24gc2V0IGFyY2hpdGVjdHVyZXMgcHJvdmlkZSB0aGlzIGNv
bW1hbmQvZXZlbnQKKworICAtIFZlcnNpb25zOiB3aGljaCB2ZXJzaW9ucyBwcm92aWRlIHRoaXMg
Y29tbWFuZC9ldmVudAorCisgIC0gUGFyYW1ldGVyczogaW5jb21pbmcgbWVzc2FnZSBkYXRhCisK
KyAgLSBSZXR1cm5zOiBvdXRnb2luZy9yZXBseSBtZXNzYWdlIGRhdGEKKwogSGFuZHNoYWtlCiAt
LS0tLS0tLS0KIApAQCAtOTksNiArMTc4LDEzIEBAIEluIHRoZSBlbmQsIHRoZSBkZXZpY2UgbWFu
YWdlciB3aWxsIHBhc3MgdGhlIGZpbGUgaGFuZGxlIChwbHVzIHRoZSBhbGxvd2VkCiBjb21tYW5k
cy9ldmVudHMpIHRvIEtWTS4gSXQgd2lsbCBkZXRlY3Qgd2hlbiB0aGUgc29ja2V0IGlzIHNodXRk
b3duCiBhbmQgaXQgd2lsbCByZWluaXRpYXRlIHRoZSBoYW5kc2hha2UuCiAKK09uY2UgdGhlIGZp
bGUgaGFuZGxlIHJlYWNoZXMgS1ZNLCB0aGUgaW50cm9zcGVjdGlvbiB0b29sIHNob3VsZAordXNl
IHRoZSAqS1ZNSV9HRVRfVkVSU0lPTiogY29tbWFuZCB0byBnZXQgdGhlIEFQSSB2ZXJzaW9uIGFu
ZC9vciB0aGUKKypLVk1JX1ZNX0NIRUNLX0NPTU1BTkQqIGFuZCAqS1ZNSV9WTV9DSEVDS19FVkVO
VCogY29tbWFuZHMgdG8gc2VlIHdoaWNoCitjb21tYW5kcy9ldmVudHMgYXJlIGFsbG93ZWQgZm9y
IHRoaXMgZ3Vlc3QuIFRoZSBlcnJvciBjb2RlIC1LVk1fRVBFUk0KK3dpbGwgYmUgcmV0dXJuZWQg
aWYgdGhlIGludHJvc3BlY3Rpb24gdG9vbCB1c2VzIGEgY29tbWFuZCBvciBlbmFibGVzIGFuCitl
dmVudCB3aGljaCBpcyBkaXNhbGxvd2VkLgorCiBVbmhvb2tpbmcKIC0tLS0tLS0tLQogCmRpZmYg
LS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2
bWkuaAppbmRleCBkN2IxOGZmZWY0ZmEuLjZmZGFhOTIzOTNhNCAxMDA2NDQKLS0tIGEvaW5jbHVk
ZS91YXBpL2xpbnV4L2t2bWkuaAorKysgYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCkBAIC0x
OCw0ICsxOCwyNiBAQCBlbnVtIHsKIAlLVk1JX05VTV9FVkVOVFMKIH07CiAKK3N0cnVjdCBrdm1p
X21zZ19oZHIgeworCV9fdTE2IGlkOworCV9fdTE2IHNpemU7CisJX191MzIgc2VxOworfTsKKwor
LyoKKyAqIGt2bWlfbXNnX2hkci5zaXplIGlzIGxpbWl0ZWQgdG8gS1ZNSV9NU0dfU0laRS4KKyAq
IFRoZSBrZXJuZWwgc2lkZSB3aWxsIGNsb3NlIHRoZSBzb2NrZXQgaWYgdXNlcnNwYWNlCisgKiB1
c2VzIGEgYmlnZ2VyIHZhbHVlLgorICogVGhpcyBsaW1pdCBpcyB1c2VkIHRvIGFjY29tbW9kYXRl
IHRoZSBiaWdnZXN0IGtub3duIG1lc3NhZ2UsCisgKiB0aGUgY29tbWFuZHMgdG8gcmVhZC93cml0
ZSBhIDRLIHBhZ2UgZnJvbS90byBndWVzdCBtZW1vcnkuCisgKi8KK2VudW0geworCUtWTUlfTVNH
X1NJWkUgPSAoNDA5NiAqIDIgLSBzaXplb2Yoc3RydWN0IGt2bWlfbXNnX2hkcikpCit9OworCitz
dHJ1Y3Qga3ZtaV9lcnJvcl9jb2RlIHsKKwlfX3MzMiBlcnI7CisJX191MzIgcGFkZGluZzsKK307
CisKICNlbmRpZiAvKiBfVUFQSV9fTElOVVhfS1ZNSV9IICovCmRpZmYgLS1naXQgYS90b29scy90
ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9z
ZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYwppbmRleCBkMWQwMmUwNjczOTMuLjRjMWZl
NjdjOGUzNSAxMDA2NDQKLS0tIGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9r
dm1pX3Rlc3QuYworKysgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlf
dGVzdC5jCkBAIC0xNSw2ICsxNSw3IEBACiAjaW5jbHVkZSAicHJvY2Vzc29yLmgiCiAjaW5jbHVk
ZSAiLi4vbGliL2t2bV91dGlsX2ludGVybmFsLmgiCiAKKyNpbmNsdWRlICJsaW51eC9rdm1fcGFy
YS5oIgogI2luY2x1ZGUgImxpbnV4L2t2bWkuaCIKIAogI2RlZmluZSBWQ1BVX0lEICAgICAgICAg
NQpAQCAtODIsMTAgKzgzLDEwNyBAQCBzdGF0aWMgdm9pZCB1bmhvb2tfaW50cm9zcGVjdGlvbihz
dHJ1Y3Qga3ZtX3ZtICp2bSkKIAkJZXJybm8sIHN0cmVycm9yKGVycm5vKSk7CiB9CiAKK3N0YXRp
YyB2b2lkIHJlY2VpdmVfZGF0YSh2b2lkICpkZXN0LCBzaXplX3Qgc2l6ZSkKK3sKKwlzc2l6ZV90
IHI7CisKKwlyID0gcmVjdihVc2Vyc3BhY2Vfc29ja2V0LCBkZXN0LCBzaXplLCBNU0dfV0FJVEFM
TCk7CisJVEVTVF9BU1NFUlQociA9PSBzaXplLAorCQkicmVjdigpIGZhaWxlZCwgZXhwZWN0ZWQg
JWQsIHJlc3VsdCAlZCwgZXJybm8gJWQgKCVzKVxuIiwKKwkJc2l6ZSwgciwgZXJybm8sIHN0cmVy
cm9yKGVycm5vKSk7Cit9CisKK3N0YXRpYyBpbnQgcmVjZWl2ZV9jbWRfcmVwbHkoc3RydWN0IGt2
bWlfbXNnX2hkciAqcmVxLCB2b2lkICpycGwsCisJCQkgICAgIHNpemVfdCBycGxfc2l6ZSkKK3sK
KwlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwlzdHJ1Y3Qga3ZtaV9lcnJvcl9jb2RlIGVjOwor
CisJcmVjZWl2ZV9kYXRhKCZoZHIsIHNpemVvZihoZHIpKTsKKworCVRFU1RfQVNTRVJUKGhkci5z
ZXEgPT0gcmVxLT5zZXEsCisJCSJVbmV4cGVjdGVkIG1lc3NhZ2VzIHNlcXVlbmNlIDB4JXgsIGV4
cGVjdGVkIDB4JXhcbiIsCisJCWhkci5zZXEsIHJlcS0+c2VxKTsKKworCVRFU1RfQVNTRVJUKGhk
ci5zaXplID49IHNpemVvZihlYyksCisJCSJJbnZhbGlkIG1lc3NhZ2Ugc2l6ZSAlZCwgZXhwZWN0
ZWQgJWQgYnl0ZXMgKGF0IGxlYXN0KVxuIiwKKwkJaGRyLnNpemUsIHNpemVvZihlYykpOworCisJ
cmVjZWl2ZV9kYXRhKCZlYywgc2l6ZW9mKGVjKSk7CisKKwlpZiAoZWMuZXJyKSB7CisJCVRFU1Rf
QVNTRVJUKGhkci5zaXplID09IHNpemVvZihlYyksCisJCQkiSW52YWxpZCBjb21tYW5kIHJlcGx5
IG9uIGVycm9yXG4iKTsKKwl9IGVsc2UgeworCQlURVNUX0FTU0VSVChoZHIuc2l6ZSA9PSBzaXpl
b2YoZWMpICsgcnBsX3NpemUsCisJCQkiSW52YWxpZCBjb21tYW5kIHJlcGx5XG4iKTsKKworCQlp
ZiAocnBsICYmIHJwbF9zaXplKQorCQkJcmVjZWl2ZV9kYXRhKHJwbCwgcnBsX3NpemUpOworCX0K
KworCXJldHVybiBlYy5lcnI7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQgbmV3X3NlcSh2b2lk
KQoreworCXN0YXRpYyB1bnNpZ25lZCBpbnQgc2VxOworCisJcmV0dXJuIHNlcSsrOworfQorCitz
dGF0aWMgdm9pZCBzZW5kX21lc3NhZ2UoaW50IG1zZ19pZCwgc3RydWN0IGt2bWlfbXNnX2hkciAq
aGRyLCBzaXplX3Qgc2l6ZSkKK3sKKwlzc2l6ZV90IHI7CisKKwloZHItPmlkID0gbXNnX2lkOwor
CWhkci0+c2VxID0gbmV3X3NlcSgpOworCWhkci0+c2l6ZSA9IHNpemUgLSBzaXplb2YoKmhkcik7
CisKKwlyID0gc2VuZChVc2Vyc3BhY2Vfc29ja2V0LCBoZHIsIHNpemUsIDApOworCVRFU1RfQVNT
RVJUKHIgPT0gc2l6ZSwKKwkJInNlbmQoKSBmYWlsZWQsIHNlbmRpbmcgJWQsIHJlc3VsdCAlZCwg
ZXJybm8gJWQgKCVzKVxuIiwKKwkJc2l6ZSwgciwgZXJybm8sIHN0cmVycm9yKGVycm5vKSk7Cit9
CisKK3N0YXRpYyBjb25zdCBjaGFyICprdm1fc3RyZXJyb3IoaW50IGVycm9yKQoreworCXN3aXRj
aCAoZXJyb3IpIHsKKwljYXNlIEtWTV9FTk9TWVM6CisJCXJldHVybiAiSW52YWxpZCBzeXN0ZW0g
Y2FsbCBudW1iZXIiOworCWNhc2UgS1ZNX0VPUE5PVFNVUFA6CisJCXJldHVybiAiT3BlcmF0aW9u
IG5vdCBzdXBwb3J0ZWQgb24gdHJhbnNwb3J0IGVuZHBvaW50IjsKKwlkZWZhdWx0OgorCQlyZXR1
cm4gc3RyZXJyb3IoZXJyb3IpOworCX0KK30KKworc3RhdGljIGludCBkb19jb21tYW5kKGludCBj
bWRfaWQsIHN0cnVjdCBrdm1pX21zZ19oZHIgKnJlcSwKKwkJICAgICAgc2l6ZV90IHJlcV9zaXpl
LCB2b2lkICpycGwsIHNpemVfdCBycGxfc2l6ZSkKK3sKKwlzZW5kX21lc3NhZ2UoY21kX2lkLCBy
ZXEsIHJlcV9zaXplKTsKKwlyZXR1cm4gcmVjZWl2ZV9jbWRfcmVwbHkocmVxLCBycGwsIHJwbF9z
aXplKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9jbWRfaW52YWxpZCh2b2lkKQoreworCWludCBp
bnZhbGlkX21zZ19pZCA9IDB4ZmZmZjsKKwlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIHJlcTsKKwlpbnQg
cjsKKworCXIgPSBkb19jb21tYW5kKGludmFsaWRfbXNnX2lkLCAmcmVxLCBzaXplb2YocmVxKSwg
TlVMTCwgMCk7CisJVEVTVF9BU1NFUlQociA9PSAtS1ZNX0VOT1NZUywKKwkJIkludmFsaWQgY29t
bWFuZCBkaWRuJ3QgZmFpbGVkIHdpdGggS1ZNX0VOT1NZUywgZXJyb3IgJWQgKCVzKVxuIiwKKwkJ
LXIsIGt2bV9zdHJlcnJvcigtcikpOworfQorCiBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rp
b24oc3RydWN0IGt2bV92bSAqdm0pCiB7CiAJc2V0dXBfc29ja2V0KCk7CiAJaG9va19pbnRyb3Nw
ZWN0aW9uKHZtKTsKKworCXRlc3RfY21kX2ludmFsaWQoKTsKKwogCXVuaG9va19pbnRyb3NwZWN0
aW9uKHZtKTsKIH0KIApkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMg
Yi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwppbmRleCA5NWIwOGE0MGQ4MTQuLjg4ZDI5
NDA4ZmJmMSAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKKysrIGIv
dmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKQEAgLTgsMTMgKzgsNDkgQEAKICNpbmNsdWRl
ICJrdm1pX2ludC5oIgogI2luY2x1ZGUgPGxpbnV4L2t0aHJlYWQuaD4KIAorI2RlZmluZSBLVk1J
X01TR19TSVpFX0FMTE9DIChzaXplb2Yoc3RydWN0IGt2bWlfbXNnX2hkcikgKyBLVk1JX01TR19T
SVpFKQorCitzdGF0aWMgc3RydWN0IGttZW1fY2FjaGUgKm1zZ19jYWNoZTsKKwordm9pZCAqa3Zt
aV9tc2dfYWxsb2Modm9pZCkKK3sKKwlyZXR1cm4ga21lbV9jYWNoZV96YWxsb2MobXNnX2NhY2hl
LCBHRlBfS0VSTkVMKTsKK30KKwordm9pZCBrdm1pX21zZ19mcmVlKHZvaWQgKmFkZHIpCit7CisJ
aWYgKGFkZHIpCisJCWttZW1fY2FjaGVfZnJlZShtc2dfY2FjaGUsIGFkZHIpOworfQorCitzdGF0
aWMgdm9pZCBrdm1pX2NhY2hlX2Rlc3Ryb3kodm9pZCkKK3sKKwlrbWVtX2NhY2hlX2Rlc3Ryb3ko
bXNnX2NhY2hlKTsKKwltc2dfY2FjaGUgPSBOVUxMOworfQorCitzdGF0aWMgaW50IGt2bWlfY2Fj
aGVfY3JlYXRlKHZvaWQpCit7CisJbXNnX2NhY2hlID0ga21lbV9jYWNoZV9jcmVhdGUoImt2bWlf
bXNnIiwgS1ZNSV9NU0dfU0laRV9BTExPQywKKwkJCQkgICAgICA0MDk2LCBTTEFCX0FDQ09VTlQs
IE5VTEwpOworCisJaWYgKCFtc2dfY2FjaGUpIHsKKwkJa3ZtaV9jYWNoZV9kZXN0cm95KCk7CisK
KwkJcmV0dXJuIC0xOworCX0KKworCXJldHVybiAwOworfQorCiBpbnQga3ZtaV9pbml0KHZvaWQp
CiB7Ci0JcmV0dXJuIDA7CisJcmV0dXJuIGt2bWlfY2FjaGVfY3JlYXRlKCk7CiB9CiAKIHZvaWQg
a3ZtaV91bmluaXQodm9pZCkKIHsKKwlrdm1pX2NhY2hlX2Rlc3Ryb3koKTsKIH0KIAogc3RhdGlj
IHZvaWQgZnJlZV9rdm1pKHN0cnVjdCBrdm0gKmt2bSkKZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2lu
dHJvc3BlY3Rpb24va3ZtaV9pbnQuaCBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQu
aAppbmRleCAxYzljYzE1YWI0ZDkuLjM2ZjVlNTA0ZTc5MSAxMDA2NDQKLS0tIGEvdmlydC9rdm0v
aW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCisrKyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3Zt
aV9pbnQuaApAQCAtMjQsNCArMjQsOCBAQCB2b2lkIGt2bWlfc29ja19zaHV0ZG93bihzdHJ1Y3Qg
a3ZtX2ludHJvc3BlY3Rpb24gKmt2bWkpOwogdm9pZCBrdm1pX3NvY2tfcHV0KHN0cnVjdCBrdm1f
aW50cm9zcGVjdGlvbiAqa3ZtaSk7CiBib29sIGt2bWlfbXNnX3Byb2Nlc3Moc3RydWN0IGt2bV9p
bnRyb3NwZWN0aW9uICprdm1pKTsKIAorLyoga3ZtaS5jICovCit2b2lkICprdm1pX21zZ19hbGxv
Yyh2b2lkKTsKK3ZvaWQga3ZtaV9tc2dfZnJlZSh2b2lkICphZGRyKTsKKwogI2VuZGlmCmRpZmYg
LS1naXQgYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMgYi92aXJ0L2t2bS9pbnRy
b3NwZWN0aW9uL2t2bWlfbXNnLmMKaW5kZXggZjllNjYyNzRmYjQzLi4wMmZjNWQ5NWZlZjYgMTAw
NjQ0Ci0tLSBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYworKysgYi92aXJ0L2t2
bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMKQEAgLTMzLDcgKzMzLDE1NCBAQCB2b2lkIGt2bWlf
c29ja19zaHV0ZG93bihzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWkpCiAJa2VybmVsX3Nv
Y2tfc2h1dGRvd24oa3ZtaS0+c29jaywgU0hVVF9SRFdSKTsKIH0KIAorc3RhdGljIGludCBrdm1p
X3NvY2tfcmVhZChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksIHZvaWQgKmJ1ZiwKKwkJ
CSAgc2l6ZV90IHNpemUpCit7CisJc3RydWN0IGt2ZWMgaSA9IHsKKwkJLmlvdl9iYXNlID0gYnVm
LAorCQkuaW92X2xlbiA9IHNpemUsCisJfTsKKwlzdHJ1Y3QgbXNnaGRyIG0gPSB7IH07CisJaW50
IHJjOworCisJcmMgPSBrZXJuZWxfcmVjdm1zZyhrdm1pLT5zb2NrLCAmbSwgJmksIDEsIHNpemUs
IE1TR19XQUlUQUxMKTsKKworCWlmICh1bmxpa2VseShyYyAhPSBzaXplICYmIHJjID49IDApKQor
CQlyYyA9IC1FUElQRTsKKworCXJldHVybiByYyA+PSAwID8gMCA6IHJjOworfQorCitzdGF0aWMg
aW50IGt2bWlfc29ja193cml0ZShzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksIHN0cnVj
dCBrdmVjICppLAorCQkJICAgc2l6ZV90IG4sIHNpemVfdCBzaXplKQoreworCXN0cnVjdCBtc2do
ZHIgbSA9IHsgfTsKKwlpbnQgcmM7CisKKwlyYyA9IGtlcm5lbF9zZW5kbXNnKGt2bWktPnNvY2ss
ICZtLCBpLCBuLCBzaXplKTsKKworCWlmICh1bmxpa2VseShyYyAhPSBzaXplICYmIHJjID49IDAp
KQorCQlyYyA9IC1FUElQRTsKKworCXJldHVybiByYyA+PSAwID8gMCA6IHJjOworfQorCitzdGF0
aWMgaW50IGt2bWlfbXNnX3JlcGx5KHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSwKKwkJ
CSAgY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAqbXNnLCBpbnQgZXJyLAorCQkJICBjb25zdCB2
b2lkICpycGwsIHNpemVfdCBycGxfc2l6ZSkKK3sKKwlzdHJ1Y3Qga3ZtaV9lcnJvcl9jb2RlIGVj
OworCXN0cnVjdCBrdm1pX21zZ19oZHIgaDsKKwlzdHJ1Y3Qga3ZlYyB2ZWNbM10gPSB7CisJCXsg
Lmlvdl9iYXNlID0gJmgsIC5pb3ZfbGVuID0gc2l6ZW9mKGgpIH0sCisJCXsgLmlvdl9iYXNlID0g
JmVjLCAuaW92X2xlbiA9IHNpemVvZihlYykgfSwKKwkJeyAuaW92X2Jhc2UgPSAodm9pZCAqKXJw
bCwgLmlvdl9sZW4gPSBycGxfc2l6ZSB9LAorCX07CisJc2l6ZV90IHNpemUgPSBzaXplb2YoaCkg
KyBzaXplb2YoZWMpICsgKGVyciA/IDAgOiBycGxfc2l6ZSk7CisJc2l6ZV90IG4gPSBlcnIgPyBB
UlJBWV9TSVpFKHZlYykgLSAxIDogQVJSQVlfU0laRSh2ZWMpOworCisJbWVtc2V0KCZoLCAwLCBz
aXplb2YoaCkpOworCWguaWQgPSBtc2ctPmlkOworCWguc2VxID0gbXNnLT5zZXE7CisJaC5zaXpl
ID0gc2l6ZSAtIHNpemVvZihoKTsKKworCW1lbXNldCgmZWMsIDAsIHNpemVvZihlYykpOworCWVj
LmVyciA9IGVycjsKKworCXJldHVybiBrdm1pX3NvY2tfd3JpdGUoa3ZtaSwgdmVjLCBuLCBzaXpl
KTsKK30KKworc3RhdGljIGludCBrdm1pX21zZ192bV9yZXBseShzdHJ1Y3Qga3ZtX2ludHJvc3Bl
Y3Rpb24gKmt2bWksCisJCQkgICAgIGNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZywKKwkJ
CSAgICAgaW50IGVyciwgY29uc3Qgdm9pZCAqcnBsLAorCQkJICAgICBzaXplX3QgcnBsX3NpemUp
Cit7CisJcmV0dXJuIGt2bWlfbXNnX3JlcGx5KGt2bWksIG1zZywgZXJyLCBycGwsIHJwbF9zaXpl
KTsKK30KKworc3RhdGljIGJvb2wgaXNfY29tbWFuZF9hbGxvd2VkKHN0cnVjdCBrdm1faW50cm9z
cGVjdGlvbiAqa3ZtaSwgdTE2IGlkKQoreworCXJldHVybiBpZCA8IEtWTUlfTlVNX0NPTU1BTkRT
ICYmIHRlc3RfYml0KGlkLCBrdm1pLT5jbWRfYWxsb3dfbWFzayk7Cit9CisKKy8qCisgKiBUaGVz
ZSBjb21tYW5kcyBhcmUgZXhlY3V0ZWQgYnkgdGhlIHJlY2VpdmluZyB0aHJlYWQvd29ya2VyLgor
ICovCitzdGF0aWMgaW50KCpjb25zdCBtc2dfdm1bXSkoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9u
ICosCisJCQkgICAgY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAqLCBjb25zdCB2b2lkICopID0g
eworfTsKKworc3RhdGljIGJvb2wgaXNfdm1fY29tbWFuZCh1MTYgaWQpCit7CisJcmV0dXJuIGlk
IDwgQVJSQVlfU0laRShtc2dfdm0pICYmICEhbXNnX3ZtW2lkXTsKK30KKworc3RhdGljIHN0cnVj
dCBrdm1pX21zZ19oZHIgKmt2bWlfbXNnX3JlY3Yoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICpr
dm1pKQoreworCXN0cnVjdCBrdm1pX21zZ19oZHIgKm1zZzsKKwlpbnQgZXJyOworCisJbXNnID0g
a3ZtaV9tc2dfYWxsb2MoKTsKKwlpZiAoIW1zZykKKwkJZ290byBvdXRfZXJyOworCisJZXJyID0g
a3ZtaV9zb2NrX3JlYWQoa3ZtaSwgbXNnLCBzaXplb2YoKm1zZykpOworCWlmIChlcnIpCisJCWdv
dG8gb3V0X2VycjsKKworCWlmIChtc2ctPnNpemUpIHsKKwkJaWYgKG1zZy0+c2l6ZSA+IEtWTUlf
TVNHX1NJWkUpCisJCQlnb3RvIG91dF9lcnI7CisKKwkJZXJyID0ga3ZtaV9zb2NrX3JlYWQoa3Zt
aSwgbXNnICsgMSwgbXNnLT5zaXplKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gb3V0X2VycjsKKwl9
CisKKwlyZXR1cm4gbXNnOworCitvdXRfZXJyOgorCWt2bWlfbXNnX2ZyZWUobXNnKTsKKworCXJl
dHVybiBOVUxMOworfQorCitzdGF0aWMgaW50IGt2bWlfbXNnX2Rpc3BhdGNoX3ZtX2NtZChzdHJ1
Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksCisJCQkJICAgIGNvbnN0IHN0cnVjdCBrdm1pX21z
Z19oZHIgKm1zZykKK3sKKwlyZXR1cm4gbXNnX3ZtW21zZy0+aWRdKGt2bWksIG1zZywgbXNnICsg
MSk7Cit9CisKK3N0YXRpYyBib29sIGlzX21lc3NhZ2VfYWxsb3dlZChzdHJ1Y3Qga3ZtX2ludHJv
c3BlY3Rpb24gKmt2bWksIHUxNiBpZCkKK3sKKwlyZXR1cm4gaXNfY29tbWFuZF9hbGxvd2VkKGt2
bWksIGlkKTsKK30KKworc3RhdGljIGludCBrdm1pX21zZ192bV9yZXBseV9lYyhzdHJ1Y3Qga3Zt
X2ludHJvc3BlY3Rpb24gKmt2bWksCisJCQkJY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAqbXNn
LCBpbnQgZWMpCit7CisJcmV0dXJuIGt2bWlfbXNnX3ZtX3JlcGx5KGt2bWksIG1zZywgZWMsIE5V
TEwsIDApOworfQorCiBib29sIGt2bWlfbXNnX3Byb2Nlc3Moc3RydWN0IGt2bV9pbnRyb3NwZWN0
aW9uICprdm1pKQogewotCXJldHVybiBmYWxzZTsKKwlzdHJ1Y3Qga3ZtaV9tc2dfaGRyICptc2c7
CisJaW50IGVyciA9IC0xOworCisJbXNnID0ga3ZtaV9tc2dfcmVjdihrdm1pKTsKKwlpZiAoIW1z
ZykKKwkJZ290byBvdXQ7CisKKwlpZiAoaXNfdm1fY29tbWFuZChtc2ctPmlkKSkgeworCQlpZiAo
aXNfbWVzc2FnZV9hbGxvd2VkKGt2bWksIG1zZy0+aWQpKQorCQkJZXJyID0ga3ZtaV9tc2dfZGlz
cGF0Y2hfdm1fY21kKGt2bWksIG1zZyk7CisJCWVsc2UKKwkJCWVyciA9IGt2bWlfbXNnX3ZtX3Jl
cGx5X2VjKGt2bWksIG1zZywgLUtWTV9FUEVSTSk7CisJfSBlbHNlIHsKKwkJZXJyID0ga3ZtaV9t
c2dfdm1fcmVwbHlfZWMoa3ZtaSwgbXNnLCAtS1ZNX0VOT1NZUyk7CisJfQorCisJa3ZtaV9tc2df
ZnJlZShtc2cpOworb3V0OgorCXJldHVybiBlcnIgPT0gMDsKIH0KX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0
ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMu
bGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
