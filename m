Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
	by mail.lfdr.de (Postfix) with ESMTPS id DEE6B6AD7ED
	for <lists.virtualization@lfdr.de>; Tue,  7 Mar 2023 08:01:41 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id E84DD6066D;
	Tue,  7 Mar 2023 07:01:39 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org E84DD6066D
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id pzWhEuAl8SBL; Tue,  7 Mar 2023 07:01:39 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp3.osuosl.org (Postfix) with ESMTPS id 861CC607C1;
	Tue,  7 Mar 2023 07:01:38 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 861CC607C1
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id D734EC0089;
	Tue,  7 Mar 2023 07:01:37 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id ABA25C0032
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 07:01:35 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id 71E6881345
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 07:01:35 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 71E6881345
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id B6TsMkOkC2W2
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 07:01:34 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org EC08881340
Received: from out30-131.freemail.mail.aliyun.com
 (out30-131.freemail.mail.aliyun.com [115.124.30.131])
 by smtp1.osuosl.org (Postfix) with ESMTPS id EC08881340
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 07:01:33 +0000 (UTC)
X-Alimail-AntiSpam: AC=PASS; BC=-1|-1; BR=01201311R951e4; CH=green; DM=||false|;
 DS=||; FP=0|-1|-1|-1|0|-1|-1|-1; HT=ay29a033018045192;
 MF=xuanzhuo@linux.alibaba.com; NM=1; PH=DS; RN=3; SR=0;
 TI=SMTPD_---0VdKI8Um_1678172488; 
Received: from localhost(mailfrom:xuanzhuo@linux.alibaba.com
 fp:SMTPD_---0VdKI8Um_1678172488) by smtp.aliyun-inc.com;
 Tue, 07 Mar 2023 15:01:29 +0800
Message-ID: <1678172440.6047366-5-xuanzhuo@linux.alibaba.com>
Subject: Re: [PATCH vhost v1 05/12] virtio_ring: packed: refactor
 virtqueue_add_packed() for premapped
Date: Tue, 7 Mar 2023 15:00:40 +0800
From: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
To: Jason Wang <jasowang@redhat.com>
References: <20230302115908.1461-1-xuanzhuo@linux.alibaba.com>
 <20230302115908.1461-6-xuanzhuo@linux.alibaba.com>
 <CACGkMEuKotR=PXY_KvinLyZ0rK2eiL17u3TSP3XyR3G7kBBGqA@mail.gmail.com>
In-Reply-To: <CACGkMEuKotR=PXY_KvinLyZ0rK2eiL17u3TSP3XyR3G7kBBGqA@mail.gmail.com>
Cc: "Michael S. Tsirkin" <mst@redhat.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVHVlLCA3IE1hciAyMDIzIDE0OjQzOjQ5ICswODAwLCBKYXNvbiBXYW5nIDxqYXNvd2FuZ0By
ZWRoYXQuY29tPiB3cm90ZToKPiBPbiBUaHUsIE1hciAyLCAyMDIzIGF0IDc6NTnigK9QTSBYdWFu
IFpodW8gPHh1YW56aHVvQGxpbnV4LmFsaWJhYmEuY29tPiB3cm90ZToKPiA+Cj4gPiBUaGlzIGNv
bW1pdCBzcGxpdHMgdmlydHF1ZXVlX2FkZF9wYWNrZWQoKSB0byB0d28gZnVuY3Rpb25zLiBUaGUg
cHVycG9zZQo+ID4gb2Ygc3VjaCBzcGxpdHRpbmcgaXMgdG8gc2VwYXJhdGUgRE1BIG9wZXJhdGlv
bnMuCj4gPgo+ID4gVGhlIGZpcnN0IGZ1bmN0aW9uIGluY2x1ZGVzIGFsbCBjb2RlcyB0aGF0IG1h
eSBmYWlsIGJlZm9yZSB0aGUgRE1BCj4gPiBvcGVyYXRpb24uIFRoZSBzdWJzZXF1ZW50IHBhcnQg
aXMgdXNlZCBhcyB0aGUgc2Vjb25kIGZ1bmN0aW9uLgo+ID4KPiA+IEluIHRoaXMgd2F5LCB3ZSBj
YW4gcGVyZm9ybSBETUEgb3BlcmF0aW9ucyBpbiB0aGUgbWlkZGxlIG9mIHRoZSB0d28KPiA+IGZ1
bmN0aW9ucy4gSWYgdGhlIGZpcnN0IGZ1bmN0aW9uIGZhaWxzLCB3ZSBkbyBub3QgbmVlZCB0byBw
ZXJmb3JtIERNQQo+ID4gb3BlcmF0aW9ucy4gSWYgaXQgaXMgcHJlbWFwcGVkLCB3ZSBjYW4gcGFz
cyB0aGUgRE1BIG9wZXJhdGlvbi4KPiA+Cj4gPiBTaWduZWQtb2ZmLWJ5OiBYdWFuIFpodW8gPHh1
YW56aHVvQGxpbnV4LmFsaWJhYmEuY29tPgo+ID4gLS0tCj4gPiAgZHJpdmVycy92aXJ0aW8vdmly
dGlvX3JpbmcuYyB8IDEyMCArKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLQo+ID4g
IDEgZmlsZSBjaGFuZ2VkLCA4MSBpbnNlcnRpb25zKCspLCAzOSBkZWxldGlvbnMoLSkKPiA+Cj4g
PiBkaWZmIC0tZ2l0IGEvZHJpdmVycy92aXJ0aW8vdmlydGlvX3JpbmcuYyBiL2RyaXZlcnMvdmly
dGlvL3ZpcnRpb19yaW5nLmMKPiA+IGluZGV4IDE3OGVkZjExNzFlMi4uNjc5NmNiZWUwMjA3IDEw
MDY0NAo+ID4gLS0tIGEvZHJpdmVycy92aXJ0aW8vdmlydGlvX3JpbmcuYwo+ID4gKysrIGIvZHJp
dmVycy92aXJ0aW8vdmlydGlvX3JpbmcuYwo+ID4gQEAgLTEzNDcsNyArMTM0Nyw2IEBAIHN0YXRp
YyBpbnQgdmlydHF1ZXVlX2FkZF9pbmRpcmVjdF9wYWNrZWQoc3RydWN0IHZyaW5nX3ZpcnRxdWV1
ZSAqdnEsCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2ln
bmVkIGludCB0b3RhbF9zZywKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdW5zaWduZWQgaW50IG91dF9zZ3MsCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBpbl9zZ3MsCj4gPiAtICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmRhdGEsCj4gPiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2cmluZ19wYWNrZWRfZGVzYyAqZGVzYykK
PiA+ICB7Cj4gPiAgICAgICAgIHN0cnVjdCBzY2F0dGVybGlzdCAqc2c7Cj4gPiBAQCAtMTQyMiwx
NCArMTQyMSwxMiBAQCBzdGF0aWMgaW50IHZpcnRxdWV1ZV9hZGRfaW5kaXJlY3RfcGFja2VkKHN0
cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxLAo+ID4KPiA+ICAgICAgICAgLyogU3RvcmUgdG9rZW4g
YW5kIGluZGlyZWN0IGJ1ZmZlciBzdGF0ZS4gKi8KPiA+ICAgICAgICAgdnEtPnBhY2tlZC5kZXNj
X3N0YXRlW2lkXS5udW0gPSAxOwo+ID4gLSAgICAgICB2cS0+cGFja2VkLmRlc2Nfc3RhdGVbaWRd
LmRhdGEgPSBkYXRhOwo+ID4gICAgICAgICB2cS0+cGFja2VkLmRlc2Nfc3RhdGVbaWRdLmluZGly
X2Rlc2MgPSBkZXNjOwo+ID4gICAgICAgICB2cS0+cGFja2VkLmRlc2Nfc3RhdGVbaWRdLmxhc3Qg
PSBpZDsKPiA+Cj4gPiAgICAgICAgIHZxLT5udW1fYWRkZWQgKz0gMTsKPiA+Cj4gPiAgICAgICAg
IHByX2RlYnVnKCJBZGRlZCBidWZmZXIgaGVhZCAlaSB0byAlcFxuIiwgaGVhZCwgdnEpOwo+ID4g
LSAgICAgICBFTkRfVVNFKHZxKTsKPiA+Cj4gPiAgICAgICAgIHJldHVybiAwOwo+ID4KPiA+IEBA
IC0xNDQxLDc0ICsxNDM4LDc2IEBAIHN0YXRpYyBpbnQgdmlydHF1ZXVlX2FkZF9pbmRpcmVjdF9w
YWNrZWQoc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAqdnEsCj4gPgo+ID4gICAgICAgICBrZnJlZShk
ZXNjKTsKPiA+Cj4gPiAtICAgICAgIEVORF9VU0UodnEpOwo+ID4gICAgICAgICByZXR1cm4gLUVO
T01FTTsKPiA+ICB9Cj4gPgo+ID4gLXN0YXRpYyBpbmxpbmUgaW50IHZpcnRxdWV1ZV9hZGRfcGFj
a2VkKHN0cnVjdCB2aXJ0cXVldWUgKl92cSwKPiA+IC0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN0cnVjdCBzY2F0dGVybGlzdCAqc2dzW10sCj4gPiAtICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgdG90YWxfc2csCj4gPiAtICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgb3V0X3NncywK
PiA+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBp
bl9zZ3MsCj4gPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpk
YXRhLAo+ID4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqY3R4
LAo+ID4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2ZwX3QgZ2ZwKQo+
ID4gK3N0YXRpYyBpbmxpbmUgc3RydWN0IHZyaW5nX3BhY2tlZF9kZXNjICp2aXJ0cXVldWVfZ2V0
X2Rlc2NfcGFja2VkKHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxLAo+ID4gKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5z
aWduZWQgaW50IHRvdGFsX3NnLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGF0YSwKPiA+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZvaWQgKmN0eCwKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGdmcF90IGdmcCkKPiA+ICB7Cj4gPiAtICAgICAgIHN0
cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxID0gdG9fdnZxKF92cSk7Cj4gPiAgICAgICAgIHN0cnVj
dCB2cmluZ19wYWNrZWRfZGVzYyAqZGVzYzsKPiA+IC0gICAgICAgc3RydWN0IHNjYXR0ZXJsaXN0
ICpzZzsKPiA+IC0gICAgICAgdW5zaWduZWQgaW50IGksIG4sIGMsIGRlc2NzX3VzZWQsIGVycl9p
ZHg7Cj4gPiAtICAgICAgIF9fbGUxNiBoZWFkX2ZsYWdzLCBmbGFnczsKPiA+IC0gICAgICAgdTE2
IGhlYWQsIGlkLCBwcmV2LCBjdXJyLCBhdmFpbF91c2VkX2ZsYWdzOwo+ID4gLSAgICAgICBpbnQg
ZXJyOwo+ID4gLQo+ID4gLSAgICAgICBTVEFSVF9VU0UodnEpOwo+ID4gKyAgICAgICB1bnNpZ25l
ZCBpbnQgZGVzY3NfdXNlZDsKPiA+Cj4gPiAgICAgICAgIEJVR19PTihkYXRhID09IE5VTEwpOwo+
ID4gICAgICAgICBCVUdfT04oY3R4ICYmIHZxLT5pbmRpcmVjdCk7Cj4gPgo+ID4gLSAgICAgICBp
ZiAodW5saWtlbHkodnEtPmJyb2tlbikpIHsKPiA+IC0gICAgICAgICAgICAgICBFTkRfVVNFKHZx
KTsKPiA+IC0gICAgICAgICAgICAgICByZXR1cm4gLUVJTzsKPiA+IC0gICAgICAgfQo+ID4gKyAg
ICAgICBpZiAodW5saWtlbHkodnEtPmJyb2tlbikpCj4gPiArICAgICAgICAgICAgICAgcmV0dXJu
IEVSUl9QVFIoLUVJTyk7Cj4gPgo+ID4gICAgICAgICBMQVNUX0FERF9USU1FX1VQREFURSh2cSk7
Cj4gPgo+ID4gICAgICAgICBCVUdfT04odG90YWxfc2cgPT0gMCk7Cj4gPgo+ID4gKyAgICAgICBk
ZXNjID0gTlVMTDsKPiA+ICsKPiA+ICAgICAgICAgaWYgKHZpcnRxdWV1ZV91c2VfaW5kaXJlY3Qo
dnEsIHRvdGFsX3NnKSkgewo+ID4gICAgICAgICAgICAgICAgIGRlc2MgPSBhbGxvY19pbmRpcmVj
dF9wYWNrZWQodG90YWxfc2csIGdmcCk7Cj4gPiAgICAgICAgICAgICAgICAgaWYgKGRlc2MpIHsK
PiA+ICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bmxpa2VseSh2cS0+dnEubnVtX2ZyZWUg
PCAxKSkgewo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcl9kZWJ1ZygiQ2Fu
J3QgYWRkIGJ1ZiBsZW4gMSAtIGF2YWlsID0gMFxuIik7Cj4gPiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGtmcmVlKGRlc2MpOwo+ID4gLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBFTkRfVVNFKHZxKTsKPiA+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0
dXJuIC1FTk9TUEM7Cj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBF
UlJfUFRSKC1FTk9TUEMpOwo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgfQo+ID4KPiA+IC0g
ICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aXJ0cXVldWVfYWRkX2luZGlyZWN0X3BhY2tl
ZCh2cSwgc2dzLCB0b3RhbF9zZywgb3V0X3NncywKPiA+IC0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9zZ3MsIGRhdGEsIGRlc2Mp
Owo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7Cj4gPiAgICAgICAgICAg
ICAgICAgfQo+ID4KPiA+ICAgICAgICAgICAgICAgICAvKiBmYWxsIGJhY2sgb24gZGlyZWN0ICov
Cj4gPiAgICAgICAgIH0KPiA+Cj4gPiAtICAgICAgIGhlYWQgPSB2cS0+cGFja2VkLm5leHRfYXZh
aWxfaWR4Owo+ID4gLSAgICAgICBhdmFpbF91c2VkX2ZsYWdzID0gdnEtPnBhY2tlZC5hdmFpbF91
c2VkX2ZsYWdzOwo+ID4gLQo+ID4gICAgICAgICBXQVJOX09OX09OQ0UodG90YWxfc2cgPiB2cS0+
cGFja2VkLnZyaW5nLm51bSAmJiAhdnEtPmluZGlyZWN0KTsKPiA+Cj4gPiAtICAgICAgIGRlc2Mg
PSB2cS0+cGFja2VkLnZyaW5nLmRlc2M7Cj4gPiAtICAgICAgIGkgPSBoZWFkOwo+ID4gICAgICAg
ICBkZXNjc191c2VkID0gdG90YWxfc2c7Cj4gPgo+ID4gICAgICAgICBpZiAodW5saWtlbHkodnEt
PnZxLm51bV9mcmVlIDwgZGVzY3NfdXNlZCkpIHsKPiA+ICAgICAgICAgICAgICAgICBwcl9kZWJ1
ZygiQ2FuJ3QgYWRkIGJ1ZiBsZW4gJWkgLSBhdmFpbCA9ICVpXG4iLAo+ID4gICAgICAgICAgICAg
ICAgICAgICAgICAgIGRlc2NzX3VzZWQsIHZxLT52cS5udW1fZnJlZSk7Cj4gPiAtICAgICAgICAg
ICAgICAgRU5EX1VTRSh2cSk7Cj4gPiAtICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9TUEM7Cj4g
PiArICAgICAgICAgICAgICAgcmV0dXJuIEVSUl9QVFIoLUVOT1NQQyk7Cj4gPiAgICAgICAgIH0K
PiA+Cj4gPiArICAgICAgIHJldHVybiBkZXNjOwo+ID4gK30KPiA+ICsKPiA+ICtzdGF0aWMgaW5s
aW5lIGludCB2aXJ0cXVldWVfYWRkX3ZyaW5nX3BhY2tlZChzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVl
ICp2cSwKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0
cnVjdCBzY2F0dGVybGlzdCAqc2dzW10sCj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgdG90YWxfc2csCj4gPiArICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgb3V0X3NncywKPiA+
ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGlu
dCBpbl9zZ3MpCj4gPiArewo+ID4gKyAgICAgICBzdHJ1Y3QgdnJpbmdfcGFja2VkX2Rlc2MgKmRl
c2M7Cj4gPiArICAgICAgIHN0cnVjdCBzY2F0dGVybGlzdCAqc2c7Cj4gPiArICAgICAgIHVuc2ln
bmVkIGludCBpLCBuLCBjLCBkZXNjc191c2VkLCBlcnJfaWR4Owo+ID4gKyAgICAgICBfX2xlMTYg
aGVhZF9mbGFncywgZmxhZ3M7Cj4gPiArICAgICAgIHUxNiBoZWFkLCBpZCwgcHJldiwgY3Vyciwg
YXZhaWxfdXNlZF9mbGFnczsKPiA+ICsKPiA+ICsgICAgICAgZGVzYyA9IHZxLT5wYWNrZWQudnJp
bmcuZGVzYzsKPiA+ICsgICAgICAgaGVhZCA9IHZxLT5wYWNrZWQubmV4dF9hdmFpbF9pZHg7Cj4g
PiArICAgICAgIGkgPSBoZWFkOwo+ID4gKyAgICAgICBkZXNjc191c2VkID0gdG90YWxfc2c7Cj4g
PiArICAgICAgIGF2YWlsX3VzZWRfZmxhZ3MgPSB2cS0+cGFja2VkLmF2YWlsX3VzZWRfZmxhZ3M7
Cj4gPiArCj4gPiAgICAgICAgIGlkID0gdnEtPmZyZWVfaGVhZDsKPiA+ICAgICAgICAgQlVHX09O
KGlkID09IHZxLT5wYWNrZWQudnJpbmcubnVtKTsKPiA+Cj4gPiBAQCAtMTU2Myw4ICsxNTYyLDYg
QEAgc3RhdGljIGlubGluZSBpbnQgdmlydHF1ZXVlX2FkZF9wYWNrZWQoc3RydWN0IHZpcnRxdWV1
ZSAqX3ZxLAo+ID4KPiA+ICAgICAgICAgLyogU3RvcmUgdG9rZW4uICovCj4gPiAgICAgICAgIHZx
LT5wYWNrZWQuZGVzY19zdGF0ZVtpZF0ubnVtID0gZGVzY3NfdXNlZDsKPiA+IC0gICAgICAgdnEt
PnBhY2tlZC5kZXNjX3N0YXRlW2lkXS5kYXRhID0gZGF0YTsKPiA+IC0gICAgICAgdnEtPnBhY2tl
ZC5kZXNjX3N0YXRlW2lkXS5pbmRpcl9kZXNjID0gY3R4Owo+ID4gICAgICAgICB2cS0+cGFja2Vk
LmRlc2Nfc3RhdGVbaWRdLmxhc3QgPSBwcmV2Owo+ID4KPiA+ICAgICAgICAgLyoKPiA+IEBAIC0x
NTc3LDcgKzE1NzQsNiBAQCBzdGF0aWMgaW5saW5lIGludCB2aXJ0cXVldWVfYWRkX3BhY2tlZChz
dHJ1Y3QgdmlydHF1ZXVlICpfdnEsCj4gPiAgICAgICAgIHZxLT5udW1fYWRkZWQgKz0gZGVzY3Nf
dXNlZDsKPiA+Cj4gPiAgICAgICAgIHByX2RlYnVnKCJBZGRlZCBidWZmZXIgaGVhZCAlaSB0byAl
cFxuIiwgaGVhZCwgdnEpOwo+ID4gLSAgICAgICBFTkRfVVNFKHZxKTsKPiA+Cj4gPiAgICAgICAg
IHJldHVybiAwOwo+ID4KPiA+IEBAIC0xNTk4LDEwICsxNTk0LDU2IEBAIHN0YXRpYyBpbmxpbmUg
aW50IHZpcnRxdWV1ZV9hZGRfcGFja2VkKHN0cnVjdCB2aXJ0cXVldWUgKl92cSwKPiA+ICAgICAg
ICAgICAgICAgICAgICAgICAgIGkgPSAwOwo+ID4gICAgICAgICB9Cj4gPgo+ID4gLSAgICAgICBF
TkRfVVNFKHZxKTsKPiA+ICAgICAgICAgcmV0dXJuIC1FSU87Cj4gPiAgfQo+ID4KPiA+ICtzdGF0
aWMgaW5saW5lIGludCB2aXJ0cXVldWVfYWRkX3BhY2tlZChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEs
Cj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2NhdHRl
cmxpc3QgKnNnc1tdLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dW5zaWduZWQgaW50IHRvdGFsX3NnLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdW5zaWduZWQgaW50IG91dF9zZ3MsCj4gPiArICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgaW5fc2dzLAo+ID4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqZGF0YSwKPiA+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKmN0eCwKPiA+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGdmcF90IGdmcCkKPiA+ICt7Cj4gPiArCj4gPiArICAgICAgIHN0
cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxID0gdG9fdnZxKF92cSk7Cj4gPiArICAgICAgIHN0cnVj
dCB2cmluZ19wYWNrZWRfZGVzYyAqZGVzYzsKPiA+ICsgICAgICAgdTE2IGlkOwo+ID4gKyAgICAg
ICBpbnQgZXJyOwo+ID4gKwo+ID4gKyAgICAgICBTVEFSVF9VU0UodnEpOwo+ID4gKwo+ID4gKyAg
ICAgICAvKiBjaGVjayB2cSBzdGF0ZSBhbmQgdHJ5IHRvIGFsbG9jIGRlc2MgZm9yIGluZGlyZWN0
LiAqLwo+ID4gKyAgICAgICBkZXNjID0gdmlydHF1ZXVlX2dldF9kZXNjX3BhY2tlZCh2cSwgdG90
YWxfc2csIGRhdGEsIGN0eCwgZ2ZwKTsKPiA+ICsgICAgICAgaWYgKElTX0VSUihkZXNjKSkgewo+
ID4gKyAgICAgICAgICAgICAgIGVyciA9IFBUUl9FUlIoZGVzYyk7Cj4gPiArICAgICAgICAgICAg
ICAgZ290byBlbmQ7Cj4gPiArICAgICAgIH0KPiA+ICsKPiA+ICsgICAgICAgaWQgPSB2cS0+ZnJl
ZV9oZWFkOwo+ID4gKwo+ID4gKyAgICAgICBpZiAoZGVzYykgewo+ID4gKyAgICAgICAgICAgICAg
IGVyciA9IHZpcnRxdWV1ZV9hZGRfaW5kaXJlY3RfcGFja2VkKHZxLCBzZ3MsIHRvdGFsX3NnLCBv
dXRfc2dzLCBpbl9zZ3MsIGRlc2MpOwo+ID4gKyAgICAgICAgICAgICAgIGlmIChlcnIpCj4gPiAr
ICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGVycjsKPiA+ICsgICAgICAgfSBlbHNlIHsKPiA+
ICsgICAgICAgICAgICAgICB2aXJ0cXVldWVfYWRkX3ZyaW5nX3BhY2tlZCh2cSwgc2dzLCB0b3Rh
bF9zZywgb3V0X3NncywgaW5fc2dzKTsKPgo+IFdoaWxlIGF0IGl0LCBjYW4gd2UgdW5pZnkgdGhl
IGxvZ2ljIG9mIHZpcnRxdWV1ZV9hZGRfaW5kaXJlY3RfcGFja2VkKCkKPiBhbmQgdmlydHF1ZXVl
X2FkZF92cmluZ19wYWNrZWQoKT8KCgpJIGd1ZXNzLCB5b3UgbWVhbiB0byBtZXJnZSB0aGVzZSB0
d28gZnVuY3Rpb25zLCBJIHdpbGwgdHJ5IGl0LgoKCj4KPiA+ICsgICAgICAgICAgICAgICB2cS0+
cGFja2VkLmRlc2Nfc3RhdGVbaWRdLmluZGlyX2Rlc2MgPSBjdHg7Cj4gPiArICAgICAgIH0KPiA+
ICsKPiA+ICsgICAgICAgdnEtPnBhY2tlZC5kZXNjX3N0YXRlW2lkXS5kYXRhID0gZGF0YTsKPiA+
ICsKPiA+ICsgICAgICAgZ290byBlbmQ7Cj4KPiBTaW1pbGFyIHRvIHNwbGl0LCBJJ2QgcmF0aGVy
IGR1cGxpY2F0ZSB0aGUgRU5EX1VTRSgpIGFuZCByZXR1cm4uCgoKV2lsbCBmaXguCgpUaGFua3Mu
CgoKPgo+IFRoYW5rcwo+Cj4KPiA+ICsKPiA+ICtlcnI6Cj4gPiArICAgICAgIGtmcmVlKGRlc2Mp
Owo+ID4gKwo+ID4gK2VuZDoKPiA+ICsgICAgICAgRU5EX1VTRSh2cSk7Cj4gPiArICAgICAgIHJl
dHVybiBlcnI7Cj4gPiArfQo+ID4gKwo+ID4gIHN0YXRpYyBib29sIHZpcnRxdWV1ZV9raWNrX3By
ZXBhcmVfcGFja2VkKHN0cnVjdCB2aXJ0cXVldWUgKl92cSkKPiA+ICB7Cj4gPiAgICAgICAgIHN0
cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxID0gdG9fdnZxKF92cSk7Cj4gPiAtLQo+ID4gMi4zMi4w
LjMuZzAxMTk1Y2Y5Zgo+ID4KPgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QKVmlydHVhbGl6YXRpb25AbGlz
dHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5saW51eGZvdW5kYXRpb24ub3Jn
L21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
