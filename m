Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp1.osuosl.org (smtp1.osuosl.org [IPv6:2605:bc80:3010::138])
	by mail.lfdr.de (Postfix) with ESMTPS id 6C6984244AF
	for <lists.virtualization@lfdr.de>; Wed,  6 Oct 2021 19:41:01 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp1.osuosl.org (Postfix) with ESMTP id 00FD0840A5;
	Wed,  6 Oct 2021 17:40:56 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
	by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id OgoehOv3H3P5; Wed,  6 Oct 2021 17:40:54 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp1.osuosl.org (Postfix) with ESMTPS id A027F84085;
	Wed,  6 Oct 2021 17:40:53 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id D2395C002F;
	Wed,  6 Oct 2021 17:40:52 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 1A65BC002F
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:47 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id E93CB40885
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:44 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Iy25m9qM-Jkw
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:43 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.8.0
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by smtp2.osuosl.org (Postfix) with ESMTPS id DDD73407F1
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:40:42 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 C1109305D349; Wed,  6 Oct 2021 20:31:14 +0300 (EEST)
Received: from localhost (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id A321A300F712;
 Wed,  6 Oct 2021 20:31:14 +0300 (EEST)
X-Is-Junk-Enabled: fGZTSsP0qEJE2AIKtlSuFiRRwg9xyHmJ
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v12 50/77] KVM: introspection: add KVMI_VCPU_GET_REGISTERS
Date: Wed,  6 Oct 2021 20:30:46 +0300
Message-Id: <20211006173113.26445-51-alazar@bitdefender.com>
In-Reply-To: <20211006173113.26445-1-alazar@bitdefender.com>
References: <20211006173113.26445-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: Tamas K Lengyel <tamas@tklengyel.com>, Wanpeng Li <wanpengli@tencent.com>,
 Sean Christopherson <seanjc@google.com>, Joerg Roedel <joro@8bytes.org>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Mathieu Tarral <mathieu.tarral@protonmail.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 Jim Mattson <jmattson@google.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhpcyBjb21tYW5k
IGlzIHVzZWQgdG8gZ2V0IGt2bV9yZWdzIGFuZCBrdm1fc3JlZ3Mgc3RydWN0dXJlcywKcGx1cyBh
IGxpc3Qgb2Ygc3RydWN0IGt2bV9tc3JzIGZyb20gYSBzcGVjaWZpYyB2Q1BVLgoKV2hpbGUgdGhl
IGt2bV9yZWdzIGFuZCBrdm1fc3JlZ3Mgc3RydWN0dXJlcyBhcmUgaW5jbHVkZWQgd2l0aCBldmVy
eQpldmVudCwgdGhpcyBjb21tYW5kIGFsbG93cyByZWFkaW5nIGFueSBNU1IuCgpTaWduZWQtb2Zm
LWJ5OiBNaWhhaSBEb27Im3UgPG1kb250dUBiaXRkZWZlbmRlci5jb20+CkNvLWRldmVsb3BlZC1i
eTogQWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgpTaWduZWQtb2ZmLWJ5
OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogRG9jdW1lbnRh
dGlvbi92aXJ0L2t2bS9rdm1pLnJzdCAgICAgICAgICAgICAgIHwgNDQgKysrKysrKysrKysrCiBh
cmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaCAgICAgICAgICAgICAgfCAxNSArKysrCiBh
cmNoL3g4Ni9rdm0va3ZtaS5jICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAyNSArKysrKysr
CiBhcmNoL3g4Ni9rdm0va3ZtaS5oICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgOSArKysK
IGFyY2gveDg2L2t2bS9rdm1pX21zZy5jICAgICAgICAgICAgICAgICAgICAgICB8IDcyICsrKysr
KysrKysrKysrKysrKy0KIGluY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggICAgICAgICAgICAgICAg
ICAgICB8ICAxICsKIC4uLi90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5j
ICB8IDU5ICsrKysrKysrKysrKysrKwogNyBmaWxlcyBjaGFuZ2VkLCAyMjQgaW5zZXJ0aW9ucygr
KSwgMSBkZWxldGlvbigtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGFyY2gveDg2L2t2bS9rdm1pLmgK
CmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0IGIvRG9jdW1lbnRh
dGlvbi92aXJ0L2t2bS9rdm1pLnJzdAppbmRleCA4OTJiOTYwZDk3OGQuLjNhNzdjN2JlZjE4YSAx
MDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAorKysgYi9Eb2N1bWVu
dGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CkBAIC01NTcsNiArNTU3LDUwIEBAIHRoZSAqS1ZNSV9W
TV9DT05UUk9MX0VWRU5UUyogY29tbWFuZC4KICogLUtWTV9FUEVSTSAtIHRoZSBhY2Nlc3MgaXMg
ZGlzYWxsb3dlZCAodXNlICpLVk1JX1ZNX0NIRUNLX0VWRU5UKiBmaXJzdCkKICogLUtWTV9FQUdB
SU4gLSB0aGUgc2VsZWN0ZWQgdkNQVSBjYW4ndCBiZSBpbnRyb3NwZWN0ZWQgeWV0CiAKKzExLiBL
Vk1JX1ZDUFVfR0VUX1JFR0lTVEVSUworLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisKKzpB
cmNoaXRlY3R1cmVzOiB4ODYKKzpWZXJzaW9uczogPj0gMQorOlBhcmFtZXRlcnM6CisKKzo6CisK
KwlzdHJ1Y3Qga3ZtaV92Y3B1X2hkcjsKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9yZWdpc3RlcnMg
eworCQlfX3UxNiBubXNyczsKKwkJX191MTYgcGFkZGluZzE7CisJCV9fdTMyIHBhZGRpbmcyOwor
CQlfX3UzMiBtc3JzX2lkeFswXTsKKwl9OworCis6UmV0dXJuczoKKworOjoKKworCXN0cnVjdCBr
dm1pX2Vycm9yX2NvZGU7CisJc3RydWN0IGt2bWlfdmNwdV9nZXRfcmVnaXN0ZXJzX3JlcGx5IHsK
KwkJX191MzIgbW9kZTsKKwkJX191MzIgcGFkZGluZzsKKwkJc3RydWN0IGt2bV9yZWdzIHJlZ3M7
CisJCXN0cnVjdCBrdm1fc3JlZ3Mgc3JlZ3M7CisJCXN0cnVjdCBrdm1fbXNycyBtc3JzOworCX07
CisKK0ZvciB0aGUgZ2l2ZW4gdkNQVSBhbmQgdGhlIGBgbm1zcnNgYCBzaXplZCBhcnJheSBvZiBN
U1JzIHJlZ2lzdGVycywKK3JldHVybnMgdGhlIGN1cnJlbnQgdkNQVSBtb2RlIChpbiBieXRlczog
MiwgNCBvciA4KSwgdGhlIGdlbmVyYWwgcHVycG9zZQorcmVnaXN0ZXJzLCB0aGUgc3BlY2lhbCBy
ZWdpc3RlcnMgYW5kIHRoZSByZXF1ZXN0ZWQgc2V0IG9mIE1TUnMuCisKKzpFcnJvcnM6CisKKyog
LUtWTV9FSU5WQUwgLSB0aGUgc2VsZWN0ZWQgdkNQVSBpcyBpbnZhbGlkCisqIC1LVk1fRUlOVkFM
IC0gb25lIG9mIHRoZSBpbmRpY2F0ZWQgTVNScyBpcyBpbnZhbGlkCisqIC1LVk1fRUlOVkFMIC0g
dGhlIHBhZGRpbmcgaXMgbm90IHplcm8KKyogLUtWTV9FSU5WQUwgLSB0aGUgcmVwbHkgc2l6ZSBp
cyBsYXJnZXIgdGhhbgorICAgICAgICAgICAgICAgIGt2bWlfZ2V0X3ZlcnNpb25fcmVwbHkubWF4
X21zZ19zaXplICh0b28gbWFueSBNU1JzKQorKiAtS1ZNX0VBR0FJTiAtIHRoZSBzZWxlY3RlZCB2
Q1BVIGNhbid0IGJlIGludHJvc3BlY3RlZCB5ZXQKKyogLUtWTV9FTk9NRU0gLSB0aGVyZSBpcyBu
b3QgZW5vdWdoIG1lbW9yeSB0byBhbGxvY2F0ZSB0aGUgcmVwbHkKKwogRXZlbnRzCiA9PT09PT0K
IApkaWZmIC0tZ2l0IGEvYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmggYi9hcmNoL3g4
Ni9pbmNsdWRlL3VhcGkvYXNtL2t2bWkuaAppbmRleCA5ZDlkZjA5ZDM4MWEuLjExODM1YmY5YmRj
NiAxMDA2NDQKLS0tIGEvYXJjaC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmgKKysrIGIvYXJj
aC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmgKQEAgLTMwLDQgKzMwLDE5IEBAIHN0cnVjdCBr
dm1pX3ZjcHVfZXZlbnRfYXJjaCB7CiAJfSBtc3JzOwogfTsKIAorc3RydWN0IGt2bWlfdmNwdV9n
ZXRfcmVnaXN0ZXJzIHsKKwlfX3UxNiBubXNyczsKKwlfX3UxNiBwYWRkaW5nMTsKKwlfX3UzMiBw
YWRkaW5nMjsKKwlfX3UzMiBtc3JzX2lkeFswXTsKK307CisKK3N0cnVjdCBrdm1pX3ZjcHVfZ2V0
X3JlZ2lzdGVyc19yZXBseSB7CisJX191MzIgbW9kZTsKKwlfX3UzMiBwYWRkaW5nOworCXN0cnVj
dCBrdm1fcmVncyByZWdzOworCXN0cnVjdCBrdm1fc3JlZ3Mgc3JlZ3M7CisJc3RydWN0IGt2bV9t
c3JzIG1zcnM7Cit9OworCiAjZW5kaWYgLyogX1VBUElfQVNNX1g4Nl9LVk1JX0ggKi8KZGlmZiAt
LWdpdCBhL2FyY2gveDg2L2t2bS9rdm1pLmMgYi9hcmNoL3g4Ni9rdm0va3ZtaS5jCmluZGV4IDkw
YzViZTNjNDYyZi4uYmM0MGQ3ZGNjNDU2IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0va3ZtaS5j
CisrKyBiL2FyY2gveDg2L2t2bS9rdm1pLmMKQEAgLTkzLDMgKzkzLDI4IEBAIHZvaWQga3ZtaV9h
cmNoX3NldHVwX3ZjcHVfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LAogCWV2LT5hcmNoLm1v
ZGUgPSBrdm1pX3ZjcHVfbW9kZSh2Y3B1LCAmZXZlbnQtPnNyZWdzKTsKIAlrdm1pX2dldF9tc3Jz
KHZjcHUsIGV2ZW50KTsKIH0KKworaW50IGt2bWlfYXJjaF9jbWRfdmNwdV9nZXRfcmVnaXN0ZXJz
KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKKwkJCQljb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9y
ZWdpc3RlcnMgKnJlcSwKKwkJCQlzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9yZWdpc3RlcnNfcmVwbHkg
KnJwbCkKK3sKKwlzdHJ1Y3QgbXNyX2RhdGEgbSA9IHsuaG9zdF9pbml0aWF0ZWQgPSB0cnVlfTsK
KwlpbnQgaywgZXJyID0gMDsKKworCWt2bV9hcmNoX3ZjcHVfZ2V0X3JlZ3ModmNwdSwgJnJwbC0+
cmVncyk7CisJa3ZtX2FyY2hfdmNwdV9nZXRfc3JlZ3ModmNwdSwgJnJwbC0+c3JlZ3MpOworCXJw
bC0+bW9kZSA9IGt2bWlfdmNwdV9tb2RlKHZjcHUsICZycGwtPnNyZWdzKTsKKwlycGwtPm1zcnMu
bm1zcnMgPSByZXEtPm5tc3JzOworCisJZm9yIChrID0gMDsgayA8IHJlcS0+bm1zcnMgJiYgIWVy
cjsgaysrKSB7CisJCW0uaW5kZXggPSByZXEtPm1zcnNfaWR4W2tdOworCisJCWVyciA9IHN0YXRp
Y19jYWxsKGt2bV94ODZfZ2V0X21zcikodmNwdSwgJm0pOworCQlpZiAoIWVycikgeworCQkJcnBs
LT5tc3JzLmVudHJpZXNba10uaW5kZXggPSBtLmluZGV4OworCQkJcnBsLT5tc3JzLmVudHJpZXNb
a10uZGF0YSA9IG0uZGF0YTsKKwkJfQorCX0KKworCXJldHVybiBlcnIgPyAtS1ZNX0VJTlZBTCA6
IDA7Cit9CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaS5oIGIvYXJjaC94ODYva3ZtL2t2
bWkuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjdhYWI0YWFhYmNk
YQotLS0gL2Rldi9udWxsCisrKyBiL2FyY2gveDg2L2t2bS9rdm1pLmgKQEAgLTAsMCArMSw5IEBA
CisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMCAqLworI2lmbmRlZiBBUkNIX1g4
Nl9LVk1fS1ZNSV9ICisjZGVmaW5lIEFSQ0hfWDg2X0tWTV9LVk1JX0gKKworaW50IGt2bWlfYXJj
aF9jbWRfdmNwdV9nZXRfcmVnaXN0ZXJzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKKwkJCQljb25z
dCBzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9yZWdpc3RlcnMgKnJlcSwKKwkJCQlzdHJ1Y3Qga3ZtaV92
Y3B1X2dldF9yZWdpc3RlcnNfcmVwbHkgKnJwbCk7CisKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvYXJj
aC94ODYva3ZtL2t2bWlfbXNnLmMgYi9hcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYwppbmRleCAwZDgz
YzQ3ZjM3NTguLmFiNGI5OWI2NmFjYyAxMDA2NDQKLS0tIGEvYXJjaC94ODYva3ZtL2t2bWlfbXNn
LmMKKysrIGIvYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMKQEAgLTcsNiArNyw3IEBACiAgKi8KIAog
I2luY2x1ZGUgIi4uLy4uLy4uL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCIKKyNp
bmNsdWRlICJrdm1pLmgiCiAKIHN0YXRpYyBpbnQgaGFuZGxlX3ZjcHVfZ2V0X2luZm8oY29uc3Qg
c3RydWN0IGt2bWlfdmNwdV9tc2dfam9iICpqb2IsCiAJCQkJY29uc3Qgc3RydWN0IGt2bWlfbXNn
X2hkciAqbXNnLApAQCAtMjEsOCArMjIsNzcgQEAgc3RhdGljIGludCBoYW5kbGVfdmNwdV9nZXRf
aW5mbyhjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X21zZ19qb2IgKmpvYiwKIAlyZXR1cm4ga3ZtaV9t
c2dfdmNwdV9yZXBseShqb2IsIG1zZywgMCwgJnJwbCwgc2l6ZW9mKHJwbCkpOwogfQogCitzdGF0
aWMgYm9vbCBpc192YWxpZF9nZXRfcmVnc19yZXF1ZXN0KGNvbnN0IHN0cnVjdCBrdm1pX21zZ19o
ZHIgKm1zZywKKwkJCQljb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9yZWdpc3RlcnMgKnJlcSkK
K3sKKwlzaXplX3QgcmVxX3NpemUsIG1zZ19zaXplOworCisJaWYgKHJlcS0+cGFkZGluZzEgfHwg
cmVxLT5wYWRkaW5nMikKKwkJcmV0dXJuIGZhbHNlOworCisJcmVxX3NpemUgPSBzdHJ1Y3Rfc2l6
ZShyZXEsIG1zcnNfaWR4LCByZXEtPm5tc3JzKTsKKworCWlmIChjaGVja19hZGRfb3ZlcmZsb3co
c2l6ZW9mKHN0cnVjdCBrdm1pX3ZjcHVfaGRyKSwKKwkJCSAgICAgICByZXFfc2l6ZSwgJm1zZ19z
aXplKSkKKwkJcmV0dXJuIGZhbHNlOworCisJaWYgKG1zZ19zaXplID4gbXNnLT5zaXplKQorCQly
ZXR1cm4gZmFsc2U7CisKKwlyZXR1cm4gdHJ1ZTsKK30KKworc3RhdGljIGJvb2wgaXNfdmFsaWRf
Z2V0X3JlZ3NfcmVwbHkoY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9nZXRfcmVnaXN0ZXJzICpyZXEs
CisJCQkJICAgIHNpemVfdCAqcHRyX3JwbF9zaXplKQoreworCXN0cnVjdCBrdm1pX3ZjcHVfZ2V0
X3JlZ2lzdGVyc19yZXBseSAqcnBsOworCXNpemVfdCBycGxfc2l6ZSwgbXNnX3NpemU7CisKKwly
cGxfc2l6ZSA9IHN0cnVjdF9zaXplKHJwbCwgbXNycy5lbnRyaWVzLCByZXEtPm5tc3JzKTsKKwor
CWlmIChjaGVja19hZGRfb3ZlcmZsb3coc2l6ZW9mKHN0cnVjdCBrdm1pX2Vycm9yX2NvZGUpLAor
CQkJICAgICAgIHJwbF9zaXplLCAmbXNnX3NpemUpKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAo
bXNnX3NpemUgPiBLVk1JX01BWF9NU0dfU0laRSkKKwkJcmV0dXJuIGZhbHNlOworCisJKnB0cl9y
cGxfc2l6ZSA9IHJwbF9zaXplOworCXJldHVybiB0cnVlOworfQorCitzdGF0aWMgaW50IGhhbmRs
ZV92Y3B1X2dldF9yZWdpc3RlcnMoY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9tc2dfam9iICpqb2Is
CisJCQkJICAgICBjb25zdCBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICptc2csCisJCQkJICAgICBjb25z
dCB2b2lkICpyZXEpCit7CisJc3RydWN0IGt2bWlfdmNwdV9nZXRfcmVnaXN0ZXJzX3JlcGx5ICpy
cGwgPSBOVUxMOworCXNpemVfdCBycGxfc2l6ZSA9IDA7CisJaW50IGVyciwgZWM7CisKKwlpZiAo
IWlzX3ZhbGlkX2dldF9yZWdzX3JlcXVlc3QobXNnLCByZXEpIHx8CisJICAgICFpc192YWxpZF9n
ZXRfcmVnc19yZXBseShyZXEsICZycGxfc2l6ZSkpIHsKKwkJZWMgPSAtS1ZNX0VJTlZBTDsKKwkJ
Z290byByZXBseTsKKwl9CisKKwlycGwgPSBrdm1pX21zZ19hbGxvYygpOworCWlmICghcnBsKSB7
CisJCWVjID0gLUtWTV9FTk9NRU07CisJCWdvdG8gcmVwbHk7CisJfQorCisJZWMgPSBrdm1pX2Fy
Y2hfY21kX3ZjcHVfZ2V0X3JlZ2lzdGVycyhqb2ItPnZjcHUsIHJlcSwgcnBsKTsKKworcmVwbHk6
CisJZXJyID0ga3ZtaV9tc2dfdmNwdV9yZXBseShqb2IsIG1zZywgZWMsIHJwbCwgcnBsX3NpemUp
OworCisJa3ZtaV9tc2dfZnJlZShycGwpOworCXJldHVybiBlcnI7Cit9CisKIHN0YXRpYyBjb25z
dCBrdm1pX3ZjcHVfbXNnX2pvYl9mY3QgbXNnX3ZjcHVbXSA9IHsKLQlbS1ZNSV9WQ1BVX0dFVF9J
TkZPXSA9IGhhbmRsZV92Y3B1X2dldF9pbmZvLAorCVtLVk1JX1ZDUFVfR0VUX0lORk9dICAgICAg
PSBoYW5kbGVfdmNwdV9nZXRfaW5mbywKKwlbS1ZNSV9WQ1BVX0dFVF9SRUdJU1RFUlNdID0gaGFu
ZGxlX3ZjcHVfZ2V0X3JlZ2lzdGVycywKIH07CiAKIGt2bWlfdmNwdV9tc2dfam9iX2ZjdCBrdm1p
X2FyY2hfdmNwdV9tc2dfaGFuZGxlcih1MTYgaWQpCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkv
bGludXgva3ZtaS5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAppbmRleCBhY2QwMGU4ODNk
YzkuLjg1NDhlYWQ0NTFjMSAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaAor
KysgYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCkBAIC0zNyw2ICszNyw3IEBAIGVudW0gewog
CiAJS1ZNSV9WQ1BVX0dFVF9JTkZPICAgICAgID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoMSksCiAJ
S1ZNSV9WQ1BVX0NPTlRST0xfRVZFTlRTID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoMiksCisJS1ZN
SV9WQ1BVX0dFVF9SRUdJU1RFUlMgID0gS1ZNSV9WQ1BVX01FU1NBR0VfSUQoMyksCiAKIAlLVk1J
X05FWFRfVkNQVV9NRVNTQUdFCiB9OwpkaWZmIC0tZ2l0IGEvdG9vbHMvdGVzdGluZy9zZWxmdGVz
dHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94
ODZfNjQva3ZtaV90ZXN0LmMKaW5kZXggZTJkMDllMGNiY2U4Li5mMjc3YjgyZjFiYmIgMTAwNjQ0
Ci0tLSBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKKysr
IGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYwpAQCAtODIy
LDYgKzgyMiw2NCBAQCBzdGF0aWMgdm9pZCB0ZXN0X2NtZF92Y3B1X2NvbnRyb2xfZXZlbnRzKHN0
cnVjdCBrdm1fdm0gKnZtKQogCiB9CiAKK3N0YXRpYyB2b2lkIGNtZF92Y3B1X2dldF9yZWdpc3Rl
cnMoc3RydWN0IGt2bV92bSAqdm0sIHN0cnVjdCBrdm1fcmVncyAqcmVncykKK3sKKwlzdHJ1Y3Qg
eworCQlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhkcjsKKwkJc3RydWN0IGt2bWlfdmNwdV9oZHIgdmNw
dV9oZHI7CisJCXN0cnVjdCBrdm1pX3ZjcHVfZ2V0X3JlZ2lzdGVycyBjbWQ7CisJfSByZXEgPSB7
fTsKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9yZWdpc3RlcnNfcmVwbHkgcnBsOworCisJdGVzdF92
Y3B1MF9jb21tYW5kKHZtLCBLVk1JX1ZDUFVfR0VUX1JFR0lTVEVSUywgJnJlcS5oZHIsIHNpemVv
ZihyZXEpLAorCQkJICAgJnJwbCwgc2l6ZW9mKHJwbCksIDApOworCisJbWVtY3B5KHJlZ3MsICZy
cGwucmVncywgc2l6ZW9mKCpyZWdzKSk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfaW52YWxpZF92
Y3B1X2dldF9yZWdpc3RlcnMoc3RydWN0IGt2bV92bSAqdm0pCit7CisJc3RydWN0IHsKKwkJc3Ry
dWN0IGt2bWlfbXNnX2hkciBoZHI7CisJCXN0cnVjdCBrdm1pX3ZjcHVfaGRyIHZjcHVfaGRyOwor
CQlzdHJ1Y3Qga3ZtaV92Y3B1X2dldF9yZWdpc3RlcnMgY21kOworCQlfX3UzMiBtc3JzX2lkeFsx
XTsKKwl9IHJlcSA9IHt9OworCXN0cnVjdCB7CisJCXN0cnVjdCBrdm1pX21zZ19oZHIgaGRyOwor
CQlzdHJ1Y3Qga3ZtaV92Y3B1X2hkciB2Y3B1X2hkcjsKKwkJc3RydWN0IGt2bWlfdmNwdV9nZXRf
cmVnaXN0ZXJzIGNtZDsKKwl9ICpyZXFfYmlnOworCXN0cnVjdCBrdm1pX3ZjcHVfZ2V0X3JlZ2lz
dGVyc19yZXBseSBycGw7CisJc3RydWN0IGt2bWlfZ2V0X3ZlcnNpb25fcmVwbHkgdmVyc2lvbjsK
KworCXJlcS5jbWQubm1zcnMgPSAxOworCXJlcS5tc3JzX2lkeFswXSA9IDB4ZmZmZmZmZmY7CisJ
dGVzdF92Y3B1MF9jb21tYW5kKHZtLCBLVk1JX1ZDUFVfR0VUX1JFR0lTVEVSUywKKwkJCSAgICZy
ZXEuaGRyLCBzaXplb2YocmVxKSwKKwkJCSAgICZycGwsIHNpemVvZihycGwpLCAtS1ZNX0VJTlZB
TCk7CisKKwljbWRfdm1fZ2V0X3ZlcnNpb24oJnZlcnNpb24pOworCisJcmVxX2JpZyA9IGNhbGxv
YygxLCB2ZXJzaW9uLm1heF9tc2dfc2l6ZSk7CisJcmVxX2JpZy0+Y21kLm5tc3JzID0gKHZlcnNp
b24ubWF4X21zZ19zaXplIC0gc2l6ZW9mKCpyZXFfYmlnKSkgLyBzaXplb2YoX191MzIpOworCXRl
c3RfdmNwdTBfY29tbWFuZCh2bSwgS1ZNSV9WQ1BVX0dFVF9SRUdJU1RFUlMsCisJCQkgICAmcmVx
Lmhkciwgc2l6ZW9mKHJlcSksCisJCQkgICAmcnBsLCBzaXplb2YocnBsKSwgLUtWTV9FSU5WQUwp
OworCWZyZWUocmVxX2JpZyk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfY21kX3ZjcHVfZ2V0X3Jl
Z2lzdGVycyhzdHJ1Y3Qga3ZtX3ZtICp2bSkKK3sKKwlzdHJ1Y3Qga3ZtX3JlZ3MgcmVncyA9IHt9
OworCisJY21kX3ZjcHVfZ2V0X3JlZ2lzdGVycyh2bSwgJnJlZ3MpOworCisJcHJfZGVidWcoImdl
dF9yZWdpc3RlcnMgcmlwIDB4JWxseFxuIiwgcmVncy5yaXApOworCisJdGVzdF9pbnZhbGlkX3Zj
cHVfZ2V0X3JlZ2lzdGVycyh2bSk7Cit9CisKIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlv
bihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIHsKIAlzcmFuZG9tKHRpbWUoMCkpOwpAQCAtODM5LDYgKzg5
Nyw3IEBAIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkK
IAl0ZXN0X2NtZF92Y3B1X2dldF9pbmZvKHZtKTsKIAl0ZXN0X3BhdXNlKHZtKTsKIAl0ZXN0X2Nt
ZF92Y3B1X2NvbnRyb2xfZXZlbnRzKHZtKTsKKwl0ZXN0X2NtZF92Y3B1X2dldF9yZWdpc3RlcnMo
dm0pOwogCiAJdW5ob29rX2ludHJvc3BlY3Rpb24odm0pOwogfQpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QK
VmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5s
aW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
