Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id 30D301F4D3F
	for <lists.virtualization@lfdr.de>; Wed, 10 Jun 2020 07:50:17 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id ABDD4888C3;
	Wed, 10 Jun 2020 05:50:15 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id WPDZcO3k1hcF; Wed, 10 Jun 2020 05:50:14 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 5D6C3888B5;
	Wed, 10 Jun 2020 05:50:14 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 43672C016F;
	Wed, 10 Jun 2020 05:50:14 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id B8939C016F
 for <virtualization@lists.linux-foundation.org>;
 Wed, 10 Jun 2020 05:50:12 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id AC3AB888BE
 for <virtualization@lists.linux-foundation.org>;
 Wed, 10 Jun 2020 05:50:12 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id amlqfUvloLSS
 for <virtualization@lists.linux-foundation.org>;
 Wed, 10 Jun 2020 05:50:10 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from us-smtp-delivery-1.mimecast.com (us-smtp-2.mimecast.com
 [205.139.110.61])
 by hemlock.osuosl.org (Postfix) with ESMTPS id 55132888B5
 for <virtualization@lists.linux-foundation.org>;
 Wed, 10 Jun 2020 05:50:10 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1591768209;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding;
 bh=LgkQN+CitMhnnfvOaE2sBGVA76Dhf2Sb3YRYknCI66k=;
 b=WwdfRthOkC6lQGT7qLNVLVnlNPkcMpDrn+deXH4PTRg78ZLXxndPkC6s1jlIQIQuG4qKoE
 ukARA0pkZjlIKuxaTLia/AmQCeZw9xkof38LTJWe1DLQ4Jxva26aKxsccqW0TcITOa6e0j
 dX0kN6dHvqAFZk4dADgOPYEzpymdttM=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-420-ySO6YapvPLGhtbcQblTPlQ-1; Wed, 10 Jun 2020 01:50:06 -0400
X-MC-Unique: ySO6YapvPLGhtbcQblTPlQ-1
Received: from smtp.corp.redhat.com (int-mx02.intmail.prod.int.phx2.redhat.com
 [10.5.11.12])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 4AFD0835B43;
 Wed, 10 Jun 2020 05:50:04 +0000 (UTC)
Received: from jason-ThinkPad-X1-Carbon-6th.redhat.com
 (ovpn-13-194.pek2.redhat.com [10.72.13.194])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 80DCA6116D;
 Wed, 10 Jun 2020 05:49:53 +0000 (UTC)
From: Jason Wang <jasowang@redhat.com>
To: mst@redhat.com, jasowang@redhat.com, linux-kernel@vger.kernel.org,
 virtualization@lists.linux-foundation.org
Subject: [PATCH RESEND V2] vdpa: introduce virtio pci driver
Date: Wed, 10 Jun 2020 13:49:51 +0800
Message-Id: <20200610054951.16197-1-jasowang@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.12
Cc: shahafs@mellanox.com, lulu@redhat.com, saugatm@xilinx.com,
 mhabets@solarflare.com, vmireyno@marvell.com, gdawar@xilinx.com,
 eperezma@redhat.com, hanand@xilinx.com, zhangweining@ruijie.com.cn,
 eli@mellanox.com, lingshan.zhu@intel.com, rob.miller@broadcom.com
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhpcyBwYXRjaCBpbnRyb2R1Y2UgYSB2RFBBIGRyaXZlciBmb3IgdmlydGlvLXBjaSBkZXZpY2Uu
IEl0IGJyaWRnZXMKdGhlIHZpcnRpby1wY2kgY29udHJvbCBjb21tYW5kIHRvIHRoZSB2RFBBIGJ1
cy4gVGhpcyB3aWxsIGJlIHVzZWQgZm9yCmRldmVsb3BpbmcgbmV3IGZlYXR1cmVzIGZvciBib3Ro
IHNvZnR3YXJlIHZEUEEgZnJhbWV3b3JrIGFuZCBoYXJkd2FyZQp2RFBBIGZlYXR1cmUuCgpDb21w
YXJlZCB0byB2ZHBhX3NpbSwgaXQgaGFzIHNldmVyYWwgYWR2YW50YWdlczoKCi0gaXQncyBhIHJl
YWwgZGV2aWNlIGRyaXZlciB3aGljaCBhbGxvdyB1cyB0byBwbGF5IHdpdGggcmVhbCBoYXJkd2Fy
ZQogIGZlYXR1cmVzCi0gdHlwZSBpbmRlcGVuZGVudCBpbnN0ZWFkIG9mIG5ldHdvcmtpbmcgc3Bl
Y2lmaWMKCk5vdGUgdGhhdCBzaW5jZSB2aXJ0aW8gc3BlY2lmaWNhdGlvbiBkb2VzIG5vdCBzdXBw
b3J0IGdldC9yZXN0b3JlCnZpcnRxdWV1ZSBzdGF0ZS4gU28gd2UgY2FuIG5vdCB1c2UgdGhpcyBk
cml2ZXIgZm9yIFZNLiBUaGlzIGNhbiBiZQphZGRyZXNzZWQgYnkgZXh0ZW5kaW5nIHRoZSB2aXJ0
aW8gc3BlY2lmaWNhdGlvbi4KCkNvbnNpZGVyIHRoZSBkcml2ZXIgaXMgbWFpbmx5IGZvciB0ZXN0
aW5nIGFuZCBkZXZlbG9wbWVudCBmb3IgdkRQQQpmZWF0dXJlcywgaXQgY2FuIG9ubHkgYmUgYm91
bmQgdmlhIGR5bmFtaWMgaWRzIHRvIG1ha2Ugc3VyZSBpdCdzIG5vdApjb25mbGljdCB3aXRoIHRo
ZSBkcml2ZXJzIGxpa2UgdmlydGlvLXBjaSBvciBJRkNWRi4KClNpZ25lZC1vZmYtYnk6IEphc29u
IFdhbmcgPGphc293YW5nQHJlZGhhdC5jb20+Ci0tLQpDaGFuZ2VzIHNpbmNlIFYxOgotIHVzZSBO
VUxMIGlkX3RhYmxlIHRvIGFsbG93IGR5bmFtaWMgaWRzIG9ubHkKLSBzcXVhc2ggdGhlIGRvb3Ji
ZWxsIHJlcG9ydGluZwotLS0KIGRyaXZlcnMvdmRwYS9LY29uZmlnICAgICAgICAgICB8ICAgOCAr
CiBkcml2ZXJzL3ZkcGEvTWFrZWZpbGUgICAgICAgICAgfCAgIDEgKwogZHJpdmVycy92ZHBhL3Zw
X3ZkcGEvTWFrZWZpbGUgIHwgICAyICsKIGRyaXZlcnMvdmRwYS92cF92ZHBhL3ZwX3ZkcGEuYyB8
IDYwMSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDQgZmlsZXMgY2hhbmdlZCwg
NjEyIGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL3ZkcGEvdnBfdmRw
YS9NYWtlZmlsZQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvdmRwYS92cF92ZHBhL3ZwX3Zk
cGEuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmRwYS9LY29uZmlnIGIvZHJpdmVycy92ZHBhL0tj
b25maWcKaW5kZXggZTgxNDAwNjVjOGE1Li41Y2VmM2E0ODcyZTMgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvdmRwYS9LY29uZmlnCisrKyBiL2RyaXZlcnMvdmRwYS9LY29uZmlnCkBAIC0yOCw0ICsyOCwx
MiBAQCBjb25maWcgSUZDVkYKIAkgIFRvIGNvbXBpbGUgdGhpcyBkcml2ZXIgYXMgYSBtb2R1bGUs
IGNob29zZSBNIGhlcmU6IHRoZSBtb2R1bGUgd2lsbAogCSAgYmUgY2FsbGVkIGlmY3ZmLgogCitj
b25maWcgVlBfVkRQQQorCXRyaXN0YXRlICJWaXJ0aW8gUENJIGJyaWRnZSB2RFBBIGRyaXZlciIK
KwlkZXBlbmRzIG9uIFBDSV9NU0kKKwloZWxwCisJICBUaGlzIGtlcm5lbCBtb2R1bGUgdGhhdCBi
cmlkZ2VzIHZpcnRpbyBQQ0kgZGV2aWNlIHRvIHZEUEEKKwkgIGJ1cy4gSXQgYWxsb3dzIHVzIHRv
IHRlc3QgYW5kIGRldmVsb3AgdkRQQSBzdWJzeXN0ZW0gaW5zaWRlCisJICBhbiBWTSB3aXRoIHRo
ZSBlbXVsYXRlZCB2aXJ0aW8tcGNpIGRldmljZQorCiBlbmRpZiAjIFZEUEEKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvdmRwYS9NYWtlZmlsZSBiL2RyaXZlcnMvdmRwYS9NYWtlZmlsZQppbmRleCA4YmJi
Njg2Y2E3YTIuLjM3ZDAwZjQ5YjNiZiAxMDA2NDQKLS0tIGEvZHJpdmVycy92ZHBhL01ha2VmaWxl
CisrKyBiL2RyaXZlcnMvdmRwYS9NYWtlZmlsZQpAQCAtMiwzICsyLDQgQEAKIG9iai0kKENPTkZJ
R19WRFBBKSArPSB2ZHBhLm8KIG9iai0kKENPTkZJR19WRFBBX1NJTSkgKz0gdmRwYV9zaW0vCiBv
YmotJChDT05GSUdfSUZDVkYpICAgICs9IGlmY3ZmLworb2JqLSQoQ09ORklHX1ZQX1ZEUEEpICAg
ICs9IHZwX3ZkcGEvCmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZkcGEvdnBfdmRwYS9NYWtlZmlsZSBi
L2RyaXZlcnMvdmRwYS92cF92ZHBhL01ha2VmaWxlCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uMjMxMDg4ZDNhZjdkCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy92
ZHBhL3ZwX3ZkcGEvTWFrZWZpbGUKQEAgLTAsMCArMSwyIEBACisjIFNQRFgtTGljZW5zZS1JZGVu
dGlmaWVyOiBHUEwtMi4wCitvYmotJChDT05GSUdfVlBfVkRQQSkgKz0gdnBfdmRwYS5vCmRpZmYg
LS1naXQgYS9kcml2ZXJzL3ZkcGEvdnBfdmRwYS92cF92ZHBhLmMgYi9kcml2ZXJzL3ZkcGEvdnBf
dmRwYS92cF92ZHBhLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4y
MDcwMjk4YWI5ZmMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL3ZkcGEvdnBfdmRwYS92cF92
ZHBhLmMKQEAgLTAsMCArMSw2MDEgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwt
Mi4wLW9ubHkKKy8qCisgKiB2RFBBIGJyaWRnZSBkcml2ZXIgZm9yIG1vZGVybiB2aXJ0aW8tcGNp
IGRldmljZQorICoKKyAqIENvcHlyaWdodCAoYykgMjAyMCwgUmVkIEhhdCBJbmMuIEFsbCByaWdo
dHMgcmVzZXJ2ZWQuCisgKiBBdXRob3I6IEphc29uIFdhbmcgPGphc293YW5nQHJlZGhhdC5jb20+
CisgKgorICogQmFzZWQgb24gdmlydGlvX3BjaV9tb2Rlcm4uYy4KKyAqLworCisjaW5jbHVkZSA8
bGludXgvaW50ZXJydXB0Lmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8
bGludXgvcGNpLmg+CisjaW5jbHVkZSA8bGludXgvdmRwYS5oPgorI2luY2x1ZGUgPGxpbnV4L3Zp
cnRpby5oPgorI2luY2x1ZGUgPGxpbnV4L3ZpcnRpb19jb25maWcuaD4KKyNpbmNsdWRlIDxsaW51
eC92aXJ0aW9fcmluZy5oPgorI2luY2x1ZGUgPGxpbnV4L3ZpcnRpb19wY2kuaD4KKworLyogVEJE
OiByZWFkIGZyb20gY29uZmlnIHNwYWNlICovCisjZGVmaW5lIFZQX1ZEUEFfTUFYX1FVRVVFIDIK
KyNkZWZpbmUgVlBfVkRQQV9EUklWRVJfTkFNRSAidnBfdmRwYSIKKworI2RlZmluZSBWUF9WRFBB
X0ZFQVRVUkVTIFwKKwkoKDFVTEwgPDwgVklSVElPX0ZfQU5ZX0xBWU9VVCkJCQl8IFwKKwkgKDFV
TEwgPDwgVklSVElPX0ZfVkVSU0lPTl8xKQkJCXwgXAorCSAoMVVMTCA8PCBWSVJUSU9fRl9PUkRF
Ul9QTEFURk9STSkJCXwgXAorCSAoMVVMTCA8PCBWSVJUSU9fRl9JT01NVV9QTEFURk9STSkpCisK
K3N0cnVjdCB2cF92cmluZyB7CisJdm9pZCBfX2lvbWVtICpub3RpZnk7CisJY2hhciBtc2l4X25h
bWVbMjU2XTsKKwlyZXNvdXJjZV9zaXplX3Qgbm90aWZ5X3BhOworCXN0cnVjdCB2ZHBhX2NhbGxi
YWNrIGNiOworCWludCBpcnE7Cit9OworCitzdHJ1Y3QgdnBfdmRwYSB7CisJc3RydWN0IHZkcGFf
ZGV2aWNlIHZkcGE7CisJc3RydWN0IHBjaV9kZXYgKnBkZXY7CisKKwlzdHJ1Y3QgdmlydGlvX2Rl
dmljZV9pZCBpZDsKKworCXN0cnVjdCB2cF92cmluZyB2cmluZ1tWUF9WRFBBX01BWF9RVUVVRV07
CisKKwkvKiBUaGUgSU8gbWFwcGluZyBmb3IgdGhlIFBDSSBjb25maWcgc3BhY2UgKi8KKwl2b2lk
IF9faW9tZW0gKiBjb25zdCAqYmFzZTsKKwlzdHJ1Y3QgdmlydGlvX3BjaV9jb21tb25fY2ZnIF9f
aW9tZW0gKmNvbW1vbjsKKwl2b2lkIF9faW9tZW0gKmRldmljZTsKKwkvKiBCYXNlIG9mIHZxIG5v
dGlmaWNhdGlvbnMgKi8KKwl2b2lkIF9faW9tZW0gKm5vdGlmeTsKKworCS8qIE11bHRpcGxpZXIg
Zm9yIHF1ZXVlX25vdGlmeV9vZmYuICovCisJdTMyIG5vdGlmeV9vZmZfbXVsdGlwbGllcjsKKwor
CWludCBtb2Rlcm5fYmFyczsKKwlpbnQgdmVjdG9yczsKK307CisKK3N0YXRpYyBzdHJ1Y3QgdnBf
dmRwYSAqdmRwYV90b192cChzdHJ1Y3QgdmRwYV9kZXZpY2UgKnZkcGEpCit7CisJcmV0dXJuIGNv
bnRhaW5lcl9vZih2ZHBhLCBzdHJ1Y3QgdnBfdmRwYSwgdmRwYSk7Cit9CisKKy8qCisgKiBUeXBl
LXNhZmUgd3JhcHBlcnMgZm9yIGlvIGFjY2Vzc2VzLgorICogVXNlIHRoZXNlIHRvIGVuZm9yY2Ug
YXQgY29tcGlsZSB0aW1lIHRoZSBmb2xsb3dpbmcgc3BlYyByZXF1aXJlbWVudDoKKyAqCisgKiBU
aGUgZHJpdmVyIE1VU1QgYWNjZXNzIGVhY2ggZmllbGQgdXNpbmcgdGhlIOKAnG5hdHVyYWzigJ0g
YWNjZXNzCisgKiBtZXRob2QsIGkuZS4gMzItYml0IGFjY2Vzc2VzIGZvciAzMi1iaXQgZmllbGRz
LCAxNi1iaXQgYWNjZXNzZXMKKyAqIGZvciAxNi1iaXQgZmllbGRzIGFuZCA4LWJpdCBhY2Nlc3Nl
cyBmb3IgOC1iaXQgZmllbGRzLgorICovCitzdGF0aWMgaW5saW5lIHU4IHZwX2lvcmVhZDgodTgg
X19pb21lbSAqYWRkcikKK3sKKwlyZXR1cm4gaW9yZWFkOChhZGRyKTsKK30KK3N0YXRpYyBpbmxp
bmUgdTE2IHZwX2lvcmVhZDE2KF9fbGUxNiBfX2lvbWVtICphZGRyKQoreworCXJldHVybiBpb3Jl
YWQxNihhZGRyKTsKK30KKworc3RhdGljIGlubGluZSB1MzIgdnBfaW9yZWFkMzIoX19sZTMyIF9f
aW9tZW0gKmFkZHIpCit7CisJcmV0dXJuIGlvcmVhZDMyKGFkZHIpOworfQorCitzdGF0aWMgaW5s
aW5lIHZvaWQgdnBfaW93cml0ZTgodTggdmFsdWUsIHU4IF9faW9tZW0gKmFkZHIpCit7CisJaW93
cml0ZTgodmFsdWUsIGFkZHIpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgdnBfaW93cml0ZTE2
KHUxNiB2YWx1ZSwgX19sZTE2IF9faW9tZW0gKmFkZHIpCit7CisJaW93cml0ZTE2KHZhbHVlLCBh
ZGRyKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHZwX2lvd3JpdGUzMih1MzIgdmFsdWUsIF9f
bGUzMiBfX2lvbWVtICphZGRyKQoreworCWlvd3JpdGUzMih2YWx1ZSwgYWRkcik7Cit9CisKK3N0
YXRpYyB2b2lkIHZwX2lvd3JpdGU2NF90d29wYXJ0KHU2NCB2YWwsCisJCQkJIF9fbGUzMiBfX2lv
bWVtICpsbywgX19sZTMyIF9faW9tZW0gKmhpKQoreworCXZwX2lvd3JpdGUzMigodTMyKXZhbCwg
bG8pOworCXZwX2lvd3JpdGUzMih2YWwgPj4gMzIsIGhpKTsKK30KKworc3RhdGljIGludCBmaW5k
X2NhcGFiaWxpdHkoc3RydWN0IHBjaV9kZXYgKmRldiwgdTggY2ZnX3R5cGUsCisJCQkgICB1MzIg
aW9yZXNvdXJjZV90eXBlcywgaW50ICpiYXJzKQoreworCWludCBwb3M7CisKKwlmb3IgKHBvcyA9
IHBjaV9maW5kX2NhcGFiaWxpdHkoZGV2LCBQQ0lfQ0FQX0lEX1ZORFIpOworCSAgICAgcG9zID4g
MDsKKwkgICAgIHBvcyA9IHBjaV9maW5kX25leHRfY2FwYWJpbGl0eShkZXYsIHBvcywgUENJX0NB
UF9JRF9WTkRSKSkgeworCQl1OCB0eXBlLCBiYXI7CisKKwkJcGNpX3JlYWRfY29uZmlnX2J5dGUo
ZGV2LCBwb3MgKyBvZmZzZXRvZihzdHJ1Y3QgdmlydGlvX3BjaV9jYXAsCisJCQkJCQkJIGNmZ190
eXBlKSwKKwkJCQkgICAgICZ0eXBlKTsKKwkJcGNpX3JlYWRfY29uZmlnX2J5dGUoZGV2LCBwb3Mg
KyBvZmZzZXRvZihzdHJ1Y3QgdmlydGlvX3BjaV9jYXAsCisJCQkJCQkJIGJhciksCisJCQkJICAg
ICAmYmFyKTsKKworCQkvKiBJZ25vcmUgc3RydWN0dXJlcyB3aXRoIHJlc2VydmVkIEJBUiB2YWx1
ZXMgKi8KKwkJaWYgKGJhciA+IDB4NSkKKwkJCWNvbnRpbnVlOworCisJCWlmICh0eXBlID09IGNm
Z190eXBlKSB7CisJCQlpZiAocGNpX3Jlc291cmNlX2xlbihkZXYsIGJhcikgJiYKKwkJCSAgICBw
Y2lfcmVzb3VyY2VfZmxhZ3MoZGV2LCBiYXIpICYgaW9yZXNvdXJjZV90eXBlcykgeworCQkJCSpi
YXJzIHw9ICgxIDw8IGJhcik7CisJCQkJcmV0dXJuIHBvczsKKwkJCX0KKwkJfQorCX0KKwlyZXR1
cm4gMDsKK30KKworc3RhdGljIHZvaWQgX19pb21lbSAqbWFwX2NhcGFiaWxpdHkoc3RydWN0IHZw
X3ZkcGEgKnZwX3ZkcGEsIGludCBvZmYsCisJCQkJICAgIHJlc291cmNlX3NpemVfdCAqcGEpCit7
CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSB2cF92ZHBhLT5wZGV2OworCXUzMiBvZmZzZXQ7CisJ
dTggYmFyOworCisJcGNpX3JlYWRfY29uZmlnX2J5dGUocGRldiwKKwkJCSAgICAgb2ZmICsgb2Zm
c2V0b2Yoc3RydWN0IHZpcnRpb19wY2lfY2FwLCBiYXIpLAorCQkJICAgICAmYmFyKTsKKwlwY2lf
cmVhZF9jb25maWdfZHdvcmQocGRldiwKKwkJCSAgICAgIG9mZiArIG9mZnNldG9mKHN0cnVjdCB2
aXJ0aW9fcGNpX2NhcCwgb2Zmc2V0KSwKKwkJCSAgICAgICZvZmZzZXQpOworCisJaWYgKHBhKQor
CQkqcGEgPSBwY2lfcmVzb3VyY2Vfc3RhcnQocGRldiwgYmFyKSArIG9mZnNldDsKKworCXJldHVy
biB2cF92ZHBhLT5iYXNlW2Jhcl0gKyBvZmZzZXQ7Cit9CisKK3N0YXRpYyB1NjQgdnBfdmRwYV9n
ZXRfZmVhdHVyZXMoc3RydWN0IHZkcGFfZGV2aWNlICp2ZHBhKQoreworCXN0cnVjdCB2cF92ZHBh
ICp2cF92ZHBhID0gdmRwYV90b192cCh2ZHBhKTsKKwl1NjQgZmVhdHVyZXM7CisKKwl2cF9pb3dy
aXRlMzIoMCwgJnZwX3ZkcGEtPmNvbW1vbi0+ZGV2aWNlX2ZlYXR1cmVfc2VsZWN0KTsKKwlmZWF0
dXJlcyA9IHZwX2lvcmVhZDMyKCZ2cF92ZHBhLT5jb21tb24tPmRldmljZV9mZWF0dXJlKTsKKwl2
cF9pb3dyaXRlMzIoMSwgJnZwX3ZkcGEtPmNvbW1vbi0+ZGV2aWNlX2ZlYXR1cmVfc2VsZWN0KTsK
KwlmZWF0dXJlcyB8PSAoKHU2NCl2cF9pb3JlYWQzMigmdnBfdmRwYS0+Y29tbW9uLT5kZXZpY2Vf
ZmVhdHVyZSkgPDwgMzIpOworCWZlYXR1cmVzICY9IFZQX1ZEUEFfRkVBVFVSRVM7CisKKwlyZXR1
cm4gZmVhdHVyZXM7Cit9CisKK3N0YXRpYyBpbnQgdnBfdmRwYV9zZXRfZmVhdHVyZXMoc3RydWN0
IHZkcGFfZGV2aWNlICp2ZHBhLCB1NjQgZmVhdHVyZXMpCit7CisJc3RydWN0IHZwX3ZkcGEgKnZw
X3ZkcGEgPSB2ZHBhX3RvX3ZwKHZkcGEpOworCisJdnBfaW93cml0ZTMyKDAsICZ2cF92ZHBhLT5j
b21tb24tPmd1ZXN0X2ZlYXR1cmVfc2VsZWN0KTsKKwl2cF9pb3dyaXRlMzIoKHUzMilmZWF0dXJl
cywgJnZwX3ZkcGEtPmNvbW1vbi0+Z3Vlc3RfZmVhdHVyZSk7CisJdnBfaW93cml0ZTMyKDEsICZ2
cF92ZHBhLT5jb21tb24tPmd1ZXN0X2ZlYXR1cmVfc2VsZWN0KTsKKwl2cF9pb3dyaXRlMzIoZmVh
dHVyZXMgPj4gMzIsICZ2cF92ZHBhLT5jb21tb24tPmd1ZXN0X2ZlYXR1cmUpOworCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyB1OCB2cF92ZHBhX2dldF9zdGF0dXMoc3RydWN0IHZkcGFfZGV2aWNl
ICp2ZHBhKQoreworCXN0cnVjdCB2cF92ZHBhICp2cF92ZHBhID0gdmRwYV90b192cCh2ZHBhKTsK
KworCXJldHVybiB2cF9pb3JlYWQ4KCZ2cF92ZHBhLT5jb21tb24tPmRldmljZV9zdGF0dXMpOwor
fQorCitzdGF0aWMgdm9pZCB2cF92ZHBhX2ZyZWVfaXJxKHN0cnVjdCB2cF92ZHBhICp2cF92ZHBh
KQoreworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gdnBfdmRwYS0+cGRldjsKKwlpbnQgaTsKKwor
CWZvciAoaSA9IDA7IGkgPCBWUF9WRFBBX01BWF9RVUVVRTsgaSsrKSB7CisJCWlmICh2cF92ZHBh
LT52cmluZ1tpXS5pcnEgIT0gLTEpIHsKKwkJCXZwX2lvd3JpdGUxNihpLCAmdnBfdmRwYS0+Y29t
bW9uLT5xdWV1ZV9zZWxlY3QpOworCQkJdnBfaW93cml0ZTE2KFZJUlRJT19NU0lfTk9fVkVDVE9S
LAorCQkJCSAgICAgJnZwX3ZkcGEtPmNvbW1vbi0+cXVldWVfbXNpeF92ZWN0b3IpOworCQkJZGV2
bV9mcmVlX2lycSgmcGRldi0+ZGV2LCB2cF92ZHBhLT52cmluZ1tpXS5pcnEsCisJCQkJICAgICAg
JnZwX3ZkcGEtPnZyaW5nW2ldKTsKKwkJCXZwX3ZkcGEtPnZyaW5nW2ldLmlycSA9IC0xOworCQl9
CisJfQorCisJaWYgKHZwX3ZkcGEtPnZlY3RvcnMpIHsKKwkJcGNpX2ZyZWVfaXJxX3ZlY3RvcnMo
cGRldik7CisJCXZwX3ZkcGEtPnZlY3RvcnMgPSAwOworCX0KK30KKworc3RhdGljIGlycXJldHVy
bl90IHZwX3ZkcGFfaW50cl9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3Qg
dnBfdnJpbmcgKnZyaW5nID0gYXJnOworCisJaWYgKHZyaW5nLT5jYi5jYWxsYmFjaykKKwkJcmV0
dXJuIHZyaW5nLT5jYi5jYWxsYmFjayh2cmluZy0+Y2IucHJpdmF0ZSk7CisKKwlyZXR1cm4gSVJR
X0hBTkRMRUQ7Cit9CisKK3N0YXRpYyBpbnQgdnBfdmRwYV9yZXF1ZXN0X2lycShzdHJ1Y3QgdnBf
dmRwYSAqdnBfdmRwYSkKK3sKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IHZwX3ZkcGEtPnBkZXY7
CisJaW50IGksIHJldCwgaXJxOworCisJcmV0ID0gcGNpX2FsbG9jX2lycV92ZWN0b3JzKHBkZXYs
IFZQX1ZEUEFfTUFYX1FVRVVFLAorCQkJCSAgICBWUF9WRFBBX01BWF9RVUVVRSwgUENJX0lSUV9N
U0lYKTsKKwlpZiAocmV0ICE9IFZQX1ZEUEFfTUFYX1FVRVVFKSB7CisJCWRldl9lcnIoJnBkZXYt
PmRldiwgInZwX3ZkcGE6IGZhaWwgdG8gYWxsb2NhdGUgaXJxIHZlY3RvcnNcbiIpOworCQlyZXR1
cm4gcmV0OworCX0KKworCXZwX3ZkcGEtPnZlY3RvcnMgPSBWUF9WRFBBX01BWF9RVUVVRTsKKwor
CWZvciAoaSA9IDA7IGkgPCBWUF9WRFBBX01BWF9RVUVVRTsgaSsrKSB7CisJCXNucHJpbnRmKHZw
X3ZkcGEtPnZyaW5nW2ldLm1zaXhfbmFtZSwgMjU2LAorCQkJInZwLXZkcGFbJXNdLSVkXG4iLCBw
Y2lfbmFtZShwZGV2KSwgaSk7CisJCWlycSA9IHBjaV9pcnFfdmVjdG9yKHBkZXYsIGkpOworCQly
ZXQgPSBkZXZtX3JlcXVlc3RfaXJxKCZwZGV2LT5kZXYsIGlycSwKKwkJCQkgICAgICAgdnBfdmRw
YV9pbnRyX2hhbmRsZXIsCisJCQkJICAgICAgIDAsIHZwX3ZkcGEtPnZyaW5nW2ldLm1zaXhfbmFt
ZSwKKwkJCQkgICAgICAgJnZwX3ZkcGEtPnZyaW5nW2ldKTsKKwkJaWYgKHJldCkgeworCQkJZGV2
X2VycigmcGRldi0+ZGV2LCAidnBfdmRwYTogZmFpbCB0byByZXF1ZXN0IGlycSBmb3IgdnEgJWRc
biIsCisJCQkJaSk7CisJCQlnb3RvIGVycjsKKwkJfQorCQl2cF9pb3dyaXRlMTYoaSwgJnZwX3Zk
cGEtPmNvbW1vbi0+cXVldWVfc2VsZWN0KTsKKwkJdnBfaW93cml0ZTE2KGksICZ2cF92ZHBhLT5j
b21tb24tPnF1ZXVlX21zaXhfdmVjdG9yKTsKKwkJdnBfdmRwYS0+dnJpbmdbaV0uaXJxID0gaXJx
OworCX0KKworCXJldHVybiAwOworZXJyOgorCXZwX3ZkcGFfZnJlZV9pcnEodnBfdmRwYSk7CisJ
cmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgdnBfdmRwYV9zZXRfc3RhdHVzKHN0cnVjdCB2
ZHBhX2RldmljZSAqdmRwYSwgdTggc3RhdHVzKQoreworCXN0cnVjdCB2cF92ZHBhICp2cF92ZHBh
ID0gdmRwYV90b192cCh2ZHBhKTsKKwl1OCBzID0gdnBfdmRwYV9nZXRfc3RhdHVzKHZkcGEpOwor
CisJaWYgKHN0YXR1cyAmIFZJUlRJT19DT05GSUdfU19EUklWRVJfT0sgJiYKKwkgICAgIShzICYg
VklSVElPX0NPTkZJR19TX0RSSVZFUl9PSykpIHsKKwkJdnBfdmRwYV9yZXF1ZXN0X2lycSh2cF92
ZHBhKTsKKwl9CisKKwl2cF9pb3dyaXRlOChzdGF0dXMsICZ2cF92ZHBhLT5jb21tb24tPmRldmlj
ZV9zdGF0dXMpOworCisJaWYgKCEoc3RhdHVzICYgVklSVElPX0NPTkZJR19TX0RSSVZFUl9PSykg
JiYKKwkgICAgKHMgJiBWSVJUSU9fQ09ORklHX1NfRFJJVkVSX09LKSkKKwkJdnBfdmRwYV9mcmVl
X2lycSh2cF92ZHBhKTsKK30KKworc3RhdGljIHUxNiB2cF92ZHBhX2dldF92cV9udW1fbWF4KHN0
cnVjdCB2ZHBhX2RldmljZSAqdmRwYSkKK3sKKwlzdHJ1Y3QgdnBfdmRwYSAqdnBfdmRwYSA9IHZk
cGFfdG9fdnAodmRwYSk7CisKKwlyZXR1cm4gdnBfaW9yZWFkMTYoJnZwX3ZkcGEtPmNvbW1vbi0+
cXVldWVfc2l6ZSk7Cit9CisKK3N0YXRpYyB1NjQgdnBfdmRwYV9nZXRfdnFfc3RhdGUoc3RydWN0
IHZkcGFfZGV2aWNlICp2ZHBhLCB1MTYgcWlkKQoreworCXJldHVybiAwOworfQorCitzdGF0aWMg
c3RydWN0IHZkcGFfbm90aWZpY2F0aW9uX2FyZWEKK3ZwX3ZkcGFfZ2V0X3ZxX25vdGlmaWNhdGlv
bihzdHJ1Y3QgdmRwYV9kZXZpY2UgKnZkcGEsIHUxNiBxaWQpCit7CisJc3RydWN0IHZwX3ZkcGEg
KnZwX3ZkcGEgPSB2ZHBhX3RvX3ZwKHZkcGEpOworCXN0cnVjdCB2ZHBhX25vdGlmaWNhdGlvbl9h
cmVhIG5vdGlmeTsKKworCW5vdGlmeS5hZGRyID0gdnBfdmRwYS0+dnJpbmdbcWlkXS5ub3RpZnlf
cGE7CisJbm90aWZ5LnNpemUgPSB2cF92ZHBhLT5ub3RpZnlfb2ZmX211bHRpcGxpZXI7CisKKwly
ZXR1cm4gbm90aWZ5OworfQorCitzdGF0aWMgaW50IHZwX3ZkcGFfc2V0X3ZxX3N0YXRlKHN0cnVj
dCB2ZHBhX2RldmljZSAqdmRwYSwgdTE2IHFpZCwKKwkJCQl1NjQgbnVtKQoreworCS8qIE5vdGUg
dGhhdCB0aGlzIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdmlydGlvIHNwZWNpZmljYXRpb24sIHNvCisJ
ICogd2UgcmV0dXJuIC1FTk9UU1VQUCBoZXJlLiBUaGlzIG1lYW5zIHdlIGNhbid0IHN1cHBvcnQg
bGl2ZQorCSAqIG1pZ3JhdGlvbiwgdmhvc3QgZGV2aWNlIHN0YXJ0L3N0b3AuCisJICovCisKKwly
ZXR1cm4gLUVOT1RTVVBQOworfQorCitzdGF0aWMgdm9pZCB2cF92ZHBhX3NldF92cV9jYihzdHJ1
Y3QgdmRwYV9kZXZpY2UgKnZkcGEsIHUxNiBxaWQsCisJCQkgICAgICBzdHJ1Y3QgdmRwYV9jYWxs
YmFjayAqY2IpCit7CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3RvX3ZwKHZkcGEp
OworCisJdnBfdmRwYS0+dnJpbmdbcWlkXS5jYiA9ICpjYjsKK30KKworc3RhdGljIHZvaWQgdnBf
dmRwYV9zZXRfdnFfcmVhZHkoc3RydWN0IHZkcGFfZGV2aWNlICp2ZHBhLAorCQkJCSB1MTYgcWlk
LCBib29sIHJlYWR5KQoreworCXN0cnVjdCB2cF92ZHBhICp2cF92ZHBhID0gdmRwYV90b192cCh2
ZHBhKTsKKworCXZwX2lvd3JpdGUxNihxaWQsICZ2cF92ZHBhLT5jb21tb24tPnF1ZXVlX3NlbGVj
dCk7CisJdnBfaW93cml0ZTE2KHJlYWR5LCAmdnBfdmRwYS0+Y29tbW9uLT5xdWV1ZV9lbmFibGUp
OworfQorCitzdGF0aWMgYm9vbCB2cF92ZHBhX2dldF92cV9yZWFkeShzdHJ1Y3QgdmRwYV9kZXZp
Y2UgKnZkcGEsIHUxNiBxaWQpCit7CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3Rv
X3ZwKHZkcGEpOworCisJdnBfaW93cml0ZTE2KHFpZCwgJnZwX3ZkcGEtPmNvbW1vbi0+cXVldWVf
c2VsZWN0KTsKKworCXJldHVybiB2cF9pb3JlYWQxNigmdnBfdmRwYS0+Y29tbW9uLT5xdWV1ZV9l
bmFibGUpOworfQorCitzdGF0aWMgdm9pZCB2cF92ZHBhX3NldF92cV9udW0oc3RydWN0IHZkcGFf
ZGV2aWNlICp2ZHBhLCB1MTYgcWlkLAorCQkJICAgICAgIHUzMiBudW0pCit7CisJc3RydWN0IHZw
X3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3RvX3ZwKHZkcGEpOworCisJdnBfaW93cml0ZTE2KG51bSwg
JnZwX3ZkcGEtPmNvbW1vbi0+cXVldWVfc2l6ZSk7Cit9CisKK3N0YXRpYyBpbnQgdnBfdmRwYV9z
ZXRfdnFfYWRkcmVzcyhzdHJ1Y3QgdmRwYV9kZXZpY2UgKnZkcGEsIHUxNiBxaWQsCisJCQkJICB1
NjQgZGVzY19hcmVhLCB1NjQgZHJpdmVyX2FyZWEsCisJCQkJICB1NjQgZGV2aWNlX2FyZWEpCit7
CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3RvX3ZwKHZkcGEpOworCXN0cnVjdCB2
aXJ0aW9fcGNpX2NvbW1vbl9jZmcgX19pb21lbSAqY2ZnID0gdnBfdmRwYS0+Y29tbW9uOworCisJ
dnBfaW93cml0ZTE2KHFpZCwgJmNmZy0+cXVldWVfc2VsZWN0KTsKKwl2cF9pb3dyaXRlNjRfdHdv
cGFydChkZXNjX2FyZWEsCisJCQkgICAgICZjZmctPnF1ZXVlX2Rlc2NfbG8sICZjZmctPnF1ZXVl
X2Rlc2NfaGkpOworCXZwX2lvd3JpdGU2NF90d29wYXJ0KGRyaXZlcl9hcmVhLAorCQkJICAgICAm
Y2ZnLT5xdWV1ZV9hdmFpbF9sbywgJmNmZy0+cXVldWVfYXZhaWxfaGkpOworCXZwX2lvd3JpdGU2
NF90d29wYXJ0KGRldmljZV9hcmVhLAorCQkJICAgICAmY2ZnLT5xdWV1ZV91c2VkX2xvLCAmY2Zn
LT5xdWV1ZV91c2VkX2hpKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCB2cF92ZHBh
X2tpY2tfdnEoc3RydWN0IHZkcGFfZGV2aWNlICp2ZHBhLCB1MTYgcWlkKQoreworCXN0cnVjdCB2
cF92ZHBhICp2cF92ZHBhID0gdmRwYV90b192cCh2ZHBhKTsKKworCXZwX2lvd3JpdGUxNihxaWQs
IHZwX3ZkcGEtPnZyaW5nW3FpZF0ubm90aWZ5KTsKK30KKworc3RhdGljIHUzMiB2cF92ZHBhX2dl
dF9nZW5lcmF0aW9uKHN0cnVjdCB2ZHBhX2RldmljZSAqdmRwYSkKK3sKKwlzdHJ1Y3QgdnBfdmRw
YSAqdnBfdmRwYSA9IHZkcGFfdG9fdnAodmRwYSk7CisKKwlyZXR1cm4gdnBfaW9yZWFkOCgmdnBf
dmRwYS0+Y29tbW9uLT5jb25maWdfZ2VuZXJhdGlvbik7Cit9CisKK3N0YXRpYyB1MzIgdnBfdmRw
YV9nZXRfZGV2aWNlX2lkKHN0cnVjdCB2ZHBhX2RldmljZSAqdmRwYSkKK3sKKwlzdHJ1Y3QgdnBf
dmRwYSAqdnBfdmRwYSA9IHZkcGFfdG9fdnAodmRwYSk7CisKKwlyZXR1cm4gdnBfdmRwYS0+aWQu
ZGV2aWNlOworfQorCitzdGF0aWMgdTMyIHZwX3ZkcGFfZ2V0X3ZlbmRvcl9pZChzdHJ1Y3QgdmRw
YV9kZXZpY2UgKnZkcGEpCit7CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSB2ZHBhX3RvX3Zw
KHZkcGEpOworCisJcmV0dXJuIHZwX3ZkcGEtPmlkLnZlbmRvcjsKK30KKworc3RhdGljIHUzMiB2
cF92ZHBhX2dldF92cV9hbGlnbihzdHJ1Y3QgdmRwYV9kZXZpY2UgKnZkcGEpCit7CisJcmV0dXJu
IFBBR0VfU0laRTsKK30KKworc3RhdGljIHZvaWQgdnBfdmRwYV9nZXRfY29uZmlnKHN0cnVjdCB2
ZHBhX2RldmljZSAqdmRwYSwKKwkJCSAgICAgICB1bnNpZ25lZCBpbnQgb2Zmc2V0LAorCQkJICAg
ICAgIHZvaWQgKmJ1ZiwgdW5zaWduZWQgaW50IGxlbikKK3sKKwlzdHJ1Y3QgdnBfdmRwYSAqdnBf
dmRwYSA9IHZkcGFfdG9fdnAodmRwYSk7CisJdTggb2xkLCBuZXc7CisJdTggKnA7CisJaW50IGk7
CisKKwlkbyB7CisJCW9sZCA9IHZwX2lvcmVhZDgoJnZwX3ZkcGEtPmNvbW1vbi0+Y29uZmlnX2dl
bmVyYXRpb24pOworCQlwID0gYnVmOworCQlmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspCisJCQkq
cCsrID0gdnBfaW9yZWFkOCh2cF92ZHBhLT5kZXZpY2UgKyBvZmZzZXQgKyBpKTsKKworCQluZXcg
PSB2cF9pb3JlYWQ4KCZ2cF92ZHBhLT5jb21tb24tPmNvbmZpZ19nZW5lcmF0aW9uKTsKKwl9IHdo
aWxlIChvbGQgIT0gbmV3KTsKK30KKworc3RhdGljIHZvaWQgdnBfdmRwYV9zZXRfY29uZmlnKHN0
cnVjdCB2ZHBhX2RldmljZSAqdmRwYSwKKwkJCSAgICAgICB1bnNpZ25lZCBpbnQgb2Zmc2V0LCBj
b25zdCB2b2lkICpidWYsCisJCQkgICAgICAgdW5zaWduZWQgaW50IGxlbikKK3sKKwlzdHJ1Y3Qg
dnBfdmRwYSAqdnBfdmRwYSA9IHZkcGFfdG9fdnAodmRwYSk7CisJY29uc3QgdTggKnAgPSBidWY7
CisJaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspCisJCXZwX2lvd3JpdGU4KCpw
KyssIHZwX3ZkcGEtPmRldmljZSArIG9mZnNldCArIGkpOworfQorCitzdGF0aWMgdm9pZCB2cF92
ZHBhX3NldF9jb25maWdfY2Ioc3RydWN0IHZkcGFfZGV2aWNlICp2ZHBhLAorCQkJCSAgc3RydWN0
IHZkcGFfY2FsbGJhY2sgKmNiKQoreworCS8qIFdlIGRvbid0IHN1cHBvcnQgY29uZmlnIGludGVy
cnVwdCAqLworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IHZkcGFfY29uZmlnX29wcyB2cF92ZHBh
X29wcyA9IHsKKwkuZ2V0X2ZlYXR1cmVzCT0gdnBfdmRwYV9nZXRfZmVhdHVyZXMsCisJLnNldF9m
ZWF0dXJlcwk9IHZwX3ZkcGFfc2V0X2ZlYXR1cmVzLAorCS5nZXRfc3RhdHVzCT0gdnBfdmRwYV9n
ZXRfc3RhdHVzLAorCS5zZXRfc3RhdHVzCT0gdnBfdmRwYV9zZXRfc3RhdHVzLAorCS5nZXRfdnFf
bnVtX21heAk9IHZwX3ZkcGFfZ2V0X3ZxX251bV9tYXgsCisJLmdldF92cV9zdGF0ZQk9IHZwX3Zk
cGFfZ2V0X3ZxX3N0YXRlLAorCS5nZXRfdnFfbm90aWZpY2F0aW9uID0gdnBfdmRwYV9nZXRfdnFf
bm90aWZpY2F0aW9uLAorCS5zZXRfdnFfc3RhdGUJPSB2cF92ZHBhX3NldF92cV9zdGF0ZSwKKwku
c2V0X3ZxX2NiCT0gdnBfdmRwYV9zZXRfdnFfY2IsCisJLnNldF92cV9yZWFkeQk9IHZwX3ZkcGFf
c2V0X3ZxX3JlYWR5LAorCS5nZXRfdnFfcmVhZHkJPSB2cF92ZHBhX2dldF92cV9yZWFkeSwKKwku
c2V0X3ZxX251bQk9IHZwX3ZkcGFfc2V0X3ZxX251bSwKKwkuc2V0X3ZxX2FkZHJlc3MJPSB2cF92
ZHBhX3NldF92cV9hZGRyZXNzLAorCS5raWNrX3ZxCT0gdnBfdmRwYV9raWNrX3ZxLAorCS5nZXRf
Z2VuZXJhdGlvbgk9IHZwX3ZkcGFfZ2V0X2dlbmVyYXRpb24sCisJLmdldF9kZXZpY2VfaWQJPSB2
cF92ZHBhX2dldF9kZXZpY2VfaWQsCisJLmdldF92ZW5kb3JfaWQJPSB2cF92ZHBhX2dldF92ZW5k
b3JfaWQsCisJLmdldF92cV9hbGlnbgk9IHZwX3ZkcGFfZ2V0X3ZxX2FsaWduLAorCS5nZXRfY29u
ZmlnCT0gdnBfdmRwYV9nZXRfY29uZmlnLAorCS5zZXRfY29uZmlnCT0gdnBfdmRwYV9zZXRfY29u
ZmlnLAorCS5zZXRfY29uZmlnX2NiICA9IHZwX3ZkcGFfc2V0X2NvbmZpZ19jYiwKK307CisKK3N0
YXRpYyBpbnQgdnBfdmRwYV9wcm9iZShzdHJ1Y3QgcGNpX2RldiAqcGRldiwgY29uc3Qgc3RydWN0
IHBjaV9kZXZpY2VfaWQgKmlkKQoreworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZwZGV2LT5kZXY7
CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGE7CisJaW50IGNvbW1vbiwgbm90aWZ5LCBkZXZpY2Us
IHJldCwgaTsKKwlzdHJ1Y3QgdmlydGlvX2RldmljZV9pZCB2aXJ0aW9faWQ7CisJcmVzb3VyY2Vf
c2l6ZV90IG5vdGlmeV9wYTsKKwl1MTYgbm90aWZ5X29mZjsKKworCS8qIFdlIG9ubHkgb3duIGRl
dmljZXMgPj0gMHgxMDAwIGFuZCA8PSAweDEwN2Y6IGxlYXZlIHRoZSByZXN0LiAqLworCWlmIChw
ZGV2LT5kZXZpY2UgPCAweDEwMDAgfHwgcGRldi0+ZGV2aWNlID4gMHgxMDdmKQorCQlyZXR1cm4g
LUVOT0RFVjsKKworCWlmIChwZGV2LT5kZXZpY2UgPCAweDEwNDApIHsKKwkJLyogVHJhbnNpdGlv
bmFsIGRldmljZXM6IHVzZSB0aGUgUENJIHN1YnN5c3RlbSBkZXZpY2UgaWQgYXMKKwkJICogdmly
dGlvIGRldmljZSBpZCwgc2FtZSBhcyBsZWdhY3kgZHJpdmVyIGFsd2F5cyBkaWQuCisJCSAqLwor
CQl2aXJ0aW9faWQuZGV2aWNlID0gcGRldi0+c3Vic3lzdGVtX2RldmljZTsKKwl9IGVsc2Ugewor
CQkvKiBNb2Rlcm4gZGV2aWNlczogc2ltcGx5IHVzZSBQQ0kgZGV2aWNlIGlkLAorCQkgKiBidXQg
c3RhcnQgZnJvbSAweDEwNDAuCisJCSAqLworCQl2aXJ0aW9faWQuZGV2aWNlID0gcGRldi0+ZGV2
aWNlIC0gMHgxMDQwOworCX0KKwl2aXJ0aW9faWQudmVuZG9yID0gcGRldi0+c3Vic3lzdGVtX3Zl
bmRvcjsKKworCXJldCA9IHBjaW1fZW5hYmxlX2RldmljZShwZGV2KTsKKwlpZiAocmV0KSB7CisJ
CWRldl9lcnIoZGV2LCAidnBfdmRwYTogRmFpbCB0byBlbmFibGUgUENJIGRldmljZVxuIik7CisJ
CXJldHVybiByZXQ7CisJfQorCisJdnBfdmRwYSA9IHZkcGFfYWxsb2NfZGV2aWNlKHN0cnVjdCB2
cF92ZHBhLCB2ZHBhLAorCQkJCSAgICBkZXYsICZ2cF92ZHBhX29wcyk7CisJaWYgKHZwX3ZkcGEg
PT0gTlVMTCkgeworCQlkZXZfZXJyKGRldiwgInZwX3ZkcGE6IEZhaWxlZCB0byBhbGxvY2F0ZSB2
RFBBIHN0cnVjdHVyZVxuIik7CisJCXJldHVybiAtRU5PTUVNOworCX0KKworCXBjaV9zZXRfbWFz
dGVyKHBkZXYpOworCXBjaV9zZXRfZHJ2ZGF0YShwZGV2LCB2cF92ZHBhKTsKKworCXZwX3ZkcGEt
PnBkZXYgPSBwZGV2OworCXZwX3ZkcGEtPnZkcGEuZG1hX2RldiA9ICZwZGV2LT5kZXY7CisKKwlj
b21tb24gPSBmaW5kX2NhcGFiaWxpdHkocGRldiwgVklSVElPX1BDSV9DQVBfQ09NTU9OX0NGRywK
KwkJCQkgSU9SRVNPVVJDRV9JTyB8IElPUkVTT1VSQ0VfTUVNLAorCQkJCSAmdnBfdmRwYS0+bW9k
ZXJuX2JhcnMpOworCWlmICghY29tbW9uKSB7CisJCWRldl9lcnIoJnBkZXYtPmRldiwKKwkJCSJ2
cF92ZHBhOiBsZWdhY3kgZGV2aWNlIGlzIG5vdCBzdXBwb3J0ZWRcbiIpOworCQlyZXQgPSAtRU5P
REVWOworCQlnb3RvIGVycjsKKwl9CisKKwlub3RpZnkgPSBmaW5kX2NhcGFiaWxpdHkocGRldiwg
VklSVElPX1BDSV9DQVBfTk9USUZZX0NGRywKKwkJCQkgSU9SRVNPVVJDRV9JTyB8IElPUkVTT1VS
Q0VfTUVNLAorCQkJCSAmdnBfdmRwYS0+bW9kZXJuX2JhcnMpOworCWlmICghbm90aWZ5KSB7CisJ
CWRldl9lcnIoJnBkZXYtPmRldiwKKwkJCSJ2cF92ZHBhOiBtaXNzaW5nIG5vdGlmaWNhdGlvbiBj
YXBhYmlsaXRpZXNcbiIpOworCQlyZXQgPSAtRUlOVkFMOworCQlnb3RvIGVycjsKKwl9CisKKwlk
ZXZpY2UgPSBmaW5kX2NhcGFiaWxpdHkocGRldiwgVklSVElPX1BDSV9DQVBfREVWSUNFX0NGRywK
KwkJCQkgSU9SRVNPVVJDRV9JTyB8IElPUkVTT1VSQ0VfTUVNLAorCQkJCSAmdnBfdmRwYS0+bW9k
ZXJuX2JhcnMpOworCWlmICghZGV2aWNlKSB7CisJCWRldl9lcnIoJnBkZXYtPmRldiwKKwkJCSJ2
cF92ZHBhOiBtaXNzaW5nIGRldmljZSBjYXBhYmlsaXRpZXNcbiIpOworCQlyZXQgPSAtRUlOVkFM
OworCQlnb3RvIGVycjsKKwl9CisKKwlyZXQgPSBwY2ltX2lvbWFwX3JlZ2lvbnMocGRldiwgdnBf
dmRwYS0+bW9kZXJuX2JhcnMsCisJCQkJIFZQX1ZEUEFfRFJJVkVSX05BTUUpOworCWlmIChyZXQp
CisJCWdvdG8gZXJyOworCisJdnBfdmRwYS0+YmFzZSA9IHBjaW1faW9tYXBfdGFibGUocGRldik7
CisKKwlyZXQgPSBkbWFfc2V0X21hc2tfYW5kX2NvaGVyZW50KCZwZGV2LT5kZXYsIERNQV9CSVRf
TUFTSyg2NCkpOworCWlmIChyZXQpCisJCXJldCA9IGRtYV9zZXRfbWFza19hbmRfY29oZXJlbnQo
JnBkZXYtPmRldiwKKwkJCQkJCURNQV9CSVRfTUFTSygzMikpOworCWlmIChyZXQpCisJCWRldl93
YXJuKCZwZGV2LT5kZXYsICJGYWlsZWQgdG8gZW5hYmxlIDY0LWJpdCBvciAzMi1iaXQgRE1BLiAg
VHJ5aW5nIHRvIGNvbnRpbnVlLCBidXQgdGhpcyBtaWdodCBub3Qgd29yay5cbiIpOworCisJdnBf
dmRwYS0+ZGV2aWNlID0gbWFwX2NhcGFiaWxpdHkodnBfdmRwYSwgZGV2aWNlLCBOVUxMKTsKKwl2
cF92ZHBhLT5ub3RpZnkgPSBtYXBfY2FwYWJpbGl0eSh2cF92ZHBhLCBub3RpZnksICZub3RpZnlf
cGEpOworCXZwX3ZkcGEtPmNvbW1vbiA9IG1hcF9jYXBhYmlsaXR5KHZwX3ZkcGEsIGNvbW1vbiwg
TlVMTCk7CisJdnBfdmRwYS0+aWQgPSB2aXJ0aW9faWQ7CisKKwlyZXQgPSB2ZHBhX3JlZ2lzdGVy
X2RldmljZSgmdnBfdmRwYS0+dmRwYSk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKCZwZGV2LT5k
ZXYsICJGYWlsZWQgdG8gcmVnaXN0ZXIgdG8gdmRwYSBidXNcbiIpOworCQlnb3RvIGVycjsKKwl9
CisKKwlwY2lfcmVhZF9jb25maWdfZHdvcmQocGRldiwgbm90aWZ5ICsgc2l6ZW9mKHN0cnVjdCB2
aXJ0aW9fcGNpX2NhcCksCisJCQkgICAgICAmdnBfdmRwYS0+bm90aWZ5X29mZl9tdWx0aXBsaWVy
KTsKKworCWZvciAoaSA9IDA7IGkgPCBWUF9WRFBBX01BWF9RVUVVRTsgaSsrKSB7CisJCXZwX2lv
d3JpdGUxNihpLCAmdnBfdmRwYS0+Y29tbW9uLT5xdWV1ZV9zZWxlY3QpOworCQlub3RpZnlfb2Zm
ID0gdnBfaW9yZWFkMTYoJnZwX3ZkcGEtPmNvbW1vbi0+cXVldWVfbm90aWZ5X29mZik7CisJCXZw
X3ZkcGEtPnZyaW5nW2ldLmlycSA9IC0xOworCQl2cF92ZHBhLT52cmluZ1tpXS5ub3RpZnkgPSB2
cF92ZHBhLT5ub3RpZnkgKworCQkJbm90aWZ5X29mZiAqIHZwX3ZkcGEtPm5vdGlmeV9vZmZfbXVs
dGlwbGllcjsKKwkJdnBfdmRwYS0+dnJpbmdbaV0ubm90aWZ5X3BhID0gbm90aWZ5X3BhICsKKwkJ
CW5vdGlmeV9vZmYgKiB2cF92ZHBhLT5ub3RpZnlfb2ZmX211bHRpcGxpZXI7CisJfQorCisJcmV0
dXJuIDA7CisKK2VycjoKKwlwdXRfZGV2aWNlKCZ2cF92ZHBhLT52ZHBhLmRldik7CisJcmV0dXJu
IHJldDsKK30KKworc3RhdGljIHZvaWQgdnBfdmRwYV9yZW1vdmUoc3RydWN0IHBjaV9kZXYgKnBk
ZXYpCit7CisJc3RydWN0IHZwX3ZkcGEgKnZwX3ZkcGEgPSBwY2lfZ2V0X2RydmRhdGEocGRldik7
CisKKwl2ZHBhX3VucmVnaXN0ZXJfZGV2aWNlKCZ2cF92ZHBhLT52ZHBhKTsKK30KKworc3RhdGlj
IHN0cnVjdCBwY2lfZHJpdmVyIHZwX3ZkcGFfZHJpdmVyID0geworCS5uYW1lCQk9ICJ2cC12ZHBh
IiwKKwkuaWRfdGFibGUJPSBOVUxMLCAvKiBvbmx5IGR5bmFtaWMgaWRzICovCisJLnByb2JlCQk9
IHZwX3ZkcGFfcHJvYmUsCisJLnJlbW92ZQkJPSB2cF92ZHBhX3JlbW92ZSwKK307CisKK21vZHVs
ZV9wY2lfZHJpdmVyKHZwX3ZkcGFfZHJpdmVyKTsKKworTU9EVUxFX0FVVEhPUigiSmFzb24gV2Fu
ZyA8amFzb3dhbmdAcmVkaGF0LmNvbT4iKTsKK01PRFVMRV9ERVNDUklQVElPTigidnAtdmRwYSIp
OworTU9EVUxFX0xJQ0VOU0UoIkdQTCIpOworTU9EVUxFX1ZFUlNJT04oIjEiKTsKLS0gCjIuMjAu
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVh
bGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRp
b24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3ZpcnR1YWxpemF0aW9u
