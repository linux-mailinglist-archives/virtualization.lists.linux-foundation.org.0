Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id DBED8155E38
	for <lists.virtualization@lfdr.de>; Fri,  7 Feb 2020 19:36:13 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 93A5B869A9;
	Fri,  7 Feb 2020 18:36:12 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 22CuB4iolS_R; Fri,  7 Feb 2020 18:36:07 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id CADAE869AB;
	Fri,  7 Feb 2020 18:36:05 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id A7D09C1D81;
	Fri,  7 Feb 2020 18:36:05 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 659D8C013E
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:35:58 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by fraxinus.osuosl.org (Postfix) with ESMTP id 5142586968
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:35:58 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id TLtCAziVXl00
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:35:56 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by fraxinus.osuosl.org (Postfix) with ESMTPS id 23209860BE
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:35:56 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 D34B6305D365; Fri,  7 Feb 2020 20:16:41 +0200 (EET)
Received: from host.bbu.bitdefender.biz (unknown [195.210.4.22])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id C59B3305207D;
 Fri,  7 Feb 2020 20:16:41 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [RFC PATCH v7 71/78] KVM: introspection: add KVMI_VM_SET_PAGE_ACCESS
Date: Fri,  7 Feb 2020 20:16:29 +0200
Message-Id: <20200207181636.1065-72-alazar@bitdefender.com>
In-Reply-To: <20200207181636.1065-1-alazar@bitdefender.com>
References: <20200207181636.1065-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 Sean Christopherson <sean.j.christopherson@intel.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhpcyBjb21tYW5k
IHNldHMgdGhlIHNwdGUgYWNjZXNzIGJpdHMgKHJ3eCkgZm9yIGFuIGFycmF5IG9mIGd1ZXN0CnBo
eXNpY2FsIGFkZHJlc3NlcyAodGhyb3VnaCB0aGUgcGFnZSB0cmFjayBzdWJzeXN0ZW0pLgoKVGhl
c2UgcGFnZXMsIHdpdGggdGhlIHJlcXVlc3RlZCBhY2Nlc3MgYml0cywgYXJlIGFsc28ga2VwdCBp
biBhIHJhZGl4CnRyZWUgaW4gb3JkZXIgdG8gZmlsdGVyIG91dCB0aGUgI1BGIGV2ZW50cyB3aGlj
aCBhcmUgb2Ygbm8gaW50ZXJlc3QgdG8KdGhlIGludHJvc3BlY3Rpb24gdG9vbC4KClNpZ25lZC1v
ZmYtYnk6IE1paGFpIERvbsibdSA8bWRvbnR1QGJpdGRlZmVuZGVyLmNvbT4KQ28tZGV2ZWxvcGVk
LWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5jb20+ClNpZ25lZC1vZmYt
Ynk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJpdGRlZmVuZGVyLmNvbT4KLS0tCiBEb2N1bWVu
dGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgICAgICAgICAgICAgfCAgNTggKysrKysrKysKIGFy
Y2gveDg2L2luY2x1ZGUvYXNtL2t2bV9ob3N0LmggICAgICAgICAgICAgICB8ICAgMiArCiBhcmNo
L3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaCAgICAgICAgICAgICAgfCAgIDggKysKIGFyY2gv
eDg2L2t2bS9rdm1pLmMgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICA3OCArKysrKysrKysr
CiBpbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oICAgICAgICAgICAgICAgICAgICAgfCAgIDMgKwog
aW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaCAgICAgICAgICAgICAgICAgICAgIHwgIDIzICsrKwog
Li4uL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMgIHwgIDczICsrKysr
KysrKysKIHZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jICAgICAgICAgICAgICAgICB8IDEz
MyArKysrKysrKysrKysrKysrKy0KIHZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCAg
ICAgICAgICAgICB8ICAxNSArKwogdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jICAg
ICAgICAgICAgIHwgIDMxICsrLS0KIDEwIGZpbGVzIGNoYW5nZWQsIDQxNCBpbnNlcnRpb25zKCsp
LCAxMCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2
bWkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAppbmRleCA0OTMwYTg0MjAw
ZmMuLjE0NzkwMTcxYTE3MCAxMDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1p
LnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CkBAIC04NjAsNiArODYw
LDY0IEBAIHRvIGNvbnRyb2wgZXZlbnRzIGZvciBhbnkgb3RoZXIgcmVnaXN0ZXIgd2lsbCBmYWls
IHdpdGggLUtWTV9FSU5WQUw6OgogKiAtS1ZNX0VJTlZBTCAtIHBhZGRpbmcgaXMgbm90IHplcm8K
ICogLUtWTV9FQUdBSU4gLSB0aGUgc2VsZWN0ZWQgdkNQVSBjYW4ndCBiZSBpbnRyb3NwZWN0ZWQg
eWV0CiAKKzIwLiBLVk1JX1ZNX1NFVF9QQUdFX0FDQ0VTUworLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tCisKKzpBcmNoaXRlY3R1cmVzOiBhbGwKKzpWZXJzaW9uczogPj0gMQorOlBhcmFtZXRl
cnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV92bV9zZXRfcGFnZV9hY2Nlc3MgeworCQlfX3UxNiBj
b3VudDsKKwkJX191MTYgcGFkZGluZzE7CisJCV9fdTMyIHBhZGRpbmcyOworCQlzdHJ1Y3Qga3Zt
aV9wYWdlX2FjY2Vzc19lbnRyeSBlbnRyaWVzWzBdOworCX07CisKK3doZXJlOjoKKworCXN0cnVj
dCBrdm1pX3BhZ2VfYWNjZXNzX2VudHJ5IHsKKwkJX191NjQgZ3BhOworCQlfX3U4IGFjY2VzczsK
KwkJX191OCBwYWRkaW5nMTsKKwkJX191MTYgcGFkZGluZzI7CisJCV9fdTMyIHBhZGRpbmczOwor
CX07CisKKworOlJldHVybnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV9lcnJvcl9jb2RlCisKK1Nl
dHMgdGhlIHNwdGUgYWNjZXNzIGJpdHMgKHJ3eCkgZm9yIGFuIGFycmF5IG9mIGBgY291bnRgYCBn
dWVzdCBwaHlzaWNhbAorYWRkcmVzc2VzLgorCitUaGUgdmFsaWQgYWNjZXNzIGJpdHMgYXJlOjoK
KworCUtWTUlfUEFHRV9BQ0NFU1NfUgorCUtWTUlfUEFHRV9BQ0NFU1NfVworCUtWTUlfUEFHRV9B
Q0NFU1NfWAorCisKK1RoZSBjb21tYW5kIHdpbGwgZmFpbCB3aXRoIC1LVk1fRUlOVkFMIGlmIGFu
eSBvZiB0aGUgc3BlY2lmaWVkIGNvbWJpbmF0aW9uCitvZiBhY2Nlc3MgYml0cyBpcyBub3Qgc3Vw
cG9ydGVkLgorCitUaGUgY29tbWFuZCB3aWxsIHRyeSB0byBhcHBseSBhbGwgY2hhbmdlcyBhbmQg
cmV0dXJuIHRoZSBmaXJzdCBlcnJvciBpZgorc29tZSBmYWlsZWQuIFRoZSBpbnRyb3NwZWN0aW9u
IHRvb2wgc2hvdWxkIGhhbmRsZSB0aGUgcm9sbGJhY2suCisKK0luIG9yZGVyIHRvICdmb3JnZXQn
IGFuIGFkZHJlc3MsIGFsbCB0aGUgYWNjZXNzIGJpdHMgKCdyd3gnKSBtdXN0IGJlIHNldC4KKwor
OkVycm9yczoKKworKiAtS1ZNX0VJTlZBTCAtIHRoZSBzcGVjaWZpZWQgYWNjZXNzIGJpdHMgY29t
YmluYXRpb24gaXMgaW52YWxpZAorKiAtS1ZNX0VJTlZBTCAtIHBhZGRpbmcgaXMgbm90IHplcm8K
KyogLUtWTV9FSU5WQUwgLSB0aGUgbWVzc2FnZSBzaXplIGlzIGludmFsaWQKKyogLUtWTV9FTk9N
RU0gLSBub3QgZW5vdWdoIG1lbW9yeSB0byBhZGQgdGhlIHBhZ2UgdHJhY2tpbmcgc3RydWN0dXJl
cworCiBFdmVudHMKID09PT09PQogCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9r
dm1faG9zdC5oIGIvYXJjaC94ODYvaW5jbHVkZS9hc20va3ZtX2hvc3QuaAppbmRleCBmYmQ5ZWNj
NDExNzcuLjY4NTE1N2NjMzZhZCAxMDA2NDQKLS0tIGEvYXJjaC94ODYvaW5jbHVkZS9hc20va3Zt
X2hvc3QuaAorKysgYi9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1faG9zdC5oCkBAIC00NSw2ICs0
NSw4IEBACiAjZGVmaW5lIEtWTV9QUklWQVRFX01FTV9TTE9UUyAzCiAjZGVmaW5lIEtWTV9NRU1f
U0xPVFNfTlVNIChLVk1fVVNFUl9NRU1fU0xPVFMgKyBLVk1fUFJJVkFURV9NRU1fU0xPVFMpCiAK
KyNpbmNsdWRlIDxhc20va3ZtaV9ob3N0Lmg+CisKICNkZWZpbmUgS1ZNX0hBTFRfUE9MTF9OU19E
RUZBVUxUIDIwMDAwMAogCiAjZGVmaW5lIEtWTV9JUlFDSElQX05VTV9QSU5TICBLVk1fSU9BUElD
X05VTV9QSU5TCmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaCBi
L2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCmluZGV4IDg3NTc3OGQ4MDE3Ni4uNWYy
NjE0YWMzYjRjIDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaAor
KysgYi9hcmNoL3g4Ni9pbmNsdWRlL2FzbS9rdm1pX2hvc3QuaApAQCAtMiw2ICsyLDggQEAKICNp
Zm5kZWYgX0FTTV9YODZfS1ZNSV9IT1NUX0gKICNkZWZpbmUgX0FTTV9YODZfS1ZNSV9IT1NUX0gK
IAorI2luY2x1ZGUgPGFzbS9rdm1fcGFnZV90cmFjay5oPgorCiBzdHJ1Y3QgbXNyX2RhdGE7CiAK
ICNkZWZpbmUgS1ZNSV9OVU1fQ1IgNQpAQCAtMzksNiArNDEsMTIgQEAgc3RydWN0IGt2bV92Y3B1
X2FyY2hfaW50cm9zcGVjdGlvbiB7CiBzdHJ1Y3Qga3ZtX2FyY2hfaW50cm9zcGVjdGlvbiB7CiB9
OwogCisjZGVmaW5lIFNMT1RTX1NJWkUgQklUU19UT19MT05HUyhLVk1fTUVNX1NMT1RTX05VTSkK
Kworc3RydWN0IGt2bWlfYXJjaF9tZW1fYWNjZXNzIHsKKwl1bnNpZ25lZCBsb25nIGFjdGl2ZVtL
Vk1fUEFHRV9UUkFDS19NQVhdW1NMT1RTX1NJWkVdOworfTsKKwogI2lmZGVmIENPTkZJR19LVk1f
SU5UUk9TUEVDVElPTgogCiBib29sIGt2bWlfbW9uaXRvcl9icF9pbnRlcmNlcHQoc3RydWN0IGt2
bV92Y3B1ICp2Y3B1LCB1MzIgZGJnKTsKZGlmZiAtLWdpdCBhL2FyY2gveDg2L2t2bS9rdm1pLmMg
Yi9hcmNoL3g4Ni9rdm0va3ZtaS5jCmluZGV4IGJlZDZlMDI2OTdjYS4uYWU2ZmVmNWE5Yjk1IDEw
MDY0NAotLS0gYS9hcmNoL3g4Ni9rdm0va3ZtaS5jCisrKyBiL2FyY2gveDg2L2t2bS9rdm1pLmMK
QEAgLTEwMDAsMyArMTAwMCw4MSBAQCBib29sIGt2bWlfbXNyX2V2ZW50KHN0cnVjdCBrdm1fdmNw
dSAqdmNwdSwgc3RydWN0IG1zcl9kYXRhICptc3IpCiAKIAlyZXR1cm4gcmV0OwogfQorCitzdGF0
aWMgY29uc3Qgc3RydWN0IHsKKwl1bnNpZ25lZCBpbnQgYWxsb3dfYml0OworCWVudW0ga3ZtX3Bh
Z2VfdHJhY2tfbW9kZSB0cmFja19tb2RlOworfSB0cmFja19tb2Rlc1tdID0geworCXsgS1ZNSV9Q
QUdFX0FDQ0VTU19SLCBLVk1fUEFHRV9UUkFDS19QUkVSRUFEIH0sCisJeyBLVk1JX1BBR0VfQUND
RVNTX1csIEtWTV9QQUdFX1RSQUNLX1BSRVdSSVRFIH0sCisJeyBLVk1JX1BBR0VfQUNDRVNTX1gs
IEtWTV9QQUdFX1RSQUNLX1BSRUVYRUMgfSwKK307CisKK3ZvaWQga3ZtaV9hcmNoX3VwZGF0ZV9w
YWdlX3RyYWNraW5nKHN0cnVjdCBrdm0gKmt2bSwKKwkJCQkgICAgc3RydWN0IGt2bV9tZW1vcnlf
c2xvdCAqc2xvdCwKKwkJCQkgICAgc3RydWN0IGt2bWlfbWVtX2FjY2VzcyAqbSkKK3sKKwlzdHJ1
Y3Qga3ZtaV9hcmNoX21lbV9hY2Nlc3MgKmFyY2ggPSAmbS0+YXJjaDsKKwlpbnQgaTsKKworCWlm
ICghc2xvdCkgeworCQlzbG90ID0gZ2ZuX3RvX21lbXNsb3Qoa3ZtLCBtLT5nZm4pOworCQlpZiAo
IXNsb3QpCisJCQlyZXR1cm47CisJfQorCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUodHJh
Y2tfbW9kZXMpOyBpKyspIHsKKwkJdW5zaWduZWQgaW50IGFsbG93X2JpdCA9IHRyYWNrX21vZGVz
W2ldLmFsbG93X2JpdDsKKwkJZW51bSBrdm1fcGFnZV90cmFja19tb2RlIG1vZGUgPSB0cmFja19t
b2Rlc1tpXS50cmFja19tb2RlOworCQlib29sIHNsb3RfdHJhY2tlZCA9IHRlc3RfYml0KHNsb3Qt
PmlkLCBhcmNoLT5hY3RpdmVbbW9kZV0pOworCisJCWlmIChtLT5hY2Nlc3MgJiBhbGxvd19iaXQp
IHsKKwkJCWlmIChzbG90X3RyYWNrZWQpIHsKKwkJCQlrdm1fc2xvdF9wYWdlX3RyYWNrX3JlbW92
ZV9wYWdlKGt2bSwgc2xvdCwKKwkJCQkJCQkJbS0+Z2ZuLCBtb2RlKTsKKwkJCQljbGVhcl9iaXQo
c2xvdC0+aWQsIGFyY2gtPmFjdGl2ZVttb2RlXSk7CisJCQl9CisJCX0gZWxzZSBpZiAoIXNsb3Rf
dHJhY2tlZCkgeworCQkJa3ZtX3Nsb3RfcGFnZV90cmFja19hZGRfcGFnZShrdm0sIHNsb3QsIG0t
PmdmbiwgbW9kZSk7CisJCQlzZXRfYml0KHNsb3QtPmlkLCBhcmNoLT5hY3RpdmVbbW9kZV0pOwor
CQl9CisJfQorfQorCitpbnQga3ZtaV9hcmNoX2NtZF9zZXRfcGFnZV9hY2Nlc3Moc3RydWN0IGt2
bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJCSAgY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAq
bXNnLAorCQkJCSAgY29uc3Qgc3RydWN0IGt2bWlfdm1fc2V0X3BhZ2VfYWNjZXNzICpyZXEpCit7
CisJY29uc3Qgc3RydWN0IGt2bWlfcGFnZV9hY2Nlc3NfZW50cnkgKmVudHJ5ID0gcmVxLT5lbnRy
aWVzOworCWNvbnN0IHN0cnVjdCBrdm1pX3BhZ2VfYWNjZXNzX2VudHJ5ICplbmQgPSByZXEtPmVu
dHJpZXMgKyByZXEtPmNvdW50OworCXU4IHVua25vd25fYml0cyA9IH4oS1ZNSV9QQUdFX0FDQ0VT
U19SIHwgS1ZNSV9QQUdFX0FDQ0VTU19XCisJCQkgICAgfCBLVk1JX1BBR0VfQUNDRVNTX1gpOwor
CWludCBlYyA9IDA7CisKKwlpZiAocmVxLT5wYWRkaW5nMSB8fCByZXEtPnBhZGRpbmcyKQorCQly
ZXR1cm4gLUtWTV9FSU5WQUw7CisKKwlpZiAobXNnLT5zaXplIDwgc3RydWN0X3NpemUocmVxLCBl
bnRyaWVzLCByZXEtPmNvdW50KSkKKwkJcmV0dXJuIC1LVk1fRUlOVkFMOworCisJZm9yICg7IGVu
dHJ5IDwgZW5kOyBlbnRyeSsrKSB7CisJCWludCByOworCisJCWlmICgoZW50cnktPmFjY2VzcyAm
IHVua25vd25fYml0cykgfHwgZW50cnktPnBhZGRpbmcxCisJCQkJfHwgZW50cnktPnBhZGRpbmcy
IHx8IGVudHJ5LT5wYWRkaW5nMykKKwkJCXIgPSAtS1ZNX0VJTlZBTDsKKwkJZWxzZQorCQkJciA9
IGt2bWlfY21kX3NldF9wYWdlX2FjY2Vzcyhrdm1pLCBlbnRyeS0+Z3BhLAorCQkJCQkJICAgICAg
ZW50cnktPmFjY2Vzcyk7CisJCWlmIChyKSB7CisJCQlrdm1pX3dhcm4oa3ZtaSwgIiVzOiAlbGx4
ICV4IHBhZGRpbmcgJXgsJXgsJXgiLAorCQkJCSAgX19mdW5jX18sIGVudHJ5LT5ncGEsIGVudHJ5
LT5hY2Nlc3MsCisJCQkJICBlbnRyeS0+cGFkZGluZzEsIGVudHJ5LT5wYWRkaW5nMiwKKwkJCQkg
IGVudHJ5LT5wYWRkaW5nMyk7CisJCQlpZiAoIWVjKQorCQkJCWVjID0gcjsKKwkJfQorCX0KKwor
CXJldHVybiBlYzsKK30KZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmggYi9p
bmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCmluZGV4IGI3MzhmMTVjZDgyNi4uYTlmNTcyZGYxODA5
IDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCisrKyBiL2luY2x1ZGUvbGlu
dXgva3ZtaV9ob3N0LmgKQEAgLTY3LDYgKzY3LDkgQEAgc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9u
IHsKIAlERUNMQVJFX0JJVE1BUCh2bV9ldmVudF9lbmFibGVfbWFzaywgS1ZNSV9OVU1fRVZFTlRT
KTsKIAogCWF0b21pY190IGV2X3NlcTsKKworCXN0cnVjdCByYWRpeF90cmVlX3Jvb3QgYWNjZXNz
X3RyZWU7CisJcndsb2NrX3QgYWNjZXNzX3RyZWVfbG9jazsKIH07CiAKICNpZmRlZiBDT05GSUdf
S1ZNX0lOVFJPU1BFQ1RJT04KZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgg
Yi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCmluZGV4IDJkMzdkNDA3ZjY1ZC4uNGI4NDYyYjgw
NTUzIDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2luY2x1ZGUv
dWFwaS9saW51eC9rdm1pLmgKQEAgLTQxLDYgKzQxLDggQEAgZW51bSB7CiAJS1ZNSV9WQ1BVX0dF
VF9NVFJSX1RZUEUgPSAxOSwKIAlLVk1JX1ZDUFVfQ09OVFJPTF9NU1IgICA9IDIwLAogCisJS1ZN
SV9WTV9TRVRfUEFHRV9BQ0NFU1MgPSAyMSwKKwogCUtWTUlfTlVNX01FU1NBR0VTCiB9OwogCkBA
IC02NCw2ICs2NiwxMiBAQCBlbnVtIHsKIAlLVk1JX0VWRU5UX0FDVElPTl9DUkFTSCAgICA9IDIs
CiB9OwogCitlbnVtIHsKKwlLVk1JX1BBR0VfQUNDRVNTX1IgPSAxIDw8IDAsCisJS1ZNSV9QQUdF
X0FDQ0VTU19XID0gMSA8PCAxLAorCUtWTUlfUEFHRV9BQ0NFU1NfWCA9IDEgPDwgMiwKK307CisK
IHN0cnVjdCBrdm1pX21zZ19oZHIgewogCV9fdTE2IGlkOwogCV9fdTE2IHNpemU7CkBAIC0xNDMs
NiArMTUxLDIxIEBAIHN0cnVjdCBrdm1pX3ZtX2dldF9tYXhfZ2ZuX3JlcGx5IHsKIAlfX3U2NCBn
Zm47CiB9OwogCitzdHJ1Y3Qga3ZtaV9wYWdlX2FjY2Vzc19lbnRyeSB7CisJX191NjQgZ3BhOwor
CV9fdTggYWNjZXNzOworCV9fdTggcGFkZGluZzE7CisJX191MTYgcGFkZGluZzI7CisJX191MzIg
cGFkZGluZzM7Cit9OworCitzdHJ1Y3Qga3ZtaV92bV9zZXRfcGFnZV9hY2Nlc3MgeworCV9fdTE2
IGNvdW50OworCV9fdTE2IHBhZGRpbmcxOworCV9fdTMyIHBhZGRpbmcyOworCXN0cnVjdCBrdm1p
X3BhZ2VfYWNjZXNzX2VudHJ5IGVudHJpZXNbMF07Cit9OworCiBzdHJ1Y3Qga3ZtaV9ldmVudCB7
CiAJX191MTYgc2l6ZTsKIAlfX3UxNiB2Y3B1OwpkaWZmIC0tZ2l0IGEvdG9vbHMvdGVzdGluZy9z
ZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3Rz
L2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKaW5kZXggN2JmMmI2NGI2MmEzLi5hMGJkNTczYWIyNjQg
MTAwNjQ0Ci0tLSBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0
LmMKKysrIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYwpA
QCAtMTUyMCw2ICsxNTIwLDc4IEBAIHN0YXRpYyB2b2lkIHRlc3RfY21kX3ZjcHVfY29udHJvbF9t
c3Ioc3RydWN0IGt2bV92bSAqdm0pCiAJCW1zciwgbXNyX2RhdGEsIGV2Lm1zci5vbGRfdmFsdWUp
OwogfQogCitzdGF0aWMgaW50IF9fY21kX3NldF9wYWdlX2FjY2VzcyhzdHJ1Y3Qga3ZtX3ZtICp2
bSwgX191MTYgY291bnQsIF9fdTY0ICpncGEsCisJCQkJIF9fdTggKmFjY2VzcykKK3sKKwlzdHJ1
Y3Qga3ZtaV9wYWdlX2FjY2Vzc19lbnRyeSAqZW50cnksICplbmQ7CisJc3RydWN0IGt2bWlfdm1f
c2V0X3BhZ2VfYWNjZXNzICpjbWQ7CisJc3RydWN0IGt2bWlfbXNnX2hkciAqcmVxOworCXNpemVf
dCByZXFfc2l6ZTsKKwlpbnQgcjsKKworCXJlcV9zaXplID0gc2l6ZW9mKCpyZXEpICsgc2l6ZW9m
KCpjbWQpICsgY291bnQgKiBzaXplb2YoKmVudHJ5KTsKKworCVRFU1RfQVNTRVJUKHJlcV9zaXpl
IDwgS1ZNSV9NU0dfU0laRSArIHNpemVvZihyZXEpLAorCQkiTWVzc2FnZSB0b28gYmlnXG4iKTsK
KworCXJlcSA9IGNhbGxvYygxLCByZXFfc2l6ZSk7CisKKwlURVNUX0FTU0VSVChyZXEsICJJbnN1
ZmZpY2llbnQgTWVtb3J5XG4iKTsKKworCWNtZCA9IChzdHJ1Y3Qga3ZtaV92bV9zZXRfcGFnZV9h
Y2Nlc3MgKikocmVxICsgMSk7CisJY21kLT5jb3VudCA9IGNvdW50OworCisJZW50cnkgPSBjbWQt
PmVudHJpZXM7CisJZW5kID0gY21kLT5lbnRyaWVzICsgY291bnQ7CisJZm9yICg7IGVudHJ5IDwg
ZW5kOyBlbnRyeSsrKSB7CisJCWVudHJ5LT5ncGEgPSAqZ3BhKys7CisJCWVudHJ5LT5hY2Nlc3Mg
PSAqYWNjZXNzKys7CisJfQorCisJciA9IGRvX2NvbW1hbmQoS1ZNSV9WTV9TRVRfUEFHRV9BQ0NF
U1MsIHJlcSwgcmVxX3NpemUsIE5VTEwsIDApOworCisJZnJlZShyZXEpOworCXJldHVybiByOwor
fQorCitzdGF0aWMgaW50IGNtZF9zZXRfcGFnZV9hY2Nlc3Moc3RydWN0IGt2bV92bSAqdm0sIF9f
dTE2IGNvdW50LCBfX3U2NCAqZ3BhLAorCQkJICAgICAgIF9fdTggKmFjY2VzcykKK3sKKwlzdHJ1
Y3QgdmNwdV93b3JrZXJfZGF0YSBkYXRhID0gey52bSA9IHZtLCAudmNwdV9pZCA9IFZDUFVfSUR9
OworCXB0aHJlYWRfdCB2Y3B1X3RocmVhZDsKKwlpbnQgcjsKKworCXZjcHVfdGhyZWFkID0gc3Rh
cnRfdmNwdV93b3JrZXIoJmRhdGEpOworCisJciA9IF9fY21kX3NldF9wYWdlX2FjY2Vzcyh2bSwg
Y291bnQsIGdwYSwgYWNjZXNzKTsKKworCXN0b3BfdmNwdV93b3JrZXIodmNwdV90aHJlYWQsICZk
YXRhKTsKKworCXJldHVybiByOworfQorCitzdGF0aWMgdm9pZCBzZXRfcGFnZV9hY2Nlc3Moc3Ry
dWN0IGt2bV92bSAqdm0sIF9fdTY0IGdwYSwgX191OCBhY2Nlc3MpCit7CisJaW50IHI7CisKKwly
ID0gY21kX3NldF9wYWdlX2FjY2Vzcyh2bSwgMSwgJmdwYSwgJmFjY2Vzcyk7CisJVEVTVF9BU1NF
UlQociA9PSAwLAorCQkiS1ZNSV9WTV9TRVRfUEFHRV9BQ0NFU1MgZmFpbGVkLCBncGEgMHglbGx4
LCBhY2Nlc3MgMHgleCwgZXJyb3IgJWQgKCVzKVxuIiwKKwkJZ3BhLCBhY2Nlc3MsIC1yLCBrdm1f
c3RyZXJyb3IoLXIpKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9jbWRfdm1fc2V0X3BhZ2VfYWNj
ZXNzKHN0cnVjdCBrdm1fdm0gKnZtKQoreworCV9fdTggZnVsbF9hY2Nlc3MgPSBLVk1JX1BBR0Vf
QUNDRVNTX1IgfCBLVk1JX1BBR0VfQUNDRVNTX1cKKwkJCXwgS1ZNSV9QQUdFX0FDQ0VTU19YOwor
CV9fdTggbm9fYWNjZXNzID0gMDsKKwlfX3U2NCBncGEgPSAwOworCisJc2V0X3BhZ2VfYWNjZXNz
KHZtLCBncGEsIG5vX2FjY2Vzcyk7CisKKwlzZXRfcGFnZV9hY2Nlc3Modm0sIGdwYSwgZnVsbF9h
Y2Nlc3MpOworfQorCiBzdGF0aWMgdm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92
bSAqdm0pCiB7CiAJc2V0dXBfc29ja2V0KCk7CkBAIC0xNTQ5LDYgKzE2MjEsNyBAQCBzdGF0aWMg
dm9pZCB0ZXN0X2ludHJvc3BlY3Rpb24oc3RydWN0IGt2bV92bSAqdm0pCiAJdGVzdF9jbWRfdmNw
dV9nZXRfbXRycl90eXBlKHZtKTsKIAl0ZXN0X2V2ZW50X2Rlc2NyaXB0b3Iodm0pOwogCXRlc3Rf
Y21kX3ZjcHVfY29udHJvbF9tc3Iodm0pOworCXRlc3RfY21kX3ZtX3NldF9wYWdlX2FjY2Vzcyh2
bSk7CiAKIAl1bmhvb2tfaW50cm9zcGVjdGlvbih2bSk7CiB9CmRpZmYgLS1naXQgYS92aXJ0L2t2
bS9pbnRyb3NwZWN0aW9uL2t2bWkuYyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCmlu
ZGV4IDkyZDE3MTlmNDk0MS4uNmU4ODczNTk3OGFlIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRy
b3NwZWN0aW9uL2t2bWkuYworKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYwpAQCAt
MTUsNiArMTUsMTEgQEAgZW51bSB7CiAKIHN0YXRpYyBzdHJ1Y3Qga21lbV9jYWNoZSAqbXNnX2Nh
Y2hlOwogc3RhdGljIHN0cnVjdCBrbWVtX2NhY2hlICpqb2JfY2FjaGU7CitzdGF0aWMgc3RydWN0
IGttZW1fY2FjaGUgKnJhZGl4X2NhY2hlOworCitzdGF0aWMgY29uc3QgdTggZnVsbF9hY2Nlc3Mg
ID0JS1ZNSV9QQUdFX0FDQ0VTU19SIHwKKwkJCQlLVk1JX1BBR0VfQUNDRVNTX1cgfAorCQkJCUtW
TUlfUEFHRV9BQ0NFU1NfWDsKIAogdm9pZCAqa3ZtaV9tc2dfYWxsb2Modm9pZCkKIHsKQEAgLTQw
LDYgKzQ1LDggQEAgc3RhdGljIHZvaWQga3ZtaV9jYWNoZV9kZXN0cm95KHZvaWQpCiAJbXNnX2Nh
Y2hlID0gTlVMTDsKIAlrbWVtX2NhY2hlX2Rlc3Ryb3koam9iX2NhY2hlKTsKIAlqb2JfY2FjaGUg
PSBOVUxMOworCWttZW1fY2FjaGVfZGVzdHJveShyYWRpeF9jYWNoZSk7CisJcmFkaXhfY2FjaGUg
PSBOVUxMOwogfQogCiBzdGF0aWMgaW50IGt2bWlfY2FjaGVfY3JlYXRlKHZvaWQpCkBAIC00OSw4
ICs1NiwxMSBAQCBzdGF0aWMgaW50IGt2bWlfY2FjaGVfY3JlYXRlKHZvaWQpCiAJam9iX2NhY2hl
ID0ga21lbV9jYWNoZV9jcmVhdGUoImt2bWlfam9iIiwKIAkJCQkgICAgICBzaXplb2Yoc3RydWN0
IGt2bWlfam9iKSwKIAkJCQkgICAgICAwLCBTTEFCX0FDQ09VTlQsIE5VTEwpOworCXJhZGl4X2Nh
Y2hlID0ga21lbV9jYWNoZV9jcmVhdGUoImt2bWlfcmFkaXhfdHJlZSIsCisJCQkJCXNpemVvZihz
dHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzKSwKKwkJCQkJMCwgU0xBQl9BQ0NPVU5ULCBOVUxMKTsKIAot
CWlmICghbXNnX2NhY2hlIHx8ICFqb2JfY2FjaGUpIHsKKwlpZiAoIW1zZ19jYWNoZSB8fCAham9i
X2NhY2hlIHx8ICFyYWRpeF9jYWNoZSkgewogCQlrdm1pX2NhY2hlX2Rlc3Ryb3koKTsKIAogCQly
ZXR1cm4gLTE7CkBAIC0xNzAsMTEgKzE4MCwzNyBAQCBzdGF0aWMgdm9pZCBmcmVlX3ZjcHVpKHN0
cnVjdCBrdm1fdmNwdSAqdmNwdSkKIAlrdm1pX21ha2VfcmVxdWVzdCh2Y3B1LCBmYWxzZSk7CiB9
CiAKK3N0YXRpYyB2b2lkIGt2bWlfY2xlYXJfbWVtX2FjY2VzcyhzdHJ1Y3Qga3ZtICprdm0pCit7
CisJc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pID0gS1ZNSShrdm0pOworCXN0cnVjdCBy
YWRpeF90cmVlX2l0ZXIgaXRlcjsKKwl2b2lkICoqc2xvdDsKKwlpbnQgaWR4OworCisJaWR4ID0g
c3JjdV9yZWFkX2xvY2soJmt2bS0+c3JjdSk7CisJc3Bpbl9sb2NrKCZrdm0tPm1tdV9sb2NrKTsK
KworCXJhZGl4X3RyZWVfZm9yX2VhY2hfc2xvdChzbG90LCAma3ZtaS0+YWNjZXNzX3RyZWUsICZp
dGVyLCAwKSB7CisJCXN0cnVjdCBrdm1pX21lbV9hY2Nlc3MgKm0gPSAqc2xvdDsKKworCQltLT5h
Y2Nlc3MgPSBmdWxsX2FjY2VzczsKKwkJa3ZtaV9hcmNoX3VwZGF0ZV9wYWdlX3RyYWNraW5nKGt2
bSwgTlVMTCwgbSk7CisKKwkJcmFkaXhfdHJlZV9pdGVyX2RlbGV0ZSgma3ZtaS0+YWNjZXNzX3Ry
ZWUsICZpdGVyLCBzbG90KTsKKwkJa21lbV9jYWNoZV9mcmVlKHJhZGl4X2NhY2hlLCBtKTsKKwl9
CisKKwlzcGluX3VubG9jaygma3ZtLT5tbXVfbG9jayk7CisJc3JjdV9yZWFkX3VubG9jaygma3Zt
LT5zcmN1LCBpZHgpOworfQorCiBzdGF0aWMgdm9pZCBmcmVlX2t2bWkoc3RydWN0IGt2bSAqa3Zt
KQogewogCXN0cnVjdCBrdm1fdmNwdSAqdmNwdTsKIAlpbnQgaTsKIAorCWt2bWlfY2xlYXJfbWVt
X2FjY2Vzcyhrdm0pOworCiAJa3ZtX2Zvcl9lYWNoX3ZjcHUoaSwgdmNwdSwga3ZtKQogCQlmcmVl
X3ZjcHVpKHZjcHUpOwogCkBAIC0yMDgsNiArMjQ0LDEwIEBAIGFsbG9jX2t2bWkoc3RydWN0IGt2
bSAqa3ZtLCBjb25zdCBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25faG9vayAqaG9vaykKIAogCWF0
b21pY19zZXQoJmt2bWktPmV2X3NlcSwgMCk7CiAKKwlJTklUX1JBRElYX1RSRUUoJmt2bWktPmFj
Y2Vzc190cmVlLAorCQkJR0ZQX0tFUk5FTCAmIH5fX0dGUF9ESVJFQ1RfUkVDTEFJTSk7CisJcnds
b2NrX2luaXQoJmt2bWktPmFjY2Vzc190cmVlX2xvY2spOworCiAJa3ZtX2Zvcl9lYWNoX3ZjcHUo
aSwgdmNwdSwga3ZtKSB7CiAJCWludCBlcnIgPSBjcmVhdGVfdmNwdWkodmNwdSk7CiAKQEAgLTk0
NCwzICs5ODQsOTQgQEAgYm9vbCBrdm1pX2VudGVyX2d1ZXN0KHN0cnVjdCBrdm1fdmNwdSAqdmNw
dSkKIAlrdm1pX3B1dCh2Y3B1LT5rdm0pOwogCXJldHVybiByOwogfQorCitzdGF0aWMgc3RydWN0
IGt2bWlfbWVtX2FjY2VzcyAqCitfX2t2bWlfZ2V0X2dmbl9hY2Nlc3Moc3RydWN0IGt2bV9pbnRy
b3NwZWN0aW9uICprdm1pLCBjb25zdCBnZm5fdCBnZm4pCit7CisJcmV0dXJuIHJhZGl4X3RyZWVf
bG9va3VwKCZrdm1pLT5hY2Nlc3NfdHJlZSwgZ2ZuKTsKK30KKworc3RhdGljIHZvaWQga3ZtaV91
cGRhdGVfbWVtX2FjY2VzcyhzdHJ1Y3Qga3ZtICprdm0sIHN0cnVjdCBrdm1pX21lbV9hY2Nlc3Mg
Km9sZCwKKwkJCQkgICBzdHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzICptKQoreworCXN0cnVjdCBrdm1f
aW50cm9zcGVjdGlvbiAqa3ZtaSA9IEtWTUkoa3ZtKTsKKwl1MzIgbmV3X2FjY2VzcyA9IG9sZC0+
YWNjZXNzID0gbS0+YWNjZXNzOworCisJa3ZtaV9hcmNoX3VwZGF0ZV9wYWdlX3RyYWNraW5nKGt2
bSwgTlVMTCwgb2xkKTsKKworCWlmIChuZXdfYWNjZXNzID09IGZ1bGxfYWNjZXNzKSB7CisJCXJh
ZGl4X3RyZWVfZGVsZXRlKCZrdm1pLT5hY2Nlc3NfdHJlZSwgb2xkLT5nZm4pOworCQlrbWVtX2Nh
Y2hlX2ZyZWUocmFkaXhfY2FjaGUsIG9sZCk7CisJfQorfQorCitzdGF0aWMgYm9vbCBrdm1pX2lu
c2VydF9tZW1fYWNjZXNzKHN0cnVjdCBrdm0gKmt2bSwgc3RydWN0IGt2bWlfbWVtX2FjY2VzcyAq
bSkKK3sKKwlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWkgPSBLVk1JKGt2bSk7CisKKwlp
ZiAoIWt2bV9pc192aXNpYmxlX2dmbihrdm0sIG0tPmdmbikpCisJCXJldHVybiBmYWxzZTsKKwor
CWlmIChtLT5hY2Nlc3MgPT0gZnVsbF9hY2Nlc3MpCisJCXJldHVybiBmYWxzZTsKKworCWt2bWlf
YXJjaF91cGRhdGVfcGFnZV90cmFja2luZyhrdm0sIE5VTEwsIG0pOworCXJhZGl4X3RyZWVfaW5z
ZXJ0KCZrdm1pLT5hY2Nlc3NfdHJlZSwgbS0+Z2ZuLCBtKTsKKworCXJldHVybiB0cnVlOworfQor
CitzdGF0aWMgdm9pZCBrdm1pX3NldF9tZW1fYWNjZXNzKHN0cnVjdCBrdm0gKmt2bSwgc3RydWN0
IGt2bWlfbWVtX2FjY2VzcyAqbSwKKwkJCQlib29sICpkb25lKQoreworCXN0cnVjdCBrdm1faW50
cm9zcGVjdGlvbiAqa3ZtaSA9IEtWTUkoa3ZtKTsKKwlzdHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzICpm
b3VuZDsKKwlpbnQgaWR4OworCisJaWR4ID0gc3JjdV9yZWFkX2xvY2soJmt2bS0+c3JjdSk7CisJ
c3Bpbl9sb2NrKCZrdm0tPm1tdV9sb2NrKTsKKwl3cml0ZV9sb2NrKCZrdm1pLT5hY2Nlc3NfdHJl
ZV9sb2NrKTsKKworCWZvdW5kID0gX19rdm1pX2dldF9nZm5fYWNjZXNzKGt2bWksIG0tPmdmbik7
CisJaWYgKGZvdW5kKQorCQlrdm1pX3VwZGF0ZV9tZW1fYWNjZXNzKGt2bSwgZm91bmQsIG0pOwor
CWVsc2UgaWYgKGt2bWlfaW5zZXJ0X21lbV9hY2Nlc3Moa3ZtLCBtKSkKKwkJKmRvbmUgPSB0cnVl
OworCisJd3JpdGVfdW5sb2NrKCZrdm1pLT5hY2Nlc3NfdHJlZV9sb2NrKTsKKwlzcGluX3VubG9j
aygma3ZtLT5tbXVfbG9jayk7CisJc3JjdV9yZWFkX3VubG9jaygma3ZtLT5zcmN1LCBpZHgpOwor
fQorCitzdGF0aWMgaW50IGt2bWlfc2V0X2dmbl9hY2Nlc3Moc3RydWN0IGt2bSAqa3ZtLCBnZm5f
dCBnZm4sIHU4IGFjY2VzcykKK3sKKwlzdHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzICptOworCWJvb2wg
ZG9uZSA9IGZhbHNlOworCWludCBlcnIgPSAwOworCisJbSA9IGttZW1fY2FjaGVfemFsbG9jKHJh
ZGl4X2NhY2hlLCBHRlBfS0VSTkVMKTsKKwlpZiAoIW0pCisJCXJldHVybiAtS1ZNX0VOT01FTTsK
KworCW0tPmdmbiA9IGdmbjsKKwltLT5hY2Nlc3MgPSBhY2Nlc3M7CisKKwlpZiAocmFkaXhfdHJl
ZV9wcmVsb2FkKEdGUF9LRVJORUwpKQorCQllcnIgPSAtS1ZNX0VOT01FTTsKKwllbHNlCisJCWt2
bWlfc2V0X21lbV9hY2Nlc3Moa3ZtLCBtLCAmZG9uZSk7CisKKwlyYWRpeF90cmVlX3ByZWxvYWRf
ZW5kKCk7CisKKwlpZiAoIWRvbmUpCisJCWttZW1fY2FjaGVfZnJlZShyYWRpeF9jYWNoZSwgbSk7
CisKKwlyZXR1cm4gZXJyOworfQorCitpbnQga3ZtaV9jbWRfc2V0X3BhZ2VfYWNjZXNzKHN0cnVj
dCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSwgdTY0IGdwYSwgdTggYWNjZXNzKQoreworCWdmbl90
IGdmbiA9IGdwYV90b19nZm4oZ3BhKTsKKworCXJldHVybiBrdm1pX3NldF9nZm5fYWNjZXNzKGt2
bWktPmt2bSwgZ2ZuLCBhY2Nlc3MpOworfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVj
dGlvbi9rdm1pX2ludC5oIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCmluZGV4
IDMzNTQ0ZGQ5ZGNlNS4uYTgxZTQwMGVhYjE3IDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3Nw
ZWN0aW9uL2t2bWlfaW50LmgKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5o
CkBAIC00Miw2ICs0Miw3IEBACiAJCQl8IEJJVChLVk1JX1ZNX0dFVF9JTkZPKSBcCiAJCQl8IEJJ
VChLVk1JX1ZNX0dFVF9NQVhfR0ZOKSBcCiAJCQl8IEJJVChLVk1JX1ZNX1JFQURfUEhZU0lDQUwp
IFwKKwkJCXwgQklUKEtWTUlfVk1fU0VUX1BBR0VfQUNDRVNTKSBcCiAJCQl8IEJJVChLVk1JX1ZN
X1dSSVRFX1BIWVNJQ0FMKSBcCiAJCQl8IEJJVChLVk1JX1ZDUFVfR0VUX0lORk8pIFwKIAkJCXwg
QklUKEtWTUlfVkNQVV9QQVVTRSkgXApAQCAtNTksNiArNjAsMTIgQEAKICNkZWZpbmUgS1ZNSShr
dm0pICgoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICopKChrdm0pLT5rdm1pKSkKICNkZWZpbmUg
VkNQVUkodmNwdSkgKChzdHJ1Y3Qga3ZtX3ZjcHVfaW50cm9zcGVjdGlvbiAqKSgodmNwdSktPmt2
bWkpKQogCitzdHJ1Y3Qga3ZtaV9tZW1fYWNjZXNzIHsKKwlnZm5fdCBnZm47CisJdTggYWNjZXNz
OworCXN0cnVjdCBrdm1pX2FyY2hfbWVtX2FjY2VzcyBhcmNoOworfTsKKwogc3RhdGljIGlubGlu
ZSBib29sIGlzX3ZtX2V2ZW50X2VuYWJsZWQoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1p
LAogCQkJCQlpbnQgZXZlbnQpCiB7CkBAIC0xMTIsNiArMTE5LDggQEAgaW50IGt2bWlfY21kX3dy
aXRlX3BoeXNpY2FsKHN0cnVjdCBrdm0gKmt2bSwgdTY0IGdwYSwgdTY0IHNpemUsCiBpbnQga3Zt
aV9jbWRfdmNwdV9wYXVzZShzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIGJvb2wgd2FpdCk7CiBpbnQg
a3ZtaV9jbWRfdmNwdV9zZXRfcmVnaXN0ZXJzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwKIAkJCQlj
b25zdCBzdHJ1Y3Qga3ZtX3JlZ3MgKnJlZ3MpOworaW50IGt2bWlfY21kX3NldF9wYWdlX2FjY2Vz
cyhzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksIHU2NCBncGEsCisJCQkgICAgIHU4IGFj
Y2Vzcyk7CiAKIC8qIGFyY2ggKi8KIGJvb2wga3ZtaV9hcmNoX3ZjcHVfYWxsb2Moc3RydWN0IGt2
bV92Y3B1ICp2Y3B1KTsKQEAgLTE0Nyw1ICsxNTYsMTEgQEAgaW50IGt2bWlfYXJjaF9jbWRfdmNw
dV9nZXRfeHNhdmUoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LAogaW50IGt2bWlfYXJjaF9jbWRfdmNw
dV9nZXRfbXRycl90eXBlKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTY0IGdwYSwgdTggKnR5cGUp
OwogaW50IGt2bWlfYXJjaF9jbWRfdmNwdV9jb250cm9sX21zcihzdHJ1Y3Qga3ZtX3ZjcHUgKnZj
cHUsCiAJCQkJICAgY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9jb250cm9sX21zciAqcmVxKTsKK3Zv
aWQga3ZtaV9hcmNoX3VwZGF0ZV9wYWdlX3RyYWNraW5nKHN0cnVjdCBrdm0gKmt2bSwKKwkJCQkg
ICAgc3RydWN0IGt2bV9tZW1vcnlfc2xvdCAqc2xvdCwKKwkJCQkgICAgc3RydWN0IGt2bWlfbWVt
X2FjY2VzcyAqbSk7CitpbnQga3ZtaV9hcmNoX2NtZF9zZXRfcGFnZV9hY2Nlc3Moc3RydWN0IGt2
bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJCSAgY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAq
bXNnLAorCQkJCSAgY29uc3Qgc3RydWN0IGt2bWlfdm1fc2V0X3BhZ2VfYWNjZXNzICpyZXEpOwog
CiAjZW5kaWYKZGlmZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYyBi
L3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwppbmRleCBhNTI1MGQ5YjliM2QuLmZk
N2M5OTkzMjk2ZiAxMDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5j
CisrKyBiL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwpAQCAtMjUsNiArMjUsNyBA
QCBzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgbXNnX0lEc1tdID0gewogCVtLVk1JX1ZNX0dFVF9J
TkZPXSAgICAgICAgICAgPSAiS1ZNSV9WTV9HRVRfSU5GTyIsCiAJW0tWTUlfVk1fR0VUX01BWF9H
Rk5dICAgICAgICA9ICJLVk1JX1ZNX0dFVF9NQVhfR0ZOIiwKIAlbS1ZNSV9WTV9SRUFEX1BIWVNJ
Q0FMXSAgICAgID0gIktWTUlfVk1fUkVBRF9QSFlTSUNBTCIsCisJW0tWTUlfVk1fU0VUX1BBR0Vf
QUNDRVNTXSAgICA9ICJLVk1JX1ZNX1NFVF9QQUdFX0FDQ0VTUyIsCiAJW0tWTUlfVk1fV1JJVEVf
UEhZU0lDQUxdICAgICA9ICJLVk1JX1ZNX1dSSVRFX1BIWVNJQ0FMIiwKIAlbS1ZNSV9WQ1BVX0NP
TlRST0xfQ1JdICAgICAgID0gIktWTUlfVkNQVV9DT05UUk9MX0NSIiwKIAlbS1ZNSV9WQ1BVX0NP
TlRST0xfRVZFTlRTXSAgID0gIktWTUlfVkNQVV9DT05UUk9MX0VWRU5UUyIsCkBAIC0zNTIsMjAg
KzM1MywzMiBAQCBzdGF0aWMgaW50IGhhbmRsZV92bV9nZXRfbWF4X2dmbihzdHJ1Y3Qga3ZtX2lu
dHJvc3BlY3Rpb24gKmt2bWksCiAJcmV0dXJuIGt2bWlfbXNnX3ZtX3JlcGx5KGt2bWksIG1zZywg
MCwgJnJwbCwgc2l6ZW9mKHJwbCkpOwogfQogCitzdGF0aWMgaW50IGhhbmRsZV9zZXRfcGFnZV9h
Y2Nlc3Moc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJCSAgY29uc3Qgc3RydWN0
IGt2bWlfbXNnX2hkciAqbXNnLAorCQkJCSAgY29uc3Qgdm9pZCAqcmVxKQoreworCWludCBlYzsK
KworCWVjID0ga3ZtaV9hcmNoX2NtZF9zZXRfcGFnZV9hY2Nlc3Moa3ZtaSwgbXNnLCByZXEpOwor
CisJcmV0dXJuIGt2bWlfbXNnX3ZtX3JlcGx5KGt2bWksIG1zZywgZWMsIE5VTEwsIDApOworfQor
CiAvKgogICogVGhlc2UgY29tbWFuZHMgYXJlIGV4ZWN1dGVkIGJ5IHRoZSByZWNlaXZpbmcgdGhy
ZWFkL3dvcmtlci4KICAqLwogc3RhdGljIGludCgqY29uc3QgbXNnX3ZtW10pKHN0cnVjdCBrdm1f
aW50cm9zcGVjdGlvbiAqLAogCQkJICAgIGNvbnN0IHN0cnVjdCBrdm1pX21zZ19oZHIgKiwgY29u
c3Qgdm9pZCAqKSA9IHsKLQlbS1ZNSV9HRVRfVkVSU0lPTl0gICAgICAgPSBoYW5kbGVfZ2V0X3Zl
cnNpb24sCi0JW0tWTUlfVk1fQ0hFQ0tfQ09NTUFORF0gID0gaGFuZGxlX2NoZWNrX2NvbW1hbmQs
Ci0JW0tWTUlfVk1fQ0hFQ0tfRVZFTlRdICAgID0gaGFuZGxlX2NoZWNrX2V2ZW50LAotCVtLVk1J
X1ZNX0NPTlRST0xfRVZFTlRTXSA9IGhhbmRsZV92bV9jb250cm9sX2V2ZW50cywKLQlbS1ZNSV9W
TV9HRVRfSU5GT10gICAgICAgPSBoYW5kbGVfZ2V0X2luZm8sCi0JW0tWTUlfVk1fR0VUX01BWF9H
Rk5dICAgID0gaGFuZGxlX3ZtX2dldF9tYXhfZ2ZuLAotCVtLVk1JX1ZNX1JFQURfUEhZU0lDQUxd
ICA9IGhhbmRsZV9yZWFkX3BoeXNpY2FsLAotCVtLVk1JX1ZNX1dSSVRFX1BIWVNJQ0FMXSA9IGhh
bmRsZV93cml0ZV9waHlzaWNhbCwKLQlbS1ZNSV9WQ1BVX1BBVVNFXSAgICAgICAgPSBoYW5kbGVf
cGF1c2VfdmNwdSwKKwlbS1ZNSV9HRVRfVkVSU0lPTl0gICAgICAgID0gaGFuZGxlX2dldF92ZXJz
aW9uLAorCVtLVk1JX1ZNX0NIRUNLX0NPTU1BTkRdICAgPSBoYW5kbGVfY2hlY2tfY29tbWFuZCwK
KwlbS1ZNSV9WTV9DSEVDS19FVkVOVF0gICAgID0gaGFuZGxlX2NoZWNrX2V2ZW50LAorCVtLVk1J
X1ZNX0NPTlRST0xfRVZFTlRTXSAgPSBoYW5kbGVfdm1fY29udHJvbF9ldmVudHMsCisJW0tWTUlf
Vk1fR0VUX0lORk9dICAgICAgICA9IGhhbmRsZV9nZXRfaW5mbywKKwlbS1ZNSV9WTV9HRVRfTUFY
X0dGTl0gICAgID0gaGFuZGxlX3ZtX2dldF9tYXhfZ2ZuLAorCVtLVk1JX1ZNX1JFQURfUEhZU0lD
QUxdICAgPSBoYW5kbGVfcmVhZF9waHlzaWNhbCwKKwlbS1ZNSV9WTV9TRVRfUEFHRV9BQ0NFU1Nd
ID0gaGFuZGxlX3NldF9wYWdlX2FjY2VzcywKKwlbS1ZNSV9WTV9XUklURV9QSFlTSUNBTF0gID0g
aGFuZGxlX3dyaXRlX3BoeXNpY2FsLAorCVtLVk1JX1ZDUFVfUEFVU0VdICAgICAgICAgPSBoYW5k
bGVfcGF1c2VfdmNwdSwKIH07CiAKIHN0YXRpYyBpbnQgaGFuZGxlX2dldF92Y3B1X2luZm8oY29u
c3Qgc3RydWN0IGt2bWlfdmNwdV9jbWRfam9iICpqb2IsCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0
dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4
Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
