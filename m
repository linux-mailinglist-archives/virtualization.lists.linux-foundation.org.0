Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp3.osuosl.org (smtp3.osuosl.org [140.211.166.136])
	by mail.lfdr.de (Postfix) with ESMTPS id 3F2B16C7202
	for <lists.virtualization@lfdr.de>; Thu, 23 Mar 2023 21:58:33 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp3.osuosl.org (Postfix) with ESMTP id 16A3260E42;
	Thu, 23 Mar 2023 20:58:31 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 16A3260E42
Authentication-Results: smtp3.osuosl.org;
	dkim=fail reason="signature verification failed" (2048-bit key) header.d=gmail.com header.i=@gmail.com header.a=rsa-sha256 header.s=20210112 header.b=k8/kbzfP
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp3.osuosl.org ([127.0.0.1])
	by localhost (smtp3.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id ybHrcoqTmCHa; Thu, 23 Mar 2023 20:58:28 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [IPv6:2605:bc80:3010:104::8cd3:938])
	by smtp3.osuosl.org (Postfix) with ESMTPS id 1C90F615AD;
	Thu, 23 Mar 2023 20:58:28 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp3.osuosl.org 1C90F615AD
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 38D4FC008A;
	Thu, 23 Mar 2023 20:58:27 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id B69E5C0032
 for <virtualization@lists.linux-foundation.org>;
 Thu, 23 Mar 2023 20:58:25 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id 7E2F680C16
 for <virtualization@lists.linux-foundation.org>;
 Thu, 23 Mar 2023 20:58:25 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 7E2F680C16
Authentication-Results: smtp1.osuosl.org;
 dkim=pass (2048-bit key) header.d=gmail.com header.i=@gmail.com
 header.a=rsa-sha256 header.s=20210112 header.b=k8/kbzfP
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Dyyl_nDLD1sb
 for <virtualization@lists.linux-foundation.org>;
 Thu, 23 Mar 2023 20:58:24 +0000 (UTC)
X-Greylist: whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 3346E808B0
Received: from mail-oi1-x22c.google.com (mail-oi1-x22c.google.com
 [IPv6:2607:f8b0:4864:20::22c])
 by smtp1.osuosl.org (Postfix) with ESMTPS id 3346E808B0
 for <virtualization@lists.linux-foundation.org>;
 Thu, 23 Mar 2023 20:58:24 +0000 (UTC)
Received: by mail-oi1-x22c.google.com with SMTP id l18so3570304oic.13
 for <virtualization@lists.linux-foundation.org>;
 Thu, 23 Mar 2023 13:58:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20210112; t=1679605103;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:from:to:cc:subject:date
 :message-id:reply-to;
 bh=LJokjdq98cQ3XjpUvB+9HOyzzUBkPupsxZ8j8mSC1Kg=;
 b=k8/kbzfPpThQ/ZnJ5Yy/w9ayTJINc8eHiH+cAhoUh1EDM9QPbVkh4Nc5CrmDi/EPDa
 WcE4MiNPoFx0jhSLODf+R9E5n+3PZyMK95X4/cYAA/1t49BHca9sn5YA6dpt366pMOqM
 BS4eTTl52tmJ3m0qILcpTJY5QnGlnhRfSmu5yxTx5XUnAJX7YIZf2s2RmIe7vX66yd2/
 alqQWZwyNAFuVb9abfsW95Z7yxnZbsaMLCemoH080Qx81vREbE4iOR/2X6JFMPHW/lCT
 2dh7DM40uCUqvTPkYwKs39Eao2Dq6QM2Ur2pGsv3linVapLbqUbThth1eJuUxv566TkF
 9JbA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112; t=1679605103;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=LJokjdq98cQ3XjpUvB+9HOyzzUBkPupsxZ8j8mSC1Kg=;
 b=NtjwGGet0j+of8jLV5QupppjtHZl+tmbW2lrx42dL87x0cd/atkxj66ga1amesABtb
 MajC/BBYVwwMJ1pvq/6S4XWqKBTtNQ45ArOc30orvYEFEa52xq/kPInmj63RKm3GYy9l
 BaQIgylm+I9Psi1vKr+gnix6Yisj7Z7HeTHOsX1Cm9JvgENMxcBAJrgEZSi5C3NeS0oS
 feIcTG0Io9RrYh+Fo3poLLJdHlG2+ekONZ4LC376+irvCwCTQ3TnAd/jJDwprWxT68Xj
 lLidI8w0GMkxQjo7erIXurJp666JbNCkUBO4m0fNR4oAHudVw1GTwlkZAluRqTrw2p8e
 tvlA==
X-Gm-Message-State: AO0yUKXbY0mU4msSetUK30dFwuvirmEPLyyQdACTekQDJHXW9WgGJ6ua
 DWOuINx8ZzWNSNJy8V/pbitZxXXM401NWhRRkEw=
X-Google-Smtp-Source: AK7set9GdP4eMULq4fedqrhCD0+6rFeLNqbaROe3yGBNgr8n7NuQNLlX0G4Z/TW+/9/nVh38RuZGLuJ/PevzFMseVmk=
X-Received: by 2002:a54:4716:0:b0:384:1e6a:bf10 with SMTP id
 k22-20020a544716000000b003841e6abf10mr13983oik.5.1679605103190; Thu, 23 Mar
 2023 13:58:23 -0700 (PDT)
MIME-Version: 1.0
References: <20230323190340.950875-1-dmitry.osipenko@collabora.com>
 <20230323190340.950875-2-dmitry.osipenko@collabora.com>
In-Reply-To: <20230323190340.950875-2-dmitry.osipenko@collabora.com>
From: Rob Clark <robdclark@gmail.com>
Date: Thu, 23 Mar 2023 13:58:12 -0700
Message-ID: <CAF6AEGs5q_2bKSjZps6BXF9zq0DUe=fRw-hah35BmWtR0JBO9Q@mail.gmail.com>
Subject: Re: [PATCH v3 1/2] drm/virtio: Refactor job submission code path
To: Dmitry Osipenko <dmitry.osipenko@collabora.com>
Cc: Pierre-Eric Pelloux-Prayer <pierre-eric.pelloux-prayer@amd.com>,
 =?UTF-8?B?TWFyZWsgT2zFocOhaw==?= <maraeo@gmail.com>,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 Gurchetan Singh <gurchetansingh@chromium.org>, Daniel Vetter <daniel@ffwll.ch>,
 David Airlie <airlied@redhat.com>, kernel@collabora.com,
 virtualization@lists.linux-foundation.org, Chia-I Wu <olvaffe@gmail.com>,
 Emil Velikov <emil.velikov@collabora.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVGh1LCBNYXIgMjMsIDIwMjMgYXQgMTI6MDXigK9QTSBEbWl0cnkgT3NpcGVua28KPGRtaXRy
eS5vc2lwZW5rb0Bjb2xsYWJvcmEuY29tPiB3cm90ZToKPgo+IE1vdmUgdmlydGlvX2dwdV9leGVj
YnVmZmVyX2lvY3RsKCkgaW50byBzZXBhcmF0ZSB2aXJ0Z3B1X3N1Ym1pdC5jIGZpbGUKPiBhbmQg
cmVmYWN0b3IgdGhlIGNvZGUgYWxvbmcgdGhlIHdheSB0byBlYXNlIGFkZGl0aW9uIG9mIG5ldyBm
ZWF0dXJlcyB0bwo+IHRoZSBpb2N0bC4KPgo+IFNpZ25lZC1vZmYtYnk6IERtaXRyeSBPc2lwZW5r
byA8ZG1pdHJ5Lm9zaXBlbmtvQGNvbGxhYm9yYS5jb20+CgpSZXZpZXdlZC1ieTogUm9iIENsYXJr
IDxyb2JkY2xhcmtAZ21haWwuY29tPgoKPiAtLS0KPiAgZHJpdmVycy9ncHUvZHJtL3ZpcnRpby9N
YWtlZmlsZSAgICAgICAgIHwgICAyICstCj4gIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdw
dV9kcnYuaCAgICB8ICAgNCArCj4gIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9pb2N0
bC5jICB8IDE4MiAtLS0tLS0tLS0tLS0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRn
cHVfc3VibWl0LmMgfCAzMDIgKysrKysrKysrKysrKysrKysrKysrKysrCj4gIDQgZmlsZXMgY2hh
bmdlZCwgMzA3IGluc2VydGlvbnMoKyksIDE4MyBkZWxldGlvbnMoLSkKPiAgY3JlYXRlIG1vZGUg
MTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9zdWJtaXQuYwo+Cj4gZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0v
dmlydGlvL01ha2VmaWxlCj4gaW5kZXggYjk5ZmE0YTczYjY4Li5kMmUxNzg4YTgyMjcgMTAwNjQ0
Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby9NYWtlZmlsZQo+ICsrKyBiL2RyaXZlcnMv
Z3B1L2RybS92aXJ0aW8vTWFrZWZpbGUKPiBAQCAtNiw2ICs2LDYgQEAKPiAgdmlydGlvLWdwdS15
IDo9IHZpcnRncHVfZHJ2Lm8gdmlydGdwdV9rbXMubyB2aXJ0Z3B1X2dlbS5vIHZpcnRncHVfdnJh
bS5vIFwKPiAgICAgICAgIHZpcnRncHVfZGlzcGxheS5vIHZpcnRncHVfdnEubyBcCj4gICAgICAg
ICB2aXJ0Z3B1X2ZlbmNlLm8gdmlydGdwdV9vYmplY3QubyB2aXJ0Z3B1X2RlYnVnZnMubyB2aXJ0
Z3B1X3BsYW5lLm8gXAo+IC0gICAgICAgdmlydGdwdV9pb2N0bC5vIHZpcnRncHVfcHJpbWUubyB2
aXJ0Z3B1X3RyYWNlX3BvaW50cy5vCj4gKyAgICAgICB2aXJ0Z3B1X2lvY3RsLm8gdmlydGdwdV9w
cmltZS5vIHZpcnRncHVfdHJhY2VfcG9pbnRzLm8gdmlydGdwdV9zdWJtaXQubwo+Cj4gIG9iai0k
KENPTkZJR19EUk1fVklSVElPX0dQVSkgKz0gdmlydGlvLWdwdS5vCj4gZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0
aW8vdmlydGdwdV9kcnYuaAo+IGluZGV4IGFmNmZmYjY5NjA4Ni4uNDEyNmMzODQyODZiIDEwMDY0
NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaAo+ICsrKyBiL2Ry
aXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaAo+IEBAIC00ODYsNCArNDg2LDggQEAg
dm9pZCB2aXJ0aW9fZ3B1X3ZyYW1fdW5tYXBfZG1hX2J1ZihzdHJ1Y3QgZGV2aWNlICpkZXYsCj4g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnNndCwK
PiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0
aW9uIGRpcik7Cj4KPiArLyogdmlydGdwdV9zdWJtaXQuYyAqLwo+ICtpbnQgdmlydGlvX2dwdV9l
eGVjYnVmZmVyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCj4gKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOwo+ICsK
PiAgI2VuZGlmCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9p
b2N0bC5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMKPiBpbmRleCBk
YTQ1MjE1YTkzM2QuLmIyNGIxMWYyNTE5NyAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0v
dmlydGlvL3ZpcnRncHVfaW9jdGwuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmly
dGdwdV9pb2N0bC5jCj4gQEAgLTM4LDM2ICszOCw2IEBACj4gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgVklSVEdQVV9CTE9CX0ZMQUdfVVNFX1NIQVJFQUJMRSB8IFwKPiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWSVJUR1BVX0JMT0JfRkxBR19VU0VfQ1JP
U1NfREVWSUNFKQo+Cj4gLXN0YXRpYyBpbnQgdmlydGlvX2dwdV9mZW5jZV9ldmVudF9jcmVhdGUo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKPiAtICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlICpmZW5jZSwKPiAtICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IHJpbmdfaWR4KQo+
IC17Cj4gLSAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9mcHJpdiAqdmZwcml2ID0gZmlsZS0+ZHJp
dmVyX3ByaXY7Cj4gLSAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZV9ldmVudCAqZSA9IE5V
TEw7Cj4gLSAgICAgICBpbnQgcmV0Owo+IC0KPiAtICAgICAgIGlmICghKHZmcHJpdi0+cmluZ19p
ZHhfbWFzayAmIEJJVF9VTEwocmluZ19pZHgpKSkKPiAtICAgICAgICAgICAgICAgcmV0dXJuIDA7
Cj4gLQo+IC0gICAgICAgZSA9IGt6YWxsb2Moc2l6ZW9mKCplKSwgR0ZQX0tFUk5FTCk7Cj4gLSAg
ICAgICBpZiAoIWUpCj4gLSAgICAgICAgICAgICAgIHJldHVybiAtRU5PTUVNOwo+IC0KPiAtICAg
ICAgIGUtPmV2ZW50LnR5cGUgPSBWSVJUR1BVX0VWRU5UX0ZFTkNFX1NJR05BTEVEOwo+IC0gICAg
ICAgZS0+ZXZlbnQubGVuZ3RoID0gc2l6ZW9mKGUtPmV2ZW50KTsKPiAtCj4gLSAgICAgICByZXQg
PSBkcm1fZXZlbnRfcmVzZXJ2ZV9pbml0KGRldiwgZmlsZSwgJmUtPmJhc2UsICZlLT5ldmVudCk7
Cj4gLSAgICAgICBpZiAocmV0KQo+IC0gICAgICAgICAgICAgICBnb3RvIGZyZWU7Cj4gLQo+IC0g
ICAgICAgZmVuY2UtPmUgPSBlOwo+IC0gICAgICAgcmV0dXJuIDA7Cj4gLWZyZWU6Cj4gLSAgICAg
ICBrZnJlZShlKTsKPiAtICAgICAgIHJldHVybiByZXQ7Cj4gLX0KPiAtCj4gIC8qIE11c3QgYmUg
Y2FsbGVkIHdpdGggJnZpcnRpb19ncHVfZnByaXYuc3RydWN0X211dGV4IGhlbGQuICovCj4gIHN0
YXRpYyB2b2lkIHZpcnRpb19ncHVfY3JlYXRlX2NvbnRleHRfbG9ja2VkKHN0cnVjdCB2aXJ0aW9f
Z3B1X2RldmljZSAqdmdkZXYsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RydWN0IHZpcnRpb19ncHVfZnByaXYgKnZmcHJpdikKPiBAQCAtMTA4LDE1OCAr
NzgsNiBAQCBzdGF0aWMgaW50IHZpcnRpb19ncHVfbWFwX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsIHZvaWQgKmRhdGEsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmdmlydGlvX2dwdV9tYXAtPm9mZnNldCk7Cj4gIH0KPgo+IC0vKgo+IC0gKiBVc2FnZSBv
ZiBleGVjYnVmZmVyOgo+IC0gKiBSZWxvY2F0aW9ucyBuZWVkIHRvIHRha2UgaW50byBhY2NvdW50
IHRoZSBmdWxsIFZJUlRJT19HUFVEcmF3YWJsZSBzaXplLgo+IC0gKiBIb3dldmVyLCB0aGUgY29t
bWFuZCBhcyBwYXNzZWQgZnJvbSB1c2VyIHNwYWNlIG11c3QgKm5vdCogY29udGFpbiB0aGUgaW5p
dGlhbAo+IC0gKiBWSVJUSU9fR1BVUmVsZWFzZUluZm8gc3RydWN0IChmaXJzdCBYWFggYnl0ZXMp
Cj4gLSAqLwo+IC1zdGF0aWMgaW50IHZpcnRpb19ncHVfZXhlY2J1ZmZlcl9pb2N0bChzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKPiAtewo+IC0gICAgICAgc3RydWN0IGRybV92
aXJ0Z3B1X2V4ZWNidWZmZXIgKmV4YnVmID0gZGF0YTsKPiAtICAgICAgIHN0cnVjdCB2aXJ0aW9f
Z3B1X2RldmljZSAqdmdkZXYgPSBkZXYtPmRldl9wcml2YXRlOwo+IC0gICAgICAgc3RydWN0IHZp
cnRpb19ncHVfZnByaXYgKnZmcHJpdiA9IGZpbGUtPmRyaXZlcl9wcml2Owo+IC0gICAgICAgc3Ry
dWN0IHZpcnRpb19ncHVfZmVuY2UgKm91dF9mZW5jZTsKPiAtICAgICAgIGludCByZXQ7Cj4gLSAg
ICAgICB1aW50MzJfdCAqYm9faGFuZGxlcyA9IE5VTEw7Cj4gLSAgICAgICB2b2lkIF9fdXNlciAq
dXNlcl9ib19oYW5kbGVzID0gTlVMTDsKPiAtICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVj
dF9hcnJheSAqYnVmbGlzdCA9IE5VTEw7Cj4gLSAgICAgICBzdHJ1Y3Qgc3luY19maWxlICpzeW5j
X2ZpbGU7Cj4gLSAgICAgICBpbnQgb3V0X2ZlbmNlX2ZkID0gLTE7Cj4gLSAgICAgICB2b2lkICpi
dWY7Cj4gLSAgICAgICB1aW50NjRfdCBmZW5jZV9jdHg7Cj4gLSAgICAgICB1aW50MzJfdCByaW5n
X2lkeDsKPiAtCj4gLSAgICAgICBmZW5jZV9jdHggPSB2Z2Rldi0+ZmVuY2VfZHJ2LmNvbnRleHQ7
Cj4gLSAgICAgICByaW5nX2lkeCA9IDA7Cj4gLQo+IC0gICAgICAgaWYgKHZnZGV2LT5oYXNfdmly
Z2xfM2QgPT0gZmFsc2UpCj4gLSAgICAgICAgICAgICAgIHJldHVybiAtRU5PU1lTOwo+IC0KPiAt
ICAgICAgIGlmICgoZXhidWYtPmZsYWdzICYgflZJUlRHUFVfRVhFQ0JVRl9GTEFHUykpCj4gLSAg
ICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwo+IC0KPiAtICAgICAgIGlmICgoZXhidWYtPmZs
YWdzICYgVklSVEdQVV9FWEVDQlVGX1JJTkdfSURYKSkgewo+IC0gICAgICAgICAgICAgICBpZiAo
ZXhidWYtPnJpbmdfaWR4ID49IHZmcHJpdi0+bnVtX3JpbmdzKQo+IC0gICAgICAgICAgICAgICAg
ICAgICAgIHJldHVybiAtRUlOVkFMOwo+IC0KPiAtICAgICAgICAgICAgICAgaWYgKCF2ZnByaXYt
PmJhc2VfZmVuY2VfY3R4KQo+IC0gICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFM
Owo+IC0KPiAtICAgICAgICAgICAgICAgZmVuY2VfY3R4ID0gdmZwcml2LT5iYXNlX2ZlbmNlX2N0
eDsKPiAtICAgICAgICAgICAgICAgcmluZ19pZHggPSBleGJ1Zi0+cmluZ19pZHg7Cj4gLSAgICAg
ICB9Cj4gLQo+IC0gICAgICAgdmlydGlvX2dwdV9jcmVhdGVfY29udGV4dChkZXYsIGZpbGUpOwo+
IC0gICAgICAgaWYgKGV4YnVmLT5mbGFncyAmIFZJUlRHUFVfRVhFQ0JVRl9GRU5DRV9GRF9JTikg
ewo+IC0gICAgICAgICAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICppbl9mZW5jZTsKPiAtCj4gLSAg
ICAgICAgICAgICAgIGluX2ZlbmNlID0gc3luY19maWxlX2dldF9mZW5jZShleGJ1Zi0+ZmVuY2Vf
ZmQpOwo+IC0KPiAtICAgICAgICAgICAgICAgaWYgKCFpbl9mZW5jZSkKPiAtICAgICAgICAgICAg
ICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsKPiAtCj4gLSAgICAgICAgICAgICAgIC8qCj4gLSAg
ICAgICAgICAgICAgICAqIFdhaXQgaWYgdGhlIGZlbmNlIGlzIGZyb20gYSBmb3JlaWduIGNvbnRl
eHQsIG9yIGlmIHRoZSBmZW5jZQo+IC0gICAgICAgICAgICAgICAgKiBhcnJheSBjb250YWlucyBh
bnkgZmVuY2UgZnJvbSBhIGZvcmVpZ24gY29udGV4dC4KPiAtICAgICAgICAgICAgICAgICovCj4g
LSAgICAgICAgICAgICAgIHJldCA9IDA7Cj4gLSAgICAgICAgICAgICAgIGlmICghZG1hX2ZlbmNl
X21hdGNoX2NvbnRleHQoaW5fZmVuY2UsIGZlbmNlX2N0eCArIHJpbmdfaWR4KSkKPiAtICAgICAg
ICAgICAgICAgICAgICAgICByZXQgPSBkbWFfZmVuY2Vfd2FpdChpbl9mZW5jZSwgdHJ1ZSk7Cj4g
LQo+IC0gICAgICAgICAgICAgICBkbWFfZmVuY2VfcHV0KGluX2ZlbmNlKTsKPiAtICAgICAgICAg
ICAgICAgaWYgKHJldCkKPiAtICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+IC0g
ICAgICAgfQo+IC0KPiAtICAgICAgIGlmIChleGJ1Zi0+ZmxhZ3MgJiBWSVJUR1BVX0VYRUNCVUZf
RkVOQ0VfRkRfT1VUKSB7Cj4gLSAgICAgICAgICAgICAgIG91dF9mZW5jZV9mZCA9IGdldF91bnVz
ZWRfZmRfZmxhZ3MoT19DTE9FWEVDKTsKPiAtICAgICAgICAgICAgICAgaWYgKG91dF9mZW5jZV9m
ZCA8IDApCj4gLSAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG91dF9mZW5jZV9mZDsKPiAt
ICAgICAgIH0KPiAtCj4gLSAgICAgICBpZiAoZXhidWYtPm51bV9ib19oYW5kbGVzKSB7Cj4gLSAg
ICAgICAgICAgICAgIGJvX2hhbmRsZXMgPSBrdm1hbGxvY19hcnJheShleGJ1Zi0+bnVtX2JvX2hh
bmRsZXMsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXpl
b2YodWludDMyX3QpLCBHRlBfS0VSTkVMKTsKPiAtICAgICAgICAgICAgICAgaWYgKCFib19oYW5k
bGVzKSB7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gLUVOT01FTTsKPiAtICAgICAg
ICAgICAgICAgICAgICAgICBnb3RvIG91dF91bnVzZWRfZmQ7Cj4gLSAgICAgICAgICAgICAgIH0K
PiAtCj4gLSAgICAgICAgICAgICAgIHVzZXJfYm9faGFuZGxlcyA9IHU2NF90b191c2VyX3B0cihl
eGJ1Zi0+Ym9faGFuZGxlcyk7Cj4gLSAgICAgICAgICAgICAgIGlmIChjb3B5X2Zyb21fdXNlcihi
b19oYW5kbGVzLCB1c2VyX2JvX2hhbmRsZXMsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBleGJ1Zi0+bnVtX2JvX2hhbmRsZXMgKiBzaXplb2YodWludDMyX3QpKSkgewo+IC0g
ICAgICAgICAgICAgICAgICAgICAgIHJldCA9IC1FRkFVTFQ7Cj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgZ290byBvdXRfdW51c2VkX2ZkOwo+IC0gICAgICAgICAgICAgICB9Cj4gLQo+IC0gICAg
ICAgICAgICAgICBidWZsaXN0ID0gdmlydGlvX2dwdV9hcnJheV9mcm9tX2hhbmRsZXMoZmlsZSwg
Ym9faGFuZGxlcywKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGV4YnVmLT5udW1fYm9faGFuZGxlcyk7Cj4gLSAgICAgICAgICAgICAgIGlm
ICghYnVmbGlzdCkgewo+IC0gICAgICAgICAgICAgICAgICAgICAgIHJldCA9IC1FTk9FTlQ7Cj4g
LSAgICAgICAgICAgICAgICAgICAgICAgZ290byBvdXRfdW51c2VkX2ZkOwo+IC0gICAgICAgICAg
ICAgICB9Cj4gLSAgICAgICAgICAgICAgIGt2ZnJlZShib19oYW5kbGVzKTsKPiAtICAgICAgICAg
ICAgICAgYm9faGFuZGxlcyA9IE5VTEw7Cj4gLSAgICAgICB9Cj4gLQo+IC0gICAgICAgYnVmID0g
dm1lbWR1cF91c2VyKHU2NF90b191c2VyX3B0cihleGJ1Zi0+Y29tbWFuZCksIGV4YnVmLT5zaXpl
KTsKPiAtICAgICAgIGlmIChJU19FUlIoYnVmKSkgewo+IC0gICAgICAgICAgICAgICByZXQgPSBQ
VFJfRVJSKGJ1Zik7Cj4gLSAgICAgICAgICAgICAgIGdvdG8gb3V0X3VudXNlZF9mZDsKPiAtICAg
ICAgIH0KPiAtCj4gLSAgICAgICBpZiAoYnVmbGlzdCkgewo+IC0gICAgICAgICAgICAgICByZXQg
PSB2aXJ0aW9fZ3B1X2FycmF5X2xvY2tfcmVzdihidWZsaXN0KTsKPiAtICAgICAgICAgICAgICAg
aWYgKHJldCkKPiAtICAgICAgICAgICAgICAgICAgICAgICBnb3RvIG91dF9tZW1kdXA7Cj4gLSAg
ICAgICB9Cj4gLQo+IC0gICAgICAgb3V0X2ZlbmNlID0gdmlydGlvX2dwdV9mZW5jZV9hbGxvYyh2
Z2RldiwgZmVuY2VfY3R4LCByaW5nX2lkeCk7Cj4gLSAgICAgICBpZighb3V0X2ZlbmNlKSB7Cj4g
LSAgICAgICAgICAgICAgIHJldCA9IC1FTk9NRU07Cj4gLSAgICAgICAgICAgICAgIGdvdG8gb3V0
X3VucmVzdjsKPiAtICAgICAgIH0KPiAtCj4gLSAgICAgICByZXQgPSB2aXJ0aW9fZ3B1X2ZlbmNl
X2V2ZW50X2NyZWF0ZShkZXYsIGZpbGUsIG91dF9mZW5jZSwgcmluZ19pZHgpOwo+IC0gICAgICAg
aWYgKHJldCkKPiAtICAgICAgICAgICAgICAgZ290byBvdXRfdW5yZXN2Owo+IC0KPiAtICAgICAg
IGlmIChvdXRfZmVuY2VfZmQgPj0gMCkgewo+IC0gICAgICAgICAgICAgICBzeW5jX2ZpbGUgPSBz
eW5jX2ZpbGVfY3JlYXRlKCZvdXRfZmVuY2UtPmYpOwo+IC0gICAgICAgICAgICAgICBpZiAoIXN5
bmNfZmlsZSkgewo+IC0gICAgICAgICAgICAgICAgICAgICAgIGRtYV9mZW5jZV9wdXQoJm91dF9m
ZW5jZS0+Zik7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gLUVOT01FTTsKPiAtICAg
ICAgICAgICAgICAgICAgICAgICBnb3RvIG91dF91bnJlc3Y7Cj4gLSAgICAgICAgICAgICAgIH0K
PiAtCj4gLSAgICAgICAgICAgICAgIGV4YnVmLT5mZW5jZV9mZCA9IG91dF9mZW5jZV9mZDsKPiAt
ICAgICAgICAgICAgICAgZmRfaW5zdGFsbChvdXRfZmVuY2VfZmQsIHN5bmNfZmlsZS0+ZmlsZSk7
Cj4gLSAgICAgICB9Cj4gLQo+IC0gICAgICAgdmlydGlvX2dwdV9jbWRfc3VibWl0KHZnZGV2LCBi
dWYsIGV4YnVmLT5zaXplLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZmcHJpdi0+
Y3R4X2lkLCBidWZsaXN0LCBvdXRfZmVuY2UpOwo+IC0gICAgICAgZG1hX2ZlbmNlX3B1dCgmb3V0
X2ZlbmNlLT5mKTsKPiAtICAgICAgIHZpcnRpb19ncHVfbm90aWZ5KHZnZGV2KTsKPiAtICAgICAg
IHJldHVybiAwOwo+IC0KPiAtb3V0X3VucmVzdjoKPiAtICAgICAgIGlmIChidWZsaXN0KQo+IC0g
ICAgICAgICAgICAgICB2aXJ0aW9fZ3B1X2FycmF5X3VubG9ja19yZXN2KGJ1Zmxpc3QpOwo+IC1v
dXRfbWVtZHVwOgo+IC0gICAgICAga3ZmcmVlKGJ1Zik7Cj4gLW91dF91bnVzZWRfZmQ6Cj4gLSAg
ICAgICBrdmZyZWUoYm9faGFuZGxlcyk7Cj4gLSAgICAgICBpZiAoYnVmbGlzdCkKPiAtICAgICAg
ICAgICAgICAgdmlydGlvX2dwdV9hcnJheV9wdXRfZnJlZShidWZsaXN0KTsKPiAtCj4gLSAgICAg
ICBpZiAob3V0X2ZlbmNlX2ZkID49IDApCj4gLSAgICAgICAgICAgICAgIHB1dF91bnVzZWRfZmQo
b3V0X2ZlbmNlX2ZkKTsKPiAtCj4gLSAgICAgICByZXR1cm4gcmV0Owo+IC19Cj4gLQo+ICBzdGF0
aWMgaW50IHZpcnRpb19ncHVfZ2V0cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
dm9pZCAqZGF0YSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGRybV9maWxlICpmaWxlKQo+ICB7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0
aW8vdmlydGdwdV9zdWJtaXQuYyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9zdWJt
aXQuYwo+IG5ldyBmaWxlIG1vZGUgMTAwNjQ0Cj4gaW5kZXggMDAwMDAwMDAwMDAwLi4yY2UyNDU5
YzZiYzIKPiAtLS0gL2Rldi9udWxsCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0
Z3B1X3N1Ym1pdC5jCj4gQEAgLTAsMCArMSwzMDIgQEAKPiArLy8gU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IE1JVAo+ICsvKgo+ICsgKiBDb3B5cmlnaHQgKEMpIDIwMTUgUmVkIEhhdCwgSW5jLgo+
ICsgKiBBbGwgUmlnaHRzIFJlc2VydmVkLgo+ICsgKgo+ICsgKiBBdXRob3JzOgo+ICsgKiAgICBE
YXZlIEFpcmxpZQo+ICsgKiAgICBBbG9uIExldnkKPiArICovCj4gKwo+ICsjaW5jbHVkZSA8bGlu
dXgvZG1hLWZlbmNlLXVud3JhcC5oPgo+ICsjaW5jbHVkZSA8bGludXgvZmlsZS5oPgo+ICsjaW5j
bHVkZSA8bGludXgvc3luY19maWxlLmg+Cj4gKyNpbmNsdWRlIDxsaW51eC91YWNjZXNzLmg+Cj4g
Kwo+ICsjaW5jbHVkZSA8ZHJtL2RybV9maWxlLmg+Cj4gKyNpbmNsdWRlIDxkcm0vdmlydGdwdV9k
cm0uaD4KPiArCj4gKyNpbmNsdWRlICJ2aXJ0Z3B1X2Rydi5oIgo+ICsKPiArc3RydWN0IHZpcnRp
b19ncHVfc3VibWl0IHsKPiArICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSAq
YnVmbGlzdDsKPiArICAgICAgIHN0cnVjdCBkcm1fdmlydGdwdV9leGVjYnVmZmVyICpleGJ1ZjsK
PiArICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlICpvdXRfZmVuY2U7Cj4gKyAgICAgICBz
dHJ1Y3QgdmlydGlvX2dwdV9mcHJpdiAqdmZwcml2Owo+ICsgICAgICAgc3RydWN0IHZpcnRpb19n
cHVfZGV2aWNlICp2Z2RldjsKPiArICAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKPiArICAg
ICAgIHVpbnQ2NF90IGZlbmNlX2N0eDsKPiArICAgICAgIHVpbnQzMl90IHJpbmdfaWR4Owo+ICsg
ICAgICAgaW50IG91dF9mZW5jZV9mZDsKPiArICAgICAgIHZvaWQgKmJ1ZjsKPiArfTsKPiArCj4g
K3N0YXRpYyBpbnQgdmlydGlvX2dwdV9kb19mZW5jZV93YWl0KHN0cnVjdCB2aXJ0aW9fZ3B1X3N1
Ym1pdCAqc3VibWl0LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVj
dCBkbWFfZmVuY2UgKmluX2ZlbmNlKQo+ICt7Cj4gKyAgICAgICB1aW50MzJfdCBjb250ZXh0ID0g
c3VibWl0LT5mZW5jZV9jdHggKyBzdWJtaXQtPnJpbmdfaWR4Owo+ICsKPiArICAgICAgIGlmIChk
bWFfZmVuY2VfbWF0Y2hfY29udGV4dChpbl9mZW5jZSwgY29udGV4dCkpCj4gKyAgICAgICAgICAg
ICAgIHJldHVybiAwOwo+ICsKPiArICAgICAgIHJldHVybiBkbWFfZmVuY2Vfd2FpdChpbl9mZW5j
ZSwgdHJ1ZSk7Cj4gK30KPiArCj4gK3N0YXRpYyBpbnQgdmlydGlvX2dwdV9kbWFfZmVuY2Vfd2Fp
dChzdHJ1Y3QgdmlydGlvX2dwdV9zdWJtaXQgKnN1Ym1pdCwKPiArICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCj4gK3sKPiArICAgICAg
IHN0cnVjdCBkbWFfZmVuY2VfdW53cmFwIGl0cjsKPiArICAgICAgIHN0cnVjdCBkbWFfZmVuY2Ug
KmY7Cj4gKyAgICAgICBpbnQgZXJyOwo+ICsKPiArICAgICAgIGRtYV9mZW5jZV91bndyYXBfZm9y
X2VhY2goZiwgJml0ciwgZmVuY2UpIHsKPiArICAgICAgICAgICAgICAgZXJyID0gdmlydGlvX2dw
dV9kb19mZW5jZV93YWl0KHN1Ym1pdCwgZik7Cj4gKyAgICAgICAgICAgICAgIGlmIChlcnIpCj4g
KyAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycjsKPiArICAgICAgIH0KPiArCj4gKyAg
ICAgICByZXR1cm4gMDsKPiArfQo+ICsKPiArc3RhdGljIGludCB2aXJ0aW9fZ3B1X2ZlbmNlX2V2
ZW50X2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGRybV9maWxlICpmaWxlLAo+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZpcnRpb19ncHVfZmVuY2UgKmZl
bmNlLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3Qg
cmluZ19pZHgpCj4gK3sKPiArICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2Zwcml2ICp2ZnByaXYg
PSBmaWxlLT5kcml2ZXJfcHJpdjsKPiArICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlX2V2
ZW50ICplID0gTlVMTDsKPiArICAgICAgIGludCByZXQ7Cj4gKwo+ICsgICAgICAgaWYgKCEodmZw
cml2LT5yaW5nX2lkeF9tYXNrICYgQklUX1VMTChyaW5nX2lkeCkpKQo+ICsgICAgICAgICAgICAg
ICByZXR1cm4gMDsKPiArCj4gKyAgICAgICBlID0ga3phbGxvYyhzaXplb2YoKmUpLCBHRlBfS0VS
TkVMKTsKPiArICAgICAgIGlmICghZSkKPiArICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9NRU07
Cj4gKwo+ICsgICAgICAgZS0+ZXZlbnQudHlwZSA9IFZJUlRHUFVfRVZFTlRfRkVOQ0VfU0lHTkFM
RUQ7Cj4gKyAgICAgICBlLT5ldmVudC5sZW5ndGggPSBzaXplb2YoZS0+ZXZlbnQpOwo+ICsKPiAr
ICAgICAgIHJldCA9IGRybV9ldmVudF9yZXNlcnZlX2luaXQoZGV2LCBmaWxlLCAmZS0+YmFzZSwg
JmUtPmV2ZW50KTsKPiArICAgICAgIGlmIChyZXQpIHsKPiArICAgICAgICAgICAgICAga2ZyZWUo
ZSk7Cj4gKyAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gKyAgICAgICB9Cj4gKwo+ICsgICAg
ICAgZmVuY2UtPmUgPSBlOwo+ICsKPiArICAgICAgIHJldHVybiAwOwo+ICt9Cj4gKwo+ICtzdGF0
aWMgaW50IHZpcnRpb19ncHVfaW5pdF9zdWJtaXRfYnVmbGlzdChzdHJ1Y3QgdmlydGlvX2dwdV9z
dWJtaXQgKnN1Ym1pdCkKPiArewo+ICsgICAgICAgc3RydWN0IGRybV92aXJ0Z3B1X2V4ZWNidWZm
ZXIgKmV4YnVmID0gc3VibWl0LT5leGJ1ZjsKPiArICAgICAgIHVpbnQzMl90ICpib19oYW5kbGVz
Owo+ICsKPiArICAgICAgIGlmICghZXhidWYtPm51bV9ib19oYW5kbGVzKQo+ICsgICAgICAgICAg
ICAgICByZXR1cm4gMDsKPiArCj4gKyAgICAgICBib19oYW5kbGVzID0ga3ZtYWxsb2NfYXJyYXko
ZXhidWYtPm51bV9ib19oYW5kbGVzLCBzaXplb2YodWludDMyX3QpLAo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIEdGUF9LRVJORUwpOwo+ICsgICAgICAgaWYgKCFib19oYW5k
bGVzKQo+ICsgICAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsKPiArCj4gKyAgICAgICBpZiAo
Y29weV9mcm9tX3VzZXIoYm9faGFuZGxlcywgdTY0X3RvX3VzZXJfcHRyKGV4YnVmLT5ib19oYW5k
bGVzKSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICBleGJ1Zi0+bnVtX2JvX2hhbmRsZXMg
KiBzaXplb2YodWludDMyX3QpKSkgewo+ICsgICAgICAgICAgICAgICBrdmZyZWUoYm9faGFuZGxl
cyk7Cj4gKyAgICAgICAgICAgICAgIHJldHVybiAtRUZBVUxUOwo+ICsgICAgICAgfQo+ICsKPiAr
ICAgICAgIHN1Ym1pdC0+YnVmbGlzdCA9IHZpcnRpb19ncHVfYXJyYXlfZnJvbV9oYW5kbGVzKHN1
Ym1pdC0+ZmlsZSwgYm9faGFuZGxlcywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGV4YnVmLT5udW1fYm9faGFuZGxlcyk7Cj4gKyAgICAg
ICBpZiAoIXN1Ym1pdC0+YnVmbGlzdCkgewo+ICsgICAgICAgICAgICAgICBrdmZyZWUoYm9faGFu
ZGxlcyk7Cj4gKyAgICAgICAgICAgICAgIHJldHVybiAtRU5PRU5UOwo+ICsgICAgICAgfQo+ICsK
PiArICAgICAgIGt2ZnJlZShib19oYW5kbGVzKTsKPiArCj4gKyAgICAgICByZXR1cm4gMDsKPiAr
fQo+ICsKPiArc3RhdGljIHZvaWQgdmlydGlvX2dwdV9jbGVhbnVwX3N1Ym1pdChzdHJ1Y3Qgdmly
dGlvX2dwdV9zdWJtaXQgKnN1Ym1pdCkKPiArewo+ICsgICAgICAgaWYgKCFJU19FUlIoc3VibWl0
LT5idWYpKQo+ICsgICAgICAgICAgICAgICBrdmZyZWUoc3VibWl0LT5idWYpOwo+ICsKPiArICAg
ICAgIGlmIChzdWJtaXQtPmJ1Zmxpc3QpCj4gKyAgICAgICAgICAgICAgIHZpcnRpb19ncHVfYXJy
YXlfcHV0X2ZyZWUoc3VibWl0LT5idWZsaXN0KTsKPiArCj4gKyAgICAgICBpZiAoc3VibWl0LT5v
dXRfZmVuY2VfZmQgPj0gMCkKPiArICAgICAgICAgICAgICAgcHV0X3VudXNlZF9mZChzdWJtaXQt
Pm91dF9mZW5jZV9mZCk7Cj4gKwo+ICsgICAgICAgaWYgKHN1Ym1pdC0+b3V0X2ZlbmNlKQo+ICsg
ICAgICAgICAgICAgICBkbWFfZmVuY2VfcHV0KCZzdWJtaXQtPm91dF9mZW5jZS0+Zik7Cj4gK30K
PiArCj4gK3N0YXRpYyB2b2lkIHZpcnRpb19ncHVfc3VibWl0KHN0cnVjdCB2aXJ0aW9fZ3B1X3N1
Ym1pdCAqc3VibWl0KQo+ICt7Cj4gKyAgICAgICB2aXJ0aW9fZ3B1X2NtZF9zdWJtaXQoc3VibWl0
LT52Z2Rldiwgc3VibWl0LT5idWYsIHN1Ym1pdC0+ZXhidWYtPnNpemUsCj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3VibWl0LT52ZnByaXYtPmN0eF9pZCwgc3VibWl0LT5idWZsaXN0
LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdC0+b3V0X2ZlbmNlKTsKPiAr
ICAgICAgIHZpcnRpb19ncHVfbm90aWZ5KHN1Ym1pdC0+dmdkZXYpOwo+ICt9Cj4gKwo+ICtzdGF0
aWMgdm9pZCB2aXJ0aW9fZ3B1X2NvbXBsZXRlX3N1Ym1pdChzdHJ1Y3QgdmlydGlvX2dwdV9zdWJt
aXQgKnN1Ym1pdCkKPiArewo+ICsgICAgICAgc3VibWl0LT5idWYgPSBOVUxMOwo+ICsgICAgICAg
c3VibWl0LT5idWZsaXN0ID0gTlVMTDsKPiArICAgICAgIHN1Ym1pdC0+b3V0X2ZlbmNlID0gTlVM
TDsKPiArICAgICAgIHN1Ym1pdC0+b3V0X2ZlbmNlX2ZkID0gLTE7Cj4gK30KPiArCj4gK3N0YXRp
YyBpbnQgdmlydGlvX2dwdV9pbml0X3N1Ym1pdChzdHJ1Y3QgdmlydGlvX2dwdV9zdWJtaXQgKnN1
Ym1pdCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGRybV92aXJ0
Z3B1X2V4ZWNidWZmZXIgKmV4YnVmLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVpbnQ2NF90IGZlbmNlX2N0eCwgdWludDMyX3QgcmluZ19pZHgpCj4gK3sKPiArICAg
ICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2Zwcml2ICp2ZnByaXYgPSBmaWxlLT5kcml2ZXJfcHJpdjsK
PiArICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYgPSBkZXYtPmRldl9wcml2
YXRlOwo+ICsgICAgICAgc3RydWN0IHZpcnRpb19ncHVfZmVuY2UgKm91dF9mZW5jZTsKPiArICAg
ICAgIGludCBlcnI7Cj4gKwo+ICsgICAgICAgbWVtc2V0KHN1Ym1pdCwgMCwgc2l6ZW9mKCpzdWJt
aXQpKTsKPiArCj4gKyAgICAgICBvdXRfZmVuY2UgPSB2aXJ0aW9fZ3B1X2ZlbmNlX2FsbG9jKHZn
ZGV2LCBmZW5jZV9jdHgsIHJpbmdfaWR4KTsKPiArICAgICAgIGlmICghb3V0X2ZlbmNlKQo+ICsg
ICAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsKPiArCj4gKyAgICAgICBlcnIgPSB2aXJ0aW9f
Z3B1X2ZlbmNlX2V2ZW50X2NyZWF0ZShkZXYsIGZpbGUsIG91dF9mZW5jZSwgcmluZ19pZHgpOwo+
ICsgICAgICAgaWYgKGVycikgewo+ICsgICAgICAgICAgICAgICBkbWFfZmVuY2VfcHV0KCZvdXRf
ZmVuY2UtPmYpOwo+ICsgICAgICAgICAgICAgICByZXR1cm4gZXJyOwo+ICsgICAgICAgfQo+ICsK
PiArICAgICAgIHN1Ym1pdC0+b3V0X2ZlbmNlID0gb3V0X2ZlbmNlOwo+ICsgICAgICAgc3VibWl0
LT5mZW5jZV9jdHggPSBmZW5jZV9jdHg7Cj4gKyAgICAgICBzdWJtaXQtPnJpbmdfaWR4ID0gcmlu
Z19pZHg7Cj4gKyAgICAgICBzdWJtaXQtPm91dF9mZW5jZV9mZCA9IC0xOwo+ICsgICAgICAgc3Vi
bWl0LT52ZnByaXYgPSB2ZnByaXY7Cj4gKyAgICAgICBzdWJtaXQtPnZnZGV2ID0gdmdkZXY7Cj4g
KyAgICAgICBzdWJtaXQtPmV4YnVmID0gZXhidWY7Cj4gKyAgICAgICBzdWJtaXQtPmZpbGUgPSBm
aWxlOwo+ICsKPiArICAgICAgIGVyciA9IHZpcnRpb19ncHVfaW5pdF9zdWJtaXRfYnVmbGlzdChz
dWJtaXQpOwo+ICsgICAgICAgaWYgKGVycikKPiArICAgICAgICAgICAgICAgcmV0dXJuIGVycjsK
PiArCj4gKyAgICAgICBzdWJtaXQtPmJ1ZiA9IHZtZW1kdXBfdXNlcih1NjRfdG9fdXNlcl9wdHIo
ZXhidWYtPmNvbW1hbmQpLCBleGJ1Zi0+c2l6ZSk7Cj4gKyAgICAgICBpZiAoSVNfRVJSKHN1Ym1p
dC0+YnVmKSkKPiArICAgICAgICAgICAgICAgcmV0dXJuIFBUUl9FUlIoc3VibWl0LT5idWYpOwo+
ICsKPiArICAgICAgIGlmIChleGJ1Zi0+ZmxhZ3MgJiBWSVJUR1BVX0VYRUNCVUZfRkVOQ0VfRkRf
T1VUKSB7Cj4gKyAgICAgICAgICAgICAgIGVyciA9IGdldF91bnVzZWRfZmRfZmxhZ3MoT19DTE9F
WEVDKTsKPiArICAgICAgICAgICAgICAgaWYgKGVyciA8IDApCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgcmV0dXJuIGVycjsKPiArCj4gKyAgICAgICAgICAgICAgIHN1Ym1pdC0+b3V0X2ZlbmNl
X2ZkID0gZXJyOwo+ICsgICAgICAgfQo+ICsKPiArICAgICAgIHJldHVybiAwOwo+ICt9Cj4gKwo+
ICtzdGF0aWMgaW50IHZpcnRpb19ncHVfd2FpdF9pbl9mZW5jZShzdHJ1Y3QgdmlydGlvX2dwdV9z
dWJtaXQgKnN1Ym1pdCkKPiArewo+ICsgICAgICAgaW50IHJldCA9IDA7Cj4gKwo+ICsgICAgICAg
aWYgKHN1Ym1pdC0+ZXhidWYtPmZsYWdzICYgVklSVEdQVV9FWEVDQlVGX0ZFTkNFX0ZEX0lOKSB7
Cj4gKyAgICAgICAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmluX2ZlbmNlID0KPiArICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHN5bmNfZmlsZV9nZXRfZmVuY2Uoc3VibWl0LT5leGJ1
Zi0+ZmVuY2VfZmQpOwo+ICsgICAgICAgICAgICAgICBpZiAoIWluX2ZlbmNlKQo+ICsgICAgICAg
ICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwo+ICsKPiArICAgICAgICAgICAgICAgLyoK
PiArICAgICAgICAgICAgICAgICogV2FpdCBpZiB0aGUgZmVuY2UgaXMgZnJvbSBhIGZvcmVpZ24g
Y29udGV4dCwgb3IgaWYgdGhlIGZlbmNlCj4gKyAgICAgICAgICAgICAgICAqIGFycmF5IGNvbnRh
aW5zIGFueSBmZW5jZSBmcm9tIGEgZm9yZWlnbiBjb250ZXh0Lgo+ICsgICAgICAgICAgICAgICAg
Ki8KPiArICAgICAgICAgICAgICAgcmV0ID0gdmlydGlvX2dwdV9kbWFfZmVuY2Vfd2FpdChzdWJt
aXQsIGluX2ZlbmNlKTsKPiArCj4gKyAgICAgICAgICAgICAgIGRtYV9mZW5jZV9wdXQoaW5fZmVu
Y2UpOwo+ICsgICAgICAgfQo+ICsKPiArICAgICAgIHJldHVybiByZXQ7Cj4gK30KPiArCj4gK3N0
YXRpYyBpbnQgdmlydGlvX2dwdV9pbnN0YWxsX291dF9mZW5jZV9mZChzdHJ1Y3QgdmlydGlvX2dw
dV9zdWJtaXQgKnN1Ym1pdCkKPiArewo+ICsgICAgICAgaWYgKHN1Ym1pdC0+b3V0X2ZlbmNlX2Zk
ID49IDApIHsKPiArICAgICAgICAgICAgICAgc3RydWN0IHN5bmNfZmlsZSAqc3luY19maWxlID0K
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3luY19maWxlX2NyZWF0
ZSgmc3VibWl0LT5vdXRfZmVuY2UtPmYpOwo+ICsgICAgICAgICAgICAgICBpZiAoIXN5bmNfZmls
ZSkKPiArICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsKPiArCj4gKyAgICAg
ICAgICAgICAgIHN1Ym1pdC0+ZXhidWYtPmZlbmNlX2ZkID0gc3VibWl0LT5vdXRfZmVuY2VfZmQ7
Cj4gKyAgICAgICAgICAgICAgIGZkX2luc3RhbGwoc3VibWl0LT5vdXRfZmVuY2VfZmQsIHN5bmNf
ZmlsZS0+ZmlsZSk7Cj4gKyAgICAgICB9Cj4gKwo+ICsgICAgICAgcmV0dXJuIDA7Cj4gK30KPiAr
Cj4gK3N0YXRpYyBpbnQgdmlydGlvX2dwdV9sb2NrX2J1Zmxpc3Qoc3RydWN0IHZpcnRpb19ncHVf
c3VibWl0ICpzdWJtaXQpCj4gK3sKPiArICAgICAgIGlmIChzdWJtaXQtPmJ1Zmxpc3QpCj4gKyAg
ICAgICAgICAgICAgIHJldHVybiB2aXJ0aW9fZ3B1X2FycmF5X2xvY2tfcmVzdihzdWJtaXQtPmJ1
Zmxpc3QpOwo+ICsKPiArICAgICAgIHJldHVybiAwOwo+ICt9Cj4gKwo+ICtpbnQgdmlydGlvX2dw
dV9leGVjYnVmZmVyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCj4g
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCj4g
K3sKPiArICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYgPSBkZXYtPmRldl9w
cml2YXRlOwo+ICsgICAgICAgc3RydWN0IHZpcnRpb19ncHVfZnByaXYgKnZmcHJpdiA9IGZpbGUt
PmRyaXZlcl9wcml2Owo+ICsgICAgICAgdWludDY0X3QgZmVuY2VfY3R4ID0gdmdkZXYtPmZlbmNl
X2Rydi5jb250ZXh0Owo+ICsgICAgICAgc3RydWN0IGRybV92aXJ0Z3B1X2V4ZWNidWZmZXIgKmV4
YnVmID0gZGF0YTsKPiArICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X3N1Ym1pdCBzdWJtaXQ7Cj4g
KyAgICAgICB1aW50MzJfdCByaW5nX2lkeCA9IDA7Cj4gKyAgICAgICBpbnQgcmV0ID0gLUVJTlZB
TDsKPiArCj4gKyAgICAgICBpZiAodmdkZXYtPmhhc192aXJnbF8zZCA9PSBmYWxzZSkKPiArICAg
ICAgICAgICAgICAgcmV0dXJuIC1FTk9TWVM7Cj4gKwo+ICsgICAgICAgaWYgKChleGJ1Zi0+Zmxh
Z3MgJiB+VklSVEdQVV9FWEVDQlVGX0ZMQUdTKSkKPiArICAgICAgICAgICAgICAgcmV0dXJuIHJl
dDsKPiArCj4gKyAgICAgICBpZiAoKGV4YnVmLT5mbGFncyAmIFZJUlRHUFVfRVhFQ0JVRl9SSU5H
X0lEWCkpIHsKPiArICAgICAgICAgICAgICAgaWYgKGV4YnVmLT5yaW5nX2lkeCA+PSB2ZnByaXYt
Pm51bV9yaW5ncykKPiArICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICsKPiAr
ICAgICAgICAgICAgICAgaWYgKCF2ZnByaXYtPmJhc2VfZmVuY2VfY3R4KQo+ICsgICAgICAgICAg
ICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gKwo+ICsgICAgICAgICAgICAgICBmZW5jZV9jdHgg
PSB2ZnByaXYtPmJhc2VfZmVuY2VfY3R4Owo+ICsgICAgICAgICAgICAgICByaW5nX2lkeCA9IGV4
YnVmLT5yaW5nX2lkeDsKPiArICAgICAgIH0KPiArCj4gKyAgICAgICB2aXJ0aW9fZ3B1X2NyZWF0
ZV9jb250ZXh0KGRldiwgZmlsZSk7Cj4gKwo+ICsgICAgICAgcmV0ID0gdmlydGlvX2dwdV9pbml0
X3N1Ym1pdCgmc3VibWl0LCBleGJ1ZiwgZGV2LCBmaWxlLAo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBmZW5jZV9jdHgsIHJpbmdfaWR4KTsKPiArICAgICAgIGlmIChyZXQp
Cj4gKyAgICAgICAgICAgICAgIGdvdG8gY2xlYW51cDsKPiArCj4gKyAgICAgICByZXQgPSB2aXJ0
aW9fZ3B1X3dhaXRfaW5fZmVuY2UoJnN1Ym1pdCk7Cj4gKyAgICAgICBpZiAocmV0KQo+ICsgICAg
ICAgICAgICAgICBnb3RvIGNsZWFudXA7Cj4gKwo+ICsgICAgICAgcmV0ID0gdmlydGlvX2dwdV9p
bnN0YWxsX291dF9mZW5jZV9mZCgmc3VibWl0KTsKPiArICAgICAgIGlmIChyZXQpCj4gKyAgICAg
ICAgICAgICAgIGdvdG8gY2xlYW51cDsKPiArCj4gKyAgICAgICByZXQgPSB2aXJ0aW9fZ3B1X2xv
Y2tfYnVmbGlzdCgmc3VibWl0KTsKPiArICAgICAgIGlmIChyZXQpCj4gKyAgICAgICAgICAgICAg
IGdvdG8gY2xlYW51cDsKPiArCj4gKyAgICAgICB2aXJ0aW9fZ3B1X3N1Ym1pdCgmc3VibWl0KTsK
PiArICAgICAgIHZpcnRpb19ncHVfY29tcGxldGVfc3VibWl0KCZzdWJtaXQpOwo+ICtjbGVhbnVw
Ogo+ICsgICAgICAgdmlydGlvX2dwdV9jbGVhbnVwX3N1Ym1pdCgmc3VibWl0KTsKPiArCj4gKyAg
ICAgICByZXR1cm4gcmV0Owo+ICt9Cj4gLS0KPiAyLjM5LjIKPgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpWaXJ0dWFsaXphdGlvbiBtYWlsaW5nIGxpc3QK
VmlydHVhbGl6YXRpb25AbGlzdHMubGludXgtZm91bmRhdGlvbi5vcmcKaHR0cHM6Ly9saXN0cy5s
aW51eGZvdW5kYXRpb24ub3JnL21haWxtYW4vbGlzdGluZm8vdmlydHVhbGl6YXRpb24=
