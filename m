Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id D6EC31978C6
	for <lists.virtualization@lfdr.de>; Mon, 30 Mar 2020 12:20:01 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 8F2C286AB0;
	Mon, 30 Mar 2020 10:20:00 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 2gEgFIhCdnJb; Mon, 30 Mar 2020 10:19:57 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 4BA0586A24;
	Mon, 30 Mar 2020 10:19:55 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 27B45C1D7E;
	Mon, 30 Mar 2020 10:19:55 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id DB90BC07FF
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:51 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id D8EF888448
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:51 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id JKgXjAbpEo1r
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:50 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by hemlock.osuosl.org (Postfix) with ESMTPS id 70F7A8843E
 for <virtualization@lists.linux-foundation.org>;
 Mon, 30 Mar 2020 10:19:50 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp02.buh.bitdefender.net [10.17.80.76])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 843CE30644B8; Mon, 30 Mar 2020 13:12:55 +0300 (EEST)
Received: from localhost.localdomain (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 53C0C305B7A1;
 Mon, 30 Mar 2020 13:12:55 +0300 (EEST)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v8 43/81] KVM: introspection: add KVMI_VM_CHECK_COMMAND and
 KVMI_VM_CHECK_EVENT
Date: Mon, 30 Mar 2020 13:12:30 +0300
Message-Id: <20200330101308.21702-44-alazar@bitdefender.com>
In-Reply-To: <20200330101308.21702-1-alazar@bitdefender.com>
References: <20200330101308.21702-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>, virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

VGhlc2UgY29tbWFuZHMgYXJlIHVzZWQgdG8gY2hlY2sgd2hhdCBpbnRyb3NwZWN0aW9uIGNvbW1h
bmRzIGFuZCBldmVudHMKYXJlIHN1cHBvcnRlZCAoYnkga2VybmVsKSBhbmQgYWxsb3dlZCAoYnkg
dXNlcnNwYWNlKS4KClRoZXNlIGFyZSBhbHRlcm5hdGl2ZSBtZXRob2RzIHRvIEtWTUlfR0VUX1ZF
UlNJT04gaW4gY2hlY2tpbmcgaWYgdGhlCmludHJvc3BlY3Rpb24gc3VwcG9ydHMgYSBzcGVjaWZp
YyBjb21tYW5kL2V2ZW50LgoKQXMgd2l0aCB0aGUgS1ZNSV9HRVRfVkVSU0lPTiBjb21tYW5kLCB0
aGVzZSB0d28gY2FuIG5ldmVyIGJlIGRpc2FsbG93ZWQKYnkgdXNlcnNwYWNlLgoKU2lnbmVkLW9m
Zi1ieTogQWRhbGJlcnQgTGF6xINyIDxhbGF6YXJAYml0ZGVmZW5kZXIuY29tPgotLS0KIERvY3Vt
ZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QgICAgICAgICAgICAgICB8IDYyICsrKysrKysrKysr
KysrKysrKysKIGluY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggICAgICAgICAgICAgICAgICAgICB8
IDE2ICsrKystCiAuLi4vdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYyAg
fCA1NSArKysrKysrKysrKysrKysrCiB2aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWkuYyAgICAg
ICAgICAgICAgICAgfCAgOSArKysKIHZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9pbnQuaCAg
ICAgICAgICAgICB8ICAyICsKIHZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYyAgICAg
ICAgICAgICB8IDQ5ICsrKysrKysrKysrKysrLQogNiBmaWxlcyBjaGFuZ2VkLCAxOTEgaW5zZXJ0
aW9ucygrKSwgMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL3ZpcnQv
a3ZtL2t2bWkucnN0IGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAppbmRleCBkODQ4
ZTU2ZjQyZTkuLjVkYjM4ODQ4YzZkNCAxMDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2
bS9rdm1pLnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0CkBAIC0yNTgs
MyArMjU4LDY1IEBAIHJlcGxpZXMuIFRoZXNlIG1lc3NhZ2VzIG1pZ2h0IGJlIGV4dGVuZGVkIGlu
IGZ1dHVyZXMgdmVyc2lvbnMgYW5kIHdoaWxlCiB0aGUga2VybmVsIHdpbGwgYWNjZXB0IHNob3J0
ZXIgbWVzc2FnZXMgKG9sZGVyIHZlcnNpb25zKSBvciBiaWdnZXIKIG1lc3NhZ2VzIChuZXdlciB2
ZXJzaW9ucywgaWdub3JpbmcgdGhlIGV4dHJhIGluZm9ybWF0aW9uKSBpdCB3aWxsIG5vdAogYWNj
ZXB0IGJpZ2dlci9uZXdlciBldmVudCByZXBsaWVzLgorCisyLiBLVk1JX1ZNX0NIRUNLX0NPTU1B
TkQKKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorCis6QXJjaGl0ZWN0dXJlczogYWxsCis6VmVy
c2lvbnM6ID49IDEKKzpQYXJhbWV0ZXJzOgorCis6OgorCisJc3RydWN0IGt2bWlfdm1fY2hlY2tf
Y29tbWFuZCB7CisJCV9fdTE2IGlkOworCQlfX3UxNiBwYWRkaW5nMTsKKwkJX191MzIgcGFkZGlu
ZzI7CisJfTsKKworOlJldHVybnM6CisKKzo6CisKKwlzdHJ1Y3Qga3ZtaV9lcnJvcl9jb2RlOwor
CitDaGVja3MgaWYgdGhlIGNvbW1hbmQgc3BlY2lmaWVkIGJ5IGBgaWRgYCBpcyBzdXBwb3J0ZWQg
YW5kIGFsbG93ZWQuCisKK1RoaXMgY29tbWFuZCBpcyBhbHdheXMgYWxsb3dlZC4KKworOkVycm9y
czoKKworKiAtS1ZNX0VOT0VOVCAtIHRoZSBjb21tYW5kIHNwZWNpZmllZCBieSBgYGlkYGAgaXMg
dW5zdXBwb3J0ZWQKKyogLUtWTV9FUEVSTSAtIHRoZSBjb21tYW5kIHNwZWNpZmllZCBieSBgYGlk
YGAgaXMgZGlzYWxsb3dlZAorKiAtS1ZNX0VJTlZBTCAtIHRoZSBwYWRkaW5nIGlzIG5vdCB6ZXJv
CisKKzMuIEtWTUlfVk1fQ0hFQ0tfRVZFTlQKKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKworOkFy
Y2hpdGVjdHVyZXM6IGFsbAorOlZlcnNpb25zOiA+PSAxCis6UGFyYW1ldGVyczoKKworOjoKKwor
CXN0cnVjdCBrdm1pX3ZtX2NoZWNrX2V2ZW50IHsKKwkJX191MTYgaWQ7CisJCV9fdTE2IHBhZGRp
bmcxOworCQlfX3UzMiBwYWRkaW5nMjsKKwl9OworCis6UmV0dXJuczoKKworOjoKKworCXN0cnVj
dCBrdm1pX2Vycm9yX2NvZGU7CisKK0NoZWNrcyBpZiB0aGUgZXZlbnQgc3BlY2lmaWVkIGJ5IGBg
aWRgYCBpcyBzdXBwb3J0ZWQgYW5kIGFsbG93ZWQuCisKK1RoaXMgY29tbWFuZCBpcyBhbHdheXMg
YWxsb3dlZC4KKworOkVycm9yczoKKworKiAtS1ZNX0VOT0VOVCAtIHRoZSBldmVudCBzcGVjaWZp
ZWQgYnkgYGBpZGBgIGlzIHVuc3VwcG9ydGVkCisqIC1LVk1fRVBFUk0gLSB0aGUgZXZlbnQgc3Bl
Y2lmaWVkIGJ5IGBgaWRgYCBpcyBkaXNhbGxvd2VkCisqIC1LVk1fRUlOVkFMIC0gdGhlIHBhZGRp
bmcgaXMgbm90IHplcm8KZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggYi9p
bmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCmluZGV4IGIwYTViNzJkMzkzNi4uYjQ3ZGUxNzMzZTQ5
IDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2luY2x1ZGUvdWFw
aS9saW51eC9rdm1pLmgKQEAgLTE0LDcgKzE0LDkgQEAgZW51bSB7CiB9OwogCiBlbnVtIHsKLQlL
Vk1JX0dFVF9WRVJTSU9OID0gMiwKKwlLVk1JX0dFVF9WRVJTSU9OICAgICAgPSAyLAorCUtWTUlf
Vk1fQ0hFQ0tfQ09NTUFORCA9IDMsCisJS1ZNSV9WTV9DSEVDS19FVkVOVCAgID0gNCwKIAogCUtW
TUlfTlVNX01FU1NBR0VTCiB9OwpAQCAtNTAsNCArNTIsMTYgQEAgc3RydWN0IGt2bWlfZ2V0X3Zl
cnNpb25fcmVwbHkgewogCV9fdTMyIHBhZGRpbmc7CiB9OwogCitzdHJ1Y3Qga3ZtaV92bV9jaGVj
a19jb21tYW5kIHsKKwlfX3UxNiBpZDsKKwlfX3UxNiBwYWRkaW5nMTsKKwlfX3UzMiBwYWRkaW5n
MjsKK307CisKK3N0cnVjdCBrdm1pX3ZtX2NoZWNrX2V2ZW50IHsKKwlfX3UxNiBpZDsKKwlfX3Ux
NiBwYWRkaW5nMTsKKwlfX3UzMiBwYWRkaW5nMjsKK307CisKICNlbmRpZiAvKiBfVUFQSV9fTElO
VVhfS1ZNSV9IICovCmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2
XzY0L2t2bWlfdGVzdC5jIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1p
X3Rlc3QuYwppbmRleCAzMjcyNzJlMjY2ZmYuLmY0MzRhOTYxMTg1NyAxMDA2NDQKLS0tIGEvdG9v
bHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYworKysgYi90b29scy90
ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCkBAIC0yMDEsNiArMjAxLDU5
IEBAIHN0YXRpYyB2b2lkIHRlc3RfY21kX2dldF92ZXJzaW9uKHZvaWQpCiAJREVCVUcoIktWTUkg
dmVyc2lvbjogJXVcbiIsIHJwbC52ZXJzaW9uKTsKIH0KIAorc3RhdGljIGludCBjbWRfY2hlY2tf
Y29tbWFuZChfX3UxNiBpZCkKK3sKKwlzdHJ1Y3QgeworCQlzdHJ1Y3Qga3ZtaV9tc2dfaGRyIGhk
cjsKKwkJc3RydWN0IGt2bWlfdm1fY2hlY2tfY29tbWFuZCBjbWQ7CisJfSByZXEgPSB7fTsKKwor
CXJlcS5jbWQuaWQgPSBpZDsKKworCXJldHVybiBkb19jb21tYW5kKEtWTUlfVk1fQ0hFQ0tfQ09N
TUFORCwgJnJlcS5oZHIsIHNpemVvZihyZXEpLCBOVUxMLAorCQkJICAgICAwKTsKK30KKworc3Rh
dGljIHZvaWQgdGVzdF9jbWRfY2hlY2tfY29tbWFuZCh2b2lkKQoreworCV9fdTE2IHZhbGlkX2lk
ID0gS1ZNSV9HRVRfVkVSU0lPTjsKKwlfX3UxNiBpbnZhbGlkX2lkID0gMHhmZmZmOworCWludCBy
OworCisJciA9IGNtZF9jaGVja19jb21tYW5kKHZhbGlkX2lkKTsKKwlURVNUX0FTU0VSVChyID09
IDAsCisJCSJLVk1JX1ZNX0NIRUNLX0NPTU1BTkQgZmFpbGVkLCBlcnJvciAlZCAoJXMpXG4iLAor
CQktciwga3ZtX3N0cmVycm9yKC1yKSk7CisKKwlyID0gY21kX2NoZWNrX2NvbW1hbmQoaW52YWxp
ZF9pZCk7CisJVEVTVF9BU1NFUlQociA9PSAtS1ZNX0VOT0VOVCwKKwkJIktWTUlfVk1fQ0hFQ0tf
Q09NTUFORCBkaWRuJ3QgZmFpbGVkIHdpdGggLUtWTV9FTk9FTlQsIGVycm9yICVkICglcylcbiIs
CisJCS1yLCBrdm1fc3RyZXJyb3IoLXIpKTsKK30KKworc3RhdGljIGludCBjbWRfY2hlY2tfZXZl
bnQoX191MTYgaWQpCit7CisJc3RydWN0IHsKKwkJc3RydWN0IGt2bWlfbXNnX2hkciBoZHI7CisJ
CXN0cnVjdCBrdm1pX3ZtX2NoZWNrX2V2ZW50IGNtZDsKKwl9IHJlcSA9IHt9OworCisJcmVxLmNt
ZC5pZCA9IGlkOworCisJcmV0dXJuIGRvX2NvbW1hbmQoS1ZNSV9WTV9DSEVDS19FVkVOVCwgJnJl
cS5oZHIsIHNpemVvZihyZXEpLCBOVUxMLCAwKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9jbWRf
Y2hlY2tfZXZlbnQodm9pZCkKK3sKKwlfX3UxNiBpbnZhbGlkX2lkID0gMHhmZmZmOworCWludCBy
OworCisJciA9IGNtZF9jaGVja19ldmVudChpbnZhbGlkX2lkKTsKKwlURVNUX0FTU0VSVChyID09
IC1LVk1fRU5PRU5ULAorCQkiS1ZNSV9WTV9DSEVDS19FVkVOVCBkaWRuJ3QgZmFpbGVkIHdpdGgg
LUtWTV9FTk9FTlQsIGVycm9yICVkICglcylcbiIsCisJCS1yLCBrdm1fc3RyZXJyb3IoLXIpKTsK
K30KKwogc3RhdGljIHZvaWQgdGVzdF9pbnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0gKnZtKQog
ewogCXNldHVwX3NvY2tldCgpOwpAQCAtMjA4LDYgKzI2MSw4IEBAIHN0YXRpYyB2b2lkIHRlc3Rf
aW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIAogCXRlc3RfY21kX2ludmFsaWQoKTsK
IAl0ZXN0X2NtZF9nZXRfdmVyc2lvbigpOworCXRlc3RfY21kX2NoZWNrX2NvbW1hbmQoKTsKKwl0
ZXN0X2NtZF9jaGVja19ldmVudCgpOwogCiAJdW5ob29rX2ludHJvc3BlY3Rpb24odm0pOwogfQpk
aWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMgYi92aXJ0L2t2bS9pbnRy
b3NwZWN0aW9uL2t2bWkuYwppbmRleCA4Y2Q2NmIxZGFjMDIuLjVjMTdmNTQ4YjQ1NyAxMDA2NDQK
LS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pLmMKKysrIGIvdmlydC9rdm0vaW50cm9z
cGVjdGlvbi9rdm1pLmMKQEAgLTExLDYgKzExLDcgQEAKICNkZWZpbmUgS1ZNSV9NU0dfU0laRV9B
TExPQyAoc2l6ZW9mKHN0cnVjdCBrdm1pX21zZ19oZHIpICsgS1ZNSV9NU0dfU0laRSkKIAogc3Rh
dGljIERFQ0xBUkVfQklUTUFQKEt2bWlfYWx3YXlzX2FsbG93ZWRfY29tbWFuZHMsIEtWTUlfTlVN
X0NPTU1BTkRTKTsKK0RFQ0xBUkVfQklUTUFQKEt2bWlfa25vd25fZXZlbnRzLCBLVk1JX05VTV9F
VkVOVFMpOwogCiBzdGF0aWMgc3RydWN0IGttZW1fY2FjaGUgKm1zZ19jYWNoZTsKIApAQCAtNDks
MTEgKzUwLDE5IEBAIHN0YXRpYyB2b2lkIHNldHVwX2Fsd2F5c19hbGxvd2VkX2NvbW1hbmRzKHZv
aWQpCiB7CiAJYml0bWFwX3plcm8oS3ZtaV9hbHdheXNfYWxsb3dlZF9jb21tYW5kcywgS1ZNSV9O
VU1fQ09NTUFORFMpOwogCXNldF9iaXQoS1ZNSV9HRVRfVkVSU0lPTiwgS3ZtaV9hbHdheXNfYWxs
b3dlZF9jb21tYW5kcyk7CisJc2V0X2JpdChLVk1JX1ZNX0NIRUNLX0NPTU1BTkQsIEt2bWlfYWx3
YXlzX2FsbG93ZWRfY29tbWFuZHMpOworCXNldF9iaXQoS1ZNSV9WTV9DSEVDS19FVkVOVCwgS3Zt
aV9hbHdheXNfYWxsb3dlZF9jb21tYW5kcyk7Cit9CisKK3N0YXRpYyB2b2lkIHNldHVwX2tub3du
X2V2ZW50cyh2b2lkKQoreworCWJpdG1hcF96ZXJvKEt2bWlfa25vd25fZXZlbnRzLCBLVk1JX05V
TV9FVkVOVFMpOwogfQogCiBpbnQga3ZtaV9pbml0KHZvaWQpCiB7CiAJc2V0dXBfYWx3YXlzX2Fs
bG93ZWRfY29tbWFuZHMoKTsKKwlzZXR1cF9rbm93bl9ldmVudHMoKTsKIAogCXJldHVybiBrdm1p
X2NhY2hlX2NyZWF0ZSgpOwogfQpkaWZmIC0tZ2l0IGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9r
dm1pX2ludC5oIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCmluZGV4IDM2ZjVl
NTA0ZTc5MS4uZjc1NWM2NmNlZWNjIDEwMDY0NAotLS0gYS92aXJ0L2t2bS9pbnRyb3NwZWN0aW9u
L2t2bWlfaW50LmgKKysrIGIvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX2ludC5oCkBAIC0x
Niw2ICsxNiw4IEBACiAjZGVmaW5lIGt2bWlfZXJyKGt2bWksIGZtdCwgLi4uKSBcCiAJa3ZtX2lu
Zm8oIiVwVSBFUlJPUjogIiBmbXQsICZrdm1pLT51dWlkLCAjIyBfX1ZBX0FSR1NfXykKIAorZXh0
ZXJuIERFQ0xBUkVfQklUTUFQKEt2bWlfa25vd25fZXZlbnRzLCBLVk1JX05VTV9FVkVOVFMpOwor
CiAjZGVmaW5lIEtWTUkoa3ZtKSAoKGt2bSktPmt2bWkpCiAKIC8qIGt2bWlfbXNnLmMgKi8KZGlm
ZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYyBiL3ZpcnQva3ZtL2lu
dHJvc3BlY3Rpb24va3ZtaV9tc2cuYwppbmRleCA5ZWZjZDg5NmYwYzYuLjRmYzhiN2EwYjZkOSAx
MDA2NDQKLS0tIGEvdmlydC9rdm0vaW50cm9zcGVjdGlvbi9rdm1pX21zZy5jCisrKyBiL3ZpcnQv
a3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYwpAQCAtOCw2ICs4LDggQEAKICNpbmNsdWRlIDxs
aW51eC9uZXQuaD4KICNpbmNsdWRlICJrdm1pX2ludC5oIgogCitzdGF0aWMgYm9vbCBpc192bV9j
b21tYW5kKHUxNiBpZCk7CisKIGJvb2wga3ZtaV9zb2NrX2dldChzdHJ1Y3Qga3ZtX2ludHJvc3Bl
Y3Rpb24gKmt2bWksIGludCBmZCkKIHsKIAlzdHJ1Y3Qgc29ja2V0ICpzb2NrOwpAQCAtMTE0LDEy
ICsxMTYsNTcgQEAgc3RhdGljIGludCBoYW5kbGVfZ2V0X3ZlcnNpb24oc3RydWN0IGt2bV9pbnRy
b3NwZWN0aW9uICprdm1pLAogCXJldHVybiBrdm1pX21zZ192bV9yZXBseShrdm1pLCBtc2csIDAs
ICZycGwsIHNpemVvZihycGwpKTsKIH0KIAorc3RhdGljIGludCBoYW5kbGVfY2hlY2tfY29tbWFu
ZChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksCisJCQkJY29uc3Qgc3RydWN0IGt2bWlf
bXNnX2hkciAqbXNnLAorCQkJCWNvbnN0IHZvaWQgKl9yZXEpCit7CisJY29uc3Qgc3RydWN0IGt2
bWlfdm1fY2hlY2tfY29tbWFuZCAqcmVxID0gX3JlcTsKKwlpbnQgZWMgPSAwOworCisJaWYgKHJl
cS0+cGFkZGluZzEgfHwgcmVxLT5wYWRkaW5nMikKKwkJZWMgPSAtS1ZNX0VJTlZBTDsKKwllbHNl
IGlmICghaXNfdm1fY29tbWFuZChyZXEtPmlkKSkKKwkJZWMgPSAtS1ZNX0VOT0VOVDsKKwllbHNl
IGlmICghaXNfY29tbWFuZF9hbGxvd2VkKGt2bWksIHJlcS0+aWQpKQorCQllYyA9IC1LVk1fRVBF
Uk07CisKKwlyZXR1cm4ga3ZtaV9tc2dfdm1fcmVwbHkoa3ZtaSwgbXNnLCBlYywgTlVMTCwgMCk7
Cit9CisKK3N0YXRpYyBib29sIGlzX2V2ZW50X2tub3duKHUxNiBpZCkKK3sKKwlyZXR1cm4gaWQg
PCBLVk1JX05VTV9FVkVOVFMgJiYgdGVzdF9iaXQoaWQsIEt2bWlfa25vd25fZXZlbnRzKTsKK30K
Kworc3RhdGljIGJvb2wgaXNfZXZlbnRfYWxsb3dlZChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24g
Kmt2bWksIHUxNiBpZCkKK3sKKwlyZXR1cm4gaWQgPCBLVk1JX05VTV9FVkVOVFMgJiYgdGVzdF9i
aXQoaWQsIGt2bWktPmV2ZW50X2FsbG93X21hc2spOworfQorCitzdGF0aWMgaW50IGhhbmRsZV9j
aGVja19ldmVudChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksCisJCQkgICAgICBjb25z
dCBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICptc2csIGNvbnN0IHZvaWQgKl9yZXEpCit7CisJY29uc3Qg
c3RydWN0IGt2bWlfdm1fY2hlY2tfZXZlbnQgKnJlcSA9IF9yZXE7CisJaW50IGVjID0gMDsKKwor
CWlmIChyZXEtPnBhZGRpbmcxIHx8IHJlcS0+cGFkZGluZzIpCisJCWVjID0gLUtWTV9FSU5WQUw7
CisJZWxzZSBpZiAoIWlzX2V2ZW50X2tub3duKHJlcS0+aWQpKQorCQllYyA9IC1LVk1fRU5PRU5U
OworCWVsc2UgaWYgKCFpc19ldmVudF9hbGxvd2VkKGt2bWksIHJlcS0+aWQpKQorCQllYyA9IC1L
Vk1fRVBFUk07CisKKwlyZXR1cm4ga3ZtaV9tc2dfdm1fcmVwbHkoa3ZtaSwgbXNnLCBlYywgTlVM
TCwgMCk7Cit9CisKIC8qCiAgKiBUaGVzZSBjb21tYW5kcyBhcmUgZXhlY3V0ZWQgYnkgdGhlIHJl
Y2VpdmluZyB0aHJlYWQvd29ya2VyLgogICovCiBzdGF0aWMgaW50KCpjb25zdCBtc2dfdm1bXSko
c3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICosCiAJCQkgICAgY29uc3Qgc3RydWN0IGt2bWlfbXNn
X2hkciAqLCBjb25zdCB2b2lkICopID0gewotCVtLVk1JX0dFVF9WRVJTSU9OXSA9IGhhbmRsZV9n
ZXRfdmVyc2lvbiwKKwlbS1ZNSV9HRVRfVkVSU0lPTl0gICAgICA9IGhhbmRsZV9nZXRfdmVyc2lv
biwKKwlbS1ZNSV9WTV9DSEVDS19DT01NQU5EXSA9IGhhbmRsZV9jaGVja19jb21tYW5kLAorCVtL
Vk1JX1ZNX0NIRUNLX0VWRU5UXSAgID0gaGFuZGxlX2NoZWNrX2V2ZW50LAogfTsKIAogc3RhdGlj
IGJvb2wgaXNfdm1fY29tbWFuZCh1MTYgaWQpCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlzdApWaXJ0dWFsaXph
dGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3RzLmxpbnV4Zm91bmRh
dGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
