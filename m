Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp1.osuosl.org (smtp1.osuosl.org [140.211.166.138])
	by mail.lfdr.de (Postfix) with ESMTPS id 97A8E6AD78F
	for <lists.virtualization@lfdr.de>; Tue,  7 Mar 2023 07:44:01 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by smtp1.osuosl.org (Postfix) with ESMTP id 49F2280EA1;
	Tue,  7 Mar 2023 06:43:58 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org 49F2280EA1
Authentication-Results: smtp1.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=bJL3ed+p
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
	by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id nocZQA0g-d81; Tue,  7 Mar 2023 06:43:57 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp1.osuosl.org (Postfix) with ESMTPS id E236D80A80;
	Tue,  7 Mar 2023 06:43:56 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org E236D80A80
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 3F146C0089;
	Tue,  7 Mar 2023 06:43:56 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp1.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id E344AC0032
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 06:43:54 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp1.osuosl.org (Postfix) with ESMTP id BAC4780A4F
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 06:43:54 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org BAC4780A4F
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp1.osuosl.org ([127.0.0.1])
 by localhost (smtp1.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id atAkFnUn2Mpl
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 06:43:54 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.8.0
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp1.osuosl.org D747080CDE
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.129.124])
 by smtp1.osuosl.org (Postfix) with ESMTPS id D747080CDE
 for <virtualization@lists.linux-foundation.org>;
 Tue,  7 Mar 2023 06:43:53 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1678171432;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=0MkA6ChW7x327ETMemkSJaxBm2Rsa4LQxJ/4AGh4/OA=;
 b=bJL3ed+pbaAuUmy6zYlvSHEU1/jj3LxPM0U0MzlcpcnnZSuN1NtzHIK+Y/HwwX2WGjJFHY
 OZYMt4tokrDIjU3/5emlaKCDE19CWlR8sdzTfByDGIdZHQIAwDxyVJnRIQu0jnDcLVtuLg
 y1q96RUnFLhY14GC7pClCkANfDjf2n8=
Received: from mail-oo1-f69.google.com (mail-oo1-f69.google.com
 [209.85.161.69]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-81-RqKnP2sKMKibWnSNNM-Svg-1; Tue, 07 Mar 2023 01:43:51 -0500
X-MC-Unique: RqKnP2sKMKibWnSNNM-Svg-1
Received: by mail-oo1-f69.google.com with SMTP id
 n10-20020a4ad12a000000b0051f97e7b7f9so3662661oor.13
 for <virtualization@lists.linux-foundation.org>;
 Mon, 06 Mar 2023 22:43:51 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112; t=1678171430;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=0MkA6ChW7x327ETMemkSJaxBm2Rsa4LQxJ/4AGh4/OA=;
 b=TrtZ1AmBb0tRrVp9921Jrs1LQMLJgPJ7lD35JvnqmpB4tTVLghJpDQpte8ZrPPOrdF
 YmVx+JmP1Q0ruQpMihduaB8YVMBWt8iPkPNapdWJTa1ELfmQHMmOhlmIoXU5ln+Nn5nR
 tQB8DuwHdFgP9JpK50VzqtM4fL4Ylpd2TzVbNDuWs6hUaO8V/wdBJm0Oy+1eN5JoxjWP
 mpJkroBuvzTLdq/W9RjnxNqLj6QSPO/thb2BoLu4+vPDfreTMu3ywZRFqvwZYZQ/7E6F
 qJg7JLzSNg4TElWdO4LqNMlWBxNtaHqmTgwR1QErRF2GK3P0rOrFxQvmV21Ae4yzTbMc
 //Fg==
X-Gm-Message-State: AO0yUKWVHr3uRCymcDLJKMkzJC+omfWQg5BhlK16qfO3+xehztt/ALCY
 +qeDQ2mdRDR5J0rhTFqRSxyqOSl5qbHoNgRp7E+f18yC0ZDhbGB/kwODZVIRbwGTxUxxEBRlW5f
 /PYKIIk5glGbkOrrfokhA+R9FaOm6hloztK/B1E75sQ5H3M7iwMK0TO4kbA==
X-Received: by 2002:a05:6808:2984:b0:384:63a:305c with SMTP id
 ex4-20020a056808298400b00384063a305cmr4357642oib.2.1678171430395; 
 Mon, 06 Mar 2023 22:43:50 -0800 (PST)
X-Google-Smtp-Source: AK7set8Z11gWP7YjdmFyHtvb8MjA1VZxf/7nX/tCyZjckazqT9tWrtol6gGue7eZWZpXiWoKY3vQZjnmx4j2AffURmQ=
X-Received: by 2002:a05:6808:2984:b0:384:63a:305c with SMTP id
 ex4-20020a056808298400b00384063a305cmr4357638oib.2.1678171430133; Mon, 06 Mar
 2023 22:43:50 -0800 (PST)
MIME-Version: 1.0
References: <20230302115908.1461-1-xuanzhuo@linux.alibaba.com>
 <20230302115908.1461-3-xuanzhuo@linux.alibaba.com>
In-Reply-To: <20230302115908.1461-3-xuanzhuo@linux.alibaba.com>
From: Jason Wang <jasowang@redhat.com>
Date: Tue, 7 Mar 2023 14:43:39 +0800
Message-ID: <CACGkMEus-e6MR9k2bPmhAUPCjCzDmO4NW+Apx=Eqptx=S9KZ+g@mail.gmail.com>
Subject: Re: [PATCH vhost v1 02/12] virtio_ring: split: separate DMA codes
To: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: "Michael S. Tsirkin" <mst@redhat.com>,
 virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gVGh1LCBNYXIgMiwgMjAyMyBhdCA3OjU54oCvUE0gWHVhbiBaaHVvIDx4dWFuemh1b0BsaW51
eC5hbGliYWJhLmNvbT4gd3JvdGU6Cj4KPiBETUEtcmVsYXRlZCBsb2dpYyBpcyBzZXBhcmF0ZWQg
ZnJvbSB0aGUgdmlydHF1ZXVlX2FkZF92cmluZ19zcGxpdCgpIHRvCj4gcHJlcGFyZSBmb3Igc3Vi
c2VxdWVudCBzdXBwb3J0IGZvciBwcmVtYXBwZWQuCj4KPiBETUEgYWRkcmVzcyB3aWxsIGJlIHNh
dmVkIGFzIHNnLT5kbWFfYWRkcmVzcywgdGhlbgo+IHZpcnRxdWV1ZV9hZGRfdnJpbmdfc3BsaXQo
KSB3aWxsIHVzZSBpdCBkaXJlY3RseS4KPgo+IElmIGl0IGlzIGEgcHJlbWFwcGVkIHNjZW5lLCB0
aGUgdHJhbnNtaXR0ZWQgc2dzIHNob3VsZCBoYXZlIHNhdmVkIERNQQo+IGFkZHJlc3MgaW4gZG1h
X2FkZHJlc3MsIGFuZCBpbiB2aXJ0aW8gY29yZSwgd2UgbmVlZCB0byBwYXNzCj4gdmlydHF1ZXVl
X21hcF9zZ3MoKS4KPgo+IFNpZ25lZC1vZmYtYnk6IFh1YW4gWmh1byA8eHVhbnpodW9AbGludXgu
YWxpYmFiYS5jb20+Cj4gLS0tCj4gIGRyaXZlcnMvdmlydGlvL3ZpcnRpb19yaW5nLmMgfCAxMTYg
KysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0KPiAgMSBmaWxlIGNoYW5nZWQsIDgw
IGluc2VydGlvbnMoKyksIDM2IGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMv
dmlydGlvL3ZpcnRpb19yaW5nLmMgYi9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fcmluZy5jCj4gaW5k
ZXggMzAwNTg5M2VjYzYxLi4xNzUyMGYwZDc2NDkgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy92aXJ0
aW8vdmlydGlvX3JpbmcuYwo+ICsrKyBiL2RyaXZlcnMvdmlydGlvL3ZpcnRpb19yaW5nLmMKPiBA
QCAtNTIwLDYgKzUyMCw3MyBAQCBzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludCB2aXJ0cXVldWVf
YWRkX2Rlc2Nfc3BsaXQoc3RydWN0IHZpcnRxdWV1ZSAqdnEsCj4gICAgICAgICByZXR1cm4gbmV4
dDsKPiAgfQo+Cj4gK3N0YXRpYyBpbnQgdmlydHF1ZXVlX21hcF9zZ3Moc3RydWN0IHZyaW5nX3Zp
cnRxdWV1ZSAqdnEsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2NhdHRl
cmxpc3QgKnNnc1tdLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50
IHRvdGFsX3NnLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IG91
dF9zZ3MsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgaW5fc2dz
KQo+ICt7Cj4gKyAgICAgICBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwo+ICsgICAgICAgdW5zaWdu
ZWQgaW50IG47Cj4gKwo+ICsgICAgICAgZm9yIChuID0gMDsgbiA8IG91dF9zZ3M7IG4rKykgewo+
ICsgICAgICAgICAgICAgICBmb3IgKHNnID0gc2dzW25dOyBzZzsgc2cgPSBzZ19uZXh0KHNnKSkg
ewo+ICsgICAgICAgICAgICAgICAgICAgICAgIGRtYV9hZGRyX3QgYWRkciA9IHZyaW5nX21hcF9v
bmVfc2codnEsIHNnLCBETUFfVE9fREVWSUNFKTsKPiArCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgaWYgKHZyaW5nX21hcHBpbmdfZXJyb3IodnEsIGFkZHIpKQo+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcmV0dXJuIC1FTk9NRU07Cj4gKwo+ICsgICAgICAgICAgICAgICAgICAg
ICAgIHNnLT5kbWFfYWRkcmVzcyA9IGFkZHI7Cj4gKyAgICAgICAgICAgICAgIH0KPiArICAgICAg
IH0KPiArCj4gKyAgICAgICBmb3IgKDsgbiA8IChvdXRfc2dzICsgaW5fc2dzKTsgbisrKSB7Cj4g
KyAgICAgICAgICAgICAgIGZvciAoc2cgPSBzZ3Nbbl07IHNnOyBzZyA9IHNnX25leHQoc2cpKSB7
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgZG1hX2FkZHJfdCBhZGRyID0gdnJpbmdfbWFwX29u
ZV9zZyh2cSwgc2csIERNQV9GUk9NX0RFVklDRSk7Cj4gKwo+ICsgICAgICAgICAgICAgICAgICAg
ICAgIGlmICh2cmluZ19tYXBwaW5nX2Vycm9yKHZxLCBhZGRyKSkKPiArICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHJldHVybiAtRU5PTUVNOwo+ICsKPiArICAgICAgICAgICAgICAgICAg
ICAgICBzZy0+ZG1hX2FkZHJlc3MgPSBhZGRyOwo+ICsgICAgICAgICAgICAgICB9Cj4gKyAgICAg
ICB9Cj4gKwo+ICsgICAgICAgcmV0dXJuIDA7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHZpcnRx
dWV1ZV91bm1hcF9zZ3Moc3RydWN0IHZyaW5nX3ZpcnRxdWV1ZSAqdnEsCj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnc1tdLAo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IHRvdGFsX3NnLAo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IG91dF9zZ3MsCj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgaW5fc2dzKQo+ICt7Cj4gKyAgICAg
ICBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwo+ICsgICAgICAgdW5zaWduZWQgaW50IG47Cj4gKwo+
ICsgICAgICAgaWYgKCF2cS0+dXNlX2RtYV9hcGkpCj4gKyAgICAgICAgICAgICAgIHJldHVybjsK
PiArCj4gKyAgICAgICBmb3IgKG4gPSAwOyBuIDwgb3V0X3NnczsgbisrKSB7Cj4gKyAgICAgICAg
ICAgICAgIGZvciAoc2cgPSBzZ3Nbbl07IHNnOyBzZyA9IHNnX25leHQoc2cpKSB7Cj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgaWYgKCFzZy0+ZG1hX2FkZHJlc3MpCj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZXR1cm47Cj4gKwo+ICsgICAgICAgICAgICAgICAgICAgICAgIGRt
YV91bm1hcF9wYWdlKHZyaW5nX2RtYV9kZXYodnEpLCBzZy0+ZG1hX2FkZHJlc3MsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2ctPmxlbmd0aCwgRE1BX1RPX0RFVklD
RSk7Cj4gKyAgICAgICAgICAgICAgIH0KPiArICAgICAgIH0KPiArCj4gKyAgICAgICBmb3IgKDsg
biA8IChvdXRfc2dzICsgaW5fc2dzKTsgbisrKSB7Cj4gKyAgICAgICAgICAgICAgIGZvciAoc2cg
PSBzZ3Nbbl07IHNnOyBzZyA9IHNnX25leHQoc2cpKSB7Cj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgaWYgKCFzZy0+ZG1hX2FkZHJlc3MpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICByZXR1cm47Cj4gKwo+ICsgICAgICAgICAgICAgICAgICAgICAgIGRtYV91bm1hcF9wYWdlKHZy
aW5nX2RtYV9kZXYodnEpLCBzZy0+ZG1hX2FkZHJlc3MsCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc2ctPmxlbmd0aCwgRE1BX0ZST01fREVWSUNFKTsKPiArICAgICAg
ICAgICAgICAgfQo+ICsgICAgICAgfQo+ICt9Cj4gKwo+ICAvKiBub3RlOiByZXR1cm4gTlVMTCBt
ZWFucyBubyBpbmRpcmVjdCB0aGF0IGlzIHZhbGlkLiAqLwo+ICBzdGF0aWMgc3RydWN0IHZyaW5n
X2Rlc2MgKnZpcnRxdWV1ZV9nZXRfZGVzY19zcGxpdChzdHJ1Y3QgdnJpbmdfdmlydHF1ZXVlICp2
cSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1
bnNpZ25lZCBpbnQgdG90YWxfc2csCj4gQEAgLTU3Nyw3ICs2NDQsNyBAQCBzdGF0aWMgaW5saW5l
IGludCB2aXJ0cXVldWVfYWRkX3ZyaW5nX3NwbGl0KHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZx
LAo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgdmlydHF1ZXVlICpfdnEgPSAmdnEtPnZxOwo+ICAgICAg
ICAgc3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKPiAtICAgICAgIHVuc2lnbmVkIGludCBpLCBuLCBh
dmFpbCwgZGVzY3NfdXNlZCwgcHJldiwgZXJyX2lkeDsKPiArICAgICAgIHVuc2lnbmVkIGludCBp
LCBuLCBhdmFpbCwgZGVzY3NfdXNlZCwgcHJldjsKPiAgICAgICAgIGludCBoZWFkOwo+ICAgICAg
ICAgYm9vbCBpbmRpcmVjdDsKPgo+IEBAIC01OTgsMzAgKzY2NSwyNSBAQCBzdGF0aWMgaW5saW5l
IGludCB2aXJ0cXVldWVfYWRkX3ZyaW5nX3NwbGl0KHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZx
LAo+Cj4gICAgICAgICBmb3IgKG4gPSAwOyBuIDwgb3V0X3NnczsgbisrKSB7Cj4gICAgICAgICAg
ICAgICAgIGZvciAoc2cgPSBzZ3Nbbl07IHNnOyBzZyA9IHNnX25leHQoc2cpKSB7Cj4gLSAgICAg
ICAgICAgICAgICAgICAgICAgZG1hX2FkZHJfdCBhZGRyID0gdnJpbmdfbWFwX29uZV9zZyh2cSwg
c2csIERNQV9UT19ERVZJQ0UpOwo+IC0gICAgICAgICAgICAgICAgICAgICAgIGlmICh2cmluZ19t
YXBwaW5nX2Vycm9yKHZxLCBhZGRyKSkKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGdvdG8gdW5tYXBfcmVsZWFzZTsKPiAtCj4gICAgICAgICAgICAgICAgICAgICAgICAgcHJldiA9
IGk7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgLyogTm90ZSB0aGF0IHdlIHRydXN0IGluZGly
ZWN0IGRlc2NyaXB0b3IKPiAgICAgICAgICAgICAgICAgICAgICAgICAgKiB0YWJsZSBzaW5jZSBp
dCB1c2Ugc3RyZWFtIERNQSBtYXBwaW5nLgo+ICAgICAgICAgICAgICAgICAgICAgICAgICAqLwo+
IC0gICAgICAgICAgICAgICAgICAgICAgIGkgPSB2aXJ0cXVldWVfYWRkX2Rlc2Nfc3BsaXQoX3Zx
LCBkZXNjLCBpLCBhZGRyLCBzZy0+bGVuZ3RoLAo+ICsgICAgICAgICAgICAgICAgICAgICAgIGkg
PSB2aXJ0cXVldWVfYWRkX2Rlc2Nfc3BsaXQoX3ZxLCBkZXNjLCBpLAo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2ctPmRtYV9hZGRyZXNzLAo+
ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2ct
Pmxlbmd0aCwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFZSSU5HX0RFU0NfRl9ORVhULAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgaW5kaXJlY3QpOwo+ICAgICAgICAgICAgICAgICB9Cj4g
ICAgICAgICB9Cj4gICAgICAgICBmb3IgKDsgbiA8IChvdXRfc2dzICsgaW5fc2dzKTsgbisrKSB7
Cj4gICAgICAgICAgICAgICAgIGZvciAoc2cgPSBzZ3Nbbl07IHNnOyBzZyA9IHNnX25leHQoc2cp
KSB7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgZG1hX2FkZHJfdCBhZGRyID0gdnJpbmdfbWFw
X29uZV9zZyh2cSwgc2csIERNQV9GUk9NX0RFVklDRSk7Cj4gLSAgICAgICAgICAgICAgICAgICAg
ICAgaWYgKHZyaW5nX21hcHBpbmdfZXJyb3IodnEsIGFkZHIpKQo+IC0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZ290byB1bm1hcF9yZWxlYXNlOwo+IC0KPiAgICAgICAgICAgICAgICAg
ICAgICAgICBwcmV2ID0gaTsKPiAgICAgICAgICAgICAgICAgICAgICAgICAvKiBOb3RlIHRoYXQg
d2UgdHJ1c3QgaW5kaXJlY3QgZGVzY3JpcHRvcgo+ICAgICAgICAgICAgICAgICAgICAgICAgICAq
IHRhYmxlIHNpbmNlIGl0IHVzZSBzdHJlYW0gRE1BIG1hcHBpbmcuCj4gICAgICAgICAgICAgICAg
ICAgICAgICAgICovCj4gLSAgICAgICAgICAgICAgICAgICAgICAgaSA9IHZpcnRxdWV1ZV9hZGRf
ZGVzY19zcGxpdChfdnEsIGRlc2MsIGksIGFkZHIsCj4gKyAgICAgICAgICAgICAgICAgICAgICAg
aSA9IHZpcnRxdWV1ZV9hZGRfZGVzY19zcGxpdChfdnEsIGRlc2MsIGksCj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZy0+ZG1hX2FkZHJlc3Ms
Cj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
Zy0+bGVuZ3RoLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgVlJJTkdfREVTQ19GX05FWFQgfAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgVlJJTkdfREVTQ19GX1dSSVRFLAo+IEBAIC02NDAs
NyArNzAyLDcgQEAgc3RhdGljIGlubGluZSBpbnQgdmlydHF1ZXVlX2FkZF92cmluZ19zcGxpdChz
dHJ1Y3QgdnJpbmdfdmlydHF1ZXVlICp2cSwKPiAgICAgICAgICAgICAgICAgICAgICAgICB2cSwg
ZGVzYywgdG90YWxfc2cgKiBzaXplb2Yoc3RydWN0IHZyaW5nX2Rlc2MpLAo+ICAgICAgICAgICAg
ICAgICAgICAgICAgIERNQV9UT19ERVZJQ0UpOwo+ICAgICAgICAgICAgICAgICBpZiAodnJpbmdf
bWFwcGluZ19lcnJvcih2cSwgYWRkcikpCj4gLSAgICAgICAgICAgICAgICAgICAgICAgZ290byB1
bm1hcF9yZWxlYXNlOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtRU5PTUVNOwo+
Cj4gICAgICAgICAgICAgICAgIHZpcnRxdWV1ZV9hZGRfZGVzY19zcGxpdChfdnEsIHZxLT5zcGxp
dC52cmluZy5kZXNjLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
aGVhZCwgYWRkciwKPiBAQCAtNjgwLDMwICs3NDIsNiBAQCBzdGF0aWMgaW5saW5lIGludCB2aXJ0
cXVldWVfYWRkX3ZyaW5nX3NwbGl0KHN0cnVjdCB2cmluZ192aXJ0cXVldWUgKnZxLAo+ICAgICAg
ICAgICAgICAgICB2aXJ0cXVldWVfa2ljayhfdnEpOwo+Cj4gICAgICAgICByZXR1cm4gMDsKPiAt
Cj4gLXVubWFwX3JlbGVhc2U6Cj4gLSAgICAgICBlcnJfaWR4ID0gaTsKPiAtCj4gLSAgICAgICBp
ZiAoaW5kaXJlY3QpCj4gLSAgICAgICAgICAgICAgIGkgPSAwOwo+IC0gICAgICAgZWxzZQo+IC0g
ICAgICAgICAgICAgICBpID0gaGVhZDsKPiAtCj4gLSAgICAgICBmb3IgKG4gPSAwOyBuIDwgdG90
YWxfc2c7IG4rKykgewo+IC0gICAgICAgICAgICAgICBpZiAoaSA9PSBlcnJfaWR4KQo+IC0gICAg
ICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+IC0gICAgICAgICAgICAgICBpZiAoaW5kaXJlY3Qp
IHsKPiAtICAgICAgICAgICAgICAgICAgICAgICB2cmluZ191bm1hcF9vbmVfc3BsaXRfaW5kaXJl
Y3QodnEsICZkZXNjW2ldKTsKPiAtICAgICAgICAgICAgICAgICAgICAgICBpID0gdmlydGlvMTZf
dG9fY3B1KF92cS0+dmRldiwgZGVzY1tpXS5uZXh0KTsKPiAtICAgICAgICAgICAgICAgfSBlbHNl
Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgaSA9IHZyaW5nX3VubWFwX29uZV9zcGxpdCh2cSwg
aSk7Cj4gLSAgICAgICB9Cj4gLQo+IC0gICAgICAgaWYgKGluZGlyZWN0KQo+IC0gICAgICAgICAg
ICAgICBrZnJlZShkZXNjKTsKPiAtCj4gLSAgICAgICBFTkRfVVNFKHZxKTsKPiAtICAgICAgIHJl
dHVybiAtRU5PTUVNOwo+ICB9Cj4KPiAgc3RhdGljIGlubGluZSBpbnQgdmlydHF1ZXVlX2FkZF9z
cGxpdChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEsCj4gQEAgLTcyOSw2ICs3NjcsMTAgQEAgc3RhdGlj
IGlubGluZSBpbnQgdmlydHF1ZXVlX2FkZF9zcGxpdChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEsCj4g
ICAgICAgICAgICAgICAgIGdvdG8gZW5kOwo+ICAgICAgICAgfQo+Cj4gKyAgICAgICBlcnIgPSB2
aXJ0cXVldWVfbWFwX3Nncyh2cSwgc2dzLCB0b3RhbF9zZywgb3V0X3NncywgaW5fc2dzKTsKPiAr
ICAgICAgIGlmIChlcnIpCj4gKyAgICAgICAgICAgICAgIGdvdG8gZXJyOwo+ICsKPiAgICAgICAg
IGhlYWQgPSB2cS0+ZnJlZV9oZWFkOwo+ICAgICAgICAgZXJyID0gdmlydHF1ZXVlX2FkZF92cmlu
Z19zcGxpdCh2cSwgc2dzLCB0b3RhbF9zZywgb3V0X3NncywgaW5fc2dzLCBkZXNjKTsKCkFueSBy
ZWFzb24gd2UgZG9uJ3QgZG8gdmlydHF1ZXVlX21hcF9zZ3MoKS92aXJ0cXVldWVfdW5tYXBfc2dz
KCkKaW5zaWRlIHZpcnRxdWV1ZV9hZGRfdnJpbmdfc3BsaXQoKT8KClRoYW5rcwoKCj4gICAgICAg
ICBpZiAoZXJyKQo+IEBAIC03NDEsNiArNzgzLDggQEAgc3RhdGljIGlubGluZSBpbnQgdmlydHF1
ZXVlX2FkZF9zcGxpdChzdHJ1Y3QgdmlydHF1ZXVlICpfdnEsCj4gICAgICAgICBnb3RvIGVuZDsK
Pgo+ICBlcnI6Cj4gKyAgICAgICB2aXJ0cXVldWVfdW5tYXBfc2dzKHZxLCBzZ3MsIHRvdGFsX3Nn
LCBvdXRfc2dzLCBpbl9zZ3MpOwo+ICsKPiAgICAgICAgIGtmcmVlKGRlc2MpOwo+Cj4gIGVuZDoK
PiAtLQo+IDIuMzIuMC4zLmcwMTE5NWNmOWYKPgoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxp
emF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3Vu
ZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
