Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp2.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id 7EFF942453B
	for <lists.virtualization@lfdr.de>; Wed,  6 Oct 2021 19:50:56 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp2.osuosl.org (Postfix) with ESMTP id 5DE00407E9;
	Wed,  6 Oct 2021 17:50:54 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
	by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id XN5OhQFvrXRV; Wed,  6 Oct 2021 17:50:52 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp2.osuosl.org (Postfix) with ESMTPS id 41F6C40D92;
	Wed,  6 Oct 2021 17:50:51 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id DA31AC001D;
	Wed,  6 Oct 2021 17:50:50 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp2.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 141D2C0023
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:46 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp2.osuosl.org (Postfix) with ESMTP id EF624407DF
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:43 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
 by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 97bnCeKF70Rj
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:42 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.8.0
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by smtp2.osuosl.org (Postfix) with ESMTPS id 5BC9F4032E
 for <virtualization@lists.linux-foundation.org>;
 Wed,  6 Oct 2021 17:50:42 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 A4DE530827AD; Wed,  6 Oct 2021 20:31:19 +0300 (EEST)
Received: from localhost (unknown [91.199.104.28])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 89C603064495;
 Wed,  6 Oct 2021 20:31:19 +0300 (EEST)
X-Is-Junk-Enabled: fGZTSsP0qEJE2AIKtlSuFiRRwg9xyHmJ
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v12 61/77] KVM: introspection: add KVMI_VCPU_EVENT_XSETBV
Date: Wed,  6 Oct 2021 20:30:57 +0300
Message-Id: <20211006173113.26445-62-alazar@bitdefender.com>
In-Reply-To: <20211006173113.26445-1-alazar@bitdefender.com>
References: <20211006173113.26445-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: Tamas K Lengyel <tamas@tklengyel.com>, Wanpeng Li <wanpengli@tencent.com>,
 =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <nicu.citu@icloud.com>,
 Sean Christopherson <seanjc@google.com>, Joerg Roedel <joro@8bytes.org>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Mathieu Tarral <mathieu.tarral@protonmail.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 Jim Mattson <jmattson@google.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKVGhpcyBldmVudCBp
cyBzZW50IHdoZW4gYW4gZXh0ZW5kZWQgY29udHJvbCByZWdpc3RlciBYQ1IgaXMgZ29pbmcgdG8K
YmUgY2hhbmdlZC4KClNpZ25lZC1vZmYtYnk6IE1paGFpIERvbsibdSA8bWRvbnR1QGJpdGRlZmVu
ZGVyLmNvbT4KQ28tZGV2ZWxvcGVkLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5pY3UuY2l0dUBpY2xv
dWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5pY3UuY2l0dUBpY2xvdWQu
Y29tPgpTaWduZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRkZWZlbmRlci5j
b20+Ci0tLQogRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCAgICAgICAgICAgICAgIHwg
MzQgKysrKysrKysKIGFyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oICAgICAgICAgICAg
ICB8ICA0ICsKIGFyY2gveDg2L2luY2x1ZGUvdWFwaS9hc20va3ZtaS5oICAgICAgICAgICAgICB8
ICA3ICsrCiBhcmNoL3g4Ni9rdm0va3ZtaS5jICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAz
MCArKysrKysrCiBhcmNoL3g4Ni9rdm0va3ZtaS5oICAgICAgICAgICAgICAgICAgICAgICAgICAg
fCAgMiArCiBhcmNoL3g4Ni9rdm0va3ZtaV9tc2cuYyAgICAgICAgICAgICAgICAgICAgICAgfCAy
MCArKysrKwogYXJjaC94ODYva3ZtL3g4Ni5jICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwg
IDYgKysKIGluY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggICAgICAgICAgICAgICAgICAgICB8ICAx
ICsKIC4uLi90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jICB8IDg0ICsr
KysrKysrKysrKysrKysrKysKIDkgZmlsZXMgY2hhbmdlZCwgMTg4IGluc2VydGlvbnMoKykKCmRp
ZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0IGIvRG9jdW1lbnRhdGlv
bi92aXJ0L2t2bS9rdm1pLnJzdAppbmRleCAxZmJjMmEwM2Y1YmQuLmQzYTBiZWE2NGUwMiAxMDA2
NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdAorKysgYi9Eb2N1bWVudGF0
aW9uL3ZpcnQva3ZtL2t2bWkucnN0CkBAIC01NDEsNiArNTQxLDcgQEAgdGhlIGZvbGxvd2luZyBl
dmVudHM6OgogCUtWTUlfVkNQVV9FVkVOVF9CUkVBS1BPSU5UCiAJS1ZNSV9WQ1BVX0VWRU5UX0NS
CiAJS1ZNSV9WQ1BVX0VWRU5UX0hZUEVSQ0FMTAorCUtWTUlfVkNQVV9FVkVOVF9YU0VUQlYKIAog
V2hlbiBhbiBldmVudCBpcyBlbmFibGVkLCB0aGUgaW50cm9zcGVjdGlvbiB0b29sIGlzIG5vdGlm
aWVkIGFuZAogbXVzdCByZXBseSB3aXRoOiBjb250aW51ZSwgcmV0cnksIGNyYXNoLCBldGMuIChz
ZWUgKipFdmVudHMqKiBiZWxvdykuCkBAIC0xMDQyLDMgKzEwNDMsMzYgQEAgb3RoZXIgdkNQVSBp
bnRyb3NwZWN0aW9uIGV2ZW50LgogKGBgbnJgYCksIGV4Y2VwdGlvbiBjb2RlIChgYGVycm9yX2Nv
ZGVgYCkgYW5kIGBgYWRkcmVzc2BgIGFyZSBzZW50IHRvCiB0aGUgaW50cm9zcGVjdGlvbiB0b29s
LCB3aGljaCBzaG91bGQgY2hlY2sgaWYgaXRzIGV4Y2VwdGlvbiBoYXMgYmVlbgogaW5qZWN0ZWQg
b3Igb3ZlcnJpZGRlbi4KKworNy4gS1ZNSV9WQ1BVX0VWRU5UX1hTRVRCVgorLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQorCis6QXJjaGl0ZWN0dXJlczogeDg2Cis6VmVyc2lvbnM6ID49IDEKKzpB
Y3Rpb25zOiBDT05USU5VRSwgQ1JBU0gKKzpQYXJhbWV0ZXJzOgorCis6OgorCisJc3RydWN0IGt2
bWlfdmNwdV9ldmVudDsKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2V2ZW50X3hzZXRidiB7CisJCV9fdTgg
eGNyOworCQlfX3U4IHBhZGRpbmdbN107CisJCV9fdTY0IG9sZF92YWx1ZTsKKwkJX191NjQgbmV3
X3ZhbHVlOworCX07CisKKzpSZXR1cm5zOgorCis6OgorCisJc3RydWN0IGt2bWlfdmNwdV9oZHI7
CisJc3RydWN0IGt2bWlfdmNwdV9ldmVudF9yZXBseTsKKworVGhpcyBldmVudCBpcyBzZW50IHdo
ZW4gYW4gZXh0ZW5kZWQgY29udHJvbCByZWdpc3RlciBYQ1IgaXMgZ29pbmcKK3RvIGJlIGNoYW5n
ZWQgYW5kIHRoZSBpbnRyb3NwZWN0aW9uIGhhcyBiZWVuIGVuYWJsZWQgZm9yIHRoaXMgZXZlbnQK
KyhzZWUgKktWTUlfVkNQVV9DT05UUk9MX0VWRU5UUyopLgorCitgYGt2bWlfdmNwdV9ldmVudGBg
ICh3aXRoIHRoZSB2Q1BVIHN0YXRlKSwgdGhlIGV4dGVuZGVkIGNvbnRyb2wgcmVnaXN0ZXIKK251
bWJlciAoYGB4Y3JgYCksIHRoZSBvbGQgdmFsdWUgKGBgb2xkX3ZhbHVlYGApIGFuZCB0aGUgbmV3
IHZhbHVlCisoYGBuZXdfdmFsdWVgYCkgYXJlIHNlbnQgdG8gdGhlIGludHJvc3BlY3Rpb24gdG9v
bC4KZGlmZiAtLWdpdCBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oIGIvYXJjaC94
ODYvaW5jbHVkZS9hc20va3ZtaV9ob3N0LmgKaW5kZXggOTdmNWIxYTAxYzllLi5kNjYzNDkyMDhh
NmIgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCisrKyBiL2Fy
Y2gveDg2L2luY2x1ZGUvYXNtL2t2bWlfaG9zdC5oCkBAIC00Niw2ICs0Niw4IEBAIGJvb2wga3Zt
aV9jcl9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHVuc2lnbmVkIGludCBjciwKIGJvb2wg
a3ZtaV9jcjNfaW50ZXJjZXB0ZWQoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsKIGJvb2wga3ZtaV9t
b25pdG9yX2NyM3dfaW50ZXJjZXB0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgYm9vbCBlbmFibGUp
Owogdm9pZCBrdm1pX2VudGVyX2d1ZXN0KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSk7Cit2b2lkIGt2
bWlfeHNldGJ2X2V2ZW50KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTggeGNyLAorCQkgICAgICAg
dTY0IG9sZF92YWx1ZSwgdTY0IG5ld192YWx1ZSk7CiAKICNlbHNlIC8qIENPTkZJR19LVk1fSU5U
Uk9TUEVDVElPTiAqLwogCkBAIC01OSw2ICs2MSw4IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBrdm1p
X2NyM19pbnRlcmNlcHRlZChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpIHsgcmV0dXJuIGZhbHNlOyB9
CiBzdGF0aWMgaW5saW5lIGJvb2wga3ZtaV9tb25pdG9yX2NyM3dfaW50ZXJjZXB0KHN0cnVjdCBr
dm1fdmNwdSAqdmNwdSwKIAkJCQkJCWJvb2wgZW5hYmxlKSB7IHJldHVybiBmYWxzZTsgfQogc3Rh
dGljIGlubGluZSB2b2lkIGt2bWlfZW50ZXJfZ3Vlc3Qoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KSB7
IH0KK3N0YXRpYyBpbmxpbmUgdm9pZCBrdm1pX3hzZXRidl9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUg
KnZjcHUsIHU4IHhjciwKKwkJCQkJdTY0IG9sZF92YWx1ZSwgdTY0IG5ld192YWx1ZSkgeyB9CiAK
ICNlbmRpZiAvKiBDT05GSUdfS1ZNX0lOVFJPU1BFQ1RJT04gKi8KIApkaWZmIC0tZ2l0IGEvYXJj
aC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmggYi9hcmNoL3g4Ni9pbmNsdWRlL3VhcGkvYXNt
L2t2bWkuaAppbmRleCBhYTk5MWZiYWI0NzMuLjYwNGE4YjNkNGFjMiAxMDA2NDQKLS0tIGEvYXJj
aC94ODYvaW5jbHVkZS91YXBpL2FzbS9rdm1pLmgKKysrIGIvYXJjaC94ODYvaW5jbHVkZS91YXBp
L2FzbS9rdm1pLmgKQEAgLTk1LDQgKzk1LDExIEBAIHN0cnVjdCBrdm1pX3ZjcHVfaW5qZWN0X2V4
Y2VwdGlvbiB7CiAJX191NjQgYWRkcmVzczsKIH07CiAKK3N0cnVjdCBrdm1pX3ZjcHVfZXZlbnRf
eHNldGJ2IHsKKwlfX3U4IHhjcjsKKwlfX3U4IHBhZGRpbmdbN107CisJX191NjQgb2xkX3ZhbHVl
OworCV9fdTY0IG5ld192YWx1ZTsKK307CisKICNlbmRpZiAvKiBfVUFQSV9BU01fWDg2X0tWTUlf
SCAqLwpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL2t2bWkuYyBiL2FyY2gveDg2L2t2bS9rdm1p
LmMKaW5kZXggOTMxMjNkNDc3NTJjLi5kMzRmNWYwM2E1NmYgMTAwNjQ0Ci0tLSBhL2FyY2gveDg2
L2t2bS9rdm1pLmMKKysrIGIvYXJjaC94ODYva3ZtL2t2bWkuYwpAQCAtMTYsNiArMTYsNyBAQCB2
b2lkIGt2bWlfYXJjaF9pbml0X3ZjcHVfZXZlbnRzX21hc2sodW5zaWduZWQgbG9uZyAqc3VwcG9y
dGVkKQogCXNldF9iaXQoS1ZNSV9WQ1BVX0VWRU5UX0NSLCBzdXBwb3J0ZWQpOwogCXNldF9iaXQo
S1ZNSV9WQ1BVX0VWRU5UX0hZUEVSQ0FMTCwgc3VwcG9ydGVkKTsKIAlzZXRfYml0KEtWTUlfVkNQ
VV9FVkVOVF9UUkFQLCBzdXBwb3J0ZWQpOworCXNldF9iaXQoS1ZNSV9WQ1BVX0VWRU5UX1hTRVRC
Viwgc3VwcG9ydGVkKTsKIH0KIAogc3RhdGljIHVuc2lnbmVkIGludCBrdm1pX3ZjcHVfbW9kZShj
b25zdCBzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsCkBAIC01NjcsMyArNTY4LDMyIEBAIHZvaWQga3Zt
aV9hcmNoX3NlbmRfcGVuZGluZ19ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUpCiAJCWt2bWlf
c2VuZF90cmFwX2V2ZW50KHZjcHUpOwogCX0KIH0KKworc3RhdGljIHZvaWQgX19rdm1pX3hzZXRi
dl9ldmVudChzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHU4IHhjciwKKwkJCQl1NjQgb2xkX3ZhbHVl
LCB1NjQgbmV3X3ZhbHVlKQoreworCXUzMiBhY3Rpb247CisKKwlhY3Rpb24gPSBrdm1pX21zZ19z
ZW5kX3ZjcHVfeHNldGJ2KHZjcHUsIHhjciwgb2xkX3ZhbHVlLCBuZXdfdmFsdWUpOworCXN3aXRj
aCAoYWN0aW9uKSB7CisJY2FzZSBLVk1JX0VWRU5UX0FDVElPTl9DT05USU5VRToKKwkJYnJlYWs7
CisJZGVmYXVsdDoKKwkJa3ZtaV9oYW5kbGVfY29tbW9uX2V2ZW50X2FjdGlvbnModmNwdSwgYWN0
aW9uKTsKKwl9Cit9CisKK3ZvaWQga3ZtaV94c2V0YnZfZXZlbnQoc3RydWN0IGt2bV92Y3B1ICp2
Y3B1LCB1OCB4Y3IsCisJCSAgICAgICB1NjQgb2xkX3ZhbHVlLCB1NjQgbmV3X3ZhbHVlKQorewor
CXN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaTsKKworCWt2bWkgPSBrdm1pX2dldCh2Y3B1
LT5rdm0pOworCWlmICgha3ZtaSkKKwkJcmV0dXJuOworCisJaWYgKGlzX3ZjcHVfZXZlbnRfZW5h
YmxlZCh2Y3B1LCBLVk1JX1ZDUFVfRVZFTlRfWFNFVEJWKSkKKwkJX19rdm1pX3hzZXRidl9ldmVu
dCh2Y3B1LCB4Y3IsIG9sZF92YWx1ZSwgbmV3X3ZhbHVlKTsKKworCWt2bWlfcHV0KHZjcHUtPmt2
bSk7Cit9CmRpZmYgLS1naXQgYS9hcmNoL3g4Ni9rdm0va3ZtaS5oIGIvYXJjaC94ODYva3ZtL2t2
bWkuaAppbmRleCAyNjVmZWNlMTQ4ZDIuLjQzYmM5NTZkNzQwYyAxMDA2NDQKLS0tIGEvYXJjaC94
ODYva3ZtL2t2bWkuaAorKysgYi9hcmNoL3g4Ni9rdm0va3ZtaS5oCkBAIC0xNCw1ICsxNCw3IEBA
IGludCBrdm1pX2FyY2hfY21kX3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbihzdHJ1Y3Qga3ZtX3ZjcHUg
KnZjcHUsCiB1MzIga3ZtaV9tc2dfc2VuZF92Y3B1X2NyKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwg
dTMyIGNyLCB1NjQgb2xkX3ZhbHVlLAogCQkJICB1NjQgbmV3X3ZhbHVlLCB1NjQgKnJldF92YWx1
ZSk7CiB1MzIga3ZtaV9tc2dfc2VuZF92Y3B1X3RyYXAoc3RydWN0IGt2bV92Y3B1ICp2Y3B1KTsK
K3UzMiBrdm1pX21zZ19zZW5kX3ZjcHVfeHNldGJ2KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTgg
eGNyLAorCQkJICAgICAgdTY0IG9sZF92YWx1ZSwgdTY0IG5ld192YWx1ZSk7CiAKICNlbmRpZgpk
aWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMgYi9hcmNoL3g4Ni9rdm0va3ZtaV9t
c2cuYwppbmRleCAzOWNiYWI5ZjI5M2EuLmM3NjdiOTY5ZGY1MyAxMDA2NDQKLS0tIGEvYXJjaC94
ODYva3ZtL2t2bWlfbXNnLmMKKysrIGIvYXJjaC94ODYva3ZtL2t2bWlfbXNnLmMKQEAgLTIzMiwz
ICsyMzIsMjMgQEAgdTMyIGt2bWlfbXNnX3NlbmRfdmNwdV90cmFwKHN0cnVjdCBrdm1fdmNwdSAq
dmNwdSkKIAogCXJldHVybiBhY3Rpb247CiB9CisKK3UzMiBrdm1pX21zZ19zZW5kX3ZjcHVfeHNl
dGJ2KHN0cnVjdCBrdm1fdmNwdSAqdmNwdSwgdTggeGNyLAorCQkJICAgICAgdTY0IG9sZF92YWx1
ZSwgdTY0IG5ld192YWx1ZSkKK3sKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2V2ZW50X3hzZXRidiBlOwor
CXUzMiBhY3Rpb247CisJaW50IGVycjsKKworCW1lbXNldCgmZSwgMCwgc2l6ZW9mKGUpKTsKKwll
LnhjciA9IHhjcjsKKwllLm9sZF92YWx1ZSA9IG9sZF92YWx1ZTsKKwllLm5ld192YWx1ZSA9IG5l
d192YWx1ZTsKKworCWVyciA9IGt2bWlfc2VuZF92Y3B1X2V2ZW50KHZjcHUsIEtWTUlfVkNQVV9F
VkVOVF9YU0VUQlYsCisJCQkJICAgJmUsIHNpemVvZihlKSwgTlVMTCwgMCwgJmFjdGlvbik7CisJ
aWYgKGVycikKKwkJYWN0aW9uID0gS1ZNSV9FVkVOVF9BQ1RJT05fQ09OVElOVUU7CisKKwlyZXR1
cm4gYWN0aW9uOworfQpkaWZmIC0tZ2l0IGEvYXJjaC94ODYva3ZtL3g4Ni5jIGIvYXJjaC94ODYv
a3ZtL3g4Ni5jCmluZGV4IGJjMDE3YzJiZjdiYi4uOTliMzVlNjkwMjlhIDEwMDY0NAotLS0gYS9h
cmNoL3g4Ni9rdm0veDg2LmMKKysrIGIvYXJjaC94ODYva3ZtL3g4Ni5jCkBAIC05OTUsNiArOTk1
LDEyIEBAIHN0YXRpYyBpbnQgX19rdm1fc2V0X3hjcihzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHUsIHUz
MiBpbmRleCwgdTY0IHhjcikKIAl9CiAJdmNwdS0+YXJjaC54Y3IwID0geGNyMDsKIAorI2lmZGVm
IENPTkZJR19LVk1fSU5UUk9TUEVDVElPTgorCWlmIChpbmRleCA9PSAwICYmIHhjcjAgIT0gb2xk
X3hjcjApCisJCWt2bWlfeHNldGJ2X2V2ZW50KHZjcHUsIDAsIG9sZF94Y3IwLCB4Y3IwKTsKKyNl
bmRpZiAvKiBDT05GSUdfS1ZNX0lOVFJPU1BFQ1RJT04gKi8KKworCiAJaWYgKCh4Y3IwIF4gb2xk
X3hjcjApICYgWEZFQVRVUkVfTUFTS19FWFRFTkQpCiAJCWt2bV91cGRhdGVfY3B1aWRfcnVudGlt
ZSh2Y3B1KTsKIAlyZXR1cm4gMDsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1p
LmggYi9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCmluZGV4IDI2M2Q5OGE1OTAzZS4uNGI3MWM2
YjBiMTZjIDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2luY2x1
ZGUvdWFwaS9saW51eC9rdm1pLmgKQEAgLTYyLDYgKzYyLDcgQEAgZW51bSB7CiAJS1ZNSV9WQ1BV
X0VWRU5UX0JSRUFLUE9JTlQgPSBLVk1JX1ZDUFVfRVZFTlRfSUQoMiksCiAJS1ZNSV9WQ1BVX0VW
RU5UX0NSICAgICAgICAgPSBLVk1JX1ZDUFVfRVZFTlRfSUQoMyksCiAJS1ZNSV9WQ1BVX0VWRU5U
X1RSQVAgICAgICAgPSBLVk1JX1ZDUFVfRVZFTlRfSUQoNCksCisJS1ZNSV9WQ1BVX0VWRU5UX1hT
RVRCViAgICAgPSBLVk1JX1ZDUFVfRVZFTlRfSUQoNSksCiAKIAlLVk1JX05FWFRfVkNQVV9FVkVO
VAogfTsKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3Zt
aV90ZXN0LmMgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5j
CmluZGV4IDc4MTQ2MjZjYmE3Ny4uMzgwYWEzZDJkOGYzIDEwMDY0NAotLS0gYS90b29scy90ZXN0
aW5nL3NlbGZ0ZXN0cy9rdm0veDg2XzY0L2t2bWlfdGVzdC5jCisrKyBiL3Rvb2xzL3Rlc3Rpbmcv
c2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKQEAgLTIzLDYgKzIzLDggQEAKIAogI2Rl
ZmluZSBWQ1BVX0lEIDEKIAorI2RlZmluZSBYODZfRkVBVFVSRV9YU0FWRQkoMTw8MjYpCisKIHN0
YXRpYyBpbnQgc29ja2V0X3BhaXJbMl07CiAjZGVmaW5lIEt2bV9zb2NrZXQgICAgICAgc29ja2V0
X3BhaXJbMF0KICNkZWZpbmUgVXNlcnNwYWNlX3NvY2tldCBzb2NrZXRfcGFpclsxXQpAQCAtNTcs
NiArNTksNyBAQCBlbnVtIHsKIAlHVUVTVF9URVNUX0JQLAogCUdVRVNUX1RFU1RfQ1IsCiAJR1VF
U1RfVEVTVF9IWVBFUkNBTEwsCisJR1VFU1RfVEVTVF9YU0VUQlYsCiB9OwogCiAjZGVmaW5lIEdV
RVNUX1JFUVVFU1RfVEVTVCgpICAgICBHVUVTVF9TWU5DKDApCkBAIC05Miw2ICs5NSw0NSBAQCBz
dGF0aWMgdm9pZCBndWVzdF9oeXBlcmNhbGxfdGVzdCh2b2lkKQogCWFzbSB2b2xhdGlsZSgiLmJ5
dGUgMHgwZiwweDAxLDB4YzEiKTsKIH0KIAorLyogZnJvbSBmcHUvaW50ZXJuYWwuaCAqLworc3Rh
dGljIHU2NCB4Z2V0YnYodTMyIGluZGV4KQoreworCXUzMiBlYXgsIGVkeDsKKworCWFzbSB2b2xh
dGlsZSgiLmJ5dGUgMHgwZiwweDAxLDB4ZDAiIC8qIHhnZXRidiAqLworCQkgICAgIDogIj1hIiAo
ZWF4KSwgIj1kIiAoZWR4KQorCQkgICAgIDogImMiIChpbmRleCkpOworCXJldHVybiBlYXggKyAo
KHU2NCllZHggPDwgMzIpOworfQorCisvKiBmcm9tIGZwdS9pbnRlcm5hbC5oICovCitzdGF0aWMg
dm9pZCB4c2V0YnYodTMyIGluZGV4LCB1NjQgdmFsdWUpCit7CisJdTMyIGVheCA9IHZhbHVlOwor
CXUzMiBlZHggPSB2YWx1ZSA+PiAzMjsKKworCWFzbSB2b2xhdGlsZSgiLmJ5dGUgMHgwZiwweDAx
LDB4ZDEiIC8qIHhzZXRidiAqLworCQkgICAgIDogOiAiYSIgKGVheCksICJkIiAoZWR4KSwgImMi
IChpbmRleCkpOworfQorCitzdGF0aWMgdm9pZCBndWVzdF94c2V0YnZfdGVzdCh2b2lkKQorewor
CWNvbnN0IGludCBTU0VfQklUID0gMSA8PCAxOworCWNvbnN0IGludCBBVlhfQklUID0gMSA8PCAy
OworCXU2NCB4Y3IwOworCisJLyogYXZvaWQgI1VEICovCisJc2V0X2NyNChnZXRfY3I0KCkgfCBY
ODZfQ1I0X09TWFNBVkUpOworCisJeGNyMCA9IHhnZXRidigwKTsKKwlpZiAoeGNyMCAmIEFWWF9C
SVQpCisJCXhjcjAgJj0gfkFWWF9CSVQ7CisJZWxzZQorCQl4Y3IwIHw9IChBVlhfQklUIHwgU1NF
X0JJVCk7CisKKwl4c2V0YnYoMCwgeGNyMCk7Cit9CisKIHN0YXRpYyB2b2lkIGd1ZXN0X2NvZGUo
dm9pZCkKIHsKIAl3aGlsZSAodHJ1ZSkgewpAQCAtMTA3LDYgKzE0OSw5IEBAIHN0YXRpYyB2b2lk
IGd1ZXN0X2NvZGUodm9pZCkKIAkJY2FzZSBHVUVTVF9URVNUX0hZUEVSQ0FMTDoKIAkJCWd1ZXN0
X2h5cGVyY2FsbF90ZXN0KCk7CiAJCQlicmVhazsKKwkJY2FzZSBHVUVTVF9URVNUX1hTRVRCVjoK
KwkJCWd1ZXN0X3hzZXRidl90ZXN0KCk7CisJCQlicmVhazsKIAkJfQogCQlHVUVTVF9TSUdOQUxf
VEVTVF9ET05FKCk7CiAJfQpAQCAtMTMyMiw2ICsxMzY3LDQ0IEBAIHN0YXRpYyB2b2lkIHRlc3Rf
Y21kX3ZjcHVfaW5qZWN0X2V4Y2VwdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIAlkaXNhYmxlX3Zj
cHVfZXZlbnQodm0sIEtWTUlfVkNQVV9FVkVOVF9CUkVBS1BPSU5UKTsKIH0KIAorc3RhdGljIHZv
aWQgdGVzdF9ldmVudF94c2V0YnYoc3RydWN0IGt2bV92bSAqdm0pCit7CisJc3RydWN0IHZjcHVf
d29ya2VyX2RhdGEgZGF0YSA9IHsKKwkJLnZtID0gdm0sCisJCS52Y3B1X2lkID0gVkNQVV9JRCwK
KwkJLnRlc3RfaWQgPSBHVUVTVF9URVNUX1hTRVRCViwKKwl9OworCV9fdTE2IGV2ZW50X2lkID0g
S1ZNSV9WQ1BVX0VWRU5UX1hTRVRCVjsKKwlzdHJ1Y3Qga3ZtX2NwdWlkX2VudHJ5MiAqZW50cnk7
CisJc3RydWN0IHZjcHVfcmVwbHkgcnBsID0ge307CisJc3RydWN0IGt2bWlfbXNnX2hkciBoZHI7
CisJcHRocmVhZF90IHZjcHVfdGhyZWFkOworCXN0cnVjdCB7CisJCXN0cnVjdCB2Y3B1X2V2ZW50
IHZjcHVfZXY7CisJCXN0cnVjdCBrdm1pX3ZjcHVfZXZlbnRfeHNldGJ2IHhzZXRidjsKKwl9IGV2
OworCisJZW50cnkgPSBrdm1fZ2V0X3N1cHBvcnRlZF9jcHVpZF9lbnRyeSgxKTsKKwlpZiAoIShl
bnRyeS0+ZWN4ICYgWDg2X0ZFQVRVUkVfWFNBVkUpKSB7CisJCXByaW50X3NraXAoIlhTQVZFIG5v
dCBzdXBwb3J0ZWQsIGVjeCAweCV4IiwgZW50cnktPmVjeCk7CisJCXJldHVybjsKKwl9CisKKwll
bmFibGVfdmNwdV9ldmVudCh2bSwgZXZlbnRfaWQpOworCXZjcHVfdGhyZWFkID0gc3RhcnRfdmNw
dV93b3JrZXIoJmRhdGEpOworCisJcmVjZWl2ZV92Y3B1X2V2ZW50KCZoZHIsICZldi52Y3B1X2V2
LCBzaXplb2YoZXYpLCBldmVudF9pZCk7CisKKwlwcl9kZWJ1ZygiWFNFVEJWIGV2ZW50LCBYQ1Il
dSwgb2xkIDB4JWxseCwgbmV3IDB4JWxseFxuIiwKKwkJIGV2LnhzZXRidi54Y3IsIGV2LnhzZXRi
di5vbGRfdmFsdWUsIGV2LnhzZXRidi5uZXdfdmFsdWUpOworCisJcmVwbHlfdG9fZXZlbnQoJmhk
ciwgJmV2LnZjcHVfZXYsIEtWTUlfRVZFTlRfQUNUSU9OX0NPTlRJTlVFLAorCQkJJnJwbCwgc2l6
ZW9mKHJwbCkpOworCisJd2FpdF92Y3B1X3dvcmtlcih2Y3B1X3RocmVhZCk7CisJZGlzYWJsZV92
Y3B1X2V2ZW50KHZtLCBldmVudF9pZCk7Cit9CisKIHN0YXRpYyB2b2lkIHRlc3RfaW50cm9zcGVj
dGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKIHsKIAlzcmFuZG9tKHRpbWUoMCkpOwpAQCAtMTM0Nyw2
ICsxNDMwLDcgQEAgc3RhdGljIHZvaWQgdGVzdF9pbnRyb3NwZWN0aW9uKHN0cnVjdCBrdm1fdm0g
KnZtKQogCXRlc3RfY21kX3ZtX2NvbnRyb2xfY2xlYW51cCh2bSk7CiAJdGVzdF9jbWRfdmNwdV9j
b250cm9sX2NyKHZtKTsKIAl0ZXN0X2NtZF92Y3B1X2luamVjdF9leGNlcHRpb24odm0pOworCXRl
c3RfZXZlbnRfeHNldGJ2KHZtKTsKIAogCXVuaG9va19pbnRyb3NwZWN0aW9uKHZtKTsKIH0KX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRp
b24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3Jn
Cmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1
YWxpemF0aW9u
