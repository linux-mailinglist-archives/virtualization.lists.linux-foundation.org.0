Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id D44C6155E0F
	for <lists.virtualization@lfdr.de>; Fri,  7 Feb 2020 19:26:33 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 7AD8B86A10;
	Fri,  7 Feb 2020 18:26:31 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id BVdXGIQeYDIU; Fri,  7 Feb 2020 18:26:27 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 4400586AAB;
	Fri,  7 Feb 2020 18:26:06 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 3C6BDC013E;
	Fri,  7 Feb 2020 18:26:06 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from whitealder.osuosl.org (smtp1.osuosl.org [140.211.166.138])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 68C23C1D81
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:26:00 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by whitealder.osuosl.org (Postfix) with ESMTP id 5207086E7F
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:26:00 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from whitealder.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id LM4i3RxN1FnQ
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:57 +0000 (UTC)
X-Greylist: domain auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by whitealder.osuosl.org (Postfix) with ESMTPS id CE5BD86DF4
 for <virtualization@lists.linux-foundation.org>;
 Fri,  7 Feb 2020 18:25:55 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 CF1CD305D34F; Fri,  7 Feb 2020 20:16:40 +0200 (EET)
Received: from host.bbu.bitdefender.biz (unknown [195.210.4.22])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id C0FB03011E0E;
 Fri,  7 Feb 2020 20:16:40 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [RFC PATCH v7 49/78] KVM: introspection: handle vCPU commands
Date: Fri,  7 Feb 2020 20:16:07 +0200
Message-Id: <20200207181636.1065-50-alazar@bitdefender.com>
In-Reply-To: <20200207181636.1065-1-alazar@bitdefender.com>
References: <20200207181636.1065-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Nicu=C8=99or=20C=C3=AE=C8=9Bu?= <ncitu@bitdefender.com>,
 =?UTF-8?q?Mihai=20Don=C8=9Bu?= <mdontu@bitdefender.com>,
 Sean Christopherson <sean.j.christopherson@intel.com>,
 virtualization@lists.linux-foundation.org,
 =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

RnJvbTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0ZGVmZW5kZXIuY29tPgoKQmFzZWQgb24gdGhl
IGNvbW1vbiBzdHJ1Y3R1cmUgKGt2bWlfdmNwdV9oZHIpIHVzZWQgZm9yIGFsbCB2Q1BVIGNvbW1h
bmRzLAp0aGUgcmVjZWl2aW5nIHRocmVhZCB2YWxpZGF0ZXMgYW5kIGRpc3BhdGNoZXMgdGhlIG1l
c3NhZ2UgdG8gdGhlIHByb3Blcgp2Q1BVIChhZGRpbmcgdGhlIGhhbmRsaW5nIGZ1bmN0aW9uIHRv
IGl0cyBqb2JzIGxpc3QpLgoKU2lnbmVkLW9mZi1ieTogTWloYWkgRG9uyJt1IDxtZG9udHVAYml0
ZGVmZW5kZXIuY29tPgpDby1kZXZlbG9wZWQtYnk6IE5pY3XImW9yIEPDrsibdSA8bmNpdHVAYml0
ZGVmZW5kZXIuY29tPgpTaWduZWQtb2ZmLWJ5OiBOaWN1yJlvciBDw67Im3UgPG5jaXR1QGJpdGRl
ZmVuZGVyLmNvbT4KQ28tZGV2ZWxvcGVkLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFsYXphckBiaXRk
ZWZlbmRlci5jb20+ClNpZ25lZC1vZmYtYnk6IEFkYWxiZXJ0IExhesSDciA8YWxhemFyQGJpdGRl
ZmVuZGVyLmNvbT4KLS0tCiBEb2N1bWVudGF0aW9uL3ZpcnQva3ZtL2t2bWkucnN0ICAgfCAgIDgg
KysKIGluY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggICAgICAgICB8ICAgNiArKwogdmlydC9rdm0v
aW50cm9zcGVjdGlvbi9rdm1pX2ludC5oIHwgICAzICsKIHZpcnQva3ZtL2ludHJvc3BlY3Rpb24v
a3ZtaV9tc2cuYyB8IDE1MSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0KIDQgZmlsZXMg
Y2hhbmdlZCwgMTY2IGluc2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
RG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9rdm1pLnJzdCBiL0RvY3VtZW50YXRpb24vdmlydC9rdm0v
a3ZtaS5yc3QKaW5kZXggNjBmYTUwNTg1YzM2Li4zOGY1NjZiMDdiYjUgMTAwNjQ0Ci0tLSBhL0Rv
Y3VtZW50YXRpb24vdmlydC9rdm0va3ZtaS5yc3QKKysrIGIvRG9jdW1lbnRhdGlvbi92aXJ0L2t2
bS9rdm1pLnJzdApAQCAtMjMyLDYgKzIzMiwxNCBAQCBUaGUgZm9sbG93aW5nIEMgc3RydWN0dXJl
cyBhcmUgbWVhbnQgdG8gYmUgdXNlZCBkaXJlY3RseSB3aGVuIGNvbW11bmljYXRpbmcKIG92ZXIg
dGhlIHdpcmUuIFRoZSBwZWVyIHRoYXQgZGV0ZWN0cyBhbnkgc2l6ZSBtaXNtYXRjaCBzaG91bGQg
c2ltcGx5IGNsb3NlCiB0aGUgY29ubmVjdGlvbiBhbmQgcmVwb3J0IHRoZSBlcnJvci4KIAorVGhl
IGNvbW1hbmRzIHJlbGF0ZWQgdG8gdkNQVXMgc3RhcnQgd2l0aDo6CisKKwlzdHJ1Y3Qga3ZtaV92
Y3B1X2hkciB7CisJCV9fdTE2IHZjcHU7CisJCV9fdTE2IHBhZGRpbmcxOworCQlfX3UzMiBwYWRk
aW5nMjsKKwl9CisKIDEuIEtWTUlfR0VUX1ZFUlNJT04KIC0tLS0tLS0tLS0tLS0tLS0tLS0KIApk
aWZmIC0tZ2l0IGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaCBiL2luY2x1ZGUvdWFwaS9saW51
eC9rdm1pLmgKaW5kZXggM2I4NTkwYzBmYzk4Li5iMmNiZWZkYjhiMjkgMTAwNjQ0Ci0tLSBhL2lu
Y2x1ZGUvdWFwaS9saW51eC9rdm1pLmgKKysrIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2bWkuaApA
QCAtODksNiArODksMTIgQEAgc3RydWN0IGt2bWlfdm1fd3JpdGVfcGh5c2ljYWwgewogCV9fdTgg
IGRhdGFbMF07CiB9OwogCitzdHJ1Y3Qga3ZtaV92Y3B1X2hkciB7CisJX191MTYgdmNwdTsKKwlf
X3UxNiBwYWRkaW5nMTsKKwlfX3UzMiBwYWRkaW5nMjsKK307CisKIHN0cnVjdCBrdm1pX2V2ZW50
IHsKIAlfX3UxNiBzaXplOwogCV9fdTE2IHZjcHU7CmRpZmYgLS1naXQgYS92aXJ0L2t2bS9pbnRy
b3NwZWN0aW9uL2t2bWlfaW50LmggYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlfaW50LmgK
aW5kZXggZTBkODI1NjE2MmY5Li5lN2ViYjRkNjdkZDYgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2lu
dHJvc3BlY3Rpb24va3ZtaV9pbnQuaAorKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlf
aW50LmgKQEAgLTU1LDYgKzU1LDkgQEAgaW50IGt2bWlfbXNnX3NlbmRfdW5ob29rKHN0cnVjdCBr
dm1faW50cm9zcGVjdGlvbiAqa3ZtaSk7CiB2b2lkICprdm1pX21zZ19hbGxvYyh2b2lkKTsKIHZv
aWQgKmt2bWlfbXNnX2FsbG9jX2NoZWNrKHNpemVfdCBzaXplKTsKIHZvaWQga3ZtaV9tc2dfZnJl
ZSh2b2lkICphZGRyKTsKK2ludCBrdm1pX2FkZF9qb2Ioc3RydWN0IGt2bV92Y3B1ICp2Y3B1LAor
CQkgdm9pZCAoKmZjdCkoc3RydWN0IGt2bV92Y3B1ICp2Y3B1LCB2b2lkICpjdHgpLAorCQkgdm9p
ZCAqY3R4LCB2b2lkICgqZnJlZV9mY3QpKHZvaWQgKmN0eCkpOwogaW50IGt2bWlfY21kX3ZtX2Nv
bnRyb2xfZXZlbnRzKHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSwKIAkJCQl1bnNpZ25l
ZCBpbnQgZXZlbnRfaWQsIGJvb2wgZW5hYmxlKTsKIGludCBrdm1pX2NtZF9yZWFkX3BoeXNpY2Fs
KHN0cnVjdCBrdm0gKmt2bSwgdTY0IGdwYSwgdTY0IHNpemUsCmRpZmYgLS1naXQgYS92aXJ0L2t2
bS9pbnRyb3NwZWN0aW9uL2t2bWlfbXNnLmMgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9uL2t2bWlf
bXNnLmMKaW5kZXggMDMyYjZiNWI4MDAwLi45NDIyNTE1M2Y3Y2MgMTAwNjQ0Ci0tLSBhL3ZpcnQv
a3ZtL2ludHJvc3BlY3Rpb24va3ZtaV9tc2cuYworKysgYi92aXJ0L2t2bS9pbnRyb3NwZWN0aW9u
L2t2bWlfbXNnLmMKQEAgLTgsNiArOCwxNCBAQAogI2luY2x1ZGUgPGxpbnV4L25ldC5oPgogI2lu
Y2x1ZGUgImt2bWlfaW50LmgiCiAKK3N0cnVjdCBrdm1pX3ZjcHVfY21kX2pvYiB7CisJc3RydWN0
IHsKKwkJc3RydWN0IGt2bWlfbXNnX2hkciBoZHI7CisJCXN0cnVjdCBrdm1pX3ZjcHVfaGRyIGNt
ZDsKKwl9ICptc2c7CisJc3RydWN0IGt2bV92Y3B1ICp2Y3B1OworfTsKKwogc3RhdGljIGNvbnN0
IGNoYXIgKmNvbnN0IG1zZ19JRHNbXSA9IHsKIAlbS1ZNSV9HRVRfVkVSU0lPTl0gICAgICAgPSAi
S1ZNSV9HRVRfVkVSU0lPTiIsCiAJW0tWTUlfVk1fQ0hFQ0tfQ09NTUFORF0gID0gIktWTUlfVk1f
Q0hFQ0tfQ09NTUFORCIsCkBAIC0xMjMsNiArMTMxLDI4IEBAIHN0YXRpYyBib29sIGlzX2NvbW1h
bmRfYWxsb3dlZChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksIGludCBpZCkKIAlyZXR1
cm4gdGVzdF9iaXQoaWQsIGt2bWktPmNtZF9hbGxvd19tYXNrKTsKIH0KIAorc3RhdGljIGJvb2wg
aW52YWxpZF92Y3B1X2hkcihjb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X2hkciAqaGRyKQoreworCXJl
dHVybiBoZHItPnBhZGRpbmcxIHx8IGhkci0+cGFkZGluZzI7Cit9CisKK3N0YXRpYyBpbnQga3Zt
aV9nZXRfdmNwdShzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksIHVuc2lnbmVkIGludCB2
Y3B1X2lkeCwKKwkJCSBzdHJ1Y3Qga3ZtX3ZjcHUgKipkZXN0KQoreworCXN0cnVjdCBrdm0gKmt2
bSA9IGt2bWktPmt2bTsKKwlzdHJ1Y3Qga3ZtX3ZjcHUgKnZjcHU7CisKKwlpZiAodmNwdV9pZHgg
Pj0gYXRvbWljX3JlYWQoJmt2bS0+b25saW5lX3ZjcHVzKSkKKwkJcmV0dXJuIC1LVk1fRUlOVkFM
OworCisJdmNwdSA9IGt2bV9nZXRfdmNwdShrdm0sIHZjcHVfaWR4KTsKKwlpZiAoIXZjcHUpCisJ
CXJldHVybiAtS1ZNX0VJTlZBTDsKKworCSpkZXN0ID0gdmNwdTsKKwlyZXR1cm4gMDsKK30KKwog
c3RhdGljIGludCBoYW5kbGVfZ2V0X3ZlcnNpb24oc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICpr
dm1pLAogCQkJICAgICAgY29uc3Qgc3RydWN0IGt2bWlfbXNnX2hkciAqbXNnLCBjb25zdCB2b2lk
ICpyZXEpCiB7CkBAIC0yNjUsMTYgKzI5NSw2NyBAQCBzdGF0aWMgaW50KCpjb25zdCBtc2dfdm1b
XSkoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICosCiAJW0tWTUlfVk1fV1JJVEVfUEhZU0lDQUxd
ID0gaGFuZGxlX3dyaXRlX3BoeXNpY2FsLAogfTsKIAorLyoKKyAqIFRoZXNlIGNvbW1hbmRzIGFy
ZSBleGVjdXRlZCBvbiB0aGUgdkNQVSB0aHJlYWQuIFRoZSByZWNlaXZpbmcgdGhyZWFkCisgKiBw
YXNzZXMgdGhlIG1lc3NhZ2VzIHVzaW5nIGEgbmV3bHkgYWxsb2NhdGVkICdzdHJ1Y3Qga3ZtaV92
Y3B1X2NtZF9qb2InCisgKiBhbmQgc2lnbmFscyB0aGUgdkNQVSB0byBoYW5kbGUgdGhlIGNvbW1h
bmQgKHdoaWNoIGluY2x1ZGVzCisgKiBzZW5kaW5nIGJhY2sgdGhlIHJlcGx5KS4KKyAqLworc3Rh
dGljIGludCgqY29uc3QgbXNnX3ZjcHVbXSkoY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9jbWRfam9i
ICosCisJCQkgICAgICBjb25zdCBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICosIGNvbnN0IHZvaWQgKikg
PSB7Cit9OworCitzdGF0aWMgdm9pZCBrdm1pX2pvYl92Y3B1X2NtZChzdHJ1Y3Qga3ZtX3ZjcHUg
KnZjcHUsIHZvaWQgKmN0eCkKK3sKKwlzdHJ1Y3Qga3ZtaV92Y3B1X2NtZF9qb2IgKmpvYiA9IGN0
eDsKKwlzaXplX3QgaWQgPSBqb2ItPm1zZy0+aGRyLmlkOworCWludCBlcnI7CisKKwlqb2ItPnZj
cHUgPSB2Y3B1OworCisJZXJyID0gbXNnX3ZjcHVbaWRdKGpvYiwgJmpvYi0+bXNnLT5oZHIsIGpv
Yi0+bXNnICsgMSk7CisKKwlpZiAoZXJyKSB7CisJCXN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAq
a3ZtaSA9IEtWTUkodmNwdS0+a3ZtKTsKKworCQlrdm1pX2Vycihrdm1pLAorCQkJICIlczogY21k
IGlkOiAlenUgKCVzKSwgZXJyOiAlZFxuIiwgX19mdW5jX18sCisJCQkgaWQsIGlkMnN0cihpZCks
IGVycik7CisJCWt2bWlfc29ja19zaHV0ZG93bihrdm1pKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lk
IGt2bWlfZnJlZV9jdHgodm9pZCAqX2N0eCkKK3sKKwljb25zdCBzdHJ1Y3Qga3ZtaV92Y3B1X2Nt
ZF9qb2IgKmN0eCA9IF9jdHg7CisKKwlrdm1pX21zZ19mcmVlKGN0eC0+bXNnKTsKKwlrZnJlZShj
dHgpOworfQorCitzdGF0aWMgaW50IGt2bWlfbXNnX3F1ZXVlX3RvX3ZjcHUoc3RydWN0IGt2bV92
Y3B1ICp2Y3B1LAorCQkJCSAgY29uc3Qgc3RydWN0IGt2bWlfdmNwdV9jbWRfam9iICpjbWQpCit7
CisJcmV0dXJuIGt2bWlfYWRkX2pvYih2Y3B1LCBrdm1pX2pvYl92Y3B1X2NtZCwgKHZvaWQgKilj
bWQsCisJCQkgICAga3ZtaV9mcmVlX2N0eCk7Cit9CisKIHN0YXRpYyBib29sIGlzX3ZtX21lc3Nh
Z2UodTE2IGlkKQogewogCXJldHVybiBpZCA8IEFSUkFZX1NJWkUobXNnX3ZtKSAmJiAhIW1zZ192
bVtpZF07CiB9CiAKK3N0YXRpYyBib29sIGlzX3ZjcHVfbWVzc2FnZSh1MTYgaWQpCit7CisJcmV0
dXJuIGlkIDwgQVJSQVlfU0laRShtc2dfdmNwdSkgJiYgISFtc2dfdmNwdVtpZF07Cit9CisKIHN0
YXRpYyBib29sIGlzX3Vuc3VwcG9ydGVkX21lc3NhZ2UodTE2IGlkKQogewogCWJvb2wgc3VwcG9y
dGVkOwogCi0Jc3VwcG9ydGVkID0gaXNfa25vd25fbWVzc2FnZShpZCkgJiYgaXNfdm1fbWVzc2Fn
ZShpZCk7CisJc3VwcG9ydGVkID0gaXNfa25vd25fbWVzc2FnZShpZCkgJiYKKwkJCShpc192bV9t
ZXNzYWdlKGlkKSB8fCBpc192Y3B1X21lc3NhZ2UoaWQpKTsKIAogCXJldHVybiAhc3VwcG9ydGVk
OwogfQpAQCAtMzQ0LDEyICs0MjUsNzggQEAgc3RhdGljIGludCBrdm1pX21zZ19kaXNwYXRjaF92
bV9jbWQoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAogCXJldHVybiBtc2dfdm1bbXNn
LT5pZF0oa3ZtaSwgbXNnLCBtc2cgKyAxKTsKIH0KIAorc3RhdGljIGJvb2wgdmNwdV9jYW5faGFu
ZGxlX2NvbW1hbmRzKHN0cnVjdCBrdm1fdmNwdSAqdmNwdSkKK3sKKwlyZXR1cm4gdmNwdS0+YXJj
aC5tcF9zdGF0ZSAhPSBLVk1fTVBfU1RBVEVfVU5JTklUSUFMSVpFRDsKK30KKworc3RhdGljIGlu
dCBrdm1pX2dldF92Y3B1X2lmX3JlYWR5KHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbiAqa3ZtaSwK
KwkJCQkgIHVuc2lnbmVkIGludCB2Y3B1X2lkeCwKKwkJCQkgIHN0cnVjdCBrdm1fdmNwdSAqKnZj
cHUpCit7CisJaW50IGVycjsKKworCWVyciA9IGt2bWlfZ2V0X3ZjcHUoa3ZtaSwgdmNwdV9pZHgs
IHZjcHUpOworCisJaWYgKCFlcnIgJiYgIXZjcHVfY2FuX2hhbmRsZV9jb21tYW5kcygqdmNwdSkp
CisJCWVyciA9IC1LVk1fRUFHQUlOOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBr
dm1pX21zZ19kaXNwYXRjaF92Y3B1X2pvYihzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWks
CisJCQkJICAgICAgc3RydWN0IGt2bWlfdmNwdV9jbWRfam9iICpqb2IsCisJCQkJICAgICAgYm9v
bCAqcXVldWVkKQoreworCXN0cnVjdCBrdm1pX3ZjcHVfaGRyICpjbWQgPSAmam9iLT5tc2ctPmNt
ZDsKKwlzdHJ1Y3Qga3ZtaV9tc2dfaGRyICpoZHIgPSAmam9iLT5tc2ctPmhkcjsKKwlzdHJ1Y3Qg
a3ZtX3ZjcHUgKnZjcHUgPSBOVUxMOworCWludCBlcnI7CisKKwlpZiAoaW52YWxpZF92Y3B1X2hk
cihjbWQpKQorCQlyZXR1cm4gLUtWTV9FSU5WQUw7CisKKwllcnIgPSBrdm1pX2dldF92Y3B1X2lm
X3JlYWR5KGt2bWksIGNtZC0+dmNwdSwgJnZjcHUpOworCisJaWYgKGVycikKKwkJcmV0dXJuIGt2
bWlfbXNnX3ZtX3JlcGx5KGt2bWksIGhkciwgZXJyLCBOVUxMLCAwKTsKKworCWVyciA9IGt2bWlf
bXNnX3F1ZXVlX3RvX3ZjcHUodmNwdSwgam9iKTsKKwlpZiAoIWVycikKKwkJKnF1ZXVlZCA9IHRy
dWU7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBrdm1pX21zZ19kaXNwYXRjaF92Y3B1
X2NtZChzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWksCisJCQkJICAgICAgc3RydWN0IGt2
bWlfbXNnX2hkciAqbXNnLAorCQkJCSAgICAgIGJvb2wgKnF1ZXVlZCkKK3sKKwlzdHJ1Y3Qga3Zt
aV92Y3B1X2NtZF9qb2IgKmpvYl9jbWQ7CisJaW50IGVycjsKKworCWpvYl9jbWQgPSBremFsbG9j
KHNpemVvZigqam9iX2NtZCksIEdGUF9LRVJORUwpOworCWlmICgham9iX2NtZCkKKwkJcmV0dXJu
IC1LVk1fRU5PTUVNOworCisJam9iX2NtZC0+bXNnID0gKHZvaWQgKiltc2c7CisKKwllcnIgPSBr
dm1pX21zZ19kaXNwYXRjaF92Y3B1X2pvYihrdm1pLCBqb2JfY21kLCBxdWV1ZWQpOworCisJaWYg
KCEqcXVldWVkKQorCQlrZnJlZShqb2JfY21kKTsKKworCXJldHVybiBlcnI7Cit9CisKIHN0YXRp
YyBpbnQga3ZtaV9tc2dfZGlzcGF0Y2goc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAog
CQkJICAgICBzdHJ1Y3Qga3ZtaV9tc2dfaGRyICptc2csIGJvb2wgKnF1ZXVlZCkKIHsKIAlpbnQg
ZXJyOwogCi0JZXJyID0ga3ZtaV9tc2dfZGlzcGF0Y2hfdm1fY21kKGt2bWksIG1zZyk7CisJaWYg
KGlzX3ZjcHVfbWVzc2FnZShtc2ctPmlkKSkKKwkJZXJyID0ga3ZtaV9tc2dfZGlzcGF0Y2hfdmNw
dV9jbWQoa3ZtaSwgbXNnLCBxdWV1ZWQpOworCWVsc2UKKwkJZXJyID0ga3ZtaV9tc2dfZGlzcGF0
Y2hfdm1fY21kKGt2bWksIG1zZyk7CiAKIAlpZiAoZXJyKQogCQlrdm1pX2Vycihrdm1pLCAiJXM6
IG1zZyBpZDogJXUgKCVzKSwgZXJyOiAlZFxuIiwgX19mdW5jX18sCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClZpcnR1YWxpemF0aW9uIG1haWxpbmcgbGlz
dApWaXJ0dWFsaXphdGlvbkBsaXN0cy5saW51eC1mb3VuZGF0aW9uLm9yZwpodHRwczovL2xpc3Rz
LmxpbnV4Zm91bmRhdGlvbi5vcmcvbWFpbG1hbi9saXN0aW5mby92aXJ0dWFsaXphdGlvbg==
