Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from smtp2.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id CCB377BF359
	for <lists.virtualization@lfdr.de>; Tue, 10 Oct 2023 08:52:52 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by smtp2.osuosl.org (Postfix) with ESMTP id B73BD405C5;
	Tue, 10 Oct 2023 06:52:50 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org B73BD405C5
Authentication-Results: smtp2.osuosl.org;
	dkim=fail reason="signature verification failed" (1024-bit key) header.d=redhat.com header.i=@redhat.com header.a=rsa-sha256 header.s=mimecast20190719 header.b=AWjyTRNp
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp2.osuosl.org ([127.0.0.1])
	by localhost (smtp2.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 99J9PFbX2BXQ; Tue, 10 Oct 2023 06:52:49 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by smtp2.osuosl.org (Postfix) with ESMTPS id 490E640610;
	Tue, 10 Oct 2023 06:52:49 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp2.osuosl.org 490E640610
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id 83E3CC0DD3;
	Tue, 10 Oct 2023 06:52:48 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from smtp4.osuosl.org (smtp4.osuosl.org [IPv6:2605:bc80:3010::137])
 by lists.linuxfoundation.org (Postfix) with ESMTP id A230BC0032
 for <virtualization@lists.linux-foundation.org>;
 Tue, 10 Oct 2023 06:52:46 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by smtp4.osuosl.org (Postfix) with ESMTP id 68B894169B
 for <virtualization@lists.linux-foundation.org>;
 Tue, 10 Oct 2023 06:52:46 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org 68B894169B
Authentication-Results: smtp4.osuosl.org;
 dkim=pass (1024-bit key) header.d=redhat.com header.i=@redhat.com
 header.a=rsa-sha256 header.s=mimecast20190719 header.b=AWjyTRNp
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from smtp4.osuosl.org ([127.0.0.1])
 by localhost (smtp4.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id vh-wgiUy6Tzl
 for <virtualization@lists.linux-foundation.org>;
 Tue, 10 Oct 2023 06:52:43 +0000 (UTC)
Received: from us-smtp-delivery-124.mimecast.com
 (us-smtp-delivery-124.mimecast.com [170.10.129.124])
 by smtp4.osuosl.org (Postfix) with ESMTPS id 6EF29415E5
 for <virtualization@lists.linux-foundation.org>;
 Tue, 10 Oct 2023 06:52:43 +0000 (UTC)
DKIM-Filter: OpenDKIM Filter v2.11.0 smtp4.osuosl.org 6EF29415E5
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1696920762;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=+G320iPimgxS8L1+mRAviW0xgLurmbE0PKiNyj0tp6Q=;
 b=AWjyTRNpewpIETEv+iVfgdwbCyD94LWo0Dgfb50H8il2LL9Wr7PHcAS7M2nhAt5fkoLNxI
 sSuSYLreeSosrMO1XRFp/RT8114tdZfJGGcNNPwImBf3Ig8Q1xSGbB/egJfO5yAN5oMaWz
 ond9sd602J8t3IWx3Zvex+j1gfRurmE=
Received: from mail-lf1-f69.google.com (mail-lf1-f69.google.com
 [209.85.167.69]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-297-aVYBz--IOmKt5m4VTCUKHw-1; Tue, 10 Oct 2023 02:52:36 -0400
X-MC-Unique: aVYBz--IOmKt5m4VTCUKHw-1
Received: by mail-lf1-f69.google.com with SMTP id
 2adb3069b0e04-5041a779c75so4623706e87.2
 for <virtualization@lists.linux-foundation.org>;
 Mon, 09 Oct 2023 23:52:35 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20230601; t=1696920754; x=1697525554;
 h=content-transfer-encoding:cc:to:subject:message-id:date:from
 :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=+G320iPimgxS8L1+mRAviW0xgLurmbE0PKiNyj0tp6Q=;
 b=MRNbWKGOUj7B2blxY3claqa9KhIvFVNb5PvRsaEuh8VzIhUW602Aw3sixbLcR9LtFN
 dU8gK567CJ+/sy9OUQkwpoWW0JFHYFHKr+dA4MCm0VuMkQKB/5+RH4CmgwG6MNiS2nn0
 RlPHiXec7JEKTSgiRKQZYJd5vgtBvpoPuNEN1xrJNi93CkWbNdPpxUmsCipMPO0jn2t+
 Li4x8XaalmbrcCM8s1Voza0qRDcUWPg5uP6jwkC152xhrQu2fwYDbqxG13957hKSdfuI
 esK5J/mPdQOpwhXrjn7CAPfRXUsxTLwOnMXIUck8oTkUn+LIYRlpcPbe9X77Y74+08Bc
 ZeFA==
X-Gm-Message-State: AOJu0Yw1lBPidEsqMimFNJ9NQoNjGYf3+SoiEQFOsBW+CMlUd9oHdA14
 6Bv7/MMPvd4OuzdAZmhS1D1wSEBhpNYaQ+SKSYf7pmEoLe/4rDfSCIWBS1myMvRwswBF/xGrEvF
 50+GrZ5S3RO/kKauJTciYATU5E2RrRjS+D0vTshrnDDP/oaywLTjpfDu4kQ==
X-Received: by 2002:a19:910d:0:b0:501:ba04:f34b with SMTP id
 t13-20020a19910d000000b00501ba04f34bmr12894259lfd.44.1696920754536; 
 Mon, 09 Oct 2023 23:52:34 -0700 (PDT)
X-Google-Smtp-Source: AGHT+IEdkzil+fZM3sRvYWHcSN1F+M9KEiQsMB6dyNn9xV2X3juFCS7UlNbaqQ3sUTeVRaUP1eZhopO7WwfBKctoAEU=
X-Received: by 2002:a19:910d:0:b0:501:ba04:f34b with SMTP id
 t13-20020a19910d000000b00501ba04f34bmr12894246lfd.44.1696920754140; Mon, 09
 Oct 2023 23:52:34 -0700 (PDT)
MIME-Version: 1.0
References: <20230929-jakub-os-90-trim-v1-0-a3af0c08f812@cloudflare.com>
 <20230929-jakub-os-90-trim-v1-2-a3af0c08f812@cloudflare.com>
In-Reply-To: <20230929-jakub-os-90-trim-v1-2-a3af0c08f812@cloudflare.com>
From: Jason Wang <jasowang@redhat.com>
Date: Tue, 10 Oct 2023 14:52:23 +0800
Message-ID: <CACGkMEsFYJ7VsyLua2BuCbCCrntkrJ4eUrCUrojCrirRpNT4Aw@mail.gmail.com>
Subject: Re: [PATCH 2/2] virtio-mmio: Support multiple interrupts per device
To: Jakub Sitnicki <jakub@cloudflare.com>
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Cc: Xuan Zhuo <xuanzhuo@linux.alibaba.com>,
 "Michael S. Tsirkin" <mst@redhat.com>, kernel-team@cloudflare.com,
 linux-kernel@vger.kernel.org, virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

T24gU2F0LCBTZXAgMzAsIDIwMjMgYXQgNDo0NuKAr0FNIEpha3ViIFNpdG5pY2tpIDxqYWt1YkBj
bG91ZGZsYXJlLmNvbT4gd3JvdGU6Cj4KPiBTb21lIHZpcnR1YWwgZGV2aWNlcywgc3VjaCBhcyB0
aGUgdmlydGlvIG5ldHdvcmsgZGV2aWNlLCBjYW4gdXNlIG11bHRpcGxlCj4gdmlydHF1ZXVlcyAo
b3IgbXVsdGlwbGUgcGFpcnMgb2YgdmlydHF1ZXVlcyBpbiB0aGUgY2FzZSBvZiBhIHZOSUMpLiBJ
biBzdWNoCj4gY2FzZSwgd2hlbiB0aGVyZSBhcmUgbXVsdGlwbGUgdkNQVXMgcHJlc2VudCwgaXQg
aXMgcG9zc2libGUgdG8gcHJvY2Vzcwo+IHZpcnRxdWV1ZSBldmVudHMgaW4gcGFyYWxsZWwuIEVh
Y2ggdkNQVSBjYW4gc2VydmljZSBhIHN1YnNldCBvZiBhbGwKPiB2aXJ0cXVldWVzIHdoZW4gbm90
aWZpZWQgdGhhdCB0aGVyZSBpcyB3b3JrIHRvIGNhcnJ5IG91dC4KPgo+IEhvd2V2ZXIsIHRoZSBj
dXJyZW50IHZpcnRpby1tbWlvIHRyYW5zcG9ydCBpbXBsZW1lbnRhdGlvbiBwb3NlcyBhCj4gbGlt
aXRhdGlvbi4gT25seSBvbmUgdkNQVSBjYW4gc2VydmljZSBub3RpZmljYXRpb25zIGZyb20gYW55
IG9mIHRoZQo+IHZpcnRxdWV1ZXMgb2YgYSBzaW5nbGUgdmlydGlvIGRldmljZS4gVGhpcyBpcyBi
ZWNhdXNlIGEgdmlydGlvLW1taW8gZGV2aWNlCj4gZHJpdmVyIHN1cHBvcnRzIHJlZ2lzdGVyaW5n
IGp1c3Qgb25lIGludGVycnVwdCBwZXIgZGV2aWNlLiBXaXRoIHN1Y2ggc2V0dXAKPiB3ZSBhcmUg
bm90IGFibGUgdG8gc2NhbGUgdmlydHF1ZXVlIGV2ZW50IHByb2Nlc3NpbmcgYW1vbmcgdkNQVXMu
Cj4KPiBOb3csIHdpdGggbW9yZSB0aGFuIG9uZSBJUlEgcmVzb3VyY2UgcmVnaXN0ZXJlZCBmb3Ig
YSB2aXJ0aW8tbW1pbyBwbGF0Zm9ybQo+IGRldmljZSwgd2UgY2FuIGFkZHJlc3MgdGhpcyBsaW1p
dGF0aW9uLgo+Cj4gRmlyc3QsIHdlIHJlcXVlc3QgbXVsdGlwbGUgSVJRcyB3aGVuIGNyZWF0aW5n
IHZpcnRxdWV1ZXMgZm9yIGEgZGV2aWNlLgo+Cj4gVGhlbiwgbWFwIGVhY2ggdmlydHF1ZXVlIHRv
IG9uZSBvZiB0aGUgSVJRcyBhc3NpZ25lZCB0byB0aGUgZGV2aWNlLiBUaGUKPiBtYXBwaW5nIGlz
IGRvbmUgaW4gYSBkZXZpY2UgdHlwZSBzcGVjaWZpYyBtYW5uZXIuIEZvciBpbnN0YW5jZSwgYSBu
ZXR3b3JrCj4gZGV2aWNlIHdpbGwgd2FudCBlYWNoIFJYL1RYIHZpcnRxdWV1ZSBwYWlyIG1hcHBl
ZCB0byBhIGRpZmZlcmVudCBJUlEKPiBsaW5lLiBPdGhlciBkZXZpY2UgdHlwZXMgbWlnaHQgcmVx
dWlyZSBhIGRpZmZlcmVudCBtYXBwaW5nIHNjaGVtZS4gV2UKPiBjdXJyZW50bHkgcHJvdmlkZSBh
IG1hcHBpbmcgZm9yIHZpcnRpby1uZXQgZGV2aWNlIHR5cGUuCj4KPiBGaW5hbGx5LCB3aGVuIGhh
bmRsaW5nIGFuIGludGVycnVwdCwgd2Ugc2VydmljZSBvbmx5IHRoZSB2aXJ0cXVldWVzCj4gYXNz
b2NpYXRlZCB3aXRoIHRoZSBJUlEgbGluZSB0aGF0IHRyaWdnZXJlZCB0aGUgZXZlbnQuCj4KPiBT
aWduZWQtb2ZmLWJ5OiBKYWt1YiBTaXRuaWNraSA8amFrdWJAY2xvdWRmbGFyZS5jb20+Cj4gLS0t
Cj4gIGRyaXZlcnMvdmlydGlvL3ZpcnRpb19tbWlvLmMgfCAxMDIgKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKystLS0tLS0tLQo+ICAxIGZpbGUgY2hhbmdlZCwgODMgaW5zZXJ0aW9u
cygrKSwgMTkgZGVsZXRpb25zKC0pCj4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy92aXJ0aW8vdmly
dGlvX21taW8uYyBiL2RyaXZlcnMvdmlydGlvL3ZpcnRpb19tbWlvLmMKPiBpbmRleCAwNmE1ODdi
MjM1NDIuLjE4MGM1MWMyNzcwNCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL3ZpcnRpby92aXJ0aW9f
bW1pby5jCj4gKysrIGIvZHJpdmVycy92aXJ0aW8vdmlydGlvX21taW8uYwo+IEBAIC02OSw2ICs2
OSw3IEBACj4gICNpbmNsdWRlIDxsaW51eC9zcGlubG9jay5oPgo+ICAjaW5jbHVkZSA8bGludXgv
dmlydGlvLmg+Cj4gICNpbmNsdWRlIDxsaW51eC92aXJ0aW9fY29uZmlnLmg+Cj4gKyNpbmNsdWRl
IDx1YXBpL2xpbnV4L3ZpcnRpb19pZHMuaD4KPiAgI2luY2x1ZGUgPHVhcGkvbGludXgvdmlydGlv
X21taW8uaD4KPiAgI2luY2x1ZGUgPGxpbnV4L3ZpcnRpb19yaW5nLmg+Cj4KPiBAQCAtOTMsNiAr
OTQsMTAgQEAgc3RydWN0IHZpcnRpb19tbWlvX2RldmljZSB7Cj4gICAgICAgICAvKiBhIGxpc3Qg
b2YgcXVldWVzIHNvIHdlIGNhbiBkaXNwYXRjaCBJUlFzICovCj4gICAgICAgICBzcGlubG9ja190
IGxvY2s7Cj4gICAgICAgICBzdHJ1Y3QgbGlzdF9oZWFkIHZpcnRxdWV1ZXM7Cj4gKwo+ICsgICAg
ICAgLyogSVJRIHJhbmdlIGFsbG9jYXRlZCB0byB0aGUgZGV2aWNlICovCj4gKyAgICAgICB1bnNp
Z25lZCBpbnQgaXJxX2Jhc2U7Cj4gKyAgICAgICB1bnNpZ25lZCBpbnQgbnVtX2lycXM7Cj4gIH07
Cj4KPiAgc3RydWN0IHZpcnRpb19tbWlvX3ZxX2luZm8gewo+IEBAIC0xMDEsNiArMTA2LDkgQEAg
c3RydWN0IHZpcnRpb19tbWlvX3ZxX2luZm8gewo+Cj4gICAgICAgICAvKiB0aGUgbGlzdCBub2Rl
IGZvciB0aGUgdmlydHF1ZXVlcyBsaXN0ICovCj4gICAgICAgICBzdHJ1Y3QgbGlzdF9oZWFkIG5v
ZGU7Cj4gKwo+ICsgICAgICAgLyogSVJRIG1hcHBlZCB0byB2aXJ0cXVldWUgKi8KPiArICAgICAg
IHVuc2lnbmVkIGludCBpcnE7Cj4gIH07Cj4KPgo+IEBAIC0yOTcsNyArMzA1LDcgQEAgc3RhdGlj
IGJvb2wgdm1fbm90aWZ5X3dpdGhfZGF0YShzdHJ1Y3QgdmlydHF1ZXVlICp2cSkKPiAgICAgICAg
IHJldHVybiB0cnVlOwo+ICB9Cj4KPiAtLyogTm90aWZ5IGFsbCB2aXJ0cXVldWVzIG9uIGFuIGlu
dGVycnVwdC4gKi8KPiArLyogTm90aWZ5IGFsbCBvciBzb21lIHZpcnRxdWV1ZXMgb24gYW4gaW50
ZXJydXB0LiAqLwo+ICBzdGF0aWMgaXJxcmV0dXJuX3Qgdm1faW50ZXJydXB0KGludCBpcnEsIHZv
aWQgKm9wYXF1ZSkKPiAgewo+ICAgICAgICAgc3RydWN0IHZpcnRpb19tbWlvX2RldmljZSAqdm1f
ZGV2ID0gb3BhcXVlOwo+IEBAIC0zMDgsMjAgKzMxNiwzMSBAQCBzdGF0aWMgaXJxcmV0dXJuX3Qg
dm1faW50ZXJydXB0KGludCBpcnEsIHZvaWQgKm9wYXF1ZSkKPgo+ICAgICAgICAgLyogUmVhZCBh
bmQgYWNrbm93bGVkZ2UgaW50ZXJydXB0cyAqLwo+ICAgICAgICAgc3RhdHVzID0gcmVhZGwodm1f
ZGV2LT5iYXNlICsgVklSVElPX01NSU9fSU5URVJSVVBUX1NUQVRVUyk7Cj4gLSAgICAgICB3cml0
ZWwoc3RhdHVzLCB2bV9kZXYtPmJhc2UgKyBWSVJUSU9fTU1JT19JTlRFUlJVUFRfQUNLKTsKPgo+
ICAgICAgICAgaWYgKHVubGlrZWx5KHN0YXR1cyAmIFZJUlRJT19NTUlPX0lOVF9DT05GSUcpKSB7
Cj4gKyAgICAgICAgICAgICAgIHdyaXRlbChzdGF0dXMgJiBWSVJUSU9fTU1JT19JTlRfQ09ORklH
LCB2bV9kZXYtPmJhc2UgKyBWSVJUSU9fTU1JT19JTlRFUlJVUFRfQUNLKTsKPiAgICAgICAgICAg
ICAgICAgdmlydGlvX2NvbmZpZ19jaGFuZ2VkKCZ2bV9kZXYtPnZkZXYpOwo+ICAgICAgICAgICAg
ICAgICByZXQgPSBJUlFfSEFORExFRDsKPiAgICAgICAgIH0KPgo+ICAgICAgICAgaWYgKGxpa2Vs
eShzdGF0dXMgJiBWSVJUSU9fTU1JT19JTlRfVlJJTkcpKSB7Cj4gKyAgICAgICAgICAgICAgIHdy
aXRlbChzdGF0dXMgJiBWSVJUSU9fTU1JT19JTlRfVlJJTkcsIHZtX2Rldi0+YmFzZSArIFZJUlRJ
T19NTUlPX0lOVEVSUlVQVF9BQ0spOwo+ICAgICAgICAgICAgICAgICBzcGluX2xvY2tfaXJxc2F2
ZSgmdm1fZGV2LT5sb2NrLCBmbGFncyk7Cj4gICAgICAgICAgICAgICAgIGxpc3RfZm9yX2VhY2hf
ZW50cnkoaW5mbywgJnZtX2Rldi0+dmlydHF1ZXVlcywgbm9kZSkKPiAgICAgICAgICAgICAgICAg
ICAgICAgICByZXQgfD0gdnJpbmdfaW50ZXJydXB0KGlycSwgaW5mby0+dnEpOwo+ICAgICAgICAg
ICAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ2bV9kZXYtPmxvY2ssIGZsYWdzKTsKPiAg
ICAgICAgIH0KPgo+ICsgICAgICAgLyogTm90aWZ5IG9ubHkgYWZmZWN0ZWQgdnJpbmdzIGlmIGRl
dmljZSB1c2VzIG11bHRpcGxlIGludGVycnVwdHMgKi8KPiArICAgICAgIGlmICh2bV9kZXYtPm51
bV9pcnFzID4gMSkgewo+ICsgICAgICAgICAgICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmdm1fZGV2
LT5sb2NrLCBmbGFncyk7Cj4gKyAgICAgICAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnkoaW5m
bywgJnZtX2Rldi0+dmlydHF1ZXVlcywgbm9kZSkgewo+ICsgICAgICAgICAgICAgICAgICAgICAg
IGlmIChpbmZvLT5pcnEgPT0gaXJxKQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cmV0IHw9IHZyaW5nX2ludGVycnVwdChpcnEsIGluZm8tPnZxKTsKPiArICAgICAgICAgICAgICAg
fQo+ICsgICAgICAgICAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ2bV9kZXYtPmxvY2ss
IGZsYWdzKTsKPiArICAgICAgIH0KPiArCj4gICAgICAgICByZXR1cm4gcmV0Owo+ICB9Cj4KPiBA
QCAtMzU2LDExICszNzUsMTUgQEAgc3RhdGljIHZvaWQgdm1fZGVsX3ZxcyhzdHJ1Y3QgdmlydGlv
X2RldmljZSAqdmRldikKPiAgewo+ICAgICAgICAgc3RydWN0IHZpcnRpb19tbWlvX2RldmljZSAq
dm1fZGV2ID0gdG9fdmlydGlvX21taW9fZGV2aWNlKHZkZXYpOwo+ICAgICAgICAgc3RydWN0IHZp
cnRxdWV1ZSAqdnEsICpuOwo+ICsgICAgICAgaW50IGksIGlycTsKPiArCj4gKyAgICAgICBmb3Ig
KGkgPSAwOyBpIDwgdm1fZGV2LT5udW1faXJxczsgaSsrKSB7Cj4gKyAgICAgICAgICAgICAgIGly
cSA9IHZtX2Rldi0+aXJxX2Jhc2UgKyBpOwo+ICsgICAgICAgICAgICAgICBkZXZtX2ZyZWVfaXJx
KCZ2ZGV2LT5kZXYsIGlycSwgdm1fZGV2KTsKPiArICAgICAgIH0KPgo+ICAgICAgICAgbGlzdF9m
b3JfZWFjaF9lbnRyeV9zYWZlKHZxLCBuLCAmdmRldi0+dnFzLCBsaXN0KQo+ICAgICAgICAgICAg
ICAgICB2bV9kZWxfdnEodnEpOwo+IC0KPiAtICAgICAgIGZyZWVfaXJxKHBsYXRmb3JtX2dldF9p
cnEodm1fZGV2LT5wZGV2LCAwKSwgdm1fZGV2KTsKPiAgfQo+Cj4gIHN0YXRpYyB2b2lkIHZtX3N5
bmNocm9uaXplX2NicyhzdHJ1Y3QgdmlydGlvX2RldmljZSAqdmRldikKPiBAQCAtNDg4LDYgKzUx
MSwxOCBAQCBzdGF0aWMgc3RydWN0IHZpcnRxdWV1ZSAqdm1fc2V0dXBfdnEoc3RydWN0IHZpcnRp
b19kZXZpY2UgKnZkZXYsIHVuc2lnbmVkIGludCBpbgo+ICAgICAgICAgcmV0dXJuIEVSUl9QVFIo
ZXJyKTsKPiAgfQo+Cj4gKy8qIE1hcCB2aXJ0cXVldWUgdG8gemVyby1iYXNlZCBpbnRlcnJ1cHQg
bnVtYmVyICovCj4gK3N0YXRpYyB1bnNpZ25lZCBpbnQgdnEyaXJxKGNvbnN0IHN0cnVjdCB2aXJ0
cXVldWUgKnZxKQo+ICt7Cj4gKyAgICAgICBzd2l0Y2ggKHZxLT52ZGV2LT5pZC5kZXZpY2UpIHsK
PiArICAgICAgIGNhc2UgVklSVElPX0lEX05FVDoKPiArICAgICAgICAgICAgICAgLyogaW50ZXJy
dXB0IHNoYXJlZCBieSByeC90eCB2aXJ0cXVldWUgcGFpciAqLwo+ICsgICAgICAgICAgICAgICBy
ZXR1cm4gdnEtPmluZGV4IC8gMjsKPiArICAgICAgIGRlZmF1bHQ6Cj4gKyAgICAgICAgICAgICAg
IHJldHVybiAwOwo+ICsgICAgICAgfQoKVHJhbnNwb3J0IGRyaXZlcnMgc2hvdWxkIGhhdmUgbm8g
a25vd2xlZGdlIG9mIGEgc3BlY2lmaWMgdHlwZSBvZiBkZXZpY2UuCgo+ICt9Cj4gKwo+ICBzdGF0
aWMgaW50IHZtX2ZpbmRfdnFzKHN0cnVjdCB2aXJ0aW9fZGV2aWNlICp2ZGV2LCB1bnNpZ25lZCBp
bnQgbnZxcywKPiAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0cXVldWUgKnZxc1td
LAo+ICAgICAgICAgICAgICAgICAgICAgICAgdnFfY2FsbGJhY2tfdCAqY2FsbGJhY2tzW10sCj4g
QEAgLTQ5NiwxOSArNTMxLDkgQEAgc3RhdGljIGludCB2bV9maW5kX3ZxcyhzdHJ1Y3QgdmlydGlv
X2RldmljZSAqdmRldiwgdW5zaWduZWQgaW50IG52cXMsCj4gICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgaXJxX2FmZmluaXR5ICpkZXNjKQo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgdmlydGlv
X21taW9fZGV2aWNlICp2bV9kZXYgPSB0b192aXJ0aW9fbW1pb19kZXZpY2UodmRldik7Cj4gLSAg
ICAgICBpbnQgaXJxID0gcGxhdGZvcm1fZ2V0X2lycSh2bV9kZXYtPnBkZXYsIDApOwo+IC0gICAg
ICAgaW50IGksIGVyciwgcXVldWVfaWR4ID0gMDsKPiAtCj4gLSAgICAgICBpZiAoaXJxIDwgMCkK
PiAtICAgICAgICAgICAgICAgcmV0dXJuIGlycTsKPiAtCj4gLSAgICAgICBlcnIgPSByZXF1ZXN0
X2lycShpcnEsIHZtX2ludGVycnVwdCwgSVJRRl9TSEFSRUQsCj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgZGV2X25hbWUoJnZkZXYtPmRldiksIHZtX2Rldik7Cj4gLSAgICAgICBpZiAoZXJyKQo+
IC0gICAgICAgICAgICAgICByZXR1cm4gZXJyOwo+IC0KPiAtICAgICAgIGlmIChvZl9wcm9wZXJ0
eV9yZWFkX2Jvb2wodm1fZGV2LT5wZGV2LT5kZXYub2Zfbm9kZSwgIndha2V1cC1zb3VyY2UiKSkK
PiAtICAgICAgICAgICAgICAgZW5hYmxlX2lycV93YWtlKGlycSk7Cj4gKyAgICAgICBzdHJ1Y3Qg
dmlydGlvX21taW9fdnFfaW5mbyAqaW5mbzsKPiArICAgICAgIGludCBpLCBlcnIsIGlycSwgbmly
cXMsIHF1ZXVlX2lkeCA9IDA7Cj4gKyAgICAgICB1bnNpZ25lZCBpbnQgaXJxX2Jhc2UgPSBVSU5U
X01BWDsKPgo+ICAgICAgICAgZm9yIChpID0gMDsgaSA8IG52cXM7ICsraSkgewo+ICAgICAgICAg
ICAgICAgICBpZiAoIW5hbWVzW2ldKSB7Cj4gQEAgLTUxOSwxMiArNTQ0LDUxIEBAIHN0YXRpYyBp
bnQgdm1fZmluZF92cXMoc3RydWN0IHZpcnRpb19kZXZpY2UgKnZkZXYsIHVuc2lnbmVkIGludCBu
dnFzLAo+ICAgICAgICAgICAgICAgICB2cXNbaV0gPSB2bV9zZXR1cF92cSh2ZGV2LCBxdWV1ZV9p
ZHgrKywgY2FsbGJhY2tzW2ldLCBuYW1lc1tpXSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgY3R4ID8gY3R4W2ldIDogZmFsc2UpOwo+ICAgICAgICAgICAgICAgICBpZiAo
SVNfRVJSKHZxc1tpXSkpIHsKPiAtICAgICAgICAgICAgICAgICAgICAgICB2bV9kZWxfdnFzKHZk
ZXYpOwo+IC0gICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQVFJfRVJSKHZxc1tpXSk7Cj4g
KyAgICAgICAgICAgICAgICAgICAgICAgZXJyID0gUFRSX0VSUih2cXNbaV0pOwo+ICsgICAgICAg
ICAgICAgICAgICAgICAgIGdvdG8gZmFpbF92cTsKPiAgICAgICAgICAgICAgICAgfQo+ICAgICAg
ICAgfQo+Cj4gKyAgICAgICBuaXJxcyA9IHBsYXRmb3JtX2lycV9jb3VudCh2bV9kZXYtPnBkZXYp
Owo+ICsgICAgICAgaWYgKG5pcnFzIDwgMCkgewo+ICsgICAgICAgICAgICAgICBlcnIgPSBuaXJx
czsKPiArICAgICAgICAgICAgICAgZ290byBmYWlsX3ZxOwo+ICsgICAgICAgfQo+ICsKPiArICAg
ICAgIGZvciAoaSA9IDA7IGkgPCBuaXJxczsgaSsrKSB7Cj4gKyAgICAgICAgICAgICAgIGlycSA9
IHBsYXRmb3JtX2dldF9pcnEodm1fZGV2LT5wZGV2LCBpKTsKPiArICAgICAgICAgICAgICAgaWYg
KGlycSA8IDApCj4gKyAgICAgICAgICAgICAgICAgICAgICAgZ290byBmYWlsX2lycTsKPiArICAg
ICAgICAgICAgICAgaWYgKGlycSA8IGlycV9iYXNlKQo+ICsgICAgICAgICAgICAgICAgICAgICAg
IGlycV9iYXNlID0gaXJxOwo+ICsKPiArICAgICAgICAgICAgICAgZXJyID0gZGV2bV9yZXF1ZXN0
X2lycSgmdmRldi0+ZGV2LCBpcnEsIHZtX2ludGVycnVwdCwKPiArICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBJUlFGX1NIQVJFRCwgTlVMTCwgdm1fZGV2KTsKPiArICAgICAg
ICAgICAgICAgaWYgKGVycikKPiArICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGZhaWxfaXJx
Owo+ICsKPiArICAgICAgICAgICAgICAgaWYgKG9mX3Byb3BlcnR5X3JlYWRfYm9vbCh2bV9kZXYt
PnBkZXYtPmRldi5vZl9ub2RlLCAid2FrZXVwLXNvdXJjZSIpKQo+ICsgICAgICAgICAgICAgICAg
ICAgICAgIGVuYWJsZV9pcnFfd2FrZShpcnEpOwoKQ291bGQgd2Ugc2ltcGx5IHVzZSB0aGUgc2Ft
ZSBwb2xpY3kgYXMgUENJICh2cF9maW5kX3Zxc19tc2l4KCkpPwoKVGhhbmtzCgo+ICsgICAgICAg
fQo+ICsKPiArICAgICAgIGZvciAoaSA9IDA7IGkgPCBudnFzOyBpKyspIHsKPiArICAgICAgICAg
ICAgICAgaXJxID0gdnEyaXJxKHZxc1tpXSk7Cj4gKyAgICAgICAgICAgICAgIGluZm8gPSB2cXNb
aV0tPnByaXY7Cj4gKyAgICAgICAgICAgICAgIGluZm8tPmlycSA9IGlycV9iYXNlICsgKGlycSAl
IG5pcnFzKTsKPiArICAgICAgIH0KPiArCj4gKyAgICAgICB2bV9kZXYtPmlycV9iYXNlID0gaXJx
X2Jhc2U7Cj4gKyAgICAgICB2bV9kZXYtPm51bV9pcnFzID0gbmlycXM7Cj4gKwo+ICAgICAgICAg
cmV0dXJuIDA7Cj4gKwo+ICtmYWlsX2lycToKPiArICAgICAgIHdoaWxlIChpLS0pCj4gKyAgICAg
ICAgICAgICAgIGRldm1fZnJlZV9pcnEoJnZkZXYtPmRldiwgaXJxX2Jhc2UgKyBpLCB2bV9kZXYp
Owo+ICtmYWlsX3ZxOgo+ICsgICAgICAgdm1fZGVsX3Zxcyh2ZGV2KTsKPiArCj4gKyAgICAgICBy
ZXR1cm4gZXJyOwo+ICB9Cj4KPiAgc3RhdGljIGNvbnN0IGNoYXIgKnZtX2J1c19uYW1lKHN0cnVj
dCB2aXJ0aW9fZGV2aWNlICp2ZGV2KQo+Cj4gLS0KPiAyLjQxLjAKPgoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBs
aXN0ClZpcnR1YWxpemF0aW9uQGxpc3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlz
dHMubGludXhmb3VuZGF0aW9uLm9yZy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
