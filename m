Return-Path: <virtualization-bounces@lists.linux-foundation.org>
X-Original-To: lists.virtualization@lfdr.de
Delivered-To: lists.virtualization@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id 5BBC22D1AD8
	for <lists.virtualization@lfdr.de>; Mon,  7 Dec 2020 21:46:43 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 1983187176;
	Mon,  7 Dec 2020 20:46:42 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 3HhaRY9E83lf; Mon,  7 Dec 2020 20:46:41 +0000 (UTC)
Received: from lists.linuxfoundation.org (lf-lists.osuosl.org [140.211.9.56])
	by hemlock.osuosl.org (Postfix) with ESMTP id 23DB681CC4;
	Mon,  7 Dec 2020 20:46:41 +0000 (UTC)
Received: from lf-lists.osuosl.org (localhost [127.0.0.1])
	by lists.linuxfoundation.org (Postfix) with ESMTP id E8467C013B;
	Mon,  7 Dec 2020 20:46:40 +0000 (UTC)
X-Original-To: virtualization@lists.linux-foundation.org
Delivered-To: virtualization@lists.linuxfoundation.org
Received: from silver.osuosl.org (smtp3.osuosl.org [140.211.166.136])
 by lists.linuxfoundation.org (Postfix) with ESMTP id 93D5DC013B
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:46:39 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by silver.osuosl.org (Postfix) with ESMTP id 8A8C62E295
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:46:39 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from silver.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id eW3rcglGGR1k
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:46:22 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from mx01.bbu.dsd.mx.bitdefender.com
 (mx01.bbu.dsd.mx.bitdefender.com [91.199.104.161])
 by silver.osuosl.org (Postfix) with ESMTPS id 4F6AF2E289
 for <virtualization@lists.linux-foundation.org>;
 Mon,  7 Dec 2020 20:46:19 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 B0262305D461; Mon,  7 Dec 2020 22:46:17 +0200 (EET)
Received: from localhost.localdomain (unknown [91.199.104.27])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 8669F3072784;
 Mon,  7 Dec 2020 22:46:17 +0200 (EET)
From: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>
To: kvm@vger.kernel.org
Subject: [PATCH v11 34/81] KVM: introspection: add permission access ioctls
Date: Mon,  7 Dec 2020 22:45:35 +0200
Message-Id: <20201207204622.15258-35-alazar@bitdefender.com>
In-Reply-To: <20201207204622.15258-1-alazar@bitdefender.com>
References: <20201207204622.15258-1-alazar@bitdefender.com>
MIME-Version: 1.0
Cc: =?UTF-8?q?Adalbert=20Laz=C4=83r?= <alazar@bitdefender.com>,
 Paolo Bonzini <pbonzini@redhat.com>, virtualization@lists.linux-foundation.org
X-BeenThere: virtualization@lists.linux-foundation.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: Linux virtualization <virtualization.lists.linux-foundation.org>
List-Unsubscribe: <https://lists.linuxfoundation.org/mailman/options/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=unsubscribe>
List-Archive: <http://lists.linuxfoundation.org/pipermail/virtualization/>
List-Post: <mailto:virtualization@lists.linux-foundation.org>
List-Help: <mailto:virtualization-request@lists.linux-foundation.org?subject=help>
List-Subscribe: <https://lists.linuxfoundation.org/mailman/listinfo/virtualization>, 
 <mailto:virtualization-request@lists.linux-foundation.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: virtualization-bounces@lists.linux-foundation.org
Sender: "Virtualization" <virtualization-bounces@lists.linux-foundation.org>

S1ZNX0lOVFJPU1BFQ1RJT05fQ09NTUFORCBhbmQgS1ZNX0lOVFJPU1BFQ1RJT05fRVZFTlRTIGlv
Y3RscyBhcmUgdXNlZApieSB0aGUgZGV2aWNlIG1hbmFnZXIgdG8gYWxsb3cvZGlzYWxsb3cgYWNj
ZXNzIHRvIHNwZWNpZmljIChvciBhbGwpCmludHJvc3BlY3Rpb24gY29tbWFuZHMgYW5kIGV2ZW50
cy4gVGhlIGludHJvc3BlY3Rpb24gdG9vbCB3aWxsIGdldCB0aGUKS1ZNX0VQRVJNIGVycm9yIGNv
ZGUgb24gYW55IGF0dGVtcHQgdG8gdXNlIGEgZGlzYWxsb3dlZCBjb21tYW5kLgoKQnkgZGVmYXVs
dCwgYWxsIGV2ZW50cyBhbmQgYWxtb3N0IGFsbCBjb21tYW5kcyBhcmUgZGlzYWxsb3dlZC4KU29t
ZSBjb21tYW5kcyBhcmUgYWx3YXlzIGFsbG93ZWQgKHRob3NlIHF1ZXJ5aW5nIHRoZSBpbnRyb3Nw
ZWN0aW9uCmNhcGFiaWxpdGllcykuCgpTaWduZWQtb2ZmLWJ5OiBBZGFsYmVydCBMYXrEg3IgPGFs
YXphckBiaXRkZWZlbmRlci5jb20+Ci0tLQogRG9jdW1lbnRhdGlvbi92aXJ0L2t2bS9hcGkucnN0
ICAgICAgICAgICAgICAgIHwgIDY4ICsrKysrKysrKysKIGluY2x1ZGUvbGludXgva3ZtaV9ob3N0
LmggICAgICAgICAgICAgICAgICAgICB8ICAgNyArCiBpbmNsdWRlL3VhcGkvbGludXgva3ZtLmgg
ICAgICAgICAgICAgICAgICAgICAgfCAgIDggKysKIGluY2x1ZGUvdWFwaS9saW51eC9rdm1pLmgg
ICAgICAgICAgICAgICAgICAgICB8ICAyMiArKysrCiAuLi4vdGVzdGluZy9zZWxmdGVzdHMva3Zt
L3g4Nl82NC9rdm1pX3Rlc3QuYyAgfCAgNDkgKysrKysrKwogdmlydC9rdm0vaW50cm9zcGVjdGlv
bi9rdm1pLmMgICAgICAgICAgICAgICAgIHwgMTIyICsrKysrKysrKysrKysrKysrKwogdmlydC9r
dm0va3ZtX21haW4uYyAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDE4ICsrKwogNyBmaWxl
cyBjaGFuZ2VkLCAyOTQgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRpb24v
dmlydC9rdm0vYXBpLnJzdCBiL0RvY3VtZW50YXRpb24vdmlydC9rdm0vYXBpLnJzdAppbmRleCA5
YjQ4YmU5MGFlN2IuLmYzNjk4NDEzZGRhYiAxMDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi92aXJ0
L2t2bS9hcGkucnN0CisrKyBiL0RvY3VtZW50YXRpb24vdmlydC9rdm0vYXBpLnJzdApAQCAtNDg3
OCw2ICs0ODc4LDc0IEBAIEVycm9yczoKIFRoaXMgaW9jdGwgaXMgdXNlZCB0byBmcmVlIGFsbCBp
bnRyb3NwZWN0aW9uIHN0cnVjdHVyZXMKIHJlbGF0ZWQgdG8gdGhpcyBWTS4KIAorNC4xMjkgS1ZN
X0lOVFJPU1BFQ1RJT05fQ09NTUFORAorLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQor
Cis6Q2FwYWJpbGl0eTogS1ZNX0NBUF9JTlRST1NQRUNUSU9OCis6QXJjaGl0ZWN0dXJlczogeDg2
Cis6VHlwZTogdm0gaW9jdGwKKzpQYXJhbWV0ZXJzOiBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25f
ZmVhdHVyZSAoaW4pCis6UmV0dXJuczogMCBvbiBzdWNjZXNzLCBhIG5lZ2F0aXZlIHZhbHVlIG9u
IGVycm9yCisKK0Vycm9yczoKKworICA9PT09PT0gICAgID09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CisgIEVGQVVMVCAgICAgdGhlIFZN
IGlzIG5vdCBpbnRyb3NwZWN0ZWQgeWV0ICh1c2UgS1ZNX0lOVFJPU1BFQ1RJT05fSE9PSykKKyAg
RUlOVkFMICAgICB0aGUgY29tbWFuZCBpcyB1bmtub3duCisgIEVQRVJNICAgICAgdGhlIGNvbW1h
bmQgY2FuJ3QgYmUgZGlzYWxsb3dlZCAoZS5nLiBLVk1JX0dFVF9WRVJTSU9OKQorICBFUEVSTSAg
ICAgIHRoZSBpbnRyb3NwZWN0aW9uIGlzIGRpc2FibGVkIChrdm0uaW50cm9zcGVjdGlvbj0wKQor
ICA9PT09PT0gICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09CisKK1RoaXMgaW9jdGwgaXMgdXNlZCB0byBhbGxvdyBvciBkaXNhbGxv
dyBpbnRyb3NwZWN0aW9uIGNvbW1hbmRzCitmb3IgdGhlIGN1cnJlbnQgVk0uIEJ5IGRlZmF1bHQs
IGFsbW9zdCBhbGwgY29tbWFuZHMgYXJlIGRpc2FsbG93ZWQKK2V4Y2VwdCBmb3IgdGhvc2UgdXNl
ZCB0byBxdWVyeSB0aGUgQVBJIGZlYXR1cmVzLgorCis6OgorCisgIHN0cnVjdCBrdm1faW50cm9z
cGVjdGlvbl9mZWF0dXJlIHsKKwlfX3UzMiBhbGxvdzsKKwlfX3MzMiBpZDsKKyAgfTsKKworSWYg
YWxsb3cgaXMgMSwgdGhlIGNvbW1hbmQgc3BlY2lmaWVkIGJ5IGlkIGlzIGFsbG93ZWQuIElmIGFs
bG93IGlzIDAsCit0aGUgY29tbWFuZCBpcyBkaXNhbGxvd2VkLgorCitVbmxlc3Mgc2V0IHRvIC0x
IChtZWFuaW5nIGFsbCBjb21tYW5kcyksIGlkIG11c3QgYmUgYSBjb21tYW5kIElECisoZS5nLiBL
Vk1JX0dFVF9WRVJTSU9OKQorCis0LjEzMCBLVk1fSU5UUk9TUEVDVElPTl9FVkVOVAorLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKworOkNhcGFiaWxpdHk6IEtWTV9DQVBfSU5UUk9TUEVD
VElPTgorOkFyY2hpdGVjdHVyZXM6IHg4NgorOlR5cGU6IHZtIGlvY3RsCis6UGFyYW1ldGVyczog
c3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uX2ZlYXR1cmUgKGluKQorOlJldHVybnM6IDAgb24gc3Vj
Y2VzcywgYSBuZWdhdGl2ZSB2YWx1ZSBvbiBlcnJvcgorCitFcnJvcnM6CisKKyAgPT09PT09ICAg
ICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PQorICBFRkFVTFQgICAgIHRoZSBWTSBpcyBub3QgaW50cm9zcGVjdGVkIHlldCAodXNlIEtW
TV9JTlRST1NQRUNUSU9OX0hPT0spCisgIEVJTlZBTCAgICAgdGhlIGV2ZW50IGlzIHVua25vd24K
KyAgRVBFUk0gICAgICB0aGUgaW50cm9zcGVjdGlvbiBpcyBkaXNhYmxlZCAoa3ZtLmludHJvc3Bl
Y3Rpb249MCkKKyAgPT09PT09ICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PQorCitUaGlzIGlvY3RsIGlzIHVzZWQgdG8gYWxsb3cg
b3IgZGlzYWxsb3cgaW50cm9zcGVjdGlvbiBldmVudHMKK2ZvciB0aGUgY3VycmVudCBWTS4gQnkg
ZGVmYXVsdCwgYWxsIGV2ZW50cyBhcmUgZGlzYWxsb3dlZC4KKworOjoKKworICBzdHJ1Y3Qga3Zt
X2ludHJvc3BlY3Rpb25fZmVhdHVyZSB7CisJX191MzIgYWxsb3c7CisJX19zMzIgaWQ7CisgIH07
CisKK0lmIGFsbG93IGlzIDEsIHRoZSBldmVudCBzcGVjaWZpZWQgYnkgaWQgaXMgYWxsb3dlZC4g
SWYgYWxsb3cgaXMgMCwKK3RoZSBldmVudCBpcyBkaXNhbGxvd2VkLgorCitVbmxlc3Mgc2V0IHRv
IC0xIChtZWFuaW5nIGFsbCBldmVudHMpLCBpZCBtdXN0IGJlIGEgZXZlbnQgSUQKKyhlLmcuIEtW
TUlfVk1fRVZFTlRfVU5IT09LLCBLVk1JX1ZDUFVfRVZFTlRfQ1IsIGV0Yy4pCisKIDUuIFRoZSBr
dm1fcnVuIHN0cnVjdHVyZQogPT09PT09PT09PT09PT09PT09PT09PT09CiAKZGlmZiAtLWdpdCBh
L2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmggYi9pbmNsdWRlL2xpbnV4L2t2bWlfaG9zdC5oCmlu
ZGV4IDg1NzRiOTY4ODczNi4uYTVlZGUwNzY4NmI5IDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4
L2t2bWlfaG9zdC5oCisrKyBiL2luY2x1ZGUvbGludXgva3ZtaV9ob3N0LmgKQEAgLTE0LDYgKzE0
LDkgQEAgc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uIHsKIAogCXN0cnVjdCBzb2NrZXQgKnNvY2s7
CiAJc3RydWN0IHRhc2tfc3RydWN0ICpyZWN2OworCisJdW5zaWduZWQgbG9uZyAqY21kX2FsbG93
X21hc2s7CisJdW5zaWduZWQgbG9uZyAqZXZlbnRfYWxsb3dfbWFzazsKIH07CiAKIGludCBrdm1p
X3ZlcnNpb24odm9pZCk7CkBAIC0yNSw2ICsyOCwxMCBAQCB2b2lkIGt2bWlfZGVzdHJveV92bShz
dHJ1Y3Qga3ZtICprdm0pOwogaW50IGt2bWlfaW9jdGxfaG9vayhzdHJ1Y3Qga3ZtICprdm0sCiAJ
CSAgICBjb25zdCBzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25faG9vayAqaG9vayk7CiBpbnQga3Zt
aV9pb2N0bF91bmhvb2soc3RydWN0IGt2bSAqa3ZtKTsKK2ludCBrdm1pX2lvY3RsX2NvbW1hbmQo
c3RydWN0IGt2bSAqa3ZtLAorCQkgICAgICAgY29uc3Qgc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9u
X2ZlYXR1cmUgKmZlYXQpOworaW50IGt2bWlfaW9jdGxfZXZlbnQoc3RydWN0IGt2bSAqa3ZtLAor
CQkgICAgIGNvbnN0IHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9mZWF0dXJlICpmZWF0KTsKIAog
I2Vsc2UKIApkaWZmIC0tZ2l0IGEvaW5jbHVkZS91YXBpL2xpbnV4L2t2bS5oIGIvaW5jbHVkZS91
YXBpL2xpbnV4L2t2bS5oCmluZGV4IGEwYmUwZWE1YjEzZi4uYzY5MTQwODkzZjY4IDEwMDY0NAot
LS0gYS9pbmNsdWRlL3VhcGkvbGludXgva3ZtLmgKKysrIGIvaW5jbHVkZS91YXBpL2xpbnV4L2t2
bS5oCkBAIC0xNjUzLDYgKzE2NTMsMTQgQEAgc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uX2hvb2sg
ewogI2RlZmluZSBLVk1fSU5UUk9TUEVDVElPTl9IT09LICAgIF9JT1coS1ZNSU8sIDB4YzgsIHN0
cnVjdCBrdm1faW50cm9zcGVjdGlvbl9ob29rKQogI2RlZmluZSBLVk1fSU5UUk9TUEVDVElPTl9V
TkhPT0sgIF9JTyhLVk1JTywgMHhjOSkKIAorc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uX2ZlYXR1
cmUgeworCV9fdTMyIGFsbG93OworCV9fczMyIGlkOworfTsKKworI2RlZmluZSBLVk1fSU5UUk9T
UEVDVElPTl9DT01NQU5EIF9JT1coS1ZNSU8sIDB4Y2EsIHN0cnVjdCBrdm1faW50cm9zcGVjdGlv
bl9mZWF0dXJlKQorI2RlZmluZSBLVk1fSU5UUk9TUEVDVElPTl9FVkVOVCAgIF9JT1coS1ZNSU8s
IDB4Y2IsIHN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9mZWF0dXJlKQorCiAjZGVmaW5lIEtWTV9E
RVZfQVNTSUdOX0VOQUJMRV9JT01NVQkoMSA8PCAwKQogI2RlZmluZSBLVk1fREVWX0FTU0lHTl9Q
Q0lfMl8zCQkoMSA8PCAxKQogI2RlZmluZSBLVk1fREVWX0FTU0lHTl9NQVNLX0lOVFgJKDEgPDwg
MikKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9saW51eC9rdm1pLmggYi9pbmNsdWRlL3VhcGkv
bGludXgva3ZtaS5oCmluZGV4IDM0ZGRhOTEwMTZkYi4uODVmODYyMmRkZjk1IDEwMDY0NAotLS0g
YS9pbmNsdWRlL3VhcGkvbGludXgva3ZtaS5oCisrKyBiL2luY2x1ZGUvdWFwaS9saW51eC9rdm1p
LmgKQEAgLTEwLDQgKzEwLDI2IEBAIGVudW0gewogCUtWTUlfVkVSU0lPTiA9IDB4MDAwMDAwMDEK
IH07CiAKKyNkZWZpbmUgS1ZNSV9WTV9NRVNTQUdFX0lEKGlkKSAgICAoKGlkKSA8PCAxKQorI2Rl
ZmluZSBLVk1JX1ZDUFVfTUVTU0FHRV9JRChpZCkgKCgoaWQpIDw8IDEpIHwgMSkKKworZW51bSB7
CisJS1ZNSV9ORVhUX1ZNX01FU1NBR0UKK307CisKK2VudW0geworCUtWTUlfTkVYVF9WQ1BVX01F
U1NBR0UKK307CisKKyNkZWZpbmUgS1ZNSV9WTV9FVkVOVF9JRChpZCkgICAgKChpZCkgPDwgMSkK
KyNkZWZpbmUgS1ZNSV9WQ1BVX0VWRU5UX0lEKGlkKSAoKChpZCkgPDwgMSkgfCAxKQorCitlbnVt
IHsKKwlLVk1JX05FWFRfVk1fRVZFTlQKK307CisKK2VudW0geworCUtWTUlfTkVYVF9WQ1BVX0VW
RU5UCit9OworCiAjZW5kaWYgLyogX1VBUElfX0xJTlVYX0tWTUlfSCAqLwpkaWZmIC0tZ2l0IGEv
dG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82NC9rdm1pX3Rlc3QuYyBiL3Rvb2xzL3Rl
c3Rpbmcvc2VsZnRlc3RzL2t2bS94ODZfNjQva3ZtaV90ZXN0LmMKaW5kZXggMTNkM2UwYTNhZjlk
Li5hYzhmNjU4OTk5ZjggMTAwNjQ0Ci0tLSBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2t2bS94
ODZfNjQva3ZtaV90ZXN0LmMKKysrIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMva3ZtL3g4Nl82
NC9rdm1pX3Rlc3QuYwpAQCAtNDQsMTEgKzQ0LDYwIEBAIHN0YXRpYyB2b2lkIGRvX2hvb2tfaW9j
dGwoc3RydWN0IGt2bV92bSAqdm0sIF9fczMyIGZkLCBpbnQgZXhwZWN0ZWRfZXJyKQogCQllcnJu
bywgc3RyZXJyb3IoZXJybm8pLCBleHBlY3RlZF9lcnIsIGZkKTsKIH0KIAorc3RhdGljIHZvaWQg
c2V0X3Blcm0oc3RydWN0IGt2bV92bSAqdm0sIF9fczMyIGlkLCBfX3UzMiBhbGxvdywKKwkJICAg
ICBpbnQgZXhwZWN0ZWRfZXJyLCBpbnQgaW9jdGxfaWQsCisJCSAgICAgY29uc3QgY2hhciAqaW9j
dGxfc3RyKQoreworCXN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9mZWF0dXJlIGZlYXQgPSB7CisJ
CS5hbGxvdyA9IGFsbG93LAorCQkuaWQgPSBpZAorCX07CisJaW50IHI7CisKKwlyID0gaW9jdGwo
dm0tPmZkLCBpb2N0bF9pZCwgJmZlYXQpOworCVRFU1RfQVNTRVJUKHIgPT0gMCB8fCBlcnJubyA9
PSBleHBlY3RlZF9lcnIsCisJCSIlcyBmYWlsZWQsIGlkICVkLCBlcnJubyAlZCAoJXMpLCBleHBl
Y3RlZCAlZFxuIiwKKwkJaW9jdGxfc3RyLCBpZCwgZXJybm8sIHN0cmVycm9yKGVycm5vKSwgZXhw
ZWN0ZWRfZXJyKTsKK30KKworc3RhdGljIHZvaWQgc2V0X2V2ZW50X3Blcm0oc3RydWN0IGt2bV92
bSAqdm0sIF9fczMyIGlkLCBfX3UzMiBhbGxvdywKKwkJCSAgIGludCBleHBlY3RlZF9lcnIpCit7
CisJc2V0X3Blcm0odm0sIGlkLCBhbGxvdywgZXhwZWN0ZWRfZXJyLCBLVk1fSU5UUk9TUEVDVElP
Tl9FVkVOVCwKKwkJICJLVk1fSU5UUk9TUEVDVElPTl9FVkVOVCIpOworfQorCitzdGF0aWMgdm9p
ZCBhbGxvd19ldmVudChzdHJ1Y3Qga3ZtX3ZtICp2bSwgX19zMzIgZXZlbnRfaWQpCit7CisJc2V0
X2V2ZW50X3Blcm0odm0sIGV2ZW50X2lkLCAxLCAwKTsKK30KKworc3RhdGljIHZvaWQgc2V0X2Nv
bW1hbmRfcGVybShzdHJ1Y3Qga3ZtX3ZtICp2bSwgX19zMzIgaWQsIF9fdTMyIGFsbG93LAorCQkJ
ICAgICBpbnQgZXhwZWN0ZWRfZXJyKQoreworCXNldF9wZXJtKHZtLCBpZCwgYWxsb3csIGV4cGVj
dGVkX2VyciwgS1ZNX0lOVFJPU1BFQ1RJT05fQ09NTUFORCwKKwkJICJLVk1fSU5UUk9TUEVDVElP
Tl9DT01NQU5EIik7Cit9CisKIHN0YXRpYyB2b2lkIGhvb2tfaW50cm9zcGVjdGlvbihzdHJ1Y3Qg
a3ZtX3ZtICp2bSkKIHsKKwlfX3UzMiBhbGxvdyA9IDEsIGRpc2FsbG93ID0gMCwgYWxsb3dfaW52
YWwgPSAyOworCV9fczMyIGFsbF9JRHMgPSAtMTsKKworCXNldF9jb21tYW5kX3Blcm0odm0sIGFs
bF9JRHMsIGFsbG93LCBFRkFVTFQpOworCXNldF9ldmVudF9wZXJtKHZtLCBhbGxfSURzLCBhbGxv
dywgRUZBVUxUKTsKKwogCWRvX2hvb2tfaW9jdGwodm0sIC0xLCBFSU5WQUwpOwogCWRvX2hvb2tf
aW9jdGwodm0sIEt2bV9zb2NrZXQsIDApOwogCWRvX2hvb2tfaW9jdGwodm0sIEt2bV9zb2NrZXQs
IEVFWElTVCk7CisKKwlzZXRfY29tbWFuZF9wZXJtKHZtLCBhbGxfSURzLCBhbGxvd19pbnZhbCwg
RUlOVkFMKTsKKwlzZXRfY29tbWFuZF9wZXJtKHZtLCBhbGxfSURzLCBkaXNhbGxvdywgMCk7CisJ
c2V0X2NvbW1hbmRfcGVybSh2bSwgYWxsX0lEcywgYWxsb3csIDApOworCisJc2V0X2V2ZW50X3Bl
cm0odm0sIGFsbF9JRHMsIGFsbG93X2ludmFsLCBFSU5WQUwpOworCXNldF9ldmVudF9wZXJtKHZt
LCBhbGxfSURzLCBkaXNhbGxvdywgMCk7CisJYWxsb3dfZXZlbnQodm0sIGFsbF9JRHMpOwogfQog
CiBzdGF0aWMgdm9pZCB1bmhvb2tfaW50cm9zcGVjdGlvbihzdHJ1Y3Qga3ZtX3ZtICp2bSkKZGlm
ZiAtLWdpdCBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jIGIvdmlydC9rdm0vaW50cm9z
cGVjdGlvbi9rdm1pLmMKaW5kZXggYzRkMjBlNzU3ZWJiLi45NTRkMTQyMGRiNzEgMTAwNjQ0Ci0t
LSBhL3ZpcnQva3ZtL2ludHJvc3BlY3Rpb24va3ZtaS5jCisrKyBiL3ZpcnQva3ZtL2ludHJvc3Bl
Y3Rpb24va3ZtaS5jCkBAIC04LDYgKzgsMTEgQEAKICNpbmNsdWRlIDxsaW51eC9rdGhyZWFkLmg+
CiAjaW5jbHVkZSAia3ZtaV9pbnQuaCIKIAorI2RlZmluZSBLVk1JX05VTV9DT01NQU5EUyBfX2Nt
cCgoaW50KUtWTUlfTkVYVF9WTV9NRVNTQUdFLCBcCisJCQkJKGludClLVk1JX05FWFRfVkNQVV9N
RVNTQUdFLCA+KQorI2RlZmluZSBLVk1JX05VTV9FVkVOVFMgICBfX2NtcCgoaW50KUtWTUlfTkVY
VF9WTV9FVkVOVCwgXAorCQkJCShpbnQpS1ZNSV9ORVhUX1ZDUFVfRVZFTlQsID4pCisKIGludCBr
dm1pX2luaXQodm9pZCkKIHsKIAlyZXR1cm4gMDsKQEAgLTI0LDYgKzI5LDkgQEAgdm9pZCBrdm1p
X3VuaW5pdCh2b2lkKQogCiBzdGF0aWMgdm9pZCBrdm1pX2ZyZWUoc3RydWN0IGt2bSAqa3ZtKQog
eworCWJpdG1hcF9mcmVlKGt2bS0+a3ZtaS0+Y21kX2FsbG93X21hc2spOworCWJpdG1hcF9mcmVl
KGt2bS0+a3ZtaS0+ZXZlbnRfYWxsb3dfbWFzayk7CisKIAlrZnJlZShrdm0tPmt2bWkpOwogCWt2
bS0+a3ZtaSA9IE5VTEw7CiB9CkBAIC0zNyw2ICs0NSwxNSBAQCBrdm1pX2FsbG9jKHN0cnVjdCBr
dm0gKmt2bSwgY29uc3Qgc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uX2hvb2sgKmhvb2spCiAJaWYg
KCFrdm1pKQogCQlyZXR1cm4gTlVMTDsKIAorCWt2bWktPmNtZF9hbGxvd19tYXNrID0gYml0bWFw
X3phbGxvYyhLVk1JX05VTV9DT01NQU5EUywgR0ZQX0tFUk5FTCk7CisJa3ZtaS0+ZXZlbnRfYWxs
b3dfbWFzayA9IGJpdG1hcF96YWxsb2MoS1ZNSV9OVU1fRVZFTlRTLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoIWt2bWktPmNtZF9hbGxvd19tYXNrIHx8ICFrdm1pLT5ldmVudF9hbGxvd19tYXNrKSB7CisJ
CWJpdG1hcF9mcmVlKGt2bWktPmNtZF9hbGxvd19tYXNrKTsKKwkJYml0bWFwX2ZyZWUoa3ZtaS0+
ZXZlbnRfYWxsb3dfbWFzayk7CisJCWtmcmVlKGt2bWkpOworCQlyZXR1cm4gTlVMTDsKKwl9CisK
IAlCVUlMRF9CVUdfT04oc2l6ZW9mKGhvb2stPnV1aWQpICE9IHNpemVvZihrdm1pLT51dWlkKSk7
CiAJbWVtY3B5KCZrdm1pLT51dWlkLCAmaG9vay0+dXVpZCwgc2l6ZW9mKGt2bWktPnV1aWQpKTsK
IApAQCAtMTgzLDMgKzIwMCwxMDggQEAgdm9pZCBrdm1pX2Rlc3Ryb3lfdm0oc3RydWN0IGt2bSAq
a3ZtKQogewogCWt2bWlfdW5ob29rKGt2bSk7CiB9CisKK3N0YXRpYyBpbnQKK2t2bWlfaW9jdGxf
Z2V0X2ZlYXR1cmUoY29uc3Qgc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uX2ZlYXR1cmUgKmZlYXQs
CisJCSAgICAgICBib29sICphbGxvdywgczMyICppZCwgdW5zaWduZWQgaW50IG5iaXRzKQorewor
CXMzMiBhbGxfYml0cyA9IC0xOworCisJaWYgKGZlYXQtPmlkIDwgMCAmJiBmZWF0LT5pZCAhPSBh
bGxfYml0cykKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoZmVhdC0+aWQgPiAwICYmIGZlYXQt
PmlkID49IG5iaXRzKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmIChmZWF0LT5hbGxvdyA+IDEp
CisJCXJldHVybiAtRUlOVkFMOworCisJKmFsbG93ID0gZmVhdC0+YWxsb3cgPT0gMTsKKwkqaWQg
PSBmZWF0LT5pZDsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBrdm1pX2NvbnRyb2xf
YWxsb3dlZF9ldmVudHMoc3RydWN0IGt2bV9pbnRyb3NwZWN0aW9uICprdm1pLAorCQkJCQlzMzIg
aWQsIGJvb2wgYWxsb3cpCit7CisJczMyIGFsbF9ldmVudHMgPSAtMTsKKworCWlmIChhbGxvdykg
eworCQlpZiAoaWQgPT0gYWxsX2V2ZW50cykKKwkJCWJpdG1hcF9maWxsKGt2bWktPmV2ZW50X2Fs
bG93X21hc2ssIEtWTUlfTlVNX0VWRU5UUyk7CisJCWVsc2UKKwkJCXNldF9iaXQoaWQsIGt2bWkt
PmV2ZW50X2FsbG93X21hc2spOworCX0gZWxzZSB7CisJCWlmIChpZCA9PSBhbGxfZXZlbnRzKQor
CQkJYml0bWFwX3plcm8oa3ZtaS0+ZXZlbnRfYWxsb3dfbWFzaywgS1ZNSV9OVU1fRVZFTlRTKTsK
KwkJZWxzZQorCQkJY2xlYXJfYml0KGlkLCBrdm1pLT5ldmVudF9hbGxvd19tYXNrKTsKKwl9Cit9
CisKK2ludCBrdm1pX2lvY3RsX2V2ZW50KHN0cnVjdCBrdm0gKmt2bSwKKwkJICAgICBjb25zdCBz
dHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb25fZmVhdHVyZSAqZmVhdCkKK3sKKwlzdHJ1Y3Qga3ZtX2lu
dHJvc3BlY3Rpb24gKmt2bWk7CisJYm9vbCBhbGxvdzsKKwlpbnQgZXJyOworCXMzMiBpZDsKKwor
CWVyciA9IGt2bWlfaW9jdGxfZ2V0X2ZlYXR1cmUoZmVhdCwgJmFsbG93LCAmaWQsIEtWTUlfTlVN
X0VWRU5UUyk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCW11dGV4X2xvY2soJmt2bS0+
a3ZtaV9sb2NrKTsKKworCWt2bWkgPSBLVk1JKGt2bSk7CisJaWYgKGt2bWkpCisJCWt2bWlfY29u
dHJvbF9hbGxvd2VkX2V2ZW50cyhrdm1pLCBpZCwgYWxsb3cpOworCWVsc2UKKwkJZXJyID0gLUVG
QVVMVDsKKworCW11dGV4X3VubG9jaygma3ZtLT5rdm1pX2xvY2spOworCXJldHVybiBlcnI7Cit9
CisKK3N0YXRpYyB2b2lkIGt2bWlfY29udHJvbF9hbGxvd2VkX2NvbW1hbmRzKHN0cnVjdCBrdm1f
aW50cm9zcGVjdGlvbiAqa3ZtaSwKKwkJCQkJICBzMzIgaWQsIGJvb2wgYWxsb3cpCit7CisJczMy
IGFsbF9jb21tYW5kcyA9IC0xOworCisJaWYgKGFsbG93KSB7CisJCWlmIChpZCA9PSBhbGxfY29t
bWFuZHMpCisJCQliaXRtYXBfZmlsbChrdm1pLT5jbWRfYWxsb3dfbWFzaywgS1ZNSV9OVU1fQ09N
TUFORFMpOworCQllbHNlCisJCQlzZXRfYml0KGlkLCBrdm1pLT5jbWRfYWxsb3dfbWFzayk7CisJ
fSBlbHNlIHsKKwkJaWYgKGlkID09IGFsbF9jb21tYW5kcykKKwkJCWJpdG1hcF96ZXJvKGt2bWkt
PmNtZF9hbGxvd19tYXNrLCBLVk1JX05VTV9DT01NQU5EUyk7CisJCWVsc2UKKwkJCWNsZWFyX2Jp
dChpZCwga3ZtaS0+Y21kX2FsbG93X21hc2spOworCX0KK30KKworaW50IGt2bWlfaW9jdGxfY29t
bWFuZChzdHJ1Y3Qga3ZtICprdm0sCisJCSAgICAgICBjb25zdCBzdHJ1Y3Qga3ZtX2ludHJvc3Bl
Y3Rpb25fZmVhdHVyZSAqZmVhdCkKK3sKKwlzdHJ1Y3Qga3ZtX2ludHJvc3BlY3Rpb24gKmt2bWk7
CisJYm9vbCBhbGxvdzsKKwlpbnQgZXJyOworCXMzMiBpZDsKKworCWVyciA9IGt2bWlfaW9jdGxf
Z2V0X2ZlYXR1cmUoZmVhdCwgJmFsbG93LCAmaWQsIEtWTUlfTlVNX0NPTU1BTkRTKTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOworCisJbXV0ZXhfbG9jaygma3ZtLT5rdm1pX2xvY2spOworCisJ
a3ZtaSA9IEtWTUkoa3ZtKTsKKwlpZiAoa3ZtaSkKKwkJa3ZtaV9jb250cm9sX2FsbG93ZWRfY29t
bWFuZHMoa3ZtaSwgaWQsIGFsbG93KTsKKwllbHNlCisJCWVyciA9IC1FRkFVTFQ7CisKKwltdXRl
eF91bmxvY2soJmt2bS0+a3ZtaV9sb2NrKTsKKwlyZXR1cm4gZXJyOworfQpkaWZmIC0tZ2l0IGEv
dmlydC9rdm0va3ZtX21haW4uYyBiL3ZpcnQva3ZtL2t2bV9tYWluLmMKaW5kZXggZjg5ZTBjOTA5
ZGU3Li44MjU2ZTlhY2Q3YjIgMTAwNjQ0Ci0tLSBhL3ZpcnQva3ZtL2t2bV9tYWluLmMKKysrIGIv
dmlydC9rdm0va3ZtX21haW4uYwpAQCAtNDAzOCw2ICs0MDM4LDI0IEBAIHN0YXRpYyBsb25nIGt2
bV92bV9pb2N0bChzdHJ1Y3QgZmlsZSAqZmlscCwKIAkJaWYgKGVuYWJsZV9pbnRyb3NwZWN0aW9u
KQogCQkJciA9IGt2bWlfaW9jdGxfdW5ob29rKGt2bSk7CiAJCWJyZWFrOworCWNhc2UgS1ZNX0lO
VFJPU1BFQ1RJT05fQ09NTUFORDoKKwljYXNlIEtWTV9JTlRST1NQRUNUSU9OX0VWRU5UOiB7CisJ
CXN0cnVjdCBrdm1faW50cm9zcGVjdGlvbl9mZWF0dXJlIGZlYXQ7CisKKwkJciA9IC1FUEVSTTsK
KwkJaWYgKCFlbmFibGVfaW50cm9zcGVjdGlvbikKKwkJCWdvdG8gb3V0OworCisJCXIgPSAtRUZB
VUxUOworCQlpZiAoY29weV9mcm9tX3VzZXIoJmZlYXQsIGFyZ3AsIHNpemVvZihmZWF0KSkpCisJ
CQlnb3RvIG91dDsKKworCQlpZiAoaW9jdGwgPT0gS1ZNX0lOVFJPU1BFQ1RJT05fRVZFTlQpCisJ
CQlyID0ga3ZtaV9pb2N0bF9ldmVudChrdm0sICZmZWF0KTsKKwkJZWxzZQorCQkJciA9IGt2bWlf
aW9jdGxfY29tbWFuZChrdm0sICZmZWF0KTsKKwkJYnJlYWs7CisJfQogI2VuZGlmIC8qIENPTkZJ
R19LVk1fSU5UUk9TUEVDVElPTiAqLwogCWRlZmF1bHQ6CiAJCXIgPSBrdm1fYXJjaF92bV9pb2N0
bChmaWxwLCBpb2N0bCwgYXJnKTsKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KVmlydHVhbGl6YXRpb24gbWFpbGluZyBsaXN0ClZpcnR1YWxpemF0aW9uQGxp
c3RzLmxpbnV4LWZvdW5kYXRpb24ub3JnCmh0dHBzOi8vbGlzdHMubGludXhmb3VuZGF0aW9uLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL3ZpcnR1YWxpemF0aW9u
